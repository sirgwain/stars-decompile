// Decompiled code from stars.exe (Stars! 2.60j RC3)
// Generated by Ghidra
// 

// ======================================================================
// Function: FileError
// Address: 1070:4a10
// ======================================================================


void __cdecl16far IO::FileError(StringId ids)

{
  char *sz;
  short mbType;
  
  _DATA::idsFileError = ids;
  if ((_DATA::fFileErrSilent == 0) && (((uint)_DATA::gd.flags1 >> 1 & 1) == 0)) {
    mbType = 0x10;
    sz = MSG::PszFormatIds(ids,(short *)0x0);
    UTILGEN::AlertSz(sz,mbType);
  }
  return;
}



// ======================================================================
// Function: StreamOpen
// Address: 1070:52ae
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1070536a) */
/* WARNING: Removing unreachable block (ram,0x10705391) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __cdecl16far IO::StreamOpen(char *szFile,short mdOpen)

{
  ulong uVar1;
  undefined2 unaff_SS;
  DWORD DVar2;
  DWORD DVar3;
  ulong dwTickCur;
  short fNoErr;
  OFSTRUCT of;
  ulong dwTick;
  
  uVar1 = 0;
  while( true ) {
    _DATA::hf = OpenFile((LPCSTR)CONCAT22(0x1120,szFile),(undefined2 *)CONCAT22(unaff_SS,&of),
                         mdOpen & 0xbfff);
    if (_DATA::hf != 0xffff) {
      return;
    }
    if ((((uint)_DATA::gd.flags1 >> 9 & 1) == 0) || (of.nErrCode == 2)) break;
    DVar2 = GetTickCount();
    if (uVar1 == 0) {
      uVar1 = DVar2 + 4000;
    }
    if (uVar1 <= DVar2) break;
    do {
      DVar3 = GetTickCount();
    } while (DVar3 < DVar2 + 500);
  }
  if ((mdOpen & 0x4000U) == 0) {
    FileError(idsCantOpenFile);
  }
  PUBLIC::_longjmp(_penvMem,-1);
  return;
}



// ======================================================================
// Function: UnpackBattlePlan
// Address: 1070:40ce
// ======================================================================


void __cdecl16far IO::UnpackBattlePlan(byte *lpb,BTLPLAN *lpbtlplan,short iplan)

{
  int iVar1;
  undefined2 unaff_SS;
  short cOut;
  short cch;
  char szName [33];
  char szTemp [33];
  
  iVar1 = (int)lpb;
  PUBLIC::__fmemmove(lpbtlplan,lpb,4);
  lpb = (byte *)CONCAT22(lpb._2_2_,(int)lpb + 4);
  cch = (short)*lpb;
  if (cch == 0) {
    PUBLIC::__fstrcpy((char *)CONCAT22(lpbtlplan._2_2_,(int)lpbtlplan + 4),
                      (char *)CONCAT22(lpb._2_2_,iVar1 + 5));
  }
  else {
    cOut = 0x20;
    PUBLIC::__fmemmove((void *)CONCAT22(unaff_SS,szTemp),(void *)CONCAT22(lpb._2_2_,iVar1 + 5),0x20)
    ;
    UTILGEN::FDecompressUserString
              ((char *)CONCAT22(unaff_SS,szTemp),cch,(char *)CONCAT22(unaff_SS,szName),&cOut);
    PUBLIC::__fmemmove((void *)CONCAT22(lpbtlplan._2_2_,(int)lpbtlplan + 4),
                       (void *)CONCAT22(unaff_SS,szName),cOut);
  }
  lpbtlplan->flags1 = lpbtlplan->flags1 & 0xff0fU | (iplan & 0xfU) << 4;
  return;
}



// ======================================================================
// Function: FBadFileError
// Address: 1070:524e
// ======================================================================


short __cdecl16far IO::FBadFileError(StringId ids)

{
  short sVar1;
  
  if ((((ids == idsUniverseDefinitionFileSeemsMissingCorrupt) ||
       (ids == idsPlayerLogFileAppearsCorruptUnableLoad)) ||
      (ids == idsHistoryFileAppearsCorruptHistoricalDataWill)) ||
     (((ids == idsGameFileAppearsCorruptUnableLoadFile || (ids == idsErrorWritingFile)) ||
      ((ids == idsFileDate || (ids == idsFileGame)))))) {
    sVar1 = 1;
  }
  else {
    sVar1 = 0;
  }
  return sVar1;
}



// ======================================================================
// Function: ReadRtPlr
// Address: 1070:05e2
// ======================================================================


void __cdecl16far IO::ReadRtPlr(PLAYER *pplr,byte *pbIn)

{
  ushort uVar1;
  short cOut_2;
  PLAYER *pplrRaw;
  short iOff;
  
  pplrRaw = (PLAYER *)pbIn;
  PUBLIC::_memset(pplr,0,0xc0);
  if ((pplrRaw->flags4 & 7U) == 7) {
    PUBLIC::_memmove(pplr,pbIn,0x70);
    PUBLIC::_memmove(pplr->rgmdRelation,pbIn + 0x71,(uint)pbIn[0x70]);
    iOff = pbIn[0x70] + 0x71;
  }
  else {
    PUBLIC::_memmove(pplr,pbIn,8);
    iOff = 8;
  }
  if (pbIn[iOff] == 0) {
    PUBLIC::_strcpy(pplr->szName,(char *)(pbIn + iOff + 1));
    uVar1 = PUBLIC::_strlen(pplr->szName);
    iOff = iOff + uVar1 + 2;
  }
  else {
    cOut_2 = 0x20;
    UTILGEN::FDecompressUserString
              ((char *)CONCAT22(0x1120,pbIn + iOff + 1),(uint)pbIn[iOff],
               (char *)CONCAT22(0x1120,pplr->szName),&cOut_2);
    iOff = iOff + pbIn[iOff] + 1;
  }
  if ((_DATA::wVersFile >> 5 & 0x7f) < 0x37) {
    cOut_2 = (short)UTIL::PszPlayerName(0,*(byte *)(pplr->szName[0] + 0x175f) & 1,1,0,0,pplr);
    PUBLIC::_strcpy(pplr->szNames,(char *)cOut_2);
  }
  else if (pbIn[iOff] == 0) {
    PUBLIC::_strcpy(pplr->szNames,(char *)(pbIn + iOff + 1));
  }
  else {
    cOut_2 = 0x20;
    UTILGEN::FDecompressUserString
              ((char *)CONCAT22(0x1120,pbIn + iOff + 1),(uint)pbIn[iOff],
               (char *)CONCAT22(0x1120,pplr->szNames),&cOut_2);
  }
  pplr->flags43 = pplr->flags43 & 0xfff7;
  return;
}



// ======================================================================
// Function: UpdateBattleRecords
// Address: 1070:41ac
// ======================================================================


/* WARNING: Could not reconcile some variable overlaps */

void __cdecl16far IO::UpdateBattleRecords(void)

{
  byte bVar1;
  int iVar2;
  uint uVar3;
  int iVar4;
  undefined2 uVar5;
  undefined2 uVar6;
  short itok;
  BTLREC26 *lpbr26;
  HB *lphb;
  short cKill;
  BTLREC *lpbr;
  BTLDATA *lpbd;
  
  lphb = (HB *)CONCAT22(_DATA::rglphb[11]._2_2_,(int)_DATA::rglphb[11]);
  if (((int)_DATA::rglphb[11] != 0) || (_DATA::rglphb[11]._2_2_ != 0)) {
    lpbd = (BTLDATA *)CONCAT22(_DATA::rglphb[11]._2_2_,(int)_DATA::rglphb[11] + 0x12);
    while( true ) {
      while (lpbd->id == -1) {
        uVar5 = (undefined2)((ulong)lphb >> 0x10);
        iVar4 = *(int *)((int)lphb + 8);
        iVar2 = *(int *)((int)lphb + 10);
        lphb = (HB *)CONCAT22(iVar2,iVar4);
        if ((iVar4 == 0) && (iVar2 == 0)) {
          return;
        }
        if (*(uint *)(iVar4 + 6) < 0x11) {
          return;
        }
        lpbd = (BTLDATA *)CONCAT22(iVar2,iVar4 + 0x12);
      }
      uVar5 = (undefined2)((ulong)lpbd >> 0x10);
      iVar4 = (int)lpbd;
      if (*(int *)(iVar4 + 6) == 0) break;
      iVar2 = iVar4 + 0xe + (uint)*(byte *)(iVar4 + 3) * 0x1d;
      lpbr = (BTLREC *)CONCAT22(uVar5,iVar2);
      lpbr26 = (BTLREC26 *)CONCAT22(uVar5,iVar2);
      uVar3 = iVar4 + *(int *)(iVar4 + 6);
      lpbd = (BTLDATA *)CONCAT22(uVar5,uVar3);
      while ((uint)lpbr < uVar3) {
        uVar5 = (undefined2)((ulong)lpbr26 >> 0x10);
        bVar1 = *(byte *)((int)lpbr26 + 2);
        uVar6 = (undefined2)((ulong)lpbr >> 0x10);
        *(uint *)((uint)lpbr + 2) = (uint)*(byte *)((int)lpbr26 + 3);
        *(uint *)((uint)lpbr + 4) = *(uint *)((uint)lpbr + 4) & 0xff | (uint)bVar1 << 8;
        iVar4 = (uint)lpbr + 6 + *(int *)((uint)lpbr + 2) * 8;
        lpbr26 = (BTLREC26 *)CONCAT22(uVar6,iVar4);
        lpbr = (BTLREC *)CONCAT22(uVar6,iVar4);
      }
    }
  }
  return;
}



// ======================================================================
// Function: FReadFleet
// Address: 1070:3a4c
// ======================================================================


short __cdecl16far IO::FReadFleet(FLEET *lpfl)

{
  int *piVar1;
  undefined2 *puVar2;
  undefined2 *puVar3;
  byte *pbVar4;
  ushort *puVar5;
  undefined4 uVar6;
  uint uVar7;
  char *sz;
  ushort uVar8;
  short sVar9;
  uint *puVar10;
  int iVar11;
  undefined2 *puVar12;
  undefined2 *puVar13;
  undefined2 *puVar14;
  undefined2 uVar15;
  undefined2 unaff_SS;
  PL *pPVar16;
  void *pvVar17;
  HeapType HVar18;
  short cOut;
  char szT [33];
  ushort *pus;
  short cch;
  byte *pb;
  short cish;
  short i;
  ORDER *lpord;
  short fByte;
  short cord;
  ushort us;
  
  cish = 0;
  PUBLIC::__fmemset(lpfl,0,0x7c);
  PUBLIC::__fmemmove(lpfl,c_common::rgbCur,0xc);
  us = c_common::rgbCur._12_2_;
  pb = (byte *)((int)c_common::rgbCur + 0xe);
  if ((*(uint *)((int)lpfl + 4) >> 0xb & 1) == 0) {
    pus = (ushort *)((int)c_common::rgbCur + 0xe);
    i = 0;
    for (; us != 0; us = us >> 1) {
      if ((us & 1) != 0) {
        puVar5 = pus + 1;
        *(ushort *)((int)lpfl + 0xc + i * 2) = *pus;
        pus = puVar5;
        if (*(int *)((int)lpfl + 0xc + i * 2) != 0) {
          cish = cish + 1;
        }
      }
      i = i + 1;
    }
    pb = (byte *)pus;
  }
  else {
    i = 0;
    for (; us != 0; us = us >> 1) {
      if ((us & 1) != 0) {
        pbVar4 = pb + 1;
        *(uint *)((int)lpfl + 0xc + i * 2) = (uint)*pb;
        pb = pbVar4;
        if (*(int *)((int)lpfl + 0xc + i * 2) != 0) {
          cish = cish + 1;
        }
      }
      i = i + 1;
    }
  }
  if (cish == 0) {
    *(uint *)((int)lpfl + 4) = *(uint *)((int)lpfl + 4) & 0xfbff | 0x400;
  }
  if (3 < (*(uint *)((int)lpfl + 4) & 0xff)) {
    us = *(ushort *)pb;
    pb = pb + 2;
    for (i = 0; i < 5; i = i + 1) {
      uVar7 = us & 3;
      if (uVar7 == 1) {
        puVar10 = (uint *)((int)lpfl + 0x4c + i * 4);
        *puVar10 = (uint)*pb;
        puVar10[1] = 0;
        pb = pb + 1;
      }
      else if (uVar7 == 2) {
        puVar12 = (undefined2 *)((int)lpfl + 0x4c + i * 4);
        *puVar12 = *(undefined2 *)pb;
        puVar12[1] = 0;
        pb = pb + 2;
      }
      else if (uVar7 == 3) {
        uVar15 = *(undefined2 *)(pb + 2);
        puVar12 = (undefined2 *)((int)lpfl + 0x4c + i * 4);
        *puVar12 = *(undefined2 *)pb;
        puVar12[1] = uVar15;
        pb = pb + 4;
      }
      us = us >> 2;
    }
  }
  if ((*(uint *)((int)lpfl + 4) & 0xff) < 7) {
    uVar15 = *(undefined2 *)(pb + 2);
    *(undefined2 *)((int)lpfl + 0x74) = *(undefined2 *)pb;
    *(undefined2 *)((int)lpfl + 0x76) = uVar15;
    uVar15 = *(undefined2 *)(pb + 6);
    *(undefined2 *)((int)lpfl + 0x2c) = *(undefined2 *)(pb + 4);
    *(undefined2 *)((int)lpfl + 0x2e) = uVar15;
    ReadRt();
    return 1;
  }
  if ((uint)c_common::hdrCur.flags1 >> 10 == 0x10) {
    us = *(ushort *)pb;
    pus = (ushort *)(pb + 2);
    i = 0;
    for (; us != 0; us = us >> 1) {
      if ((us & 1) != 0) {
        puVar5 = pus + 1;
        *(ushort *)((int)lpfl + 0x2c + i * 2) = *pus;
        pus = puVar5;
        if (499 < *(uint *)((int)lpfl + 0x2c + i * 2) >> 7) {
          *(uint *)((int)lpfl + 0x2c + i * 2) = *(uint *)((int)lpfl + 0x2c + i * 2) & 0x7f | 0xf980;
        }
      }
      i = i + 1;
    }
    *(undefined *)((int)lpfl + 0x60) = *(undefined *)pus;
    *(uint *)((int)lpfl + 0x62) = (uint)*(byte *)((int)pus + 1);
    pPVar16 = MEMORY::LpplAlloc(0x12,*(int *)((int)lpfl + 0x62) + 1,htOrd);
    *(undefined2 *)((int)lpfl + 100) = (int)pPVar16;
    *(undefined2 *)((int)lpfl + 0x66) = (int)((ulong)pPVar16 >> 0x10);
    PUBLIC::__fmemset((void *)CONCAT22(*(undefined2 *)((int)lpfl + 0x66),
                                       *(int *)((int)lpfl + 100) + 4),0,
                      (*(int *)((int)lpfl + 0x62) + 1) * 0x12);
    cord = *(short *)((int)lpfl + 0x62);
    lpord = (ORDER *)CONCAT22(*(undefined2 *)((int)lpfl + 0x66),*(int *)((int)lpfl + 100) + 4);
    for (; cord != 0; cord = cord + -1) {
      PUBLIC::_memset((void *)c_common::rgbCur,0,0x12);
      ReadRt();
      if (((uint)c_common::hdrCur.flags1 >> 10 != 0x13) &&
         ((uint)c_common::hdrCur.flags1 >> 10 != 0x14)) goto IO_Corrupt;
      puVar12 = (undefined2 *)c_common::rgbCur;
      uVar15 = (undefined2)((ulong)lpord >> 0x10);
      puVar13 = (undefined2 *)lpord;
      puVar14 = puVar13;
      for (iVar11 = 9; iVar11 != 0; iVar11 = iVar11 + -1) {
        puVar3 = puVar14;
        puVar14 = puVar14 + 1;
        puVar2 = puVar12;
        puVar12 = puVar12 + 1;
        *puVar3 = *puVar2;
      }
      puVar13[3] = puVar13[3] & 0xdfff;
      lpord = (ORDER *)CONCAT22(uVar15,puVar13 + 9);
    }
    uVar6 = *(undefined4 *)((int)lpfl + 100);
    *(undefined *)((int)uVar6 + 3) = (char)*(undefined2 *)((int)lpfl + 0x62);
    if (*(int *)((int)lpfl + 6) != -1) {
      piVar1 = (int *)((int)lpfl + 6);
      if (*piVar1 != _DATA::game.cPlanMax && _DATA::game.cPlanMax <= *piVar1) {
        *(undefined2 *)((int)lpfl + 6) = 0xffff;
      }
      if ((*(int *)((int)lpfl + 8) !=
           *(int *)((int)c_common::rgptPlan + *(int *)((int)lpfl + 6) * 4)) ||
         (*(int *)((int)lpfl + 10) !=
          *(int *)((int)&c_common::rgptPlan[0].y + *(int *)((int)lpfl + 6) * 4))) {
        if ((i != 0) || (_DATA::game.turn != 0)) goto IO_Corrupt;
        iVar11 = *(int *)((int)lpfl + 6) * 4;
        uVar15 = *(undefined2 *)((int)&c_common::rgptPlan[0].y + iVar11);
        *(undefined2 *)((int)lpfl + 8) = *(undefined2 *)((int)c_common::rgptPlan + iVar11);
        *(undefined2 *)((int)lpfl + 10) = uVar15;
      }
    }
    ReadRt();
    if ((uint)c_common::hdrCur.flags1 >> 10 == 0x15) {
      if (c_common::rgbCur[0] == 0) {
        HVar18 = htString;
        uVar8 = PUBLIC::_strlen((char *)((int)c_common::rgbCur + 1));
        pvVar17 = MEMORY::LpAlloc(uVar8 + 1,HVar18);
        *(undefined2 *)((int)lpfl + 0x78) = (int)pvVar17;
        *(undefined2 *)((int)lpfl + 0x7a) = (int)((ulong)pvVar17 >> 0x10);
        PUBLIC::__fstrcpy((char *)CONCAT22(*(undefined2 *)((int)lpfl + 0x7a),
                                           *(undefined2 *)((int)lpfl + 0x78)),c_common::rgbCur + 1);
      }
      else {
        cOut = 0x20;
        UTILGEN::FDecompressUserString
                  (c_common::rgbCur + 1,(int)c_common::rgbCur[0],
                   (char *)CONCAT13((char)((uint)unaff_SS >> 8),CONCAT12((char)unaff_SS,szT)),&cOut)
        ;
        HVar18 = htString;
        uVar8 = PUBLIC::_strlen(szT);
        pvVar17 = MEMORY::LpAlloc(uVar8 + 1,HVar18);
        *(undefined2 *)((int)lpfl + 0x78) = (int)pvVar17;
        *(undefined2 *)((int)lpfl + 0x7a) = (int)((ulong)pvVar17 >> 0x10);
        PUBLIC::__fstrcpy((char *)CONCAT22(*(undefined2 *)((int)lpfl + 0x7a),
                                           *(undefined2 *)((int)lpfl + 0x78)),
                          (char *)CONCAT22(unaff_SS,szT));
      }
      ReadRt();
    }
    else {
      *(undefined2 *)((int)lpfl + 0x78) = 0;
      *(undefined2 *)((int)lpfl + 0x7a) = 0;
    }
    sVar9 = 1;
  }
  else {
IO_Corrupt:
    sVar9 = 0x10;
    sz = MSG::PszFormatIds(idsGameFileAppearsCorruptUnableLoadFile,(short *)0x0);
    UTILGEN::AlertSz(sz,sVar9);
    sVar9 = 0;
  }
  return sVar9;
}



// ======================================================================
// Function: FLoadGame
// Address: 1070:0810
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10702da2) */
/* WARNING: Removing unreachable block (ram,0x10701634) */
/* WARNING: Removing unreachable block (ram,0x10702d82) */
/* WARNING: Removing unreachable block (ram,0x10702da7) */
/* WARNING: Variable defined which should be unmapped: szEntry */
/* WARNING: Could not reconcile some variable overlaps */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* WARNING: Restarted to delay deadcode elimination for space: ram */

short __cdecl16far IO::FLoadGame(char *pszFileName,char *pszExt)

{
  int *piVar1;
  uint *puVar2;
  char *pcVar3;
  undefined2 *puVar4;
  undefined2 *puVar5;
  byte bVar6;
  int iVar7;
  undefined4 uVar8;
  byte *pbVar9;
  THING *pTVar10;
  FLEET **ppFVar11;
  undefined2 uVar12;
  short sVar13;
  short sVar14;
  short sVar15;
  char *pcVar16;
  ushort uVar17;
  int iVar18;
  uint uVar19;
  int iVar20;
  undefined2 unaff_SI;
  undefined2 *puVar21;
  int *piVar22;
  undefined2 unaff_DI;
  undefined2 *puVar23;
  undefined2 uVar24;
  undefined2 unaff_SS;
  void *pvVar25;
  PL *pPVar26;
  FLEET *lpfl_00;
  SCOREX *pSVar27;
  byte *pbVar28;
  PLANET *pPVar29;
  ulong uVar30;
  ulong uVar31;
  char szEntry [16];
  char *psz;
  char szSection [16];
  char szIniFile [16];
  char szT [256];
  int iStack_48;
  short grf;
  short dt;
  PLANET *lpplMac;
  short j;
  short iPlayer;
  THING *lpthMac;
  short cturn;
  short env [9];
  FLEET *lpfl;
  THING *lpth;
  short i;
  PLANET *lppl;
  short fSilentSav;
  short (*penvMemSav) [9];
  short fHaveHistoryData;
  short cPlanetAlloc;
  STARPACK sp;
  short cPlanetHist;
  short iplrSav;
  
  uVar31 = CONCAT22(unaff_SI,unaff_DI);
  grf = 0;
  cturn = 0;
  PUBLIC::_strcpy((char *)c_common::szBase,pszFileName);
  _DATA::gd.flags3 = _DATA::gd.flags3 & 0xfbff;
  _penvMem = env;
  sVar13 = PUBLIC::__setjmp(env);
  if (sVar13 == 0) {
    sVar13 = FOpenFile(dtTurn,-1,0x20);
    if (sVar13 != 0) {
      ReadRt();
      if ((uint)c_common::hdrCur.flags1 >> 10 == 7) {
        puVar21 = (undefined2 *)c_common::rgbCur;
        puVar23 = (undefined2 *)&_DATA::game;
        for (iVar18 = 0x20; iVar18 != 0; iVar18 = iVar18 + -1) {
          puVar5 = puVar23;
          puVar23 = puVar23 + 1;
          puVar4 = puVar21;
          puVar21 = puVar21 + 1;
          *puVar5 = *puVar4;
        }
        _DATA::game.fDirty = 0;
        _DATA::dGal = _DATA::game.mdSize * 400 + 400;
        _DATA::dGalInv = _DATA::game.mdSize * 400 + 0x960;
        iStack_48 = 1000;
        for (i = 0; i < _DATA::game.cPlanMax; i = i + 1) {
          RgFromStream((void *)CONCAT13((char)((uint)unaff_SS >> 8),CONCAT12((char)unaff_SS,&sp)),4)
          ;
          iStack_48 = iStack_48 + (sp.flags1 & 0x3ffU);
          *(int *)((int)c_common::rgptPlan + i * 4) = iStack_48;
          uVar30 = PUBLIC::__aFulshr(uVar31,szEntry._0_2_);
          *(uint *)((int)&c_common::rgptPlan[0].y + i * 4) = (uint)uVar30 & 0xfff;
          uVar30 = PUBLIC::__aFulshr(uVar31,szEntry._0_2_);
          *(uint *)((int)c_common::rgidPlan + i * 2) = (uint)uVar30 & 0x3ff;
          if (((_DATA::dGal + 1000 <= iStack_48) ||
              (_DATA::dGal + 1000 <= *(int *)((int)&c_common::rgptPlan[0].y + i * 4))) ||
             (999 < *(int *)((int)c_common::rgidPlan + i * 2))) goto IO_XYCorrupt;
        }
        ReadRt();
        if ((uint)c_common::hdrCur.flags1 >> 10 == 0) {
          StreamClose();
          if (((*pszExt == 'h') || (*pszExt == 'H')) && ((pszExt[1] == 's' || (pszExt[1] == 'S'))))
          {
            dt = 2;
            iPlayer = -1;
          }
          else {
            dt = 3;
            grf = 0x3000;
            sVar13 = PUBLIC::_atoi(pszExt + 1);
            iPlayer = sVar13 + -1;
          }
          MSG::ResetMessages();
          PUBLIC::_memset((void *)c_common::rgplr,0,_DATA::game.cPlayer * 0xc0);
          MEMORY::ResetHb(htShips);
          _DATA::idPlayer = iPlayer;
          fSilentSav = _DATA::fFileErrSilent;
          _DATA::fFileErrSilent = 1;
          if (iPlayer == -1) {
IO_LNoHistFile:
            cPlanetHist = 0;
            MEMORY::FreeLp(_DATA::lpPlanets,htPlanets);
            _DATA::lpPlanets._0_2_ = 0;
            _DATA::lpPlanets._2_2_ = 0;
            _DATA::cThing = 0;
            MEMORY::FreeLp(_DATA::lpThings,htThings);
            _DATA::lpThings = (THING *)0x0;
          }
          else {
            sVar13 = FOpenFile(dtHist,iPlayer,0x20);
            if (sVar13 == 0) goto IO_LNoHistFile;
            ReadRt();
            uVar19 = c_common::rgbCur._0_2_;
            _DATA::vlpbAiData = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
            _DATA::lpThings = (THING *)CONCAT22(_DATA::lpThings._2_2_,(int)_DATA::lpThings);
            szT._252_4_ = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
            if ((uint)c_common::hdrCur.flags1 >> 10 != 0x20) {
IO_CorruptHist:
              StreamClose();
              sVar13 = 0x10;
              pcVar16 = MSG::PszFormatIds(idsHistoryFileAppearsCorruptHistoricalDataWill,
                                          (short *)0x0);
              UTILGEN::AlertSz(pcVar16,sVar13);
              goto IO_LNoHistFile;
            }
            cPlanetHist = c_common::rgbCur._0_2_;
            cPlanetAlloc = c_common::rgbCur._0_2_ + c_common::rgbCur._2_2_;
            if (1000 < cPlanetAlloc) {
              cPlanetAlloc = 1000;
            }
            iVar18 = cPlanetAlloc;
            if (cPlanetAlloc < 1) {
              iVar18 = 1;
            }
            _DATA::lpPlanets = (PLANET *)MEMORY::LpAlloc(iVar18 * 0x38,htPlanets);
            ReadRt();
            i = 0;
            lppl = _DATA::lpPlanets;
            while( true ) {
              if ((int)uVar19 <= i) break;
              if ((uint)c_common::hdrCur.flags1 >> 10 != 0xe) goto IO_CorruptHist;
              sVar13 = FReadPlanet(iPlayer,lppl,1,0);
              if (sVar13 == 0) goto IO_CorruptHist;
              if (*(int *)((uint)lppl + 2) == iPlayer) {
                *(undefined2 *)((uint)lppl + 2) = 0xffff;
                *(uint *)((uint)lppl + 4) = *(uint *)((uint)lppl + 4) & 0xff00 | 3;
              }
              ReadRt();
              i = i + 1;
              lppl = (PLANET *)CONCAT22(lppl._2_2_,(uint)lppl + 0x38);
            }
            if ((uint)c_common::hdrCur.flags1 >> 10 == 0x21) {
              _DATA::vlpbAiData = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
              _DATA::lpThings = (THING *)CONCAT22(_DATA::lpThings._2_2_,(int)_DATA::lpThings);
              szT._252_4_ = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
              if ((uint)_DATA::cbbitfMsg < (c_common::hdrCur.flags1 & 0x3ffU)) goto IO_CorruptHist;
              PUBLIC::_memcpy((void *)c_common::bitfMsgFiltered,(void *)c_common::rgbCur,
                              c_common::hdrCur.flags1 & 0x3ff);
              ReadRt();
            }
            while ((uint)c_common::hdrCur.flags1 >> 10 == 6) {
              iVar18 = (int)c_common::rgbCur[0];
              ReadRtPlr((PLAYER *)((int)c_common::rgplr + iVar18 * 0xc0),(byte *)c_common::rgbCur);
              *(undefined2 *)((int)&c_common::rgplr[0].cPlanet + iVar18 * 0xc0) = 0;
              szT._254_2_ = *(uint *)((int)&c_common::rgplr[0].flags3 + iVar18 * 0xc0) & 0xf000;
              *(uint *)((int)&c_common::rgplr[0].flags3 + iVar18 * 0xc0) = szT._254_2_;
              ReadRt();
            }
            i = 0;
            while ((uint)c_common::hdrCur.flags1 >> 10 == 0x1a) {
              for (; (*(char *)((int)&c_common::rgplr[0].cShDef + i * 0xc0) == '\0' &&
                     (i < _DATA::game.cPlayer)); i = i + 1) {
              }
              if (i == _DATA::game.cPlayer) break;
              if ((*(int *)(i * 4 + 0xfe) == 0) && (*(int *)(i * 4 + 0x100) == 0)) {
                pvVar25 = MEMORY::LpAlloc(0x930,htShips);
                *(undefined2 *)(i * 4 + 0xfe) = (int)pvVar25;
                *(undefined2 *)(i * 4 + 0x100) = (int)((ulong)pvVar25 >> 0x10);
                for (j = 0; j < 0x10; j = j + 1) {
                  szT._254_2_ = *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) & 0xfdff | 0x200
                  ;
                  *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) = szT._254_2_;
                  *(undefined2 *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x8b) = 0;
                }
              }
              sVar13 = _DATA::idPlayer;
              if (_DATA::idPlayer == -1) {
                _DATA::idPlayer = i;
              }
              else {
                _DATA::idPlayer = -1;
              }
              uVar24 = *(undefined2 *)(i * 4 + 0x100);
              sVar14 = FReadShDef((RTSHDEF *)c_common::rgbCur,
                                  (SHDEF *)CONCAT13((char)((uint)uVar24 >> 8),
                                                    CONCAT12((char)uVar24,
                                                             *(undefined2 *)(i * 4 + 0xfe))),sVar13)
              ;
              _DATA::vlpbAiData = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
              _DATA::lpThings = (THING *)CONCAT22(_DATA::lpThings._2_2_,(int)_DATA::lpThings);
              szT._252_4_ = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
              if (sVar14 == 0) goto IO_CorruptHist;
              pcVar3 = (char *)((int)&c_common::rgplr[0].cShDef + i * 0xc0);
              _DATA::idPlayer = sVar13;
              *pcVar3 = *pcVar3 + -1;
              ReadRt();
            }
            i = 0;
            while ((uint)c_common::hdrCur.flags1 >> 10 == 0x1a) {
              for (; (*(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) >> 0xc == 0 &&
                     (i < _DATA::game.cPlayer)); i = i + 1) {
              }
              if (i == _DATA::game.cPlayer) break;
              if ((*(int *)(i * 4 + 0x14c) == 0) && (*(int *)(i * 4 + 0x14e) == 0)) {
                pvVar25 = MEMORY::LpAlloc(0x5be,htShips);
                *(undefined2 *)(i * 4 + 0x14c) = (int)pvVar25;
                *(undefined2 *)(i * 4 + 0x14e) = (int)((ulong)pvVar25 >> 0x10);
                for (j = 0; j < 10; j = j + 1) {
                  szT._254_2_ = *(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) & 0xfdff |
                                0x200;
                  *(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) = szT._254_2_;
                  *(undefined2 *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x8b) = 0;
                }
              }
              sVar13 = _DATA::idPlayer;
              if (_DATA::idPlayer == -1) {
                _DATA::idPlayer = i;
              }
              else {
                _DATA::idPlayer = -1;
              }
              uVar24 = *(undefined2 *)(i * 4 + 0x14e);
              sVar14 = FReadShDef((RTSHDEF *)c_common::rgbCur,
                                  (SHDEF *)CONCAT13((char)((uint)uVar24 >> 8),
                                                    CONCAT12((char)uVar24,
                                                             *(undefined2 *)(i * 4 + 0x14c))),sVar13
                                 );
              _DATA::vlpbAiData = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
              _DATA::lpThings = (THING *)CONCAT22(_DATA::lpThings._2_2_,(int)_DATA::lpThings);
              szT._252_4_ = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
              if (sVar14 == 0) goto IO_CorruptHist;
              szT._254_2_ = *(int *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) - 0x1000U & 0xf000;
              puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0);
              _DATA::idPlayer = sVar13;
              *puVar2 = *puVar2 & 0xfff;
              puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0);
              *puVar2 = *puVar2 | szT._254_2_;
              ReadRt();
            }
            while( true ) {
              pbVar9 = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
              pbVar28 = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
              if ((uint)c_common::hdrCur.flags1 >> 10 != 0x2d) break;
              szT._254_2_ = c_common::rgbCur._0_2_ & 0x1f;
              puVar23 = (undefined2 *)c_common::rgbCur;
              puVar21 = (undefined2 *)(szT + 0xe6);
              for (iVar18 = 0xc; iVar18 != 0; iVar18 = iVar18 + -1) {
                puVar5 = puVar21;
                puVar21 = puVar21 + 1;
                puVar4 = puVar23;
                puVar23 = puVar23 + 1;
                *puVar5 = *puVar4;
              }
              if ((*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) == 0) &&
                 (*(int *)(szT._254_2_ * 4 + 0x156e) == 0)) {
                pvVar25 = MEMORY::LpAlloc(0x978,htMisc);
                *(undefined2 *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) = (int)pvVar25;
                *(undefined2 *)(szT._254_2_ * 4 + 0x156e) = (int)((ulong)pvVar25 >> 0x10);
                *(undefined2 *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) = 0;
              }
              if ((*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) != 0) ||
                 (*(int *)(szT._254_2_ * 4 + 0x156e) != 0)) {
                if (szT._230_2_ < 0) {
                  szT._226_2_ = szT._232_2_;
                }
                else {
                  szT._226_2_ = _DATA::game.turn;
                }
                szT._228_2_ = 0;
                while ((szT._228_2_ < *(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) &&
                       (*(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) +
                                  szT._228_2_ * 0x18 + 2) < szT._226_2_))) {
                  szT._228_2_ = szT._228_2_ + 1;
                }
                if (((szT._228_2_ < *(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2)) &&
                    (szT._226_2_ !=
                     *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._228_2_ * 0x18
                              + 2))) || (100 < szT._228_2_)) {
                  if (*(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) < 0x65) {
                    uVar24 = *(undefined2 *)(szT._254_2_ * 4 + 0x156e);
                    PUBLIC::__fmemmove((void *)CONCAT22(*(undefined2 *)(szT._254_2_ * 4 + 0x156e),
                                                        *(int *)((int)_DATA::rgsxPlr +
                                                                szT._254_2_ * 4) +
                                                        (szT._228_2_ + 1) * 0x18),
                                       (void *)CONCAT13((char)((uint)uVar24 >> 8),
                                                        CONCAT12((char)uVar24,
                                                                 *(int *)((int)_DATA::rgsxPlr +
                                                                         szT._254_2_ * 4) +
                                                                 szT._228_2_ * 0x18)),
                                       (*(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) -
                                       szT._228_2_) * 0x18);
                    piVar1 = (int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2);
                    *piVar1 = *piVar1 + 1;
                  }
                  else if (0 < szT._228_2_) {
                    if (1 < szT._228_2_) {
                      uVar24 = *(undefined2 *)(szT._254_2_ * 4 + 0x156e);
                      PUBLIC::__fmemmove((void *)CONCAT22(*(undefined2 *)(szT._254_2_ * 4 + 0x156e),
                                                          *(undefined2 *)
                                                           ((int)_DATA::rgsxPlr + szT._254_2_ * 4)),
                                         (void *)CONCAT13((char)((uint)uVar24 >> 8),
                                                          CONCAT12((char)uVar24,
                                                                   *(int *)((int)_DATA::rgsxPlr +
                                                                           szT._254_2_ * 4) + 0x18))
                                         ,(szT._228_2_ + -1) * 0x18);
                    }
                    szT._228_2_ = szT._228_2_ + -1;
                  }
                }
                else if (szT._228_2_ == *(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2)) {
                  piVar1 = (int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2);
                  *piVar1 = *piVar1 + 1;
                }
                uVar24 = *(undefined2 *)(szT._254_2_ * 4 + 0x156e);
                puVar23 = (undefined2 *)
                          (*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._228_2_ * 0x18);
                puVar21 = (undefined2 *)(szT + 0xe6);
                for (iVar18 = 0xc; iVar18 != 0; iVar18 = iVar18 + -1) {
                  puVar5 = puVar23;
                  puVar23 = puVar23 + 1;
                  puVar4 = puVar21;
                  puVar21 = puVar21 + 1;
                  *puVar5 = *puVar4;
                }
                *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._228_2_ * 0x18 + 2)
                     = szT._226_2_;
                szT._224_2_ = *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) +
                                       szT._228_2_ * 0x18) & 0x7fff | 0x8000;
                *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._228_2_ * 0x18) =
                     szT._224_2_;
              }
              ReadRt();
            }
            if ((uint)c_common::hdrCur.flags1 >> 10 == 0x29) {
              if ((*(uint *)((int)&c_common::rgplr[0].flags4 + _DATA::idPlayer * 0xc0) >> 9 & 1) ==
                  0) {
                while( true ) {
                  pbVar9 = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
                  pbVar28 = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
                  if ((uint)c_common::hdrCur.flags1 >> 10 != 0x29) break;
                  ReadRt();
                }
              }
              else {
                _DATA::vlpbAiData = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData)
                ;
                pbVar9 = (byte *)CONCAT22(_DATA::vlpbAiData._2_2_,(int)_DATA::vlpbAiData);
                if (((int)_DATA::vlpbAiData == 0) &&
                   (_DATA::vlpbAiData = pbVar28, pbVar9 = pbVar28, _DATA::vlpbAiData._2_2_ == 0)) {
                  _DATA::vlpbAiData =
                       (byte *)MEMORY::LpAlloc((int)s_R6002___floating_point_support_n_1120_1f8f +
                                               0x11,htMisc);
                  pbVar9 = _DATA::vlpbAiData;
                  if (_DATA::vlpbAiData == (byte *)0x0) goto IO_CorruptHist;
                }
                while (pbVar28 = _DATA::vlpbAiData, (uint)c_common::hdrCur.flags1 >> 10 == 0x29) {
                  szT._252_4_ = pbVar9;
                  PUBLIC::__fmemmove(pbVar9,c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
                  szT._252_2_ = szT._252_2_ + (c_common::hdrCur.flags1 & 0x3ffU);
                  ReadRt();
                  pbVar9 = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
                }
              }
            }
            if ((uint)c_common::hdrCur.flags1 >> 10 == 0x2b) {
              _DATA::cThing = c_common::rgbCur._0_2_;
              _DATA::cThingAlloc = c_common::rgbCur._0_2_ + 10;
              if (4050 < _DATA::cThingAlloc) {
                _DATA::cThingAlloc = 4050;
              }
              _DATA::vlpbAiData = pbVar28;
              szT._252_4_ = pbVar9;
              _DATA::lpThings = (THING *)MEMORY::LpAlloc(_DATA::cThingAlloc * 0x12,htThings);
              if (_DATA::lpThings == (THING *)0x0) goto IO_CorruptHist;
              PUBLIC::__fmemset(_DATA::lpThings,0,_DATA::cThingAlloc * 0x12);
              ReadRt();
              lpth = _DATA::lpThings;
              pbVar9 = szT._252_4_;
              for (i = 0; pbVar28 = _DATA::vlpbAiData, i < _DATA::cThing; i = i + 1) {
                szT._252_4_ = pbVar9;
                if ((uint)c_common::hdrCur.flags1 >> 10 != 0x2b) goto IO_CorruptHist;
                PUBLIC::__fmemcpy(lpth,c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
                ReadRt();
                lpth = (THING *)CONCAT22(lpth._2_2_,(uint)lpth + 0x12);
                pbVar9 = szT._252_4_;
              }
            }
            _DATA::vlpbAiData = pbVar28;
            szT._252_4_ = pbVar9;
            StreamClose();
          }
          _DATA::fFileErrSilent = fSilentSav;
          GetFileStatus(dt,iPlayer);
          sVar13 = FOpenFile(dt | grf,iPlayer,0x20);
          if (sVar13 != 0) {
            if (iPlayer == -1) {
              szT._252_4_ = (byte *)(CONCAT22((uint)c_common::rgbCur._14_2_ >> 0xb,szT._252_2_) &
                                    0x1ffff);
              _DATA::gd.flags2 =
                   _DATA::gd.flags2 & 0xfffeU | (uint)c_common::rgbCur._14_2_ >> 0xb & 1;
            }
            do {
              cturn = cturn + 1;
              c_common::cPlanet = 0;
              c_common::cFleet = 0;
              ReadRt();
              while (((uint)c_common::hdrCur.flags1 >> 10 == 0x1f ||
                     ((uint)c_common::hdrCur.flags1 >> 10 == 0x27))) {
                if ((uint)c_common::hdrCur.flags1 >> 10 != 0x27) {
                  if (_DATA::lpbBattleLog == (byte *)0x0) {
                    _DATA::lpbBattleCur = (byte *)MEMORY::LpAlloc(0xffc8,htBattle);
                    _DATA::lpbBattleLog = _DATA::lpbBattleCur;
                  }
                  if (((uint)_DATA::lpbBattleCur < 0xffc9) &&
                     (-(uint)_DATA::lpbBattleCur - 0x38 < c_common::rgbCur._6_2_)) {
                    *(undefined2 *)_DATA::lpbBattleCur = 0xffff;
                    _DATA::lpbBattleCur = (byte *)MEMORY::LpAlloc(0xffc8,htBattle);
                  }
                }
                PUBLIC::__fmemmove(_DATA::lpbBattleCur,c_common::rgbCur,
                                   c_common::hdrCur.flags1 & 0x3ff);
                _DATA::lpbBattleCur =
                     (byte *)CONCAT22(_DATA::lpbBattleCur._2_2_,
                                      (uint)_DATA::lpbBattleCur + (c_common::hdrCur.flags1 & 0x3ffU)
                                     );
                ReadRt();
              }
              if ((((uint)_DATA::lpbBattleCur != 0) || (_DATA::lpbBattleCur._2_2_ != 0)) &&
                 (*(undefined2 *)_DATA::lpbBattleCur = 0xffff, (_DATA::wVersFile >> 5 & 0x7f) < 0x50
                 )) {
                UpdateBattleRecords();
              }
              while ((uint)c_common::hdrCur.flags1 >> 10 == 6) {
                iVar18 = (int)c_common::rgbCur[0];
                ReadRtPlr((PLAYER *)((int)c_common::rgplr + iVar18 * 0xc0),(byte *)c_common::rgbCur)
                ;
                c_common::cPlanet =
                     c_common::cPlanet + *(int *)((int)&c_common::rgplr[0].cPlanet + iVar18 * 0xc0);
                *(undefined2 *)((int)&c_common::rgplr[0].cPlanet + iVar18 * 0xc0) = 0;
                c_common::cFleet =
                     c_common::cFleet +
                     (*(uint *)((int)&c_common::rgplr[0].flags3 + iVar18 * 0xc0) & 0xfff);
                szT._254_2_ = *(uint *)((int)&c_common::rgplr[0].flags3 + iVar18 * 0xc0) & 0xf000;
                *(uint *)((int)&c_common::rgplr[0].flags3 + iVar18 * 0xc0) = szT._254_2_;
                ReadRt();
              }
              if (dt == 2) {
                if ((uint)c_common::hdrCur.flags1 >> 10 == 0x24) {
                  _DATA::lSaltCur._0_2_ = c_common::rgbCur._0_2_;
                  _DATA::lSaltCur._2_2_ = c_common::rgbCur._2_2_;
                  ReadRt();
                }
                else {
                  _DATA::lSaltCur._0_2_ = 0;
                  _DATA::lSaltCur._2_2_ = 0;
                }
              }
              else {
                _DATA::lSaltCur._0_2_ = *(uint *)((int)&c_common::rgplr[0].lSalt + iPlayer * 0xc0);
                _DATA::lSaltCur._2_2_ =
                     *(undefined2 *)((int)&c_common::rgplr[0].lSalt + 2 + iPlayer * 0xc0);
              }
              sVar13 = UTILGEN::FCheckPassword();
              if (sVar13 == 0) {
                if ((((uint)c_common::ini.flags6 >> 0xe & 1) != 0) || (c_common::ini.flags6 < 0)) {
                  sVar13 = 0x10;
                  pcVar16 = MSG::PszFormatIds(idsPasswordHaveEnteredIncorrectPleaseTry,(short *)0x0)
                  ;
                  UTILGEN::AlertSz(pcVar16,sVar13);
                }
                break;
              }
              MSG::ReadPlayerMessages();
              MEMORY::ResetHb(htFleets);
              MEMORY::ResetHb(htOrd);
              MEMORY::FreeLp(_DATA::rglpfl,htMisc);
              _DATA::rglpfl._0_2_ = 0;
              _DATA::rglpfl._2_2_ = 0;
              lppl = _DATA::lpPlanets;
              if (_DATA::lpPlanets == (PLANET *)0x0) {
                cPlanetAlloc = c_common::cPlanet;
                if (c_common::cPlanet < 1) {
                  cPlanetAlloc = 1;
                }
                pvVar25 = MEMORY::LpAlloc(cPlanetAlloc * 0x38,htPlanets);
                    /* WARNING: Ignoring partial resolution of indirect */
                _DATA::lpPlanets._0_2_ = (int)pvVar25;
                    /* WARNING: Ignoring partial resolution of indirect */
                _DATA::lpPlanets._2_2_ = (int)((ulong)pvVar25 >> 0x10);
                lppl = _DATA::lpPlanets;
              }
              j = 0;
              _DATA::lpPlanets = lppl;
              for (i = 0; i < c_common::cPlanet; i = i + 1) {
                fHaveHistoryData = 0;
                if (cPlanetHist != 0) {
                  while ((j < cPlanetHist && (lppl->id < (int)(c_common::rgbCur._0_2_ << 5) >> 5)))
                  {
                    j = j + 1;
                    lppl = (PLANET *)CONCAT22(lppl._2_2_,(uint)lppl + 0x38);
                  }
                  if ((j < cPlanetHist) && ((int)(c_common::rgbCur._0_2_ << 5) >> 5 == lppl->id)) {
                    fHaveHistoryData = 1;
                  }
                  else {
                    if (cPlanetAlloc == cPlanetHist) {
                      cPlanetAlloc = cPlanetAlloc + 8;
                      pvVar25 = MEMORY::LpReAlloc(_DATA::lpPlanets,cPlanetAlloc * 0x38,htPlanets);
                    /* WARNING: Ignoring partial resolution of indirect */
                      _DATA::lpPlanets._0_2_ = (int)pvVar25;
                    /* WARNING: Ignoring partial resolution of indirect */
                      _DATA::lpPlanets._2_2_ = (int)((ulong)pvVar25 >> 0x10);
                      lppl = (PLANET *)
                             CONCAT22(_DATA::lpPlanets._2_2_,(int)_DATA::lpPlanets + j * 0x38);
                    }
                    if (j < cPlanetHist) {
                      PUBLIC::__fmemmove((void *)CONCAT22(lppl._2_2_,(uint)lppl + 0x38),lppl,
                                         (cPlanetHist - j) * 0x38);
                    }
                    cPlanetHist = cPlanetHist + 1;
                  }
                }
                sVar14 = FReadPlanet(iPlayer,lppl,0,fHaveHistoryData);
                sVar13 = _DATA::idPlayer;
                if (sVar14 == 0) goto IO_Corrupt_2;
                if (*(int *)((uint)lppl + 2) != -1) {
                  piVar1 = (int *)((int)&c_common::rgplr[0].cPlanet +
                                  *(int *)((uint)lppl + 2) * 0xc0);
                  *piVar1 = *piVar1 + 1;
                }
                ReadRt();
                if ((uint)c_common::hdrCur.flags1 >> 10 == 0x1c) {
                  if ((*(int *)((uint)lppl + 0x34) != 0) ||
                     (pbVar28 = szT._252_4_, *(int *)((uint)lppl + 0x36) != 0)) {
                    uVar8 = *(undefined4 *)((uint)lppl + 0x34);
                    bVar6 = *(byte *)((int)uVar8 + 2);
                    szT._254_2_ = (uint)bVar6;
                    pbVar28 = (byte *)(ulong)CONCAT12(bVar6,szT._252_2_);
                    if (szT._254_2_ <= (c_common::hdrCur.flags1 & 0x3ffU) / 4) {
                      MEMORY::FreePl((PL *)CONCAT22(*(undefined2 *)((uint)lppl + 0x36),
                                                    *(undefined2 *)((uint)lppl + 0x34)));
                      *(undefined2 *)((uint)lppl + 0x34) = 0;
                      *(undefined2 *)((uint)lppl + 0x36) = 0;
                      pbVar28 = (byte *)CONCAT22(szT._254_2_,szT._252_2_);
                    }
                  }
                  if ((*(int *)((uint)lppl + 0x34) == 0) && (*(int *)((uint)lppl + 0x36) == 0)) {
                    szT._252_4_ = pbVar28;
                    pPVar26 = MEMORY::LpplAlloc(4,(c_common::hdrCur.flags1 & 0x3ffU) / 4 + 2,htOrd);
                    *(undefined2 *)((uint)lppl + 0x34) = (int)pPVar26;
                    *(undefined2 *)((uint)lppl + 0x36) = (int)((ulong)pPVar26 >> 0x10);
                    pbVar28 = szT._252_4_;
                  }
                  szT._252_4_ = pbVar28;
                  PUBLIC::__fmemmove((void *)CONCAT22(*(undefined2 *)((uint)lppl + 0x36),
                                                      *(int *)((uint)lppl + 0x34) + 4),
                                     c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
                  uVar8 = *(undefined4 *)((uint)lppl + 0x34);
                  *(undefined *)((int)uVar8 + 3) =
                       (char)((ulong)(c_common::hdrCur.flags1 & 0x3ff) / 4);
                  ReadRt();
                }
                if (cPlanetHist == 0) {
                  lppl = (PLANET *)CONCAT22(lppl._2_2_,(uint)lppl + 0x38);
                }
              }
              if (cPlanetHist != 0) {
                c_common::cPlanet = cPlanetHist;
              }
              i = 0;
              pbVar28 = szT._252_4_;
              while( true ) {
                szT._254_2_ = (uint)((ulong)pbVar28 >> 0x10);
                szT._252_2_ = (uint)pbVar28;
                if (_DATA::game.cPlayer <= i) break;
                if (i == iPlayer) {
                  *(undefined2 *)(i * 4 + 0xfe) = 0x3f00;
                  *(undefined2 *)(i * 4 + 0x100) = 0x1120;
IO_FreeShdef:
                  szT._254_2_ = (uint)((ulong)pbVar28 >> 0x10);
                  szT._252_2_ = (uint)pbVar28;
                  for (j = 0; pbVar28 = (byte *)CONCAT22(szT._254_2_,szT._252_2_), j < 0x10;
                      j = j + 1) {
                    szT._254_2_ = *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) & 0xfdff |
                                  0x200;
                    *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) = szT._254_2_;
                    *(undefined2 *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x8b) = 0;
                  }
LAB_1070_1c2c:
                  sVar14 = _DATA::idPlayer;
                  if (_DATA::idPlayer == -1) {
                    _DATA::idPlayer = i;
                  }
                  else if (i != _DATA::idPlayer) {
                    _DATA::idPlayer = -1;
                  }
                  szT._252_4_ = pbVar28;
                  for (j = 0; pbVar28 = szT._252_4_,
                      j < *(char *)((int)&c_common::rgplr[0].cShDef + i * 0xc0); j = j + 1) {
                    sVar13 = sVar14;
                    if ((uint)c_common::hdrCur.flags1 >> 10 != 0x1a) goto IO_Corrupt_2;
                    uVar24 = *(undefined2 *)(i * 4 + 0x100);
                    sVar15 = FReadShDef((RTSHDEF *)c_common::rgbCur,
                                        (SHDEF *)CONCAT13((char)((uint)uVar24 >> 8),
                                                          CONCAT12((char)uVar24,
                                                                   *(undefined2 *)(i * 4 + 0xfe))),
                                        sVar14);
                    sVar13 = _DATA::idPlayer;
                    if (sVar15 == 0) goto IO_Corrupt_2;
                    ReadRt();
                  }
                }
                else {
                  sVar14 = _DATA::idPlayer;
                  if ((*(uint *)((int)&c_common::rgplr[0].flags4 + i * 0xc0) >> 8 & 1) != 0) {
                    if ((*(int *)(i * 4 + 0xfe) == 0) && (*(int *)(i * 4 + 0x100) == 0)) {
                      szT._252_4_ = pbVar28;
                      pvVar25 = MEMORY::LpAlloc(0x930,htShips);
                      *(undefined2 *)(i * 4 + 0xfe) = (int)pvVar25;
                      *(undefined2 *)(i * 4 + 0x100) = (int)((ulong)pvVar25 >> 0x10);
                      pbVar28 = szT._252_4_;
                      goto IO_FreeShdef;
                    }
                    goto LAB_1070_1c2c;
                  }
                }
                _DATA::idPlayer = sVar14;
                i = i + 1;
              }
              for (i = 0; i < _DATA::game.cPlayer; i = i + 1) {
                *(undefined *)((int)&c_common::rgplr[0].cShDef + i * 0xc0) = 0;
                if ((*(int *)(i * 4 + 0xfe) != 0) || (*(int *)(i * 4 + 0x100) != 0)) {
                  for (j = 0; j < 0x10; j = j + 1) {
                    if ((*(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) >> 9 & 1) == 0) {
                      if (((i == _DATA::idPlayer) || (((uint)_DATA::gd.flags1 >> 1 & 1) != 0)) ||
                         ((*(uint *)((int)&c_common::rgplr[0].flags43 + i * 0xc0) & 1) == 0)) {
                        pcVar3 = (char *)((int)&c_common::rgplr[0].cShDef + i * 0xc0);
                        *pcVar3 = *pcVar3 + '\x01';
                      }
                      else {
                        szT._254_2_ = *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) & 0xfdff |
                                      0x200;
                        *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) = szT._254_2_;
                      }
                    }
                  }
                }
              }
              iVar18 = c_common::cFleet;
              if (c_common::cFleet < 1) {
                iVar18 = 1;
              }
              _DATA::rglpfl = (FLEET **)MEMORY::LpAlloc(iVar18 << 2,htMisc);
              for (i = 0; i < c_common::cFleet; i = i + 1) {
                lpfl_00 = (FLEET *)MEMORY::LpAlloc(0x7c,htFleets);
                uVar24 = _DATA::rglpfl._2_2_;
                iVar20 = (int)((ulong)lpfl_00 >> 0x10);
                iVar18 = (int)lpfl_00;
                piVar22 = (int *)((int)_DATA::rglpfl + i * 4);
                *piVar22 = iVar18;
                piVar22[1] = iVar20;
                sVar13 = FReadFleet(lpfl_00);
                if (sVar13 == 0) goto IO_LError_2;
                szT._254_2_ = *(int *)((int)&c_common::rgplr[0].flags3 + *(int *)(iVar18 + 2) * 0xc0
                                      ) + 1U & 0xfff;
                puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + *(int *)(iVar18 + 2) * 0xc0);
                *puVar2 = *puVar2 & 0xf000;
                puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + *(int *)(iVar18 + 2) * 0xc0);
                *puVar2 = *puVar2 | szT._254_2_;
              }
              for (i = 0; i < _DATA::game.cPlayer; i = i + 1) {
                sVar14 = _DATA::idPlayer;
                if ((*(uint *)((int)&c_common::rgplr[0].flags4 + i * 0xc0) >> 8 & 1) != 0) {
                  if ((*(int *)(i * 4 + 0x14c) == 0) && (*(int *)(i * 4 + 0x14e) == 0)) {
                    pvVar25 = MEMORY::LpAlloc(0x5be,htShips);
                    *(undefined2 *)(i * 4 + 0x14c) = (int)pvVar25;
                    *(undefined2 *)(i * 4 + 0x14e) = (int)((ulong)pvVar25 >> 0x10);
                    for (j = 0; j < 10; j = j + 1) {
                      szT._254_2_ = *(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) & 0xfdff |
                                    0x200;
                      *(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) = szT._254_2_;
                      *(undefined2 *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x8b) = 0;
                    }
                  }
                  sVar14 = _DATA::idPlayer;
                  if (_DATA::idPlayer == -1) {
                    _DATA::idPlayer = i;
                  }
                  else if (i != _DATA::idPlayer) {
                    _DATA::idPlayer = -1;
                  }
                  for (j = 0; j < (int)(*(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) >> 0xc
                                       ); j = j + 1) {
                    sVar13 = sVar14;
                    if ((uint)c_common::hdrCur.flags1 >> 10 != 0x1a) goto IO_Corrupt_2;
                    uVar24 = *(undefined2 *)(i * 4 + 0x14e);
                    sVar15 = FReadShDef((RTSHDEF *)c_common::rgbCur,
                                        (SHDEF *)CONCAT13((char)((uint)uVar24 >> 8),
                                                          CONCAT12((char)uVar24,
                                                                   *(undefined2 *)(i * 4 + 0x14c))),
                                        sVar14);
                    sVar13 = _DATA::idPlayer;
                    if (sVar15 == 0) goto IO_Corrupt_2;
                    ReadRt();
                  }
                }
                _DATA::idPlayer = sVar14;
              }
              pSVar27 = _DATA::vlprgScoreX;
              for (i = 0; _DATA::vlprgScoreX = pSVar27, i < _DATA::game.cPlayer; i = i + 1) {
                szT._254_2_ = *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) & 0xfff;
                *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) = szT._254_2_;
                if ((*(int *)(i * 4 + 0x14c) != 0) ||
                   (pSVar27 = _DATA::vlprgScoreX, *(int *)(i * 4 + 0x14e) != 0)) {
                  for (j = 0; pSVar27 = _DATA::vlprgScoreX, j < 10; j = j + 1) {
                    if ((*(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) >> 9 & 1) == 0) {
                      if (((i == _DATA::idPlayer) || (((uint)_DATA::gd.flags1 >> 1 & 1) != 0)) ||
                         ((*(uint *)((int)&c_common::rgplr[0].flags43 + i * 0xc0) & 1) == 0)) {
                        szT._254_2_ = *(int *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) + 0x1000U
                                      & 0xf000;
                        puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0);
                        *puVar2 = *puVar2 & 0xfff;
                        puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0);
                        *puVar2 = *puVar2 | szT._254_2_;
                      }
                      else {
                        szT._254_2_ = *(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) & 0xfdff
                                      | 0x200;
                        *(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) = szT._254_2_;
                      }
                    }
                  }
                }
              }
              if (pSVar27 == (SCOREX *)0x0) {
                pSVar27 = (SCOREX *)MEMORY::LpAlloc(_DATA::game.cPlayer * 0x18,htMisc);
                _DATA::vlprgScoreX = pSVar27;
                PUBLIC::__fmemset(pSVar27,0,_DATA::game.cPlayer * 0x18);
                pSVar27 = _DATA::vlprgScoreX;
              }
              while( true ) {
                _DATA::vlprgScoreX._2_2_ = (undefined2)((ulong)pSVar27 >> 0x10);
                uVar24 = _DATA::vlprgScoreX._2_2_;
                _DATA::vlprgScoreX._0_2_ = (int)pSVar27;
                _DATA::vlprgScoreX = pSVar27;
                if ((uint)c_common::hdrCur.flags1 >> 10 != 0x2d) break;
                szT._254_2_ = c_common::rgbCur._0_2_ & 0x1f;
                puVar23 = (undefined2 *)((int)_DATA::vlprgScoreX + szT._254_2_ * 0x18);
                puVar21 = (undefined2 *)c_common::rgbCur;
                for (iVar18 = 0xc; iVar18 != 0; iVar18 = iVar18 + -1) {
                  puVar5 = puVar23;
                  puVar23 = puVar23 + 1;
                  puVar4 = puVar21;
                  puVar21 = puVar21 + 1;
                  *puVar5 = *puVar4;
                }
                pSVar27 = _DATA::vlprgScoreX;
                if ((*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) == 0) &&
                   (*(int *)(szT._254_2_ * 4 + 0x156e) == 0)) {
                  pvVar25 = MEMORY::LpAlloc(0x978,htMisc);
                  *(undefined2 *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) = (int)pvVar25;
                  *(undefined2 *)(szT._254_2_ * 4 + 0x156e) = (int)((ulong)pvVar25 >> 0x10);
                  *(undefined2 *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) = 0;
                  pSVar27 = _DATA::vlprgScoreX;
                }
                _DATA::vlprgScoreX._2_2_ = (undefined2)((ulong)pSVar27 >> 0x10);
                _DATA::vlprgScoreX._0_2_ = (int)pSVar27;
                if ((*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) != 0) ||
                   (*(int *)(szT._254_2_ * 4 + 0x156e) != 0)) {
                  if (*(int *)((int)_DATA::vlprgScoreX + szT._254_2_ * 0x18) < 0) {
                    szT._250_2_ = *(uint *)((int)_DATA::vlprgScoreX + szT._254_2_ * 0x18 + 2);
                  }
                  else {
                    szT._250_2_ = _DATA::game.turn;
                  }
                  szT._252_2_ = 0;
                  while (((int)szT._252_2_ < *(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) &&
                         (*(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) +
                                    szT._252_2_ * 0x18 + 2) < szT._250_2_))) {
                    szT._252_2_ = szT._252_2_ + 1;
                  }
                  _DATA::vlprgScoreX = pSVar27;
                  if ((((int)szT._252_2_ < *(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2)) &&
                      (szT._250_2_ !=
                       *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) +
                                 szT._252_2_ * 0x18 + 2))) || (100 < (int)szT._252_2_)) {
                    if (*(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) < 0x65) {
                      uVar24 = *(undefined2 *)(szT._254_2_ * 4 + 0x156e);
                      PUBLIC::__fmemmove((void *)CONCAT22(*(undefined2 *)(szT._254_2_ * 4 + 0x156e),
                                                          *(int *)((int)_DATA::rgsxPlr +
                                                                  szT._254_2_ * 4) +
                                                          (szT._252_2_ + 1) * 0x18),
                                         (void *)CONCAT13((char)((uint)uVar24 >> 8),
                                                          CONCAT12((char)uVar24,
                                                                   *(int *)((int)_DATA::rgsxPlr +
                                                                           szT._254_2_ * 4) +
                                                                   szT._252_2_ * 0x18)),
                                         (*(int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2) -
                                         szT._252_2_) * 0x18);
                      piVar1 = (int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2);
                      *piVar1 = *piVar1 + 1;
                      pSVar27 = _DATA::vlprgScoreX;
                    }
                    else if (0 < (int)szT._252_2_) {
                      if (1 < (int)szT._252_2_) {
                        uVar24 = *(undefined2 *)(szT._254_2_ * 4 + 0x156e);
                        PUBLIC::__fmemmove((void *)CONCAT22(*(undefined2 *)
                                                             (szT._254_2_ * 4 + 0x156e),
                                                            *(undefined2 *)
                                                             ((int)_DATA::rgsxPlr + szT._254_2_ * 4)
                                                           ),
                                           (void *)CONCAT13((char)((uint)uVar24 >> 8),
                                                            CONCAT12((char)uVar24,
                                                                     *(int *)((int)_DATA::rgsxPlr +
                                                                             szT._254_2_ * 4) + 0x18
                                                                    )),(szT._252_2_ - 1) * 0x18);
                        pSVar27 = _DATA::vlprgScoreX;
                      }
                      szT._252_2_ = szT._252_2_ - 1;
                    }
                  }
                  else if (szT._252_2_ == *(uint *)((int)c_common::rgcsxPlr + szT._254_2_ * 2)) {
                    piVar1 = (int *)((int)c_common::rgcsxPlr + szT._254_2_ * 2);
                    *piVar1 = *piVar1 + 1;
                    pSVar27 = _DATA::vlprgScoreX;
                  }
                  _DATA::vlprgScoreX._2_2_ = (undefined2)((ulong)pSVar27 >> 0x10);
                  uVar12 = _DATA::vlprgScoreX._2_2_;
                  _DATA::vlprgScoreX._0_2_ = (int)pSVar27;
                  puVar21 = (undefined2 *)((int)_DATA::vlprgScoreX + szT._254_2_ * 0x18);
                  uVar24 = *(undefined2 *)(szT._254_2_ * 4 + 0x156e);
                  puVar23 = (undefined2 *)
                            (*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._252_2_ * 0x18);
                  _DATA::vlprgScoreX = pSVar27;
                  for (iVar18 = 0xc; iVar18 != 0; iVar18 = iVar18 + -1) {
                    puVar5 = puVar23;
                    puVar23 = puVar23 + 1;
                    puVar4 = puVar21;
                    puVar21 = puVar21 + 1;
                    *puVar5 = *puVar4;
                  }
                  *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._252_2_ * 0x18 + 2
                           ) = szT._250_2_;
                  szT._248_2_ = *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) +
                                         szT._252_2_ * 0x18) & 0x7fff | 0x8000;
                  *(uint *)(*(int *)((int)_DATA::rgsxPlr + szT._254_2_ * 4) + szT._252_2_ * 0x18) =
                       szT._248_2_;
                  pSVar27 = _DATA::vlprgScoreX;
                }
                _DATA::vlprgScoreX = pSVar27;
                ReadRt();
                pSVar27 = _DATA::vlprgScoreX;
              }
              if (_DATA::lpThings != (THING *)0x0) {
                MEMORY::FreeLp(_DATA::lpThings,htThings);
                    /* WARNING: Ignoring partial resolution of indirect */
                _DATA::lpThings._0_2_ = 0;
                    /* WARNING: Ignoring partial resolution of indirect */
                _DATA::lpThings._2_2_ = 0;
                _DATA::cThing = 0;
                pSVar27 = _DATA::vlprgScoreX;
              }
              _DATA::vlprgScoreX = pSVar27;
              if ((uint)c_common::hdrCur.flags1 >> 10 == 0x2b) {
                szT._252_2_ = (uint)(0 < _DATA::cThing);
                szT._254_2_ = c_common::rgbCur._0_2_;
                _DATA::cThingAlloc = c_common::rgbCur._0_2_;
                if ((int)c_common::rgbCur._0_2_ < 10) {
                  _DATA::cThingAlloc = 10;
                }
                if (_DATA::lpThings == (THING *)0x0) {
                  pvVar25 = MEMORY::LpAlloc(_DATA::cThingAlloc * 0x12,htThings);
                    /* WARNING: Ignoring partial resolution of indirect */
                  _DATA::lpThings._0_2_ = (int)pvVar25;
                    /* WARNING: Ignoring partial resolution of indirect */
                  _DATA::lpThings._2_2_ = (int)((ulong)pvVar25 >> 0x10);
                  if (_DATA::lpThings == (THING *)0x0) break;
                  PUBLIC::__fmemset(_DATA::lpThings,0,_DATA::cThingAlloc * 0x12);
                  pSVar27 = _DATA::vlprgScoreX;
                }
                _DATA::vlprgScoreX = pSVar27;
                ReadRt();
                lpth = _DATA::lpThings;
                j = 0;
                for (i = 0; i < (int)szT._254_2_; i = i + 1) {
                  if (szT._252_2_ == 0) {
LAB_1070_270b:
                    _DATA::cThing = _DATA::cThing + 1;
                  }
                  else {
                    while ((j < _DATA::cThing && (*(uint *)lpth < c_common::rgbCur._0_2_))) {
                      j = j + 1;
                      lpth = (THING *)CONCAT22(lpth._2_2_,(uint)lpth + 0x12);
                    }
                    if ((_DATA::cThing <= j) || (c_common::rgbCur._0_2_ != *(uint *)lpth)) {
                      if (_DATA::cThingAlloc == _DATA::cThing) {
                        _DATA::cThingAlloc = _DATA::cThingAlloc + 8;
                        pvVar25 = MEMORY::LpReAlloc(_DATA::lpThings,_DATA::cThingAlloc * 0x12,
                                                    htThings);
                    /* WARNING: Ignoring partial resolution of indirect */
                        _DATA::lpThings._0_2_ = (int)pvVar25;
                    /* WARNING: Ignoring partial resolution of indirect */
                        _DATA::lpThings._2_2_ = (int)((ulong)pvVar25 >> 0x10);
                        lpth = (THING *)CONCAT22(_DATA::lpThings._2_2_,
                                                 (int)_DATA::lpThings + j * 0x12);
                      }
                      if (j < _DATA::cThing) {
                        PUBLIC::__fmemmove((void *)CONCAT22(lpth._2_2_,(uint)lpth + 0x12),lpth,
                                           (_DATA::cThing - j) * 0x12);
                        PUBLIC::__fmemset(lpth,0,0x12);
                      }
                      goto LAB_1070_270b;
                    }
                  }
                  PUBLIC::__fmemcpy(lpth,c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
                  *(short *)((uint)lpth + 0x10) = _DATA::game.turn;
                  lpth = (THING *)CONCAT22(lpth._2_2_,(uint)lpth + 0x12);
                  j = j + 1;
                  ReadRt();
                }
              }
              else {
                _DATA::cThing = 0;
                _DATA::cThingAlloc = 10;
                pvVar25 = MEMORY::LpAlloc(0xb4,htThings);
                    /* WARNING: Ignoring partial resolution of indirect */
                _DATA::lpThings._0_2_ = (int)pvVar25;
                    /* WARNING: Ignoring partial resolution of indirect */
                _DATA::lpThings._2_2_ = (int)((ulong)pvVar25 >> 0x10);
              }
              if ((uint)c_common::hdrCur.flags1 >> 10 == 0x16) {
                ReadRt();
              }
              while (sVar13 = _DATA::idPlayer, (uint)c_common::hdrCur.flags1 >> 10 == 0x1e) {
                _DATA::idPlayer = c_common::rgbCur._0_2_ & 0xf;
                szT._254_2_ = _DATA::idPlayer;
                if ((*(int *)((int)c_common::rglpbtlplan + _DATA::idPlayer * 4) == 0) &&
                   (*(int *)((int)&DAT_1120_593a + _DATA::idPlayer * 4) == 0)) {
                  pvVar25 = MEMORY::LpAlloc(0x240,htShips);
                  *(undefined2 *)((int)c_common::rglpbtlplan + szT._254_2_ * 4) = (int)pvVar25;
                  *(undefined2 *)((int)&DAT_1120_593a + szT._254_2_ * 4) =
                       (int)((ulong)pvVar25 >> 0x10);
                }
                uVar24 = *(undefined2 *)((int)&DAT_1120_593a + szT._254_2_ * 4);
                UnpackBattlePlan((byte *)c_common::rgbCur,
                                 (BTLPLAN *)
                                 CONCAT13((char)((uint)uVar24 >> 8),
                                          CONCAT12((char)uVar24,
                                                   *(int *)((int)c_common::rglpbtlplan +
                                                           szT._254_2_ * 4) +
                                                   (uint)*(byte *)((int)c_common::rgcbtlplan +
                                                                  szT._254_2_) * 0x24)),
                                 (uint)*(byte *)((int)c_common::rgcbtlplan + szT._254_2_));
                pcVar3 = (char *)((int)c_common::rgcbtlplan + szT._254_2_);
                *pcVar3 = *pcVar3 + '\x01';
                ReadRt();
                _DATA::idPlayer = sVar13;
              }
              if ((uint)c_common::hdrCur.flags1 >> 10 != 0) {
IO_Corrupt_2:
                _DATA::idPlayer = sVar13;
                sVar13 = 0x10;
                pcVar16 = MSG::PszFormatIds(idsGameFileAppearsCorruptUnableLoadFile,(short *)0x0);
                UTILGEN::AlertSz(pcVar16,sVar13);
                break;
              }
              szT._252_4_ = (byte *)PUBLIC::__filelength(_DATA::hf);
              pbVar28 = (byte *)PUBLIC::__tell(_DATA::hf);
              if (pbVar28 == szT._252_4_) goto LAB_1070_2a56;
              ReadRt();
              if ((uint)c_common::hdrCur.flags1 >> 10 != 8) goto LAB_1070_2a35;
              _DATA::game.turn = c_common::rgbCur._10_2_;
              _DATA::game.flags9 =
                   _DATA::game.flags9 & 0xf1ffU | ((uint)c_common::rgbCur._14_2_ >> 0xd) << 9;
              i = 0;
              lppl = _DATA::lpPlanets;
              while( true ) {
                _DATA::lpPlanets._2_2_ = (uint)((ulong)lppl >> 0x10);
                _DATA::lpPlanets._0_2_ = (int)lppl;
                _DATA::lpPlanets = lppl;
                if (_DATA::game.cPlayer <= i) break;
                *(undefined *)((int)&c_common::rgplr[0].cShDef + i * 0xc0) = 0;
                *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) =
                     *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) & 0xf000;
                *(undefined2 *)((int)&c_common::rgplr[0].cPlanet + i * 0xc0) = 0;
                *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) =
                     *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) & 0xfff;
                *(undefined *)((int)c_common::rgcbtlplan + i) = 0;
                i = i + 1;
                lppl = _DATA::lpPlanets;
              }
              szT._252_2_ = (int)_DATA::lpPlanets;
              szT._254_2_ = _DATA::lpPlanets._2_2_;
              uVar19 = (int)_DATA::lpPlanets + c_common::cPlanet * 0x38;
              while( true ) {
                if (uVar19 <= (uint)lppl) break;
                uVar24 = (undefined2)((ulong)lppl >> 0x10);
                if (*(int *)((uint)lppl + 2) == iPlayer) {
                  *(undefined2 *)((uint)lppl + 2) = 0xffff;
                  *(uint *)((uint)lppl + 4) = *(uint *)((uint)lppl + 4) & 0xff00 | 3;
                  if ((*(int *)((uint)lppl + 0x34) != 0) || (*(int *)((uint)lppl + 0x36) != 0)) {
                    MEMORY::FreePl((PL *)CONCAT22(*(undefined2 *)((uint)lppl + 0x36),
                                                  *(undefined2 *)((uint)lppl + 0x34)));
                    *(undefined2 *)((uint)lppl + 0x34) = 0;
                    *(undefined2 *)((uint)lppl + 0x36) = 0;
                  }
                }
                lppl = (PLANET *)CONCAT22(uVar24,(uint)lppl + 0x38);
              }
              cPlanetHist = c_common::cPlanet;
            } while( true );
          }
          goto IO_LError_2;
        }
      }
IO_XYCorrupt:
      sVar13 = 0x10;
      pcVar16 = MSG::PszFormatIds(idsUniverseDefinitionFileSeemsMissingCorrupt,(short *)0x0);
      UTILGEN::AlertSz(pcVar16,sVar13);
    }
  }
IO_LError_2:
  _DATA::game.fDirty = 0;
  DestroyCurGame();
  StreamClose();
  if (((((uint)c_common::ini.flags6 >> 0xe & 1) == 0) && (-1 < c_common::ini.flags6)) &&
     (_DATA::hwndTitle == 0)) {
    sVar13 = GetSystemMetrics(0);
    szT._252_2_ = sVar13;
    szT._254_2_ = GetSystemMetrics(1);
    _DATA::hwndTitle =
         CreateWindow(_DATA::szTitle,(LPCSTR)0x11200752,0x90000000,0,0,szT._252_2_,szT._254_2_,
                      c_common::hwndFrame,0,c_common::hInst,(void *)0x0);
    _DATA::fFreeingTitle = 0;
    ShowWindow(c_common::hwndFrame,0);
  }
  sVar13 = 0;
  pbVar28 = _DATA::vlpbAiData;
  pTVar10 = _DATA::lpThings;
  pPVar29 = _DATA::lpPlanets;
  ppFVar11 = _DATA::rglpfl;
  pSVar27 = _DATA::vlprgScoreX;
  pbVar9 = _DATA::lpbBattleLog;
LAB_1070_3200:
  _DATA::lpbBattleLog._2_2_ = (undefined2)((ulong)pbVar9 >> 0x10);
  _DATA::lpbBattleLog._0_2_ = SUB42(pbVar9,0);
  _DATA::vlprgScoreX._2_2_ = (undefined2)((ulong)pSVar27 >> 0x10);
  _DATA::vlprgScoreX._0_2_ = (int)pSVar27;
  _DATA::rglpfl._2_2_ = (undefined2)((ulong)ppFVar11 >> 0x10);
  _DATA::rglpfl._0_2_ = (int)ppFVar11;
  _DATA::lpPlanets._2_2_ = (uint)((ulong)pPVar29 >> 0x10);
  _DATA::lpPlanets._0_2_ = (int)pPVar29;
  _DATA::lpThings._2_2_ = (short)((ulong)pTVar10 >> 0x10);
  _DATA::lpThings._0_2_ = (int)pTVar10;
  _DATA::vlpbAiData._2_2_ = (int)((ulong)pbVar28 >> 0x10);
  _DATA::vlpbAiData._0_2_ = (int)pbVar28;
  return sVar13;
LAB_1070_2a35:
  sVar13 = 0x10;
  pcVar16 = MSG::PszFormatIds(idsWarningIgnoringUnexpectedDataAfterEof,(short *)0x0);
  UTILGEN::AlertSz(pcVar16,sVar13);
LAB_1070_2a56:
  StreamClose();
  if ((((1 < cturn) && ((*(uint *)((int)&c_common::rgplr[0].flags4 + iPlayer * 0xc0) >> 9 & 1) == 0)
       ) && (((uint)c_common::ini.flags6 >> 0xc & 1) == 0)) &&
     ((((uint)c_common::ini.flags6 >> 0xb & 1) == 0 &&
      (((uint)c_common::ini.flags6 >> 0xd & 1) == 0)))) {
    pcVar16 = STRINGS::PszGetCompressedString(idsNoteDYearsDataRead);
    _WSPRINTF((LPSTR)CONCAT22(cturn,0x1120),(LPCSTR)CONCAT22(pcVar16,0x1120),(int)c_common::szWork);
    UTILGEN::AlertSz((char *)c_common::szWork,0x40);
  }
  sVar13 = PUBLIC::__strnicmp(pszExt,(char *)0x759,3);
  ppFVar11 = _DATA::rglpfl;
  if (sVar13 != 0) {
    lppl = _DATA::lpPlanets;
    if ((*(uint *)((int)&c_common::rgplr[0].flags4 + iPlayer * 0xc0) >> 9 & 1) == 0) {
      szT._240_2_ = (int)_DATA::lpThings;
      szT._242_2_ = _DATA::lpThings._2_2_;
      lpth = _DATA::lpThings;
      uVar19 = (int)_DATA::lpThings + _DATA::cThing * 0x12;
      while( true ) {
        _DATA::lpPlanets._2_2_ = (uint)((ulong)lppl >> 0x10);
        _DATA::lpPlanets._0_2_ = (int)lppl;
        _DATA::lpPlanets = lppl;
        if (uVar19 <= (uint)lpth) break;
        uVar24 = (undefined2)((ulong)lpth >> 0x10);
        if ((*(uint *)lpth >> 0xd == 1) && ((*(uint *)((uint)lpth + 6) >> 10 & 0xf) != 0)) {
          pPVar29 = UTIL::LpplFromId(*(uint *)((uint)lpth + 6) & 0x3ff);
          iVar18 = (int)((ulong)pPVar29 >> 0x10);
          lppl = _DATA::lpPlanets;
          if ((((int)pPVar29 != 0) || (iVar18 != 0)) && (*(int *)((int)pPVar29 + 2) == iPlayer)) {
            szT._242_2_ = PLANET::IWarpMAFromLppl(pPVar29,(short *)(szT + 0xf0));
            lppl = _DATA::lpPlanets;
            if (szT._242_2_ + szT._240_2_ < (int)((*(uint *)((uint)lpth + 6) >> 10 & 0xf) + 4)) {
              MSG::FSendPlrMsg2XGen
                        (0,idmMassPacketAppearsCollisionCourseWhichCurrently,-6,*(short *)lpth,
                         pPVar29->id);
              lppl = _DATA::lpPlanets;
            }
          }
        }
        lpth = (THING *)CONCAT22(uVar24,(uint)lpth + 0x12);
      }
      lppl = lppl;
      if (((uint)_DATA::game.flags9 >> 3 & 1) == 0) {
        szT._240_2_ = (int)_DATA::lpPlanets;
        szT._242_2_ = _DATA::lpPlanets._2_2_;
        uVar19 = (int)_DATA::lpPlanets + c_common::cPlanet * 0x38;
        while ((uint)lppl < uVar19) {
          uVar24 = (undefined2)((ulong)lppl >> 0x10);
          if ((((*(int *)((uint)lppl + 2) == iPlayer) && ((*(uint *)((uint)lppl + 4) >> 9 & 1) != 0)
               ) && ((*(int *)((uint)lppl + 0x34) != 0 || (*(int *)((uint)lppl + 0x36) != 0)))) &&
             (iVar18 = *(int *)((uint)lppl + 2) * 4,
             *(int *)(*(int *)(iVar18 + 0x14c) + (*(uint *)((uint)lppl + 0x2c) & 0xf) * 0x93) !=
             0x20)) {
            szT._254_2_ = 0;
            szT._252_2_ = 0;
            szT._244_2_ = *(int *)((uint)lppl + 0x34);
            szT._246_2_ = *(undefined2 *)((uint)lppl + 0x36);
            for (; szT._244_2_ = szT._244_2_ + 4, uVar8 = *(undefined4 *)((uint)lppl + 0x34),
                (int)szT._252_2_ < (int)(uint)*(byte *)((int)uVar8 + 3);
                szT._252_2_ = szT._252_2_ + 1) {
              PRODUCE::EstimateItemProdSched
                        (lppl,(PLPROD *)0x0,szT._252_2_,(short *)(szT + 0xfa),(short *)(szT + 0xf8))
              ;
              if (1 < (int)szT._248_2_) {
                szT._254_2_ = 0;
                break;
              }
              if (szT._248_2_ == 1) {
                uVar30 = PUBLIC::__aFulshr(uVar31,szEntry._0_2_);
                if (((uint)uVar30 & 7) == 1) {
                  uVar30 = PUBLIC::__aFulshr(uVar31,szEntry._0_2_);
                  if (((uint)uVar30 & 0x7f) < 7) goto LAB_1070_2cf9;
                }
                szT._254_2_ = 1;
              }
LAB_1070_2cf9:
            }
            if (szT._254_2_ != 0) {
              MSG::FSendPlrMsg2XGen
                        (0,idmStarbaseScheduledCompleteRemainingProductionItem,lppl->id,lppl->id,0);
            }
          }
          lppl = (PLANET *)CONCAT22(uVar24,(uint)lppl + 0x38);
        }
        sVar13 = VCR::CBattles();
        lppl = _DATA::lpPlanets;
        if (0 < sVar13) {
          MSG::FSendPlrMsg2XGen(1,(1 < sVar13) + idmHaveReceivedOneBattleRecordingYear,-7,sVar13,0);
          lppl = _DATA::lpPlanets;
        }
      }
    }
    if (((uint)_DATA::gd.flags2 >> 1 & 1) == 0) {
      _DATA::lpPlanets = lppl;
      _WSPRINTF((LPSTR)CONCAT22(pszFileName,0x1120),(LPCSTR)0x75d1120,(int)c_common::szWork);
      sVar13 = PLANET::FLoadLogFile((char *)c_common::szWork);
      if (sVar13 != 0) {
        sVar13 = PLANET::FRunLogFile();
        lppl = _DATA::lpPlanets;
        if (sVar13 != 0) goto LAB_1070_2eb1;
      }
      sVar13 = 0x10;
      pcVar16 = MSG::PszFormatIds(idsPlayerLogFileAppearsCorruptUnableLoad,(short *)0x0);
      UTILGEN::AlertSz(pcVar16,sVar13);
      goto IO_LError_2;
    }
LAB_1070_2eb1:
    i = 0;
    while( true ) {
      _DATA::lpPlanets._2_2_ = (uint)((ulong)lppl >> 0x10);
      _DATA::lpPlanets._0_2_ = (int)lppl;
      iVar18 = (int)_DATA::lpPlanets;
      _DATA::lpPlanets = lppl;
      if (_DATA::game.cPlayer <= i) break;
      *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) =
           *(uint *)((int)&c_common::rgplr[0].flags3 + i * 0xc0) & 0xf000;
      *(undefined2 *)((int)&c_common::rgplr[0].cPlanet + i * 0xc0) = 0;
      i = i + 1;
      lppl = _DATA::lpPlanets;
    }
    szT._254_2_ = _DATA::lpPlanets._2_2_;
    uVar19 = (int)_DATA::lpPlanets + c_common::cPlanet * 0x38;
    while ((uint)lppl < uVar19) {
      uVar24 = (undefined2)((ulong)lppl >> 0x10);
      if (*(int *)((uint)lppl + 2) == -1) {
        *(uint *)((uint)lppl + 4) = *(uint *)((uint)lppl + 4) & 0xfdff;
      }
      else {
        piVar1 = (int *)((int)&c_common::rgplr[0].cPlanet + *(int *)((uint)lppl + 2) * 0xc0);
        *piVar1 = *piVar1 + 1;
      }
      lppl = (PLANET *)CONCAT22(uVar24,(uint)lppl + 0x38);
    }
    i = 0;
    ppFVar11 = _DATA::rglpfl;
    while( true ) {
      _DATA::rglpfl._2_2_ = (undefined2)((ulong)ppFVar11 >> 0x10);
      _DATA::rglpfl._0_2_ = (int)ppFVar11;
      szT._252_4_ = (byte *)CONCAT22(szT._254_2_,iVar18);
      if (c_common::cFleet <= i) break;
      piVar22 = (int *)((int)_DATA::rglpfl + i * 4);
      iVar20 = *piVar22;
      iVar7 = piVar22[1];
      if ((iVar20 == 0) && (szT._252_4_ = (byte *)CONCAT22(szT._254_2_,iVar18), iVar7 == 0)) break;
      iVar20 = *(int *)(iVar20 + 2);
      szT._254_2_ = *(int *)((int)&c_common::rgplr[0].flags3 + iVar20 * 0xc0) + 1U & 0xfff;
      puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + iVar20 * 0xc0);
      _DATA::rglpfl = ppFVar11;
      *puVar2 = *puVar2 & 0xf000;
      puVar2 = (uint *)((int)&c_common::rgplr[0].flags3 + iVar20 * 0xc0);
      *puVar2 = *puVar2 | szT._254_2_;
      i = i + 1;
      ppFVar11 = _DATA::rglpfl;
    }
  }
  _DATA::idPlayer = iPlayer;
  pbVar28 = _DATA::vlpbAiData;
  pTVar10 = _DATA::lpThings;
  pPVar29 = _DATA::lpPlanets;
  pSVar27 = _DATA::vlprgScoreX;
  pbVar9 = _DATA::lpbBattleLog;
  if (((iPlayer != -1) &&
      ((*(uint *)((int)&c_common::rgplr[0].flags4 + iPlayer * 0xc0) >> 9 & 1) == 0)) &&
     (((int)_DATA::vrgszMRU != 0 || (_DATA::vrgszMRU._2_2_ != 0)))) {
    _DATA::rglpfl = ppFVar11;
    PUBLIC::_strcpy(szT,pszFileName);
    PUBLIC::_strcat(szT,(char *)0x764);
    PUBLIC::_strcat(szT,pszExt);
    sVar13 = PUBLIC::__fstricmp((char *)CONCAT22(unaff_SS,szT),
                                (char *)CONCAT22(_DATA::vrgszMRU._2_2_,(int)_DATA::vrgszMRU));
    pbVar28 = _DATA::vlpbAiData;
    pTVar10 = _DATA::lpThings;
    pPVar29 = _DATA::lpPlanets;
    pSVar27 = _DATA::vlprgScoreX;
    ppFVar11 = _DATA::rglpfl;
    pbVar9 = _DATA::lpbBattleLog;
    if (sVar13 != 0) {
      for (i = 1; i < 8; i = i + 1) {
        sVar13 = PUBLIC::__fstricmp((char *)CONCAT22(unaff_SS,szT),
                                    (char *)CONCAT22(_DATA::vrgszMRU._2_2_,
                                                     (int)_DATA::vrgszMRU + i * 0x100));
        if (sVar13 == 0) break;
      }
      for (; 0 < i; i = i + -1) {
        PUBLIC::__fstrcpy((char *)CONCAT22(_DATA::vrgszMRU._2_2_,(int)_DATA::vrgszMRU + i * 0x100),
                          (char *)CONCAT22(_DATA::vrgszMRU._2_2_,
                                           (int)_DATA::vrgszMRU + (i + -1) * 0x100));
      }
      PUBLIC::__fstrcpy((char *)CONCAT22(_DATA::vrgszMRU._2_2_,(int)_DATA::vrgszMRU),
                        (char *)CONCAT22(unaff_SS,szT));
      UTILGEN::CchGetString(idsStarsIni,szIniFile);
      UTILGEN::CchGetString(idsFiles,szSection);
      UTILGEN::CchGetString(idsFile1,szEntry);
      uVar17 = PUBLIC::_strlen(szEntry);
      for (i = 0; pbVar28 = _DATA::vlpbAiData, pTVar10 = _DATA::lpThings, pPVar29 = _DATA::lpPlanets
          , pSVar27 = _DATA::vlprgScoreX, ppFVar11 = _DATA::rglpfl, pbVar9 = _DATA::lpbBattleLog,
          i < 9; i = i + 1) {
        szSection[uVar17 - 0x13] = (char)i + '1';
        PUBLIC::__fstrcpy((char *)CONCAT22(unaff_SS,szT),
                          (char *)CONCAT22(_DATA::vrgszMRU._2_2_,(int)_DATA::vrgszMRU + i * 0x100));
        WritePrivateProfileString
                  ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                   (LPCSTR)CONCAT22(unaff_SS,szT),(LPCSTR)CONCAT22(unaff_SS,szIniFile));
      }
    }
  }
  sVar13 = 1;
  goto LAB_1070_3200;
}



// ======================================================================
// Function: FReadShDef
// Address: 1070:0006
// ======================================================================


/* WARNING: Could not reconcile some variable overlaps */

short __cdecl16far IO::FReadShDef(RTSHDEF *lprt,SHDEF *lpshdef,short iplrLoad)

{
  SHDEF *pSVar1;
  HullDef *pHVar2;
  int iVar3;
  int iVar4;
  HullSlotType *pHVar5;
  SHDEF *pSVar6;
  HullDef *pHVar7;
  undefined2 uVar8;
  undefined2 unaff_SS;
  HULDEF *pHVar9;
  PART part;
  HUL *lphul;
  short c;
  ulong wt;
  HUL *lphulBase;
  short fOkay;
  short cch;
  short ishdef;
  byte *lpb;
  SHDEF shdef;
  char szTemp [40];
  
  PUBLIC::_memset(&shdef,0,0x93);
  uVar8 = (undefined2)((ulong)lprt >> 0x10);
  iVar4 = (int)lprt;
  shdef.hul.ihuldef = (HullDef)*(byte *)(iVar4 + 2);
  shdef.flags62 = lprt->flags1;
  shdef.hul.chs = *(byte *)(iVar4 + 6);
  shdef.hul.ibmp = (short)*(byte *)(iVar4 + 3);
  if ((shdef.flags62 & 0xffU) == 7) {
    shdef.hul.dp = *(short *)(iVar4 + 4);
    shdef.turn = *(short *)(iVar4 + 7);
    shdef.cBuilt._0_2_ = *(undefined2 *)(iVar4 + 9);
    shdef.cBuilt._2_2_ = *(undefined2 *)(iVar4 + 0xb);
    shdef.cExist._0_2_ = *(undefined2 *)(iVar4 + 0xd);
    shdef.cExist._2_2_ = *(undefined2 *)(iVar4 + 0xf);
    lpb = (byte *)CONCAT22(uVar8,iVar4 + 0x11);
    PUBLIC::__fmemmove((void *)CONCAT22(unaff_SS,shdef.hul.rghs),
                       (void *)CONCAT22(uVar8,iVar4 + 0x11),(uint)*(byte *)(iVar4 + 6) << 2);
    lpb = (byte *)CONCAT22(lpb._2_2_,(int)lpb + (uint)*(byte *)(iVar4 + 6) * 4);
  }
  else {
    shdef.hul.wtEmpty = *(short *)(iVar4 + 4);
    lpb = (byte *)CONCAT22(uVar8,iVar4 + 6);
  }
  pHVar9 = PARTS::LphuldefFromId(shdef.hul.ihuldef);
  fOkay = *(uint *)((int)pHVar9 + 0x32);
  if ((shdef.hul.ibmp < fOkay) || ((int)(fOkay + 4U) <= shdef.hul.ibmp)) {
    shdef.hul.ibmp = shdef.hul.ibmp & 3U | fOkay;
  }
  cch = (short)*lpb;
  iVar4 = (int)lpb + 1;
  lpb = (byte *)CONCAT22(lpb._2_2_,iVar4);
  if (cch == 0) {
    PUBLIC::__fstrcpy((char *)CONCAT22(unaff_SS,shdef.hul.szClass),(char *)CONCAT22(lpb._2_2_,iVar4)
                     );
  }
  else {
    fOkay = 0x20;
    if (0x20 < (uint)cch) {
      return 0;
    }
    PUBLIC::__fmemmove((void *)CONCAT22(unaff_SS,szTemp),(void *)CONCAT22(lpb._2_2_,iVar4),cch);
    UTILGEN::FDecompressUserString
              ((char *)CONCAT22(unaff_SS,szTemp),cch,(char *)CONCAT22(unaff_SS,shdef.hul.szClass),
               &fOkay);
  }
  ishdef = (uint)shdef.flags62 >> 10 & 0x1f;
  if (0xf < (uint)ishdef) {
    ishdef = ishdef - 0x10;
  }
  if ((((shdef.flags62 & 0xffU) == 7) ||
      ((*(uint *)((int)lpshdef + ishdef * 0x93 + 0x7b) >> 9 & 1) != 0)) ||
     ((*(uint *)((int)lpshdef + ishdef * 0x93 + 0x7b) & 0xff) < 7)) {
    pHVar7 = (HullDef *)((int)lpshdef + ishdef * 0x93);
    pSVar6 = &shdef;
    for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
      pHVar2 = pHVar7;
      pHVar7 = pHVar7 + 1;
      pSVar1 = pSVar6;
      pSVar6 = (SHDEF *)(pSVar6->hul).rgTech;
      *pHVar2 = (pSVar1->hul).ihuldef;
    }
    *(undefined *)pHVar7 = *(undefined *)&(pSVar6->hul).ihuldef;
  }
  else if ((shdef.hul.ihuldef != *(HullDef *)((int)lpshdef + ishdef * 0x93)) ||
          (shdef.hul.ibmp != *(int *)((int)lpshdef + ishdef * 0x93 + 0x32))) {
    pHVar7 = (HullDef *)((int)lpshdef + ishdef * 0x93);
    pSVar6 = &shdef;
    for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
      pHVar2 = pHVar7;
      pHVar7 = pHVar7 + 1;
      pSVar1 = pSVar6;
      pSVar6 = (SHDEF *)(pSVar6->hul).rgTech;
      *pHVar2 = (pSVar1->hul).ihuldef;
    }
    *(undefined *)pHVar7 = *(undefined *)&(pSVar6->hul).ihuldef;
  }
  if (_DATA::idPlayer != -1) {
    UTIL::UpdateShdefCost((SHDEF *)CONCAT22(lpshdef._2_2_,(int)lpshdef + ishdef * 0x93));
  }
  if ((*(uint *)((int)lpshdef + ishdef * 0x93 + 0x7b) & 0xff) == 7) {
    iVar3 = (int)lpshdef + ishdef * 0x93;
    lphul = (HUL *)CONCAT22(lpshdef._2_2_,iVar3);
    pHVar9 = PARTS::LphuldefFromId(lphul->ihuldef);
    uVar8 = (undefined2)((ulong)pHVar9 >> 0x10);
    iVar4 = (int)pHVar9;
    wt._0_2_ = *(int *)(iVar4 + 0x28);
    for (c = 0; c < (int)(uint)*(byte *)(iVar3 + 0x7a); c = c + 1) {
      if (*(uint *)(iVar3 + c * 4 + 0x3c) >> 8 != 0) {
        pHVar5 = (HullSlotType *)(iVar3 + 0x3a + c * 4);
        part.hs.grhst = *pHVar5;
        part.hs.flags2 = pHVar5[1];
        fOkay = PARTS::FLookupPart(&part);
        if (_DATA::idPlayer == -1) {
          fOkay = 0;
        }
        if ((((part.hs.grhst & *(HullSlotType *)(iVar4 + 0x3a + c * 4)) ==
              ~(hstEngine|hstScanner|hstShield|hstArmor|hstBeam|hstTorp|hstBomb|hstMining|hstMines|
                hstSpecialSB|hstSBHull|hstSpecialE|hstSpecialM|hstTerra|hstHull|hstPlanetary)) ||
            ((1 < fOkay && (-1 < shdef.flags62)))) ||
           (*(uint *)(iVar4 + c * 4 + 0x3c) >> 8 < (uint)part.hs.flags2 >> 8)) {
          *(uint *)(iVar3 + c * 4 + 0x3c) = *(uint *)(iVar3 + c * 4 + 0x3c) & 0xff;
        }
        wt._0_2_ = (int)wt + *(int *)((int)part.pcom + 0x28) *
                             (*(uint *)(iVar3 + c * 4 + 0x3c) >> 8);
      }
      if (((c == 0) && (*(uint *)(iVar3 + 0x3c) >> 8 == 0)) && (*(int *)(iVar4 + 0x3a) == 1)) {
        *(undefined2 *)(iVar3 + 0x3a) = 1;
        *(uint *)(iVar3 + 0x3c) = *(uint *)(iVar3 + 0x3c) & 0xff00 | 1;
        *(uint *)(iVar3 + 0x3c) = *(uint *)(iVar3 + 0x3c) & 0xff | *(uint *)(iVar4 + 0x3c) & 0xff00;
        part.hs.grhst = *(HullSlotType *)(iVar3 + 0x3a);
        part.hs.flags2 = *(short *)(iVar3 + 0x3c);
        PARTS::FLookupPart(&part);
        wt._0_2_ = (int)wt + *(int *)((int)part.pcom + 0x28) * (*(uint *)(iVar3 + 0x3c) >> 8);
      }
    }
    *(int *)(iVar3 + 0x28) = (int)wt;
  }
  return 1;
}



// ======================================================================
// Function: ReadRt
// Address: 1070:5168
// ======================================================================


void __cdecl16far IO::ReadRt(void)

{
  RgFromStream(&c_common::hdrCur,2);
  if ((c_common::hdrCur.flags1 & 0x3ffU) != 0) {
    RgFromStream(c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
  }
  if ((uint)c_common::hdrCur.flags1 >> 10 == 8) {
    UTILGEN::SetFileXorStream
              (CONCAT22(c_common::rgbCur._6_2_,c_common::rgbCur._4_2_),
               (int)c_common::rgbCur._12_2_ >> 5,c_common::rgbCur._10_2_,
               (int)(c_common::rgbCur._12_2_ << 0xb) >> 0xb,(uint)c_common::rgbCur._14_2_ >> 0xc & 1
              );
  }
  else if ((uint)c_common::hdrCur.flags1 >> 10 != 0) {
    UTILGEN::XorFileBuf((char *)c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
  }
  return;
}



// ======================================================================
// Function: FOpenFile
// Address: 1070:4ac2
// ======================================================================


/* WARNING: Variable defined which should be unmapped: env */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short __cdecl16far IO::FOpenFile(DtFileType dt,short iPlayer,short md)

{
  undefined2 *puVar1;
  RTBOF *pRVar2;
  DtFileType dt_00;
  undefined2 uVar3;
  short sVar4;
  StringId ids_00;
  char *sz;
  short sVar5;
  int iVar6;
  undefined2 *puVar7;
  RTBOF *pRVar8;
  undefined2 unaff_SS;
  short env [9];
  short (*penvMemSav) [9];
  short fSilentSav;
  short fRewind;
  short fCheckMulti;
  short ids;
  RTBOF rtbof;
  
  sVar5 = _DATA::fFileErrSilent;
  _DATA::gd.flags2 = _DATA::gd.flags2 & 0xff7f;
  dt_00 = dt & 0xff;
  SetSzWorkFromDt(dt_00,iPlayer);
  uVar3 = _penvMem;
  _penvMem = env;
  sVar4 = PUBLIC::__setjmp(env);
  if (sVar4 != 0) {
    _DATA::fFileErrSilent = sVar5;
    FileError(idsCantOpenFile);
    StreamClose();
    _penvMem = (short *)uVar3;
    return 0;
  }
  _DATA::fFileErrSilent = 1;
  StreamOpen((char *)c_common::szWork,md);
  sVar4 = 0x1070;
  _DATA::fFileErrSilent = sVar5;
  ReadRt();
  if (((((uint)c_common::hdrCur.flags1 >> 10 == 8) && ((uint)c_common::rgbCur._8_2_ >> 0xc == 2)) &&
      (0x30 < ((uint)c_common::rgbCur._8_2_ >> 5 & 0x7f))) &&
     (((uint)c_common::rgbCur._8_2_ >> 5 & 0x7f) < 0x54)) {
    puVar7 = (undefined2 *)c_common::rgbCur;
    pRVar8 = &rtbof;
    for (iVar6 = 8; iVar6 != 0; iVar6 = iVar6 + -1) {
      pRVar2 = pRVar8;
      pRVar8 = (RTBOF *)(pRVar8->rgid + 2);
      puVar1 = puVar7;
      puVar7 = puVar7 + 1;
      *(undefined2 *)pRVar2->rgid = *puVar1;
    }
    if ((rtbof.flags7 << 0xb) >> 0xb == iPlayer) {
      if (((int)_DATA::game.lid == 0) && (_DATA::game.lid._2_2_ == 0)) goto LAB_1070_4ebd;
      if (((int)rtbof.lidGame == (int)_DATA::game.lid) &&
         (rtbof.lidGame._2_2_ == _DATA::game.lid._2_2_)) {
        if (dt_00 == dtHist) {
          if ((rtbof.flags7 << 0xb) >> 0xb == iPlayer) goto LAB_1070_4ebd;
        }
        else {
          if (((dt & 0x2000) != dtTurn) && (((uint)rtbof.flags8 >> 10 & 1) != 0)) {
            PUBLIC::__lseek(_DATA::hf,-4,2);
            env[0] = 0x1118;
            sVar4 = 0x1070;
            ReadRt();
            if (((uint)c_common::hdrCur.flags1 >> 10 != 0) &&
               ((c_common::hdrCur.flags1 & 0x3ffU) != 2)) goto IO_LBadFile_2;
            rtbof.turn = c_common::rgbCur._0_2_;
            _DATA::game.flags9 = _DATA::game.flags9 & 0xf1ffU | ((uint)rtbof.flags8 >> 0xd) << 9;
          }
          sVar4 = 0x1070;
          if ((_DATA::game.turn == 0) && (rtbof.turn != 0)) {
            _DATA::game.turn = rtbof.turn;
            _DATA::game.flags9 = _DATA::game.flags9 & 0xf1ffU | ((uint)rtbof.flags8 >> 0xd) << 9;
LAB_1070_4ebd:
            if ((dt & 0x1000) != dtTurn) {
              env[0] = 0;
              PUBLIC::__lseek(_DATA::hf,0,0);
              env[4] = 0x1118;
              env[3] = (int)c_common::rgbCur + 0x34b;
              ReadRt();
            }
            _penvMem = (short *)uVar3;
            _DATA::wVersFile = rtbof.flags5;
            _DATA::gd.flags2 = _DATA::gd.flags2 & 0xfffbU | ((uint)rtbof.flags8 >> 0xc & 1) << 2;
            return 1;
          }
          if (rtbof.turn == _DATA::game.turn) {
            if (((dt_00 == dtHost) && (((uint)_DATA::gd.flags1 >> 3 & 1) == 0)) &&
               (((uint)rtbof.flags8 >> 9 & 1) != 0)) {
              env[0] = (int)s_M6102__MATH___floating_point_err_1120_2022 + 2;
              sz = MSG::PszFormatIds(idsHostFileMarkedUseAnotherInstanceStars,(short *)0x0);
              sVar4 = 0x1040;
              sVar5 = UTILGEN::AlertSz(sz,env[0]);
              if (sVar5 == 6) goto LAB_1070_4ebd;
            }
            else if (((((uint)rtbof.flags8 >> 8 & 1) == 0) &&
                     (((uint)_DATA::gd.flags1 >> 1 & 1) != 0)) &&
                    (((uint)_DATA::gd.flags1 >> 2 & 1) == 0)) {
              _DATA::gd.flags2 = _DATA::gd.flags2 & 0xff7fU | 0x80;
            }
            else {
              if (((dt_00 != dtXY) || (((uint)_DATA::game.flags9 >> 3 & 1) != 0)) ||
                 ((uint)rtbof.flags8 >> 0xd == ((uint)_DATA::game.flags9 >> 9 & 7)))
              goto LAB_1070_4ebd;
              env[0] = 0x1d;
              sVar4 = 0x1070;
              FileError(idsFileGame);
            }
          }
          else {
            env[0] = 0x1c;
            sVar4 = 0x1070;
            FileError(idsFileDate);
          }
        }
      }
      else {
        sVar4 = 0x1070;
        FileError(idsFileGame);
      }
    }
    else {
      sVar4 = 0x1070;
      FileError(idsGameFileAppearsCorruptUnableLoadFile);
    }
  }
  else if ((uint)c_common::hdrCur.flags1 >> 10 == 8) {
    if (((uint)c_common::rgbCur._8_2_ >> 0xc < 3) &&
       (((uint)c_common::rgbCur._8_2_ >> 0xc != 2 ||
        (((uint)c_common::rgbCur._8_2_ >> 5 & 0x7f) < 0x55)))) {
      ids_00 = idsSorryFileCreatedOlderVersionStarsIncompatible;
    }
    else {
      ids_00 = idsFileCreatedNewerVersionStarsMustUpgrade;
    }
    sVar4 = 0x1070;
    FileError(ids_00);
  }
  else {
    sVar4 = 0x1070;
    FileError(idsFileDoesBelongVersionStars);
  }
IO_LBadFile_2:
  env[0] = sVar4;
  StreamClose();
  _penvMem = (short *)uVar3;
  return 0;
}



// ======================================================================
// Function: AskSaveDialog
// Address: 1070:432a
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short __pascal16far IO::AskSaveDialog(ushort hwnd,ushort message,ushort wParam,long lParam)

{
  short sVar1;
  
  if (message != 2) {
    if (message == 0x110) {
      return 1;
    }
    if (message == 0x111) {
      if (((wParam == 0x429) || (wParam == 0x42b)) || (wParam == 0x42a)) {
        if (wParam == 0x42b) {
          sVar1 = 0;
        }
        else if (wParam == 0x42a) {
          sVar1 = -1;
        }
        else {
          sVar1 = 1;
        }
        EndDialog(hwnd,sVar1);
        return 1;
      }
      if (wParam == 0x76) {
        WinHelp(hwnd,(LPCSTR)CONCAT22(0x1120,_szHelpFile),1,0x442);
        return 1;
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: StreamClose
// Address: 1070:53cc
// ======================================================================


void __cdecl16far IO::StreamClose(void)

{
  if (_DATA::hf != -1) {
    _lclose(_DATA::hf);
    _DATA::hf = -1;
  }
  return;
}



// ======================================================================
// Function: FNewTurnAvail
// Address: 1070:4f22
// ======================================================================


short __cdecl16far IO::FNewTurnAvail(short idPlayer)

{
  short sVar1;
  uint uVar2;
  short sVar3;
  short fNew;
  ushort turnOld;
  ushort wGenOld;
  
  sVar1 = _DATA::game.turn;
  uVar2 = (uint)_DATA::game.flags9 >> 9;
  _DATA::fFileErrSilent = 1;
  _DATA::game.turn = 0;
  sVar3 = FOpenFile((int)s_M6101__MATH___floating_point_err_1120_1ff1 + 0x12,idPlayer,0x20);
  if (sVar3 == 0) {
    fNew = 0;
  }
  else {
    StreamClose();
    fNew = (short)((uint)sVar1 < (uint)_DATA::game.turn);
  }
  _DATA::game.turn = sVar1;
  _DATA::game.flags9 = _DATA::game.flags9 & 0xf1ffU | (uVar2 & 7) << 9;
  return fNew;
}



// ======================================================================
// Function: GetFileStatus
// Address: 1070:4a60
// ======================================================================


void __cdecl16far IO::GetFileStatus(short dt,short iPlayer)

{
  short sVar1;
  
  SetSzWorkFromDt(dt,iPlayer);
  sVar1 = PUBLIC::__access((char *)c_common::szWork,2);
  _DATA::gd.flags2 = _DATA::gd.flags2 & 0xffdfU | (uint)(sVar1 != 0) << 5;
  return;
}



// ======================================================================
// Function: FReadPlanet
// Address: 1070:3206
// ======================================================================


short __cdecl16far IO::FReadPlanet(short iPlayer,PLANET *lppl,short fHistory,short fPreInited)

{
  uint uVar1;
  undefined2 uVar2;
  bool bVar3;
  byte bVar4;
  uint uVar5;
  short sVar6;
  short sVar7;
  undefined2 *puVar8;
  uint *puVar9;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar10;
  ushort in_stack_0000ffea;
  short pct;
  short pctOpt;
  MessageId idm;
  byte *pb;
  short i;
  byte bMask;
  short fRouting;
  short fFirstYear;
  
  lVar10 = CONCAT22(unaff_SI,unaff_DI);
  bVar3 = false;
  if (fPreInited == 0) {
    PUBLIC::__fmemset(lppl,0,0x38);
  }
  if ((fHistory == 0) && (iPlayer != -1)) {
    if (fPreInited == 0) {
      bVar3 = true;
      *(uint *)((int)lppl + 4) = *(uint *)((int)lppl + 4) & 0xf7ff | 0x800;
    }
    else if ((*(uint *)((int)lppl + 4) >> 0xb & 1) != 0) {
      if (*(int *)((int)lppl + 0x32) == _DATA::game.turn) {
        bVar3 = true;
      }
      else {
        *(uint *)((int)lppl + 4) = *(uint *)((int)lppl + 4) & 0xf7ff;
      }
    }
  }
  else {
    *(uint *)((int)lppl + 4) =
         *(uint *)((int)lppl + 4) & 0xf7ff | ((uint)c_common::rgbCur._2_2_ >> 0xf) << 0xb;
  }
  lppl->id = (int)(c_common::rgbCur._0_2_ << 5) >> 5;
  *(int *)((int)lppl + 2) = (int)c_common::rgbCur._0_2_ >> 0xb;
  if ((*(uint *)((int)lppl + 4) & 0xff) < (c_common::rgbCur._2_2_ & 0x7f)) {
    *(uint *)((int)lppl + 4) = *(uint *)((int)lppl + 4) & 0xff00 | c_common::rgbCur._2_2_ & 0x7f;
  }
  *(uint *)((int)lppl + 4) =
       *(uint *)((int)lppl + 4) & 0xfeff | ((uint)c_common::rgbCur._2_2_ >> 8 & 1) << 8;
  *(uint *)((int)lppl + 4) =
       *(uint *)((int)lppl + 4) & 0xfdff | ((uint)c_common::rgbCur._2_2_ >> 9 & 1) << 9;
  *(uint *)((int)lppl + 4) =
       *(uint *)((int)lppl + 4) & 0xfbff | ((uint)c_common::rgbCur._2_2_ >> 7 & 1) << 10;
  uVar5 = (uint)c_common::rgbCur._2_2_ >> 0xe;
  if (((*(uint *)((int)lppl + 4) >> 9 & 1) != 0) && (*(int *)((int)lppl + 2) == -1)) {
    *(uint *)((int)lppl + 4) = *(uint *)((int)lppl + 4) & 0xfdff;
  }
  if (fHistory == 0) {
    *(short *)((int)lppl + 0x32) = _DATA::game.turn;
  }
  pb = (byte *)((int)c_common::rgbCur + 4);
  if (2 < (c_common::rgbCur._2_2_ & 0x7f)) {
    bMask = c_common::rgbCur[4];
    pb = (byte *)((int)c_common::rgbCur + 5);
    for (i = 0; i < 3; i = i + 1) {
      if ((bMask & 3) == 0) {
        *(undefined *)((int)lppl + 6 + i) = 0;
      }
      else {
        if ((bMask & 3) != 1) {
          return 0;
        }
        *(byte *)((int)lppl + 6 + i) = *pb;
        pb = pb + 1;
      }
      bMask = (byte)((int)(uint)bMask >> 2);
    }
    for (i = 0; i < 3; i = i + 1) {
      *(byte *)((int)lppl + 9 + i) = *pb;
      pb = pb + 1;
    }
    for (i = 0; i < 3; i = i + 1) {
      if (100 < *pb) {
        return 0;
      }
      bVar4 = *pb;
      *(byte *)((int)lppl + 0xf + i) = bVar4;
      *(byte *)((int)lppl + 0xc + i) = bVar4;
      pb = pb + 1;
    }
    if (((uint)c_common::rgbCur._2_2_ >> 10 & 1) != 0) {
      for (i = 0; i < 3; i = i + 1) {
        if (100 < *pb) {
          return 0;
        }
        *(byte *)((int)lppl + 0xf + i) = *pb;
        pb = pb + 1;
      }
    }
    if ((int)c_common::rgbCur._0_2_ >> 0xb != -1) {
      *(undefined2 *)((int)lppl + 0x12) = *(undefined2 *)pb;
      pb = pb + 2;
    }
    if (3 < (*(uint *)((int)lppl + 4) & 0xff)) {
      if (((uint)c_common::rgbCur._2_2_ >> 0xd & 1) != 0) {
        bMask = *pb;
        pb = pb + 1;
        for (i = 0; i < 4; i = i + 1) {
          bVar4 = bMask & 3;
          if ((bMask & 3) == 0) {
            puVar8 = (undefined2 *)((int)lppl + 0x1c + i * 4);
            *puVar8 = 0;
            puVar8[1] = 0;
          }
          else if (bVar4 == 1) {
            puVar9 = (uint *)((int)lppl + 0x1c + i * 4);
            *puVar9 = (uint)*pb;
            puVar9[1] = 0;
            pb = pb + 1;
          }
          else if (bVar4 == 2) {
            puVar8 = (undefined2 *)((int)lppl + 0x1c + i * 4);
            *puVar8 = *(undefined2 *)pb;
            puVar8[1] = 0;
            pb = pb + 2;
          }
          else if (bVar4 == 3) {
            uVar2 = *(undefined2 *)(pb + 2);
            puVar8 = (undefined2 *)((int)lppl + 0x1c + i * 4);
            *puVar8 = *(undefined2 *)pb;
            puVar8[1] = uVar2;
            pb = pb + 4;
          }
          bMask = (byte)((int)(uint)bMask >> 2);
        }
      }
      if ((uint)c_common::hdrCur.flags1 >> 10 != 0xe) {
        if (((uint)c_common::rgbCur._2_2_ >> 0xb & 1) == 0) {
          lVar10 = PUBLIC::__aFlshl(lVar10,in_stack_0000ffea);
          uVar1 = *(uint *)((int)lppl + 0x1a);
          *(uint *)((int)lppl + 0x18) = *(uint *)((int)lppl + 0x18) | (uint)lVar10;
          *(uint *)((int)lppl + 0x1a) = uVar1 & 0xffbf | (uint)((ulong)lVar10 >> 0x10);
          uVar1 = *(uint *)((int)lppl + 0x1a);
          *(uint *)((int)lppl + 0x18) = *(uint *)((int)lppl + 0x18) & 0xfff | 0xf000;
          *(uint *)((int)lppl + 0x1a) = uVar1 & 0xfffe | 1;
          uVar2 = *(undefined2 *)((int)lppl + 0x1a);
          *(uint *)((int)lppl + 0x18) = *(uint *)((int)lppl + 0x18) & 0xf000;
          *(undefined2 *)((int)lppl + 0x1a) = uVar2;
        }
        else {
          PUBLIC::__fmemmove((void *)CONCAT22(lppl._2_2_,(int)lppl + 0x14),
                             (void *)CONCAT22(0x1120,pb),8);
          pb = pb + 8;
        }
        if (*(int *)((int)lppl + 2) != -1) {
          if ((*(uint *)((int)lppl + 4) >> 9 & 1) != 0) {
            uVar2 = *(undefined2 *)(pb + 2);
            *(undefined2 *)((int)lppl + 0x2c) = *(undefined2 *)pb;
            *(undefined2 *)((int)lppl + 0x2e) = uVar2;
            *(uint *)((int)lppl + 0x2e) = *(uint *)((int)lppl + 0x2e) & 0xbfff;
            pb = pb + 4;
          }
          if ((uVar5 & 1) != 0) {
            *(undefined2 *)((int)lppl + 0x30) = *(undefined2 *)pb;
          }
        }
        return 1;
      }
    }
  }
  if ((*(uint *)((int)lppl + 4) >> 9 & 1) != 0) {
    *(uint *)((int)lppl + 0x2c) = *(uint *)((int)lppl + 0x2c) & 0xfff0 | *pb & 0xf;
    pb = pb + 1;
  }
  if (fHistory == 0) {
    if (bVar3) {
      if (*(int *)((int)lppl + 2) == -1) {
        if ((*(uint *)((int)lppl + 4) & 0xff) < 2) {
          MSG::FSendPlrMsg2XGen(0,idmHaveFoundNewPlanetDontKnowIf,lppl->id,lppl->id,0);
        }
        else {
          sVar6 = RACE::GetRaceStat((PLAYER *)((int)c_common::rgplr + iPlayer * 0xc0),rsMajorAdv);
          if (sVar6 == 3) {
            sVar6 = PLANET::PctPlanetOptValue(lppl,iPlayer);
            MSG::FSendPlrMsg2XGen(0,idmHaveInfoNewPlanetIfColonizeCan,lppl->id,lppl->id,sVar6);
          }
          else {
            sVar6 = PLANET::PctPlanetDesirability(lppl,iPlayer);
            if (sVar6 < 1) {
              sVar7 = PLANET::PctPlanetOptValue(lppl,iPlayer);
              if (sVar7 < 1) {
                pct = sVar6 * 10;
                idm = idmHaveFoundNewPlanetWhichUnfortunatelyHabitable;
              }
              else {
                sVar6 = RACE::PctTrueMaxGrowth(iPlayer);
                pct = sVar6 * sVar7;
                idm = idmHaveFoundNewPlanetWhichHaveAbility;
              }
            }
            else {
              sVar7 = RACE::PctTrueMaxGrowth(iPlayer);
              pct = sVar7 * sVar6;
              idm = idmHaveFoundNewHabitablePlanetColonistsWill;
            }
            sVar6 = lppl->id;
            sVar7 = PUBLIC::_abs(pct);
            MSG::FSendPlrMsg2XGen(0,idm,lppl->id,sVar7,sVar6);
          }
        }
      }
      else {
        MSG::FSendPlrMsg2XGen
                  (0,idmHaveFoundPlanetOccupiedSomeoneElseCurrently,lppl->id,lppl->id,
                   *(uint *)((int)lppl + 2) | 0x30);
      }
    }
  }
  else {
    *(undefined2 *)((int)lppl + 0x32) = *(undefined2 *)pb;
  }
  return 1;
}



// ======================================================================
// Function: PromptSaveGame
// Address: 1070:43ee
// ======================================================================


void __cdecl16far IO::PromptSaveGame(void)

{
  undefined2 uVar1;
  short sVar2;
  FARPROC pvVar3;
  short fRet;
  void *lpProc;
  
  pvVar3 = MakeProcInstance(AskSaveDialog,c_common::hInst);
  if (((uint)_DATA::game.flags9 >> 2 & 1) == 0) {
    uVar1 = 0x42c;
  }
  else {
    uVar1 = 0x7e9;
  }
  sVar2 = DialogBox(0,(LPCSTR)CONCAT22(uVar1,c_common::hwndFrame),(HWND)((ulong)pvVar3 >> 0x10),
                    (int)pvVar3);
  FreeProcInstance(pvVar3);
  if (sVar2 != 0) {
    _DATA::gd.flags1 = _DATA::gd.flags1 & 0xffefU | (uint)(sVar2 == -1) << 4;
    PLANET::FWriteLogFile((char *)c_common::szBase,_DATA::idPlayer);
    PLANET::FWriteHistFile(_DATA::idPlayer);
  }
  return;
}



// ======================================================================
// Function: FCheckFile
// Address: 1070:4fb2
// ======================================================================


short __cdecl16far IO::FCheckFile(DtFileType dt,short iPlayer,ushort md)

{
  short sVar1;
  uint uVar2;
  short sVar3;
  short fErrSav;
  short f;
  ushort wGenOld;
  short fOpened;
  short fReturn;
  
  sVar1 = _DATA::fFileErrSilent;
  uVar2 = (uint)_DATA::game.flags9 >> 9;
  if (dt == dtHost) {
    f = (uint)_DATA::gd.flags1 >> 3 & 1;
    _DATA::gd.flags1 = _DATA::gd.flags1 & 0xfff7U | 8;
  }
  _DATA::fFileErrSilent = 1;
  sVar3 = FOpenFile(dt,iPlayer,0x20);
  if (md == 1) {
    if ((sVar3 == 0) || (((uint)c_common::rgbCur._14_2_ >> 9 & 1) != 0)) {
      fReturn = 1;
    }
    else {
      fReturn = 0;
    }
  }
  else if (md == 2) {
    if ((sVar3 == 0) || (((uint)c_common::rgbCur._14_2_ >> 8 & 1) == 0)) {
      fReturn = 0;
    }
    else {
      fReturn = 1;
    }
  }
  else if (md == 4) {
    if ((sVar3 == 0) || (((uint)c_common::rgbCur._14_2_ >> 10 & 1) == 0)) {
      fReturn = 0;
    }
    else {
      fReturn = 1;
    }
  }
  else if (md == 8) {
    if (sVar3 == 0) {
      fReturn = 0;
    }
    else {
      do {
        ReadRt();
        if ((uint)c_common::hdrCur.flags1 >> 10 == 6) break;
      } while (c_common::rgbCur[0] != iPlayer);
      fReturn = (uint)c_common::rgbCur._6_2_ >> 9 & 1;
    }
  }
  if (sVar3 != 0) {
    StreamClose();
  }
  if (dt == dtHost) {
    _DATA::gd.flags1 = _DATA::gd.flags1 & 0xfff7U | (f & 1U) << 3;
  }
  _DATA::fFileErrSilent = sVar1;
  _DATA::game.flags9 = _DATA::game.flags9 & 0xf1ffU | (uVar2 & 7) << 9;
  return fReturn;
}



// ======================================================================
// Function: FValidSerialLong
// Address: 1070:48c4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10704975) */
/* WARNING: Removing unreachable block (ram,0x10704994) */

short __cdecl16far IO::FValidSerialLong(ulong lSerial)

{
  short sVar1;
  ulong uVar2;
  ulong uVar3;
  ulong lSeries;
  short i;
  ulong lNumber;
  
  sVar1 = FBogusLong(lSerial);
  if (sVar1 == 0) {
    uVar2 = lSerial;
    for (i = 0; i < 4; i = i + 1) {
      uVar2 = PUBLIC::__aFuldiv(uVar2,0x24);
    }
    uVar3 = uVar2;
    for (i = 0; i < 4; i = i + 1) {
      uVar3 = PUBLIC::__aFulmul(uVar3,0x24);
    }
    uVar3 = lSerial - uVar3;
    if ((((int)(uVar3 >> 0x10) == 0) && ((uint)uVar3 < 100)) || (1500000 < uVar3)) {
      sVar1 = 0;
    }
    else if (((uVar2 == 0x12) || (uVar2 == 0x16)) ||
            ((uVar2 == 2 || ((uVar2 == 4 || (uVar2 == 6)))))) {
      sVar1 = 1;
    }
    else {
      sVar1 = 0;
    }
  }
  else {
    sVar1 = 0;
  }
  return sVar1;
}



// ======================================================================
// Function: DestroyCurGame
// Address: 1070:44b0
// ======================================================================


void __cdecl16far IO::DestroyCurGame(void)

{
  short i;
  
  if (((uint)_DATA::gd.flags1 >> 8 & 1) != 0) {
    MSG::FFinishPlrMsgEntry(0);
  }
  if ((_DATA::idPlayer != -1) && (_DATA::game.fDirty != 0)) {
    PromptSaveGame();
  }
  MEMORY::ResetHb(htPlanets);
  _DATA::lpPlanets._0_2_ = 0;
  _DATA::lpPlanets._2_2_ = 0;
  c_common::cPlanet = 0;
  MEMORY::ResetHb(htFleets);
  _DATA::rglpfl._0_2_ = 0;
  _DATA::rglpfl._2_2_ = 0;
  c_common::cFleet = 0;
  MEMORY::ResetHb(htThings);
  _DATA::lpThings._0_2_ = 0;
  _DATA::lpThings._2_2_ = 0;
  _DATA::cThing = 0;
  _DATA::cThingAlloc = 0;
  _DATA::vlprgScoreX._0_2_ = 0;
  _DATA::vlprgScoreX._2_2_ = 0;
  _DATA::vrptFleet.fCached = 0;
  _DATA::vrptPlanet.fCached = 0;
  _DATA::vrptBattle.fCached = 0;
  _DATA::vrptEFleet.fCached = 0;
  for (i = 0; i < 0x10; i = i + 1) {
    *(undefined2 *)((int)_DATA::rgsxPlr + i * 4) = 0;
    *(undefined2 *)(i * 4 + 0x156e) = 0;
  }
  _DATA::lpbBattleT._0_2_ = 0;
  _DATA::lpbBattleT._2_2_ = 0;
  _DATA::lpbBattleLog._0_2_ = 0;
  _DATA::lpbBattleLog._2_2_ = 0;
  _DATA::lpbBattleCur._0_2_ = 0;
  _DATA::lpbBattleCur._2_2_ = 0;
  _DATA::gd.flags1 = _DATA::gd.flags1 & 0xebff;
  _DATA::gd.flags3 = _DATA::gd.flags3 & 0xfbff;
  MEMORY::ResetHb(htBattle);
  if (((int)_DATA::rglphb[11] != 0) || (_DATA::rglphb[11]._2_2_ != 0)) {
    *(undefined2 *)((int)_DATA::rglphb[11] + 0x12) = 0xffff;
  }
  MEMORY::ResetHb(htMisc);
  MEMORY::ResetHb(htString);
  MEMORY::ResetHb(htShips);
  MEMORY::ResetHb(htOrd);
  MEMORY::ResetHb(htPlrMsg);
  for (i = 0; i < 0x10; i = i + 1) {
    *(undefined2 *)(i * 4 + 0xfe) = 0;
    *(undefined2 *)(i * 4 + 0x100) = 0;
    *(undefined2 *)(i * 4 + 0x14c) = 0;
    *(undefined2 *)(i * 4 + 0x14e) = 0;
    *(undefined2 *)((int)c_common::rglpbtlplan + i * 4) = 0;
    *(undefined2 *)((int)&DAT_1120_593a + i * 4) = 0;
    *(undefined *)((int)c_common::rgcbtlplan + i) = 0;
  }
  if (c_common::sel.grobj != grobjNone) {
    c_common::ini.flags6 =
         c_common::ini.flags6 & 0xfe1fU |
         (c_common::sel.grobj & (grobjPlanet|grobjFleet|grobjOther|grobjThing)) << 5;
    c_common::ini.iObjSel = c_common::sel.id;
    c_common::ini.idPlayer = _DATA::idPlayer;
    c_common::ini.lid._0_2_ = (undefined2)_DATA::game.lid;
    c_common::ini.lid._2_2_ = _DATA::game.lid._2_2_;
  }
  _DATA::idPlayer = -1;
  _DATA::imemLogCur = 0;
  _DATA::imemLogPrev = -1;
  _DATA::iMsgCur = 0;
  _DATA::vlpbAiData._0_2_ = 0;
  _DATA::vlpbAiData._2_2_ = 0;
  MSG::ResetMessages();
  _DATA::lSaltCur._0_2_ = 0;
  _DATA::lSaltCur._2_2_ = 0;
  _DATA::ctickLast._0_2_ = 0;
  _DATA::ctickLast._2_2_ = 0;
  _DATA::game.lid._0_2_ = 0;
  _DATA::game.lid._2_2_ = 0;
  _DATA::game.cPlayer = 0;
  _DATA::game.cPlanMax = 0;
  _DATA::game.fDirty = 0;
  _DATA::game.turn = 0;
  _DATA::game.szName[0] = '\0';
  _DATA::gd.flags2 = _DATA::gd.flags2 & 0xfffe;
  _DATA::gd.flags1 = _DATA::gd.flags1 & 0xfeff;
  if (_DATA::hwndBrowser != 0) {
    DestroyWindow(_DATA::hwndBrowser);
  }
  if (_DATA::hwndReportDlg != 0) {
    DestroyWindow(_DATA::hwndReportDlg);
  }
  if (_DATA::hwndPopup != 0) {
    DestroyWindow(_DATA::hwndPopup);
    _DATA::hwndPopup = 0;
  }
  _DATA::hwndActive = 0;
  c_common::sel.scan.grobjFull = grobjNone;
  c_common::sel.scan.grobj = grobjNone;
  c_common::sel.scan.iwp = -1;
  c_common::sel.scan.ifl = -1;
  c_common::sel.scan.idpl = -1;
  _DATA::fOrdersVis = 0;
  c_common::sel.grobjFull = grobjNone;
  c_common::sel.grobj = grobjNone;
  c_common::sel.id = -1;
  c_common::sel.pt.y = 0;
  c_common::sel.pt.x = 0;
  c_common::sel.pl.id = -1;
  c_common::sel.fl.flags1 = -1;
  c_common::sel.fl.lpplord._0_2_ = 0;
  c_common::sel.fl.lpplord._2_2_ = 0;
  c_common::sel.pl.lpplprod._0_2_ = 0;
  c_common::sel.pl.lpplprod._2_2_ = 0;
  _DATA::dxPlanetProdLB = 0;
  _DATA::dxOrderED = 0;
  _DATA::dxFleetCompLB = 0;
  _DATA::dxShipLB = 0;
  c_common::dxShipDD = 0;
  for (i = 0; i < 3; i = i + 1) {
    *(undefined2 *)(i * 2 + 0x85c) = 0;
  }
  return;
}



// ======================================================================
// Function: RgFromStream
// Address: 1070:53f4
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __cdecl16far IO::RgFromStream(void *rg,ushort cb)

{
  ushort uVar1;
  
  if (cb != 0) {
    if (((int)_DATA::vlpMemStream == 0) && (_DATA::vlpMemStream._2_2_ == 0)) {
      uVar1 = _lread(cb,rg,_DATA::hf);
      if (uVar1 != cb) {
        FileError(idsGameFileAppearsCorruptUnableLoadFile);
        PUBLIC::_longjmp(_penvMem,-1);
      }
    }
    else {
      PUBLIC::__fmemcpy(rg,(void *)CONCAT22(_DATA::vlpMemStream._2_2_,(int)_DATA::vlpMemStream),cb);
      _DATA::vlpMemStream._0_2_ = (int)_DATA::vlpMemStream + cb;
    }
  }
  return;
}



// ======================================================================
// Function: FBogusLong
// Address: 1070:484c
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10704887) */

short __cdecl16far IO::FBogusLong(ulong lSerial)

{
  short i;
  
  i = 0;
  while (CONCAT22(*(undefined2 *)(i * 4 + 0x768),*(undefined2 *)(i * 4 + 0x766)) <
         (lSerial ^ 0xa5a5a5a5)) {
    i = i + 1;
  }
  return (uint)((lSerial ^ 0xa5a5a5a5) ==
               CONCAT22(*(undefined2 *)(i * 4 + 0x768),*(undefined2 *)(i * 4 + 0x766)));
}



// ======================================================================
// Function: FLoadLogFile
// Address: 1048:c7a2
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short __cdecl16far PLANET::FLoadLogFile(char *pszLog)

{
  undefined2 uVar1;
  int iVar2;
  short sVar3;
  HRSRC HVar4;
  int iVar5;
  undefined2 *puVar6;
  undefined2 uVar7;
  bool bVar8;
  void *pvVar9;
  short cSkip;
  ushort hrsrc;
  MSGPLR *lpmp;
  short iCur;
  short cbLog;
  short fRet;
  short env [9];
  short (*penvMemSav) [9];
  ushort hres;
  
  uVar1 = _penvMem;
  _DATA::imemLogCur = 0;
  _DATA::imemLogPrev = -1;
  _penvMem = env;
  sVar3 = PUBLIC::__setjmp(env);
  if (sVar3 != 0) {
    if (((int)_DATA::vlpMemStream == 0) && (_DATA::vlpMemStream._2_2_ == 0)) {
      if (_DATA::hf != -1) {
        _penvMem = (short *)uVar1;
        IO::StreamClose();
        return 0;
      }
      _penvMem = (short *)uVar1;
      return 1;
    }
    _penvMem = (short *)uVar1;
    GlobalUnlock(hres);
    FreeResource(hres);
    return 0;
  }
  if (((((uint)_DATA::game.flags9 >> 3 & 1) == 0) || (_DATA::idPlayer != 0)) ||
     (((uint)_DATA::gd.flags1 >> 1 & 1) == 0)) {
PLANET_StrOpen:
    IO::StreamOpen(pszLog,0x4020);
LAB_1048_c944:
    IO::ReadRt();
    if ((((int)_DATA::game.lid == c_common::rgbCur._4_2_) &&
        (_DATA::game.lid._2_2_ == c_common::rgbCur._6_2_)) &&
       ((uint)_DATA::game.turn <= (uint)c_common::rgbCur._10_2_)) {
      if (c_common::rgbCur._10_2_ == _DATA::game.turn) {
        if ((uint)c_common::rgbCur._14_2_ >> 0xd == ((uint)_DATA::game.flags9 >> 9 & 7)) {
          _DATA::wVersFile = c_common::rgbCur._8_2_;
          _DATA::gd.flags2 =
               _DATA::gd.flags2 & 0xfffbU | ((uint)c_common::rgbCur._14_2_ >> 0xc & 1) << 2;
          if (((uint)_DATA::gd.flags1 >> 1 & 1) != 0) {
            *(uint *)((int)&c_common::rgplr[0].flags43 + _DATA::idPlayer * 0xc0) =
                 *(uint *)((int)&c_common::rgplr[0].flags43 + _DATA::idPlayer * 0xc0) & 0xfffd |
                 ((uint)c_common::rgbCur._14_2_ >> 0xc & 1) << 1;
          }
          IO::ReadRt();
          sVar3 = c_common::rgbCur._0_2_;
          if ((((uint)_DATA::gd.flags1 >> 1 & 1) != 0) &&
             ((((int)_DATA::vrgts != 0 || (_DATA::vrgts._2_2_ != 0)) &&
              (PUBLIC::__fmemset((void *)CONCAT22(_DATA::vrgts._2_2_,
                                                  (int)_DATA::vrgts + _DATA::idPlayer * 0x10),0,0x10
                                ), iVar2 = c_common::rgbCur._4_2_, iVar5 = _DATA::vrgts._2_2_,
              (c_common::hdrCur.flags1 & 0x3ffU) == 0x11)))) {
            puVar6 = (undefined2 *)((int)_DATA::vrgts + _DATA::idPlayer * 0x10);
            *puVar6 = c_common::rgbCur._2_2_;
            puVar6[1] = iVar2;
            PUBLIC::__fmemcpy((void *)CONCAT22(_DATA::vrgts._2_2_,
                                               (int)_DATA::vrgts + _DATA::idPlayer * 0x10 + 4),
                              c_common::rgbCur + 6,0xb);
          }
          for (iCur = 0; iCur < sVar3; iCur = iCur + (c_common::hdrCur.flags1 & 0x3ffU) + 2) {
            IO::ReadRt();
            PUBLIC::__fmemmove((void *)CONCAT22(_DATA::lpLog._2_2_,(int)_DATA::lpLog + iCur),
                               &c_common::hdrCur,2);
            PUBLIC::__fmemmove((void *)CONCAT22(_DATA::lpLog._2_2_,(int)_DATA::lpLog + iCur + 2),
                               c_common::rgbCur,c_common::hdrCur.flags1 & 0x3ff);
          }
          IO::ReadRt();
          lpmp = (MSGPLR *)&_DATA::vlpmsgplrOut;
          while( true ) {
            uVar7 = (undefined2)((ulong)lpmp >> 0x10);
            if ((*(int *)&lpmp->lpmsgplrNext == 0) && (*(int *)((int)lpmp + 2) == 0)) break;
            lpmp = (MSGPLR *)
                   CONCAT22(*(undefined2 *)((int)lpmp + 2),*(undefined2 *)&lpmp->lpmsgplrNext);
          }
          while ((uint)c_common::hdrCur.flags1 >> 10 == 0x28) {
            pvVar9 = MEMORY::LpAlloc(c_common::hdrCur.flags1 & 0x3ff,htPlrMsg);
            uVar7 = (undefined2)((ulong)lpmp >> 0x10);
            *(int *)&lpmp->lpmsgplrNext = (int)pvVar9;
            *(undefined2 *)((int)lpmp + 2) = (int)((ulong)pvVar9 >> 0x10);
            iVar5 = *(int *)&lpmp->lpmsgplrNext;
            uVar7 = *(undefined2 *)((int)lpmp + 2);
            lpmp = (MSGPLR *)CONCAT22(uVar7,iVar5);
            PUBLIC::__fmemcpy((void *)CONCAT22(uVar7,iVar5),c_common::rgbCur,
                              c_common::hdrCur.flags1 & 0x3ff);
            *(undefined2 *)&lpmp->lpmsgplrNext = 0;
            *(undefined2 *)(iVar5 + 2) = 0;
            _DATA::vcmsgplrOut = _DATA::vcmsgplrOut + 1;
            IO::ReadRt();
          }
          bVar8 = (uint)c_common::hdrCur.flags1 >> 10 == 0;
          if (bVar8) {
            _DATA::imemLogCur = sVar3;
          }
          fRet = (short)bVar8;
          if (((int)_DATA::vlpMemStream == 0) && (_DATA::vlpMemStream._2_2_ == 0)) {
            IO::StreamClose();
          }
          else {
            GlobalUnlock(hres);
            FreeResource(hres);
            _DATA::vlpMemStream = (byte *)0x0;
          }
          _penvMem = (short *)uVar1;
          DirtyGame(0);
          return fRet;
        }
        IO::FileError(idsFileGame);
      }
      else {
        IO::FileError(idsLogFileRecentGameTryingLoadIgnoring);
      }
    }
    if (((int)_DATA::vlpMemStream == 0) && (_DATA::vlpMemStream._2_2_ == 0)) {
      IO::StreamClose();
    }
    else {
      _DATA::vlpMemStream = (byte *)0x0;
      GlobalUnlock(hres);
      FreeResource(hres);
    }
    sVar3 = 1;
  }
  else {
    cSkip = _DATA::game.turn;
    HVar4 = FindResource(c_common::hInst,(LPCSTR)0x2711,(LPCSTR)0x2710);
    hres = LoadResource(c_common::hInst,HVar4);
    if (hres != 0) {
      _DATA::vlpMemStream = (byte *)LockResource(hres);
      iVar5 = (int)((ulong)_DATA::vlpMemStream >> 0x10);
      if (((int)_DATA::vlpMemStream != 0) || (iVar5 != 0)) {
        if ((uint)*_DATA::vlpMemStream <= (uint)_DATA::game.turn) {
          _DATA::vlpMemStream = (byte *)0x0;
          GlobalUnlock(hres);
          FreeResource(hres);
          goto PLANET_StrOpen;
        }
        _DATA::vlpMemStream = (byte *)CONCAT22(iVar5,(int)_DATA::vlpMemStream + 1);
        while (iVar5 = cSkip + -1, cSkip != 0) {
          do {
            _DATA::vlpMemStream =
                 (byte *)CONCAT22(_DATA::vlpMemStream._2_2_,
                                  (int)_DATA::vlpMemStream +
                                  (*(uint *)_DATA::vlpMemStream & 0x3ff) + 2);
            cSkip = iVar5;
          } while (*(uint *)_DATA::vlpMemStream >> 10 != 8);
        }
        goto LAB_1048_c944;
      }
    }
    sVar3 = 0;
  }
  _penvMem = (short *)uVar1;
  return sVar3;
}



