// Decompiled code from stars.exe (Stars! 2.60j RC3)
// Generated by Ghidra
// 

// ======================================================================
// Function: IPlrAlsoCheater
// Address: 1018:07aa
// ======================================================================


short __cdecl16far MAIN::IPlrAlsoCheater(short iplr)

{
  short sVar1;
  undefined2 *puVar2;
  int *piVar3;
  int *piVar4;
  short i;
  
  puVar2 = (undefined2 *)((int)_DATA::vrgts + iplr * 0x10);
  sVar1 = IO::FValidSerialLong(CONCAT22(puVar2[1],*puVar2));
  if (sVar1 != 0) {
    for (i = 0; i < _DATA::game.cPlayer; i = i + 1) {
      if ((i != iplr) && ((*(uint *)((int)&c_common::rgplr[0].flags43 + i * 0xc0) >> 2 & 1) != 0)) {
        piVar3 = (int *)((int)_DATA::vrgts + i * 0x10);
        piVar4 = (int *)((int)_DATA::vrgts + iplr * 0x10);
        if ((*piVar4 == *piVar3) &&
           ((piVar4[1] == piVar3[1] &&
            (sVar1 = PUBLIC::__fmemcmp((void *)CONCAT22(_DATA::vrgts._2_2_,
                                                        (int)_DATA::vrgts + iplr * 0x10 + 4),
                                       (void *)CONCAT22(_DATA::vrgts._2_2_,
                                                        (int)_DATA::vrgts + i * 0x10 + 4),0xb),
            sVar1 != 0)))) {
          return i;
        }
      }
    }
  }
  return -1;
}



// ======================================================================
// Function: SpankTheCheaters
// Address: 10f0:192a
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10f01bdb) */
/* WARNING: Removing unreachable block (ram,0x10f01be0) */
/* WARNING: Removing unreachable block (ram,0x10f01d8c) */
/* WARNING: Removing unreachable block (ram,0x10f01d75) */
/* WARNING: Removing unreachable block (ram,0x10f01c5e) */
/* WARNING: Could not reconcile some variable overlaps */

void __cdecl16far BATTLE::SpankTheCheaters(void)

{
  uint *puVar1;
  int iVar2;
  int iVar3;
  uint uVar4;
  int iVar5;
  bool bVar6;
  short sVar7;
  short sVar8;
  uint uVar9;
  ushort uVar10;
  int *piVar11;
  undefined2 *puVar12;
  uint *puVar13;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar14;
  ulong uVar15;
  long lVar16;
  ulong uVar17;
  ulong uVar18;
  PLANET *lpplMac;
  char rgfCheater [16];
  short fSellOff;
  short fCheater;
  long pctSell;
  short i;
  short ifl;
  FLEET *lpfl;
  PLANET *lppl;
  long lSell;
  
  uVar18 = CONCAT22(unaff_SI,unaff_DI);
  fCheater = 0;
  for (i = 0; i < _DATA::game.cPlayer; i = i + 1) {
    uVar9 = *(uint *)((int)&c_common::rgplr[0].flags43 + i * 0xc0) >> 2;
    rgfCheater[i] = (byte)uVar9 & 1;
    if ((uVar9 & 1) != 0) {
      fCheater = 1;
    }
  }
  if ((fCheater != 0) && (9 < (uint)_DATA::game.turn)) {
    for (ifl = 0; ifl < c_common::cFleet; ifl = ifl + 1) {
      piVar11 = (int *)((int)_DATA::rglpfl + ifl * 4);
      iVar3 = *piVar11;
      iVar2 = piVar11[1];
      lpfl = (FLEET *)CONCAT22(iVar2,iVar3);
      if ((iVar3 == 0) && (iVar2 == 0)) break;
      if (((*(uint *)(iVar3 + 4) >> 10 & 1) == 0) && (rgfCheater[*(int *)(iVar3 + 2)] != '\0')) {
        sVar7 = UTILGEN::Random(0xc);
        if (sVar7 == 0) {
          *(uint *)(iVar3 + 4) = *(uint *)(iVar3 + 4) & 0xfbff | 0x400;
          MSG::FSendPlrMsg2(*(short *)(iVar3 + 2),idmHasDefectedRanksDueInabilityProjectLegitimate,
                            -5,lpfl->flags1,0);
        }
        else {
          bVar6 = false;
          for (i = 0; i < 3; i = i + 1) {
            piVar11 = (int *)(iVar3 + 0x4c + i * 4);
            iVar5 = piVar11[1];
            if ((-1 < iVar5) && ((0 < iVar5 || (*piVar11 != 0)))) {
              if (!bVar6) {
                sVar7 = UTILGEN::Random(0xb);
                pctSell._0_2_ = sVar7 + 10;
                pctSell._2_2_ = (int)pctSell >> 0xf;
                bVar6 = true;
              }
              lVar16 = 100;
              puVar12 = (undefined2 *)(iVar3 + 0x4c + i * 4);
              uVar15 = PUBLIC::__aFulmul(CONCAT22(puVar12[1],*puVar12),
                                         CONCAT22(pctSell._2_2_,(int)pctSell));
              lVar16 = PUBLIC::__aFldiv(uVar15,lVar16);
              if (lVar16 == 0) {
                lVar16 = 1;
              }
              lSell._2_2_ = (int)((ulong)lVar16 >> 0x10);
              lSell._0_2_ = (uint)lVar16;
              puVar13 = (uint *)(iVar3 + 0x4c + i * 4);
              puVar1 = puVar13;
              uVar9 = *puVar1;
              *puVar1 = *puVar1 - (uint)lSell;
              puVar1 = puVar13 + 1;
              *puVar1 = (*puVar1 - lSell._2_2_) - (uint)(uVar9 < (uint)lSell);
            }
          }
          if (bVar6) {
            MSG::FSendPlrMsg2(*(short *)(iVar3 + 2),idmCrewHasSoldOffCargoBlackMarket,-5,
                              lpfl->flags1,(int)pctSell);
          }
        }
      }
    }
    uVar9 = (ushort)_DATA::lpPlanets + c_common::cPlanet * 0x38;
    lppl = (PLANET *)CONCAT22(_DATA::lpPlanets._2_2_,(ushort)_DATA::lpPlanets);
    uVar10 = (ushort)_DATA::lpPlanets;
    while ((uint)lppl < uVar9) {
      uVar14 = (undefined2)((ulong)lppl >> 0x10);
      if ((*(int *)((uint)lppl + 2) != -1) && (rgfCheater[*(int *)((uint)lppl + 2)] != '\0')) {
        uVar15 = PUBLIC::__aFulshr(uVar18,uVar10);
        if (((uVar15 & 0xfff) == 0) || (sVar7 = UTILGEN::Random(8), sVar7 != 0)) {
          sVar7 = UTILGEN::Random(0xf);
          if (sVar7 == 0) {
            sVar7 = UTILGEN::Random(3);
            sVar8 = UTILGEN::Random(0x29);
            lVar16 = 100;
            puVar12 = (undefined2 *)((uint)lppl + 0x1c + sVar7 * 4);
            uVar15 = PUBLIC::__aFulmul(CONCAT22(puVar12[1],*puVar12),(long)(sVar8 + 5));
            lVar16 = PUBLIC::__aFldiv(uVar15,lVar16);
            if (0 < lVar16) {
              if (30000 < lVar16) {
                lVar16 = 30000;
              }
              lSell._2_2_ = (int)((ulong)lVar16 >> 0x10);
              lSell._0_2_ = (uint)lVar16;
              puVar13 = (uint *)((uint)lppl + 0x1c + sVar7 * 4);
              puVar1 = puVar13;
              uVar4 = *puVar1;
              *puVar1 = *puVar1 - (uint)lSell;
              puVar1 = puVar13 + 1;
              *puVar1 = (*puVar1 - lSell._2_2_) - (uint)(uVar4 < (uint)lSell);
              MSG::FSendPlrMsg(*(short *)((uint)lppl + 2),
                               idmFreedomFightersHaveStolenKtStockpilesPress,-5,lppl->id,(uint)lSell
                               ,sVar7 + 1,0,0,0,0);
            }
          }
        }
        else {
          sVar7 = UTILGEN::Random(0x1f);
          lVar16 = 100;
          uVar17 = (ulong)(sVar7 + 5);
          uVar15 = PUBLIC::__aFulshr(uVar17,100);
          uVar15 = PUBLIC::__aFulmul(uVar15 & 0xfff,uVar17);
          lVar16 = PUBLIC::__aFldiv(uVar15,lVar16);
          if (lVar16 < 1) {
            lVar16 = 1;
          }
          lSell._0_2_ = (uint)lVar16;
          uVar4 = *(uint *)((uint)lppl + 0x14);
          iVar3 = *(int *)((uint)lppl + 0x16);
          uVar10 = uVar4 + (uint)lSell * -0x100 & 0xff00;
          puVar1 = (uint *)((uint)lppl + 0x14);
          *puVar1 = *puVar1 & 0xff;
          puVar1 = (uint *)((uint)lppl + 0x16);
          *puVar1 = *puVar1 & 0xfff0;
          puVar1 = (uint *)((uint)lppl + 0x14);
          *puVar1 = *puVar1 | uVar10;
          puVar1 = (uint *)((uint)lppl + 0x16);
          *puVar1 = *puVar1 | iVar3 - (uint)(uVar4 < (uint)lSell * 0x100) & 0xf;
          MSG::FSendPlrMsg2(*(short *)((uint)lppl + 2),
                            idmFreedomFightersHaveAttackedDestroyedMinesPress,-5,lppl->id,
                            (uint)lSell);
        }
      }
      lppl = (PLANET *)CONCAT22(uVar14,(uint)lppl + 0x38);
    }
  }
  return;
}



// ======================================================================
// Function: CAdvantagePoints
// Address: 10e0:444c
// ======================================================================


/* WARNING: Could not reconcile some variable overlaps */

short __cdecl16far RACE::CAdvantagePoints(PLAYER *pplr)

{
  long lVar1;
  char cVar2;
  short sVar3;
  undefined2 uVar4;
  short sVar5;
  short sVar6;
  int iVar7;
  int iVar8;
  int iVar9;
  short sVar10;
  uint uVar11;
  undefined2 uVar12;
  bool bVar13;
  ulong uVar14;
  ulong uVar15;
  long lVar16;
  long lVar17;
  short cProduce;
  short cOperate;
  short raMajor;
  long lInnate;
  short cGood;
  short rgi [3];
  short i;
  short cCur;
  short cBad;
  long cPoints;
  short iSpread;
  short pctGrowth;
  
  cPoints._0_2_ = 0x672;
  BoundsCheckPlayer(pplr);
  sVar3 = GetRaceStat(pplr,rsMajorAdv);
  uVar12 = 0;
  lVar16 = 2000;
  uVar4 = LInnateRaceHabitability();
  uVar14 = PUBLIC::__aFldiv(CONCAT22(uVar12,uVar4),lVar16);
  if (pplr->pctIdealGrowth < '\x15') {
    cVar2 = pplr->pctIdealGrowth;
  }
  else {
    cVar2 = '\x14';
  }
  if (cVar2 < '\x01') {
    iSpread = 1;
  }
  else if (pplr->pctIdealGrowth < '\x15') {
    iSpread = (short)pplr->pctIdealGrowth;
  }
  else {
    iSpread = 0x14;
  }
  if (iSpread != pplr->pctIdealGrowth) {
    iSpread = 1;
    pplr->pctIdealGrowth = '\x01';
    pplr->flags43 = pplr->flags43 & 0xffefU | 0x10;
  }
  sVar10 = iSpread;
  if (iSpread < 6) {
    uVar15 = PUBLIC::__aFulmul((long)(6 - iSpread),0x1068);
    uVar15 = uVar15 + 0x672;
  }
  else {
    if (iSpread < 0xe) {
      if (iSpread == 6) {
        cPoints._0_2_ = (int)s__s__d_1120_147d + 5;
      }
      else if (iSpread == 7) {
        cPoints._0_2_ = 0xf3c;
      }
      else if (iSpread == 8) {
        cPoints._0_2_ = 0x8ca;
      }
      else if (iSpread == 9) {
        cPoints._0_2_ = 0x753;
      }
      iSpread = (iSpread + -5) * 2 + 5;
    }
    else if (iSpread < 0x14) {
      iSpread = (iSpread + -0xd) * 3 + 0x15;
    }
    else {
      iSpread = 0x2d;
    }
    uVar15 = (ulong)(uint)cPoints;
  }
  lVar16 = 0x18;
  uVar14 = PUBLIC::__aFulmul(uVar14,(long)iSpread);
  lVar16 = PUBLIC::__aFldiv(uVar14,lVar16);
  lVar16 = uVar15 - lVar16;
  cGood = 0;
  i = 0;
  while( true ) {
    cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
    cPoints._0_2_ = (uint)lVar16;
    if (2 < i) break;
    if (pplr->rgEnvVar[i] < '\0') {
      cGood = cGood + 1;
    }
    else {
      sVar5 = PUBLIC::_abs(pplr->rgEnvVar[i] + -0x32);
      lVar16 = lVar16 + sVar5 * 4;
    }
    i = i + 1;
  }
  if (1 < cGood) {
    lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 0x96),(uint)cPoints - 0x96);
  }
  sVar5 = GetRaceStat(pplr,rsFactOperate);
  sVar6 = GetRaceStat(pplr,rsFactProd);
  if ((10 < sVar5) || (10 < sVar6)) {
    if (sVar5 + -9 < 1) {
      iVar7 = 1;
    }
    else {
      iVar7 = sVar5 + -9;
    }
    if (sVar6 + -9 < 1) {
      iVar8 = 1;
    }
    else {
      iVar8 = sVar6 + -9;
    }
    if (sVar3 == 0) {
      iVar9 = 3;
    }
    else {
      iVar9 = 2;
    }
    if (cGood < 2) {
      lVar17 = 9;
      uVar15 = (ulong)sVar10;
      uVar14 = PUBLIC::__aFulmul((long)iVar7,(long)(iVar9 * iVar8));
      uVar14 = PUBLIC::__aFulmul(uVar14,uVar15);
      lVar17 = PUBLIC::__aFldiv(uVar14,lVar17);
      lVar16 = lVar16 - lVar17;
    }
    else {
      lVar17 = 2;
      uVar15 = (ulong)sVar10;
      uVar14 = PUBLIC::__aFulmul((long)iVar7,(long)(iVar9 * iVar8));
      uVar14 = PUBLIC::__aFulmul(uVar14,uVar15);
      lVar17 = PUBLIC::__aFldiv(uVar14,lVar17);
      lVar16 = lVar16 - lVar17;
    }
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  iVar7 = GetRaceStat(pplr,rsResGen);
  if (0x18 < iVar7) {
    iVar7 = 0x19;
  }
  if (iVar7 < 8) {
    lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 0x960),(uint)cPoints - 0x960);
  }
  else if (iVar7 == 8) {
    lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 0x4ec),(uint)cPoints - 0x4ec);
  }
  else if (iVar7 == 9) {
    lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 600),(uint)cPoints - 600);
  }
  else if (10 < iVar7) {
    lVar16 = lVar16 + (iVar7 + -10) * 0x78;
  }
  if (sVar3 == 8) {
    lVar16 = lVar16 + 0xd2;
  }
  else {
    sVar10 = GetRaceStat(pplr,rsFactProd);
    iVar8 = 10 - sVar10;
    sVar10 = GetRaceStat(pplr,rsFactBuild);
    iVar7 = 10 - sVar10;
    sVar10 = GetRaceStat(pplr,rsFactOperate);
    iVar9 = 10 - sVar10;
    if (iVar8 < 1) {
      cCur = iVar8 * 0x79;
    }
    else {
      cCur = iVar8 * 100;
    }
    if (iVar7 < 0) {
      iVar7 = iVar7 * -0x37;
    }
    else {
      iVar7 = iVar7 * iVar7 * -0x3c;
    }
    cCur = cCur + iVar7;
    if (iVar9 < 1) {
      iVar7 = iVar9 * 0x23;
    }
    else {
      iVar7 = iVar9 * 0x28;
    }
    cCur = cCur + iVar7;
    if (700 < cCur) {
      cCur = (cCur + -700) / 3 + 700;
    }
    if (iVar9 < -6) {
      if (iVar9 < -0xb) {
        if (iVar9 < -0xe) {
          cCur = cCur + -0x168;
        }
        else {
          cCur = cCur - ((-0xc - iVar9) * 0x2d + 0xe1);
        }
      }
      else {
        cCur = cCur + (-6 - iVar9) * -0x1e;
      }
    }
    if (iVar8 < -2) {
      cCur = cCur + (-2 - iVar8) * -0x3c;
    }
    lVar16 = lVar16 + cCur;
    sVar10 = GetRaceGrbit(pplr,ibitRaceCheapFact);
    if (sVar10 != 0) {
      lVar16 = CONCAT22((int)((ulong)lVar16 >> 0x10) - (uint)((uint)lVar16 < 0xaf),
                        (uint)lVar16 - 0xaf);
    }
    sVar10 = GetRaceStat(pplr,rsMineProd);
    iVar8 = 10 - sVar10;
    sVar10 = GetRaceStat(pplr,rsMineBuild);
    sVar5 = GetRaceStat(pplr,rsMineOperate);
    iVar7 = 10 - sVar5;
    if (iVar8 < 1) {
      cCur = iVar8 * 0xa9;
    }
    else {
      cCur = iVar8 * 100;
    }
    if (3 - sVar10 < 1) {
      cCur = cCur - ((3 - sVar10) * 0x41 + -0x50);
    }
    else {
      cCur = cCur + -0x168;
    }
    if (iVar7 < 1) {
      iVar7 = iVar7 * 0x23;
    }
    else {
      iVar7 = iVar7 * 0x28;
    }
    cCur = cCur + iVar7;
    lVar16 = lVar16 + cCur;
  }
  lVar16 = lVar16 - *(int *)((int)&c_common::rgshdef[8].hul + 0x78 + sVar3 * 2);
  cBad = 0;
  cGood = 0;
  for (i = 0; i < 0xe; i = i + 1) {
    sVar10 = GetRaceGrbit(pplr,i);
    if (sVar10 != 0) {
      if (*(int *)((int)&c_common::rgshdef[8].grbitPlr + 1 + i * 2) < 0) {
        cBad = cBad + 1;
      }
      else {
        cGood = cGood + 1;
      }
      lVar16 = lVar16 + *(int *)((int)&c_common::rgshdef[8].grbitPlr + 1 + i * 2);
    }
  }
  if (4 < cBad + cGood) {
    lVar16 = lVar16 - (cBad + cGood) * 10 * (cBad + cGood + -4);
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  if (3 < cGood - cBad) {
    iVar7 = (cGood - cBad) + -3;
    uVar11 = iVar7 * 0x3c;
    lVar16 = CONCAT22((cPoints._2_2_ - ((int)uVar11 >> 0xf)) - (uint)((uint)cPoints < uVar11),
                      (uint)cPoints + iVar7 * -0x3c);
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  if (3 < cBad - cGood) {
    iVar7 = (cBad - cGood) + -3;
    uVar11 = iVar7 * 0x28;
    lVar16 = CONCAT22((cPoints._2_2_ - ((int)uVar11 >> 0xf)) - (uint)((uint)cPoints < uVar11),
                      (uint)cPoints + iVar7 * -0x28);
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  sVar10 = GetRaceGrbit(pplr,ibitRaceNoAdvScanner);
  if (sVar10 != 0) {
    if (sVar3 == 6) {
      lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 0x118),(uint)cPoints - 0x118);
    }
    else if (sVar3 == 1) {
      lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 200),(uint)cPoints - 200);
    }
    else if (sVar3 == 9) {
      lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 0x28),(uint)cPoints - 0x28);
    }
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  cCur = 0;
  for (i = 8; i < 0xe; i = i + 1) {
    sVar10 = GetRaceStat(pplr,i);
    cCur = cCur + sVar10 + -1;
  }
  if (cCur < 1) {
    if (cCur < 0) {
      iVar7 = *(int *)((int)&c_common::rgshdef[9].hul + 0x15 + (-1 - cCur) * 2);
      lVar1 = lVar16 + iVar7;
      uVar11 = (uint)lVar1;
      lVar17 = lVar16 + iVar7;
      lVar16 = lVar16 + iVar7;
      if ((cCur != -4 && 3 < -cCur) &&
         (sVar10 = GetRaceStat(pplr,rsResGen), lVar16 = lVar17, sVar10 < 10)) {
        lVar16 = CONCAT22((int)((ulong)lVar1 >> 0x10) - (uint)(uVar11 < 0xbe),uVar11 - 0xbe);
      }
    }
  }
  else {
    uVar11 = cCur * cCur * 0x82;
    bVar13 = (uint)cPoints < uVar11;
    cPoints._0_2_ = (uint)cPoints + cCur * cCur * -0x82;
    cPoints._2_2_ = (cPoints._2_2_ - ((int)uVar11 >> 0xf)) - (uint)bVar13;
    if (cCur == 6) {
      bVar13 = 0xfa69 < (uint)cPoints;
      cPoints._0_2_ = (uint)cPoints + 0x596;
      cPoints._2_2_ = cPoints._2_2_ + (uint)bVar13;
    }
    else if (cCur == 5) {
      bVar13 = 0xfdf7 < (uint)cPoints;
      cPoints._0_2_ = (uint)cPoints + 0x208;
      cPoints._2_2_ = cPoints._2_2_ + (uint)bVar13;
    }
    lVar16 = CONCAT22(cPoints._2_2_,(uint)cPoints);
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  sVar10 = GetRaceGrbit(pplr,ibitRaceTech3);
  if (sVar10 != 0) {
    lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 0xb4),(uint)cPoints - 0xb4);
  }
  cPoints._2_2_ = (int)((ulong)lVar16 >> 0x10);
  cPoints._0_2_ = (uint)lVar16;
  if ((sVar3 == 8) && (sVar3 = GetRaceStat(pplr,rsTechBonus1), sVar3 == 2)) {
    lVar16 = CONCAT22(cPoints._2_2_ - (uint)((uint)cPoints < 100),(uint)cPoints - 100);
  }
  lVar16 = PUBLIC::__aFldiv(lVar16,3);
  return (short)lVar16;
}



// ======================================================================
// Function: FSendPlrMsg
// Address: 1030:7ee8
// ======================================================================


short __cdecl16far
MSG::FSendPlrMsg(short iPlr,MessageId iMsg,short iObj,short p1,short p2,short p3,short p4,short p5,
                short p6,short p7)

{
  ushort uVar1;
  uint uVar2;
  undefined2 unaff_SS;
  byte *lpb;
  short cbMsg;
  byte rgbWork [40];
  
  uVar1 = PackageUpMsg(rgbWork,iPlr,iMsg,iObj,p1,p2,p3,p4,p5,p6,p7);
  if ((int)uVar1 < 1) {
    uVar2 = (uint)(uVar1 == 0);
  }
  else {
    PUBLIC::__fmemmove((void *)CONCAT22(_DATA::lpMsg._2_2_,(int)_DATA::lpMsg + _DATA::imemMsgCur),
                       (void *)CONCAT22(unaff_SS,rgbWork),uVar1);
    _DATA::imemMsgCur = _DATA::imemMsgCur + uVar1;
    _DATA::cMsg = _DATA::cMsg + 1;
    uVar2 = 1;
  }
  return uVar2;
}



// ======================================================================
// Function: FSendPlrMsg2
// Address: 1030:7eaa
// ======================================================================


short __cdecl16far MSG::FSendPlrMsg2(short iPlr,MessageId iMsg,short iObj,short p1,short p2)

{
  short sVar1;
  
  sVar1 = FSendPlrMsg(iPlr,iMsg,iObj,p1,p2,0,0,0,0,0);
  return sVar1;
}



// ======================================================================
// Function: PackageUpMsg
// Address: 1030:802a
// ======================================================================


/* WARNING: Could not reconcile some variable overlaps */

short __cdecl16far
MSG::PackageUpMsg(byte *pb,short iPlr,MessageId iMsg,short iObj,short p1,short p2,short p3,short p4,
                 short p5,short p6,short p7)

{
  uint *puVar1;
  uint uVar2;
  int iVar3;
  short sVar4;
  byte *lpbBase;
  byte *lpb;
  MSGTURN *lpmt;
  ushort grbit;
  short i;
  short *pi;
  
  if (iPlr == -1) {
    sVar4 = 0;
  }
  else if (((((*(uint *)((int)&c_common::rgplr[0].flags4 + iPlr * 0xc0) >> 9 & 1) == 0) ||
            (*(uint *)((int)&c_common::rgplr[0].flags4 + iPlr * 0xc0) >> 0xd == 7)) ||
           (iMsg == idmHasBombedKillingOffEnemyColonists)) ||
          (((iMsg == idmHaveAttackedFirstRateStormTroopersThough ||
            (iMsg == idmColonistsHaveDiedOffLongerControlPlanet)) ||
           (iMsg == idmColonistsHaveJumpedShipLongerControlPlanet)))) {
    if (_DATA::imemMsgCur + 0x14U < 0xffc9) {
      lpmt = (MSGTURN *)CONCAT22(0x1120,pb);
      lpmt->field0_0x0 = lpmt->field0_0x0 & 0xf0 | (byte)iPlr & 0xf;
      *(MessageId *)(pb + 1) = *(uint *)(pb + 1) & 0xfe00 | iMsg & 0x1ff;
      *(uint *)(pb + 1) = *(uint *)(pb + 1) & 0x1ff;
      *(short *)(pb + 3) = iObj;
      lpb = (byte *)CONCAT22(0x1120,pb + 5);
      grbit = 1;
      pi = &p1;
      for (i = 0; i < *(char *)((int)c_common::rgplr[1].szNames + 0xc + iMsg); i = i + 1) {
        if ((*pi & 0xff00U) == 0) {
          *lpb = (byte)*pi;
          iVar3 = (int)lpb + 1;
        }
        else {
          uVar2 = *(uint *)(pb + 1);
          puVar1 = (uint *)(pb + 1);
          *puVar1 = *puVar1 & 0x1ff;
          puVar1 = (uint *)(pb + 1);
          *puVar1 = *puVar1 | grbit << 9 | uVar2 & 0xfe00;
          *(short *)lpb = *pi;
          iVar3 = (int)lpb + 2;
        }
        lpb = (byte *)CONCAT22(lpb._2_2_,iVar3);
        pi = pi + 1;
        grbit = grbit << 1;
      }
      lpmt->field0_0x0 =
           lpmt->field0_0x0 & 0xf | (byte)(((byte)((char)lpb - (char)(pb + 5)) & 0xf) << 4);
      sVar4 = (int)lpb - (int)pb;
    }
    else {
      sVar4 = -1;
    }
  }
  else {
    sVar4 = 0;
  }
  return sVar4;
}



