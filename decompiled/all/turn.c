// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: FGenerateTurn
// Address: 10b0:0000
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Restarted to delay deadcode elimination for space: ram */

short FGenerateTurn(void)

{
  TURNSERIAL *pTVar1;
  char *pcVar2;
  undefined2 *puVar3;
  undefined2 *puVar4;
  byte bVar5;
  undefined2 uVar6;
  byte *pbVar7;
  byte *pbVar8;
  FLEET *pFVar9;
  ushort *puVar10;
  COLDROP *pCVar11;
  XFERFULL *pXVar12;
  FLEET *pFVar13;
  HCURSOR HVar14;
  short sVar15;
  short sVar16;
  FLEET *pFVar17;
  ushort uVar18;
  char *pcVar19;
  ushort uVar20;
  uint uVar21;
  char *pcVar22;
  int iVar23;
  TURNSERIAL *pTVar24;
  int iVar25;
  undefined2 *puVar26;
  undefined2 *puVar27;
  undefined2 uVar28;
  undefined2 unaff_SS;
  PL *pPVar29;
  ulong uVar30;
  undefined2 auStack_16c [2];
  short sStack_168;
  uint uStack_166;
  PLANET *pPStack_162;
  uint uStack_160;
  PLANET *pPStack_15e;
  short pctDetect;
  short dRange;
  short dPlanRange;
  int iStack_156;
  short fSuccess;
  char *pchBak;
  short fFollow;
  short idCur;
  HCURSOR hcurSav;
  char szT [256];
  short env [9];
  short i;
  char *pchCur;
  FLEET *lpfl;
  short ifl;
  short (*penvMemSav) [9];
  byte rgfNoXFile [16];
  byte mpiplr2 [16];
  short j;
  short ish;
  char *pchT;
  short fErrSav;
  
                    /* Segment:    23
                       Offset:     0009e840
                       Length:     9eb8
                       Min Alloc:  9eb8
                       Flags:      1d10
                           Code
                           Discardable
                           Moveable
                           LoadOnCall
                           Impure (Non-shareable)
                        */
  idCur = idPlayer;
  fSuccess = 0;
  HVar14 = LoadCursor(0,&DAT_0000_7f02);
  hcurSav = setcursor(HVar14);
  DestroyCurGame();
  if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
    Randomize(0x499602d2);
  }
  sVar16 = fFileErrSilent;
  fFileErrSilent = 1;
  UpdateProgressGauge(0x168);
  sVar15 = FLoadGame((char *)szBase,(char *)0x9c4);
  if (sVar15 == 0) {
    fFileErrSilent = sVar16;
    setcursor(hcurSav);
    TurnLog(idsCantFindHostFile);
    pXVar12 = (XFERFULL *)CONCAT22(lpxf._2_2_,(XFERFULL *)lpxf);
    pCVar11 = (COLDROP *)CONCAT22(lpcd._2_2_,(COLDROP *)lpcd);
    puVar10 = (ushort *)CONCAT22(vrgPlanResExtra._2_2_,(ushort *)vrgPlanResExtra);
    pTVar1 = (TURNSERIAL *)CONCAT22(vrgts._2_2_,(TURNSERIAL *)vrgts);
    fSuccess = 0;
  }
  else {
    TurnLog(idsGeneratingYearD);
    fFileErrSilent = sVar16;
    if (wVersFile >> 0xc == 0) {
      i = 0;
      while ((i < game.cPlayer &&
             ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 3 & 0x1f) == 0))) {
        i = i + 1;
      }
      if (i == game.cPlayer) {
        for (i = 0; i < game.cPlayer; i = i + 1) {
          uVar21 = (i & 0x1fU) << 3;
          pFVar17 = (FLEET *)(*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xff07 |
                             uVar21);
          _dRange = (FLEET *)CONCAT22(uVar21,pFVar17);
          *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) = (uint)pFVar17;
        }
      }
    }
    penvMem = env;
    sVar16 = __setjmp(env);
    if (sVar16 == 0) {
      lpcd = LpAlloc(12000,htMisc);
      lpxf = LpAlloc(25000,htMisc);
      vrgPlanResExtra = LpAlloc(game.cPlanMax << 1,htMisc);
      __fmemset(vrgPlanResExtra,0,game.cPlanMax << 1);
      vrgts = LpAlloc(game.cPlayer << 4,htMisc);
      UpdateProgressGauge(0x172);
      cColDrop = 0;
      cXferFull = 0;
      gd._0_2_ = gd._0_2_ & 0xfdfd | 0x202;
      imemMsgCur = 0;
      for (i = 0; i < game.cPlayer; i = i + 1) {
        mpiplr2[i] = (byte)i;
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        sVar16 = Random(game.cPlayer - i);
        iVar23 = sVar16 + i;
        if (iVar23 != i) {
          bVar5 = mpiplr2[iVar23];
          idCur = (short)bVar5;
          mpiplr2[iVar23] = mpiplr2[i];
          mpiplr2[i] = bVar5;
        }
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        bVar5 = mpiplr2[i];
        _WSPRINTF((LPSTR)0x56a21120,(LPCSTR)0x9c81120,(char *)szWork);
        uVar6 = vrgts._2_2_;
        pTVar24 = (TURNSERIAL *)vrgts + bVar5;
        idPlayer = (uint)bVar5;
        *(undefined2 *)&pTVar24->lSerialNumber = 0xffff;
        *(undefined2 *)((int)&pTVar24->lSerialNumber + 2) = 0xffff;
        sVar16 = FLoadLogFile((char *)szWork);
        if (sVar16 != 0) {
          sVar16 = FRunLogFile();
          if (sVar16 == 0) {
            sVar16 = 0x10;
            pcVar19 = PszFormatIds(idsPlayerLogFileAppearsCorruptUnableLoad,(short *)0x0);
            AlertSz(pcVar19,sVar16);
            goto TURN_FreeStuffUp;
          }
        }
        sVar16 = MulDiv(0x3c,i + 1,game.cPlayer);
        UpdateProgressGauge(sVar16 + 0x172);
      }
      idPlayer = -1;
      i = 0;
      pTVar1 = vrgts;
      while( true ) {
        vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
        vrgts._0_2_ = (TURNSERIAL *)pTVar1;
        if (game.cPlayer <= i) break;
        vrgts = pTVar1;
        if ((((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 1 & 1) == 0) &&
            ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0)) &&
           ((((uint)gd._0_2_ >> 0xb & 1) == 0 || (i != 0)))) {
          if (((int)((TURNSERIAL *)vrgts + i)->lSerialNumber != -1) ||
             (*(int *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2) != -1)) {
            pTVar1 = (TURNSERIAL *)vrgts + i;
            puVar3 = (undefined2 *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2);
            sVar16 = FValidSerialLong(CONCAT22(*puVar3,(int)pTVar1->lSerialNumber));
            pTVar1 = vrgts;
            if (sVar16 == 0) {
              _dRange = (FLEET *)(CONCAT22(*(undefined2 *)
                                            ((int)&rgplr[0].wFlags + i * 0xc0),dRange) &
                                  0xfffbffff | 0x40000);
              *(short *)((int)&rgplr[0].wFlags + i * 0xc0) = dPlanRange;
              pTVar1 = vrgts;
              goto LAB_10b0_03c3;
            }
          }
          vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
          vrgts._0_2_ = (TURNSERIAL *)pTVar1;
          if (((int)((TURNSERIAL *)vrgts + i)->lSerialNumber != -1) ||
             (*(int *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2) != -1)) {
            _dRange = (FLEET *)(CONCAT22(*(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0)
                                         ,dRange) & 0xfffbffff);
            vrgts = pTVar1;
            *(short *)((int)&rgplr[0].wFlags + i * 0xc0) = dPlanRange;
            j = 0;
            pTVar1 = vrgts;
            while( true ) {
              vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
              vrgts._0_2_ = (TURNSERIAL *)pTVar1;
              if (i <= j) break;
              if (((*(uint *)((int)&rgplr[0].wFlags + j * 0xc0) >> 1 & 1) == 0) &&
                 ((*(uint *)((int)&rgplr[0].wMdPlr + j * 0xc0) >> 9 & 1) == 0)) {
                if (((int)((TURNSERIAL *)vrgts + i)->lSerialNumber ==
                     (int)((TURNSERIAL *)vrgts + j)->lSerialNumber) &&
                   (*(int *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2) ==
                    *(int *)((int)&((TURNSERIAL *)vrgts)[j].lSerialNumber + 2))) {
                  pbVar7 = (byte *)CONCAT22(vrgts._2_2_,
                                            ((TURNSERIAL *)vrgts)[i].rgbConfig);
                  pbVar8 = (byte *)CONCAT22(vrgts._2_2_,
                                            ((TURNSERIAL *)vrgts)[j].rgbConfig);
                  vrgts = pTVar1;
                  sVar16 = __fmemcmp(pbVar7,pbVar8,0xb);
                  pTVar1 = vrgts;
                  if (sVar16 != 0) {
                    pFVar17 = (FLEET *)(*(uint *)((int)&rgplr[0].wFlags + j * 0xc0) &
                                        0xfffb | 4);
                    *(uint *)((int)&rgplr[0].wFlags + j * 0xc0) = (uint)pFVar17;
                    _dRange = (FLEET *)CONCAT22(1,pFVar17);
                    pctDetect = 4;
                    pPStack_15e = (PLANET *)
                                  (*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xfffb |
                                  4);
                    *(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0) = pPStack_15e;
                    pTVar1 = vrgts;
                  }
                }
              }
              j = j + 1;
            }
          }
        }
        else {
          _dRange = (FLEET *)(CONCAT22(*(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0),
                                       dRange) & 0xfffbffff);
          *(short *)((int)&rgplr[0].wFlags + i * 0xc0) = dPlanRange;
          pTVar1 = vrgts;
        }
LAB_10b0_03c3:
        i = i + 1;
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        if ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 2 & 1) != 0) {
          vrgts = pTVar1;
          sVar16 = IPlrAlsoCheater(i);
          FSendPlrMsg2(i,(sVar16 != -1) + idmPopulationSuspectsUsurperProductivityOff20Growth,
                            -5,sVar16,0);
          pTVar1 = vrgts;
          if ((10 < (uint)game.turn) && ((game.turn & 7U) == (i & 7U))) {
            FSendPlrMsg2(i,idmFleetCaptainsHaveStagedStrikeDemandFree,-5,0,0);
            pTVar1 = vrgts;
          }
        }
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        for (ish = 0; ish < 0x10; ish = ish + 1) {
          if (((*(uint *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x7b) >> 9 & 1) == 0) &&
             (*(int *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3a) != 1)) {
            vrgts = pTVar1;
            *(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3a) = 1;
            uVar30 = CONCAT22(*(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c),dRange) &
                     0xff00ffff;
            _dRange = (FLEET *)(uVar30 | 0x10000);
            *(short *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c) = dPlanRange;
            pTVar1 = vrgts;
            if (*(uint *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c) >> 8 == 0) {
              dRange = (short)uVar30;
              _dRange = (FLEET *)(CONCAT22(*(undefined2 *)
                                            (*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c),dRange) &
                                  0xffffff | 0x1000000);
              *(short *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c) = dPlanRange;
              pTVar1 = vrgts;
            }
          }
        }
      }
      fFollow = 0;
      for (ifl = 0; vrgts = pTVar1, ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar17 = ((FLEET **)rglpfl)[ifl];
        iVar23 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar23,pFVar17);
        if ((pFVar17 == (FLEET *)0x0) && (iVar23 == 0)) break;
        pFVar17->wFlags = pFVar17->wFlags & 0xbfff;
        if ((pFVar17->cord == 1) &&
           ((*(uint *)&((PLORD *)pFVar17->lpplord)[2].iordMax >> 8 & 0xf) == 2)) {
          fFollow = 1;
          pFVar17->wFlags = pFVar17->wFlags & 0x7fffU | 0x8000;
          pTVar1 = vrgts;
        }
        else {
          if (((*(uint *)&((PLORD *)pFVar17->lpplord)[2].iordMax >> 8 & 0xf) == 2) &&
             (pFVar17->cord == 1)) {
            FSendPlrMsg(pFVar17->iPlayer,idmHadOrdersFollowFleetWhichDidntMove,
                             lpfl->id | 0x8000,lpfl->id,0,0,0,0,0,0);
          }
          pFVar17->wFlags = pFVar17->wFlags & 0x7fff;
          pTVar1 = vrgts;
        }
      }
      ValidateWaypoints();
      if (fFollow != 0) {
        fFollow = 1;
        i = 0;
        while ((i < 8 && (fFollow != 0))) {
          fFollow = 0;
          for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
            pFVar17 = ((FLEET **)rglpfl)[ifl];
            iVar23 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
            lpfl = (FLEET *)CONCAT22(iVar23,pFVar17);
            if ((pFVar17 == (FLEET *)0x0) && (iVar23 == 0)) break;
            if ((pFVar17->wFlags < 0) && (pFVar17->cord == 1)) {
              uVar6 = *(undefined2 *)((int)&pFVar17->lpplord + 2);
              puVar26 = (undefined2 *)(*(int *)&pFVar17->lpplord + 4);
              puVar27 = auStack_16c;
              for (iVar25 = 9; iVar25 != 0; iVar25 = iVar25 + -1) {
                puVar4 = puVar27;
                puVar27 = puVar27 + 1;
                puVar3 = puVar26;
                puVar26 = puVar26 + 1;
                *puVar4 = *puVar3;
              }
              if ((uStack_166 >> 8 & 0xf) == 2) {
                _dRange = LpflFromId(sStack_168);
                iVar25 = (int)((ulong)_dRange >> 0x10);
                pFVar9 = (FLEET *)_dRange;
                if (((pFVar9 != (FLEET *)0x0) || (iVar25 != 0)) &&
                   ((pFVar9->cord != 1 ||
                    ((*(uint *)&((PLORD *)pFVar9->lpplord)[2].iordMax >> 8 & 0xf) == 2)))) {
                  if (pFVar9->cord != 1) {
                    fFollow = 1;
                    if (((PLORD *)pFVar17->lpplord)->iordMax < 2) {
                      pPVar29 = LpplReAlloc((PL *)CONCAT22(*(undefined2 *)
                                                                    ((int)&pFVar17->lpplord + 2),
                                                                   *(PL **)&pFVar17->lpplord),2);
                      *(PL **)&pFVar17->lpplord = (PL *)pPVar29;
                      *(undefined2 *)((int)&pFVar17->lpplord + 2) = (int)((ulong)pPVar29 >> 0x10);
                    }
                    uVar28 = (undefined2)((ulong)_dRange >> 0x10);
                    uVar6 = *(undefined2 *)((int)&((FLEET *)_dRange)->lpplord + 2);
                    puVar27 = (undefined2 *)(*(int *)&((FLEET *)_dRange)->lpplord + 0x16);
                    uVar28 = *(undefined2 *)((int)&pFVar17->lpplord + 2);
                    puVar26 = (undefined2 *)(*(int *)&pFVar17->lpplord + 0x16);
                    for (iVar25 = 9; iVar25 != 0; iVar25 = iVar25 + -1) {
                      puVar4 = puVar26;
                      puVar26 = puVar26 + 1;
                      puVar3 = puVar27;
                      puVar27 = puVar27 + 1;
                      *puVar4 = *puVar3;
                    }
                    uVar6 = *(undefined2 *)((int)&pFVar17->lpplord + 2);
                    puVar27 = (undefined2 *)(*(int *)&pFVar17->lpplord + 0xc);
                    uVar28 = *(undefined2 *)((int)&pFVar17->lpplord + 2);
                    puVar26 = (undefined2 *)(*(int *)&pFVar17->lpplord + 0x1e);
                    for (iVar25 = 5; iVar25 != 0; iVar25 = iVar25 + -1) {
                      puVar4 = puVar26;
                      puVar26 = puVar26 + 1;
                      puVar3 = puVar27;
                      puVar27 = puVar27 + 1;
                      *puVar4 = *puVar3;
                    }
                    pFVar17->cord = 2;
                    ((PLORD *)pFVar17->lpplord)->iordMac = 2;
                  }
                  goto LAB_10b0_09f2;
                }
                FSendPlrMsg(pFVar17->iPlayer,idmHadOrdersFollowFleetWhichDidntMove,
                                 lpfl->id | 0x8000,lpfl->id,0,0,0,0,0,0);
              }
              pFVar17->wFlags = pFVar17->wFlags & 0x7fff;
            }
LAB_10b0_09f2:
          }
          i = i + 1;
        }
      }
      UpdateProgressGauge(0x1b8);
      DoOrders(0);
      UpdateProgressGauge(0x212);
      for (i = 0; i < game.cPlayer; i = i + 1) {
        _dRange = (FLEET *)((ulong)_dRange & 0xffff0000);
        while (dRange < 0x10) {
          sVar16 = GetRaceStat((PLAYER *)rgplr + i,dRange);
          SetRaceStat((PLAYER *)rgplr + i,dRange,sVar16);
          _dRange = (FLEET *)CONCAT22(dPlanRange,dRange + 1);
        }
        if ((*(char *)((int)&rgplr[0].pctResearch + i * 0xc0) < '\0') ||
           ('d' < *(char *)((int)&rgplr[0].pctResearch + i * 0xc0))) {
          *(undefined1 *)((int)&rgplr[0].pctResearch + i * 0xc0) = 0xf;
        }
        if (*(char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0) < '\0') {
          *(undefined1 *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0) = 1;
        }
        if ('\x14' < *(char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0)) {
          *(undefined1 *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0) = 0x14;
        }
        _dRange = (FLEET *)(CONCAT22(dPlanRange,
                                     *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 4) &
                           0xffff0001);
        sVar16 = CAdvantagePoints((PLAYER *)rgplr + i);
        _dRange = (FLEET *)CONCAT22(sVar16,dRange);
        pFVar13 = _dRange;
        if (((sVar16 < 0) ||
            (dRange != (*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 4 & 1))) &&
           ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0)) {
          FSendPlrMsg2(i,idmRaceDefinitionHasTamperedStatisticsHaveAltered,-1,0,0);
          _dRange = (FLEET *)((ulong)_dRange & 0xffff0000);
          while (dRange < game.cPlayer) {
            if ((i != dRange) &&
               ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0)) {
              FSendPlrMsg2(dRange,idmHackedRaceDiscoveredRaceStatisticsHaveAltered,-1,i,0);
            }
            _dRange = (FLEET *)CONCAT22(dPlanRange,(FLEET *)(dRange + 1));
          }
          pctDetect = *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xffef | 0x10;
          *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) = pctDetect;
          pFVar13 = _dRange;
          iVar23 = dPlanRange;
          while ((iVar23 < 500 && (*(char *)((int)rgplr[0].rgAttr + i * 0xc0) < '\x19')))
          {
            pcVar2 = (char *)((int)rgplr[0].rgAttr + i * 0xc0);
            *pcVar2 = *pcVar2 + '\x01';
            _dRange = pFVar13;
            iVar23 = CAdvantagePoints((PLAYER *)rgplr + i);
            _dRange = (FLEET *)CONCAT22(iVar23,dRange);
            pFVar13 = _dRange;
          }
          dPlanRange = (short)((ulong)pFVar13 >> 0x10);
          iVar23 = dPlanRange;
          while ((iVar23 < 500 &&
                 ('\x01' < *(char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0)))) {
            pcVar2 = (char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0);
            *pcVar2 = *pcVar2 + -1;
            _dRange = pFVar13;
            iVar23 = CAdvantagePoints((PLAYER *)rgplr + i);
            _dRange = (FLEET *)CONCAT22(iVar23,dRange);
            pFVar13 = _dRange;
          }
          dPlanRange = (short)((ulong)pFVar13 >> 0x10);
          if (dPlanRange < 500) {
            _dRange = (FLEET *)CONCAT22(dPlanRange,(FLEET *)0x8);
            while (pFVar13 = _dRange, dRange < 0xe) {
              *(undefined1 *)(i * 0xc0 + 0x59e0 + dRange) = 0;
              sVar16 = CAdvantagePoints((PLAYER *)rgplr + i);
              _dRange = (FLEET *)CONCAT22(sVar16,dRange);
              pFVar13 = _dRange;
              if (499 < sVar16) break;
              _dRange = (FLEET *)CONCAT22(sVar16,(FLEET *)(dRange + 1));
            }
          }
        }
        _dRange = pFVar13;
      }
      UnmarkMineFields();
      MoveThings(0);
      UpdateProgressGauge(0x226);
      MoveFleets();
      uVar21 = lpPlanets._2_2_;
      pctDetect = lpPlanets._2_2_;
      pPStack_15e = (PLANET *)lpPlanets + cPlanet;
      pPStack_162 = (PLANET *)lpPlanets;
      for (dRange = (short)pPStack_162; (uint)dRange < pPStack_15e; dRange = dRange + 0x38) {
        *(uint *)(dRange + 4) = *(uint *)(dRange + 4) & 0xfbff;
      }
      uStack_160 = pctDetect;
      for (i = 0; i < game.cPlayer; i = i + 1) {
        uStack_160 = ((PLANET *)lpPlanets)
                     [*(int *)((int)&rgplr[0].idPlanetHome + i * 0xc0)].wFlags & 0xfbffU |
                     0x400;
        ((PLANET *)lpPlanets)[*(int *)((int)&rgplr[0].idPlanetHome + i * 0xc0)].
        wFlags = uStack_160;
      }
      dPlanRange = pctDetect;
      UpdateProgressGauge(0x28a);
      ThingDecay();
      BreedColonistsInTransit();
      UpdateProgressGauge(700);
      Produce();
      UpdateProgressGauge(0x2ee);
      MoveThings(1);
      UpdateProgressGauge(0x302);
      FuelFleets();
      DoOrders(1);
      SweepForMines();
      HealShips();
      AutoTerraform();
      RemoteTerraforming();
      UpdateProgressGauge(0x352);
      SpankTheCheaters();
      ValidateWaypoints();
      UpdateGuesses();
      UpdateProgressGauge(0x354);
      FMarkFile(dtHost,-1,1,0);
      CreateBackupDir();
      game.turn = game.turn + 1;
      uVar18 = _strlen((char *)szBase);
      pcVar22 = (char *)szBase + uVar18;
      pcVar19 = _strrchr((char *)szBase,0x5c);
      _strcpy(szT,(char *)&szBackup);
      if (pcVar19 == (char *)0x0) {
        _strcat(szT,(char *)szBase);
      }
      else {
        _strcat(szT,pcVar19 + 1);
      }
      uVar20 = _strlen(szT);
      pchBak = szT + uVar20;
      UpdateProgressGauge(0x356);
      UpdatePlayerScores();
      for (i = 0; i < game.cPlayer; i = i + 1) {
        for (j = 0; j < 10; j = j + 1) {
          if ((*(uint *)(*(int *)(i * 4 + 0x14c) + j * 0x93 + 0x7b) >> 9 & 1) == 0) {
            sVar16 = PctCloakFromHuldef
                               ((HUL *)CONCAT22(*(undefined2 *)(i * 4 + 0x14e),
                                                (HUL *)(*(int *)(i * 4 + 0x14c) + j * 0x93)),i,
                                (short *)0x0);
            iVar23 = 100 - sVar16;
            _dRange = (FLEET *)(long)iVar23;
            uVar6 = *(undefined2 *)(i * 4 + 0x14e);
            iVar25 = *(int *)(i * 4 + 0x14c) + j * 0x93;
            *(int *)(iVar25 + 0x87) = iVar23;
            *(int *)(iVar25 + 0x89) = iVar23 >> 0xf;
            uVar6 = *(undefined2 *)(i * 4 + 0x14e);
            iVar23 = *(int *)(i * 4 + 0x14c) + j * 0x93;
            uVar28 = *(undefined2 *)(i * 4 + 0x14e);
            iVar25 = *(int *)(i * 4 + 0x14c) + j * 0x93;
            uVar30 = __aFulmul(CONCAT22(*(undefined2 *)(iVar25 + 0x89),
                                                *(undefined2 *)(iVar25 + 0x87)),
                                       CONCAT22(*(undefined2 *)(iVar23 + 0x89),
                                                *(undefined2 *)(iVar23 + 0x87)));
            dPlanRange = (short)(uVar30 >> 0x10);
            dRange = (short)uVar30;
            uVar6 = *(undefined2 *)(i * 4 + 0x14e);
            iVar23 = *(int *)(i * 4 + 0x14c) + j * 0x93;
            *(short *)(iVar23 + 0x87) = dRange;
            *(short *)(iVar23 + 0x89) = dPlanRange;
          }
        }
        for (j = 0; j < 0x10; j = j + 1) {
          if ((*(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) >> 9 & 1) == 0) {
            dRange = GetShdefScannerRange
                               ((SHDEF *)CONCAT22(*(undefined2 *)(i * 4 + 0x100),
                                                  (SHDEF *)(*(int *)(i * 4 + 0xfe) + j * 0x93)),i,
                                &dPlanRange,(short *)&pPStack_15e,&pctDetect);
            *(short *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x8d) = dRange;
            *(short *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x8f) = dPlanRange;
            *(undefined1 *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x91) = (char)pPStack_15e;
            uStack_160 = pctDetect;
            *(undefined1 *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x92) = (char)pctDetect;
            sVar16 = FCanBuildShdef
                               ((SHDEF *)CONCAT22(*(undefined2 *)(i * 4 + 0x100),
                                                  (SHDEF *)(*(int *)(i * 4 + 0xfe) + j * 0x93)),i);
            if (sVar16 == 0) {
              uStack_160 = *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) & 0x7fff | 0x8000;
              *(uint *)(*(int *)(i * 4 + 0xfe) + j * 0x93 + 0x7b) = uStack_160;
            }
          }
        }
      }
      j = 0x358;
      iStack_156 = 0;
      _memset(rgfNoXFile,0,0x10);
      i = 0;
      while (iStack_156 == 0) {
        UpdateProgressGauge(j);
        j = j + (int)(0x11 / (long)(game.cPlayer + 1));
        if (game.cPlayer <= i) {
          i = -1;
          iStack_156 = 1;
        }
        if (i < 0) {
          _strcpy(pcVar22,(char *)0x9d4);
          _strcpy(pchBak,(char *)0x9d9);
        }
        else {
          _WSPRINTF((LPSTR)CONCAT22(i + 1,(char *)&DAT_1120_1120),(LPCSTR)0x9cf1120,pcVar22);
          _strcpy(pchBak,pcVar22);
          _remove(szT);
          sVar16 = __access((char *)szBase,0);
          if (sVar16 == -1) {
            rgfNoXFile[i] = 1;
          }
          else {
            _rename((char *)szBase,szT);
          }
          pchBak[1] = 'm';
          ((char *)szBase + 1)[uVar18] = 'm';
        }
        _remove(szT);
        if ((i < 0) || (rgfNoXFile[i] == 0)) {
          _rename((char *)szBase,szT);
        }
        else {
          CopyFile((char *)szBase,szT);
        }
        *pcVar22 = '\0';
        i = i + 1;
      }
      j = 0x36b;
      iStack_156 = 0;
      uVar21 = Random(8);
      _dRange = (FLEET *)CONCAT22(uVar21,dRange);
      game.wCrap = game.wCrap & 0xf1ffU | (uVar21 & 7) << 9;
      i = 0;
      while (iStack_156 == 0) {
        UpdateProgressGauge(j);
        j = j + (int)(0x7a / (long)(game.cPlayer + 1));
        if (game.cPlayer <= i) {
          i = -1;
          iStack_156 = 1;
        }
        if ((i == -1) || (rgfNoXFile[i] == 0)) {
          sVar16 = 0;
        }
        else {
          sVar16 = 1;
        }
        FWriteDataFile((char *)szBase,i,sVar16);
        i = i + 1;
      }
      UpdateProgressGauge(0x3e6);
      imemLogCur = 0;
      fSuccess = 1;
    }
TURN_FreeStuffUp:
    UpdateProgressGauge(1000);
    FreeLp(vrgPlanResExtra,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgPlanResExtra._0_2_ = (ushort *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgPlanResExtra._2_2_ = 0;
    FreeLp(vrgts,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgts._0_2_ = (TURNSERIAL *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgts._2_2_ = 0;
    FreeLp(lpcd,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    lpcd._0_2_ = (COLDROP *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    lpcd._2_2_ = 0;
    FreeLp(lpxf,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    lpxf._0_2_ = (XFERFULL *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    lpxf._2_2_ = 0;
    gd._0_2_ = gd._0_2_ & 0xfdfd;
    idPlayer = -1;
    if ((fSuccess != 0) && (((uint)ini.wFlags >> 3 & 1) != 0)) {
      vretExitValue = 1;
    }
    setcursor(hcurSav);
    TurnLog(fSuccess + idsFailed);
    pTVar1 = vrgts;
    puVar10 = vrgPlanResExtra;
    pCVar11 = lpcd;
    pXVar12 = lpxf;
  }
  lpxf._2_2_ = (undefined2)((ulong)pXVar12 >> 0x10);
  lpxf._0_2_ = (XFERFULL *)pXVar12;
  lpcd._2_2_ = (undefined2)((ulong)pCVar11 >> 0x10);
  lpcd._0_2_ = (COLDROP *)pCVar11;
  vrgPlanResExtra._2_2_ = (undefined2)((ulong)puVar10 >> 0x10);
  vrgPlanResExtra._0_2_ = (ushort *)puVar10;
  vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
  vrgts._0_2_ = (TURNSERIAL *)pTVar1;
  return fSuccess;
}



// ======================================================================
// Function: DoOrders
// Address: 10b0:179a
// Segment: MEMORY_TURN
// ======================================================================


void DoOrders(short fPostMovement)

{
  short sVar1;
  PLANET *pPVar2;
  undefined2 uVar3;
  PLANET *lpplMac;
  PLANET *lppl;
  
  pPVar2 = (PLANET *)lpPlanets + cPlanet;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < pPVar2) {
    uVar3 = (undefined2)((ulong)lppl >> 0x10);
    ((PLANET *)lppl)->wFlags =
         ((PLANET *)lppl)->wFlags & 0xdfffU | (uint)(((PLANET *)lppl)->iPlayer != -1) << 0xd;
    lppl = (PLANET *)CONCAT22(uVar3,(PLANET *)lppl + 1);
  }
  if (fPostMovement != 0) {
    idBattle = (game.turn & 0xfU) * 0x100 + 1;
    DoBattles(fPostMovement);
  }
  DoThingInteractions(fPostMovement);
  if (fPostMovement != 0) {
    pPVar2 = (PLANET *)lpPlanets + cPlanet;
    lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
    while ((PLANET *)lppl < pPVar2) {
      uVar3 = (undefined2)((ulong)lppl >> 0x10);
      ((PLANET *)lppl)->turn = 0;
      lppl = (PLANET *)CONCAT22(uVar3,(PLANET *)lppl + 1);
    }
  }
  if (fPostMovement == 0) {
    sVar1 = 1;
  }
  else {
    sVar1 = 3;
  }
  SatisfyOrders(sVar1);
  DropColonists();
  UpdateResearchStatus(0);
  if (fPostMovement == 0) {
    sVar1 = 2;
  }
  else {
    sVar1 = 4;
  }
  SatisfyOrders(sVar1);
  if (fPostMovement == 0) {
    TransferToOthers();
  }
  return;
}



// ======================================================================
// Function: MoveThings
// Address: 10b0:18f4
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Variable defined which should be unmapped: rgCost */
/* WARNING: Removing unreachable block (ram,0x10b02a14) */
/* WARNING: Removing unreachable block (ram,0x10b02a5c) */
/* WARNING: Removing unreachable block (ram,0x10b02b3a) */

void MoveThings(short fPostProd)

{
  uint *puVar1;
  char *pcVar2;
  int *piVar3;
  double dVar4;
  bool bVar5;
  THING *pTVar6;
  undefined8 uVar7;
  undefined8 uVar8;
  double dVar9;
  int iVar10;
  undefined1 extraout_AH;
  MessageId iMsg;
  uint uVar11;
  uint uVar12;
  int iVar13;
  short sVar14;
  uint uVar15;
  int iVar16;
  uint *puVar17;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  int iVar18;
  bool bVar19;
  bool bVar20;
  long lVar21;
  ulong uVar22;
  ulong uVar23;
  long lVar24;
  undefined2 uVar25;
  ushort p6;
  undefined2 uVar26;
  short sVar27;
  short sVar28;
  undefined2 uVar29;
  short sVar30;
  int local_82;
  short rgCost [3];
  short rgMax [3];
  short cTerraTemp;
  short cTerraPerm;
  short rgMin [3];
  short iplr;
  short iWarpPacket2;
  short iWarpPacket;
  long dmgRaw;
  float pct;
  short pctCaught;
  short i;
  long lColKilled;
  long lDefKilled;
  short fTwoMAs;
  double r;
  short wtCur;
  short pctMinKeep;
  undefined2 uStack_48;
  double dxRound;
  short iWarp;
  short iWarp2;
  short fTerra;
  double dyRound;
  short rgwtTerra [3];
  POINT ptBase;
  short dRange;
  THING *lpthMac;
  POINT ptSrc;
  short iLow;
  short idm;
  short fMajorMove;
  short fAnythingMoved;
  THING *lpth;
  short dLeft;
  POINT ptDst;
  short iMax;
  POINT pt;
  double d;
  short dUni;
  short k;
  
  bVar5 = false;
  lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
  _dyRound = CONCAT24((THING *)lpThings,_dyRound);
  _dyRound = (double)CONCAT26(lpThings._2_2_,_dyRound);
  lpthMac._0_2_ = (THING *)lpThings + cThing;
  do {
    if ((THING *)lpthMac <= (THING *)lpth) {
      if (bVar5) {
        ValidateWaypoints();
      }
      return;
    }
    iVar18 = (int)((ulong)lpth >> 0x10);
    if (((uint)lpth->idFull >> 0xd == 2) && (fPostProd != 0)) {
      k = 0;
      iVar10 = (&((THING *)lpth)->pt)->x;
      iVar13 = (((THING *)lpth)->pt).y;
      sVar14 = Random(100);
      _dyRound = (double)CONCAT26(sVar14,_dyRound);
      sVar14 = PctWormholeMoves(lpth);
      bVar19 = rgwtTerra[2] < sVar14;
      if (bVar19) {
        (((THING *)lpth)->rgb + 2)[0] = 0;
        (((THING *)lpth)->rgb + 2)[1] = 0;
        dUni = game.mdSize * 400 + 400;
        *(uint *)((THING *)lpth)->rgb = *(uint *)((THING *)lpth)->rgb & 0xf003;
      }
      else {
        _dyRound = (double)(CONCAT26(*(int *)((THING *)lpth)->rgb + 4,_dyRound) & 0xffcffffffffffff)
        ;
        *(uint *)((THING *)lpth)->rgb = *(uint *)((THING *)lpth)->rgb & 0xf003;
        *(uint *)((THING *)lpth)->rgb = *(uint *)((THING *)lpth)->rgb | rgwtTerra[2];
      }
      iMax = 0x10;
      while (iVar16 = k + 1, k < 100) {
        if (bVar19) {
          sVar14 = Random(dUni);
          (&((THING *)lpth)->pt)->x = sVar14 + 1000;
          sVar14 = Random(dUni);
          (((THING *)lpth)->pt).y = sVar14 + 1000;
        }
        else {
          sVar14 = Random(0x19);
          (&((THING *)lpth)->pt)->x = sVar14 + iVar10 + -0xc;
          sVar14 = Random(0x19);
          (((THING *)lpth)->pt).y = sVar14 + iVar13 + -0xc;
        }
        k = iVar16;
        if (((&((THING *)lpth)->pt)->x != iVar10) || ((((THING *)lpth)->pt).y != iVar13)) {
          iLow = IValidateWormholePos(lpth);
          if (iLow == 0) break;
          if (iLow < iMax) {
            pt.x = (&((THING *)lpth)->pt)->x;
            pt.y = (((THING *)lpth)->pt).y;
            iMax = iLow;
          }
        }
      }
      if (iLow != 0) {
        (&((THING *)lpth)->pt)->x = pt.x;
        (((THING *)lpth)->pt).y = pt.y;
      }
    }
    else {
      if (((uint)lpth->idFull >> 0xd == 3) && (fPostProd == 0)) {
        dRange = *(uint *)(((THING *)lpth)->rgb + 4) & 0xf;
        if (0xc < (uint)dRange) goto LAB_10b0_1c3e;
        sVar14 = Random(0x19);
        if (sVar14 != 0) goto LAB_10b0_1c3e;
        idm = 0x130;
        sVar14 = Random(3);
        if (sVar14 != 0) goto TURN_LSpeedUpOnly;
        goto TURN_LRetargetFreighter;
      }
      if ((((uint)lpth->idFull >> 0xd == 1) && ((*(uint *)((THING *)lpth)->rgb >> 10 & 0xf) != 0))
         && ((fPostProd == 0 || ((*(uint *)((THING *)lpth)->rgb >> 0xe & 1) == 0)))) {
        if (((*(int *)(((THING *)lpth)->rgb + 2) != 0) || (*(int *)(((THING *)lpth)->rgb + 4) != 0))
           || (*(int *)(((THING *)lpth)->rgb + 6) != 0)) {
          *(uint *)((THING *)lpth)->rgb = *(uint *)((THING *)lpth)->rgb & 0xbfff | 0x4000;
          iVar10 = (*(uint *)((THING *)lpth)->rgb >> 10 & 0xf) + 4;
          dRange = iVar10 * iVar10;
          if (fPostProd != 0) {
            dRange = dRange >> 1;
          }
          uVar15 = *(uint *)((THING *)lpth)->rgb & 0x3ff;
          ptDst.x = ((POINT *)rgptPlan + uVar15)->x;
          ptDst.y = *(short *)((int)&rgptPlan[0].y + uVar15 * 4);
TURN_MoveTh:
          bVar5 = true;
          iVar10 = (&((THING *)lpth)->pt)->x;
          uVar15 = (((THING *)lpth)->pt).y;
          dVar9 = DGetDistance(iVar10,uVar15,ptDst.x,ptDst.y);
          dVar4 = *(double *)CONCAT11(extraout_AH,dVar9);
          lVar21 = __ftol((double)CONCAT26(rgCost[0],
                                                   CONCAT24(local_82,CONCAT22(unaff_SI,unaff_DI))));
          if ((int)lVar21 <= dRange) {
TURN_MadeItThere:
            if ((uint)lpth->idFull >> 0xd == 3) {
              stack0xff94 = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
              rgMin[0] = (short)((THING *)lpThings + cThing);
              rgMin[1] = lpThings._2_2_;
              while( true ) {
                if (((uint)rgMin[0] <= (uint)rgMin[2]) ||
                   (((uint)stack0xff94->idFull >> 0xd == 3 &&
                    (((THING *)rgMin[2] != (THING *)lpth || (iplr != iVar18)))))) break;
                stack0xff94 = (THING *)CONCAT22(iplr,(THING *)(rgMin[2] + 0x12));
              }
              if ((rgMin[2] == rgMin[0]) &&
                 ((iplr == lpThings._2_2_ && (sVar14 = Random(2), sVar14 != 0))))
              break;
              goto TURN_LFreeThePacket;
            }
            if ((uint)lpth->idFull >> 0xd == 1) {
              sVar14 = MulDiv((int)lVar21,100,dRange);
              pTVar6 = stack0xff94;
              stack0xff94 = (THING *)CONCAT22(sVar14,rgMin[2]);
              if (sVar14 < 0) {
                stack0xff94 = (THING *)((ulong)pTVar6 & 0xffff);
              }
              else if (100 < sVar14) {
                stack0xff94 = (THING *)CONCAT22(100,rgMin[2]);
              }
              if (fPostProd != 0) {
                stack0xff94 = (THING *)CONCAT22(iplr >> 1,rgMin[2]);
              }
              sVar14 = FPacketDecay(lpth,iplr);
              if (sVar14 != 0) goto TURN_LPacketAlreadyFreed;
            }
            _r = (double)CONCAT26(lpPlanets._2_2_,
                                  CONCAT24((PLANET *)lpPlanets +
                                           (*(uint *)((THING *)lpth)->rgb & 0x3ff),_r));
            iVar13 = (*(uint *)((THING *)lpth)->rgb >> 10 & 0xf) + 4;
            iVar10 = IWarpMAFromLppl
                               ((PLANET *)
                                CONCAT22(lpPlanets._2_2_,
                                         (PLANET *)lpPlanets +
                                         (*(uint *)((THING *)lpth)->rgb & 0x3ff)),&fTwoMAs);
            if (fTwoMAs != 0) {
              iVar10 = iVar10 + 1;
            }
            _dxRound = (double)CONCAT44(_iWarp2,CONCAT22(iVar10,_dxRound));
            if ((0 < iVar10) &&
               (sVar14 = GetRaceStat((PLAYER *)rgplr +
                                           ((uint)lpth->idFull >> 9 & 0xf),rsMajorAdv), sVar14 == 6)
               ) {
              uVar15 = 1 << ((byte)((uint)lpth->idFull >> 9) & 0xf);
              uVar25 = (undefined2)((qword)_r >> 0x30);
              iVar10 = (int)((qword)_r >> 0x20);
              stack0xff94 = (THING *)CONCAT22(uVar15,rgMin[2]);
              iVar16 = *(int *)(iVar10 + 2) * 4;
              puVar1 = (uint *)(*(int *)(iVar16 + 0x14c) + (*(uint *)(iVar10 + 0x2c) & 0xf) * 0x93 +
                               0x8b);
              *puVar1 = *puVar1 | uVar15;
            }
            sVar14 = GetRaceStat((PLAYER *)rgplr + ((uint)lpth->idFull >> 9 & 0xf),
                                       rsMajorAdv);
            uVar7 = _dxRound;
            _dxRound = (double)CONCAT62(_iWarp,(uint)(sVar14 == 6));
            uVar8 = _dxRound;
            iWarp = SUB82(uVar7,2);
            iVar10 = iWarp * iWarp;
            fTerra = SUB82(uVar7,6);
            _dxRound = (undefined4)uVar8;
            _dxRound = CONCAT24(iVar10,_dxRound);
            iVar10 = iVar13 * iVar13;
            sVar14 = GetRaceStat((PLAYER *)rgplr +
                                       *(int *)((int)((qword)_r >> 0x20) + 2),rsMajorAdv);
            if (sVar14 == 7) {
              _dxRound = CONCAT24(iWarp2 / 2,_dxRound);
            }
            sVar14 = iWarp2;
            if (iWarp2 < iVar10) {
              if (iWarp < 1) {
                pctCaught = 0;
              }
              else {
                _dxRound = CONCAT22(sVar14,_dxRound);
                uVar25 = 0;
                uVar22 = __aFulmul((long)sVar14,1000);
                lVar21 = __aFldiv(uVar22,CONCAT22(uVar25,iVar10));
                pctCaught = (short)lVar21;
              }
            }
            else {
              pctCaught = 1000;
            }
            _r = 1000 - pctCaught;
            for (i = 0; i < 3; i = i + 1) {
              uVar26 = 0;
              uVar25 = 1000;
              uVar22 = __aFulmul((long)*(int *)(((THING *)lpth)->rgb + i * 2 + 2),(long)_r);
              lVar21 = __aFldiv(uVar22,CONCAT22(uVar26,uVar25));
              rgwtTerra[i] = (short)lVar21;
            }
            _r = (double)CONCAT62(_wtCur,(1000 - pctCaught) / 9 + pctCaught);
            _dxRound = (double)((qword)_dxRound & 0xffffffffffff);
            _dyRound = (double)((qword)_dyRound & 0xffffffffffff0000);
            i = 0;
            while( true ) {
              if (2 < i) break;
              if (*(int *)(((THING *)lpth)->rgb + i * 2 + 2) < 0) {
                (((THING *)lpth)->rgb + i * 2 + 2)[0] = 0;
                (((THING *)lpth)->rgb + i * 2 + 2)[1] = 0;
              }
              uVar15 = *(uint *)(((THING *)lpth)->rgb + i * 2 + 2);
              bVar19 = CARRY2(fTerra,uVar15);
              _dxRound = (double)CONCAT26(fTerra + uVar15,_dxRound);
              _dyRound = (double)CONCAT62(rgwtTerra,_dyRound + ((int)uVar15 >> 0xf) + (uint)bVar19);
              uVar26 = 0;
              uVar25 = 1000;
              uVar22 = __aFulmul((long)*(int *)(((THING *)lpth)->rgb + i * 2 + 2),(long)_r);
              lVar21 = __aFldiv(uVar22,CONCAT22(uVar26,uVar25));
              puVar17 = (uint *)(pctMinKeep + 0x1c + i * 4);
              puVar1 = puVar17;
              uVar15 = *puVar1;
              *puVar1 = *puVar1 + (uint)lVar21;
              puVar1 = puVar17 + 1;
              *puVar1 = *puVar1 + (int)((ulong)lVar21 >> 0x10) + (uint)CARRY2(uVar15,(uint)lVar21);
              i = i + 1;
            }
            if (pctCaught == 1000) {
TURN_LAllSafe:
              sVar28 = 0;
              sVar30 = 0;
              sVar14 = 0;
              uVar22 = __aFulshr(0,0);
              uVar23 = CONCAT22(fTerra,(uint)lpth->idFull >> 9) & 0xffff000f;
              if (iWarp < 1) {
                iMsg = idmBombardedPacketContainingKtMineralsHoweverPacket;
              }
              else {
                iMsg = idmMassAcceleratorHasSuccessfullyCapturedPacketCont;
              }
              FSendPlrMsg(*(short *)((int)((qword)_r >> 0x20) + 2),iMsg,*_pctMinKeep,
                               *_pctMinKeep,(short)uVar23,(short)(uVar23 >> 0x10),(short)uVar22,
                               sVar14,sVar30,sVar28);
            }
            else {
              uVar26 = 0;
              uVar25 = 0xa0;
              uVar22 = __aFulmul((long)(iVar13 * iVar13 - iWarp),CONCAT22(_dyRound,fTerra));
              __aFldiv(uVar22,CONCAT22(uVar26,uVar25));
              if (_dxRound != 0) {
                stack0xff94 = (THING *)(CONCAT22((uint)lpth->idFull >> 9,rgMin[2]) & 0xfffff);
                for (i = 0; i < 3; i = i + 1) {
                  cTerraTemp = 0;
                  cTerraPerm = 0;
                  while (0 < rgwtTerra[i]) {
                    if (rgwtTerra[i] < 100) {
                      sVar14 = rgwtTerra[i];
                    }
                    else {
                      sVar14 = 100;
                    }
                    _r = CONCAT22(sVar14,_r);
                    sVar14 = Random(200);
                    if (sVar14 < wtCur) {
                      cTerraTemp = cTerraTemp + 1;
                      sVar14 = Random(10);
                      if (sVar14 == 0) {
                        cTerraPerm = cTerraPerm + 1;
                      }
                    }
                    rgwtTerra[i] = rgwtTerra[i] + -100;
                  }
                  if (0 < cTerraPerm) {
                    if (*(char *)(iplr * 0xc0 + 0x59b5 + i) < '\0') {
                      if (*(char *)(pctMinKeep + 0xf + i) < '2') {
                        if (*(char *)(pctMinKeep + 0xf + i) + -1 <= cTerraPerm) {
                          cTerraPerm = *(char *)(pctMinKeep + 0xf + i) + -1;
                        }
                        cTerraPerm = -cTerraPerm;
                      }
                      else if (99 - *(char *)(pctMinKeep + 0xf + i) <= cTerraPerm) {
                        cTerraPerm = 99 - *(char *)(pctMinKeep + 0xf + i);
                      }
                    }
                    else if (*(char *)(pctMinKeep + 0xf + i) < *(char *)(iplr * 0xc0 + 0x59b2 + i))
                    {
                      local_82 = *(char *)(pctMinKeep + 0xf + i) + cTerraPerm;
                      if (*(char *)(iplr * 0xc0 + 0x59b2 + i) < local_82) {
                        local_82 = (int)*(char *)(pctMinKeep + 0xf + i);
                        cTerraPerm = *(char *)(iplr * 0xc0 + 0x59b2 + i) - local_82;
                      }
                    }
                    else {
                      local_82 = (int)*(char *)(pctMinKeep + 0xf + i);
                      if (*(char *)(iplr * 0xc0 + 0x59b2 + i) < local_82) {
                        local_82 = *(char *)(pctMinKeep + 0xf + i) - cTerraPerm;
                        if (local_82 < *(char *)(iplr * 0xc0 + 0x59b2 + i)) {
                          local_82 = (int)*(char *)(pctMinKeep + 0xf + i);
                          cTerraPerm = *(char *)(iplr * 0xc0 + 0x59b2 + i) - local_82;
                        }
                        else {
                          cTerraPerm = -cTerraPerm;
                        }
                      }
                      else {
                        cTerraPerm = 0;
                      }
                    }
                    if (cTerraPerm != 0) {
                      sVar27 = 0;
                      sVar28 = 0;
                      sVar30 = 0;
                      sVar14 = _abs(cTerraPerm);
                      FSendPlrMsg(iplr,idmMineralPacketHasPermanentlyDefault,*_pctMinKeep,
                                       (uint)(0 < cTerraPerm),i,*_pctMinKeep,sVar14,sVar30,sVar28,
                                       sVar27);
                      uVar25 = (undefined2)((qword)_r >> 0x30);
                      iVar10 = (int)((qword)_r >> 0x20);
                      if ((*(int *)(iVar10 + 2) != -1) && (*(int *)(iVar10 + 2) != iplr)) {
                        sVar27 = 0;
                        sVar28 = 0;
                        sVar30 = 0;
                        sVar14 = _abs(cTerraPerm);
                        FSendPlrMsg(iplr,idmMineralPacketHasPermanentlyDefault2,*_pctMinKeep,
                                         (uint)(0 < cTerraPerm),i,*_pctMinKeep,sVar14,sVar30,sVar28,
                                         sVar27);
                      }
                      pcVar2 = (char *)(pctMinKeep + 0xf + i);
                      *pcVar2 = *pcVar2 + (char)cTerraPerm;
                    }
                  }
                  if (0 < cTerraTemp) {
                    idPlayer = iplr;
                    sVar14 = FCanTerraformLppl
                                       ((PLANET *)((qword)_r >> 0x20),rgMin,rgMax,rgCost,1);
                    if (sVar14 == 0) {
                      idPlayer = -1;
                    }
                    else {
                      idPlayer = -1;
                      if (*(char *)(iplr * 0xc0 + 0x59b5 + i) < '\0') {
                        cTerraTemp = cTerraTemp / 2;
                        if (*(char *)(pctMinKeep + 0xf + i) < '2') {
                          if (*(char *)(pctMinKeep + 0xc + i) + -1 <= cTerraTemp) {
                            cTerraTemp = *(char *)(pctMinKeep + 0xc + i) + -1;
                          }
                          cTerraTemp = -cTerraTemp;
                        }
                        else if (99 - *(char *)(pctMinKeep + 0xc + i) <= cTerraTemp) {
                          cTerraTemp = 99 - *(char *)(pctMinKeep + 0xc + i);
                        }
                      }
                      else if (rgMin[i] == -1) {
                        if (rgMax[i] == -1) {
                          cTerraTemp = 0;
                        }
                        else if (rgMax[i] - (int)*(char *)(pctMinKeep + 0xc + i) < cTerraTemp) {
                          cTerraTemp = rgMax[i] - (int)*(char *)(pctMinKeep + 0xc + i);
                        }
                      }
                      else if ((int)*(char *)(pctMinKeep + 0xc + i) - rgMin[i] < cTerraTemp) {
                        cTerraTemp = rgMin[i] - (int)*(char *)(pctMinKeep + 0xc + i);
                      }
                      else {
                        cTerraTemp = -cTerraTemp;
                      }
                      if (cTerraTemp != 0) {
                        pcVar2 = (char *)(pctMinKeep + 0xc + i);
                        *pcVar2 = *pcVar2 + (char)cTerraTemp;
                        pcVar2 = (char *)(pctMinKeep + 0xc + i);
                        FSendPlrMsg(iplr,idmMineralPacketHas,*_pctMinKeep,
                                         (uint)(0 < cTerraTemp),i,*_pctMinKeep,i << 8 | (int)*pcVar2
                                         ,0,0,0);
                        uVar25 = (undefined2)((qword)_r >> 0x30);
                        iVar10 = (int)((qword)_r >> 0x20);
                        if ((*(int *)(iVar10 + 2) != -1) && (*(int *)(iVar10 + 2) != iplr)) {
                          FSendPlrMsg(iplr,idmMineralPacketHas2,*_pctMinKeep,
                                           (uint)(0 < cTerraTemp),i,*_pctMinKeep,
                                           i << 8 | (int)*(char *)(iVar10 + 0xc + i),0,0,0);
                        }
                      }
                    }
                  }
                }
              }
              if (*(int *)((int)((qword)_r >> 0x20) + 2) != -1) {
                CalcPctSurvive((PLANET *)((qword)_r >> 0x20),&pct,(float *)0x0);
                uVar22 = __ftol((double)CONCAT26(rgCost[0],
                                                         CONCAT24(local_82,CONCAT22(unaff_SI,
                                                  unaff_DI))));
                if ((uVar22 == 0) ||
                   (sVar14 = GetRaceStat((PLAYER *)rgplr +
                                               *(int *)((int)((qword)_r >> 0x20) + 2),rsMajorAdv),
                   sVar14 == 8)) goto TURN_LAllSafe;
                uVar25 = (undefined2)((qword)_r >> 0x30);
                iVar13 = (int)((qword)_r >> 0x20);
                lColKilled._0_2_ = *(int *)(iVar13 + 0x28);
                iVar10 = *(int *)(iVar13 + 0x2a);
                lColKilled._2_2_ = iVar10;
                if (((uint)lColKilled == 0) && (iVar10 == 0)) {
                  FSendPlrMsg2(*(short *)(iVar13 + 2),
                                    idmBombardedKtMineralPacketFortunatelyOneHome,*_pctMinKeep,
                                    *_pctMinKeep,(uint)lpth->idFull >> 9 & 0xf);
                  lDefKilled._2_2_ = 0;
                  lColKilled._0_2_ = 0;
                  stack0xffaa = (ulong)(*(uint *)((int)((qword)_r >> 0x20) + 0x18) & 0xfff) << 0x10;
                }
                else {
                  uVar26 = 0;
                  uVar25 = 1000;
                  uVar23 = __aFulmul(CONCAT22(iVar10,(uint)lColKilled),uVar22);
                  uVar23 = __aFldiv(uVar23,CONCAT22(uVar26,uVar25));
                  if ((long)uVar23 < (long)uVar22) {
                    uVar23 = uVar22;
                  }
                  lColKilled._0_2_ = (uint)uVar23;
                  stack0xffaa = CONCAT22((uint)lDefKilled,(int)(uVar23 >> 0x10));
                  uVar25 = (undefined2)((qword)_r >> 0x30);
                  iVar10 = (int)((qword)_r >> 0x20);
                  if (((-1 < *(int *)(iVar10 + 0x2a)) &&
                      ((0 < *(int *)(iVar10 + 0x2a) || (*(int *)(iVar10 + 0x28) != 0)))) &&
                     ((CONCAT22(*(undefined2 *)(iVar10 + 0x2a),*(undefined2 *)(iVar10 + 0x28)) <=
                       (long)uVar23 || (((long)uVar23 < 0x10000 && ((long)uVar23 < 0)))))) {
                    FSendPlrMsg2(*(short *)(iVar10 + 2),
                                      idmAnnihilatedMineralPacketColonistsKilled,*_pctMinKeep,
                                      *_pctMinKeep,(uint)lpth->idFull >> 9 & 0xf);
                    UninhabitPlanet((PLANET *)((qword)_r >> 0x20));
                    goto TURN_LFreeThePacket;
                  }
                  uVar29 = 0;
                  uVar26 = 1000;
                  uVar23 = __aFulmul((ulong)*(uint *)(iVar10 + 0x18) & 0xffff0fff,uVar22);
                  lVar21 = __aFldiv(uVar23,CONCAT22(uVar29,uVar26));
                  lDefKilled._2_2_ = (int)((ulong)lVar21 >> 0x10);
                  stack0xffaa = CONCAT22((int)lVar21,lColKilled._2_2_);
                  if ((lVar21 == 0) && ((*(uint *)((int)((qword)_r >> 0x20) + 0x18) & 0xfff) != 0))
                  {
                    sVar14 = Random(0x14);
                    stack0xffaa = (ulong)CONCAT12((long)sVar14 < (long)uVar22,lColKilled._2_2_);
                    lDefKilled._2_2_ = 0;
                  }
                  lVar21 = __aFldiv(uVar22,0x14);
                  iVar10 = (int)((ulong)lVar21 >> 0x10);
                  if ((lDefKilled._2_2_ <= iVar10) &&
                     ((lDefKilled._2_2_ < iVar10 || ((uint)lDefKilled < (uint)lVar21)))) {
                    lVar21 = __aFldiv(uVar22,0x14);
                    lDefKilled._2_2_ = (int)((ulong)lVar21 >> 0x10);
                    stack0xffaa = CONCAT22((int)lVar21,lColKilled._2_2_);
                  }
                  uVar25 = (undefined2)((qword)_r >> 0x30);
                  iVar10 = (int)((qword)_r >> 0x20);
                  if ((-1 < lDefKilled._2_2_) &&
                     ((0 < lDefKilled._2_2_ ||
                      ((*(uint *)(iVar10 + 0x18) & 0xfff) < (uint)lDefKilled)))) {
                    stack0xffaa = CONCAT22(*(undefined2 *)(iVar10 + 0x18),lColKilled._2_2_) &
                                  0xfffffff;
                    lDefKilled._2_2_ = 0;
                  }
                  if (((uint)lDefKilled == 0) && (lDefKilled._2_2_ == 0)) {
                    if (iWarp == 0) {
                      idm = idmBombardedKtMineralPacketColonistsKilledCollision;
                    }
                    else {
                      idm = idmMassAcceleratorPartiallySuccessfullyCapturingKtM;
                    }
                    sVar30 = 0;
                    sVar14 = 0;
                    uVar11 = (uint)lpth->idFull >> 9;
                    uVar12 = uVar11 & 0xf;
                    uVar15 = (uint)lColKilled;
                    uVar22 = __aFulshr(CONCAT22((uint)lColKilled,uVar11) & 0xffff000f,0);
                    FSendPlrMsg(*(short *)((int)((qword)_r >> 0x20) + 2),idm,*_pctMinKeep,
                                     *_pctMinKeep,fTerra,(short)uVar22,uVar12,uVar15,sVar14,sVar30);
                  }
                  else {
                    if (iWarp == 0) {
                      idm = idmBombardedKtMineralPacketColonistsDefensesDestroy;
                    }
                    else {
                      idm = idmMassAcceleratorPartiallySuccessfullyCapturingKtM2;
                    }
                    sVar14 = 0;
                    uVar11 = (uint)lpth->idFull >> 9;
                    uVar12 = uVar11 & 0xf;
                    uVar15 = (uint)lColKilled;
                    p6 = (uint)lDefKilled;
                    uVar22 = __aFulshr(CONCAT22((uint)lColKilled,uVar11) & 0xffff000f,
                                               (uint)lDefKilled);
                    FSendPlrMsg(*(short *)((int)((qword)_r >> 0x20) + 2),idm,*_pctMinKeep,
                                     *_pctMinKeep,fTerra,(short)uVar22,uVar12,uVar15,p6,sVar14);
                    uVar25 = (undefined2)((qword)_r >> 0x30);
                    iVar10 = (int)((qword)_r >> 0x20);
                    uVar15 = *(int *)(iVar10 + 0x18) - (uint)lDefKilled & 0xfff;
                    stack0xff94 = (THING *)(ulong)uVar15;
                    *(uint *)(iVar10 + 0x18) = *(uint *)(iVar10 + 0x18) & 0xf000;
                    *(undefined2 *)(iVar10 + 0x1a) = *(undefined2 *)(iVar10 + 0x1a);
                    *(uint *)(iVar10 + 0x18) = *(uint *)(iVar10 + 0x18) | uVar15;
                    *(undefined2 *)(iVar10 + 0x1a) = *(undefined2 *)(iVar10 + 0x1a);
                  }
                }
                uVar25 = (undefined2)((qword)_r >> 0x30);
                iVar10 = (int)((qword)_r >> 0x20);
                puVar1 = (uint *)(iVar10 + 0x28);
                uVar15 = *puVar1;
                *puVar1 = *puVar1 - (uint)lColKilled;
                piVar3 = (int *)(iVar10 + 0x2a);
                *piVar3 = (*piVar3 - lColKilled._2_2_) - (uint)(uVar15 < (uint)lColKilled);
              }
            }
            goto TURN_LFreeThePacket;
          }
          _dxRound = DOUBLE_0_5__1120_1d5e;
          if (ptDst.x <= iVar10) {
            _dxRound = DOUBLE_m0_5__1120_1d66;
          }
          bVar19 = (uint)ptDst.y < uVar15;
          bVar20 = ptDst.y == uVar15;
          _dyRound = DOUBLE_0_5__1120_1d5e;
          if (ptDst.y <= (int)uVar15) {
            _dyRound = DOUBLE_m0_5__1120_1d66;
          }
          __aFfcompp();
          if ((!bVar19 && !bVar20) || (__aFfcompp(), bVar19)) {
            stack0xffaa = (ulong)dRange;
            _r = (double)stack0xffaa / dVar4;
            stack0xffaa = (ulong)(ptDst.x - iVar10);
            lVar24 = __ftol((double)CONCAT26(rgCost[0],
                                                     CONCAT24(local_82,CONCAT22(unaff_SI,unaff_DI)))
                                   );
            iVar10 = (int)lVar24 + iVar10;
            stack0xffaa = (ulong)(int)(ptDst.y - uVar15);
            lVar24 = __ftol((double)CONCAT26(rgCost[0],
                                                     CONCAT24(local_82,CONCAT22(unaff_SI,unaff_DI)))
                                   );
            iVar13 = (int)lVar24 + uVar15;
            if ((iVar10 == ptDst.x) && (iVar13 == ptDst.y)) goto TURN_MadeItThere;
            (&((THING *)lpth)->pt)->x = iVar10;
            (((THING *)lpth)->pt).y = iVar13;
          }
          if (((fPostProd != 0) && ((uint)lpth->idFull >> 0xd == 1)) &&
             (sVar14 = FPacketDecay(lpth,0x32), sVar14 != 0)) goto TURN_LPacketAlreadyFreed;
          goto LAB_10b0_2ed3;
        }
TURN_LFreeThePacket:
        FreeLpth(lpth);
TURN_LPacketAlreadyFreed:
        lpth = (THING *)CONCAT22(iVar18,(THING *)lpth + -1);
        lpthMac._0_2_ = (THING *)lpthMac + -1;
      }
    }
LAB_10b0_2ed3:
    lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
  } while( true );
  sVar14 = *(short *)(((THING *)lpth)->rgb + 2);
  (&((THING *)lpth)->pt)->x = *(short *)((THING *)lpth)->rgb;
  (((THING *)lpth)->pt).y = sVar14;
  dRange = (*(uint *)(((THING *)lpth)->rgb + 4) & 0xf) - 2;
  if (dRange < 6) {
    dRange = 6;
  }
  idm = 0xc0;
TURN_LRetargetFreighter:
  sVar14 = Random(2);
  if (sVar14 == 0) {
    _dyRound = CONCAT22(game.mdSize * 400 + 0x564,_dyRound);
  }
  else {
    _dyRound = CONCAT22(0x3fc,_dyRound);
  }
  sVar14 = Random(game.mdSize * 400 + 0x169);
  _dyRound = CONCAT24(sVar14 + 0x3fc,_dyRound);
  sVar14 = Random(2);
  _dyRound = (double)CONCAT26(sVar14,_dyRound);
  *(short *)((THING *)lpth)->rgb = rgwtTerra[sVar14];
  *(short *)(((THING *)lpth)->rgb + 2) = rgwtTerra[sVar14 == 0];
TURN_LSpeedUpOnly:
  _dyRound = (double)CONCAT62(rgwtTerra,dRange + 1U);
  *(uint *)(((THING *)lpth)->rgb + 4) =
       *(uint *)(((THING *)lpth)->rgb + 4) & 0xfff0 | dRange + 1U & 0xf;
  for (k = 0; k < game.cPlayer; k = k + 1) {
    FSendPlrMsg2(k,idm,-6,lpth->idFull,0);
  }
LAB_10b0_1c3e:
  uVar15 = *(uint *)(((THING *)lpth)->rgb + 4) & 0xf;
  dRange = uVar15 * uVar15;
  ptDst.x = *(short *)((THING *)lpth)->rgb;
  ptDst.y = *(short *)(((THING *)lpth)->rgb + 2);
  bVar5 = true;
  if (idm == 0xc0) goto LAB_10b0_2ed3;
  goto TURN_MoveTh;
}



// ======================================================================
// Function: FuelFleets
// Address: 10b0:2efa
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b03265) */

void FuelFleets(void)

{
  FLEET *pFVar1;
  int iVar2;
  undefined2 uVar3;
  int iVar4;
  int iVar5;
  HULDEF *pHVar6;
  ulong uVar7;
  long lVar8;
  long lVar9;
  ulong uVar10;
  HUL *lphul;
  long csh;
  SHDEF *lpshdef;
  FLEET *lpfl;
  short ifl;
  short i;
  PLANET *lppl;
  long cPods;
  short j;
  
  ifl = 0;
  while( true ) {
    if (cFleet <= ifl) {
      return;
    }
                    /* WARNING: Load size is inaccurate */
    pFVar1 = ((FLEET **)rglpfl)[ifl];
    iVar2 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    if ((pFVar1 == (FLEET *)0x0) && (iVar2 == 0)) break;
    if (((uint)pFVar1->wFlags >> 10 & 1) == 0) {
      if (((((pFVar1->idPlanet == -1) ||
            (((uint)((PLANET *)lpPlanets)[pFVar1->idPlanet].wFlags >> 9 & 1) == 0)) ||
           (iVar5 = pFVar1->idPlanet, ((PLANET *)lpPlanets)[iVar5].iPlayer == -1)) ||
          ((pFVar1->iPlayer != ((PLANET *)lpPlanets)[iVar5].iPlayer &&
           (*(char *)(((PLANET *)lpPlanets)[iVar5].iPlayer * 0xc0 + 0x5a12 + pFVar1->iPlayer)
            != '\x01')))) ||
         (iVar4 = ((PLANET *)lpPlanets)[iVar5].iPlayer * 4,
         pHVar6 = LphuldefFromId
                            (*(HullDef *)
                              (*(int *)(iVar4 + 0x14c) +
                              (*(uint *)&((PLANET *)lpPlanets)[iVar5].field11_0x2c & 0xf) *
                              0x93)), (((HULDEF *)pHVar6)->hul).wtCargoMax == 0)) {
        lVar9 = 0;
        uVar10 = 0;
        for (i = 0; i < 0x10; i = i + 1) {
          if (pFVar1->rgcsh[i] != 0) {
            iVar5 = pFVar1->iPlayer * 4;
            uVar3 = *(undefined2 *)(iVar5 + 0x100);
            iVar5 = *(int *)(iVar5 + 0xfe) + i * 0x93;
            j = (short)*(byte *)(iVar5 + 0x7a);
            while (j = j - 1, -1 < j) {
              if ((*(int *)(iVar5 + 0x3a + j * 4) == 0x800) &&
                 ((*(uint *)(iVar5 + j * 4 + 0x3c) & 0xff) == 0x10)) {
                uVar7 = __aFulmul((long)pFVar1->rgcsh[i],
                                          (ulong)(*(uint *)(iVar5 + j * 4 + 0x3c) >> 8));
                uVar10 = uVar7 + uVar10;
              }
            }
            iVar5 = pFVar1->iPlayer * 4;
            lpshdef = (SHDEF *)CONCAT22(*(undefined2 *)(iVar5 + 0x100),
                                        (SHDEF *)(*(int *)(iVar5 + 0xfe) + i * 0x93));
            if (((lpshdef->hul).ihuldef == ihuldefFuelTransport) ||
               ((lpshdef->hul).ihuldef == ihuldefSuperFuelXport)) {
              uVar7 = __aFulmul((long)pFVar1->rgcsh[i],200);
              lVar9 = uVar7 + lVar9;
            }
          }
        }
        if ((lVar9 != 0) || (uVar10 != 0)) {
          lVar8 = LGetFleetStat((FLEET *)CONCAT22(iVar2,pFVar1),1);
          uVar7 = __aFulmul(uVar10,0x32);
          if (lVar8 < (long)(uVar7 + lVar9 + CONCAT22(*(undefined2 *)((int)pFVar1->rgwtMin + 0x12),
                                                      (int)pFVar1->rgwtMin[4]))) {
            lVar9 = LGetFleetStat((FLEET *)CONCAT22(iVar2,pFVar1),1);
          }
          else {
            uVar10 = __aFulmul(uVar10,0x32);
            lVar9 = uVar10 + lVar9 + CONCAT22(*(undefined2 *)((int)pFVar1->rgwtMin + 0x12),
                                              (int)pFVar1->rgwtMin[4]);
          }
          *(int *)(pFVar1->rgwtMin + 4) = (int)lVar9;
          *(undefined2 *)((int)pFVar1->rgwtMin + 0x12) = (int)((ulong)lVar9 >> 0x10);
        }
      }
      else {
        lVar9 = LGetFleetStat((FLEET *)CONCAT22(iVar2,pFVar1),1);
        *(int *)(pFVar1->rgwtMin + 4) = (int)lVar9;
        *(undefined2 *)((int)pFVar1->rgwtMin + 0x12) = (int)((ulong)lVar9 >> 0x10);
      }
    }
    ifl = ifl + 1;
  }
  return;
}



// ======================================================================
// Function: MoveFleets
// Address: 10b0:32ce
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Variable defined which should be unmapped: fDead */
/* WARNING: Removing unreachable block (ram,0x10b04964) */
/* WARNING: Removing unreachable block (ram,0x10b04ed9) */
/* WARNING: Removing unreachable block (ram,0x10b04c3a) */
/* WARNING: Removing unreachable block (ram,0x10b03dd4) */
/* WARNING: Removing unreachable block (ram,0x10b0441c) */
/* WARNING: Removing unreachable block (ram,0x10b0453b) */
/* WARNING: Removing unreachable block (ram,0x10b03ef6) */
/* WARNING: Removing unreachable block (ram,0x10b047ac) */
/* WARNING: Removing unreachable block (ram,0x10b0486f) */
/* WARNING: Removing unreachable block (ram,0x10b04836) */
/* WARNING: Removing unreachable block (ram,0x10b0488a) */
/* WARNING: Removing unreachable block (ram,0x10b048d7) */
/* WARNING: Removing unreachable block (ram,0x10b04913) */
/* WARNING: Removing unreachable block (ram,0x10b0497a) */
/* WARNING: Removing unreachable block (ram,0x10b04c8c) */

void MoveFleets(void)

{
  int *piVar1;
  uint *puVar2;
  double dVar3;
  short *psVar4;
  uint uVar5;
  THING *pTVar6;
  int iVar7;
  uint uVar8;
  POINT pt;
  undefined4 uVar9;
  double dVar10;
  int iVar11;
  undefined1 extraout_AH;
  undefined1 *puVar12;
  short sVar13;
  uint uVar14;
  int iVar15;
  uint *puVar16;
  FLEET *pFVar17;
  int iVar18;
  undefined2 unaff_SI;
  short *psVar19;
  ushort unaff_DI;
  FLEET *pFVar20;
  undefined2 uVar21;
  undefined2 uVar22;
  undefined2 uVar23;
  undefined2 unaff_SS;
  bool bVar24;
  bool bVar25;
  bool bVar26;
  PLANET *pPVar27;
  ulong uVar28;
  long lVar29;
  ulong uVar30;
  FLEET *pFVar31;
  long lVar32;
  THING *pTVar33;
  PLORD *pPVar34;
  short sVar35;
  short sVar36;
  short p7;
  undefined2 uVar37;
  short fDead;
  short cKillTot;
  FLEET flDead;
  short cTry;
  undefined1 auStack_dc [112];
  double dxRound;
  int iStack_6a;
  undefined2 uStack_68;
  short grbitPlr;
  THING *lpth;
  PLANET *pPStack_60;
  THING *lpthDest;
  short sStack_54;
  short fDone;
  long lFuelGain;
  long dActTravel;
  long wtFuelUsed;
  POINT ptBeg;
  long dRange;
  short dMineTravel;
  long pct;
  double r;
  FLEET *lpfl;
  short ifl;
  POINT ptEnd;
  ORDER *lpord;
  short fRanOutOfFuel;
  short fGotEnufFuel;
  double d;
  long wtFuel2Dest;
  short cPass;
  long dTravel;
  
  lVar29 = CONCAT22(wtFuelUsed._2_2_,(undefined2)wtFuelUsed);
  cPass = 0;
  if (0 < cFleet) {
    do {
      fDone = 1;
      ifl = 0;
LAB_10b0_32fa:
      wtFuelUsed = lVar29;
      if (ifl < cFleet) {
                    /* WARNING: Load size is inaccurate */
        pFVar17 = ((FLEET **)rglpfl)[ifl];
        iVar11 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar11,pFVar17);
        if ((pFVar17 != (FLEET *)0x0) || (iVar11 != 0)) {
          if (cPass == 0) {
            *(undefined2 *)&pFVar17->field17_0x74 = 0;
            pFVar17->wFlags = 0;
            pFVar17->wFlags = pFVar17->wFlags & 0xdfffU | 0x2000;
          }
          if ((((uint)pFVar17->wFlags >> 10 & 1) == 0) &&
             ((cPass < 1 || (((uint)pFVar17->wFlags >> 0xb & 1) == 0)))) {
            pFVar17->wFlags = pFVar17->wFlags & 0xf7ffU | 0x800;
            iVar15 = *(int *)&pFVar17->lpplord;
            uVar23 = *(undefined2 *)((int)&pFVar17->lpplord + 2);
            lpord = (ORDER *)CONCAT22(uVar23,(ORDER *)(iVar15 + 4));
            if (((*(uint *)(iVar15 + 10) & 0xf) == 1) ||
               ((((*(uint *)(iVar15 + 10) & 0xf) == 6 || (pFVar17->cord < 2)) ||
                ((*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) == 0)))) goto LAB_10b0_32f6;
            if ((*(uint *)((int)&rgplr[0].wFlags + pFVar17->iPlayer * 0xc0) >> 2 & 1) != 0
               ) {
              if (((uint)game.turn < 0xb) ||
                 ((game.turn & 7U) != (pFVar17->iPlayer & 7U))) {
                sVar13 = Random(4);
                lVar29 = wtFuelUsed;
                if (sVar13 != 0) goto LAB_10b0_3496;
                FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                  idmHasRefusedMoveDoubtingAuthorityRulePress,-5,lpfl->id,0);
                lVar29 = wtFuelUsed;
              }
              goto LAB_10b0_32f6;
            }
LAB_10b0_3496:
            if (((cPass == 0) && (6 < (*(uint *)(iVar15 + 0x1c) >> 4 & 0xf))) &&
               ((*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) != 0xb)) {
              wtFuelUsed = lVar29;
              sVar13 = GetRaceGrbit((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                          ibitRaceCheapEngines);
              lVar29 = wtFuelUsed;
              if (sVar13 != 0) {
                sVar13 = Random(10);
                lVar29 = wtFuelUsed;
                if (sVar13 == 0) {
                  FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                    idmUnableEngageEnginesDueBalkyEquipmentEngineers,
                                    lpfl->id | 0x8000,lpfl->id,0);
                  lVar29 = wtFuelUsed;
                  goto LAB_10b0_32f6;
                }
              }
            }
            wtFuelUsed = lVar29;
            if ((*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) < 0xb) {
              uVar21 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar17 = (FLEET *)lpfl;
              ptBeg.x = (&pFVar17->pt)->x;
              ptBeg.y = (pFVar17->pt).y;
              if ((0 < cPass) && ((*(uint *)(iVar15 + 0x1c) >> 0xd & 1) == 0)) {
                uVar22 = (undefined2)((ulong)pFVar17->lpflNext >> 0x10);
                pFVar17 = (FLEET *)pFVar17->lpflNext;
                sVar13 = (pFVar17->pt).y;
                *(short *)(iVar15 + 0x16) = (&pFVar17->pt)->x;
                *(short *)(iVar15 + 0x18) = sVar13;
              }
              ptEnd.x = *(short *)(iVar15 + 0x16);
              ptEnd.y = *(short *)(iVar15 + 0x18);
              uVar28 = EstFuelUse(lpfl,0,-1,-1,1);
              lVar29 = EstFuelUse(lpfl,0,-1,-1,0);
              dRange._0_2_ = (uint)uVar28;
              uVar21 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar17 = (FLEET *)lpfl;
              fGotEnufFuel = (short)(lVar29 <=
                                    CONCAT22(*(undefined2 *)((int)pFVar17->rgwtMin + 0x12),
                                             (int)pFVar17->rgwtMin[4]));
              bVar24 = false;
              if ((fGotEnufFuel != 0) &&
                 (((long)uVar28 < 0 ||
                  (((long)uVar28 < 0x10000 &&
                   ((uint)dRange <=
                    (*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) * (*(uint *)(iVar15 + 0x1c) >> 4 & 0xf))))
                  ))) {
                uVar28 = (ulong)((*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) *
                                (*(uint *)(iVar15 + 0x1c) >> 4 & 0xf));
              }
              if (cPass == 0) {
                iVar11 = *(int *)((int)pFVar17->rgwtMin + 0xe);
                if ((-1 < iVar11) && ((0 < iVar11 || (10 < *(uint *)(pFVar17->rgwtMin + 3))))) {
                  sVar13 = GetRaceStat((PLAYER *)rgplr + pFVar17->iPlayer,rsMajorAdv
                                            );
                  if (sVar13 == 8) {
                    uVar37 = 0;
                    uVar22 = 100;
                    uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                    uVar30 = __aFulmul(CONCAT22(*(undefined2 *)
                                                         ((int)((FLEET *)lpfl)->rgwtMin + 0xe),
                                                        (int)((FLEET *)lpfl)->rgwtMin[3]),3);
                    lVar29 = __aFldiv(uVar30 + 0x21,CONCAT22(uVar37,uVar22));
                    iVar11 = (int)((ulong)lVar29 >> 0x10);
                    uVar14 = (uint)lVar29;
                    _lpth = CONCAT24(uVar14,lpth);
                    _lpth = (double)CONCAT26(iVar11,_lpth);
                    if (0 < lVar29) {
                      uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                      puVar2 = (uint *)(((FLEET *)lpfl)->rgwtMin + 3);
                      uVar8 = *puVar2;
                      *puVar2 = *puVar2 - uVar14;
                      piVar1 = (int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
                      *piVar1 = (*piVar1 - iVar11) - (uint)(uVar8 < uVar14);
                      p7 = 0;
                      sVar36 = 0;
                      sVar35 = 0;
                      sVar13 = 0;
                      uVar14 = lpfl->id;
                      uVar30 = __aFulshr((ulong)uVar14,0);
                      FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                       idmDueRigorsWarpAccelerationColonistsHaveDied,
                                       lpfl->id | 0x8000,(short)pPStack_60,(short)uVar30,uVar14,
                                       sVar13,sVar35,sVar36,p7);
                    }
                  }
                }
                if ((*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) == 10) {
                  uVar21 = lpfl._2_2_;
                  psVar19 = (short *)auStack_dc;
                  pFVar17 = (FLEET *)lpfl;
                  for (iVar11 = 0x3e; iVar11 != 0; iVar11 = iVar11 + -1) {
                    psVar4 = psVar19;
                    psVar19 = psVar19 + 1;
                    pFVar31 = pFVar17;
                    pFVar17 = (FLEET *)&pFVar17->iPlayer;
                    *psVar4 = pFVar31->id;
                  }
                  fDead = 1;
                  cKillTot = 0;
                  _memset(&flDead,0,0x7c);
                  _lpth = ZEXT46(lpth);
                  while( true ) {
                    pFVar17 = (FLEET *)lpfl;
                    uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                    if (0xf < (int)pPStack_60) break;
                    if (*(int *)(auStack_dc + (int)pPStack_60 * 2 + 0xc) != 0) {
                      iVar11 = pFVar17->iPlayer * 4;
                      if (((((*(uint *)(*(int *)(iVar11 + 0xfe) + (int)pPStack_60 * 0x93 + 0x3c) &
                             0xff) != 7) &&
                           (iVar11 = pFVar17->iPlayer * 4,
                           (*(uint *)(*(int *)(iVar11 + 0xfe) + (int)pPStack_60 * 0x93 + 0x3c) &
                           0xff) != 9)) &&
                          (iVar11 = pFVar17->iPlayer * 4,
                          (*(uint *)(*(int *)(iVar11 + 0xfe) + (int)pPStack_60 * 0x93 + 0x3c) & 0xff
                          ) != 0xe)) &&
                         ((iVar11 = pFVar17->iPlayer * 4,
                          (*(uint *)(*(int *)(iVar11 + 0xfe) + (int)pPStack_60 * 0x93 + 0x3c) & 0xff
                          ) != 0xf &&
                          (iVar11 = pFVar17->iPlayer * 4,
                          (*(uint *)(*(int *)(iVar11 + 0xfe) + (int)pPStack_60 * 0x93 + 0x3c) & 0xff
                          ) != 8)))) {
                        _lpth = (double)((qword)_lpth & 0xffffffffffff);
                        cTry = *(short *)(auStack_dc + (int)pPStack_60 * 2 + 0xc);
                        while (iVar11 = cTry + -1, cTry != 0) {
                          sVar13 = Random(10);
                          cTry = iVar11;
                          if (sVar13 == 0) {
                            _lpth = (double)CONCAT26((undefined1 *)
                                                     ((int)&((THING *)lpthDest)->idFull + 1),_lpth);
                          }
                        }
                        if (0 < (int)(THING *)lpthDest) {
                          cKillTot = (short)(((THING *)lpthDest)->rgb + cKillTot + -6);
                          *(int *)(auStack_dc + (int)pPStack_60 * 2 + 0xc) =
                               *(int *)(auStack_dc + (int)pPStack_60 * 2 + 0xc) -
                               (int)(THING *)lpthDest;
                          flDead.rgcsh[(int)pPStack_60] = (short)(THING *)lpthDest;
                        }
                      }
                      if (0 < *(int *)(auStack_dc + (int)pPStack_60 * 2 + 0xc)) {
                        fDead = 0;
                      }
                    }
                    _lpth = CONCAT24((int)pPStack_60 + 1,lpth);
                  }
                  if (fDead != 0) {
                    pFVar17->wFlags = pFVar17->wFlags & 0xfbffU | 0x400;
                    FSendPlrMsg2(pFVar17->iPlayer,
                                      idmDestroyedMassiveReactorAccidentDueUnsafeOperatin,
                                      lpfl->id | 0x8000,lpfl->id,0);
                    lVar29 = wtFuelUsed;
                    goto LAB_10b0_32f6;
                  }
                  if (0 < cKillTot) {
                    flDead.iPlayer = auStack_dc._2_2_;
                    flDead.wFlags = flDead.wFlags & 0xfb00U | 0x407;
                    FleetTransferCargoBalance((FLEET *)auStack_dc,&flDead);
                    psVar19 = (short *)auStack_dc;
                    uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                    pFVar20 = (FLEET *)lpfl;
                    pFVar17 = pFVar20;
                    for (iVar11 = 0x3e; iVar11 != 0; iVar11 = iVar11 + -1) {
                      pFVar31 = pFVar17;
                      pFVar17 = (FLEET *)&pFVar17->iPlayer;
                      psVar4 = psVar19;
                      psVar19 = psVar19 + 1;
                      pFVar31->id = *psVar4;
                    }
                    if (cKillTot == 1) {
                      FSendPlrMsg2(pFVar20->iPlayer,
                                        idmOneShipsDestroyedWhenEnginesReactedTrying,
                                        lpfl->id | 0x8000,lpfl->id,0);
                    }
                    else {
                      FSendPlrMsg2(pFVar20->iPlayer,idmShipsDestroyedDueEngineStrain,
                                        lpfl->id | 0x8000,cKillTot,lpfl->id);
                    }
                  }
                }
                uVar14 = (*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) *
                         (*(uint *)(iVar15 + 0x1c) >> 4 & 0xf);
                dTravel = (long)uVar14;
                if ((*(uint *)(iVar15 + 0x1c) >> 8 & 0xf) == 2) {
                  pFVar31 = LpflFromId(*(short *)(iVar15 + 0x1a));
                  uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                  pFVar17 = (FLEET *)lpfl;
                  *(FLEET **)&pFVar17->lpflNext = (FLEET *)pFVar31;
                  *(undefined2 *)((int)&pFVar17->lpflNext + 2) = (int)((ulong)pFVar31 >> 0x10);
                  if ((*(int *)&pFVar17->lpflNext != 0) ||
                     (*(int *)((int)&pFVar17->lpflNext + 2) != 0)) {
                    fDone = 0;
                    pFVar17->wFlags = pFVar17->wFlags & 0xf7ff;
                    *(uint *)&pFVar17->field13_0x6c = uVar14;
                    pFVar17->dMoveUsed = 0;
                    *(undefined2 *)&pFVar17->lFuelUsed = 0;
                    *(undefined2 *)((int)&pFVar17->lFuelUsed + 2) = 0;
                    lVar29 = wtFuelUsed;
                    goto LAB_10b0_32f6;
                  }
                }
              }
              else {
                if (((uint)((FLEET *)pFVar17->lpflNext)->wFlags >> 0xb & 1) == 0) {
                  if (*(int *)&pFVar17->field13_0x6c <
                      (*(int *)&pFVar17->field13_0x6c + pFVar17->dMoveUsed + 4) / 5) {
                    iVar11 = *(int *)&pFVar17->field13_0x6c;
                  }
                  else {
                    iVar11 = (*(int *)&pFVar17->field13_0x6c + pFVar17->dMoveUsed + 4) / 5;
                  }
                }
                else {
                  iVar11 = *(int *)&pFVar17->field13_0x6c;
                }
                dTravel = (long)iVar11;
                uVar28 = uVar28 - (long)pFVar17->dMoveUsed;
                if (((int)(uVar28 >> 0x10) < 1) && ((long)uVar28 < 0)) {
                  uVar28 = 0;
                }
              }
              dVar10 = DGetDistance(ptBeg.x,ptBeg.y,ptEnd.x,ptEnd.y);
              dVar3 = *(double *)CONCAT11(extraout_AH,dVar10);
              lVar29 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,
                                                  unaff_DI))));
              iVar11 = (int)(uint)lVar29 >> 0xf;
              if ((iVar11 < dTravel._2_2_) ||
                 ((iVar11 <= dTravel._2_2_ && ((uint)lVar29 <= (uint)dTravel)))) {
                lVar29 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,
                                                  unaff_DI))));
                dTravel._0_2_ = (uint)lVar29;
                dTravel._2_2_ = (int)(uint)dTravel >> 0xf;
              }
              if ((long)uVar28 < dTravel) {
                *(undefined2 *)(((FLEET *)lpfl)->rgwtMin + 4) = 0;
                *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = 0;
                lVar29 = 1;
                dTravel = uVar28;
              }
              else {
                if (0 < cPass) {
                  uVar8 = *(uint *)&((FLEET *)lpfl)->lFuelUsed;
                  iVar11 = *(int *)((int)&((FLEET *)lpfl)->lFuelUsed + 2);
                  puVar2 = (uint *)(((FLEET *)lpfl)->rgwtMin + 4);
                  uVar14 = *puVar2;
                  *puVar2 = *puVar2 + uVar8;
                  piVar1 = (int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
                  *piVar1 = *piVar1 + iVar11 + (uint)CARRY2(uVar14,uVar8);
                  uVar14 = ((FLEET *)lpfl)->dMoveUsed;
                  dTravel = CONCAT22(dTravel._2_2_ + ((int)uVar14 >> 0xf) +
                                     (uint)CARRY2((uint)dTravel,uVar14),(uint)dTravel + uVar14);
                }
                lVar29 = EstFuelUse(lpfl,0,-1,dTravel,0);
                iVar11 = (int)((ulong)lVar29 >> 0x10);
                uVar14 = (uint)lVar29;
                pFVar17 = (FLEET *)lpfl;
                uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                if (0 < cPass) {
                  *(uint *)&pFVar17->lFuelUsed = uVar14;
                  *(int *)((int)&pFVar17->lFuelUsed + 2) = iVar11;
                  uVar8 = pFVar17->dMoveUsed;
                  dTravel = CONCAT22((dTravel._2_2_ - ((int)uVar8 >> 0xf)) -
                                     (uint)((uint)dTravel < uVar8),(uint)dTravel - uVar8);
                }
                iVar18 = (*(int *)((int)pFVar17->rgwtMin + 0x12) - iVar11) -
                         (uint)(*(uint *)(pFVar17->rgwtMin + 4) < uVar14);
                if ((iVar18 < 1) && (iVar18 < 0)) {
                  iVar18 = 0;
                  iVar11 = 0;
                }
                else {
                  iVar18 = *(uint *)(pFVar17->rgwtMin + 4) - uVar14;
                  iVar11 = (*(int *)((int)pFVar17->rgwtMin + 0x12) - iVar11) -
                           (uint)(*(uint *)(pFVar17->rgwtMin + 4) < uVar14);
                }
                *(int *)(pFVar17->rgwtMin + 4) = iVar18;
                *(int *)((int)pFVar17->rgwtMin + 0x12) = iVar11;
              }
              uVar21 = (undefined2)((ulong)lpfl >> 0x10);
              if ((((int)((FLEET *)lpfl)->rgwtMin[4] == 0) &&
                  (*(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) == 0)) && (0 < lVar29)) {
                bVar25 = false;
                wtFuelUsed = lVar29;
                __aFfcompp();
                lVar29 = wtFuelUsed;
                if (((!bVar25) || (uVar28 == 0)) && (fGotEnufFuel == 0)) {
                  _lpth = (double)((qword)_lpth & 0xffffffffffff);
                  do {
                    puVar12 = (undefined1 *)((int)&((THING *)lpthDest)->idFull + 1);
                    _lpth = (double)CONCAT26(puVar12,_lpth);
                    lVar29 = EstFuelUse(lpfl,0,(short)puVar12,-1,0);
                    if (lVar29 != 0) break;
                  } while ((int)(THING *)lpthDest < 10);
                  pFVar17 = (FLEET *)lpfl;
                  uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                  if ((int)(THING *)lpthDest < 2) {
                    FSendPlrMsg2(pFVar17->iPlayer,idmHasRunFuel,lpfl->id | 0x8000,lpfl->id,0);
                  }
                  else {
                    puVar12 = (undefined1 *)((int)&((THING *)lpthDest)[-1].turn + 1);
                    _lpth = CONCAT24(puVar12,lpth);
                    ((PLORD *)pFVar17->lpplord + 7)->wFlags =
                         ((PLORD *)pFVar17->lpplord + 7)->wFlags & 0xff0fU |
                         ((uint)puVar12 & 0xf) << 4;
                    FSendPlrMsg2(pFVar17->iPlayer,idmHasRunFuelFleetsSpeedHasDecreased,
                                      lpfl->id | 0x8000,lpfl->id,
                                      (short)((int)&((THING *)lpthDest)[-1].turn + 1));
                  }
                  bVar24 = true;
                  lVar29 = wtFuelUsed;
                }
              }
              if (uVar28 == 0) goto LAB_10b0_32f6;
              uVar21 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar17 = (FLEET *)lpfl;
              pFVar17->wFlags = pFVar17->wFlags & 0xdfff;
              _lpth = CONCAT24(ptEnd.x - ptBeg.x,lpth);
              _lpth = (double)CONCAT26(ptEnd.y - ptBeg.y,_lpth);
              if ((ptEnd.x - ptBeg.x != 0) || (ptEnd.y - ptBeg.y != 0)) {
                pFVar17->wFlags = pFVar17->wFlags & 0xffefU | 0x10;
                do {
                  wtFuelUsed = lVar29;
                  sVar13 = _abs((short)pPStack_60);
                  lVar29 = wtFuelUsed;
                  if (sVar13 < 0x80) {
                    sVar13 = _abs((short)(THING *)lpthDest);
                    lVar29 = wtFuelUsed;
                    if (sVar13 < 0x80) goto LAB_10b0_46ff;
                  }
                  _lpth = CONCAT24((int)pPStack_60 / 2,lpth);
                  _lpth = (double)CONCAT26((int)(THING *)lpthDest / 2,_lpth);
                } while( true );
              }
              goto code_r0x10b04783;
            }
            _dxRound = (double)((qword)_dxRound & 0xffffffffffff0000);
            gd._0_2_ = gd._0_2_ & 0xffbf;
            ptBeg.x = (lpord->pt).x;
            ptBeg.y = *(int *)(iVar15 + 6);
            if ((*(uint *)(iVar15 + 10) >> 8 & 0xf) == 1) {
              auStack_dc._104_2_ = (FLEET *)0xffff;
              auStack_dc._106_2_ = *(int *)(iVar15 + 8);
              pPVar27 = LpplFromId(*(short *)(iVar15 + 8));
              dVar3 = _dxRound;
              grbitPlr = SUB82(dVar3,6);
              _dxRound = CONCAT24((int)((ulong)pPVar27 >> 0x10),CONCAT22((PLANET *)pPVar27,_dxRound)
                                 );
              auStack_dc._108_2_ = IStargateFromLppl(pPVar27);
            }
            else {
              auStack_dc._108_2_ = -1;
              auStack_dc._104_2_ = ptBeg.x;
              auStack_dc._106_2_ = ptBeg.y;
            }
            if (auStack_dc._108_2_ == -1) {
              sVar13 = FFleetCanJumpgate(lpfl);
              if (sVar13 != 0) goto TURN_LNoGateNeeded;
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmAttemptedUseStargateStargateExistsThere,
                               lpfl->id | 0x8000,lpfl->id,auStack_dc._104_2_,auStack_dc._106_2_,0,0,
                               0,0);
              lVar29 = wtFuelUsed;
              goto LAB_10b0_32f6;
            }
            uVar21 = (undefined2)((qword)_dxRound >> 0x20);
            iVar11 = (int)((qword)_dxRound >> 0x10);
            if ((*(int *)(iVar11 + 2) != ((FLEET *)lpfl)->iPlayer) &&
               (auStack_dc._98_2_ = *(int *)(iVar11 + 2) * 0xc0 + 0x5a12,
               *(char *)(auStack_dc._98_2_ + ((FLEET *)lpfl)->iPlayer) != '\x01')) {
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                               idmAttemptedUseStargateCouldBecauseStarbaseOwned,lpfl->id | 0x8000,
                               lpfl->id,*_iStack_6a,*_iStack_6a,0,0,0,0);
              lVar29 = wtFuelUsed;
              goto LAB_10b0_32f6;
            }
TURN_LNoGateNeeded:
            ptEnd.x = *(int *)(iVar15 + 0x16);
            ptEnd.y = *(int *)(iVar15 + 0x18);
            if ((*(uint *)(iVar15 + 0x1c) >> 8 & 0xf) == 1) {
              auStack_dc._104_2_ = (FLEET *)0xffff;
              auStack_dc._106_2_ = *(short *)(iVar15 + 0x1a);
              pPVar27 = LpplFromId(*(short *)(iVar15 + 0x1a));
              _lpth = CONCAT24((PLANET *)pPVar27,lpth);
              _lpth = (double)CONCAT26((int)((ulong)pPVar27 >> 0x10),_lpth);
              auStack_dc._110_2_ = IStargateFromLppl(pPVar27);
            }
            else {
              _dxRound = (double)((qword)_dxRound & 0xffffffffffff);
              while ((grbitPlr < game.cPlanMax &&
                     (((FLEET *)ptEnd.x != (FLEET *)((POINT *)rgptPlan + grbitPlr)->x ||
                      (ptEnd.y != *(int *)((int)&rgptPlan[0].y + grbitPlr * 4)))))) {
                _dxRound = (double)CONCAT26(grbitPlr + 1,_dxRound);
              }
              if (game.cPlanMax <= grbitPlr) {
                auStack_dc._104_2_ = ptEnd.x;
                auStack_dc._106_2_ = ptEnd.y;
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                 idmAttemptedReachViaStargateCouldBecauseStargate,lpfl->id | 0x8000,
                                 lpfl->id,ptEnd.x,ptEnd.y,0,0,0,0);
                lVar29 = wtFuelUsed;
                goto LAB_10b0_32f6;
              }
              auStack_dc._104_2_ = (FLEET *)0xffff;
              auStack_dc._106_2_ = grbitPlr;
              pPVar27 = LpplFromId(grbitPlr);
              _lpth = CONCAT24((PLANET *)pPVar27,lpth);
              _lpth = (double)CONCAT26((int)((ulong)pPVar27 >> 0x10),_lpth);
              auStack_dc._110_2_ = IStargateFromLppl(pPVar27);
            }
            pFVar17 = (FLEET *)lpfl;
            uVar21 = (undefined2)((ulong)lpfl >> 0x10);
            if (auStack_dc._110_2_ == -1) {
              FSendPlrMsg(pFVar17->iPlayer,idmAttemptedUseStargateReachCouldBecauseStargate,
                               lpfl->id | 0x8000,lpfl->id,*_pPStack_60,auStack_dc._104_2_,
                               auStack_dc._106_2_,0,0,0);
              lVar29 = wtFuelUsed;
              goto LAB_10b0_32f6;
            }
            uVar22 = (undefined2)((qword)_lpth >> 0x30);
            iVar11 = (int)((qword)_lpth >> 0x20);
            if ((*(int *)(iVar11 + 2) != pFVar17->iPlayer) &&
               (auStack_dc._98_2_ = *(int *)(iVar11 + 2) * 0xc0 + 0x5a12,
               *(char *)(auStack_dc._98_2_ + pFVar17->iPlayer) != '\x01')) {
              FSendPlrMsg(pFVar17->iPlayer,idmAttemptedUseStargateReachCouldBecauseStarbase,
                               lpfl->id | 0x8000,lpfl->id,*_pPStack_60,*_pPStack_60,*_pPStack_60,0,0
                               ,0);
              lVar29 = wtFuelUsed;
              goto LAB_10b0_32f6;
            }
            if (auStack_dc._108_2_ == -1) {
              _dxRound = (double)CONCAT62(_iStack_6a,1);
              auStack_dc._108_2_ = auStack_dc._110_2_;
            }
            if (_dxRound == 0) {
              sVar13 = GetRaceStat((PLAYER *)rgplr + pFVar17->iPlayer,rsMajorAdv);
              if (sVar13 != 7) {
                uVar21 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar17 = (FLEET *)lpfl;
                iVar11 = *(int *)((int)pFVar17->rgwtMin + 0xe);
                if ((-1 < iVar11) &&
                   (((0 < iVar11 || ((int)pFVar17->rgwtMin[3] != 0)) &&
                    (*(int *)((int)((qword)_dxRound >> 0x10) + 2) != pFVar17->iPlayer)))) {
                  FSendPlrMsg2(pFVar17->iPlayer,idmUnableUseStargateBecauseHadColonistsBoard,
                                    lpfl->id | 0x8000,lpfl->id,*_iStack_6a);
                  lVar29 = wtFuelUsed;
                  goto LAB_10b0_32f6;
                }
                auStack_dc._100_2_ = (PLORD *)0x0;
                auStack_dc._102_2_ = 0;
                _dxRound = (double)((qword)_dxRound & 0xffffffffffff);
                while( true ) {
                  iVar11 = iStack_6a;
                  uVar22 = uStack_68;
                  if (2 < grbitPlr) break;
                  if (((int)pFVar17->rgwtMin[grbitPlr] != 0) ||
                     (*(int *)((int)(pFVar17->rgwtMin + grbitPlr) + 2) != 0)) {
                    uVar14 = *(uint *)(pFVar17->rgwtMin + grbitPlr);
                    bVar24 = CARRY2(auStack_dc._100_2_,uVar14);
                    auStack_dc._100_2_ = (int)(short *)auStack_dc._100_2_ + uVar14;
                    auStack_dc._102_2_ =
                         auStack_dc._102_2_ + *(uint *)((int)(pFVar17->rgwtMin + grbitPlr) + 2) +
                         (uint)bVar24;
                    uVar8 = *(uint *)(pFVar17->rgwtMin + grbitPlr);
                    uVar5 = *(uint *)((int)(pFVar17->rgwtMin + grbitPlr) + 2);
                    puVar16 = (uint *)(iStack_6a + 0x1c + grbitPlr * 4);
                    puVar2 = puVar16;
                    uVar14 = *puVar2;
                    *puVar2 = *puVar2 + uVar8;
                    puVar2 = puVar16 + 1;
                    *puVar2 = *puVar2 + uVar5 + (uint)CARRY2(uVar14,uVar8);
                    *(undefined2 *)(pFVar17->rgwtMin + grbitPlr) = 0;
                    *(undefined2 *)((int)(pFVar17->rgwtMin + grbitPlr) + 2) = 0;
                  }
                  _dxRound = (double)CONCAT26(grbitPlr + 1,_dxRound);
                }
                pTVar6 = *(THING **)(pFVar17->rgwtMin + 3);
                iVar18 = *(int *)((int)pFVar17->rgwtMin + 0xe);
                lpth = (THING *)CONCAT22(iVar18,pTVar6);
                uVar8 = *(uint *)(pFVar17->rgwtMin + 3);
                iVar7 = *(int *)((int)pFVar17->rgwtMin + 0xe);
                puVar2 = (uint *)(iVar11 + 0x28);
                uVar14 = *puVar2;
                *puVar2 = *puVar2 + uVar8;
                piVar1 = (int *)(iVar11 + 0x2a);
                *piVar1 = *piVar1 + iVar7 + (uint)CARRY2(uVar14,uVar8);
                *(undefined2 *)(pFVar17->rgwtMin + 3) = 0;
                *(undefined2 *)((int)pFVar17->rgwtMin + 0xe) = 0;
                if ((pTVar6 == (THING *)0x0) && (iVar18 == 0)) {
                  if (((PLORD *)auStack_dc._100_2_ != (PLORD *)0x0) || (auStack_dc._102_2_ != 0)) {
                    sVar36 = 0;
                    sVar35 = 0;
                    sVar13 = 0;
                    uVar14 = *_iStack_6a;
                    uVar28 = __aFulshr((ulong)uVar14,0);
                    FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                     idmHasUnloadedKtMineralsPreparationJumpingThrough,
                                     lpfl->id | 0x8000,lpfl->id,auStack_dc._100_2_,(short)uVar28,
                                     uVar14,sVar13,sVar35,sVar36);
                    if (((FLEET *)lpfl)->iPlayer != *(int *)((int)((qword)_dxRound >> 0x10) + 2)) {
                      sVar36 = 0;
                      sVar35 = 0;
                      sVar13 = 0;
                      uVar14 = *_iStack_6a;
                      uVar28 = __aFulshr((ulong)uVar14,0);
                      FSendPlrMsg(*(short *)((int)((qword)_dxRound >> 0x10) + 2),
                                       idmHasUnloadedKtMineralsPreparationJumpingThrough,*_iStack_6a
                                       ,lpfl->id,auStack_dc._100_2_,(short)uVar28,uVar14,sVar13,
                                       sVar35,sVar36);
                    }
                  }
                }
                else if (((PLORD *)auStack_dc._100_2_ == (PLORD *)0x0) && (auStack_dc._102_2_ == 0))
                {
                  sVar36 = 0;
                  sVar35 = 0;
                  sVar13 = 0;
                  uVar14 = *_iStack_6a;
                  uVar28 = __aFulshr((ulong)uVar14,0);
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                   idmHasUnloadedColonistsPreparationJumpingThroughSta,
                                   lpfl->id | 0x8000,lpfl->id,(short)(THING *)lpth,(short)uVar28,
                                   uVar14,sVar13,sVar35,sVar36);
                  if (((FLEET *)lpfl)->iPlayer != *(int *)((int)((qword)_dxRound >> 0x10) + 2)) {
                    sVar36 = 0;
                    sVar35 = 0;
                    sVar13 = 0;
                    uVar14 = *_iStack_6a;
                    uVar28 = __aFulshr((ulong)uVar14,0);
                    FSendPlrMsg(*(short *)((int)((qword)_dxRound >> 0x10) + 2),
                                     idmHasUnloadedColonistsPreparationJumpingThroughSta,*_iStack_6a
                                     ,lpfl->id,(short)(THING *)lpth,(short)uVar28,uVar14,sVar13,
                                     sVar35,sVar36);
                  }
                }
                else {
                  sVar35 = 0;
                  uVar14 = *_iStack_6a;
                  uVar28 = __aFulshr((ulong)uVar14,unaff_DI);
                  sVar13 = (short)uVar28;
                  pPVar34 = (PLORD *)auStack_dc._100_2_;
                  uVar28 = __aFulshr((ulong)CONCAT22(sVar13,auStack_dc._100_2_),uVar14);
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                   idmHasUnloadedColonistsKtMineralsPreparationJumping,
                                   lpfl->id | 0x8000,lpfl->id,(short)(THING *)lpth,(short)uVar28,
                                   (short)pPVar34,sVar13,uVar14,sVar35);
                  if (((FLEET *)lpfl)->iPlayer != *(int *)((int)((qword)_dxRound >> 0x10) + 2)) {
                    sVar35 = 0;
                    uVar14 = *_iStack_6a;
                    uVar28 = __aFulshr((ulong)uVar14,unaff_DI);
                    sVar13 = (short)uVar28;
                    pPVar34 = (PLORD *)auStack_dc._100_2_;
                    uVar28 = __aFulshr((ulong)CONCAT22(sVar13,auStack_dc._100_2_),uVar14);
                    FSendPlrMsg(*(short *)((int)((qword)_dxRound >> 0x10) + 2),
                                     idmHasUnloadedColonistsKtMineralsPreparationJumping,*_iStack_6a
                                     ,lpfl->id,(short)(THING *)lpth,(short)uVar28,(short)pPVar34,
                                     sVar13,uVar14,sVar35);
                  }
                }
              }
            }
            DGetDistance(ptBeg.x,ptBeg.y,ptEnd.x,ptEnd.y);
            lVar29 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,
                                                  unaff_DI))));
            sVar13 = FStargateJump(lpfl,auStack_dc._108_2_,auStack_dc._110_2_,(short)lVar29);
            lVar29 = wtFuelUsed;
            if (sVar13 == 0) goto LAB_10b0_32f6;
            uVar21 = (undefined2)((ulong)lpfl >> 0x10);
            ((FLEET *)lpfl)->wFlags = ((FLEET *)lpfl)->wFlags & 0xdfff;
            NoAutoTrackFleet(lpfl);
            lVar32 = dActTravel;
            goto TURN_LMakeItToDest;
          }
          goto LAB_10b0_32f6;
        }
      }
    } while ((fDone == 0) && (bVar24 = cPass < 10, cPass = cPass + 1, bVar24));
    KillUsedWaypoints();
  }
  return;
LAB_10b0_46ff:
  uVar14 = (int)pPStack_60 + 0x7f;
  uVar9 = _pPStack_60;
  uVar21 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar17 = (FLEET *)lpfl;
  *(uint *)&pFVar17->field17_0x74 = *(uint *)&pFVar17->field17_0x74 & 0xff00 | uVar14 & 0xff;
  *(uint *)&pFVar17->field17_0x74 =
       *(uint *)&pFVar17->field17_0x74 & 0xff |
       (int)((int)&((THING *)lpthDest)[7].idFull + 1) * 0x100;
  _lpth = (double)(CONCAT44(uVar9,(THING *)CONCAT22((uint)((PLORD *)pFVar17->lpplord + 7)->wFlags >>
                                                    4,(THING *)lpth)) & 0xffffffff000fffff);
  pFVar17->wFlags = pFVar17->wFlags & 0xfff0U | lpth._2_2_;
code_r0x10b04783:
  wtFuelUsed = lVar29;
  lVar32 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,unaff_DI))));
  dMineTravel = (short)lVar32;
  if (dTravel < lVar32) {
    dMineTravel = (uint)dTravel;
  }
  if ((*(uint *)(iVar15 + 0x1c) >> 4 & 0xf) < 0xb) {
    dActTravel = lVar32;
    sVar13 = FTravelThroughMineFields(lpfl,&dMineTravel,(THING *)0x0);
    lVar32 = dActTravel;
    if (sVar13 != 0) goto LAB_10b0_484b;
    uVar21 = (undefined2)((ulong)lpfl >> 0x10);
    *(undefined2 *)&((FLEET *)lpfl)->field13_0x6c = 0;
    lVar29 = wtFuelUsed;
    if (((uint)((FLEET *)lpfl)->wFlags >> 10 & 1) != 0) goto LAB_10b0_32f6;
    if (dMineTravel < dActTravel) {
      dTravel = (long)dMineTravel;
    }
  }
  else {
LAB_10b0_484b:
    if (!bVar24) {
      dActTravel = lVar32;
      lVar29 = GetFuelFree(lpfl);
      lVar32 = dActTravel;
      if (0 < lVar29) {
        lVar29 = dActTravel;
        if (dTravel < dActTravel) {
          lVar29 = dTravel;
        }
        lVar29 = LCalcFuelGainFromRamScoops(lpfl,*(uint *)(iVar15 + 0x1c) >> 4 & 0xf,lVar29);
        lVar32 = dActTravel;
        lFuelGain = lVar29;
        if (0 < lVar29) {
          lVar29 = ChgCargo(grobjFleet,lpfl->id,4,lVar29,(void *)0x0);
          _lpth = CONCAT24((int)lVar29,lpth);
          _lpth = (double)CONCAT26((int)((ulong)lVar29 >> 0x10),_lpth);
          if (0x7ef4 < lFuelGain) {
            lFuelGain = 0x7ef4;
          }
          FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmSRamScoopsHaveProducedMgFuel,
                            lpfl->id | 0x8000,lpfl->id,(short)lFuelGain);
          lVar32 = dActTravel;
        }
      }
    }
  }
  if ((lVar32 < dTravel) || (lVar32 < 1)) {
TURN_LMakeItToDest:
    uVar21 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar17 = (FLEET *)lpfl;
    (&pFVar17->pt)->x = ptEnd.x;
    (pFVar17->pt).y = ptEnd.y;
    if ((*(uint *)(iVar15 + 0x1c) >> 8 & 0xf) == 1) {
      pFVar17->idPlanet = *(short *)(iVar15 + 0x1a);
    }
    else {
      pFVar17->idPlanet = -1;
    }
    if (0 < cPass) {
      ((FLEET *)pFVar17->lpflNext)->wFlags = ((FLEET *)pFVar17->lpflNext)->wFlags & 0xf7ffU | 0x800;
    }
  }
  else {
    _dxRound = DOUBLE_0_5__1120_1d5e;
    if (ptEnd.x <= ptBeg.x) {
      _dxRound = DOUBLE_m0_5__1120_1d66;
    }
    bVar25 = (uint)ptEnd.y < (uint)ptBeg.y;
    bVar26 = ptEnd.y == ptBeg.y;
    _lpth = DOUBLE_0_5__1120_1d5e;
    if (ptEnd.y <= ptBeg.y) {
      _lpth = DOUBLE_m0_5__1120_1d66;
    }
    dActTravel = lVar32;
    __aFfcompp();
    if (bVar25 || bVar26) {
      __aFfcompp();
      lVar32 = dActTravel;
      if (bVar25) goto code_r0x10b04a5c;
    }
    else {
code_r0x10b04a5c:
      _r = (double)dTravel / dVar3;
      auStack_dc._104_2_ = ptEnd.x - ptBeg.x;
      auStack_dc._106_2_ = (int)auStack_dc._104_2_ >> 0xf;
      lVar29 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,unaff_DI)))
                             );
      (&((FLEET *)lpfl)->pt)->x = (int)lVar29 + ptBeg.x;
      auStack_dc._104_2_ = ptEnd.y - ptBeg.y;
      auStack_dc._106_2_ = (int)auStack_dc._104_2_ >> 0xf;
      lVar29 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,unaff_DI)))
                             );
      uVar21 = (undefined2)((ulong)lpfl >> 0x10);
      (((FLEET *)lpfl)->pt).y = (int)lVar29 + ptBeg.y;
      ((FLEET *)lpfl)->idPlanet = -1;
      lVar32 = dActTravel;
    }
    if (0 < cPass) {
      uVar21 = (undefined2)((ulong)lpfl >> 0x10);
      pFVar17 = (FLEET *)lpfl;
      if (0 < *(int *)&pFVar17->field13_0x6c) {
        pFVar17->dMoveUsed = pFVar17->dMoveUsed + (uint)dTravel;
        *(uint *)&pFVar17->field13_0x6c = *(int *)&pFVar17->field13_0x6c - (uint)dTravel;
        if ((0 < *(int *)&pFVar17->field13_0x6c) && (!bVar24)) {
          fDone = 0;
          pFVar17->wFlags = pFVar17->wFlags & 0xf7ff;
        }
      }
    }
  }
  dVar3 = _lpth;
  if (((uint)gd._0_2_ >> 6 & 1) != 0) {
    uVar21 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar17 = (FLEET *)lpfl;
    iVar11 = *(int *)((int)pFVar17->rgwtMin + 0xe);
    if ((-1 < iVar11) && (((0 < iVar11 || ((int)pFVar17->rgwtMin[3] != 0)) && (cPass < 2)))) {
      iVar11 = (int)*(char *)((int)rgplr[0].rgEnvVarMax + 2 + pFVar17->iPlayer * 0xc0);
      _lpth = (double)CONCAT26(iVar11,_lpth);
      if ((*(char *)((int)rgplr[0].rgEnvVarMin + 2 + pFVar17->iPlayer * 0xc0) + iVar11 <
           0xaa) &&
         (*(char *)((int)rgplr[0].rgEnvVarMax + 2 + pFVar17->iPlayer * 0xc0) != -1)) {
        iVar11 = (int)*(char *)((int)rgplr[0].rgEnvVarMax + 2 + pFVar17->iPlayer * 0xc0);
        lpth = SUB84(dVar3,0);
        _lpth = CONCAT24(iVar11,lpth);
        iVar11 = (*(char *)((int)rgplr[0].rgEnvVarMin + 2 + pFVar17->iPlayer * 0xc0) +
                 iVar11) / 2;
        _lpth = (double)CONCAT26(iVar11,_lpth);
        iVar11 = 0x56 - iVar11;
        pct._0_2_ = iVar11 >> 1;
        pct._2_2_ = iVar11 >> 0xf;
        uVar37 = 0;
        uVar22 = 100;
        dActTravel = lVar32;
        uVar28 = __aFulmul(CONCAT22(pct._2_2_,(uint)pct),
                                   CONCAT22(*(undefined2 *)((int)pFVar17->rgwtMin + 0xe),
                                            (int)pFVar17->rgwtMin[3]));
        pct = __aFldiv(uVar28,CONCAT22(uVar37,uVar22));
        lVar29 = pct;
        if (pct < 1) {
          lVar29 = 1;
        }
        iVar18 = (int)((ulong)lVar29 >> 0x10);
        uVar21 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar17 = (FLEET *)lpfl;
        iVar11 = *(int *)((int)pFVar17->rgwtMin + 0xe);
        if ((iVar18 < iVar11) ||
           ((iVar18 <= iVar11 && ((uint)lVar29 <= *(uint *)(pFVar17->rgwtMin + 3))))) {
          if (pct < 1) {
            pct = 1;
          }
        }
        else {
          pct = CONCAT22(*(undefined2 *)((int)pFVar17->rgwtMin + 0xe),(int)pFVar17->rgwtMin[3]);
        }
        FSendPlrMsg2(pFVar17->iPlayer,idmEngineRadiationHasKilledColonistsTraveling,
                          lpfl->id | 0x8000,(short)pct,lpfl->id);
        uVar21 = (undefined2)((ulong)lpfl >> 0x10);
        puVar2 = (uint *)(((FLEET *)lpfl)->rgwtMin + 3);
        uVar14 = *puVar2;
        *puVar2 = *puVar2 - (uint)pct;
        piVar1 = (int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
        *piVar1 = (*piVar1 - pct._2_2_) - (uint)(uVar14 < (uint)pct);
        lVar32 = dActTravel;
      }
    }
  }
  uVar21 = (undefined2)((ulong)lpfl >> 0x10);
  dActTravel = lVar32;
  if (((ptEnd.x == (&((FLEET *)lpfl)->pt)->x) && (ptEnd.y == (((FLEET *)lpfl)->pt).y)) &&
     ((*(uint *)(iVar15 + 0x1c) >> 8 & 0xf) == 8)) {
    pTVar33 = LpthFromId(*(short *)(iVar15 + 0x1a));
    _lpth = (double)CONCAT44(_pPStack_60,pTVar33);
    if ((pTVar33 != (THING *)0x0) && ((uint)pTVar33->idFull >> 0xd == 2)) {
      _dxRound = (double)CONCAT26(1 << ((byte)((FLEET *)lpfl)->iPlayer & 0x1f),_dxRound);
      pTVar33 = LpthFromId(*(short *)(((THING *)pTVar33)->rgb + 6));
      _lpth = CONCAT24((THING *)pTVar33,lpth);
      _lpth = (double)CONCAT26((int)((ulong)pTVar33 >> 0x10),_lpth);
      NoAutoTrackFleet(lpfl);
      puVar2 = (uint *)(SUB82(_lpth,0) + 10);
      *puVar2 = *puVar2 | grbitPlr;
      uVar22 = (undefined2)((qword)_lpth >> 0x30);
      iVar11 = (int)((qword)_lpth >> 0x20);
      *(uint *)(iVar11 + 10) = *(uint *)(iVar11 + 10) | grbitPlr;
      *(uint *)(iVar11 + 8) = *(uint *)(iVar11 + 8) | grbitPlr;
      sVar13 = *(short *)(iVar11 + 4);
      uVar21 = (undefined2)((ulong)lpfl >> 0x10);
      (&((FLEET *)lpfl)->pt)->x = *(short *)(iVar11 + 2);
      (((FLEET *)lpfl)->pt).y = sVar13;
      uVar21 = *(undefined2 *)(iVar11 + 4);
      *(undefined2 *)(iVar15 + 0x16) = *(undefined2 *)(iVar11 + 2);
      *(undefined2 *)(iVar15 + 0x18) = uVar21;
    }
  }
  uVar21 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar17 = (FLEET *)lpfl;
  lVar29 = wtFuelUsed;
  if (pFVar17->idPlanet == -1) {
    pt.y = (pFVar17->pt).y;
    pt.x = (&pFVar17->pt)->x;
    sVar13 = FFindNearestObject(pt,0x81,(SCAN *)((int)&lpthDest + 2));
    lVar29 = wtFuelUsed;
    if (sVar13 != 0) {
      ((FLEET *)lpfl)->idPlanet = sStack_54;
    }
  }
  uVar21 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar17 = (FLEET *)lpfl;
  sVar13 = (pFVar17->pt).y;
  (lpord->pt).x = (&pFVar17->pt)->x;
  *(short *)(iVar15 + 6) = sVar13;
  *(short *)(iVar15 + 8) = pFVar17->idPlanet;
  if (pFVar17->idPlanet == -1) {
    iVar11 = 4;
  }
  else {
    iVar11 = 1;
  }
  _lpth = (double)CONCAT26(iVar11,_lpth);
  *(uint *)(iVar15 + 10) = *(uint *)(iVar15 + 10) & 0xf0ff | iVar11 << 8;
  if (fGotEnufFuel != 0) {
    wtFuelUsed = lVar29;
    lVar32 = EstFuelUse(lpfl,0,-1,-1,0);
    iVar15 = (int)((ulong)lVar32 >> 0x10);
    uVar23 = (undefined2)((ulong)lpfl >> 0x10);
    iVar11 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
    lVar29 = wtFuelUsed;
    if ((iVar11 <= iVar15) &&
       ((iVar11 < iVar15 || (*(uint *)(((FLEET *)lpfl)->rgwtMin + 4) < (uint)lVar32)))) {
      lVar29 = LGetFleetStat(lpfl,1);
      if (lVar32 < lVar29) {
        *(uint *)(((FLEET *)lpfl)->rgwtMin + 4) = (uint)lVar32;
        *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = iVar15;
        lVar29 = wtFuelUsed;
      }
      else {
        lVar29 = LGetFleetStat(lpfl,1);
        uVar23 = (undefined2)((ulong)lpfl >> 0x10);
        *(int *)(((FLEET *)lpfl)->rgwtMin + 4) = (int)lVar29;
        *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = (int)((ulong)lVar29 >> 0x10);
        lVar29 = wtFuelUsed;
      }
    }
  }
LAB_10b0_32f6:
  ifl = ifl + 1;
  goto LAB_10b0_32fa;
}



// ======================================================================
// Function: FTravelThroughMineFields
// Address: 10b0:4f60
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b0625c) */
/* WARNING: Removing unreachable block (ram,0x10b060fd) */
/* WARNING: Removing unreachable block (ram,0x10b05ac0) */
/* WARNING: Removing unreachable block (ram,0x10b060c7) */
/* WARNING: Removing unreachable block (ram,0x10b06121) */
/* WARNING: Removing unreachable block (ram,0x10b066fc) */

short FTravelThroughMineFields(FLEET *lpfl,short *pdTravel,THING *lpthHit)

{
  uint *puVar1;
  FLEET *pFVar2;
  FLEET *pFVar3;
  POINT ptL2;
  POINT ptC;
  long lVar4;
  short sVar5;
  uint uVar6;
  MessageId MVar7;
  uint uVar8;
  ushort uVar9;
  int iVar10;
  int iVar11;
  int iVar12;
  FLEET *pFVar13;
  PLORD *pPVar14;
  int iVar15;
  THING *pTVar16;
  undefined2 unaff_SI;
  FLEET *pFVar17;
  FLEET *pFVar18;
  undefined2 unaff_DI;
  undefined2 uVar19;
  undefined *puVar20;
  undefined2 unaff_SS;
  bool bVar21;
  ENGINE *pEVar22;
  ulong uVar23;
  ulong uVar24;
  long lVar25;
  ulong uVar26;
  POINT ptL1;
  short sVar27;
  short sVar28;
  undefined2 uVar29;
  undefined2 uVar30;
  short sVar31;
  short sVar32;
  ushort in_stack_0000fe06;
  long dmgPerShip;
  ushort ibit;
  short rgFieldS [8] [3];
  short dmgPer;
  short fHasRamScoop;
  THING *lpthSalvage;
  short cishInc;
  THING *lpthClosest;
  short rgFieldE [8] [3];
  short iType;
  long dpShield;
  short dx;
  short raMajor;
  short rgcField [3];
  short cshDead;
  long dmgTot;
  short pct;
  short rgi [3];
  long csh;
  THING *lpthMac;
  FLEET flDead;
  short dStart;
  short cFields;
  short iPlayer;
  POINT ptSrc;
  short fMineExpert;
  short cshDamaged;
  short dmgExtra;
  THING *lpth;
  short i;
  long dmgToApply;
  long dmgReduce;
  short cshT;
  long dpsh;
  FLEET flSrc;
  short dEnd;
  short j;
  long d2;
  short dy;
  POINT ptDst;
  short iWarp;
  POINT ptAct;
  short dTravel;
  short rgishInc [16];
  long d2Closest;
  
  lpthSalvage = (THING *)0x0;
  iVar11 = *pdTravel;
  cishInc = 0;
  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar13 = (FLEET *)lpfl;
  iPlayer = pFVar13->iPlayer;
  puVar20 = (undefined *)&DAT_1120_10e0;
  sVar5 = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv);
  iVar10 = (uint)(sVar5 == 5) * 2 + (uint)(sVar5 == 1);
  if (lpthHit == (THING *)0x0) {
    ptSrc.x = (&pFVar13->pt)->x;
    ptSrc.y = (pFVar13->pt).y;
    uVar29 = (undefined2)((ulong)pFVar13->lpplord >> 0x10);
    pPVar14 = (PLORD *)pFVar13->lpplord;
    ptDst.x = *(short *)&pPVar14[5].iordMax;
    ptDst.y = (pPVar14 + 6)->wFlags;
    for (iWarp = 3; (iWarp < 10 && (iWarp * iWarp < iVar11 + -1)); iWarp = iWarp + 1) {
    }
    if ((iWarp <= iVar10 + 3) || ((ptSrc.x == ptDst.x && (ptSrc.y == ptDst.y)))) {
      return 1;
    }
    for (i = 0; i < 3; i = i + 1) {
      rgcField[i] = 0;
    }
    pTVar16 = (THING *)lpThings + cThing;
    lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
    while ((THING *)lpth < pTVar16) {
      uVar29 = (undefined2)((ulong)lpth >> 0x10);
      if (((((uint)lpth->idFull >> 9 & 0xf) != iPlayer) && ((uint)lpth->idFull >> 0xd == 0)) &&
         (*(char *)(((uint)lpth->idFull >> 9 & 0xf) * 0xc0 + 0x5a12 + iPlayer) != '\x01')) {
        ptL1.y = ptSrc.y;
        ptL1.x = ptSrc.x;
        puVar20 = (undefined *)&DAT_1120_1040;
        ptL2.y = ptDst.y;
        ptL2.x = ptDst.x;
        ptC.y = (((THING *)lpth)->pt).y;
        ptC.x = (&((THING *)lpth)->pt)->x;
        sVar5 = FIntersectCircleLine
                          (ptL1,ptL2,ptC,
                           CONCAT22(*(undefined2 *)(((THING *)lpth)->rgb + 2),
                                    *(undefined2 *)((THING *)lpth)->rgb),iVar11,&dStart,&dEnd);
        if (sVar5 != 0) {
          uVar8 = (uint)((THING *)lpth)->rgb[6];
          i = 0;
          while ((i < rgcField[uVar8] && (*(int *)((int)rgFieldE + i * 2 + uVar8 * 0x10) < dStart)))
          {
            i = i + 1;
          }
          if (i == rgcField[uVar8]) {
            if (i < 8) {
              *(short *)((int)rgFieldS + i * 2 + uVar8 * 0x10) = dStart;
              *(short *)((int)rgFieldE + i * 2 + uVar8 * 0x10) = dEnd;
              rgcField[uVar8] = rgcField[uVar8] + 1;
            }
          }
          else if (dEnd < *(int *)((int)rgFieldS + i * 2 + uVar8 * 0x10) + -1) {
            if (rgcField[uVar8] < 8) {
              for (j = rgcField[uVar8]; i < j; j = j + -1) {
                *(undefined2 *)((int)rgFieldS + j * 2 + uVar8 * 0x10) =
                     *(undefined2 *)((int)rgFieldS + (j + -1) * 2 + uVar8 * 0x10);
                *(undefined2 *)((int)rgFieldE + j * 2 + uVar8 * 0x10) =
                     *(undefined2 *)((int)rgFieldE + (j + -1) * 2 + uVar8 * 0x10);
              }
              *(short *)((int)rgFieldS + i * 2 + uVar8 * 0x10) = dStart;
              *(short *)((int)rgFieldE + i * 2 + uVar8 * 0x10) = dEnd;
              rgcField[uVar8] = rgcField[uVar8] + 1;
            }
          }
          else {
            if (dStart < *(int *)((int)rgFieldS + i * 2 + uVar8 * 0x10)) {
              *(short *)((int)rgFieldS + i * 2 + uVar8 * 0x10) = dStart;
            }
            if (*(int *)((int)rgFieldE + i * 2 + uVar8 * 0x10) < dEnd) {
              *(short *)((int)rgFieldE + i * 2 + uVar8 * 0x10) = dEnd;
              j = i + 1;
              while ((j < rgcField[uVar8] &&
                     (*(int *)((int)rgFieldS + j * 2 + uVar8 * 0x10) <= dEnd))) {
                j = j + 1;
              }
              if (dEnd < *(int *)((int)rgFieldE + (j + -1) * 2 + uVar8 * 0x10)) {
                *(undefined2 *)((int)rgFieldE + i * 2 + uVar8 * 0x10) =
                     *(undefined2 *)((int)rgFieldE + (j + -1) * 2 + uVar8 * 0x10);
              }
              for (; i = i + 1, j < rgcField[uVar8]; j = j + 1) {
                *(undefined2 *)((int)rgFieldS + i * 2 + uVar8 * 0x10) =
                     *(undefined2 *)((int)rgFieldS + j * 2 + uVar8 * 0x10);
                *(undefined2 *)((int)rgFieldE + i * 2 + uVar8 * 0x10) =
                     *(undefined2 *)((int)rgFieldE + j * 2 + uVar8 * 0x10);
              }
              rgcField[uVar8] = rgcField[uVar8] - (j - i);
            }
          }
        }
      }
      lpth = (THING *)CONCAT22(uVar29,(THING *)lpth + 1);
    }
    cFields = rgcField[0] + rgcField[1] + rgcField[2];
    if (cFields == 0) {
      return 1;
    }
  }
  else {
    iWarp = 0;
  }
  fHasRamScoop = 0;
  csh._0_2_ = 0;
  csh._2_2_ = 0;
  for (i = 0; i < 0x10; i = i + 1) {
    if (0 < pFVar13->rgcsh[i]) {
      uVar8 = pFVar13->rgcsh[i];
      bVar21 = CARRY2((uint)csh,uVar8);
      csh._0_2_ = (uint)csh + uVar8;
      csh._2_2_ = csh._2_2_ + ((int)uVar8 >> 0xf) + (uint)bVar21;
      j = *(uint *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93 + 0x3c) & 0xff;
      puVar20 = (undefined *)0x1008;
      pEVar22 = LpengineFromId(j);
      if (((ENGINE *)pEVar22)->rgcFuelUsed[4] == 0) {
        fHasRamScoop = 1;
      }
    }
  }
  if (lpthHit == (THING *)0x0) {
    rgi[2] = 0;
    rgi[1] = 0;
    rgi[0] = 0;
    for (; 0 < cFields; cFields = cFields + -1) {
      dStart = 10000;
      iType = -1;
      for (i = 0; i < 3; i = i + 1) {
        if ((rgi[i] < rgcField[i]) && (*(int *)((int)rgFieldS + rgi[i] * 2 + i * 0x10) < dStart)) {
          dStart = *(short *)((int)rgFieldS + rgi[i] * 2 + i * 0x10);
          iType = i;
        }
      }
      dEnd = *(int *)((int)rgFieldE + rgi[iType] * 2 + iType * 0x10) -
             *(int *)((int)rgFieldS + rgi[iType] * 2 + iType * 0x10);
      if (((short *)rgiWarpSafe)[iType] + iVar10 < iWarp) {
        iVar11 = ((short *)rgiWarpSafe)[iType];
        puVar20 = (undefined *)0x10b0;
        iVar15 = ((short *)rgpctMineHit)[iType];
        for (i = 0; i < dEnd; i = i + 1) {
          puVar20 = (undefined *)&DAT_1120_1040;
          sVar5 = Random(1000);
          if (sVar5 < ((iWarp - iVar11) - iVar10) * iVar15) break;
        }
        if (i != dEnd) {
          dEnd = dStart + i;
          goto TURN_LHitSkip2;
        }
      }
      rgi[iType] = rgi[iType] + 1;
    }
    sVar5 = 1;
  }
  else {
    iType = (short)((THING *)lpthHit)->rgb[6];
TURN_LHitSkip2:
    cshDead = 0;
    lVar4 = 0;
    if (((short (*) [2])rgrgdmgMine)[iType][fHasRamScoop] != 0) {
      iVar11 = ((short (*) [2])rgrgdmgMine)[iType][fHasRamScoop];
      dmgExtra = ((short (*) [2])rgrgdmgMinMine)[iType][fHasRamScoop] - iVar11 * (uint)csh;
      if ((0 < csh._2_2_) || (((-1 < csh._2_2_ && (4 < (uint)csh)) || (dmgExtra < 1)))) {
        dmgExtra = 0;
      }
      pFVar18 = &flSrc;
      pFVar17 = pFVar13;
      for (iVar10 = 0x3e; iVar10 != 0; iVar10 = iVar10 + -1) {
        pFVar3 = pFVar18;
        pFVar18 = (FLEET *)&pFVar18->iPlayer;
        pFVar2 = pFVar17;
        pFVar17 = (FLEET *)&pFVar17->iPlayer;
        pFVar3->id = pFVar2->id;
      }
      _memset(&flDead,0,0x7c);
      flDead.iPlayer = flSrc.iPlayer;
      flDead.wFlags = flDead.wFlags & 0xfb00U | 0x407;
      for (i = 0; i < 0x10; i = i + 1) {
        if ((0 < pFVar13->rgcsh[i]) &&
           (((lpthHit == (THING *)0x0 || (((uint)lpthHit->idFull >> 9 & 0xf) != pFVar13->iPlayer))
            || ((iVar10 = pFVar13->iPlayer * 4, *(int *)(*(int *)(iVar10 + 0xfe) + i * 0x93) != 0x1b
                && (iVar10 = pFVar13->iPlayer * 4,
                   *(int *)(*(int *)(iVar10 + 0xfe) + i * 0x93) != 0x1c)))))) {
          iVar10 = pFVar13->rgcsh[i];
          rgishInc[cishInc] = i;
          iVar15 = pFVar13->iPlayer * 4;
          uVar6 = *(uint *)(*(int *)(iVar15 + 0xfe) + i * 0x93 + 0x3c) >> 8;
          cishInc = cishInc + 1;
          uVar23 = DpShieldOfShdef
                             ((SHDEF *)CONCAT22(*(undefined2 *)(iPlayer * 4 + 0x100),
                                                (SHDEF *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93)),
                              iPlayer);
          uVar23 = __aFulmul((long)iVar10,uVar23);
          uVar8 = *(uint *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93 + 0x38);
          uVar29 = 0;
          iVar15 = dmgExtra >> 0xf;
          uVar24 = __aFulmul((long)iVar10,(long)iVar11);
          uVar24 = __aFulmul(uVar24 + CONCAT22(iVar15,dmgExtra),CONCAT22(uVar29,uVar6));
          lVar4 = uVar24 + lVar4;
          lVar25 = __aFlshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000fe06);
          if (lVar25 <= (long)uVar23) {
            uVar23 = __aFlshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000fe06);
          }
          uVar30 = 0;
          uVar29 = 100;
          uVar26 = __aFulmul((long)pFVar13->rgcsh[i],(ulong)((pFVar13->rgdv + i)->dp & 0x7f)
                                    );
          lVar25 = __aFldiv(uVar26,CONCAT22(uVar30,uVar29));
          iVar15 = (int)lVar25;
          uVar30 = 0;
          uVar29 = 500;
          iVar12 = iVar15 >> 0xf;
          uVar26 = __aFulmul((ulong)uVar8,(ulong)((uint)(pFVar13->rgdv + i)->dp >> 7));
          uVar26 = __aFulmul(uVar26,CONCAT22(iVar12,iVar15));
          lVar25 = __aFldiv(uVar26,CONCAT22(uVar30,uVar29));
          dmgExtra = 0;
          uVar23 = __aFldiv(lVar25 + (uVar24 - uVar23),(long)iVar10);
          if (((long)uVar23 < 0) || (((long)uVar23 < 0x10000 && ((uint)uVar23 <= uVar8)))) {
            (flSrc.rgdv + i)->dp = (flSrc.rgdv + i)->dp & 0xff80U | 100;
            uVar29 = 0;
            uVar23 = __aFulmul(uVar23,500);
            lVar25 = __aFldiv(uVar23,CONCAT22(uVar29,uVar8));
            (flSrc.rgdv + i)->dp = (flSrc.rgdv + i)->dp & 0x7fU | (int)lVar25 << 7;
            if ((uint)(flSrc.rgdv + i)->dp >> 7 == 0) {
              (flSrc.rgdv + i)->dp = (flSrc.rgdv + i)->dp & 0x7fU | 0x80;
            }
          }
          else {
            cshDead = cshDead + iVar10;
            flDead.rgcsh[i] = iVar10;
            flSrc.rgcsh[i] = 0;
          }
        }
      }
      if ((lpthHit != (THING *)0x0) && (lVar4 == 0)) {
        return 0;
      }
      if ((cshDead != (uint)csh) || (cshDead >> 0xf != csh._2_2_)) {
        FleetTransferCargoBalance(&flSrc,&flDead);
      }
      pFVar18 = &flSrc;
      pFVar17 = pFVar13;
      for (iVar11 = 0x3e; iVar11 != 0; iVar11 = iVar11 + -1) {
        pFVar3 = pFVar17;
        pFVar17 = (FLEET *)&pFVar17->iPlayer;
        pFVar2 = pFVar18;
        pFVar18 = (FLEET *)&pFVar18->iPlayer;
        pFVar3->id = pFVar2->id;
      }
      if ((cshDead == (uint)csh) && (cshDead >> 0xf == csh._2_2_)) {
        pFVar13->wFlags = pFVar13->wFlags & 0xfbffU | 0x400;
      }
    }
    if (lpthHit == (THING *)0x0) {
      iVar11 = ptDst.x - ptSrc.x;
      dy = ptDst.y - ptSrc.y;
      uVar23 = __aFulmul((long)dy,(long)dy);
      uVar24 = __aFulmul((long)iVar11,(long)iVar11);
      lVar25 = uVar24 + uVar23;
      _sqrt(SUB84((double)lVar25,0),
                    (double)CONCAT26(unaff_SI,CONCAT24(unaff_DI,(long)((qword)(double)lVar25 >> 0x20
                                                                      ))));
      lVar25 = __ftol((double)CONCAT26((int)((ulong)lVar25 >> 0x10),
                                               CONCAT24((int)lVar25,CONCAT22(unaff_SI,unaff_DI))));
      sVar5 = MulDiv(iVar11,dEnd,(short)lVar25);
      ptAct.x = sVar5 + ptSrc.x;
      sVar5 = MulDiv(dy,dEnd,(short)lVar25);
      ptAct.y = sVar5 + ptSrc.y;
      if (cshDead != 0) {
        lpthSalvage = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
        while( true ) {
          if (((THING *)lpThings + cThing <= (THING *)lpthSalvage) ||
             (((((&((THING *)lpthSalvage)->pt)->x == ptAct.x &&
                ((((THING *)lpthSalvage)->pt).y == ptAct.y)) &&
               ((uint)lpthSalvage->idFull >> 0xd == 1)) &&
              ((*(uint *)((THING *)lpthSalvage)->rgb >> 10 & 0xf) == 0)))) break;
          lpthSalvage = (THING *)CONCAT22(lpthSalvage._2_2_,(THING *)lpthSalvage + 1);
        }
        if (((THING *)lpthSalvage == (THING *)lpThings + cThing) &&
           (lpthSalvage._2_2_ == lpThings._2_2_)) {
          lpthSalvage = (THING *)0x0;
        }
        DropSalvage(&lpthSalvage,(long *)CONCAT22(uVar19,pFVar13->rgwtMin),
                            (uint)flSrc.id >> 9 & 0xf,&ptAct);
      }
      d2Closest._0_2_ = 0xe100;
      d2Closest._2_2_ = 0x5f5;
      pTVar16 = (THING *)lpThings + cThing;
      lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
      while ((THING *)lpth < pTVar16) {
        uVar29 = (undefined2)((ulong)lpth >> 0x10);
        if (((((uint)lpth->idFull >> 9 & 0xf) != iPlayer) && ((uint)lpth->idFull >> 0xd == 0)) &&
           ((*(char *)(((uint)lpth->idFull >> 9 & 0xf) * 0xc0 + 0x5a12 + iPlayer) != '\x01' &&
            ((uint)((THING *)lpth)->rgb[6] == iType)))) {
          iVar11 = (&((THING *)lpth)->pt)->x - ptAct.x;
          dy = (((THING *)lpth)->pt).y - ptAct.y;
          uVar23 = __aFulmul((long)dy,(long)dy);
          uVar24 = __aFulmul((long)iVar11,(long)iVar11);
          uVar8 = (uint)(uVar24 + uVar23);
          d2._0_2_ = uVar8 - *(uint *)((THING *)lpth)->rgb;
          d2._2_2_ = ((int)(uVar24 + uVar23 >> 0x10) - *(int *)(((THING *)lpth)->rgb + 2)) -
                     (uint)(uVar8 < *(uint *)((THING *)lpth)->rgb);
          if ((d2._2_2_ <= d2Closest._2_2_) &&
             ((d2._2_2_ < d2Closest._2_2_ || ((uint)d2 < (uint)d2Closest)))) {
            lpthClosest = lpth;
            d2Closest._0_2_ = (uint)d2;
            d2Closest._2_2_ = d2._2_2_;
          }
        }
        lpth = (THING *)CONCAT22(uVar29,(THING *)lpth + 1);
      }
      uVar29 = (undefined2)((ulong)lpthClosest >> 0x10);
      d2 = __aFldiv(CONCAT22(*(undefined2 *)(((THING *)lpthClosest)->rgb + 2),
                                     *(undefined2 *)((THING *)lpthClosest)->rgb),0x14);
      if (d2 < 0x33) {
        if (d2 < 10) {
          d2 = 10;
        }
      }
      else {
        uVar29 = (undefined2)((ulong)lpthClosest >> 0x10);
        lVar25 = __aFldiv(CONCAT22(*(undefined2 *)(((THING *)lpthClosest)->rgb + 2),
                                           *(undefined2 *)((THING *)lpthClosest)->rgb),100);
        d2 = lVar25;
        if (lVar25 < 0x32) {
          d2 = 0x32;
        }
      }
    }
    else {
      ptAct.x = (&((THING *)lpthHit)->pt)->x;
      ptAct.y = (((THING *)lpthHit)->pt).y;
      lpthClosest = lpthHit;
      d2 = CONCAT22(d2._2_2_,(uint)d2);
    }
    sVar5 = GetRaceStat((PLAYER *)rgplr + ((uint)lpthClosest->idFull >> 9 & 0xf),
                              rsMajorAdv);
    if (sVar5 == 5) {
      uVar8 = 1 << ((byte)((uint)lpthClosest->idFull >> 9) & 0xf);
      if (cishInc == 0) {
        for (i = 0; i < 0x10; i = i + 1) {
          if (0 < pFVar13->rgcsh[i]) {
            puVar1 = (uint *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93 + 0x8b);
            *puVar1 = *puVar1 | uVar8;
          }
        }
      }
      else {
        for (i = 0; i < cishInc; i = i + 1) {
          puVar1 = (uint *)(*(int *)(iPlayer * 4 + 0xfe) + rgishInc[i] * 0x93 + 0x8b);
          *puVar1 = *puVar1 | uVar8;
        }
      }
    }
    if (0x7ff8 < lVar4) {
      lVar4 = 0x7ff8;
    }
    dmgTot._0_2_ = (short)lVar4;
    if (lVar4 == 0) {
      if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
        FSendPlrMsg(iPlayer,idmHasStoppedMineField,lpfl->id | 0x8000,lpfl->id | 0x8000,
                         (uint)lpthClosest->idFull >> 9 & 0xf,iType,ptAct.x,ptAct.y,0,0);
      }
      FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasStoppedMineField2,
                       lpfl->id | 0x8000,lpfl->id | 0x8000,iType,ptAct.x,ptAct.y,0,0,0);
      lVar4 = d2;
    }
    else if (cshDead == 0) {
      if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
        if (lpthHit == (THING *)0x0) {
          MVar7 = idmHasStoppedMineFieldFleetHasTaken;
        }
        else {
          MVar7 = idmHasDamagedDetonatingMineFieldFleetHas;
        }
        FSendPlrMsg(iPlayer,MVar7,lpfl->id | 0x8000,lpfl->id | 0x8000,
                         (uint)lpthClosest->idFull >> 9 & 0xf,iType,ptAct.x,ptAct.y,(short)dmgTot,0)
        ;
      }
      if (lpthHit == (THING *)0x0) {
        MVar7 = idmHasStoppedMineFieldMinesHaveInflicted;
      }
      else {
        MVar7 = idmHasDamagedDetonatingMineFieldMinesHave;
      }
      FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,MVar7,lpfl->id | 0x8000,
                       lpfl->id | 0x8000,iType,ptAct.x,ptAct.y,(short)dmgTot,0,0);
      lVar4 = d2;
    }
    else if ((csh._2_2_ < cshDead >> 0xf) ||
            ((csh._2_2_ <= cshDead >> 0xf && ((uint)csh <= (uint)cshDead)))) {
      if (((THING *)lpthSalvage == (THING *)0x0) && (lpthSalvage._2_2_ == 0)) {
        flDead.id = lpfl->id;
        if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
          sVar32 = 0;
          sVar31 = 0;
          uVar8 = (uint)lpthClosest->idFull >> 9 & 0xf;
          sVar5 = iType;
          sVar27 = ptAct.x;
          sVar28 = ptAct.y;
          uVar9 = WFromLpfl((FLEET *)CONCAT22(unaff_SS,&flDead));
          FSendPlrMsg(iPlayer,idmHasAnnihilatedMineField3,-1,uVar9,uVar8,sVar5,sVar27,sVar28,
                           sVar31,sVar32);
        }
        if (pFVar13->iPlayer == ((uint)lpthClosest->idFull >> 9 & 0xf)) {
          sVar32 = 0;
          sVar31 = 0;
          sVar28 = 0;
          sVar5 = ptAct.x;
          sVar27 = ptAct.y;
          uVar9 = WFromLpfl((FLEET *)CONCAT22(unaff_SS,&flDead));
          FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasAnnihilatedMineField4,-1,uVar9
                           ,iType,sVar5,sVar27,sVar28,sVar31,sVar32);
          lVar4 = d2;
        }
        else {
          FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasAnnihilatedMineField2,-6,
                           lpthClosest->idFull,lpfl->id,iType,ptAct.x,ptAct.y,0,0);
          lVar4 = d2;
        }
      }
      else {
        flDead.id = lpfl->id;
        if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
          sVar31 = 0;
          uVar8 = (uint)lpthClosest->idFull >> 9 & 0xf;
          sVar5 = iType;
          sVar27 = ptAct.x;
          sVar28 = ptAct.y;
          uVar9 = WFromLpfl((FLEET *)CONCAT22(unaff_SS,&flDead));
          FSendPlrMsg(iPlayer,idmHasAnnihilatedMineField,-6,lpthSalvage->idFull,uVar9,uVar8,
                           sVar5,sVar27,sVar28,sVar31);
        }
        FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasAnnihilatedMineField2,-6,
                         lpthSalvage->idFull,lpfl->id,iType,ptAct.x,ptAct.y,0,0);
        lVar4 = d2;
      }
    }
    else {
      if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
        if (lpthHit == (THING *)0x0) {
          MVar7 = idmHasStoppedMineFieldFleetHasTaken2;
        }
        else {
          MVar7 = idmHasTakenDamageDetonatingMineFieldFleet;
        }
        FSendPlrMsg(iPlayer,MVar7,lpfl->id | 0x8000,lpfl->id | 0x8000,
                         (uint)lpthClosest->idFull >> 9 & 0xf,iType,ptAct.x,ptAct.y,(short)dmgTot,
                         cshDead);
      }
      if (lpthHit == (THING *)0x0) {
        MVar7 = idmHasStoppedMineFieldMinesHaveInflicted2;
      }
      else {
        MVar7 = idmHasDamagedDetonatingMineFieldMinesHave2;
      }
      FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,MVar7,lpfl->id | 0x8000,
                       lpfl->id | 0x8000,iType,ptAct.x,ptAct.y,(short)dmgTot,cshDead,0);
      lVar4 = d2;
    }
    d2._2_2_ = (int)((ulong)lVar4 >> 0x10);
    d2._0_2_ = (uint)lVar4;
    if (lpthHit == (THING *)0x0) {
      uVar29 = (undefined2)((ulong)lpthClosest >> 0x10);
      pTVar16 = (THING *)lpthClosest;
      if (lVar4 < CONCAT22(*(undefined2 *)(pTVar16->rgb + 2),*(undefined2 *)pTVar16->rgb)) {
        puVar1 = (uint *)pTVar16->rgb;
        uVar8 = *puVar1;
        *puVar1 = *puVar1 - (uint)d2;
        *(uint *)(pTVar16->rgb + 2) =
             (*(int *)(pTVar16->rgb + 2) - d2._2_2_) - (uint)(uVar8 < (uint)d2);
        *(uint *)(pTVar16->rgb + 8) = *(uint *)(pTVar16->rgb + 8) | 1 << ((byte)iPlayer & 0x1f);
        *(uint *)(pTVar16->rgb + 4) = *(uint *)(pTVar16->rgb + 4) | 1 << ((byte)iPlayer & 0x1f);
      }
      else {
        d2 = lVar4;
        FreeLpth(lpthClosest);
      }
      *pdTravel = dEnd;
    }
    pFVar13->wFlags = pFVar13->wFlags & 0xbfffU | 0x4000;
    sVar5 = 0;
  }
  return sVar5;
}



// ======================================================================
// Function: SatisfyOrders
// Address: 10b0:6798
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b0711a) */
/* WARNING: Variable defined which should be unmapped: cMine_2 */
/* WARNING: Removing unreachable block (ram,0x10b06b9c) */
/* WARNING: Removing unreachable block (ram,0x10b07f73) */
/* WARNING: Removing unreachable block (ram,0x10b07c0a) */
/* WARNING: Removing unreachable block (ram,0x10b07d05) */
/* WARNING: Removing unreachable block (ram,0x10b069bc) */
/* WARNING: Removing unreachable block (ram,0x10b07e13) */
/* WARNING: Removing unreachable block (ram,0x10b07e7f) */
/* WARNING: Removing unreachable block (ram,0x10b06e5a) */
/* WARNING: Removing unreachable block (ram,0x10b072ad) */
/* WARNING: Removing unreachable block (ram,0x10b0778f) */
/* WARNING: Removing unreachable block (ram,0x10b09c58) */
/* WARNING: Removing unreachable block (ram,0x10b07a6e) */
/* WARNING: Removing unreachable block (ram,0x10b0809e) */
/* WARNING: Removing unreachable block (ram,0x10b073cc) */
/* WARNING: Removing unreachable block (ram,0x10b080db) */

void SatisfyOrders(short iPass)

{
  char *pcVar1;
  int *piVar2;
  PLORD *pPVar3;
  uint *puVar4;
  short *psVar5;
  undefined2 *puVar6;
  HullDef *pHVar7;
  ORDER *pOVar8;
  undefined2 *puVar9;
  SHDEF *pSVar10;
  undefined2 uVar11;
  PLORD *pPVar12;
  ulong uVar13;
  ulong uVar14;
  PLANET *pPVar15;
  uint uVar16;
  ushort uVar17;
  MessageId MVar18;
  uint uVar19;
  ushort uVar20;
  int iVar21;
  SHDEF *pSVar22;
  int iVar23;
  FLEET *pFVar24;
  FLEET *pFVar25;
  PLORD *pPVar26;
  THING *pTVar27;
  ushort unaff_SI;
  short *psVar28;
  ORDER *pOVar29;
  undefined2 *puVar30;
  HullDef *pHVar31;
  ushort unaff_DI;
  undefined2 *puVar32;
  SHDEF *pSVar33;
  undefined2 uVar34;
  undefined2 uVar35;
  undefined2 unaff_SS;
  bool bVar36;
  bool bVar37;
  ulong uVar38;
  ulong uVar39;
  long lVar40;
  THING *pTVar41;
  ulong uVar42;
  long lVar43;
  short sVar44;
  short sVar45;
  short sVar46;
  byte *pbVar47;
  short p7;
  short sVar48;
  long rgwt [3];
  short fColonize;
  short fUltimate;
  long lResUltimate;
  short fBleeding;
  short csh;
  undefined1 auStack_140 [122];
  SHDEF *lpshdefDest;
  short iplrDest;
  FLEET *lpflNew;
  short ish;
  short ishMatch;
  THING *lpthMac;
  undefined2 uStack_b4;
  long dx;
  long lBest;
  THING *lpth;
  THING *lpthBest;
  long cMine_2;
  undefined4 uStack_9e;
  undefined4 uStack_9a;
  THING *lpthWP;
  ushort idWP;
  short fDone;
  long l;
  long amountEdit;
  short fDunnage;
  long wtOptimalFuel;
  short fFueling;
  ORDER ord;
  short fFulfilled;
  short fHasPermission;
  FLEET *lpflWP;
  short fStealing;
  short fOptFuel;
  ushort xWP;
  short iLoad;
  short idm;
  short fAtPlanet;
  FLEET *lpfl;
  short ifltcur;
  short fSentBadFleetXfer;
  short iflWP;
  long amount;
  short j;
  long l2;
  PLANET pl;
  short action;
  long amountWP;
  short fMining;
  
  if (cFleet < 1) {
    return;
  }
  ifltcur = 0;
LAB_10b0_67ba:
  if (cFleet <= ifltcur) {
    return;
  }
                    /* WARNING: Load size is inaccurate */
  pFVar24 = ((FLEET **)rglpfl)[ifltcur];
  iVar21 = *(int *)((int)((FLEET **)rglpfl + ifltcur) + 2);
  lpfl = (FLEET *)CONCAT22(iVar21,pFVar24);
  if ((pFVar24 == (FLEET *)0x0) && (iVar21 == 0)) {
    return;
  }
  if (iPass == 1) {
    pFVar24->wFlags = pFVar24->wFlags & 0xffdf;
    pFVar24->wFlags = pFVar24->wFlags & 0xffbf;
  }
  if ((((uint)pFVar24->wFlags >> 10 & 1) != 0) || (((uint)pFVar24->wFlags >> 7 & 1) != 0))
  goto LAB_10b0_67b6;
  uVar34 = *(undefined2 *)((int)&pFVar24->lpplord + 2);
  psVar28 = (short *)(*(int *)&pFVar24->lpplord + 4);
  pOVar29 = &ord;
  for (iVar21 = 9; iVar21 != 0; iVar21 = iVar21 + -1) {
    pOVar8 = pOVar29;
    pOVar29 = (ORDER *)&(pOVar29->pt).y;
    psVar5 = psVar28;
    psVar28 = psVar28 + 1;
    (pOVar8->pt).x = *psVar5;
  }
  pFVar24 = (FLEET *)lpfl;
  uVar34 = (undefined2)((ulong)lpfl >> 0x10);
  if ((ord.wFlags & 0xfU) == 1) {
    bVar37 = true;
    fDone = 1;
    fSentBadFleetXfer = 0;
    fHasPermission = 1;
    fMining = 0;
    fFueling = 0;
    fStealing = 0;
    fDunnage = 0;
    lpflWP = (FLEET *)0x0;
    lpthWP = (THING *)0x0;
    if (pFVar24->idPlanet == -1) {
LAB_10b0_68f7:
      fAtPlanet = 0;
    }
    else {
      sVar44 = FLookupPlanet(pFVar24->idPlanet,&pl);
      if (sVar44 == 0) goto LAB_10b0_68f7;
      fAtPlanet = 1;
    }
    idWP = ord.id;
    uVar19 = (uint)ord.wFlags >> 8 & 0xf;
    if (uVar19 == 1) {
      xWP = 0xffff;
      if (((FLEET *)lpfl)->iPlayer == pl.iPlayer) {
        fHasPermission = 3;
      }
      else {
        fHasPermission = 0;
      }
      if (fHasPermission == 0) {
        GetFleetScannerRange(lpfl,(short *)0x0,(short *)0x0,&fHasPermission);
        if (fHasPermission == 1) {
          fHasPermission = 0;
        }
        if (fHasPermission == 0) {
          if (pl.iPlayer == -1) {
            for (iflWP = 0; iflWP < cFleet; iflWP = iflWP + 1) {
                    /* WARNING: Load size is inaccurate */
              pFVar24 = ((FLEET **)rglpfl)[iflWP];
              iVar21 = *(int *)((int)((FLEET **)rglpfl + iflWP) + 2);
              lpflWP = (FLEET *)CONCAT22(iVar21,pFVar24);
              if ((pFVar24 == (FLEET *)0x0) && (iVar21 == 0)) break;
              if (((uint)pFVar24->wFlags >> 10 & 1) == 0) {
                iVar23 = (int)((ulong)lpfl >> 0x10);
                pFVar25 = (FLEET *)lpfl;
                if ((((pFVar24->iPlayer == pFVar25->iPlayer) &&
                     (pFVar25->idPlanet == pFVar24->idPlanet)) &&
                    ((pFVar24 != pFVar25 || (iVar21 != iVar23)))) &&
                   (((uint)pFVar24->wFlags >> 0xd & 1) != 0)) {
                  lVar43 = CMineFromLpfl((FLEET *)CONCAT22(iVar21,pFVar24));
                  if (0 < lVar43) {
                    fMining = 2;
                    fHasPermission = 1;
                    ord.wFlags = ord.wFlags & 0xf0ffU | 0x200;
                    ord.id = lpflWP->id;
                    xWP = 0xffff;
                    idWP = lpflWP->id | 0x8000;
                    break;
                  }
                }
              }
            }
          }
        }
        else {
          fStealing = 1;
        }
      }
    }
    else if (uVar19 == 2) {
      lpflWP = LpflFromId(ord.id);
      uVar34 = (undefined2)((ulong)lpflWP >> 0x10);
      idWP = idWP | 0x8000;
      xWP = 0xffff;
      fHasPermission = (short)(((FLEET *)lpfl)->iPlayer == ((FLEET *)lpflWP)->iPlayer);
      if (fHasPermission == 0) {
        GetFleetScannerRange(lpfl,(short *)0x0,(short *)0x0,&fHasPermission);
        if (fHasPermission != 0) {
          fStealing = 1;
        }
      }
      else if ((((uint)((FLEET *)lpflWP)->wFlags >> 0xd & 1) != 0) && (fAtPlanet != 0)) {
        lVar43 = CMineFromLpfl(lpflWP);
        if ((lVar43 < 1) || ((pl.iPlayer != -1 && (pl.iPlayer != ((FLEET *)lpfl)->iPlayer)))) {
          lVar43 = LGetFleetStat(lpflWP,2);
          if ((lVar43 == 0) && (pl.iPlayer == ((FLEET *)lpfl)->iPlayer)) {
            fFueling = 1;
            xWP = 0xffff;
            idWP = lpflWP->id | 0x8000;
          }
        }
        else {
          fMining = 1;
          xWP = 0xffff;
          idWP = lpflWP->id | 0x8000;
        }
      }
    }
    else if (uVar19 == 4) {
      xWP = ord.pt.x;
      idWP = ord.pt.y;
    }
    else if (uVar19 == 8) {
      lpthWP = LpthFromId(ord.id);
      xWP = 0xfffe;
    }
    iLoad = iPass - 1U & 1;
    fOptFuel = 0;
    uVar38 = l;
    uVar39 = amount;
    lVar43 = l2;
    uVar42 = amountEdit;
    if (((uint)ord.wFlags >> 8 & 0xf) != 8) {
TURN_LTryDunnage:
      do {
        j = 0;
        while( true ) {
          l = uVar38;
          l2 = lVar43;
          amount = uVar39;
          amountEdit = uVar42;
          if (4 < j) break;
          uVar19 = (uint)(ord.txp.rgia + j)->wFlags >> 0xc;
          if ((((uVar19 == 0) || ((fDunnage == 2 && (uVar19 != 7)))) ||
              ((j == 4 &&
               ((((uint)ord.wFlags >> 8 & 0xf) != 2 && (((uint)ord.wFlags >> 8 & 0xf) != 4)))))) ||
             ((2 < j && (((uint)ord.wFlags >> 8 & 0xf) == 8)))) goto switchD_10b0_7b5d_default;
          amountWP._0_2_ = 0;
          amountWP._2_2_ = 0;
          uVar16 = (uint)ord.wFlags >> 8 & 0xf;
          if (uVar16 == 1) {
LAB_10b0_6d92:
            if (j < 4) {
              amountWP._0_2_ = *(uint *)(pl.rgwtMin + j);
              amountWP._2_2_ = *(int *)((int)pl.rgwtMin + j * 4 + 2);
            }
          }
          else if (uVar16 == 2) {
            if (((fMining != 0) || (fFueling != 0)) && (j != 4)) goto LAB_10b0_6d92;
            amountWP._0_2_ = *(uint *)(((FLEET *)lpflWP)->rgwtMin + j);
            amountWP._2_2_ = *(int *)((int)(((FLEET *)lpflWP)->rgwtMin + j) + 2);
          }
          else if ((uVar16 == 8) && (j < 3)) {
            amountWP._0_2_ = *(uint *)(((THING *)lpthWP)->rgb + j * 2 + 2);
            amountWP._2_2_ = (int)(uint)amountWP >> 0xf;
          }
          uVar13 = CONCAT22(amountWP._2_2_,(uint)amountWP);
          switch(uVar19) {
          case 1:
            if (iLoad == 0) goto switchD_10b0_7b5d_default;
          case 7:
            amountEdit._0_2_ = (uint)amountWP;
            amountEdit._2_2_ = amountWP._2_2_;
            uVar42 = CONCAT22(amountWP._2_2_,(uint)amountWP);
            break;
          case 2:
            if (iLoad != 0) goto switchD_10b0_7b5d_default;
            amountEdit._0_2_ = (uint)((FLEET *)lpfl)->rgwtMin[j];
            amountEdit._2_2_ = *(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2);
            uVar42 = CONCAT22(amountEdit._2_2_,(uint)amountEdit);
            break;
          case 3:
            if (iLoad == 0) goto switchD_10b0_7b5d_default;
            amountEdit._0_2_ = (ord.txp.rgia + j)->wFlags & 0xfff;
            amountEdit._2_2_ = 0;
            uVar42 = (ulong)(uint)amountEdit;
            break;
          case 4:
            if (iLoad != 0) goto switchD_10b0_7b5d_default;
          case 8:
          case 9:
            amountEdit._0_2_ = (ord.txp.rgia + j)->wFlags & 0xfff;
            amountEdit._2_2_ = 0;
            uVar42 = (ulong)(uint)amountEdit;
            break;
          case 5:
          case 6:
            if (iLoad == 0) goto switchD_10b0_7b5d_default;
            if (j == 4) {
              uVar42 = LGetFleetStat(lpfl,1);
            }
            else {
              uVar42 = LGetFleetStat(lpfl,2);
            }
            if (2000000 < (long)uVar42) {
              uVar42 = 2000000;
            }
            amount = uVar42;
            if (((long)uVar42 < 0x20000) && ((long)uVar42 < 0x10000)) {
              uVar35 = 0;
              uVar34 = 100;
              uVar42 = __aFulmul(uVar42,(ulong)((ord.txp.rgia + j)->wFlags & 0xfff));
              uVar42 = __aFuldiv(uVar42,CONCAT22(uVar35,uVar34));
              uVar38 = l;
              lVar43 = l2;
              uVar39 = amount;
            }
            else {
              uVar16 = (ord.txp.rgia + j)->wFlags & 0xfff;
              uVar34 = 0;
              uVar42 = __aFldiv(uVar42,100);
              uVar42 = __aFulmul(uVar42,CONCAT22(uVar34,uVar16));
              uVar38 = l;
              lVar43 = l2;
              uVar39 = amount;
            }
            uVar42 = uVar42 - CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2),
                                       (int)((FLEET *)lpfl)->rgwtMin[j]);
            amountEdit = uVar42;
            if (((long)uVar42 < 0x10000) && ((long)uVar42 < 0)) {
              amountEdit._0_2_ = 0;
              amountEdit._2_2_ = 0;
              uVar42 = 0;
            }
          }
          amountEdit._2_2_ = (int)(uVar42 >> 0x10);
          amountEdit._0_2_ = (uint)uVar42;
          l = uVar38;
          l2 = lVar43;
          amountEdit = uVar42;
          switch(uVar19) {
          case 1:
          case 3:
          case 5:
          case 6:
            amount = uVar42;
            uVar14 = uVar42;
TURN_Load:
            uVar39 = uVar14;
            if ((iLoad != 0) && (uVar39 != 0)) {
              l = uVar38;
              l2 = lVar43;
              amount = uVar39;
              amountEdit = uVar42;
              if (j == 4) {
                uVar38 = GetFuelFree(lpfl);
                l = uVar38;
                lVar43 = l2;
                uVar42 = amountEdit;
                uVar39 = amount;
              }
              else {
                uVar38 = GetCargoFree(lpfl);
                l = uVar38;
                lVar43 = l2;
                uVar42 = amountEdit;
                uVar39 = amount;
              }
              if ((long)uVar38 < (long)uVar39) {
                uVar39 = uVar38;
              }
              amount = uVar39;
              l2 = lVar43;
              amountEdit = uVar42;
              if ((fHasPermission == 0) || (((uint)ord.wFlags >> 8 & 0xf) == 4)) {
                if ((j == 4) && (fOptFuel != 0)) {
                  amount._0_2_ = 0;
                  amount._2_2_ = 0;
                  uVar39 = 0;
                }
                else {
                  if (iPass == 4) {
                    uVar19 = (uint)ord.wFlags >> 8 & 0xf;
                    if (uVar19 == 1) {
                      idm = 0x11f;
                    }
                    else if (uVar19 == 2) {
                      idm = 0x120;
                    }
                    else if (uVar19 == 4) {
                      idm = 0x123;
                    }
                    l = uVar38;
                    FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,j);
                    goto TURN_CancelOrder;
                  }
                  fDone = 0;
                }
              }
              else {
                if ((fStealing != 0) && ((j == 3 || (j == 4)))) {
                  fDone = 1;
                }
                if (uVar39 == 0) {
                  if (uVar19 == 6) {
                    if (j == 4) {
                      fDone = 0;
                    }
                    else {
                      bVar37 = false;
                    }
                  }
                }
                else {
                  if ((long)uVar39 < (long)uVar13) {
                    uVar13 = uVar39;
                  }
                  l = uVar13;
                  lVar43 = ChgCargo((uint)ord.wFlags >> 8 &
                                          (grobjThing|grobjOther|grobjFleet|grobjPlanet),ord.id,j,
                                          CONCAT22(-((int)(uVar13 >> 0x10) +
                                                    (uint)((int)uVar13 != 0)),-(int)uVar13),
                                          (void *)0x0);
                  l2 = lVar43;
                  if (lVar43 != 0) {
                    uVar42 = ChgCargo(grobjFleet,lpfl->id,j,
                                            CONCAT22(-((int)((ulong)lVar43 >> 0x10) +
                                                      (uint)((int)lVar43 != 0)),-(int)lVar43),
                                            (void *)0x0);
                    l = uVar42;
                    lVar43 = l2;
                    if (uVar42 != 0) {
                      if ((((uint)ord.wFlags >> 8 & 0xf) == 2) &&
                         (((FLEET *)lpfl)->iPlayer != ((FLEET *)lpflWP)->iPlayer)) {
                        sVar46 = 0;
                        sVar45 = 0;
                        uVar16 = idWP & 0x7fff;
                        sVar44 = j;
                        uVar42 = __aFulshr(CONCAT22(idWP,j) & 0x7fffffff,0);
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasStolen,lpfl->id | 0x8000,
                                         lpfl->id,(short)l,(short)uVar42,sVar44,uVar16,sVar45,sVar46
                                        );
                        lVar43 = l2;
                      }
                      else {
                        sVar45 = 0;
                        sVar44 = j;
                        uVar20 = xWP;
                        uVar17 = idWP;
                        uVar42 = __aFulshr(CONCAT22(xWP,j),idWP);
                        if (j == 3) {
                          MVar18 = idmHasBeamed;
                        }
                        else {
                          MVar18 = idmHasLoaded;
                        }
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar18,lpfl->id | 0x8000,lpfl->id,
                                         (short)l,(short)uVar42,sVar44,uVar20,uVar17,sVar45);
                        lVar43 = l2;
                      }
                    }
                  }
                  l2._2_2_ = (int)((ulong)lVar43 >> 0x10);
                  l2._0_2_ = (int)lVar43;
                  uVar38 = l;
                  uVar39 = amount;
                  uVar42 = amountEdit;
                  if (((fFueling != 0) || (fMining != 0)) &&
                     (amount != CONCAT22(-(l2._2_2_ + (uint)((int)l2 != 0)),-(int)l2))) {
                    l = lVar43 + amount;
                    l2 = lVar43;
                    lVar43 = ChgCargo(grobjPlanet,pl.id,j,
                                            CONCAT22(-((int)((ulong)l >> 0x10) + (uint)((int)l != 0)
                                                      ),-(int)l),(void *)0x0);
                    l2 = lVar43;
                    if (lVar43 == 0) {
                      l._0_2_ = 0;
                      l._2_2_ = 0;
                      uVar38 = 0;
                      uVar39 = amount;
                      uVar42 = amountEdit;
                    }
                    else {
                      lVar43 = ChgCargo(grobjFleet,lpfl->id,j,
                                              CONCAT22(-((int)((ulong)lVar43 >> 0x10) +
                                                        (uint)((int)lVar43 != 0)),-(int)lVar43),
                                              (void *)0x0);
                      l = lVar43;
                      if (fMining == 0) {
                        sVar46 = 0;
                        sVar44 = j;
                        uVar20 = xWP;
                        sVar45 = pl.id;
                        uVar42 = __aFulshr(CONCAT22(xWP,j),pl.id);
                        if (j == 3) {
                          MVar18 = idmHasBeamed;
                        }
                        else {
                          MVar18 = idmHasLoaded;
                        }
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar18,lpfl->id | 0x8000,lpfl->id,
                                         (short)l,(short)uVar42,sVar44,uVar20,sVar45,sVar46);
                        uVar38 = l;
                        lVar43 = l2;
                        uVar39 = amount;
                        uVar42 = amountEdit;
                      }
                      else {
                        sVar48 = 0;
                        sVar44 = lpflWP->id;
                        sVar45 = j;
                        sVar46 = pl.id;
                        uVar42 = __aFulshr(CONCAT22(sVar44,j),pl.id);
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasLoadedMiningRobotsWorking,
                                         lpfl->id | 0x8000,lpfl->id,(short)l,(short)uVar42,sVar45,
                                         sVar44,sVar46,sVar48);
                        uVar38 = l;
                        lVar43 = l2;
                        uVar39 = amount;
                        uVar42 = amountEdit;
                      }
                    }
                  }
                  if ((uVar39 != uVar38) && (uVar19 == 6)) {
                    bVar37 = false;
                  }
                  if (((uVar38 != 0) && (uVar19 == 7)) && (j == 4)) {
                    wtOptimalFuel = uVar38;
                  }
                }
              }
            }
            break;
          case 2:
          case 4:
            uVar39 = uVar42;
            if (CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2),
                         (int)((FLEET *)lpfl)->rgwtMin[j]) < uVar42) {
              uVar39 = CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2),
                                (int)((FLEET *)lpfl)->rgwtMin[j]);
            }
            amount = uVar39;
TURN_Unload:
            if (iLoad == 0) {
              amount = uVar39;
              if (((j == 3) && (((uint)ord.wFlags >> 8 & 0xf) == 1)) &&
                 (pl.iPlayer != ((FLEET *)lpfl)->iPlayer)) {
                if ((pl.iPlayer == -1) && (((uint)pl.wFlags >> 0xd & 1) == 0)) {
                  idm = 0x55;
                }
                else {
                  sVar44 = GetRaceStat((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                             rsMajorAdv);
                  lVar43 = l2;
                  uVar38 = l;
                  uVar39 = amount;
                  uVar42 = amountEdit;
                  if (sVar44 == 8) {
                    idm = 0x56;
                  }
                  else {
                    if (((uint)pl.wFlags >> 9 & 1) == 0) {
                      FQueueColonistDrop(lpfl,(PLANET *)CONCAT22(unaff_SS,&pl),amount);
                      uVar38 = l;
                      uVar39 = amount;
                      lVar43 = l2;
                      uVar42 = amountEdit;
                      goto LAB_10b0_7ae8;
                    }
                    idm = 0x135;
                  }
                }
              }
              else {
                if (((j != 3) || (((uint)ord.wFlags >> 8 & 0xf) != 2)) ||
                   (((FLEET *)lpfl)->iPlayer == ((uint)ord.id >> 9 & 0xf))) {
                  if (((uint)ord.wFlags >> 8 & 0xf) == 2) {
                    iVar21 = ((FLEET *)lpflWP)->iPlayer * 0xc0 + 0x5a12;
                    uStack_9a = (FLEET *)CONCAT22(iVar21,(FLEET *)uStack_9a);
                    if (*(char *)(iVar21 + ((FLEET *)lpfl)->iPlayer) == '\x02') {
                      amount._0_2_ = 0;
                      amount._2_2_ = 0;
                      uVar39 = 0;
                      goto LAB_10b0_7ae8;
                    }
                  }
                  if ((j != 3) || (((uint)ord.wFlags >> 8 & 0xf) != 4)) {
                    if (uVar39 != 0) {
                      if ((fFueling == 0) || (j == 4)) {
                        uVar38 = ChgCargo((uint)ord.wFlags >> 8 &
                                                (grobjThing|grobjOther|grobjFleet|grobjPlanet),
                                                ord.id,j,uVar39,(void *)0x0);
                        l = uVar38;
                        if (0 < (long)uVar38) {
                          sVar45 = 0;
                          sVar44 = j;
                          uVar20 = xWP;
                          uVar17 = idWP;
                          uVar42 = __aFulshr(CONCAT22(xWP,j),idWP);
                          if (j == 3) {
                            MVar18 = idmHasBeamed2;
                          }
                          else {
                            MVar18 = idmHasUnloaded;
                          }
                          FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar18,lpfl->id | 0x8000,
                                           lpfl->id,(short)l,(short)uVar42,sVar44,uVar20,uVar17,
                                           sVar45);
                          uVar38 = l;
                        }
                        amount = uVar38;
                        uVar39 = uVar38;
                        lVar43 = l2;
                        uVar42 = amountEdit;
                      }
                      else {
                        lVar43 = ChgCargo(grobjPlanet,pl.id,j,uVar39,(void *)0x0);
                        sVar46 = 0;
                        sVar44 = j;
                        uVar20 = xWP;
                        sVar45 = pl.id;
                        l = lVar43;
                        uVar42 = __aFulshr(CONCAT22(xWP,j),pl.id);
                        if (j == 3) {
                          MVar18 = idmHasBeamed2;
                        }
                        else {
                          MVar18 = idmHasUnloaded;
                        }
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar18,lpfl->id | 0x8000,lpfl->id,
                                         (short)l,(short)uVar42,sVar44,uVar20,sVar45,sVar46);
                        uVar38 = l;
                        uVar39 = amount;
                        lVar43 = l2;
                        uVar42 = amountEdit;
                      }
                    }
LAB_10b0_7ae8:
                    amount._2_2_ = (uint)(uVar39 >> 0x10);
                    amount._0_2_ = (uint)uVar39;
                    if (uVar39 != 0) {
                      iVar21 = -(uint)amount;
                      iVar23 = amount._2_2_ + ((uint)amount != 0);
                      l = uVar38;
                      amount = uVar39;
                      l2 = lVar43;
                      amountEdit = uVar42;
                      uVar38 = ChgCargo(grobjFleet,lpfl->id,j,CONCAT22(-iVar23,iVar21),
                                              (void *)0x0);
                      l = uVar38;
                      uVar39 = amount;
                      lVar43 = l2;
                      uVar42 = amountEdit;
                    }
                    amount = uVar39;
                    l2 = lVar43;
                    (ord.txp.rgia + j)->wFlags = (ord.txp.rgia + j)->wFlags & 0xfff;
                    lVar43 = l2;
                    uVar39 = amount;
                    break;
                  }
                  FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasTriedBeamColonistsDeepSpaceOrder,
                                    lpfl->id | 0x8000,lpfl->id,0);
                  goto TURN_CancelOrder;
                }
                idm = 0x155;
              }
              l = uVar38;
              l2 = lVar43;
              amountEdit = uVar42;
              amount = uVar39;
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,pl.id);
              goto TURN_CancelOrder;
            }
            break;
          case 7:
            if (j == 4) {
              wtOptimalFuel._0_2_ = 0;
              wtOptimalFuel._2_2_ = 0;
              wtOptimalFuel = 0;
              fOptFuel = 1;
            }
            else if (iLoad != 0) {
              if (1 < fDunnage) {
                amount._0_2_ = (uint)amountWP;
                amount._2_2_ = amountWP._2_2_;
                uVar14 = CONCAT22(amountWP._2_2_,(uint)amountWP);
                uVar39 = CONCAT22(amountWP._2_2_,(uint)amountWP);
                if ((uint)amountWP == 0) goto joined_r0x10b070d0;
                goto TURN_Load;
              }
              fDunnage = 1;
            }
            break;
          case 8:
            puVar4 = (uint *)(((FLEET *)lpfl)->rgwtMin + j);
            uVar16 = (uint)amountEdit - *puVar4;
            amount._2_2_ = (amountEdit._2_2_ - *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2)) -
                           (uint)((uint)amountEdit < *puVar4);
            amount._0_2_ = uVar16;
            uVar39 = CONCAT22(amount._2_2_,uVar16);
            if ((int)amount._2_2_ < 0) {
              if (iLoad == 0) {
                amount._2_2_ = -(amount._2_2_ + (uVar16 != 0));
                amount._0_2_ = -uVar16;
                uVar39 = CONCAT22(amount._2_2_,-uVar16);
                goto TURN_Unload;
              }
            }
            else {
              uVar39 = CONCAT22(amount._2_2_,uVar16);
              if (iLoad != 0) {
                if ((amountWP._2_2_ <= (int)amount._2_2_) &&
                   (((amountWP._2_2_ < (int)amount._2_2_ || ((uint)amountWP < uVar16)) &&
                    (fDone = 0, iPass == 4)))) {
                  if (j == 3) {
                    idm = idmAttemptedSetNumberBoardUnfortunatelyCouldntProvi;
                  }
                  else {
                    idm = idmAttemptedSetAmountBoardUnfortunatelyCouldntProvi;
                  }
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,j,
                                   (ord.txp.rgia + j)->wFlags & 0xfff,0,xWP,idWP,0);
                  uVar38 = l;
                  lVar43 = l2;
                  uVar42 = amountEdit;
                }
                uVar14 = CONCAT22(amount._2_2_,(uint)amount);
                goto TURN_Load;
              }
            }
            break;
          case 9:
            amount._0_2_ = (uint)amountWP - (uint)amountEdit;
            amount._2_2_ = (amountWP._2_2_ - amountEdit._2_2_) -
                           (uint)((uint)amountWP < (uint)amountEdit);
            uVar14 = CONCAT22(amount._2_2_,(uint)amount);
            uVar39 = CONCAT22(amount._2_2_,(uint)amount);
            amountWP._2_2_ = iLoad;
            if (((int)amount._2_2_ < 1) && ((int)amount._2_2_ < 0)) {
              uVar39 = CONCAT22(amount._2_2_,(uint)amount);
              if (iLoad == 0) {
                uVar16 = -(uint)amount;
                amount._2_2_ = -(amount._2_2_ + ((uint)amount != 0));
                uVar19 = *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2);
                if (((int)uVar19 < (int)amount._2_2_) ||
                   (((int)uVar19 <= (int)amount._2_2_ &&
                    (*(uint *)(((FLEET *)lpfl)->rgwtMin + j) <= uVar16)))) {
                  uVar16 = *(uint *)(((FLEET *)lpfl)->rgwtMin + j);
                  amount._2_2_ = *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2);
                }
                amount._0_2_ = uVar16;
                uVar39 = CONCAT22(amount._2_2_,uVar16);
                goto TURN_Unload;
              }
            }
            else {
joined_r0x10b070d0:
              if (amountWP._2_2_ != 0) goto TURN_Load;
            }
          }
switchD_10b0_7b5d_default:
          j = j + 1;
        }
        if (((fOptFuel != 0) && (iLoad != 0)) && (fDunnage != 1)) {
          if (((FLEET *)lpfl)->cord < 2) {
            amount._0_2_ = 0;
            amount._2_2_ = 0;
            uVar39 = 0;
            uStack_9e = (PLANET *)
                        CONCAT22(*(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12),
                                 *(PLANET **)(((FLEET *)lpfl)->rgwtMin + 4));
TURN_SetOptAmount:
            amount = uVar39;
            amountEdit = uVar42;
            if (((PLANET *)uStack_9e == (PLANET *)0x0) && (uStack_9e._2_2_ == 0)) {
              l._0_2_ = 0;
              l._2_2_ = 0;
              l = 0;
            }
            else {
              l = uVar38;
              l2 = lVar43;
              lVar43 = ChgCargo((uint)ord.wFlags >> 8 &
                                      (grobjThing|grobjOther|grobjFleet|grobjPlanet),ord.id,4,
                                      (long)uStack_9e,(void *)0x0);
              l2 = lVar43;
              if (lVar43 != 0) {
                uVar42 = ChgCargo(grobjFleet,lpfl->id,4,
                                        CONCAT22(-((int)((ulong)lVar43 >> 0x10) +
                                                  (uint)((int)lVar43 != 0)),-(int)lVar43),
                                        (void *)0x0);
                l = uVar42;
                lVar43 = l2;
              }
            }
            uVar39 = amount;
            if (lVar43 != 0) {
              l = l + wtOptimalFuel;
              l2 = lVar43;
              if (l < 1) {
                if ((l < 0x10000) && (l < 0)) {
                  sVar45 = 0;
                  sVar44 = 4;
                  uVar20 = xWP;
                  uVar17 = idWP;
                  uVar42 = __aFulshr(CONCAT22(xWP,4),idWP);
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasUnloaded,lpfl->id | 0x8000,
                                   lpfl->id,-(short)l,(short)uVar42,sVar44,uVar20,uVar17,sVar45);
                  lVar43 = l2;
                  uVar39 = amount;
                }
              }
              else {
                sVar45 = 0;
                sVar44 = 4;
                uVar20 = xWP;
                uVar17 = idWP;
                uVar42 = __aFulshr(CONCAT22(xWP,4),idWP);
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasLoaded,lpfl->id | 0x8000,lpfl->id,
                                 (short)l,(short)uVar42,sVar44,uVar20,uVar17,sVar45);
                lVar43 = l2;
                uVar39 = amount;
              }
            }
          }
          else {
            uVar39 = EstFuelUse(lpfl,0,-1,-1,0);
            amount = uVar39;
            uVar34 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar24 = (FLEET *)lpfl;
            lVar43 = l2;
            if (CONCAT22(*(undefined2 *)((int)pFVar24->rgwtMin + 0x12),(int)pFVar24->rgwtMin[4]) <
                (long)uVar39) {
              fDone = 0;
              if (wtOptimalFuel != 0) {
                sVar45 = 0;
                sVar44 = 4;
                uVar20 = xWP;
                uVar17 = idWP;
                uVar42 = __aFulshr(CONCAT22(xWP,4),idWP);
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasLoaded,lpfl->id | 0x8000,lpfl->id,
                                 (short)wtOptimalFuel,(short)uVar42,sVar44,uVar20,uVar17,sVar45);
                uVar39 = amount;
                lVar43 = l2;
              }
              l2 = lVar43;
              amount = uVar39;
              if ((iPass == 4) && (fHasPermission == 0)) {
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmFailedLoadFuel,lpfl->id | 0x8000,
                                 lpfl->id,xWP,idWP,0,0,0,0);
                uVar39 = amount;
                uVar38 = l;
                lVar43 = l2;
                uVar42 = amountEdit;
              }
              else {
                uVar38 = l;
                uVar42 = amountEdit;
                if (iPass == 2) {
                  cMine_2 = LGetFleetStat(lpfl,1);
                  if (cMine_2 < amount) {
                    sVar46 = 0;
                    uVar20 = 0;
                    uVar42 = __aFulshr(0,unaff_DI);
                    sVar45 = (short)uVar42;
                    sVar44 = (uint)amount;
                    uVar42 = __aFulshr(CONCAT22(sVar45,(uint)amount),uVar20);
                    FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmWillNeverMakeWaypointFuelCapacityMg
                                     ,lpfl->id | 0x8000,lpfl->id,(uint)cMine_2,(short)uVar42,sVar44,
                                     sVar45,uVar20,sVar46);
                    uVar39 = amount;
                    uVar38 = l;
                    lVar43 = l2;
                    uVar42 = amountEdit;
                  }
                  else {
                    uVar34 = (undefined2)((ulong)lpfl >> 0x10);
                    puVar4 = (uint *)(((FLEET *)lpfl)->rgwtMin + 4);
                    uStack_9a = (FLEET *)CONCAT22((amount._2_2_ -
                                                  *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12)) -
                                                  (uint)((uint)amount < *puVar4),
                                                  (FLEET *)((uint)amount - *puVar4));
                    if (fMining == 2) {
                      idWP = pl.id;
                    }
                    sVar45 = 0;
                    sVar44 = 0;
                    uVar42 = __aFulshr(0,unaff_DI);
                    FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                     idmThereIsntEnoughFuelAvailableAllowGet,lpfl->id | 0x8000,xWP,
                                     idWP,lpfl->id,(short)(FLEET *)uStack_9a,(short)uVar42,sVar44,
                                     sVar45);
                    uVar39 = amount;
                    uVar38 = l;
                    lVar43 = l2;
                    uVar42 = amountEdit;
                  }
                }
              }
              goto TURN_FinishFleet;
            }
            if ((long)uVar39 <
                CONCAT22(*(undefined2 *)((int)pFVar24->rgwtMin + 0x12),(int)pFVar24->rgwtMin[4])) {
              cMine_2 = CONCAT22(*(undefined2 *)((int)pFVar24->rgwtMin + 0x12),
                                 (int)pFVar24->rgwtMin[4]);
              do {
                amount._2_2_ = (uint)(uVar39 >> 0x10);
                amount._0_2_ = (uint)uVar39;
                uVar34 = (undefined2)((ulong)lpfl >> 0x10);
                *(uint *)(((FLEET *)lpfl)->rgwtMin + 4) = (uint)amount;
                *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = amount._2_2_;
                amount = uVar39;
                uVar39 = EstFuelUse(lpfl,0,-1,-1,0);
                amount = uVar39;
                uVar34 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar24 = (FLEET *)lpfl;
              } while ((long)uVar39 <
                       CONCAT22(*(undefined2 *)((int)pFVar24->rgwtMin + 0x12),
                                (int)pFVar24->rgwtMin[4]));
              uStack_9e = (PLANET *)
                          CONCAT22((cMine_2._2_2_ - (int)(uVar39 >> 0x10)) -
                                   (uint)((uint)cMine_2 < (uint)uVar39),
                                   (PLANET *)((uint)cMine_2 - (uint)uVar39));
              *(uint *)(pFVar24->rgwtMin + 4) = (uint)cMine_2;
              *(int *)((int)pFVar24->rgwtMin + 0x12) = cMine_2._2_2_;
              uVar38 = l;
              lVar43 = l2;
              uVar42 = amountEdit;
              goto TURN_SetOptAmount;
            }
          }
          uVar38 = l;
          uVar42 = amountEdit;
          if ((fDone != 0) && (bVar37)) {
            ord.txp.rgia[4].wFlags = 0;
          }
        }
TURN_FinishFleet:
        if (!bVar37) {
          l = uVar38;
          amount = uVar39;
          l2 = lVar43;
          amountEdit = uVar42;
          lVar40 = GetCargoFree(lpfl);
          uVar38 = l;
          uVar39 = amount;
          lVar43 = l2;
          uVar42 = amountEdit;
          if (0 < lVar40) {
            fDone = 0;
          }
        }
        l = uVar38;
        amount = uVar39;
        l2 = lVar43;
        amountEdit = uVar42;
        if ((fDone == 0) || (fDunnage != 1)) goto LAB_10b0_80f5;
        lVar43 = GetCargoFree(lpfl);
        if ((lVar43 < 1) && (fOptFuel == 0)) goto LAB_10b0_80f5;
        fDunnage = 2;
        uVar38 = l;
        uVar39 = amount;
        lVar43 = l2;
        uVar42 = amountEdit;
      } while( true );
    }
    if ((((THING *)lpthWP != (THING *)0x0) || (lpthWP._2_2_ != 0)) &&
       ((uint)lpthWP->idFull >> 0xd == 1)) goto TURN_LTryDunnage;
    if (((THING *)lpthWP != (THING *)0x0) || (lpthWP._2_2_ != 0)) {
      FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHadOrdersTransferCargoFutilePursuit,
                        lpfl->id | 0x8000,lpfl->id,(uint)lpthWP->idFull >> 0xd);
    }
    goto TURN_CancelOrder;
  }
  if ((((ord.wFlags & 0xfU) == 5) && (iPass == 1)) || ((ord.wFlags & 0xfU) == 2)) {
    if (pFVar24->idPlanet == -1) {
      if ((ord.wFlags & 0xfU) != 2) {
        pl.id = -1;
        pl.iPlayer = -1;
        pl.wFlags = pl.wFlags & 0xfdff;
        goto TURN_LScrap;
      }
      FSendPlrMsg2(pFVar24->iPlayer,idmHasOrderColonizeCurrentlyOrbitPlanetOrder,
                        lpfl->id | 0x8000,lpfl->id,0);
    }
    else {
      sVar44 = FLookupPlanet(pFVar24->idPlanet,&pl);
      if ((sVar44 != 0) || ((ord.wFlags & 0xfU) != 2)) {
TURN_LScrap:
        if ((ord.wFlags & 0xfU) == 2) {
          pFVar24 = (FLEET *)lpfl;
          uVar34 = (undefined2)((ulong)lpfl >> 0x10);
          if (pl.iPlayer == -1) {
            if (((int)pFVar24->rgwtMin[3] != 0) || (*(int *)((int)pFVar24->rgwtMin + 0xe) != 0))
            goto LAB_10b0_829a;
            FSendPlrMsg2(pFVar24->iPlayer,idmHasOrdersColonizeHaveFailedBringAlong,
                              lpfl->id | 0x8000,lpfl->id,pl.id);
          }
          else {
            FSendPlrMsg(pFVar24->iPlayer,idmHasOrdersColonizeAlreadyPopulatedColonizeOrder,
                             lpfl->id | 0x8000,lpfl->id,pl.id,pl.id,0,0,0,0);
          }
        }
        else {
LAB_10b0_829a:
          lpth = (THING *)((ulong)lpth & 0xffff);
          while ((int)lpth._2_2_ < 3) {
            iVar21 = lpth._2_2_ * 4;
            *(undefined2 *)(rgwt + lpth._2_2_) = 0;
            *(undefined2 *)((int)rgwt + iVar21 + 2) = 0;
            lpth = (THING *)CONCAT22(lpth._2_2_ + 1,(THING *)lpth);
          }
          bVar37 = false;
          _memset((byte *)rgTechBattle,0,6);
          _memset((byte *)rgTechTrader,0,0xd);
          lpth = (THING *)((ulong)lpth & 0xffff);
          while( true ) {
            pFVar24 = (FLEET *)lpfl;
            uVar34 = (undefined2)((ulong)lpfl >> 0x10);
            if (0xf < (int)lpth._2_2_) break;
            if (0 < pFVar24->rgcsh[lpth._2_2_]) {
              iVar21 = pFVar24->iPlayer * 4;
              MarkTechsSeen
                        ((HUL *)CONCAT22(*(undefined2 *)(iVar21 + 0x100),
                                         (HUL *)(*(int *)(iVar21 + 0xfe) + lpth._2_2_ * 0x93)),
                         pFVar24->iPlayer);
              uStack_9a = (FLEET *)((ulong)uStack_9a & 0xffff);
              while( true ) {
                uVar34 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar24 = (FLEET *)lpfl;
                iVar21 = pFVar24->iPlayer * 4;
                if ((int)(uint)*(byte *)(*(int *)(iVar21 + 0xfe) + lpth._2_2_ * 0x93 + 0x7a) <=
                    uStack_9a._2_2_) break;
                iVar21 = pFVar24->iPlayer * 4;
                if ((*(int *)(*(int *)(iVar21 + 0xfe) + lpth._2_2_ * 0x93 + 0x3a +
                             uStack_9a._2_2_ * 4) == 0x1000) &&
                   ((iVar21 = pFVar24->iPlayer * 4,
                    (*(uint *)(*(int *)(iVar21 + 0xfe) + lpth._2_2_ * 0x93 + uStack_9a._2_2_ * 4 +
                              0x3c) & 0xff) == 0 ||
                    (iVar21 = pFVar24->iPlayer * 4,
                    (*(uint *)(*(int *)(iVar21 + 0xfe) + lpth._2_2_ * 0x93 + uStack_9a._2_2_ * 4 +
                              0x3c) & 0xff) == 1)))) {
                  bVar37 = true;
                }
                uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_ + 1,(FLEET *)uStack_9a);
              }
            }
            lpth = (THING *)CONCAT22(lpth._2_2_ + 1,(THING *)lpth);
          }
          if (((ord.wFlags & 0xfU) != 2) || (bVar37)) {
            lpthBest = (THING *)0x0;
            if (((ord.wFlags & 0xfU) == 5) && (pl.iPlayer != -1)) {
              sVar44 = GetRaceGrbit((PLAYER *)rgplr + pl.iPlayer,
                                          ibitRaceGeneralizedResearch|ibitRaceTT);
              if (sVar44 == 0) goto LAB_10b0_8510;
              bVar37 = true;
            }
            else {
LAB_10b0_8510:
              bVar37 = false;
            }
            sVar44 = GetRaceGrbit((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                        ibitRaceBleedingEdgeTech);
            gd._4_2_ = gd._4_2_ & 0xfff7 | 8;
            idPlayer = ((FLEET *)lpfl)->iPlayer;
            lpth = (THING *)((ulong)lpth & 0xffff);
            while( true ) {
              if (2 < (int)lpth._2_2_) break;
              lBest._2_2_ = 0;
              lpth = (THING *)((ulong)lpth._2_2_ << 0x10);
              uStack_9a = (FLEET *)((ulong)uStack_9a & 0xffff);
              while (uStack_9a._2_2_ < 0x10) {
                if (0 < ((FLEET *)lpfl)->rgcsh[uStack_9a._2_2_]) {
                  if (sVar44 == 0) {
                    iVar21 = ((FLEET *)lpfl)->iPlayer * 4;
                    cMine_2 = CONCAT22(*(undefined2 *)(iVar21 + 0x100),
                                       *(int *)(iVar21 + 0xfe) + uStack_9a._2_2_ * 0x93);
                  }
                  else {
                    iVar21 = ((FLEET *)lpfl)->iPlayer * 4;
                    uVar34 = *(undefined2 *)(iVar21 + 0x100);
                    puVar30 = (undefined2 *)(*(int *)(iVar21 + 0xfe) + uStack_9a._2_2_ * 0x93);
                    puVar32 = (undefined2 *)auStack_140;
                    for (iVar21 = 0x49; iVar21 != 0; iVar21 = iVar21 + -1) {
                      puVar9 = puVar32;
                      puVar32 = puVar32 + 1;
                      puVar6 = puVar30;
                      puVar30 = puVar30 + 1;
                      *puVar9 = *puVar6;
                    }
                    *(undefined1 *)puVar32 = *(undefined1 *)puVar30;
                    UpdateShdefCost((SHDEF *)CONCAT22(unaff_SS,(SHDEF *)auStack_140));
                    cMine_2 = CONCAT22(unaff_SS,auStack_140);
                  }
                  uVar42 = __aFulmul((long)((FLEET *)lpfl)->rgcsh[uStack_9a._2_2_],
                                             (ulong)*(uint *)((uint)cMine_2 + 0x2c + lpth._2_2_ * 2)
                                            );
                  uStack_9e = (PLANET *)CONCAT22((int)uVar42,(PLANET *)uStack_9e);
                  uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_,(FLEET *)(uVar42 >> 0x10));
                  if (*(int *)((int)cMine_2 + 0x7b) < 0) {
                    lVar43 = __aFldiv(uVar42,4);
                    uStack_9e = (PLANET *)CONCAT22((int)lVar43,(PLANET *)uStack_9e);
                    uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_,(FLEET *)((ulong)lVar43 >> 0x10));
                  }
                  bVar36 = CARRY2(lBest._2_2_,uStack_9e._2_2_);
                  lBest._2_2_ = lBest._2_2_ + uStack_9e._2_2_;
                  lpth = (THING *)CONCAT22(lpth._2_2_,
                                           (THING *)((int)((FLEET *)uStack_9a)->rgcsh +
                                                    (int)(((THING *)lpth)->rgb + (bVar36 - 0x12))));
                }
                uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_ + 1,(FLEET *)uStack_9a);
              }
              if ((ord.wFlags & 0xfU) == 2) {
                uVar35 = 0;
                uVar34 = 4;
                uVar42 = __aFulmul(CONCAT22((THING *)lpth,lBest._2_2_),3);
                lVar43 = __aFldiv(uVar42,CONCAT22(uVar35,uVar34));
                lBest._2_2_ = (uint)lVar43;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar43 >> 0x10));
              }
              else if (pl.id == -1) {
                lVar43 = __aFldiv(CONCAT22((THING *)lpth,lBest._2_2_),3);
                lBest._2_2_ = (uint)lVar43;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar43 >> 0x10));
              }
              else if (((uint)pl.wFlags >> 9 & 1) == 0) {
                if (bVar37) {
                  uVar35 = 0;
                  uVar34 = 0x14;
                  uVar42 = __aFulmul(CONCAT22((THING *)lpth,lBest._2_2_),9);
                  lVar43 = __aFldiv(uVar42,CONCAT22(uVar35,uVar34));
                  lBest._2_2_ = (uint)lVar43;
                  lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar43 >> 0x10));
                }
                else {
                  lVar43 = __aFldiv(CONCAT22((THING *)lpth,lBest._2_2_),3);
                  lBest._2_2_ = (uint)lVar43;
                  lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar43 >> 0x10));
                }
              }
              else if (bVar37) {
                uVar35 = 0;
                uVar34 = 10;
                uVar42 = __aFulmul(CONCAT22((THING *)lpth,lBest._2_2_),9);
                lVar43 = __aFldiv(uVar42,CONCAT22(uVar35,uVar34));
                lBest._2_2_ = (uint)lVar43;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar43 >> 0x10));
              }
              else {
                uVar35 = 0;
                uVar34 = 5;
                lVar43 = __aFlshl(5,unaff_DI);
                lVar43 = __aFldiv(lVar43,CONCAT22(uVar35,uVar34));
                lBest._2_2_ = (uint)lVar43;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar43 >> 0x10));
              }
              uVar34 = lpPlanets._2_2_;
              uVar19 = *(uint *)(((FLEET *)lpfl)->rgwtMin + lpth._2_2_);
              bVar36 = CARRY2(lBest._2_2_,uVar19);
              uVar19 = lBest._2_2_ + uVar19;
              lBest = CONCAT22(uVar19,(undefined2)lBest);
              pTVar27 = (THING *)(((THING *)lpth)->rgb +
                                 (uint)bVar36 +
                                 *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + lpth._2_2_) + 2) + -6);
              lpthBest = (THING *)CONCAT22(pTVar27->rgb +
                                           (uint)CARRY2((uint)(THING *)lpthBest,uVar19) +
                                           lpthBest._2_2_ + -6,
                                           (THING *)(((THING *)lpthBest)->rgb + (uVar19 - 6)));
              if (pl.id == -1) {
                *(uint *)(pl.rgwtMin + lpth._2_2_) = uVar19;
                *(int *)((int)pl.rgwtMin + lpth._2_2_ * 4 + 2) = (int)pTVar27;
              }
              else {
                pPVar15 = (PLANET *)lpPlanets + pl.id;
                puVar4 = (uint *)(pPVar15->rgwtMin + lpth._2_2_);
                uVar16 = *puVar4;
                *puVar4 = *puVar4 + uVar19;
                puVar4 = (uint *)((int)(pPVar15->rgwtMin + lpth._2_2_) + 2);
                *puVar4 = (uint)(pTVar27->rgb + (uint)CARRY2(uVar16,uVar19) + *puVar4 + -6);
              }
              lpth = (THING *)CONCAT22(lpth._2_2_ + 1,pTVar27);
            }
            uStack_9e = (PLANET *)CONCAT22(uStack_9e._2_2_,pl.id);
            if (bVar37) {
              lResUltimate._0_2_ = 0;
              lResUltimate._2_2_ = (char *)0x0;
              uStack_9a = (FLEET *)((ulong)uStack_9a & 0xffff);
              while (uStack_9a._2_2_ < 0x10) {
                if (0 < ((FLEET *)lpfl)->rgcsh[uStack_9a._2_2_]) {
                  if (sVar44 == 0) {
                    iVar21 = ((FLEET *)lpfl)->iPlayer * 4;
                    cMine_2 = CONCAT22(*(undefined2 *)(iVar21 + 0x100),
                                       *(int *)(iVar21 + 0xfe) + uStack_9a._2_2_ * 0x93);
                  }
                  else {
                    iVar21 = ((FLEET *)lpfl)->iPlayer * 4;
                    uVar34 = *(undefined2 *)(iVar21 + 0x100);
                    puVar30 = (undefined2 *)(*(int *)(iVar21 + 0xfe) + uStack_9a._2_2_ * 0x93);
                    puVar32 = (undefined2 *)auStack_140;
                    for (iVar21 = 0x49; iVar21 != 0; iVar21 = iVar21 + -1) {
                      puVar9 = puVar32;
                      puVar32 = puVar32 + 1;
                      puVar6 = puVar30;
                      puVar30 = puVar30 + 1;
                      *puVar9 = *puVar6;
                    }
                    *(undefined1 *)puVar32 = *(undefined1 *)puVar30;
                    UpdateShdefCost((SHDEF *)CONCAT22(unaff_SS,(SHDEF *)auStack_140));
                    cMine_2 = CONCAT22(unaff_SS,auStack_140);
                  }
                  uVar42 = __aFulmul((long)((FLEET *)lpfl)->rgcsh[uStack_9a._2_2_],
                                             (ulong)*(uint *)((int)cMine_2 + 0x2a));
                  uStack_9e = (PLANET *)CONCAT22((int)uVar42,(PLANET *)uStack_9e);
                  uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_,(FLEET *)(uVar42 >> 0x10));
                  if (*(int *)((int)cMine_2 + 0x7b) < 0) {
                    lVar43 = __aFldiv(uVar42,4);
                    uStack_9e = (PLANET *)CONCAT22((int)lVar43,(PLANET *)uStack_9e);
                    uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_,(FLEET *)((ulong)lVar43 >> 0x10));
                  }
                  bVar37 = CARRY2((uint)lResUltimate,uStack_9e._2_2_);
                  lResUltimate._0_2_ = (uint)lResUltimate + uStack_9e._2_2_;
                  lResUltimate._2_2_ =
                       (char *)((int)((FLEET *)uStack_9a)->rgcsh +
                               (int)(lResUltimate._2_2_ + (bVar37 - 0xc)));
                }
                uStack_9a = (FLEET *)CONCAT22(uStack_9a._2_2_ + 1,(FLEET *)uStack_9a);
              }
              if ((-1 < (int)lResUltimate._2_2_) && (0 < (int)lResUltimate._2_2_)) {
                lResUltimate._0_2_ = 0xffff;
                lResUltimate._2_2_ = (char *)0x0;
              }
              lVar43 = CONCAT22(lResUltimate._2_2_,(uint)lResUltimate);
              ((ushort *)vrgPlanResExtra)[pl.id] =
                   ((ushort *)vrgPlanResExtra)[pl.id] + (uint)lResUltimate;
              if ((-1 < (int)lResUltimate._2_2_) &&
                 (((0 < (int)lResUltimate._2_2_ ||
                   (lVar43 = CONCAT22(lResUltimate._2_2_,(uint)lResUltimate),
                   (uint)lResUltimate != 0)) &&
                  (lVar43 = CONCAT22(lResUltimate._2_2_,(uint)lResUltimate), pl.iPlayer != -1)))) {
                uVar19 = CResourcesAtPlanet((PLANET *)CONCAT22(unaff_SS,&pl),pl.iPlayer);
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((int)uVar19 >> 0xf));
                iVar21 = (uint)lResUltimate + uVar19;
                pbVar47 = ((THING *)((int)uVar19 >> 0xf))->rgb +
                          (int)(lResUltimate._2_2_ + (CARRY2((uint)lResUltimate,uVar19) - 6));
                lBest._2_2_ = uVar19;
                uVar42 = __aFulmul(CONCAT22(lResUltimate._2_2_,(uint)lResUltimate),
                                           (long)(int)uVar19);
                lVar43 = __aFldiv(uVar42,CONCAT22(pbVar47,iVar21));
              }
              idm = ((uint)pl.wFlags >> 9 & 1) + 0x5c;
              sVar48 = 0;
              uVar42 = __aFulshr((ulong)unaff_DI << 0x10,unaff_SI);
              lResUltimate._0_2_ = (uint)lVar43;
              uVar20 = (ushort)uVar42;
              sVar44 = pl.id;
              sVar45 = (uint)lResUltimate;
              uVar42 = __aFulshr(CONCAT22((uint)lResUltimate,pl.id),uVar20);
              sVar46 = (short)uVar42;
              pTVar27 = (THING *)lpthBest;
              uVar17 = WFromLpfl(lpfl);
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,(short)(PLANET *)uStack_9e,uVar17,
                               (short)pTVar27,sVar46,sVar44,sVar45,uVar20,sVar48);
              idm = ((uint)pl.wFlags >> 9 & 1) + 0x142;
              if (((uint)pl.wFlags >> 9 & 1) == 0) {
                uStack_9e = (PLANET *)CONCAT22(uStack_9e._2_2_,pl.id);
              }
              else {
                sVar44 = ITechLearnATech
                                   (pl.iPlayer,0,0,~idmColonistsDroppedMassacredGroundTroops,
                                    (ushort *)&uStack_9e);
                if (sVar44 == 0) {
                  uStack_9e = (PLANET *)CONCAT22(uStack_9e._2_2_,pl.id);
                  iVar21 = 0;
                }
                else {
                  idm = 0x13e;
                  if (sVar44 < 0) {
                    iVar21 = -(sVar44 + 1);
                  }
                  else {
                    iVar21 = sVar44 + -1;
                    idm = 0x13f;
                  }
                }
                lpth = (THING *)CONCAT22(iVar21,(THING *)lpth);
              }
              sVar45 = lpth._2_2_;
              uVar42 = __aFulshr(CONCAT22(unaff_DI,lpth._2_2_),unaff_SI);
              uVar20 = (ushort)uVar42;
              sVar44 = pl.id;
              uVar42 = __aFulshr(CONCAT22((uint)lResUltimate,pl.id),uVar20);
              FSendPlrMsg(pl.iPlayer,idm,(short)(PLANET *)uStack_9e,lpfl->id,
                               (short)(THING *)lpthBest,(short)uVar42,sVar44,(uint)lResUltimate,
                               uVar20,sVar45);
            }
            else if (pl.id == -1) {
              lpthWP = (THING *)0x0;
              DropSalvage(&lpthWP,(long *)CONCAT22(unaff_SS,pl.rgwtMin),
                                  (uint)lpfl->id >> 9 & 0xf,&ord.pt);
              uVar20 = WFromLpfl(lpfl);
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasDismantledScrapLeftDeepSpace,-6,
                                lpthWP->idFull,uVar20);
            }
            else {
              idm = ((uint)pl.wFlags >> 9 & 1) + 0x59;
              p7 = 0;
              sVar48 = 0;
              sVar46 = 0;
              sVar44 = pl.id;
              uVar42 = __aFulshr((ulong)(uint)pl.id,0);
              sVar45 = (short)uVar42;
              pTVar27 = (THING *)lpthBest;
              uVar20 = WFromLpfl(lpfl);
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,(short)(PLANET *)uStack_9e,uVar20,
                               (short)pTVar27,sVar45,sVar44,sVar46,sVar48,p7);
              idm = ((uint)pl.wFlags >> 9 & 1) + 0x140;
              if (((uint)pl.wFlags >> 9 & 1) != 0) {
                sVar44 = ITechLearnATech
                                   (pl.iPlayer,0,0,~idmColonistsDroppedMassacredGroundTroops,
                                    (ushort *)&uStack_9e);
                lpth = (THING *)CONCAT22(sVar44,(THING *)lpth);
                if (sVar44 == 0) {
                  uStack_9e = (PLANET *)CONCAT22(uStack_9e._2_2_,pl.id);
                }
                else {
                  idm = 0x13c;
                  if (sVar44 < 0) {
                    iVar21 = -(sVar44 + 1);
                  }
                  else {
                    iVar21 = sVar44 + -1;
                    idm = 0x13d;
                  }
                  lpth = (THING *)CONCAT22(iVar21,(THING *)lpth);
                }
              }
              sVar48 = 0;
              sVar46 = 0;
              sVar44 = pl.id;
              sVar45 = lpth._2_2_;
              uVar42 = __aFulshr(CONCAT22(lpth._2_2_,pl.id),0);
              FSendPlrMsg(pl.iPlayer,idm,(short)(PLANET *)uStack_9e,lpfl->id,
                               (short)(THING *)lpthBest,(short)uVar42,sVar44,sVar45,sVar46,sVar48);
            }
            idPlayer = -1;
            gd._4_2_ = gd._4_2_ & 0xfff7;
            FRemovePlayerMessage
                      (((FLEET *)lpfl)->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000);
            uVar35 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar24 = (FLEET *)lpfl;
            pFVar24->wFlags = pFVar24->wFlags & 0xfbffU | 0x400;
            uVar34 = lpPlanets._2_2_;
            pPVar15 = (PLANET *)lpPlanets;
            if ((ord.wFlags & 0xfU) == 2) {
              FQueueColonistDrop
                        (lpfl,(PLANET *)CONCAT22(unaff_SS,&pl),
                         CONCAT22(*(undefined2 *)((int)pFVar24->rgwtMin + 0xe),
                                  (int)pFVar24->rgwtMin[3]));
            }
            else if ((pFVar24->idPlanet != -1) &&
                    (((PLANET *)lpPlanets)[pFVar24->idPlanet].iPlayer == pFVar24->iPlayer)) {
              uVar16 = *(uint *)(pFVar24->rgwtMin + 3);
              iVar21 = *(int *)((int)pFVar24->rgwtMin + 0xe);
              iVar23 = pFVar24->idPlanet;
              puVar4 = (uint *)(((PLANET *)lpPlanets)[iVar23].rgwtMin + 3);
              uVar19 = *puVar4;
              *puVar4 = *puVar4 + uVar16;
              piVar2 = (int *)((int)pPVar15[iVar23].rgwtMin + 0xe);
              *piVar2 = *piVar2 + iVar21 + (uint)CARRY2(uVar19,uVar16);
            }
          }
          else {
            FSendPlrMsg(pFVar24->iPlayer,idmHasOrdersColonizeNoneShipsHaveColonization,
                             lpfl->id | 0x8000,lpfl->id,pl.id,lpfl->id,0,0,0,0);
          }
        }
      }
    }
    goto TURN_CancelOrder;
  }
  if ((ord.wFlags & 0xfU) == 3) {
    uStack_9a = (FLEET *)0x0;
    if ((iPass == 3) && (((uint)pFVar24->wFlags >> 0xd & 1) != 0)) {
      if (pFVar24->idPlanet == -1) {
        FSendPlrMsg2(pFVar24->iPlayer,idmRemoteMiningRobotsHadOrdersMineDeep,lpfl->id | 0x8000,
                          lpfl->id,0);
      }
      else {
        uStack_9e = LpplFromId(pFVar24->idPlanet);
        if (((PLANET *)uStack_9e != (PLANET *)0x0) || ((int)((ulong)uStack_9e >> 0x10) != 0)) {
          uStack_9a = (FLEET *)CMineFromLpfl(lpfl);
          uVar34 = (undefined2)((ulong)lpfl >> 0x10);
          if (((FLEET *)uStack_9a != (FLEET *)0x0) || ((int)((ulong)uStack_9a >> 0x10) != 0)) {
            if (((PLANET *)uStack_9e)->iPlayer == -1) {
              EstMineralsMined(uStack_9e,&lBest,(long)uStack_9a,1);
            }
            else {
              sVar44 = GetRaceStat((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                         rsMajorAdv);
              if (sVar44 != 8) {
                FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmRemoteMiningRobotsHadOrdersMinePlanet,
                                  lpfl->id | 0x8000,lpfl->id,uStack_9e->id);
                goto TURN_CancelOrder;
              }
            }
            goto LAB_10b0_67b6;
          }
          FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHadOrdersMineFleetDoesntHaveAny,
                            lpfl->id | 0x8000,lpfl->id,uStack_9e->id);
        }
      }
      goto TURN_CancelOrder;
    }
  }
  else if ((ord.wFlags & 0xfU) == 8) {
    if ((pFVar24->cord == 1) && (pFVar24->idPlanet != -1)) {
      uStack_9a = (FLEET *)LpplFromId(pFVar24->idPlanet);
      uVar34 = (undefined2)((ulong)uStack_9a >> 0x10);
      if ((((FLEET *)uStack_9a)->iPlayer == ((FLEET *)lpfl)->iPlayer) &&
         (((((FLEET *)uStack_9a)->rgdv + 2)->dp & 0x3ffU) != 0)) {
        AutoRouteFleet(lpfl,(PLANET *)uStack_9a);
        uVar34 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar24 = (FLEET *)lpfl;
        if (((uint)((PLORD *)pFVar24->lpplord + 7)->wFlags >> 4 & 0xf) == 0) {
          MVar18 = idmHasReroutedUnfortuentlyDoesHaveEnoughFuel;
        }
        else {
          MVar18 = idmHasRerouted;
        }
        FSendPlrMsg(pFVar24->iPlayer,MVar18,lpfl->id | 0x8000,lpfl->id,pFVar24->idPlanet,
                         ((((FLEET *)uStack_9a)->rgdv + 2)->dp & 0x3ffU) - 1,0,0,0,0);
      }
      else if (iPass == 4) {
        AutoFleetOrder(lpfl,(PLANET *)uStack_9a);
        uVar35 = (undefined2)((ulong)lpfl >> 0x10);
        uVar34 = *(undefined2 *)((int)&((FLEET *)lpfl)->lpplord + 2);
        psVar28 = (short *)(*(int *)&((FLEET *)lpfl)->lpplord + 4);
        pOVar29 = &ord;
        for (iVar21 = 9; iVar21 != 0; iVar21 = iVar21 + -1) {
          pOVar8 = pOVar29;
          pOVar29 = (ORDER *)&(pOVar29->pt).y;
          psVar5 = psVar28;
          psVar28 = psVar28 + 1;
          (pOVar8->pt).x = *psVar5;
        }
        if ((ord.wFlags & 0xfU) == 4) goto TURN_LDoMerge;
      }
    }
  }
  else if ((ord.wFlags & 0xfU) == 4) {
    if ((iPass & 1U) == 0) {
TURN_LDoMerge:
      if (((uint)ord.wFlags >> 8 & 0xf) == 2) {
        uStack_9a = LpflFromId(ord.id);
        iVar21 = (int)((ulong)uStack_9a >> 0x10);
        pFVar24 = (FLEET *)uStack_9a;
        if (((pFVar24 != (FLEET *)0x0) || (iVar21 != 0)) && (((uint)pFVar24->wFlags >> 10 & 1) == 0)
           ) {
          if (((FLEET *)lpfl != pFVar24) || (lpfl._2_2_ != iVar21)) {
            if (pFVar24->iPlayer == ((FLEET *)lpfl)->iPlayer) {
              sVar44 = uStack_9a->id;
              uVar20 = WFromLpfl(lpfl);
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasMerged,uStack_9a->id | 0x8000,uVar20,
                                sVar44);
              FRemovePlayerMessage
                        (((FLEET *)lpfl)->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000);
              Merge2Fleets(uStack_9a,lpfl,1);
            }
            else {
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                idmUnableCompleteMergeOrdersDestinationFleetWasnt,lpfl->id | 0x8000,
                                lpfl->id,0);
            }
          }
          goto TURN_CancelOrder;
        }
      }
      FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmUnableCompleteMergeOrdersWaypointDestinationWasn
                        ,lpfl->id | 0x8000,lpfl->id,0);
      goto TURN_CancelOrder;
    }
  }
  else if ((ord.wFlags & 0xfU) == 9) {
    if (iPass == 4) {
      iplrDest = ord.txp.rgia[0].wFlags;
      if (pFVar24->iPlayer <= ord.txp.rgia[0].wFlags) {
        iplrDest = ord.txp.rgia[0].wFlags + 1;
      }
      if (((iplrDest < 0) || (game.cPlayer <= iplrDest)) ||
         ((*(uint *)((int)&rgplr[0].wFlags + iplrDest * 0xc0) & 1) != 0)) {
        FSendPlrMsg2(pFVar24->iPlayer,idmCouldntGiveAwayBecausePlayerDead,lpfl->id | 0x8000,
                          lpfl->id,0);
      }
      else {
        if ((*(uint *)((int)&rgplr[0].wMdPlr + iplrDest * 0xc0) >> 9 & 1) == 0) {
          iVar21 = iplrDest * 0xc0 + 0x5a12;
          lpshdefDest = (SHDEF *)CONCAT22(iVar21,(SHDEF *)lpshdefDest);
          if (*(char *)(iVar21 + pFVar24->iPlayer) != '\x02') {
            iVar21 = *(int *)((int)pFVar24->rgwtMin + 0xe);
            if ((iVar21 < 0) || ((iVar21 < 1 && ((int)pFVar24->rgwtMin[3] == 0)))) {
              uStack_9a = (FLEET *)CONCAT22(0xffff,(FLEET *)uStack_9a);
              ish = 0;
              while( true ) {
                if (0xf < ish) break;
                if (((FLEET *)lpfl)->rgcsh[ish] == 0) {
                  *(undefined2 *)((int)&lpthMac + ish * 2) = 0xffff;
                }
                else {
                  iVar21 = ((FLEET *)lpfl)->iPlayer * 4;
                  ishMatch = IshFindSimilarDesign
                                       ((HUL *)CONCAT22(*(undefined2 *)(iVar21 + 0x100),
                                                        (HUL *)(*(int *)(iVar21 + 0xfe) + ish * 0x93
                                                               )),iplrDest);
                  if (ishMatch == -1) {
                    do {
                      iVar21 = uStack_9a._2_2_ + 1;
                      uStack_9a = (FLEET *)CONCAT22(iVar21,(FLEET *)uStack_9a);
                      if (0xf < iVar21) break;
                    } while ((*(uint *)(*(int *)(iplrDest * 4 + 0xfe) + iVar21 * 0x93 + 0x7b) >> 9 &
                             1) == 0);
                    if (0xf < iVar21) goto TURN_SellNoCap;
                    *(int *)((int)&lpthMac + ish * 2) = iVar21;
                  }
                  else {
                    *(short *)((int)&lpthMac + ish * 2) = ishMatch;
                  }
                }
                ish = ish + 1;
              }
              if ((*(uint *)((int)&rgplr[0].wFlags + iplrDest * 0xc0) & 0xfff) < 0x200) {
                lpflNew = LpflNew(iplrDest,((FLEET *)lpfl)->idPlanet);
                iVar21 = (int)((ulong)lpflNew >> 0x10);
                pFVar24 = (FLEET *)lpflNew;
                if ((pFVar24 != (FLEET *)0x0) || (iVar21 != 0)) {
                  uVar34 = (undefined2)((ulong)lpfl >> 0x10);
                  pFVar25 = (FLEET *)lpfl;
                  if (iplrDest < pFVar25->iPlayer) {
                    ifltcur = ifltcur + 1;
                  }
                  sVar44 = (pFVar25->pt).y;
                  (&pFVar24->pt)->x = (&pFVar25->pt)->x;
                  (pFVar24->pt).y = sVar44;
                  sVar44 = (pFVar25->pt).y;
                  uVar35 = (undefined2)((ulong)pFVar24->lpplord >> 0x10);
                  pPVar26 = (PLORD *)pFVar24->lpplord;
                  (pPVar26 + 1)->wFlags = (&pFVar25->pt)->x;
                  *(short *)&pPVar26[1].iordMax = sVar44;
                  for (ish = 0; ish < 5; ish = ish + 1) {
                    uVar35 = *(undefined2 *)((int)(pFVar25->rgwtMin + ish) + 2);
                    *(int *)(pFVar24->rgwtMin + ish) = (int)pFVar25->rgwtMin[ish];
                    *(undefined2 *)((int)(pFVar24->rgwtMin + ish) + 2) = uVar35;
                  }
                  for (ish = 0; ish < 0x10; ish = ish + 1) {
                    if (0 < pFVar25->rgcsh[ish]) {
                      uVar35 = *(undefined2 *)(iplrDest * 4 + 0x100);
                      pSVar22 = (SHDEF *)(*(int *)(iplrDest * 4 + 0xfe) +
                                         *(int *)((int)&lpthMac + ish * 2) * 0x93);
                      lpshdefDest = (SHDEF *)CONCAT22(uVar35,pSVar22);
                      if (((uint)pSVar22->wFlags >> 9 & 1) != 0) {
                        iVar23 = pFVar25->iPlayer * 4;
                        uVar11 = *(undefined2 *)(iVar23 + 0x100);
                        pHVar31 = (HullDef *)(*(int *)(iVar23 + 0xfe) + ish * 0x93);
                        pSVar33 = pSVar22;
                        for (iVar23 = 0x49; iVar23 != 0; iVar23 = iVar23 + -1) {
                          pSVar10 = pSVar33;
                          pSVar33 = (SHDEF *)(pSVar33->hul).rgTech;
                          pHVar7 = pHVar31;
                          pHVar31 = pHVar31 + 1;
                          (pSVar10->hul).ihuldef = *pHVar7;
                        }
                        *(char *)&(pSVar33->hul).ihuldef = (char)*pHVar31;
                        auStack_140._120_2_ = *(uint *)((int)&lpthMac + ish * 2);
                        pSVar22->wFlags =
                             pSVar22->wFlags & 0x83ffU | (auStack_140._120_2_ & 0x1f) << 10;
                        pSVar22->wFlags = pSVar22->wFlags & 0x7fffU | 0x8000;
                        *(undefined2 *)&pSVar22->cBuilt = 0;
                        *(undefined2 *)((int)&pSVar22->cBuilt + 2) = 0;
                        *(undefined2 *)&pSVar22->cExist = 0;
                        *(undefined2 *)((int)&pSVar22->cExist + 2) = 0;
                        pcVar1 = (char *)((int)&rgplr[0].cShDef + iplrDest * 0xc0);
                        *pcVar1 = *pcVar1 + '\x01';
                      }
                      pFVar24->rgcsh[*(int *)((int)&lpthMac + ish * 2)] =
                           pFVar24->rgcsh[*(int *)((int)&lpthMac + ish * 2)] + pFVar25->rgcsh[ish];
                      (pFVar24->rgdv + *(int *)((int)&lpthMac + ish * 2))->dp =
                           (pFVar25->rgdv + ish)->dp;
                      uVar16 = pFVar25->rgcsh[ish];
                      puVar4 = (uint *)&pSVar22->cBuilt;
                      uVar19 = *puVar4;
                      *puVar4 = *puVar4 + uVar16;
                      piVar2 = (int *)((int)&pSVar22->cBuilt + 2);
                      *piVar2 = *piVar2 + ((int)uVar16 >> 0xf) + (uint)CARRY2(uVar19,uVar16);
                      uVar16 = pFVar25->rgcsh[ish];
                      puVar4 = (uint *)&pSVar22->cExist;
                      uVar19 = *puVar4;
                      *puVar4 = *puVar4 + uVar16;
                      piVar2 = (int *)((int)&pSVar22->cExist + 2);
                      *piVar2 = *piVar2 + ((int)uVar16 >> 0xf) + (uint)CARRY2(uVar19,uVar16);
                    }
                  }
                  pFVar25->wFlags = pFVar25->wFlags & 0xfbffU | 0x400;
                  uVar19 = iplrDest | 0x30;
                  uVar20 = WFromLpfl(lpfl);
                  FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasSuccessfullyGiven,
                                    lpflNew->id | 0x8000,uVar20,uVar19);
                  uVar20 = WFromLpfl(lpflNew);
                  FSendPlrMsg2(iplrDest,idmHaveGiven,lpflNew->id | 0x8000,
                                    ((FLEET *)lpfl)->iPlayer | 0x30,uVar20);
                  uVar34 = (undefined2)((ulong)lpfl >> 0x10);
                  ((FLEET *)lpfl)->wFlags = ((FLEET *)lpfl)->wFlags & 0xfbffU | 0x400;
                  goto LAB_10b0_67b6;
                }
              }
TURN_SellNoCap:
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                idmCouldntGiveAwayBecauseDidntHaveAdministrative,lpfl->id | 0x8000,
                                lpfl->id,iplrDest | 0x30);
              FSendPlrMsg2(iplrDest,idmAttemptedGiveFleetDontHaveEnoughExcess,-1,
                                ((FLEET *)lpfl)->iPlayer | 0x30,0);
            }
            else {
              FSendPlrMsg2(pFVar24->iPlayer,idmCouldntGiveAwayBecauseThereColonistsBoard,
                                lpfl->id | 0x8000,lpfl->id,0);
            }
            goto TURN_CancelOrder;
          }
        }
        FSendPlrMsg2(pFVar24->iPlayer,idmSnubAttemptedGiftRefuseFleet,lpfl->id | 0x8000,
                          iplrDest | 0x30,0);
      }
      goto TURN_CancelOrder;
    }
  }
  else if ((ord.wFlags & 0xfU) == 6) {
LAB_10b0_999e:
    idm = 0xc3;
    if (iPass == 3) {
      uVar34 = (undefined2)((ulong)lpfl >> 0x10);
      if (((uint)((FLEET *)lpfl)->wFlags >> 0xd & 1) == 0) {
        sVar44 = GetRaceStat((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,rsMajorAdv);
        if (sVar44 != 5) goto LAB_10b0_67b6;
      }
      cMine_2 = CLayMinesFromLpfl(lpfl,-1,-1);
      pFVar24 = (FLEET *)lpfl;
      uVar34 = (undefined2)((ulong)lpfl >> 0x10);
      if (((int)cMine_2 == 0) && ((int)((ulong)cMine_2 >> 0x10) == 0)) {
        FSendPlrMsg2(pFVar24->iPlayer,idmHasAttemptedLayMinesOrderHasCanceled,lpfl->id | 0x8000
                          ,lpfl->id,0);
        goto TURN_CancelOrder;
      }
      if ((ord.wFlags & 0xfU) == 6) {
        if (((PLORD *)pFVar24->lpplord + 3)->wFlags == 0) {
          *(uint *)&((PLORD *)pFVar24->lpplord)[2].iordMax =
               *(uint *)&((PLORD *)pFVar24->lpplord)[2].iordMax & 0xfff0;
        }
        else if (((PLORD *)pFVar24->lpplord + 3)->wFlags != 5) {
          pPVar3 = (PLORD *)pFVar24->lpplord + 3;
          pPVar3->wFlags = pPVar3->wFlags + -1;
        }
      }
      for (j = 0; j < 3; j = j + 1) {
        cMine_2 = CLayMinesFromLpfl(lpfl,j,-1);
        if (((int)cMine_2 != 0) || ((int)((ulong)cMine_2 >> 0x10) != 0)) {
          if (((uint)((FLEET *)lpfl)->wFlags >> 0xd & 1) == 0) {
            cMine_2 = __aFldiv(cMine_2,2);
          }
          lpthBest = (THING *)0x0;
          lBest = 10000000;
          lpthMac._2_2_ = (THING *)lpThings;
          uStack_b4 = lpThings._2_2_;
          lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
          uStack_9a = (FLEET *)CONCAT22(lpThings._2_2_,
                                        (FLEET *)((THING *)lpThings + cThing));
          while( true ) {
            pFVar24 = (FLEET *)lpfl;
            uVar34 = (undefined2)((ulong)lpfl >> 0x10);
            if ((FLEET *)uStack_9a <= (THING *)lpth) break;
            if (((((uint)lpth->idFull >> 9 & 0xf) == pFVar24->iPlayer) &&
                ((uint)lpth->idFull >> 0xd == 0)) &&
               (uVar35 = (undefined2)((ulong)lpth >> 0x10), (uint)((THING *)lpth)->rgb[6] == j)) {
              dx._0_2_ = (&pFVar24->pt)->x - (&((THING *)lpth)->pt)->x;
              dx._2_2_ = (int)dx >> 0xf;
              iVar21 = (pFVar24->pt).y - (((THING *)lpth)->pt).y;
              uStack_9e = (PLANET *)(long)iVar21;
              pTVar41 = (THING *)__aFulmul((long)iVar21,(long)iVar21);
              uStack_b4 = (undefined2)((ulong)pTVar41 >> 0x10);
              lpthMac._2_2_ = (THING *)pTVar41;
              uVar42 = __aFulmul(CONCAT22(dx._2_2_,(int)dx),CONCAT22(dx._2_2_,(int)dx));
              l = (long)(((THING *)CONCAT22(uStack_b4,lpthMac._2_2_))->rgb + (uVar42 - 6));
              iVar23 = (int)((ulong)l >> 0x10);
              uVar34 = (undefined2)((ulong)lpth >> 0x10);
              iVar21 = *(int *)(((THING *)lpth)->rgb + 2);
              if (((iVar23 <= iVar21) &&
                  ((iVar23 < iVar21 || ((uint)l <= *(uint *)((THING *)lpth)->rgb)))) && (l < lBest))
              {
                lpthBest = lpth;
                lBest = l;
              }
            }
            lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
          }
          if ((((THING *)lpthBest == (THING *)0x0) && (lpthBest._2_2_ == 0)) ||
             ((0xf < *(int *)(((THING *)lpthBest)->rgb + 2) ||
              ((0xe < *(int *)(((THING *)lpthBest)->rgb + 2) &&
               (0x423f < *(uint *)((THING *)lpthBest)->rgb)))))) {
            lpth = LpthNew(pFVar24->iPlayer,ithMinefield);
            iVar21 = (int)((ulong)lpth >> 0x10);
            pTVar27 = (THING *)lpth;
            pFVar24 = (FLEET *)lpfl;
            uVar34 = (undefined2)((ulong)lpfl >> 0x10);
            if ((pTVar27 == (THING *)0x0) && (iVar21 == 0)) {
              FSendPlrMsg2(pFVar24->iPlayer,idmFailedLayMinesYearDueTechnicalDifficulties,
                                lpfl->id | 0x8000,lpfl->id,0);
              goto LAB_10b0_9ea2;
            }
            sVar44 = (pFVar24->pt).y;
            (&pTVar27->pt)->x = (&pFVar24->pt)->x;
            (pTVar27->pt).y = sVar44;
            *(uint *)pTVar27->rgb = (uint)cMine_2;
            *(int *)(pTVar27->rgb + 2) = cMine_2._2_2_;
            pTVar27->rgb[6] = (byte)j;
          }
          else {
            iVar21 = (uint)cMine_2 + *(uint *)((THING *)lpthBest)->rgb;
            iVar23 = cMine_2._2_2_ + *(int *)(((THING *)lpthBest)->rgb + 2) +
                     (uint)CARRY2((uint)cMine_2,*(uint *)((THING *)lpthBest)->rgb);
            uVar42 = __aFulmul((long)(&pFVar24->pt)->x,cMine_2);
            uStack_b4 = (undefined2)(uVar42 >> 0x10);
            lpthMac._2_2_ = (THING *)uVar42;
            uVar34 = (undefined2)((ulong)lpthBest >> 0x10);
            pTVar27 = (THING *)lpthBest;
            uVar42 = __aFulmul((long)(&pTVar27->pt)->x,
                                       CONCAT22(*(undefined2 *)(pTVar27->rgb + 2),
                                                *(undefined2 *)pTVar27->rgb));
            lVar43 = __aFldiv(uVar42 + CONCAT22(uStack_b4,lpthMac._2_2_),
                                      CONCAT22(iVar23,iVar21));
            uVar34 = (undefined2)((ulong)lpthBest >> 0x10);
            pTVar27 = (THING *)lpthBest;
            (&pTVar27->pt)->x = (short)lVar43;
            iVar21 = (uint)cMine_2 + *(uint *)pTVar27->rgb;
            iVar23 = cMine_2._2_2_ + *(int *)(pTVar27->rgb + 2) +
                     (uint)CARRY2((uint)cMine_2,*(uint *)pTVar27->rgb);
            pTVar41 = (THING *)__aFulmul((long)(((FLEET *)lpfl)->pt).y,cMine_2);
            uStack_b4 = (undefined2)((ulong)pTVar41 >> 0x10);
            lpthMac._2_2_ = (THING *)pTVar41;
            uVar34 = (undefined2)((ulong)lpthBest >> 0x10);
            pTVar27 = (THING *)lpthBest;
            uVar42 = __aFulmul((long)(pTVar27->pt).y,
                                       CONCAT22(*(undefined2 *)(pTVar27->rgb + 2),
                                                *(undefined2 *)pTVar27->rgb));
            lVar43 = __aFldiv((long)(((THING *)CONCAT22(uStack_b4,lpthMac._2_2_))->rgb +
                                            (uVar42 - 6)),CONCAT22(iVar23,iVar21));
            uVar34 = (undefined2)((ulong)lpthBest >> 0x10);
            pTVar27 = (THING *)lpthBest;
            (pTVar27->pt).y = (short)lVar43;
            puVar4 = (uint *)pTVar27->rgb;
            uVar19 = *puVar4;
            *puVar4 = *puVar4 + (uint)cMine_2;
            *(uint *)(pTVar27->rgb + 2) =
                 *(int *)(pTVar27->rgb + 2) + cMine_2._2_2_ + (uint)CARRY2(uVar19,(uint)cMine_2);
            idm = 0xc4;
          }
          sVar48 = 0;
          sVar46 = 0;
          sVar45 = 0;
          sVar44 = 0;
          uVar42 = __aFulshr(0,0);
          FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,(uint)cMine_2,
                           (short)uVar42,sVar44,sVar45,sVar46,sVar48);
        }
LAB_10b0_9ea2:
      }
    }
  }
  else if (((ord.wFlags & 0xfU) == 0) && (1 < pFVar24->cord)) {
    sVar44 = GetRaceStat((PLAYER *)rgplr + pFVar24->iPlayer,rsMajorAdv);
    if ((sVar44 == 5) &&
       (pPVar3 = ((FLEET *)lpfl)->lpplord, (((PLORD *)pPVar3 + 7)->wFlags & 0xfU) == 6))
    goto LAB_10b0_999e;
  }
  goto LAB_10b0_67b6;
LAB_10b0_80f5:
  if ((fDone == 0) || (iLoad == 0)) {
    if (fMining == 2) {
      ord.id = pl.id;
      ord.wFlags = ord.wFlags & 0xf0ffU | 0x100;
    }
    uVar35 = (undefined2)((ulong)lpfl >> 0x10);
    uVar34 = *(undefined2 *)((int)&((FLEET *)lpfl)->lpplord + 2);
    psVar28 = (short *)(*(int *)&((FLEET *)lpfl)->lpplord + 4);
    pOVar29 = &ord;
    for (iVar21 = 9; iVar21 != 0; iVar21 = iVar21 + -1) {
      psVar5 = psVar28;
      psVar28 = psVar28 + 1;
      pOVar8 = pOVar29;
      pOVar29 = (ORDER *)&(pOVar29->pt).y;
      *psVar5 = (pOVar8->pt).x;
    }
  }
  else {
TURN_CancelOrder:
    uVar34 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar24 = (FLEET *)lpfl;
    if (((pFVar24->cord == 1) && (((uint)pFVar24->wFlags >> 10 & 1) == 0)) &&
       ((*(uint *)&((PLORD *)pFVar24->lpplord)[2].iordMax & 0xf) != 0)) {
      FRemovePlayerMessage(pFVar24->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000);
      FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000,
                        lpfl->id,0);
    }
    uVar34 = (undefined2)((ulong)lpfl >> 0x10);
    pPVar3 = ((FLEET *)lpfl)->lpplord;
    pPVar12 = ((FLEET *)lpfl)->lpplord;
    *(uint *)&((PLORD *)pPVar12)[2].iordMax = *(uint *)&((PLORD *)pPVar3)[2].iordMax & 0xfff0;
  }
LAB_10b0_67b6:
  ifltcur = ifltcur + 1;
  goto LAB_10b0_67ba;
}



