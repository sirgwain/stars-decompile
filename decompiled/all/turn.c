// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: FGenerateTurn
// Address: 10b0:0000
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Restarted to delay deadcode elimination for space: ram */

short FGenerateTurn(void)

{
  TURNSERIAL *pTVar1;
  char *pcVar2;
  undefined2 *puVar3;
  undefined2 *puVar4;
  byte bVar5;
  byte *pbVar6;
  byte *pbVar7;
  ulong uVar8;
  ushort *puVar9;
  COLDROP *pCVar10;
  XFERFULL *pXVar11;
  HCURSOR HVar12;
  short sVar13;
  char *sz;
  ushort uVar14;
  uint uVar15;
  int iVar16;
  TURNSERIAL *pTVar17;
  FLEET *pFVar18;
  FLEET *pFVar19;
  int iVar20;
  undefined2 *puVar21;
  undefined2 *puVar22;
  undefined2 uVar23;
  undefined2 uVar24;
  undefined2 uVar25;
  undefined2 unaff_SS;
  PL *pPVar26;
  FLEET *pFVar27;
  undefined4 in_stack_0000fe96;
  uint in_stack_0000fe9a;
  short pctDetect;
  short iSteal;
  undefined4 j;
  short fDone;
  short fSuccess;
  char *pchBak;
  short fFollow;
  short idCur;
  HCURSOR hcurSav;
  char szT [256];
  undefined1 env [18];
  short i;
  char *pchCur;
  FLEET *lpfl;
  short ifl;
  undefined1 *penvMemSav;
  char rgfNoXFile [16];
  byte mpiplr2 [16];
  short j__12;
  short ish;
  char *pchT;
  short fErrSav;
  
                    /* Segment:    23
                       Offset:     0009e840
                       Length:     9eb8
                       Min Alloc:  9eb8
                       Flags:      1d10
                           Code
                           Discardable
                           Moveable
                           LoadOnCall
                           Impure (Non-shareable)
                        */
  idCur = idPlayer;
  fSuccess = 0;
  HVar12 = LoadCursor(0,&DAT_0000_7f02);
  hcurSav = setcursor(HVar12);
  DestroyCurGame();
  if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
    Randomize(0x499602d2);
  }
  fErrSav = fFileErrSilent;
  fFileErrSilent = 1;
  UpdateProgressGauge(0x168);
  sVar13 = FLoadGame((char *)szBase,(char *)0x9c4);
  if (sVar13 == 0) {
    fFileErrSilent = fErrSav;
    setcursor(hcurSav);
    TurnLog(idsCantFindHostFile);
    pXVar11 = (XFERFULL *)CONCAT22(lpxf._2_2_,(XFERFULL *)lpxf);
    pCVar10 = (COLDROP *)CONCAT22(lpcd._2_2_,(COLDROP *)lpcd);
    puVar9 = (ushort *)CONCAT22(vrgPlanResExtra._2_2_,(ushort *)vrgPlanResExtra);
    pTVar1 = (TURNSERIAL *)CONCAT22(vrgts._2_2_,(TURNSERIAL *)vrgts);
    fSuccess = 0;
  }
  else {
    TurnLog(idsGeneratingYearD);
    fFileErrSilent = fErrSav;
    if (wVersFile >> 0xc == 0) {
      i = 0;
      while ((i < game.cPlayer &&
             ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 3 & 0x1f) == 0))) {
        i = i + 1;
      }
      if (i == game.cPlayer) {
        for (i = 0; i < game.cPlayer; i = i + 1) {
          uVar15 = (i & 0x1fU) << 3;
          pFVar19 = (FLEET *)(*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xff07 |
                             uVar15);
          j = (FLEET *)CONCAT22(uVar15,pFVar19);
          *(undefined2 *)((int)&rgplr[0].wMdPlr + i * 0xc0) = pFVar19;
        }
      }
    }
    penvMemSav = penvMem;
    penvMem = env;
    sVar13 = __setjmp(env);
    if (sVar13 == 0) {
      lpcd = LpAlloc(12000,htMisc);
      lpxf = LpAlloc(25000,htMisc);
      vrgPlanResExtra = LpAlloc(game.cPlanMax << 1,htMisc);
      __fmemset(vrgPlanResExtra,0,game.cPlanMax << 1);
      vrgts = LpAlloc(game.cPlayer << 4,htMisc);
      UpdateProgressGauge(0x172);
      cColDrop = 0;
      cXferFull = 0;
      gd._0_2_ = gd._0_2_ & 0xfdfd | 0x202;
      imemMsgCur = 0;
      for (i = 0; i < game.cPlayer; i = i + 1) {
        mpiplr2[i] = (byte)i;
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        sVar13 = Random(game.cPlayer - i);
        j__12 = sVar13 + i;
        if (j__12 != i) {
          bVar5 = mpiplr2[j__12];
          idCur = (short)bVar5;
          mpiplr2[j__12] = mpiplr2[i];
          mpiplr2[i] = bVar5;
        }
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        j__12 = (short)mpiplr2[i];
        wsprintf(szWork,(char *)0x112009c8,(char *)szBase,0x1120,j__12 + 1);
        uVar23 = vrgts._2_2_;
        idPlayer = j__12;
        pTVar17 = (TURNSERIAL *)vrgts + j__12;
        *(undefined2 *)&pTVar17->lSerialNumber = 0xffff;
        *(undefined2 *)((int)&pTVar17->lSerialNumber + 2) = 0xffff;
        sVar13 = FLoadLogFile((char *)szWork);
        if (sVar13 != 0) {
          sVar13 = FRunLogFile();
          if (sVar13 == 0) {
            sVar13 = 0x10;
            sz = PszFormatIds(idsPlayerLogFileAppearsCorruptUnableLoad,(short *)0x0);
            AlertSz(sz,sVar13);
            goto TURN_FreeStuffUp;
          }
        }
        sVar13 = MulDiv(0x3c,i + 1,game.cPlayer);
        in_stack_0000fe9a = sVar13 + 0x172;
        in_stack_0000fe96 = 0x14f803af;
        UpdateProgressGauge(in_stack_0000fe9a);
      }
      idPlayer = -1;
      i = 0;
      pTVar1 = vrgts;
      while( true ) {
        vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
        vrgts._0_2_ = (TURNSERIAL *)pTVar1;
        if (game.cPlayer <= i) break;
        vrgts = pTVar1;
        if ((((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 1 & 1) == 0) &&
            ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0)) &&
           ((((uint)gd._0_2_ >> 0xb & 1) == 0 || (i != 0)))) {
          if (((int)((TURNSERIAL *)vrgts + i)->lSerialNumber != -1) ||
             (*(int *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2) != -1)) {
            pTVar1 = (TURNSERIAL *)vrgts + i;
            puVar3 = (undefined2 *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2);
            sVar13 = FValidSerialLong(CONCAT22(*puVar3,(int)pTVar1->lSerialNumber));
            pTVar1 = vrgts;
            if (sVar13 == 0) {
              j = (FLEET *)((ulong)CONCAT22(*(undefined2 *)
                                             ((int)&rgplr[0].wFlags + i * 0xc0),(FLEET *)j
                                           ) & 0xfffbffff | 0x40000);
              *(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0) = j._2_2_;
              pTVar1 = vrgts;
              goto LAB_10b0_03c3;
            }
          }
          vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
          vrgts._0_2_ = (TURNSERIAL *)pTVar1;
          if (((int)((TURNSERIAL *)vrgts + i)->lSerialNumber != -1) ||
             (*(int *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2) != -1)) {
            j = (FLEET *)((ulong)CONCAT22(*(undefined2 *)
                                           ((int)&rgplr[0].wFlags + i * 0xc0),(FLEET *)j)
                         & 0xfffbffff);
            vrgts = pTVar1;
            *(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0) = j._2_2_;
            j__12 = 0;
            pTVar1 = vrgts;
            while( true ) {
              vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
              vrgts._0_2_ = (TURNSERIAL *)pTVar1;
              if (i <= j__12) break;
              if (((*(uint *)((int)&rgplr[0].wFlags + j__12 * 0xc0) >> 1 & 1) == 0) &&
                 ((*(uint *)((int)&rgplr[0].wMdPlr + j__12 * 0xc0) >> 9 & 1) == 0)) {
                if (((int)((TURNSERIAL *)vrgts + i)->lSerialNumber ==
                     (int)((TURNSERIAL *)vrgts + j__12)->lSerialNumber) &&
                   (*(int *)((int)&((TURNSERIAL *)vrgts)[i].lSerialNumber + 2) ==
                    *(int *)((int)&((TURNSERIAL *)vrgts)[j__12].lSerialNumber + 2))) {
                  pbVar6 = (byte *)CONCAT22(vrgts._2_2_,
                                            ((TURNSERIAL *)vrgts)[i].rgbConfig);
                  pbVar7 = (byte *)CONCAT22(vrgts._2_2_,
                                            ((TURNSERIAL *)vrgts)[j__12].rgbConfig);
                  vrgts = pTVar1;
                  sVar13 = __fmemcmp(pbVar6,pbVar7,0xb);
                  pTVar1 = vrgts;
                  if (sVar13 != 0) {
                    pFVar19 = (FLEET *)(*(uint *)((int)&rgplr[0].wFlags + j__12 * 0xc0) &
                                        0xfffb | 4);
                    *(undefined2 *)((int)&rgplr[0].wFlags + j__12 * 0xc0) = pFVar19;
                    j = (FLEET *)CONCAT22(1,pFVar19);
                    iSteal = 4;
                    pctDetect = *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xfffb | 4;
                    *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) = pctDetect;
                    pTVar1 = vrgts;
                  }
                }
              }
              j__12 = j__12 + 1;
            }
          }
        }
        else {
          j = (FLEET *)((ulong)CONCAT22(*(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0),
                                        (FLEET *)j) & 0xfffbffff);
          *(undefined2 *)((int)&rgplr[0].wFlags + i * 0xc0) = j._2_2_;
          pTVar1 = vrgts;
        }
LAB_10b0_03c3:
        i = i + 1;
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        if ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 2 & 1) != 0) {
          vrgts = pTVar1;
          j__12 = IPlrAlsoCheater(i);
          FSendPlrMsg2(i,(j__12 != -1) + idmPopulationSuspectsUsurperProductivityOff20Growth,-5
                            ,j__12,0);
          pTVar1 = vrgts;
          if ((10 < (uint)game.turn) && ((game.turn & 7U) == (i & 7U))) {
            FSendPlrMsg2(i,idmFleetCaptainsHaveStagedStrikeDemandFree,-5,0,0);
            pTVar1 = vrgts;
          }
        }
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        for (ish = 0; ish < 0x10; ish = ish + 1) {
          if (((*(uint *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x7b) >> 9 & 1) == 0) &&
             (*(int *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3a) != 1)) {
            vrgts = pTVar1;
            *(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3a) = 1;
            uVar8 = (ulong)CONCAT22(*(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c),
                                    (FLEET *)j) & 0xff00ffff;
            j = (FLEET *)(uVar8 | 0x10000);
            *(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c) = j._2_2_;
            pTVar1 = vrgts;
            if (*(uint *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c) >> 8 == 0) {
              j._0_2_ = (FLEET *)uVar8;
              j = (FLEET *)(CONCAT22(*(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c),
                                     (FLEET *)j) & 0xffffff | 0x1000000);
              *(undefined2 *)(*(int *)(i * 4 + 0xfe) + ish * 0x93 + 0x3c) = j._2_2_;
              pTVar1 = vrgts;
            }
          }
        }
      }
      fFollow = 0;
      for (ifl = 0; vrgts = pTVar1, ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar19 = ((FLEET **)rglpfl)[ifl];
        iVar16 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar16,pFVar19);
        if ((pFVar19 == (FLEET *)0x0) && (iVar16 == 0)) break;
        pFVar19->wFlags = pFVar19->wFlags & 0xbfff;
        if ((pFVar19->cord == 1) &&
           ((*(uint *)&((PLORD *)pFVar19->lpplord)[2].iordMax >> 8 & 0xf) == 2)) {
          fFollow = 1;
          pFVar19->wFlags = pFVar19->wFlags & 0x7fffU | 0x8000;
          pTVar1 = vrgts;
        }
        else {
          if (((*(uint *)&((PLORD *)pFVar19->lpplord)[2].iordMax >> 8 & 0xf) == 2) &&
             (pFVar19->cord == 1)) {
            FSendPlrMsg(pFVar19->iPlayer,idmHadOrdersFollowFleetWhichDidntMove,
                             lpfl->id | 0x8000,lpfl->id,0,0,0,0,0,0);
          }
          uVar23 = (undefined2)((ulong)lpfl >> 0x10);
          ((FLEET *)lpfl)->wFlags = ((FLEET *)lpfl)->wFlags & 0x7fff;
          pTVar1 = vrgts;
        }
      }
      ValidateWaypoints();
      if (fFollow != 0) {
        fFollow = 1;
        i = 0;
        while ((i < 8 && (fFollow != 0))) {
          fFollow = 0;
          for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
            pFVar19 = ((FLEET **)rglpfl)[ifl];
            iVar16 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
            lpfl = (FLEET *)CONCAT22(iVar16,pFVar19);
            if ((pFVar19 == (FLEET *)0x0) && (iVar16 == 0)) break;
            if ((pFVar19->wFlags < 0) && (pFVar19->cord == 1)) {
              uVar23 = *(undefined2 *)((int)&pFVar19->lpplord + 2);
              puVar21 = (undefined2 *)(*(int *)&pFVar19->lpplord + 4);
              puVar22 = (undefined2 *)&stack0xfe94;
              for (iVar16 = 9; iVar16 != 0; iVar16 = iVar16 + -1) {
                puVar4 = puVar22;
                puVar22 = puVar22 + 1;
                puVar3 = puVar21;
                puVar21 = puVar21 + 1;
                *puVar4 = *puVar3;
              }
              if ((in_stack_0000fe9a >> 8 & 0xf) == 2) {
                j = LpflFromId((short)((ulong)in_stack_0000fe96 >> 0x10));
                iVar16 = (int)((ulong)j >> 0x10);
                pFVar19 = (FLEET *)j;
                pFVar18 = (FLEET *)lpfl;
                uVar23 = (undefined2)((ulong)lpfl >> 0x10);
                if (((pFVar19 != (FLEET *)0x0) || (iVar16 != 0)) &&
                   ((pFVar19->cord != 1 ||
                    ((*(uint *)&((PLORD *)pFVar19->lpplord)[2].iordMax >> 8 & 0xf) == 2)))) {
                  if (pFVar19->cord != 1) {
                    fFollow = 1;
                    if (((PLORD *)pFVar18->lpplord)->iordMax < 2) {
                      pPVar26 = LpplReAlloc((PL *)CONCAT22(*(undefined2 *)
                                                                    ((int)&pFVar18->lpplord + 2),
                                                                   *(PL **)&pFVar18->lpplord),2);
                      uVar23 = (undefined2)((ulong)lpfl >> 0x10);
                      *(PL **)&((FLEET *)lpfl)->lpplord = (PL *)pPVar26;
                      *(undefined2 *)((int)&((FLEET *)lpfl)->lpplord + 2) =
                           (int)((ulong)pPVar26 >> 0x10);
                    }
                    uVar24 = (undefined2)((ulong)j >> 0x10);
                    uVar23 = *(undefined2 *)((int)&((FLEET *)j)->lpplord + 2);
                    puVar22 = (undefined2 *)(*(int *)&((FLEET *)j)->lpplord + 0x16);
                    uVar25 = (undefined2)((ulong)lpfl >> 0x10);
                    pFVar19 = (FLEET *)lpfl;
                    uVar24 = *(undefined2 *)((int)&pFVar19->lpplord + 2);
                    puVar21 = (undefined2 *)(*(int *)&pFVar19->lpplord + 0x16);
                    for (iVar16 = 9; iVar16 != 0; iVar16 = iVar16 + -1) {
                      puVar4 = puVar21;
                      puVar21 = puVar21 + 1;
                      puVar3 = puVar22;
                      puVar22 = puVar22 + 1;
                      *puVar4 = *puVar3;
                    }
                    uVar23 = *(undefined2 *)((int)&pFVar19->lpplord + 2);
                    puVar22 = (undefined2 *)(*(int *)&pFVar19->lpplord + 0xc);
                    uVar24 = *(undefined2 *)((int)&pFVar19->lpplord + 2);
                    puVar21 = (undefined2 *)(*(int *)&pFVar19->lpplord + 0x1e);
                    for (iVar16 = 5; iVar16 != 0; iVar16 = iVar16 + -1) {
                      puVar4 = puVar21;
                      puVar21 = puVar21 + 1;
                      puVar3 = puVar22;
                      puVar22 = puVar22 + 1;
                      *puVar4 = *puVar3;
                    }
                    pFVar19->cord = 2;
                    ((PLORD *)pFVar19->lpplord)->iordMac = 2;
                  }
                  goto LAB_10b0_09f2;
                }
                FSendPlrMsg(pFVar18->iPlayer,idmHadOrdersFollowFleetWhichDidntMove,
                                 lpfl->id | 0x8000,lpfl->id,0,0,0,0,0,0);
              }
              uVar23 = (undefined2)((ulong)lpfl >> 0x10);
              ((FLEET *)lpfl)->wFlags = ((FLEET *)lpfl)->wFlags & 0x7fff;
            }
LAB_10b0_09f2:
          }
          i = i + 1;
        }
      }
      UpdateProgressGauge(0x1b8);
      DoOrders(0);
      UpdateProgressGauge(0x212);
      for (i = 0; i < game.cPlayer; i = i + 1) {
        j = (FLEET *)((ulong)j & 0xffff0000);
        while ((int)(FLEET *)j < 0x10) {
          sVar13 = GetRaceStat((PLAYER *)rgplr + i,(RaceStat)(FLEET *)j);
          SetRaceStat((PLAYER *)rgplr + i,(RaceStat)(FLEET *)j,sVar13);
          j = (FLEET *)CONCAT22(j._2_2_,(int)(FLEET *)j + 1);
        }
        if ((*(char *)((int)&rgplr[0].pctResearch + i * 0xc0) < '\0') ||
           ('d' < *(char *)((int)&rgplr[0].pctResearch + i * 0xc0))) {
          *(undefined1 *)((int)&rgplr[0].pctResearch + i * 0xc0) = 0xf;
        }
        if (*(char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0) < '\0') {
          *(undefined1 *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0) = 1;
        }
        if ('\x14' < *(char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0)) {
          *(undefined1 *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0) = 0x14;
        }
        j = (FLEET *)(CONCAT22(j._2_2_,*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 4) &
                     0xffff0001);
        sVar13 = CAdvantagePoints((PLAYER *)rgplr + i);
        j = (FLEET *)CONCAT22(sVar13,(FLEET *)j);
        pFVar27 = j;
        if (((sVar13 < 0) ||
            ((FLEET *)j != (FLEET *)(*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) >> 4 & 1)
            )) && ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0)) {
          FSendPlrMsg2(i,idmRaceDefinitionHasTamperedStatisticsHaveAltered,-1,0,0);
          j = (FLEET *)((ulong)j & 0xffff0000);
          while ((int)(FLEET *)j < game.cPlayer) {
            if (((FLEET *)i != (FLEET *)j) &&
               ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0)) {
              FSendPlrMsg2((short)(FLEET *)j,idmHackedRaceDiscoveredRaceStatisticsHaveAltered,
                                -1,i,0);
            }
            j = (FLEET *)CONCAT22(j._2_2_,(FLEET *)((int)&((FLEET *)j)->id + 1));
          }
          iSteal = *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xffef | 0x10;
          *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) = iSteal;
          pFVar27 = j;
          iVar16 = j._2_2_;
          while ((iVar16 < 500 && (*(char *)((int)rgplr[0].rgAttr + i * 0xc0) < '\x19')))
          {
            pcVar2 = (char *)((int)rgplr[0].rgAttr + i * 0xc0);
            *pcVar2 = *pcVar2 + '\x01';
            j = pFVar27;
            iVar16 = CAdvantagePoints((PLAYER *)rgplr + i);
            j = (FLEET *)CONCAT22(iVar16,(FLEET *)j);
            pFVar27 = j;
          }
          j._2_2_ = (short)((ulong)pFVar27 >> 0x10);
          iVar16 = j._2_2_;
          while ((iVar16 < 500 &&
                 ('\x01' < *(char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0)))) {
            pcVar2 = (char *)((int)&rgplr[0].pctIdealGrowth + i * 0xc0);
            *pcVar2 = *pcVar2 + -1;
            j = pFVar27;
            iVar16 = CAdvantagePoints((PLAYER *)rgplr + i);
            j = (FLEET *)CONCAT22(iVar16,(FLEET *)j);
            pFVar27 = j;
          }
          j._2_2_ = (short)((ulong)pFVar27 >> 0x10);
          if (j._2_2_ < 500) {
            j = (FLEET *)CONCAT22(j._2_2_,(FLEET *)0x8);
            while (pFVar27 = j, (int)(FLEET *)j < 0xe) {
              *(undefined1 *)(i * 0xc0 + 0x59e0 + (int)(FLEET *)j) = 0;
              sVar13 = CAdvantagePoints((PLAYER *)rgplr + i);
              j = (FLEET *)CONCAT22(sVar13,(FLEET *)j);
              pFVar27 = j;
              if (499 < sVar13) break;
              j = (FLEET *)CONCAT22(sVar13,(FLEET *)((int)&((FLEET *)j)->id + 1));
            }
          }
        }
        j = pFVar27;
      }
      UnmarkMineFields();
      MoveThings(0);
      UpdateProgressGauge(0x226);
      MoveFleets();
      sVar13 = lpPlanets._2_2_;
      iSteal = lpPlanets._2_2_;
      pctDetect = (short)((PLANET *)lpPlanets + cPlanet);
      for (j._0_2_ = (FLEET *)(PLANET *)lpPlanets; (FLEET *)j < (uint)pctDetect;
          j._0_2_ = (FLEET *)(((FLEET *)j)->rgdv + 6)) {
        ((FLEET *)j)->wFlags = ((FLEET *)j)->wFlags & 0xfbff;
      }
      for (i = 0; i < game.cPlayer; i = i + 1) {
        ((PLANET *)lpPlanets)[*(int *)((int)&rgplr[0].idPlanetHome + i * 0xc0)].
        wFlags = ((PLANET *)lpPlanets)
                 [*(int *)((int)&rgplr[0].idPlanetHome + i * 0xc0)].wFlags & 0xfbffU |
                 0x400;
      }
      j._2_2_ = iSteal;
      UpdateProgressGauge(0x28a);
      ThingDecay();
      BreedColonistsInTransit();
      UpdateProgressGauge(700);
      Produce();
      UpdateProgressGauge(0x2ee);
      MoveThings(1);
      UpdateProgressGauge(0x302);
      FuelFleets();
      DoOrders(1);
      SweepForMines();
      HealShips();
      AutoTerraform();
      RemoteTerraforming();
      UpdateProgressGauge(0x352);
      SpankTheCheaters();
      ValidateWaypoints();
      UpdateGuesses();
      UpdateProgressGauge(0x354);
      FMarkFile(dtHost,-1,1,0);
      CreateBackupDir();
      game.turn = game.turn + 1;
      uVar14 = _strlen((char *)szBase);
      pchCur = (char *)szBase + uVar14;
      pchT = _strrchr((char *)szBase,0x5c);
      _strcpy(szT,(char *)&szBackup);
      if (pchT == (char *)0x0) {
        _strcat(szT,(char *)szBase);
      }
      else {
        _strcat(szT,pchT + 1);
      }
      uVar14 = _strlen(szT);
      pchBak = szT + uVar14;
      UpdateProgressGauge(0x356);
      UpdatePlayerScores();
      for (i = 0; i < game.cPlayer; i = i + 1) {
        for (j__12 = 0; j__12 < 10; j__12 = j__12 + 1) {
          if ((*(uint *)(*(int *)(i * 4 + 0x14c) + j__12 * 0x93 + 0x7b) >> 9 & 1) == 0) {
            sVar13 = PctCloakFromHuldef
                               ((HUL *)CONCAT22(*(undefined2 *)(i * 4 + 0x14e),
                                                (HUL *)(*(int *)(i * 4 + 0x14c) + j__12 * 0x93)),i,
                                (short *)0x0);
            iVar16 = 100 - sVar13;
            j = (FLEET *)(long)iVar16;
            uVar23 = *(undefined2 *)(i * 4 + 0x14e);
            iVar20 = *(int *)(i * 4 + 0x14c) + j__12 * 0x93;
            *(int *)(iVar20 + 0x87) = iVar16;
            *(int *)(iVar20 + 0x89) = iVar16 >> 0xf;
            uVar23 = *(undefined2 *)(i * 4 + 0x14e);
            iVar16 = *(int *)(i * 4 + 0x14c) + j__12 * 0x93;
            uVar24 = *(undefined2 *)(i * 4 + 0x14e);
            iVar20 = *(int *)(i * 4 + 0x14c) + j__12 * 0x93;
            pFVar27 = (FLEET *)__aFulmul(CONCAT22(*(undefined2 *)(iVar20 + 0x89),
                                                          *(undefined2 *)(iVar20 + 0x87)),
                                                 CONCAT22(*(undefined2 *)(iVar16 + 0x89),
                                                          *(undefined2 *)(iVar16 + 0x87)));
            j._2_2_ = (short)((ulong)pFVar27 >> 0x10);
            j._0_2_ = (FLEET *)pFVar27;
            uVar23 = *(undefined2 *)(i * 4 + 0x14e);
            iVar16 = *(int *)(i * 4 + 0x14c) + j__12 * 0x93;
            *(undefined2 *)(iVar16 + 0x87) = (FLEET *)j;
            *(short *)(iVar16 + 0x89) = j._2_2_;
          }
        }
        for (j__12 = 0; j__12 < 0x10; j__12 = j__12 + 1) {
          if ((*(uint *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x7b) >> 9 & 1) == 0) {
            j._0_2_ = (FLEET *)GetShdefScannerRange
                                         ((SHDEF *)CONCAT22(*(undefined2 *)(i * 4 + 0x100),
                                                            (SHDEF *)(*(int *)(i * 4 + 0xfe) +
                                                                     j__12 * 0x93)),i,
                                          (short *)((int)&j + 2),&pctDetect,&iSteal);
            *(undefined2 *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x8d) = (FLEET *)j;
            *(short *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x8f) = j._2_2_;
            *(undefined1 *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x91) = (char)pctDetect;
            *(undefined1 *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x92) = (char)iSteal;
            sVar13 = FCanBuildShdef
                               ((SHDEF *)CONCAT22(*(undefined2 *)(i * 4 + 0x100),
                                                  (SHDEF *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93)),
                                i);
            if (sVar13 == 0) {
              *(uint *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x7b) =
                   *(uint *)(*(int *)(i * 4 + 0xfe) + j__12 * 0x93 + 0x7b) & 0x7fff | 0x8000;
            }
          }
        }
      }
      j__12 = 0x358;
      fDone = 0;
      _memset(rgfNoXFile,0,0x10);
      i = 0;
      while (fDone == 0) {
        UpdateProgressGauge(j__12);
        j__12 = j__12 + (int)(0x11 / (long)(game.cPlayer + 1));
        if (game.cPlayer <= i) {
          i = -1;
          fDone = 1;
        }
        if (i < 0) {
          _strcpy(pchCur,(char *)0x9d4);
          _strcpy(pchBak,(char *)0x9d9);
        }
        else {
          wsprintf((char *)pchCur,(char *)0x112009cf,i + 1);
          _strcpy(pchBak,pchCur);
          _remove(szT);
          sVar13 = __access((char *)szBase,0);
          if (sVar13 == -1) {
            rgfNoXFile[i] = '\x01';
          }
          else {
            _rename((char *)szBase,szT);
          }
          pchBak[1] = 'm';
          pchCur[1] = 'm';
        }
        _remove(szT);
        if ((i < 0) || (rgfNoXFile[i] == '\0')) {
          _rename((char *)szBase,szT);
        }
        else {
          CopyFile((char *)szBase,szT);
        }
        *pchCur = '\0';
        i = i + 1;
      }
      j__12 = 0x36b;
      fDone = 0;
      uVar15 = Random(8);
      j = (FLEET *)CONCAT22(uVar15,(FLEET *)j);
      game.wCrap = game.wCrap & 0xf1ffU | (uVar15 & 7) << 9;
      i = 0;
      while (fDone == 0) {
        UpdateProgressGauge(j__12);
        j__12 = j__12 + (int)(0x7a / (long)(game.cPlayer + 1));
        if (game.cPlayer <= i) {
          i = -1;
          fDone = 1;
        }
        if ((i == -1) || (rgfNoXFile[i] == '\0')) {
          sVar13 = 0;
        }
        else {
          sVar13 = 1;
        }
        FWriteDataFile((char *)szBase,i,sVar13);
        i = i + 1;
      }
      UpdateProgressGauge(0x3e6);
      imemLogCur = 0;
      fSuccess = 1;
    }
TURN_FreeStuffUp:
    UpdateProgressGauge(1000);
    FreeLp(vrgPlanResExtra,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgPlanResExtra._0_2_ = (ushort *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgPlanResExtra._2_2_ = 0;
    FreeLp(vrgts,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgts._0_2_ = (TURNSERIAL *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    vrgts._2_2_ = 0;
    FreeLp(lpcd,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    lpcd._0_2_ = (COLDROP *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    lpcd._2_2_ = 0;
    FreeLp(lpxf,htMisc);
                    /* WARNING: Ignoring partial resolution of indirect */
    lpxf._0_2_ = (XFERFULL *)0x0;
                    /* WARNING: Ignoring partial resolution of indirect */
    lpxf._2_2_ = 0;
    gd._0_2_ = gd._0_2_ & 0xfdfd;
    idPlayer = -1;
    if ((fSuccess != 0) && (((uint)ini.wFlags >> 3 & 1) != 0)) {
      vretExitValue = 1;
    }
    setcursor(hcurSav);
    TurnLog(fSuccess + idsFailed);
    pTVar1 = vrgts;
    puVar9 = vrgPlanResExtra;
    pCVar10 = lpcd;
    pXVar11 = lpxf;
  }
  lpxf._2_2_ = (undefined2)((ulong)pXVar11 >> 0x10);
  lpxf._0_2_ = (XFERFULL *)pXVar11;
  lpcd._2_2_ = (undefined2)((ulong)pCVar10 >> 0x10);
  lpcd._0_2_ = (COLDROP *)pCVar10;
  vrgPlanResExtra._2_2_ = (undefined2)((ulong)puVar9 >> 0x10);
  vrgPlanResExtra._0_2_ = (ushort *)puVar9;
  vrgts._2_2_ = (undefined2)((ulong)pTVar1 >> 0x10);
  vrgts._0_2_ = (TURNSERIAL *)pTVar1;
  return fSuccess;
}



// ======================================================================
// Function: DoOrders
// Address: 10b0:179a
// Segment: MEMORY_TURN
// ======================================================================


void DoOrders(short fPostMovement)

{
  short sVar1;
  PLANET *pPVar2;
  undefined2 uVar3;
  PLANET *lppl;
  
  pPVar2 = (PLANET *)lpPlanets + cPlanet;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < pPVar2) {
    uVar3 = (undefined2)((ulong)lppl >> 0x10);
    ((PLANET *)lppl)->wFlags =
         ((PLANET *)lppl)->wFlags & 0xdfffU | (uint)(((PLANET *)lppl)->iPlayer != -1) << 0xd;
    lppl = (PLANET *)CONCAT22(uVar3,(PLANET *)lppl + 1);
  }
  if (fPostMovement != 0) {
    idBattle = (game.turn & 0xfU) * 0x100 + 1;
    DoBattles(fPostMovement);
  }
  DoThingInteractions(fPostMovement);
  if (fPostMovement != 0) {
    pPVar2 = (PLANET *)lpPlanets + cPlanet;
    lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
    while ((PLANET *)lppl < pPVar2) {
      uVar3 = (undefined2)((ulong)lppl >> 0x10);
      ((PLANET *)lppl)->turn = 0;
      lppl = (PLANET *)CONCAT22(uVar3,(PLANET *)lppl + 1);
    }
  }
  if (fPostMovement == 0) {
    sVar1 = 1;
  }
  else {
    sVar1 = 3;
  }
  SatisfyOrders(sVar1);
  DropColonists();
  UpdateResearchStatus(0);
  if (fPostMovement == 0) {
    sVar1 = 2;
  }
  else {
    sVar1 = 4;
  }
  SatisfyOrders(sVar1);
  if (fPostMovement == 0) {
    TransferToOthers();
  }
  return;
}



// ======================================================================
// Function: MoveThings
// Address: 10b0:18f4
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b02b3a) */
/* WARNING: Removing unreachable block (ram,0x10b02a14) */
/* WARNING: Removing unreachable block (ram,0x10b02a5c) */

void MoveThings(short fPostProd)

{
  uint *puVar1;
  char *pcVar2;
  int *piVar3;
  THING *pTVar4;
  undefined8 uVar5;
  undefined8 uVar6;
  double dVar7;
  int iVar8;
  undefined1 extraout_AH;
  MessageId iMsg;
  uint uVar9;
  uint uVar10;
  short sVar11;
  uint uVar12;
  THING *pTVar13;
  uint *puVar14;
  int iVar15;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar16;
  bool bVar17;
  bool bVar18;
  long lVar19;
  ulong uVar20;
  ulong uVar21;
  ushort p6;
  undefined2 uVar22;
  short sVar23;
  short sVar24;
  undefined2 uVar25;
  short sVar26;
  int in_stack_0000ff7e;
  short in_stack_0000ff80;
  short rgMax [3];
  short cTerraTemp;
  short cTerraPerm;
  THING *rgMin;
  int local_6e;
  THING *lpth2;
  short iWarpPacket2;
  short iWarpPacket;
  long dmgRaw;
  float pct;
  short pctCaught;
  short i;
  uint lColKilled;
  undefined4 local_56;
  int local_52;
  short fTwoMAs;
  undefined8 r;
  undefined8 dxRound;
  undefined8 dyRound;
  int ptBase;
  int local_34;
  short dRange;
  THING *lpthMac;
  int local_2e;
  short ptSrc;
  uint local_2a;
  short iLow;
  short idm;
  short fMajorMove;
  short fAnythingMoved;
  THING *lpth;
  short dLeft;
  short ptDst;
  uint local_18;
  short iMax;
  short pt;
  short local_12;
  double d;
  short dUni;
  short k;
  
  fAnythingMoved = 0;
  lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
  dyRound._0_6_ = CONCAT24((THING *)lpThings,(undefined4)dyRound);
  dyRound = (double)CONCAT26(lpThings._2_2_,(undefined6)dyRound);
  lpthMac = (THING *)lpThings + cThing;
  local_2e = lpThings._2_2_;
  do {
    if (lpthMac <= (THING *)lpth) {
      if (fAnythingMoved != 0) {
        ValidateWaypoints();
      }
      return;
    }
    uVar16 = (undefined2)((ulong)lpth >> 0x10);
    if (((uint)lpth->idFull >> 0xd == 2) && (fPostProd != 0)) {
      k = 0;
      ptBase = (&((THING *)lpth)->pt)->x;
      local_34 = (((THING *)lpth)->pt).y;
      sVar11 = Random(100);
      dyRound = (double)CONCAT26(sVar11,(undefined6)dyRound);
      sVar11 = PctWormholeMoves(lpth);
      fMajorMove = (short)((int)dyRound._6_2_ < sVar11);
      pTVar13 = (THING *)lpth;
      uVar16 = (undefined2)((ulong)lpth >> 0x10);
      if (fMajorMove == 0) {
        dyRound = (double)(CONCAT26(*(int *)pTVar13->rgb + 4,(undefined6)dyRound) &
                          0xffcffffffffffff);
        *(uint *)pTVar13->rgb = *(uint *)pTVar13->rgb & 0xf003;
        *(uint *)pTVar13->rgb = *(uint *)pTVar13->rgb | dyRound._6_2_;
      }
      else {
        (pTVar13->rgb + 2)[0] = 0;
        (pTVar13->rgb + 2)[1] = 0;
        dUni = game.mdSize * 400 + 400;
        *(uint *)pTVar13->rgb = *(uint *)pTVar13->rgb & 0xf003;
      }
      iMax = 0x10;
      while (iVar8 = k + 1, bVar17 = k < 100, k = iVar8, bVar17) {
        if (fMajorMove == 0) {
          sVar11 = Random(0x19);
          (&((THING *)lpth)->pt)->x = sVar11 + ptBase + -0xc;
          sVar11 = Random(0x19);
          (((THING *)lpth)->pt).y = sVar11 + local_34 + -0xc;
        }
        else {
          sVar11 = Random(dUni);
          (&((THING *)lpth)->pt)->x = sVar11 + 1000;
          sVar11 = Random(dUni);
          (((THING *)lpth)->pt).y = sVar11 + 1000;
        }
        uVar16 = (undefined2)((ulong)lpth >> 0x10);
        if (((&((THING *)lpth)->pt)->x != ptBase) || ((((THING *)lpth)->pt).y != local_34)) {
          iLow = IValidateWormholePos(lpth);
          if (iLow == 0) break;
          if (iLow < iMax) {
            uVar16 = (undefined2)((ulong)lpth >> 0x10);
            pt = (&((THING *)lpth)->pt)->x;
            local_12 = (((THING *)lpth)->pt).y;
            iMax = iLow;
          }
        }
      }
      if (iLow != 0) {
        uVar16 = (undefined2)((ulong)lpth >> 0x10);
        (&((THING *)lpth)->pt)->x = pt;
        (((THING *)lpth)->pt).y = local_12;
      }
    }
    else {
      if (((uint)lpth->idFull >> 0xd == 3) && (fPostProd == 0)) {
        dRange = *(uint *)(((THING *)lpth)->rgb + 4) & 0xf;
        if (0xc < (uint)dRange) goto LAB_10b0_1c3e;
        sVar11 = Random(0x19);
        if (sVar11 != 0) goto LAB_10b0_1c3e;
        idm = 0x130;
        sVar11 = Random(3);
        if (sVar11 == 0) goto TURN_LRetargetFreighter;
        goto TURN_LSpeedUpOnly;
      }
      if ((((uint)lpth->idFull >> 0xd == 1) && ((*(uint *)((THING *)lpth)->rgb >> 10 & 0xf) != 0))
         && ((fPostProd == 0 || ((*(uint *)((THING *)lpth)->rgb >> 0xe & 1) == 0)))) {
        if (((*(int *)(((THING *)lpth)->rgb + 2) != 0) || (*(int *)(((THING *)lpth)->rgb + 4) != 0))
           || (*(int *)(((THING *)lpth)->rgb + 6) != 0)) {
          *(uint *)((THING *)lpth)->rgb = *(uint *)((THING *)lpth)->rgb & 0xbfff | 0x4000;
          iVar8 = (*(uint *)((THING *)lpth)->rgb >> 10 & 0xf) + 4;
          dRange = iVar8 * iVar8;
          if (fPostProd != 0) {
            dRange = dRange >> 1;
          }
          uVar12 = *(uint *)((THING *)lpth)->rgb & 0x3ff;
          ptDst = ((POINT *)rgptPlan + uVar12)->x;
          local_18 = *(uint *)((int)&rgptPlan[0].y + uVar12 * 4);
TURN_MoveTh:
          fAnythingMoved = 1;
          uVar16 = (undefined2)((ulong)lpth >> 0x10);
          ptSrc = (&((THING *)lpth)->pt)->x;
          local_2a = (((THING *)lpth)->pt).y;
          dVar7 = DGetDistance(ptSrc,local_2a,ptDst,local_18);
          d = *(double *)CONCAT11(extraout_AH,dVar7);
          lVar19 = __ftol((double)CONCAT26(in_stack_0000ff80,
                                                   CONCAT24(in_stack_0000ff7e,
                                                            CONCAT22(unaff_SI,unaff_DI))));
          dLeft = (short)lVar19;
          if (dLeft <= dRange) {
TURN_MadeItThere:
            if ((uint)lpth->idFull >> 0xd == 3) {
              lpth2 = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
              cTerraTemp = (short)(THING *)lpThings;
              cTerraPerm = lpThings._2_2_;
              rgMin = (THING *)lpThings + cThing;
              local_6e = lpThings._2_2_;
              while( true ) {
                if (rgMin <= (THING *)lpth2) break;
                if ((uint)lpth2->idFull >> 0xd == 3) {
                  if (((THING *)lpth2 != (THING *)lpth) || (lpth2._2_2_ != lpth._2_2_)) break;
                }
                lpth2 = (THING *)CONCAT22(lpth2._2_2_,(THING *)lpth2 + 1);
              }
              if (((THING *)lpth2 == rgMin) && (lpth2._2_2_ == lpThings._2_2_)) {
                sVar11 = Random(2);
                if (sVar11 != 0) break;
              }
              goto TURN_LFreeThePacket;
            }
            if ((uint)lpth->idFull >> 0xd == 1) {
              sVar11 = MulDiv(dLeft,100,dRange);
              pTVar4 = lpth2;
              lpth2 = (THING *)CONCAT22(sVar11,(THING *)lpth2);
              if (sVar11 < 0) {
                lpth2 = (THING *)((ulong)pTVar4 & 0xffff);
              }
              else if (100 < sVar11) {
                lpth2 = (THING *)CONCAT22(100,(THING *)lpth2);
              }
              if (fPostProd != 0) {
                lpth2 = (THING *)CONCAT22(lpth2._2_2_ >> 1,(THING *)lpth2);
              }
              sVar11 = FPacketDecay(lpth,lpth2._2_2_);
              if (sVar11 != 0) goto TURN_LPacketAlreadyFreed;
            }
            uVar16 = (undefined2)((ulong)lpth >> 0x10);
            r = (double)CONCAT26(lpPlanets._2_2_,
                                 CONCAT24((PLANET *)lpPlanets +
                                          (*(uint *)((THING *)lpth)->rgb & 0x3ff),(undefined4)r));
            iWarpPacket = (*(uint *)((THING *)lpth)->rgb >> 10 & 0xf) + 4;
            iVar8 = IWarpMAFromLppl
                              ((PLANET *)
                               CONCAT22(lpPlanets._2_2_,
                                        (PLANET *)lpPlanets +
                                        (*(uint *)((THING *)lpth)->rgb & 0x3ff)),&fTwoMAs);
            if (fTwoMAs != 0) {
              iVar8 = iVar8 + 1;
            }
            dxRound = (double)CONCAT44(dxRound._4_4_,CONCAT22(iVar8,(int)dxRound));
            if (0 < iVar8) {
              sVar11 = GetRaceStat((PLAYER *)rgplr + ((uint)lpth->idFull >> 9 & 0xf)
                                         ,rsMajorAdv);
              if (sVar11 == raMassAccel) {
                uVar12 = 1 << ((byte)((uint)lpth->idFull >> 9) & 0xf);
                uVar16 = (undefined2)((qword)r >> 0x30);
                iVar8 = (int)((qword)r >> 0x20);
                lpth2 = (THING *)CONCAT22(uVar12,(THING *)lpth2);
                iVar15 = *(int *)(iVar8 + 2) * 4;
                puVar1 = (uint *)(*(int *)(iVar15 + 0x14c) + (*(uint *)(iVar8 + 0x2c) & 0xf) * 0x93
                                 + 0x8b);
                *puVar1 = *puVar1 | uVar12;
              }
            }
            sVar11 = GetRaceStat((PLAYER *)rgplr + ((uint)lpth->idFull >> 9 & 0xf),
                                       rsMajorAdv);
            uVar5 = dxRound;
            dxRound = (double)CONCAT62(dxRound._2_6_,(uint)(sVar11 == raMassAccel));
            uVar6 = dxRound;
            dxRound._2_2_ = SUB82(uVar5,2);
            iVar8 = dxRound._2_2_ * dxRound._2_2_;
            dxRound._6_2_ = SUB82(uVar5,6);
            dxRound._0_4_ = (undefined4)uVar6;
            dxRound._0_6_ = CONCAT24(iVar8,(undefined4)dxRound);
            iWarpPacket2 = iWarpPacket * iWarpPacket;
            sVar11 = GetRaceStat((PLAYER *)rgplr +
                                       *(int *)((int)((qword)r >> 0x20) + 2),rsMajorAdv);
            if (sVar11 == raStargate) {
              dxRound._0_6_ = CONCAT24(dxRound._4_2_ / 2,(undefined4)dxRound);
            }
            iVar8 = dxRound._4_2_;
            if (dxRound._4_2_ < iWarpPacket2) {
              if (dxRound._2_2_ < 1) {
                pctCaught = 0;
              }
              else {
                dxRound._0_4_ = CONCAT22(iVar8,(int)dxRound);
                iVar15 = iWarpPacket2 >> 0xf;
                sVar11 = iWarpPacket2;
                uVar20 = __aFulmul((long)iVar8,1000);
                lVar19 = __aFldiv(uVar20,CONCAT22(iVar15,sVar11));
                pctCaught = (short)lVar19;
              }
            }
            else {
              pctCaught = 1000;
            }
            r._0_2_ = 1000 - pctCaught;
            for (i = 0; i < 3; i = i + 1) {
              uVar22 = 0;
              uVar16 = 1000;
              uVar20 = __aFulmul((long)*(int *)(((THING *)lpth)->rgb + i * 2 + 2),
                                         (long)(int)r);
              lVar19 = __aFldiv(uVar20,CONCAT22(uVar22,uVar16));
              *(undefined2 *)((int)&dyRound + i * 2 + 2) = (int)lVar19;
            }
            r = (double)CONCAT62(r._2_6_,(1000 - pctCaught) / 9 + pctCaught);
            dxRound = (double)((qword)dxRound & 0xffffffffffff);
            dyRound = (double)((qword)dyRound & 0xffffffffffff0000);
            i = 0;
            lVar19 = dmgRaw;
            while( true ) {
              dmgRaw = lVar19;
              if (2 < i) break;
              if (*(int *)(((THING *)lpth)->rgb + i * 2 + 2) < 0) {
                (((THING *)lpth)->rgb + i * 2 + 2)[0] = 0;
                (((THING *)lpth)->rgb + i * 2 + 2)[1] = 0;
              }
              uVar12 = *(uint *)(((THING *)lpth)->rgb + i * 2 + 2);
              bVar17 = CARRY2(dxRound._6_2_,uVar12);
              dxRound = (double)CONCAT26(dxRound._6_2_ + uVar12,(undefined6)dxRound);
              dyRound = (double)CONCAT62(dyRound._2_6_,
                                         (int)dyRound + ((int)uVar12 >> 0xf) + (uint)bVar17);
              uVar22 = 0;
              uVar16 = 1000;
              uVar20 = __aFulmul((long)*(int *)(((THING *)lpth)->rgb + i * 2 + 2),
                                         (long)(int)r);
              lVar19 = __aFldiv(uVar20,CONCAT22(uVar22,uVar16));
              puVar14 = (uint *)(r._4_2_ + 0x1c + i * 4);
              puVar1 = puVar14;
              uVar12 = *puVar1;
              *puVar1 = *puVar1 + (uint)lVar19;
              puVar1 = puVar14 + 1;
              *puVar1 = *puVar1 + (int)((ulong)lVar19 >> 0x10) + (uint)CARRY2(uVar12,(uint)lVar19);
              i = i + 1;
              lVar19 = dmgRaw;
            }
            if (pctCaught == 1000) {
TURN_LAllSafe:
              sVar24 = 0;
              sVar26 = 0;
              sVar11 = 0;
              dmgRaw = lVar19;
              uVar20 = __aFulshr(0,0);
              uVar21 = CONCAT22(dxRound._6_2_,(uint)lpth->idFull >> 9) & 0xffff000f;
              if (dxRound._2_2_ < 1) {
                iMsg = idmBombardedPacketContainingKtMineralsHoweverPacket;
              }
              else {
                iMsg = idmMassAcceleratorHasSuccessfullyCapturedPacketCont;
              }
              FSendPlrMsg(*(short *)((int)((qword)r >> 0x20) + 2),iMsg,*r._4_4_,*r._4_4_,
                               (short)uVar21,(short)(uVar21 >> 0x10),(short)uVar20,sVar11,sVar26,
                               sVar24);
            }
            else {
              uVar22 = 0;
              uVar16 = 0xa0;
              uVar20 = __aFulmul((long)(iWarpPacket * iWarpPacket - dxRound._2_2_),
                                         CONCAT22((int)dyRound,dxRound._6_2_));
              lVar19 = __aFldiv(uVar20,CONCAT22(uVar22,uVar16));
              dmgRaw = lVar19;
              if ((int)dxRound != 0) {
                lpth2 = (THING *)((ulong)CONCAT22((uint)lpth->idFull >> 9,(THING *)lpth2) & 0xfffff)
                ;
                for (i = 0; i < 3; i = i + 1) {
                  cTerraTemp = 0;
                  cTerraPerm = 0;
                  while (dmgRaw = lVar19, 0 < *(int *)((int)&dyRound + i * 2 + 2)) {
                    if (*(int *)((int)&dyRound + i * 2 + 2) < 100) {
                      uVar16 = *(undefined2 *)((int)&dyRound + i * 2 + 2);
                    }
                    else {
                      uVar16 = 100;
                    }
                    r._0_4_ = CONCAT22(uVar16,(int)r);
                    sVar11 = Random(200);
                    lVar19 = dmgRaw;
                    if (sVar11 < r._2_2_) {
                      cTerraTemp = cTerraTemp + 1;
                      sVar11 = Random(10);
                      lVar19 = dmgRaw;
                      if (sVar11 == 0) {
                        cTerraPerm = cTerraPerm + 1;
                      }
                    }
                    piVar3 = (int *)((int)&dyRound + i * 2 + 2);
                    *piVar3 = *piVar3 + -100;
                  }
                  if (0 < cTerraPerm) {
                    if (*(char *)(lpth2._2_2_ * 0xc0 + 0x59b5 + i) < '\0') {
                      if (*(char *)(r._4_2_ + 0xf + i) < '2') {
                        if (*(char *)(r._4_2_ + 0xf + i) + -1 <= cTerraPerm) {
                          cTerraPerm = *(char *)(r._4_2_ + 0xf + i) + -1;
                        }
                        cTerraPerm = -cTerraPerm;
                      }
                      else if (99 - *(char *)(r._4_2_ + 0xf + i) <= cTerraPerm) {
                        cTerraPerm = 99 - *(char *)(r._4_2_ + 0xf + i);
                      }
                    }
                    else if (*(char *)(r._4_2_ + 0xf + i) <
                             *(char *)(lpth2._2_2_ * 0xc0 + 0x59b2 + i)) {
                      in_stack_0000ff7e = *(char *)(r._4_2_ + 0xf + i) + cTerraPerm;
                      if (*(char *)(lpth2._2_2_ * 0xc0 + 0x59b2 + i) < in_stack_0000ff7e) {
                        in_stack_0000ff7e = (int)*(char *)(r._4_2_ + 0xf + i);
                        cTerraPerm = *(char *)(lpth2._2_2_ * 0xc0 + 0x59b2 + i) - in_stack_0000ff7e;
                      }
                    }
                    else {
                      in_stack_0000ff7e = (int)*(char *)(r._4_2_ + 0xf + i);
                      if (*(char *)(lpth2._2_2_ * 0xc0 + 0x59b2 + i) < in_stack_0000ff7e) {
                        in_stack_0000ff7e = *(char *)(r._4_2_ + 0xf + i) - cTerraPerm;
                        if (in_stack_0000ff7e < *(char *)(lpth2._2_2_ * 0xc0 + 0x59b2 + i)) {
                          in_stack_0000ff7e = (int)*(char *)(r._4_2_ + 0xf + i);
                          cTerraPerm = *(char *)(lpth2._2_2_ * 0xc0 + 0x59b2 + i) -
                                       in_stack_0000ff7e;
                        }
                        else {
                          cTerraPerm = -cTerraPerm;
                        }
                      }
                      else {
                        cTerraPerm = 0;
                      }
                    }
                    if (cTerraPerm != 0) {
                      sVar23 = 0;
                      sVar24 = 0;
                      sVar26 = 0;
                      sVar11 = _abs(cTerraPerm);
                      FSendPlrMsg(lpth2._2_2_,idmMineralPacketHasPermanentlyDefault,*r._4_4_,
                                       (uint)(0 < cTerraPerm),i,*r._4_4_,sVar11,sVar26,sVar24,sVar23
                                      );
                      uVar16 = (undefined2)((qword)r >> 0x30);
                      iVar8 = (int)((qword)r >> 0x20);
                      if ((*(int *)(iVar8 + 2) != -1) && (*(int *)(iVar8 + 2) != lpth2._2_2_)) {
                        sVar23 = 0;
                        sVar24 = 0;
                        sVar26 = 0;
                        sVar11 = _abs(cTerraPerm);
                        FSendPlrMsg(lpth2._2_2_,idmMineralPacketHasPermanentlyDefault2,*r._4_4_
                                         ,(uint)(0 < cTerraPerm),i,*r._4_4_,sVar11,sVar26,sVar24,
                                         sVar23);
                      }
                      pcVar2 = (char *)(r._4_2_ + 0xf + i);
                      *pcVar2 = *pcVar2 + (char)cTerraPerm;
                      lVar19 = dmgRaw;
                    }
                  }
                  if (0 < cTerraTemp) {
                    idPlayer = lpth2._2_2_;
                    dmgRaw = lVar19;
                    sVar11 = FCanTerraformLppl
                                       ((PLANET *)((qword)r >> 0x20),(short *)&rgMin,rgMax,
                                        (short *)&stack0xff80,1);
                    lVar19 = dmgRaw;
                    if (sVar11 == 0) {
                      idPlayer = -1;
                    }
                    else {
                      idPlayer = -1;
                      if (*(char *)(lpth2._2_2_ * 0xc0 + 0x59b5 + i) < '\0') {
                        cTerraTemp = cTerraTemp / 2;
                        if (*(char *)(r._4_2_ + 0xf + i) < '2') {
                          if (*(char *)(r._4_2_ + 0xc + i) + -1 <= cTerraTemp) {
                            cTerraTemp = *(char *)(r._4_2_ + 0xc + i) + -1;
                          }
                          cTerraTemp = -cTerraTemp;
                        }
                        else if (99 - *(char *)(r._4_2_ + 0xc + i) <= cTerraTemp) {
                          cTerraTemp = 99 - *(char *)(r._4_2_ + 0xc + i);
                        }
                      }
                      else if ((&rgMin)[i] == (THING *)0xffff) {
                        if (rgMax[i] == -1) {
                          cTerraTemp = 0;
                        }
                        else if (rgMax[i] - (int)*(char *)(r._4_2_ + 0xc + i) < cTerraTemp) {
                          cTerraTemp = rgMax[i] - (int)*(char *)(r._4_2_ + 0xc + i);
                        }
                      }
                      else if ((int)*(char *)(r._4_2_ + 0xc + i) - (int)(&rgMin)[i] < cTerraTemp) {
                        cTerraTemp = (int)(&rgMin)[i] - (int)*(char *)(r._4_2_ + 0xc + i);
                      }
                      else {
                        cTerraTemp = -cTerraTemp;
                      }
                      if (cTerraTemp != 0) {
                        pcVar2 = (char *)(r._4_2_ + 0xc + i);
                        *pcVar2 = *pcVar2 + (char)cTerraTemp;
                        pcVar2 = (char *)(r._4_2_ + 0xc + i);
                        FSendPlrMsg(lpth2._2_2_,idmMineralPacketHas,*r._4_4_,
                                         (uint)(0 < cTerraTemp),i,*r._4_4_,i << 8 | (int)*pcVar2,0,0
                                         ,0);
                        uVar16 = (undefined2)((qword)r >> 0x30);
                        iVar8 = (int)((qword)r >> 0x20);
                        lVar19 = dmgRaw;
                        if ((*(int *)(iVar8 + 2) != -1) && (*(int *)(iVar8 + 2) != lpth2._2_2_)) {
                          FSendPlrMsg(lpth2._2_2_,idmMineralPacketHas2,*r._4_4_,
                                           (uint)(0 < cTerraTemp),i,*r._4_4_,
                                           i << 8 | (int)*(char *)(iVar8 + 0xc + i),0,0,0);
                          lVar19 = dmgRaw;
                        }
                      }
                    }
                  }
                }
              }
              dmgRaw = lVar19;
              if (*(int *)((int)((qword)r >> 0x20) + 2) != -1) {
                CalcPctSurvive((PLANET *)((qword)r >> 0x20),&pct,(float *)0x0);
                lVar19 = __ftol((double)CONCAT26(in_stack_0000ff80,
                                                         CONCAT24(in_stack_0000ff7e,
                                                                  CONCAT22(unaff_SI,unaff_DI))));
                if (lVar19 != 0) {
                  dmgRaw = lVar19;
                  sVar11 = GetRaceStat((PLAYER *)rgplr +
                                             *(int *)((int)((qword)r >> 0x20) + 2),rsMajorAdv);
                  lVar19 = dmgRaw;
                  if (sVar11 != raMacintosh) {
                    uVar16 = (undefined2)((qword)r >> 0x30);
                    iVar15 = (int)((qword)r >> 0x20);
                    lColKilled = *(int *)(iVar15 + 0x28);
                    iVar8 = *(int *)(iVar15 + 0x2a);
                    local_56._0_2_ = iVar8;
                    if ((lColKilled == 0) && (iVar8 == 0)) {
                      FSendPlrMsg2(*(short *)(iVar15 + 2),
                                        idmBombardedKtMineralPacketFortunatelyOneHome,*r._4_4_,
                                        *r._4_4_,(uint)lpth->idFull >> 9 & 0xf);
                      local_52 = 0;
                      lColKilled = 0;
                      local_56 = (ulong)(*(uint *)((int)((qword)r >> 0x20) + 0x18) & 0xfff) << 0x10;
                    }
                    else {
                      uVar22 = 0;
                      uVar16 = 1000;
                      uVar20 = __aFulmul(CONCAT22(iVar8,lColKilled),dmgRaw);
                      lVar19 = __aFldiv(uVar20,CONCAT22(uVar22,uVar16));
                      if (lVar19 < dmgRaw) {
                        lVar19 = dmgRaw;
                      }
                      lColKilled = (uint)lVar19;
                      local_56 = CONCAT22(local_56._2_2_,(int)((ulong)lVar19 >> 0x10));
                      uVar16 = (undefined2)((qword)r >> 0x30);
                      iVar8 = (int)((qword)r >> 0x20);
                      if (((-1 < *(int *)(iVar8 + 0x2a)) &&
                          ((0 < *(int *)(iVar8 + 0x2a) || (*(int *)(iVar8 + 0x28) != 0)))) &&
                         ((CONCAT22(*(undefined2 *)(iVar8 + 0x2a),*(undefined2 *)(iVar8 + 0x28)) <=
                           lVar19 || ((lVar19 < 0x10000 && (lVar19 < 0)))))) {
                        FSendPlrMsg2(*(short *)(iVar8 + 2),
                                          idmAnnihilatedMineralPacketColonistsKilled,*r._4_4_,
                                          *r._4_4_,(uint)lpth->idFull >> 9 & 0xf);
                        UninhabitPlanet((PLANET *)((qword)r >> 0x20));
                        goto TURN_LFreeThePacket;
                      }
                      uVar25 = 0;
                      uVar22 = 1000;
                      uVar20 = __aFulmul((ulong)*(uint *)(iVar8 + 0x18) & 0xffff0fff,dmgRaw)
                      ;
                      lVar19 = __aFldiv(uVar20,CONCAT22(uVar25,uVar22));
                      local_52 = (int)((ulong)lVar19 >> 0x10);
                      local_56 = CONCAT22((int)lVar19,(int)local_56);
                      if ((lVar19 == 0) &&
                         ((*(uint *)((int)((qword)r >> 0x20) + 0x18) & 0xfff) != 0)) {
                        sVar11 = Random(0x14);
                        local_56 = (ulong)CONCAT12(sVar11 < dmgRaw,(int)local_56);
                        local_52 = 0;
                      }
                      lVar19 = __aFldiv(dmgRaw,0x14);
                      iVar8 = (int)((ulong)lVar19 >> 0x10);
                      if ((local_52 <= iVar8) &&
                         ((local_52 < iVar8 || (local_56._2_2_ < (uint)lVar19)))) {
                        lVar19 = __aFldiv(dmgRaw,0x14);
                        local_52 = (int)((ulong)lVar19 >> 0x10);
                        local_56 = CONCAT22((int)lVar19,(int)local_56);
                      }
                      uVar16 = (undefined2)((qword)r >> 0x30);
                      iVar8 = (int)((qword)r >> 0x20);
                      if ((-1 < local_52) &&
                         ((0 < local_52 || ((*(uint *)(iVar8 + 0x18) & 0xfff) < local_56._2_2_)))) {
                        local_56 = CONCAT22(*(undefined2 *)(iVar8 + 0x18),(int)local_56) & 0xfffffff
                        ;
                        local_52 = 0;
                      }
                      if ((local_56._2_2_ == 0) && (local_52 == 0)) {
                        if (dxRound._2_2_ == 0) {
                          idm = 0xd8;
                        }
                        else {
                          idm = 0xd6;
                        }
                        sVar26 = 0;
                        sVar11 = 0;
                        uVar9 = (uint)lpth->idFull >> 9;
                        uVar10 = uVar9 & 0xf;
                        uVar12 = lColKilled;
                        uVar20 = __aFulshr(CONCAT22(lColKilled,uVar9) & 0xffff000f,0);
                        FSendPlrMsg(*(short *)((int)((qword)r >> 0x20) + 2),idm,*r._4_4_,
                                         *r._4_4_,dxRound._6_2_,(short)uVar20,uVar10,uVar12,sVar11,
                                         sVar26);
                      }
                      else {
                        if (dxRound._2_2_ == 0) {
                          idm = 0xd9;
                        }
                        else {
                          idm = 0xd7;
                        }
                        sVar11 = 0;
                        uVar9 = (uint)lpth->idFull >> 9;
                        uVar10 = uVar9 & 0xf;
                        uVar12 = lColKilled;
                        p6 = local_56._2_2_;
                        uVar20 = __aFulshr(CONCAT22(lColKilled,uVar9) & 0xffff000f,
                                                   local_56._2_2_);
                        FSendPlrMsg(*(short *)((int)((qword)r >> 0x20) + 2),idm,*r._4_4_,
                                         *r._4_4_,dxRound._6_2_,(short)uVar20,uVar10,uVar12,p6,
                                         sVar11);
                        uVar16 = (undefined2)((qword)r >> 0x30);
                        iVar8 = (int)((qword)r >> 0x20);
                        uVar12 = *(int *)(iVar8 + 0x18) - local_56._2_2_ & 0xfff;
                        lpth2 = (THING *)(ulong)uVar12;
                        *(uint *)(iVar8 + 0x18) = *(uint *)(iVar8 + 0x18) & 0xf000;
                        *(undefined2 *)(iVar8 + 0x1a) = *(undefined2 *)(iVar8 + 0x1a);
                        *(uint *)(iVar8 + 0x18) = *(uint *)(iVar8 + 0x18) | uVar12;
                        *(undefined2 *)(iVar8 + 0x1a) = *(undefined2 *)(iVar8 + 0x1a);
                      }
                    }
                    uVar16 = (undefined2)((qword)r >> 0x30);
                    iVar8 = (int)((qword)r >> 0x20);
                    puVar1 = (uint *)(iVar8 + 0x28);
                    uVar12 = *puVar1;
                    *puVar1 = *puVar1 - lColKilled;
                    piVar3 = (int *)(iVar8 + 0x2a);
                    *piVar3 = (*piVar3 - (int)local_56) - (uint)(uVar12 < lColKilled);
                    goto TURN_LFreeThePacket;
                  }
                }
                goto TURN_LAllSafe;
              }
            }
            goto TURN_LFreeThePacket;
          }
          dxRound = DOUBLE_0_5__1120_1d5e;
          if (ptDst <= ptSrc) {
            dxRound = DOUBLE_m0_5__1120_1d66;
          }
          bVar17 = local_18 < local_2a;
          bVar18 = local_18 == local_2a;
          dyRound = DOUBLE_0_5__1120_1d5e;
          if ((int)local_18 <= (int)local_2a) {
            dyRound = DOUBLE_m0_5__1120_1d66;
          }
          __aFfcompp();
          if (bVar17 || bVar18) {
            __aFfcompp();
            if (bVar17) goto LAB_10b0_2e01;
          }
          else {
LAB_10b0_2e01:
            local_56 = (ulong)dRange;
            r = (double)(long)local_56 / d;
            local_56 = (ulong)(ptDst - ptSrc);
            lVar19 = __ftol((double)CONCAT26(in_stack_0000ff80,
                                                     CONCAT24(in_stack_0000ff7e,
                                                              CONCAT22(unaff_SI,unaff_DI))));
            ptSrc = (int)lVar19 + ptSrc;
            local_56 = (ulong)(int)(local_18 - local_2a);
            lVar19 = __ftol((double)CONCAT26(in_stack_0000ff80,
                                                     CONCAT24(in_stack_0000ff7e,
                                                              CONCAT22(unaff_SI,unaff_DI))));
            local_2a = (int)lVar19 + local_2a;
            if ((ptSrc == ptDst) && (local_2a == local_18)) goto TURN_MadeItThere;
            uVar16 = (undefined2)((ulong)lpth >> 0x10);
            (&((THING *)lpth)->pt)->x = ptSrc;
            (((THING *)lpth)->pt).y = local_2a;
          }
          if ((fPostProd != 0) && ((uint)lpth->idFull >> 0xd == 1)) {
            sVar11 = FPacketDecay(lpth,0x32);
            if (sVar11 != 0) goto TURN_LPacketAlreadyFreed;
          }
          goto LAB_10b0_2ed3;
        }
TURN_LFreeThePacket:
        FreeLpth(lpth);
TURN_LPacketAlreadyFreed:
        lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + -1);
        lpthMac = lpthMac + -1;
      }
    }
LAB_10b0_2ed3:
    lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
  } while( true );
  uVar16 = (undefined2)((ulong)lpth >> 0x10);
  pTVar13 = (THING *)lpth;
  sVar11 = *(short *)(pTVar13->rgb + 2);
  (&pTVar13->pt)->x = *(short *)pTVar13->rgb;
  (pTVar13->pt).y = sVar11;
  dRange = (*(uint *)(pTVar13->rgb + 4) & 0xf) - 2;
  if (dRange < 6) {
    dRange = 6;
  }
  idm = 0xc0;
TURN_LRetargetFreighter:
  sVar11 = Random(2);
  if (sVar11 == 0) {
    dyRound._0_4_ = CONCAT22(game.mdSize * 400 + 0x564,(int)dyRound);
  }
  else {
    dyRound._0_4_ = CONCAT22(0x3fc,(int)dyRound);
  }
  sVar11 = Random(game.mdSize * 400 + 0x169);
  dyRound._0_6_ = CONCAT24(sVar11 + 0x3fc,(undefined4)dyRound);
  sVar11 = Random(2);
  dyRound = (double)CONCAT26(sVar11,(undefined6)dyRound);
  uVar16 = (undefined2)((ulong)lpth >> 0x10);
  *(undefined2 *)((THING *)lpth)->rgb = *(undefined2 *)((int)&dyRound + sVar11 * 2 + 2);
  *(undefined2 *)(((THING *)lpth)->rgb + 2) =
       *(undefined2 *)((int)&dyRound + (uint)(sVar11 == 0) * 2 + 2);
TURN_LSpeedUpOnly:
  dRange = dRange + 1;
  dyRound = (double)CONCAT62(dyRound._2_6_,dRange);
  uVar16 = (undefined2)((ulong)lpth >> 0x10);
  *(uint *)(((THING *)lpth)->rgb + 4) = *(uint *)(((THING *)lpth)->rgb + 4) & 0xfff0 | dRange & 0xfU
  ;
  for (k = 0; k < game.cPlayer; k = k + 1) {
    FSendPlrMsg2(k,idm,-6,lpth->idFull,0);
  }
LAB_10b0_1c3e:
  uVar16 = (undefined2)((ulong)lpth >> 0x10);
  pTVar13 = (THING *)lpth;
  uVar12 = *(uint *)(pTVar13->rgb + 4) & 0xf;
  dRange = uVar12 * uVar12;
  ptDst = *(short *)pTVar13->rgb;
  local_18 = *(uint *)(pTVar13->rgb + 2);
  fAnythingMoved = 1;
  if (idm == 0xc0) goto LAB_10b0_2ed3;
  goto TURN_MoveTh;
}



// ======================================================================
// Function: FuelFleets
// Address: 10b0:2efa
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b03265) */

void FuelFleets(void)

{
  FLEET *pFVar1;
  int iVar2;
  undefined2 uVar3;
  int iVar4;
  int iVar5;
  HULDEF *pHVar6;
  ulong uVar7;
  long lVar8;
  long lVar9;
  ulong uVar10;
  HUL *lphul;
  SHDEF *lpshdef;
  FLEET *lpfl;
  short ifl;
  short i;
  PLANET *lppl;
  short j;
  
  ifl = 0;
  while( true ) {
    if (cFleet <= ifl) {
      return;
    }
                    /* WARNING: Load size is inaccurate */
    pFVar1 = ((FLEET **)rglpfl)[ifl];
    iVar2 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    if ((pFVar1 == (FLEET *)0x0) && (iVar2 == 0)) break;
    if (((uint)pFVar1->wFlags >> 10 & 1) == 0) {
      if (((((pFVar1->idPlanet == -1) ||
            (((uint)((PLANET *)lpPlanets)[pFVar1->idPlanet].wFlags >> 9 & 1) == 0)) ||
           (iVar5 = pFVar1->idPlanet, ((PLANET *)lpPlanets)[iVar5].iPlayer == -1)) ||
          ((pFVar1->iPlayer != ((PLANET *)lpPlanets)[iVar5].iPlayer &&
           (*(char *)(((PLANET *)lpPlanets)[iVar5].iPlayer * 0xc0 + 0x5a12 + pFVar1->iPlayer)
            != '\x01')))) ||
         (iVar4 = ((PLANET *)lpPlanets)[iVar5].iPlayer * 4,
         pHVar6 = LphuldefFromId
                            (*(HullDef *)
                              (*(int *)(iVar4 + 0x14c) +
                              (*(uint *)&((PLANET *)lpPlanets)[iVar5].field11_0x2c & 0xf) *
                              0x93)), (((HULDEF *)pHVar6)->hul).wtCargoMax == 0)) {
        lVar9 = 0;
        uVar10 = 0;
        for (i = 0; i < 0x10; i = i + 1) {
          if (pFVar1->rgcsh[i] != 0) {
            iVar5 = pFVar1->iPlayer * 4;
            uVar3 = *(undefined2 *)(iVar5 + 0x100);
            iVar5 = *(int *)(iVar5 + 0xfe) + i * 0x93;
            j = (short)*(byte *)(iVar5 + 0x7a);
            while (j = j - 1, -1 < j) {
              if ((*(int *)(iVar5 + 0x3a + j * 4) == 0x800) &&
                 ((*(uint *)(iVar5 + j * 4 + 0x3c) & 0xff) == 0x10)) {
                uVar7 = __aFulmul((long)pFVar1->rgcsh[i],
                                          (ulong)(*(uint *)(iVar5 + j * 4 + 0x3c) >> 8));
                uVar10 = uVar7 + uVar10;
              }
            }
            iVar5 = pFVar1->iPlayer * 4;
            lpshdef = (SHDEF *)CONCAT22(*(undefined2 *)(iVar5 + 0x100),
                                        (SHDEF *)(*(int *)(iVar5 + 0xfe) + i * 0x93));
            if (((lpshdef->hul).ihuldef == ihuldefFuelTransport) ||
               ((lpshdef->hul).ihuldef == ihuldefSuperFuelXport)) {
              uVar7 = __aFulmul((long)pFVar1->rgcsh[i],200);
              lVar9 = uVar7 + lVar9;
            }
          }
        }
        if ((lVar9 != 0) || (uVar10 != 0)) {
          lVar8 = LGetFleetStat((FLEET *)CONCAT22(iVar2,pFVar1),1);
          uVar7 = __aFulmul(uVar10,0x32);
          if (lVar8 < (long)(uVar7 + lVar9 + CONCAT22(*(undefined2 *)((int)pFVar1->rgwtMin + 0x12),
                                                      (int)pFVar1->rgwtMin[4]))) {
            lVar9 = LGetFleetStat((FLEET *)CONCAT22(iVar2,pFVar1),1);
          }
          else {
            uVar10 = __aFulmul(uVar10,0x32);
            lVar9 = uVar10 + lVar9 + CONCAT22(*(undefined2 *)((int)pFVar1->rgwtMin + 0x12),
                                              (int)pFVar1->rgwtMin[4]);
          }
          *(int *)(pFVar1->rgwtMin + 4) = (int)lVar9;
          *(undefined2 *)((int)pFVar1->rgwtMin + 0x12) = (int)((ulong)lVar9 >> 0x10);
        }
      }
      else {
        lVar9 = LGetFleetStat((FLEET *)CONCAT22(iVar2,pFVar1),1);
        *(int *)(pFVar1->rgwtMin + 4) = (int)lVar9;
        *(undefined2 *)((int)pFVar1->rgwtMin + 0x12) = (int)((ulong)lVar9 >> 0x10);
      }
    }
    ifl = ifl + 1;
  }
  return;
}



// ======================================================================
// Function: MoveFleets
// Address: 10b0:32ce
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Variable defined which should be unmapped: fDead */
/* WARNING: Removing unreachable block (ram,0x10b04c3a) */
/* WARNING: Removing unreachable block (ram,0x10b03dd4) */
/* WARNING: Removing unreachable block (ram,0x10b0441c) */
/* WARNING: Removing unreachable block (ram,0x10b0453b) */
/* WARNING: Removing unreachable block (ram,0x10b048d7) */
/* WARNING: Removing unreachable block (ram,0x10b04836) */
/* WARNING: Removing unreachable block (ram,0x10b03ef6) */
/* WARNING: Removing unreachable block (ram,0x10b0486f) */
/* WARNING: Removing unreachable block (ram,0x10b04913) */
/* WARNING: Removing unreachable block (ram,0x10b04964) */
/* WARNING: Removing unreachable block (ram,0x10b0497a) */
/* WARNING: Removing unreachable block (ram,0x10b04c8c) */
/* WARNING: Removing unreachable block (ram,0x10b04ed9) */
/* WARNING: Type propagation algorithm not settling */

void MoveFleets(void)

{
  int *piVar1;
  uint *puVar2;
  short *psVar3;
  uint uVar4;
  int iVar5;
  int iVar6;
  POINT pt;
  double dVar7;
  int iVar8;
  undefined1 extraout_AH;
  short sVar9;
  short sVar10;
  uint uVar11;
  THING *pTVar12;
  ORDER *pOVar13;
  uint *puVar14;
  FLEET *pFVar15;
  int iVar16;
  undefined2 unaff_SI;
  short *psVar17;
  ushort unaff_DI;
  FLEET *pFVar18;
  undefined2 uVar19;
  undefined2 uVar20;
  undefined2 unaff_SS;
  bool bVar21;
  bool bVar22;
  PLANET *pPVar23;
  ulong uVar24;
  long lVar25;
  FLEET *pFVar26;
  long lVar27;
  THING *pTVar28;
  THING *pTVar29;
  long lVar30;
  uint uVar31;
  PLORD *pPVar32;
  short sVar33;
  short p7;
  undefined2 uVar34;
  short fDead;
  short cKillTot;
  FLEET flDead;
  short cTry;
  undefined1 flSrc [104];
  POINT ptMsg;
  short isbsSrc;
  short isbsDst;
  undefined8 dxRound;
  undefined8 dyRound;
  SCAN scan;
  short fDone;
  undefined4 lFuelGain;
  undefined4 dActTravel;
  undefined4 wtFuelUsed;
  short ptBeg;
  uint local_3c;
  undefined4 dRange;
  short dMineTravel;
  undefined4 pct;
  double r;
  FLEET *lpfl;
  short ifl;
  int ptEnd;
  uint local_20;
  ORDER *lpord;
  short fRanOutOfFuel;
  short fGotEnufFuel;
  double d;
  undefined4 wtFuel2Dest;
  short cPass;
  long dTravel;
  
  lVar30 = CONCAT22(wtFuel2Dest._2_2_,(undefined2)wtFuel2Dest);
  lVar25 = CONCAT22(wtFuelUsed._2_2_,(undefined2)wtFuelUsed);
  cPass = 0;
  if (0 < cFleet) {
    do {
      fDone = 1;
      ifl = 0;
LAB_10b0_32fa:
      wtFuel2Dest = lVar30;
      wtFuelUsed = lVar25;
      if (ifl < cFleet) {
                    /* WARNING: Load size is inaccurate */
        pFVar15 = ((FLEET **)rglpfl)[ifl];
        iVar8 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar8,pFVar15);
        if ((pFVar15 != (FLEET *)0x0) || (iVar8 != 0)) {
          if (cPass == 0) {
            *(undefined2 *)&pFVar15->field17_0x74 = 0;
            pFVar15->wFlags = 0;
            pFVar15->wFlags = pFVar15->wFlags & 0xdfffU | 0x2000;
          }
          if ((((uint)pFVar15->wFlags >> 10 & 1) == 0) &&
             ((cPass < 1 || (((uint)pFVar15->wFlags >> 0xb & 1) == 0)))) {
            pFVar15->wFlags = pFVar15->wFlags & 0xf7ffU | 0x800;
            iVar16 = *(int *)&pFVar15->lpplord;
            uVar19 = *(undefined2 *)((int)&pFVar15->lpplord + 2);
            lpord = (ORDER *)CONCAT22(uVar19,(ORDER *)(iVar16 + 4));
            if (((*(uint *)(iVar16 + 10) & 0xf) == 1) ||
               ((((*(uint *)(iVar16 + 10) & 0xf) == 6 || (pFVar15->cord < 2)) ||
                ((*(uint *)(iVar16 + 0x1c) >> 4 & 0xf) == 0)))) goto LAB_10b0_32f6;
            if ((*(uint *)((int)&rgplr[0].wFlags + pFVar15->iPlayer * 0xc0) >> 2 & 1) != 0
               ) {
              if (((uint)game.turn < 0xb) ||
                 ((game.turn & 7U) != (pFVar15->iPlayer & 7U))) {
                sVar9 = Random(4);
                lVar25 = wtFuelUsed;
                lVar30 = wtFuel2Dest;
                if (sVar9 != 0) goto LAB_10b0_3496;
                FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                  idmHasRefusedMoveDoubtingAuthorityRulePress,-5,lpfl->id,0);
                lVar25 = wtFuelUsed;
                lVar30 = wtFuel2Dest;
              }
              goto LAB_10b0_32f6;
            }
LAB_10b0_3496:
            if (cPass == 0) {
              uVar19 = (undefined2)((ulong)lpord >> 0x10);
              if ((6 < ((uint)((ORDER *)lpord)[1].wFlags >> 4 & 0xf)) &&
                 (((uint)((ORDER *)lpord)[1].wFlags >> 4 & 0xf) != 0xb)) {
                wtFuelUsed = lVar25;
                wtFuel2Dest = lVar30;
                sVar9 = GetRaceGrbit((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                           ibitRaceCheapEngines);
                lVar25 = wtFuelUsed;
                lVar30 = wtFuel2Dest;
                if (sVar9 != 0) {
                  sVar9 = Random(10);
                  lVar25 = wtFuelUsed;
                  lVar30 = wtFuel2Dest;
                  if (sVar9 == 0) {
                    FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                      idmUnableEngageEnginesDueBalkyEquipmentEngineers,
                                      lpfl->id | 0x8000,lpfl->id,0);
                    lVar25 = wtFuelUsed;
                    lVar30 = wtFuel2Dest;
                    goto LAB_10b0_32f6;
                  }
                }
              }
            }
            uVar19 = (undefined2)((ulong)lpord >> 0x10);
            pOVar13 = (ORDER *)lpord;
            wtFuel2Dest = lVar30;
            wtFuelUsed = lVar25;
            if (((uint)pOVar13[1].wFlags >> 4 & 0xf) < 0xb) {
              uVar20 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar15 = (FLEET *)lpfl;
              ptBeg = (&pFVar15->pt)->x;
              local_3c = (pFVar15->pt).y;
              if ((0 < cPass) && (((uint)pOVar13[1].wFlags >> 0xd & 1) == 0)) {
                uVar34 = (undefined2)((ulong)pFVar15->lpflNext >> 0x10);
                pFVar15 = (FLEET *)pFVar15->lpflNext;
                sVar9 = (pFVar15->pt).y;
                ((pOVar13 + 1)->pt).x = (&pFVar15->pt)->x;
                pOVar13[1].pt.y = sVar9;
              }
              ptEnd = ((pOVar13 + 1)->pt).x;
              local_20 = pOVar13[1].pt.y;
              uVar24 = EstFuelUse(lpfl,0,-1,-1,1);
              dRange = uVar24;
              lVar25 = EstFuelUse(lpfl,0,-1,-1,0);
              uVar19 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar15 = (FLEET *)lpfl;
              fGotEnufFuel = (short)(lVar25 <=
                                    CONCAT22(*(undefined2 *)((int)pFVar15->rgwtMin + 0x12),
                                             (int)pFVar15->rgwtMin[4]));
              fRanOutOfFuel = 0;
              if (fGotEnufFuel != 0) {
                uVar20 = (undefined2)((ulong)lpord >> 0x10);
                pOVar13 = (ORDER *)lpord;
                if (((long)dRange < 0) ||
                   (((long)dRange < 0x10000 &&
                    ((uint)dRange <=
                     ((uint)pOVar13[1].wFlags >> 4 & 0xf) * ((uint)pOVar13[1].wFlags >> 4 & 0xf)))))
                {
                  dRange = (ulong)(((uint)pOVar13[1].wFlags >> 4 & 0xf) *
                                  ((uint)pOVar13[1].wFlags >> 4 & 0xf));
                }
              }
              if (cPass == 0) {
                iVar8 = *(int *)((int)pFVar15->rgwtMin + 0xe);
                if ((-1 < iVar8) && ((0 < iVar8 || (10 < *(uint *)(pFVar15->rgwtMin + 3))))) {
                  wtFuel2Dest = lVar25;
                  sVar9 = GetRaceStat((PLAYER *)rgplr + pFVar15->iPlayer,rsMajorAdv)
                  ;
                  lVar25 = wtFuel2Dest;
                  if (sVar9 == raMacintosh) {
                    uVar34 = 0;
                    uVar20 = 100;
                    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                    uVar24 = __aFulmul(CONCAT22(*(undefined2 *)
                                                         ((int)((FLEET *)lpfl)->rgwtMin + 0xe),
                                                        (int)((FLEET *)lpfl)->rgwtMin[3]),3);
                    lVar30 = __aFldiv(uVar24 + 0x21,CONCAT22(uVar34,uVar20));
                    uVar11 = (uint)lVar30;
                    lVar25 = wtFuel2Dest;
                    if (0 < lVar30) {
                      uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                      puVar2 = (uint *)(((FLEET *)lpfl)->rgwtMin + 3);
                      uVar31 = *puVar2;
                      *puVar2 = *puVar2 - uVar11;
                      piVar1 = (int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
                      *piVar1 = (*piVar1 - (int)((ulong)lVar30 >> 0x10)) - (uint)(uVar31 < uVar11);
                      p7 = 0;
                      sVar33 = 0;
                      sVar10 = 0;
                      sVar9 = 0;
                      uVar31 = lpfl->id;
                      uVar24 = __aFulshr((ulong)uVar31,0);
                      FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                       idmDueRigorsWarpAccelerationColonistsHaveDied,
                                       lpfl->id | 0x8000,uVar11,(short)uVar24,uVar31,sVar9,sVar10,
                                       sVar33,p7);
                      lVar25 = wtFuel2Dest;
                    }
                  }
                }
                if (((uint)((ORDER *)lpord)[1].wFlags >> 4 & 0xf) == 10) {
                  uVar19 = lpfl._2_2_;
                  psVar17 = (short *)flSrc;
                  pFVar15 = (FLEET *)lpfl;
                  wtFuel2Dest = lVar25;
                  for (iVar8 = 0x3e; iVar8 != 0; iVar8 = iVar8 + -1) {
                    psVar3 = psVar17;
                    psVar17 = psVar17 + 1;
                    pFVar26 = pFVar15;
                    pFVar15 = (FLEET *)&pFVar15->iPlayer;
                    *psVar3 = pFVar26->id;
                  }
                  fDead = 1;
                  cKillTot = 0;
                  _memset(&flDead,0,0x7c);
                  dyRound = 0;
                  lVar25 = wtFuel2Dest;
                  while( true ) {
                    pFVar15 = (FLEET *)lpfl;
                    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                    if (0xf < dyRound._4_2_) break;
                    if (*(int *)(flSrc + dyRound._4_2_ * 2 + 0xc) != 0) {
                      iVar8 = pFVar15->iPlayer * 4;
                      if (((((*(uint *)(*(int *)(iVar8 + 0xfe) + dyRound._4_2_ * 0x93 + 0x3c) & 0xff
                             ) != 7) &&
                           (iVar8 = pFVar15->iPlayer * 4,
                           (*(uint *)(*(int *)(iVar8 + 0xfe) + dyRound._4_2_ * 0x93 + 0x3c) & 0xff)
                           != 9)) &&
                          (iVar8 = pFVar15->iPlayer * 4,
                          (*(uint *)(*(int *)(iVar8 + 0xfe) + dyRound._4_2_ * 0x93 + 0x3c) & 0xff)
                          != 0xe)) &&
                         ((iVar8 = pFVar15->iPlayer * 4,
                          (*(uint *)(*(int *)(iVar8 + 0xfe) + dyRound._4_2_ * 0x93 + 0x3c) & 0xff)
                          != 0xf && (iVar8 = pFVar15->iPlayer * 4,
                                    (*(uint *)(*(int *)(iVar8 + 0xfe) + dyRound._4_2_ * 0x93 + 0x3c)
                                    & 0xff) != 8)))) {
                        cTry = *(short *)(flSrc + dyRound._4_2_ * 2 + 0xc);
                        while( true ) {
                          iVar8 = cTry + -1;
                          wtFuel2Dest = lVar25;
                          if (cTry == 0) break;
                          cTry = iVar8;
                          sVar9 = Random(10);
                          lVar25 = wtFuel2Dest;
                          if (sVar9 == 0) {
                            dyRound = CONCAT26(dyRound._6_2_ + 1,(undefined6)dyRound);
                          }
                        }
                        cTry = iVar8;
                        if (0 < dyRound._6_2_) {
                          cKillTot = cKillTot + dyRound._6_2_;
                          *(int *)(flSrc + dyRound._4_2_ * 2 + 0xc) =
                               *(int *)(flSrc + dyRound._4_2_ * 2 + 0xc) - dyRound._6_2_;
                          flDead.rgcsh[dyRound._4_2_] = dyRound._6_2_;
                          lVar25 = wtFuel2Dest;
                        }
                      }
                      if (0 < *(int *)(flSrc + dyRound._4_2_ * 2 + 0xc)) {
                        fDead = 0;
                      }
                    }
                    dyRound = (qword)(dyRound._4_2_ + 1) << 0x20;
                  }
                  wtFuel2Dest = lVar25;
                  if (fDead != 0) {
                    pFVar15->wFlags = pFVar15->wFlags & 0xfbffU | 0x400;
                    FSendPlrMsg2(pFVar15->iPlayer,
                                      idmDestroyedMassiveReactorAccidentDueUnsafeOperatin,
                                      lpfl->id | 0x8000,lpfl->id,0);
                    lVar25 = wtFuelUsed;
                    lVar30 = wtFuel2Dest;
                    goto LAB_10b0_32f6;
                  }
                  if (0 < cKillTot) {
                    flDead.iPlayer = flSrc._2_2_;
                    flDead.wFlags = flDead.wFlags & 0xfb00U | 0x407;
                    FleetTransferCargoBalance((FLEET *)flSrc,&flDead);
                    psVar17 = (short *)flSrc;
                    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                    pFVar18 = (FLEET *)lpfl;
                    pFVar15 = pFVar18;
                    for (iVar8 = 0x3e; iVar8 != 0; iVar8 = iVar8 + -1) {
                      pFVar26 = pFVar15;
                      pFVar15 = (FLEET *)&pFVar15->iPlayer;
                      psVar3 = psVar17;
                      psVar17 = psVar17 + 1;
                      pFVar26->id = *psVar3;
                    }
                    if (cKillTot == 1) {
                      FSendPlrMsg2(pFVar18->iPlayer,
                                        idmOneShipsDestroyedWhenEnginesReactedTrying,
                                        lpfl->id | 0x8000,lpfl->id,0);
                      lVar25 = wtFuel2Dest;
                    }
                    else {
                      FSendPlrMsg2(pFVar18->iPlayer,idmShipsDestroyedDueEngineStrain,
                                        lpfl->id | 0x8000,cKillTot,lpfl->id);
                      lVar25 = wtFuel2Dest;
                    }
                  }
                }
                uVar19 = (undefined2)((ulong)lpord >> 0x10);
                pOVar13 = (ORDER *)lpord;
                dTravel = (long)(((uint)pOVar13[1].wFlags >> 4 & 0xf) *
                                ((uint)pOVar13[1].wFlags >> 4 & 0xf));
                uVar24 = dRange;
                if (((uint)pOVar13[1].wFlags >> 8 & 0xf) == 2) {
                  wtFuel2Dest = lVar25;
                  pFVar26 = LpflFromId(pOVar13[1].id);
                  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                  pFVar15 = (FLEET *)lpfl;
                  *(FLEET **)&pFVar15->lpflNext = (FLEET *)pFVar26;
                  *(undefined2 *)((int)&pFVar15->lpflNext + 2) = (int)((ulong)pFVar26 >> 0x10);
                  if ((*(int *)&pFVar15->lpflNext != 0) ||
                     (uVar24 = dRange, lVar25 = wtFuel2Dest,
                     *(int *)((int)&pFVar15->lpflNext + 2) != 0)) {
                    fDone = 0;
                    pFVar15->wFlags = pFVar15->wFlags & 0xf7ff;
                    *(uint *)&pFVar15->field13_0x6c = (uint)dTravel;
                    pFVar15->dMoveUsed = 0;
                    *(undefined2 *)&pFVar15->lFuelUsed = 0;
                    *(undefined2 *)((int)&pFVar15->lFuelUsed + 2) = 0;
                    lVar25 = wtFuelUsed;
                    lVar30 = wtFuel2Dest;
                    goto LAB_10b0_32f6;
                  }
                }
              }
              else {
                if (((uint)((FLEET *)pFVar15->lpflNext)->wFlags >> 0xb & 1) == 0) {
                  if (*(int *)&pFVar15->field13_0x6c <
                      (*(int *)&pFVar15->field13_0x6c + pFVar15->dMoveUsed + 4) / 5) {
                    iVar8 = *(int *)&pFVar15->field13_0x6c;
                  }
                  else {
                    iVar8 = (*(int *)&pFVar15->field13_0x6c + pFVar15->dMoveUsed + 4) / 5;
                  }
                }
                else {
                  iVar8 = *(int *)&pFVar15->field13_0x6c;
                }
                dTravel = (long)iVar8;
                iVar8 = pFVar15->dMoveUsed;
                uVar24 = dRange - (long)iVar8;
                if (((int)(dRange - (long)iVar8 >> 0x10) < 1) &&
                   (uVar24 = dRange - (long)iVar8, (long)(dRange - (long)iVar8) < 0)) {
                  uVar24 = 0;
                }
              }
              dRange = uVar24;
              wtFuel2Dest = lVar25;
              dVar7 = DGetDistance(ptBeg,local_3c,ptEnd,local_20);
              d = *(double *)CONCAT11(extraout_AH,dVar7);
              lVar25 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,
                                                  unaff_DI))));
              iVar8 = (int)(uint)lVar25 >> 0xf;
              if ((iVar8 < dTravel._2_2_) ||
                 ((iVar8 <= dTravel._2_2_ && ((uint)lVar25 <= (uint)dTravel)))) {
                lVar25 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,
                                                  unaff_DI))));
                dTravel._0_2_ = (uint)lVar25;
                dTravel._2_2_ = (int)(uint)dTravel >> 0xf;
              }
              if ((long)dRange < dTravel) {
                *(undefined2 *)(((FLEET *)lpfl)->rgwtMin + 4) = 0;
                *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = 0;
                lVar25 = 1;
                dTravel = dRange;
              }
              else {
                if (0 < cPass) {
                  uVar31 = *(uint *)&((FLEET *)lpfl)->lFuelUsed;
                  iVar8 = *(int *)((int)&((FLEET *)lpfl)->lFuelUsed + 2);
                  puVar2 = (uint *)(((FLEET *)lpfl)->rgwtMin + 4);
                  uVar11 = *puVar2;
                  *puVar2 = *puVar2 + uVar31;
                  piVar1 = (int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
                  *piVar1 = *piVar1 + iVar8 + (uint)CARRY2(uVar11,uVar31);
                  uVar11 = ((FLEET *)lpfl)->dMoveUsed;
                  dTravel = CONCAT22(dTravel._2_2_ + ((int)uVar11 >> 0xf) +
                                     (uint)CARRY2((uint)dTravel,uVar11),(uint)dTravel + uVar11);
                }
                lVar25 = EstFuelUse(lpfl,0,-1,dTravel,0);
                iVar8 = (int)((ulong)lVar25 >> 0x10);
                uVar11 = (uint)lVar25;
                pFVar15 = (FLEET *)lpfl;
                uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                if (0 < cPass) {
                  *(uint *)&pFVar15->lFuelUsed = uVar11;
                  *(int *)((int)&pFVar15->lFuelUsed + 2) = iVar8;
                  uVar31 = pFVar15->dMoveUsed;
                  dTravel = CONCAT22((dTravel._2_2_ - ((int)uVar31 >> 0xf)) -
                                     (uint)((uint)dTravel < uVar31),(uint)dTravel - uVar31);
                }
                iVar16 = (*(int *)((int)pFVar15->rgwtMin + 0x12) - iVar8) -
                         (uint)(*(uint *)(pFVar15->rgwtMin + 4) < uVar11);
                if ((iVar16 < 1) && (iVar16 < 0)) {
                  iVar16 = 0;
                  iVar8 = 0;
                }
                else {
                  iVar16 = *(uint *)(pFVar15->rgwtMin + 4) - uVar11;
                  iVar8 = (*(int *)((int)pFVar15->rgwtMin + 0x12) - iVar8) -
                          (uint)(*(uint *)(pFVar15->rgwtMin + 4) < uVar11);
                }
                *(int *)(pFVar15->rgwtMin + 4) = iVar16;
                *(int *)((int)pFVar15->rgwtMin + 0x12) = iVar8;
              }
              uVar19 = (undefined2)((ulong)lpfl >> 0x10);
              lVar30 = wtFuel2Dest;
              if ((((int)((FLEET *)lpfl)->rgwtMin[4] == 0) &&
                  (*(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) == 0)) && (0 < lVar25)) {
                bVar21 = false;
                wtFuelUsed = lVar25;
                __aFfcompp();
                lVar25 = wtFuelUsed;
                lVar30 = wtFuel2Dest;
                if (((!bVar21) || (dRange == 0)) && (fGotEnufFuel == 0)) {
                  uVar11 = 0;
                  do {
                    uVar31 = uVar11;
                    uVar11 = uVar31 + 1;
                    lVar25 = EstFuelUse(lpfl,0,uVar11,-1,0);
                    if (lVar25 != 0) break;
                  } while ((int)uVar11 < 10);
                  pFVar15 = (FLEET *)lpfl;
                  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                  if ((int)uVar11 < 2) {
                    FSendPlrMsg2(pFVar15->iPlayer,idmHasRunFuel,lpfl->id | 0x8000,lpfl->id,0);
                  }
                  else {
                    ((PLORD *)pFVar15->lpplord + 7)->wFlags =
                         ((PLORD *)pFVar15->lpplord + 7)->wFlags & 0xff0fU | (uVar31 & 0xf) << 4;
                    FSendPlrMsg2(pFVar15->iPlayer,idmHasRunFuelFleetsSpeedHasDecreased,
                                      lpfl->id | 0x8000,lpfl->id,uVar31);
                  }
                  fRanOutOfFuel = 1;
                  lVar25 = wtFuelUsed;
                  lVar30 = wtFuel2Dest;
                }
              }
              if (dRange == 0) goto LAB_10b0_32f6;
              uVar19 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar15 = (FLEET *)lpfl;
              pFVar15->wFlags = pFVar15->wFlags & 0xdfff;
              iVar8 = ptEnd - ptBeg;
              sVar9 = local_20 - local_3c;
              if ((iVar8 != 0) || (sVar9 != 0)) {
                pFVar15->wFlags = pFVar15->wFlags & 0xffefU | 0x10;
                do {
                  wtFuelUsed = lVar25;
                  wtFuel2Dest = lVar30;
                  sVar10 = _abs(iVar8);
                  lVar25 = wtFuelUsed;
                  lVar30 = wtFuel2Dest;
                  if (sVar10 < 0x80) {
                    sVar10 = _abs(sVar9);
                    lVar25 = wtFuelUsed;
                    lVar30 = wtFuel2Dest;
                    if (sVar10 < 0x80) goto LAB_10b0_46ff;
                  }
                  iVar8 = iVar8 / 2;
                  sVar9 = sVar9 / 2;
                } while( true );
              }
              goto code_r0x10b04783;
            }
            dxRound = (double)((qword)dxRound & 0xffffffffffff0000);
            gd._0_2_ = gd._0_2_ & 0xffbf;
            ptBeg = (lpord->pt).x;
            local_3c = (pOVar13->pt).y;
            if (((uint)pOVar13->wFlags >> 8 & 0xf) == 1) {
              ptMsg.x = -1;
              ptMsg.y = pOVar13->id;
              pPVar23 = LpplFromId(pOVar13->id);
              dxRound._0_6_ = CONCAT24((int)((ulong)pPVar23 >> 0x10),(long)pPVar23 << 0x10);
              dxRound = (double)(qword)(uint6)dxRound;
              isbsSrc = IStargateFromLppl(pPVar23);
            }
            else {
              isbsSrc = -1;
              ptMsg.x = ptBeg;
              ptMsg.y = local_3c;
            }
            if (isbsSrc == -1) {
              sVar9 = FFleetCanJumpgate(lpfl);
              if (sVar9 != 0) goto TURN_LNoGateNeeded;
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmAttemptedUseStargateStargateExistsThere,
                               lpfl->id | 0x8000,lpfl->id,ptMsg.x,ptMsg.y,0,0,0,0);
              lVar25 = wtFuelUsed;
              lVar30 = wtFuel2Dest;
              goto LAB_10b0_32f6;
            }
            uVar19 = (undefined2)((qword)dxRound >> 0x20);
            iVar8 = (int)((qword)dxRound >> 0x10);
            if ((*(int *)(iVar8 + 2) != ((FLEET *)lpfl)->iPlayer) &&
               (flSrc._98_2_ = *(int *)(iVar8 + 2) * 0xc0 + 0x5a12,
               *(char *)(flSrc._98_2_ + ((FLEET *)lpfl)->iPlayer) != '\x01')) {
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                               idmAttemptedUseStargateCouldBecauseStarbaseOwned,lpfl->id | 0x8000,
                               lpfl->id,*dxRound._2_4_,*dxRound._2_4_,0,0,0,0);
              lVar25 = wtFuelUsed;
              lVar30 = wtFuel2Dest;
              goto LAB_10b0_32f6;
            }
TURN_LNoGateNeeded:
            uVar19 = (undefined2)((ulong)lpord >> 0x10);
            pOVar13 = (ORDER *)lpord;
            ptEnd = ((pOVar13 + 1)->pt).x;
            local_20 = pOVar13[1].pt.y;
            if (((uint)pOVar13[1].wFlags >> 8 & 0xf) == 1) {
              ptMsg.x = -1;
              ptMsg.y = pOVar13[1].id;
              pPVar23 = LpplFromId(pOVar13[1].id);
              isbsDst = IStargateFromLppl(pPVar23);
            }
            else {
              dxRound = (double)((qword)dxRound & 0xffffffffffff);
              while ((dxRound._6_2_ < game.cPlanMax &&
                     ((ptEnd != ((POINT *)rgptPlan + dxRound._6_2_)->x ||
                      (local_20 != *(uint *)((int)&rgptPlan[0].y + dxRound._6_2_ * 4))))))
              {
                dxRound = (double)CONCAT26(dxRound._6_2_ + 1,(uint6)dxRound);
              }
              if (game.cPlanMax <= dxRound._6_2_) {
                ptMsg.x = ptEnd;
                ptMsg.y = local_20;
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                 idmAttemptedReachViaStargateCouldBecauseStargate,lpfl->id | 0x8000,
                                 lpfl->id,ptEnd,local_20,0,0,0,0);
                lVar25 = wtFuelUsed;
                lVar30 = wtFuel2Dest;
                goto LAB_10b0_32f6;
              }
              ptMsg.x = -1;
              ptMsg.y = dxRound._6_2_;
              pPVar23 = LpplFromId(dxRound._6_2_);
              isbsDst = IStargateFromLppl(pPVar23);
            }
            pFVar15 = (FLEET *)lpfl;
            uVar19 = (undefined2)((ulong)lpfl >> 0x10);
            if (isbsDst == -1) {
              FSendPlrMsg(pFVar15->iPlayer,idmAttemptedUseStargateReachCouldBecauseStargate,
                               lpfl->id | 0x8000,lpfl->id,pPVar23->id,ptMsg.x,ptMsg.y,0,0,0);
              lVar25 = wtFuelUsed;
              lVar30 = wtFuel2Dest;
              goto LAB_10b0_32f6;
            }
            uVar20 = (undefined2)((ulong)pPVar23 >> 0x10);
            if ((((PLANET *)pPVar23)->iPlayer != pFVar15->iPlayer) &&
               (flSrc._98_2_ = ((PLANET *)pPVar23)->iPlayer * 0xc0 + 0x5a12,
               *(char *)(flSrc._98_2_ + pFVar15->iPlayer) != '\x01')) {
              FSendPlrMsg(pFVar15->iPlayer,idmAttemptedUseStargateReachCouldBecauseStarbase,
                               lpfl->id | 0x8000,lpfl->id,pPVar23->id,pPVar23->id,pPVar23->id,0,0,0)
              ;
              lVar25 = wtFuelUsed;
              lVar30 = wtFuel2Dest;
              goto LAB_10b0_32f6;
            }
            if (isbsSrc == -1) {
              dxRound = (double)CONCAT62(dxRound._2_6_,1);
              isbsSrc = isbsDst;
            }
            if ((int)dxRound == 0) {
              sVar9 = GetRaceStat((PLAYER *)rgplr + pFVar15->iPlayer,rsMajorAdv);
              if (sVar9 != raStargate) {
                uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar15 = (FLEET *)lpfl;
                iVar8 = *(int *)((int)pFVar15->rgwtMin + 0xe);
                if ((-1 < iVar8) &&
                   (((0 < iVar8 || ((int)pFVar15->rgwtMin[3] != 0)) &&
                    (*(int *)((int)((qword)dxRound >> 0x10) + 2) != pFVar15->iPlayer)))) {
                  FSendPlrMsg2(pFVar15->iPlayer,idmUnableUseStargateBecauseHadColonistsBoard,
                                    lpfl->id | 0x8000,lpfl->id,*dxRound._2_4_);
                  lVar25 = wtFuelUsed;
                  lVar30 = wtFuel2Dest;
                  goto LAB_10b0_32f6;
                }
                flSrc._100_2_ = (PLORD *)0x0;
                flSrc._102_2_ = 0;
                dxRound = (double)((qword)dxRound & 0xffffffffffff);
                while( true ) {
                  iVar8 = dxRound._2_2_;
                  uVar20 = dxRound._4_2_;
                  if (2 < dxRound._6_2_) break;
                  if (((int)pFVar15->rgwtMin[dxRound._6_2_] != 0) ||
                     (*(int *)((int)(pFVar15->rgwtMin + dxRound._6_2_) + 2) != 0)) {
                    uVar11 = *(uint *)(pFVar15->rgwtMin + dxRound._6_2_);
                    bVar21 = CARRY2(flSrc._100_2_,uVar11);
                    flSrc._100_2_ = (int)(short *)flSrc._100_2_ + uVar11;
                    flSrc._102_2_ =
                         flSrc._102_2_ + *(uint *)((int)(pFVar15->rgwtMin + dxRound._6_2_) + 2) +
                         (uint)bVar21;
                    uVar31 = *(uint *)(pFVar15->rgwtMin + dxRound._6_2_);
                    uVar4 = *(uint *)((int)(pFVar15->rgwtMin + dxRound._6_2_) + 2);
                    puVar14 = (uint *)(dxRound._2_2_ + 0x1c + dxRound._6_2_ * 4);
                    puVar2 = puVar14;
                    uVar11 = *puVar2;
                    *puVar2 = *puVar2 + uVar31;
                    puVar2 = puVar14 + 1;
                    *puVar2 = *puVar2 + uVar4 + (uint)CARRY2(uVar11,uVar31);
                    *(undefined2 *)(pFVar15->rgwtMin + dxRound._6_2_) = 0;
                    *(undefined2 *)((int)(pFVar15->rgwtMin + dxRound._6_2_) + 2) = 0;
                  }
                  dxRound = (double)CONCAT26(dxRound._6_2_ + 1,(uint6)dxRound);
                }
                iVar16 = (int)pFVar15->rgwtMin[3];
                iVar5 = *(int *)((int)pFVar15->rgwtMin + 0xe);
                uVar31 = *(uint *)(pFVar15->rgwtMin + 3);
                iVar6 = *(int *)((int)pFVar15->rgwtMin + 0xe);
                puVar2 = (uint *)(iVar8 + 0x28);
                uVar11 = *puVar2;
                *puVar2 = *puVar2 + uVar31;
                *(int *)(iVar8 + 0x2a) =
                     *(int *)(iVar8 + 0x2a) + iVar6 + (uint)CARRY2(uVar11,uVar31);
                *(undefined2 *)(pFVar15->rgwtMin + 3) = 0;
                *(undefined2 *)((int)pFVar15->rgwtMin + 0xe) = 0;
                if ((iVar16 == 0) && (iVar5 == 0)) {
                  if (((PLORD *)flSrc._100_2_ != (PLORD *)0x0) || (flSrc._102_2_ != 0)) {
                    sVar33 = 0;
                    sVar10 = 0;
                    sVar9 = 0;
                    uVar11 = *dxRound._2_4_;
                    uVar24 = __aFulshr((ulong)uVar11,0);
                    FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                     idmHasUnloadedKtMineralsPreparationJumpingThrough,
                                     lpfl->id | 0x8000,lpfl->id,flSrc._100_2_,(short)uVar24,uVar11,
                                     sVar9,sVar10,sVar33);
                    if (((FLEET *)lpfl)->iPlayer != *(int *)(iVar8 + 2)) {
                      sVar33 = 0;
                      sVar10 = 0;
                      sVar9 = 0;
                      uVar11 = *dxRound._2_4_;
                      uVar24 = __aFulshr((ulong)uVar11,0);
                      FSendPlrMsg(*(short *)(iVar8 + 2),
                                       idmHasUnloadedKtMineralsPreparationJumpingThrough,
                                       *dxRound._2_4_,lpfl->id,flSrc._100_2_,(short)uVar24,uVar11,
                                       sVar9,sVar10,sVar33);
                    }
                  }
                }
                else if (((PLORD *)flSrc._100_2_ == (PLORD *)0x0) && (flSrc._102_2_ == 0)) {
                  sVar33 = 0;
                  sVar10 = 0;
                  sVar9 = 0;
                  uVar11 = *dxRound._2_4_;
                  uVar24 = __aFulshr((ulong)uVar11,0);
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                   idmHasUnloadedColonistsPreparationJumpingThroughSta,
                                   lpfl->id | 0x8000,lpfl->id,iVar16,(short)uVar24,uVar11,sVar9,
                                   sVar10,sVar33);
                  if (((FLEET *)lpfl)->iPlayer != *(int *)(iVar8 + 2)) {
                    sVar33 = 0;
                    sVar10 = 0;
                    sVar9 = 0;
                    uVar11 = *dxRound._2_4_;
                    uVar24 = __aFulshr((ulong)uVar11,0);
                    FSendPlrMsg(*(short *)(iVar8 + 2),
                                     idmHasUnloadedColonistsPreparationJumpingThroughSta,
                                     *dxRound._2_4_,lpfl->id,iVar16,(short)uVar24,uVar11,sVar9,
                                     sVar10,sVar33);
                  }
                }
                else {
                  sVar10 = 0;
                  uVar11 = *dxRound._2_4_;
                  uVar24 = __aFulshr((ulong)uVar11,unaff_DI);
                  sVar9 = (short)uVar24;
                  pPVar32 = (PLORD *)flSrc._100_2_;
                  uVar24 = __aFulshr((ulong)CONCAT22(sVar9,flSrc._100_2_),uVar11);
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                   idmHasUnloadedColonistsKtMineralsPreparationJumping,
                                   lpfl->id | 0x8000,lpfl->id,iVar16,(short)uVar24,(short)pPVar32,
                                   sVar9,uVar11,sVar10);
                  if (((FLEET *)lpfl)->iPlayer != *(int *)(iVar8 + 2)) {
                    sVar10 = 0;
                    uVar11 = *dxRound._2_4_;
                    uVar24 = __aFulshr((ulong)uVar11,unaff_DI);
                    sVar9 = (short)uVar24;
                    pPVar32 = (PLORD *)flSrc._100_2_;
                    uVar24 = __aFulshr((ulong)CONCAT22(sVar9,flSrc._100_2_),uVar11);
                    FSendPlrMsg(*(short *)(iVar8 + 2),
                                     idmHasUnloadedColonistsKtMineralsPreparationJumping,
                                     *dxRound._2_4_,lpfl->id,iVar16,(short)uVar24,(short)pPVar32,
                                     sVar9,uVar11,sVar10);
                  }
                }
              }
            }
            DGetDistance(ptBeg,local_3c,ptEnd,local_20);
            dTravel = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,
                                                  unaff_DI))));
            sVar9 = FStargateJump(lpfl,isbsSrc,isbsDst,(short)dTravel);
            lVar25 = wtFuelUsed;
            lVar30 = wtFuel2Dest;
            if (sVar9 == 0) goto LAB_10b0_32f6;
            uVar19 = (undefined2)((ulong)lpfl >> 0x10);
            ((FLEET *)lpfl)->wFlags = ((FLEET *)lpfl)->wFlags & 0xdfff;
            NoAutoTrackFleet(lpfl);
            lVar27 = dActTravel;
            goto TURN_LMakeItToDest;
          }
          goto LAB_10b0_32f6;
        }
      }
    } while ((fDone == 0) && (iVar8 = cPass + 1, bVar21 = cPass < 10, cPass = iVar8, bVar21));
    KillUsedWaypoints();
  }
  return;
LAB_10b0_46ff:
  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar15 = (FLEET *)lpfl;
  *(uint *)&pFVar15->field17_0x74 = *(uint *)&pFVar15->field17_0x74 & 0xff00 | iVar8 + 0x7fU & 0xff;
  *(uint *)&pFVar15->field17_0x74 = *(uint *)&pFVar15->field17_0x74 & 0xff | (sVar9 + 0x7f) * 0x100;
  dyRound._2_2_ = (uint)((PLORD *)pFVar15->lpplord + 7)->wFlags >> 4 & 0xf;
  pFVar15->wFlags = pFVar15->wFlags & 0xfff0U | dyRound._2_2_;
code_r0x10b04783:
  wtFuelUsed = lVar25;
  wtFuel2Dest = lVar30;
  lVar27 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,unaff_DI))));
  iVar8 = (int)((ulong)lVar27 >> 0x10);
  if ((iVar8 < dTravel._2_2_) ||
     ((dMineTravel = (uint)dTravel, iVar8 <= dTravel._2_2_ && ((uint)lVar27 <= (uint)dTravel)))) {
    dMineTravel = (uint)lVar27;
  }
  if (((uint)((ORDER *)lpord)[1].wFlags >> 4 & 0xf) < 0xb) {
    dActTravel = lVar27;
    sVar9 = FTravelThroughMineFields(lpfl,&dMineTravel,(THING *)0x0);
    lVar27 = dActTravel;
    if (sVar9 != 0) goto LAB_10b0_484b;
    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
    *(undefined2 *)&((FLEET *)lpfl)->field13_0x6c = 0;
    lVar25 = wtFuelUsed;
    lVar30 = wtFuel2Dest;
    if (((uint)((FLEET *)lpfl)->wFlags >> 10 & 1) != 0) goto LAB_10b0_32f6;
    if (dMineTravel < dActTravel) {
      dTravel = (long)dMineTravel;
    }
  }
  else {
LAB_10b0_484b:
    if (fRanOutOfFuel == 0) {
      dActTravel = lVar27;
      lVar25 = GetFuelFree(lpfl);
      lVar27 = dActTravel;
      if (0 < lVar25) {
        if ((dActTravel._2_2_ < dTravel._2_2_) ||
           ((lVar25 = dTravel, dActTravel._2_2_ <= dTravel._2_2_ &&
            ((uint)dActTravel <= (uint)dTravel)))) {
          lVar25 = dActTravel;
        }
        lVar25 = LCalcFuelGainFromRamScoops
                           (lpfl,(uint)((ORDER *)lpord)[1].wFlags >> 4 & 0xf,lVar25);
        lVar27 = dActTravel;
        lFuelGain = lVar25;
        if (0 < lVar25) {
          ChgCargo(grobjFleet,lpfl->id,4,lVar25,(void *)0x0);
          if (0x7ef4 < lFuelGain) {
            lFuelGain = 0x7ef4;
          }
          FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmSRamScoopsHaveProducedMgFuel,
                            lpfl->id | 0x8000,lpfl->id,(short)lFuelGain);
          lVar27 = dActTravel;
        }
      }
    }
  }
  if ((lVar27 < dTravel) || (lVar27 < 1)) {
TURN_LMakeItToDest:
    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar15 = (FLEET *)lpfl;
    (&pFVar15->pt)->x = ptEnd;
    (pFVar15->pt).y = local_20;
    uVar20 = (undefined2)((ulong)lpord >> 0x10);
    if (((uint)((ORDER *)lpord)[1].wFlags >> 8 & 0xf) == 1) {
      pFVar15->idPlanet = ((ORDER *)lpord)[1].id;
    }
    else {
      pFVar15->idPlanet = -1;
    }
    if (0 < cPass) {
      ((FLEET *)pFVar15->lpflNext)->wFlags = ((FLEET *)pFVar15->lpflNext)->wFlags & 0xf7ffU | 0x800;
    }
  }
  else {
    dxRound = DOUBLE_0_5__1120_1d5e;
    if (ptEnd <= ptBeg) {
      dxRound = DOUBLE_m0_5__1120_1d66;
    }
    bVar21 = local_20 < local_3c;
    bVar22 = local_20 == local_3c;
    dActTravel = lVar27;
    __aFfcompp();
    if (bVar21 || bVar22) {
      __aFfcompp();
      lVar27 = dActTravel;
      if (bVar21) goto code_r0x10b04a5c;
    }
    else {
code_r0x10b04a5c:
      r = (double)dTravel / d;
      ptMsg.x = ptEnd - ptBeg;
      ptMsg.y = ptMsg.x >> 0xf;
      lVar25 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,unaff_DI)))
                             );
      (&((FLEET *)lpfl)->pt)->x = (int)lVar25 + ptBeg;
      ptMsg.x = local_20 - local_3c;
      ptMsg.y = ptMsg.x >> 0xf;
      lVar25 = __ftol((double)CONCAT26(cKillTot,CONCAT24(fDead,CONCAT22(unaff_SI,unaff_DI)))
                             );
      uVar19 = (undefined2)((ulong)lpfl >> 0x10);
      (((FLEET *)lpfl)->pt).y = (int)lVar25 + local_3c;
      ((FLEET *)lpfl)->idPlanet = -1;
      lVar27 = dActTravel;
    }
    if (0 < cPass) {
      uVar19 = (undefined2)((ulong)lpfl >> 0x10);
      pFVar15 = (FLEET *)lpfl;
      if (0 < *(int *)&pFVar15->field13_0x6c) {
        pFVar15->dMoveUsed = pFVar15->dMoveUsed + (uint)dTravel;
        *(uint *)&pFVar15->field13_0x6c = *(int *)&pFVar15->field13_0x6c - (uint)dTravel;
        if ((0 < *(int *)&pFVar15->field13_0x6c) && (fRanOutOfFuel == 0)) {
          fDone = 0;
          pFVar15->wFlags = pFVar15->wFlags & 0xf7ff;
        }
      }
    }
  }
  if (((uint)gd._0_2_ >> 6 & 1) != 0) {
    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar15 = (FLEET *)lpfl;
    iVar8 = *(int *)((int)pFVar15->rgwtMin + 0xe);
    if ((-1 < iVar8) &&
       ((((0 < iVar8 || ((int)pFVar15->rgwtMin[3] != 0)) && (cPass < 2)) &&
        (((int)*(char *)((int)rgplr[0].rgEnvVarMin + 2 + pFVar15->iPlayer * 0xc0) +
          (int)*(char *)((int)rgplr[0].rgEnvVarMax + 2 + pFVar15->iPlayer * 0xc0) < 0xaa
         && (*(char *)((int)rgplr[0].rgEnvVarMax + 2 + pFVar15->iPlayer * 0xc0) != -1)))))
       ) {
      iVar8 = 0x56 - ((int)*(char *)((int)rgplr[0].rgEnvVarMin + 2 +
                                    pFVar15->iPlayer * 0xc0) +
                     (int)*(char *)((int)rgplr[0].rgEnvVarMax + 2 +
                                   pFVar15->iPlayer * 0xc0)) / 2;
      pct._0_2_ = iVar8 >> 1;
      pct._2_2_ = iVar8 >> 0xf;
      uVar34 = 0;
      uVar20 = 100;
      dActTravel = lVar27;
      uVar24 = __aFulmul(CONCAT22(pct._2_2_,(uint)pct),
                                 CONCAT22(*(undefined2 *)((int)pFVar15->rgwtMin + 0xe),
                                          (int)pFVar15->rgwtMin[3]));
      pct = __aFldiv(uVar24,CONCAT22(uVar34,uVar20));
      lVar25 = pct;
      if (pct < 1) {
        lVar25 = 1;
      }
      iVar16 = (int)((ulong)lVar25 >> 0x10);
      uVar19 = (undefined2)((ulong)lpfl >> 0x10);
      pFVar15 = (FLEET *)lpfl;
      iVar8 = *(int *)((int)pFVar15->rgwtMin + 0xe);
      if ((iVar16 < iVar8) ||
         ((iVar16 <= iVar8 && ((uint)lVar25 <= *(uint *)(pFVar15->rgwtMin + 3))))) {
        if (pct < 1) {
          pct = 1;
        }
      }
      else {
        pct = CONCAT22(*(undefined2 *)((int)pFVar15->rgwtMin + 0xe),(int)pFVar15->rgwtMin[3]);
      }
      FSendPlrMsg2(pFVar15->iPlayer,idmEngineRadiationHasKilledColonistsTraveling,
                        lpfl->id | 0x8000,(short)pct,lpfl->id);
      uVar19 = (undefined2)((ulong)lpfl >> 0x10);
      puVar2 = (uint *)(((FLEET *)lpfl)->rgwtMin + 3);
      uVar11 = *puVar2;
      *puVar2 = *puVar2 - (uint)pct;
      piVar1 = (int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
      *piVar1 = (*piVar1 - pct._2_2_) - (uint)(uVar11 < (uint)pct);
      lVar27 = dActTravel;
    }
  }
  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
  dActTravel = lVar27;
  if ((ptEnd == (&((FLEET *)lpfl)->pt)->x) && (local_20 == (((FLEET *)lpfl)->pt).y)) {
    uVar19 = (undefined2)((ulong)lpord >> 0x10);
    if (((uint)((ORDER *)lpord)[1].wFlags >> 8 & 0xf) == 8) {
      pTVar28 = LpthFromId(((ORDER *)lpord)[1].id);
      uVar19 = (undefined2)((ulong)pTVar28 >> 0x10);
      if ((pTVar28 != (THING *)0x0) && ((uint)pTVar28->idFull >> 0xd == 2)) {
        uVar11 = 1 << ((byte)((FLEET *)lpfl)->iPlayer & 0x1f);
        dxRound = (double)CONCAT26(uVar11,(uint6)dxRound);
        pTVar29 = LpthFromId(*(short *)(((THING *)pTVar28)->rgb + 6));
        uVar20 = (undefined2)((ulong)pTVar29 >> 0x10);
        pTVar12 = (THING *)pTVar29;
        NoAutoTrackFleet(lpfl);
        puVar2 = (uint *)(((THING *)pTVar28)->rgb + 4);
        *puVar2 = *puVar2 | uVar11;
        *(uint *)(pTVar12->rgb + 4) = *(uint *)(pTVar12->rgb + 4) | uVar11;
        *(uint *)(pTVar12->rgb + 2) = *(uint *)(pTVar12->rgb + 2) | uVar11;
        sVar9 = (pTVar12->pt).y;
        uVar19 = (undefined2)((ulong)lpfl >> 0x10);
        (&((FLEET *)lpfl)->pt)->x = (&pTVar12->pt)->x;
        (((FLEET *)lpfl)->pt).y = sVar9;
        sVar9 = (pTVar12->pt).y;
        uVar19 = (undefined2)((ulong)lpord >> 0x10);
        (((ORDER *)lpord + 1)->pt).x = (&pTVar12->pt)->x;
        ((ORDER *)lpord)[1].pt.y = sVar9;
      }
    }
  }
  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar15 = (FLEET *)lpfl;
  lVar25 = wtFuelUsed;
  lVar30 = wtFuel2Dest;
  if (pFVar15->idPlanet == -1) {
    pt.y = (pFVar15->pt).y;
    pt.x = (&pFVar15->pt)->x;
    sVar9 = FFindNearestObject(pt,0x81,&scan);
    lVar25 = wtFuelUsed;
    lVar30 = wtFuel2Dest;
    if (sVar9 != 0) {
      ((FLEET *)lpfl)->idPlanet = scan.idpl;
    }
  }
  uVar19 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar15 = (FLEET *)lpfl;
  sVar9 = (pFVar15->pt).y;
  uVar20 = (undefined2)((ulong)lpord >> 0x10);
  pOVar13 = (ORDER *)lpord;
  (lpord->pt).x = (&pFVar15->pt)->x;
  (pOVar13->pt).y = sVar9;
  pOVar13->id = pFVar15->idPlanet;
  if (pFVar15->idPlanet == -1) {
    iVar8 = 4;
  }
  else {
    iVar8 = 1;
  }
  pOVar13->wFlags = pOVar13->wFlags & 0xf0ffU | iVar8 << 8;
  if (fGotEnufFuel != 0) {
    wtFuelUsed = lVar25;
    wtFuel2Dest = lVar30;
    lVar30 = EstFuelUse(lpfl,0,-1,-1,0);
    iVar16 = (int)((ulong)lVar30 >> 0x10);
    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
    iVar8 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
    lVar25 = wtFuelUsed;
    if ((iVar8 <= iVar16) &&
       ((iVar8 < iVar16 || (*(uint *)(((FLEET *)lpfl)->rgwtMin + 4) < (uint)lVar30)))) {
      wtFuel2Dest = lVar30;
      lVar25 = LGetFleetStat(lpfl,1);
      if (wtFuel2Dest < lVar25) {
        *(undefined2 *)(((FLEET *)lpfl)->rgwtMin + 4) = (undefined2)wtFuel2Dest;
        *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = wtFuel2Dest._2_2_;
        lVar25 = wtFuelUsed;
        lVar30 = wtFuel2Dest;
      }
      else {
        lVar25 = LGetFleetStat(lpfl,1);
        uVar19 = (undefined2)((ulong)lpfl >> 0x10);
        *(int *)(((FLEET *)lpfl)->rgwtMin + 4) = (int)lVar25;
        *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = (int)((ulong)lVar25 >> 0x10);
        lVar25 = wtFuelUsed;
        lVar30 = wtFuel2Dest;
      }
    }
  }
LAB_10b0_32f6:
  ifl = ifl + 1;
  goto LAB_10b0_32fa;
}



// ======================================================================
// Function: FTravelThroughMineFields
// Address: 10b0:4f60
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b0625c) */
/* WARNING: Removing unreachable block (ram,0x10b060fd) */
/* WARNING: Removing unreachable block (ram,0x10b05ac0) */
/* WARNING: Removing unreachable block (ram,0x10b060c7) */
/* WARNING: Removing unreachable block (ram,0x10b06121) */
/* WARNING: Removing unreachable block (ram,0x10b066fc) */
/* WARNING: Removing unreachable block (ram,0x10b05bde) */
/* WARNING: Type propagation algorithm not settling */

short FTravelThroughMineFields(FLEET *lpfl,short *pdTravel,THING *lpthHit)

{
  uint *puVar1;
  FLEET *pFVar2;
  FLEET *pFVar3;
  POINT ptL2;
  POINT ptC;
  uint uVar4;
  short sVar5;
  MessageId MVar6;
  ushort uVar7;
  int iVar8;
  int iVar9;
  FLEET *pFVar10;
  PLORD *pPVar11;
  THING *pTVar12;
  undefined2 unaff_SI;
  FLEET *pFVar13;
  FLEET *pFVar14;
  undefined2 unaff_DI;
  undefined2 uVar15;
  undefined *puVar16;
  undefined2 unaff_SS;
  bool bVar17;
  ENGINE *pEVar18;
  ulong uVar19;
  long lVar20;
  ulong uVar21;
  POINT ptL1;
  short sVar22;
  short sVar23;
  undefined2 uVar24;
  short sVar25;
  undefined2 uVar26;
  short sVar27;
  short p7;
  ushort in_stack_0000fe06;
  short cEngines;
  short rgFieldS [24];
  short dmgPer;
  short fHasRamScoop;
  THING *lpthSalvage;
  short cishInc;
  THING *lpthClosest;
  int rgFieldE [24];
  short iType;
  undefined4 dpShield;
  short dx;
  short raMajor;
  int rgcField [3];
  short cshDead;
  undefined4 dmgTot;
  short pct;
  int rgi [5];
  THING *lpthMac;
  int local_15c;
  FLEET flDead;
  short dStart;
  short cFields;
  short iPlayer;
  int ptSrc;
  int local_d6;
  short fMineExpert;
  short cshDamaged;
  short dmgExtra;
  THING *lpth;
  short i;
  undefined4 dmgToApply;
  undefined4 dmgReduce;
  short cshT;
  undefined2 dpsh;
  undefined2 local_bc;
  FLEET flSrc;
  short dEnd;
  short j;
  undefined4 d2;
  short dy;
  int ptDst;
  int local_32;
  short iWarp;
  POINT ptAct;
  short dTravel;
  short rgishInc [16];
  uint d2Closest;
  int local_6;
  
  lpthSalvage = (THING *)0x0;
  cshDead = 0;
  dTravel = *pdTravel;
  cishInc = 0;
  uVar15 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar10 = (FLEET *)lpfl;
  iPlayer = pFVar10->iPlayer;
  puVar16 = (undefined *)&DAT_1120_10e0;
  raMajor = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv);
  fMineExpert = (uint)(raMajor == raMines) * 2 + (uint)(raMajor == raStealth);
  if (lpthHit == (THING *)0x0) {
    ptSrc = (&pFVar10->pt)->x;
    local_d6 = (pFVar10->pt).y;
    uVar24 = (undefined2)((ulong)pFVar10->lpplord >> 0x10);
    pPVar11 = (PLORD *)pFVar10->lpplord;
    ptDst = *(int *)&pPVar11[5].iordMax;
    local_32 = (pPVar11 + 6)->wFlags;
    for (iWarp = 3; (iWarp < 10 && (iWarp * iWarp < dTravel + -1)); iWarp = iWarp + 1) {
    }
    if ((iWarp <= fMineExpert + 3) || ((ptSrc == ptDst && (local_d6 == local_32)))) {
      return 1;
    }
    for (i = 0; i < 3; i = i + 1) {
      rgcField[i] = 0;
    }
    lpthMac = (THING *)lpThings + cThing;
    local_15c = lpThings._2_2_;
    lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
    while ((THING *)lpth < lpthMac) {
      if (((((uint)lpth->idFull >> 9 & 0xf) != iPlayer) && ((uint)lpth->idFull >> 0xd == 0)) &&
         (*(char *)(((uint)lpth->idFull >> 9 & 0xf) * 0xc0 + 0x5a12 + iPlayer) != '\x01')) {
        uVar24 = (undefined2)((ulong)lpth >> 0x10);
        ptL1.y = local_d6;
        ptL1.x = ptSrc;
        puVar16 = (undefined *)&DAT_1120_1040;
        ptL2.y = local_32;
        ptL2.x = ptDst;
        ptC.y = (((THING *)lpth)->pt).y;
        ptC.x = (&((THING *)lpth)->pt)->x;
        sVar5 = FIntersectCircleLine
                          (ptL1,ptL2,ptC,
                           CONCAT22(*(undefined2 *)(((THING *)lpth)->rgb + 2),
                                    *(undefined2 *)((THING *)lpth)->rgb),dTravel,&dStart,&dEnd);
        if (sVar5 != 0) {
          iType = (short)((THING *)lpth)->rgb[6];
          i = 0;
          while ((i < rgcField[iType] && (rgFieldE[iType * 8 + i] < dStart))) {
            i = i + 1;
          }
          if (i == rgcField[iType]) {
            if (i < 8) {
              rgFieldS[iType * 8 + i] = dStart;
              rgFieldE[iType * 8 + i] = dEnd;
              rgcField[iType] = rgcField[iType] + 1;
            }
          }
          else if (dEnd < rgFieldS[iType * 8 + i] + -1) {
            if (rgcField[iType] < 8) {
              for (j = rgcField[iType]; i < j; j = j + -1) {
                rgFieldS[iType * 8 + j] = rgFieldS[iType * 8 + j + -1];
                rgFieldE[iType * 8 + j] = rgFieldE[iType * 8 + j + -1];
              }
              rgFieldS[iType * 8 + i] = dStart;
              rgFieldE[iType * 8 + i] = dEnd;
              rgcField[iType] = rgcField[iType] + 1;
            }
          }
          else {
            if (dStart < rgFieldS[iType * 8 + i]) {
              rgFieldS[iType * 8 + i] = dStart;
            }
            if (rgFieldE[iType * 8 + i] < dEnd) {
              rgFieldE[iType * 8 + i] = dEnd;
              j = i + 1;
              while ((j < rgcField[iType] && (rgFieldS[iType * 8 + j] <= dEnd))) {
                j = j + 1;
              }
              if (dEnd < rgFieldE[iType * 8 + j + -1]) {
                rgFieldE[iType * 8 + i] = rgFieldE[iType * 8 + j + -1];
              }
              i = i + 1;
              for (; j < rgcField[iType]; j = j + 1) {
                rgFieldS[iType * 8 + i] = rgFieldS[iType * 8 + j];
                rgFieldE[iType * 8 + i] = rgFieldE[iType * 8 + j];
                i = i + 1;
              }
              rgcField[iType] = rgcField[iType] - (j - i);
            }
          }
        }
      }
      lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
    }
    cFields = rgcField[0] + rgcField[1] + rgcField[2];
    if (cFields == 0) {
      return 1;
    }
  }
  else {
    iWarp = 0;
  }
  fHasRamScoop = 0;
  rgi[3] = 0;
  rgi[4] = 0;
  for (i = 0; i < 0x10; i = i + 1) {
    if (0 < pFVar10->rgcsh[i]) {
      uVar4 = pFVar10->rgcsh[i];
      bVar17 = CARRY2(rgi[3],uVar4);
      rgi[3] = rgi[3] + uVar4;
      rgi[4] = rgi[4] + ((int)uVar4 >> 0xf) + (uint)bVar17;
      j = *(uint *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93 + 0x3c) & 0xff;
      puVar16 = (undefined *)0x1008;
      pEVar18 = LpengineFromId(j);
      if (((ENGINE *)pEVar18)->rgcFuelUsed[4] == 0) {
        fHasRamScoop = 1;
      }
    }
  }
  if (lpthHit == (THING *)0x0) {
    rgi[2] = 0;
    rgi[1] = 0;
    rgi[0] = 0;
    for (; 0 < cFields; cFields = cFields + -1) {
      dStart = 10000;
      iType = -1;
      for (i = 0; i < 3; i = i + 1) {
        if ((rgi[i] < rgcField[i]) && (rgFieldS[i * 8 + rgi[i]] < dStart)) {
          dStart = rgFieldS[i * 8 + rgi[i]];
          iType = i;
        }
      }
      dEnd = rgFieldE[iType * 8 + rgi[iType]] - rgFieldS[iType * 8 + rgi[iType]];
      if (((short *)rgiWarpSafe)[iType] + fMineExpert < iWarp) {
        puVar16 = (undefined *)0x10b0;
        pct = ((iWarp - ((short *)rgiWarpSafe)[iType]) - fMineExpert) *
              ((short *)rgpctMineHit)[iType];
        for (i = 0; i < dEnd; i = i + 1) {
          puVar16 = (undefined *)&DAT_1120_1040;
          sVar5 = Random(1000);
          if (sVar5 < pct) break;
        }
        if (i != dEnd) {
          dEnd = dStart + i;
          goto TURN_LHitSkip2;
        }
      }
      rgi[iType] = rgi[iType] + 1;
    }
    sVar5 = 1;
  }
  else {
    iType = (short)((THING *)lpthHit)->rgb[6];
TURN_LHitSkip2:
    cshDead = 0;
    dmgTot._0_2_ = 0;
    dmgTot._2_2_ = 0;
    dmgTot = 0;
    if (((short (*) [2])rgrgdmgMine)[iType][fHasRamScoop] != 0) {
      dmgPer = ((short (*) [2])rgrgdmgMine)[iType][fHasRamScoop];
      dmgExtra = ((short (*) [2])rgrgdmgMinMine)[iType][fHasRamScoop] - dmgPer * rgi[3];
      if ((0 < rgi[4]) || (((-1 < rgi[4] && (4 < (uint)rgi[3])) || (dmgExtra < 1)))) {
        dmgExtra = 0;
      }
      pFVar14 = &flSrc;
      pFVar13 = pFVar10;
      for (iVar8 = 0x3e; iVar8 != 0; iVar8 = iVar8 + -1) {
        pFVar3 = pFVar14;
        pFVar14 = (FLEET *)&pFVar14->iPlayer;
        pFVar2 = pFVar13;
        pFVar13 = (FLEET *)&pFVar13->iPlayer;
        pFVar3->id = pFVar2->id;
      }
      _memset(&flDead,0,0x7c);
      flDead.iPlayer = flSrc.iPlayer;
      flDead.wFlags = flDead.wFlags & 0xfb00U | 0x407;
      for (i = 0; i < 0x10; i = i + 1) {
        if ((0 < pFVar10->rgcsh[i]) &&
           (((lpthHit == (THING *)0x0 || (((uint)lpthHit->idFull >> 9 & 0xf) != pFVar10->iPlayer))
            || ((iVar8 = pFVar10->iPlayer * 4, *(int *)(*(int *)(iVar8 + 0xfe) + i * 0x93) != 0x1b
                && (iVar8 = pFVar10->iPlayer * 4,
                   *(int *)(*(int *)(iVar8 + 0xfe) + i * 0x93) != 0x1c)))))) {
          cshT = pFVar10->rgcsh[i];
          rgishInc[cishInc] = i;
          iVar8 = pFVar10->iPlayer * 4;
          uVar4 = *(uint *)(*(int *)(iVar8 + 0xfe) + i * 0x93 + 0x3c) >> 8;
          cishInc = cishInc + 1;
          uVar19 = DpShieldOfShdef
                             ((SHDEF *)CONCAT22(*(undefined2 *)(iPlayer * 4 + 0x100),
                                                (SHDEF *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93)),
                              iPlayer);
          uVar19 = __aFulmul((long)cshT,uVar19);
          dpsh = *(undefined2 *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93 + 0x38);
          local_bc = 0;
          uVar24 = 0;
          iVar8 = dmgExtra >> 0xf;
          sVar5 = dmgExtra;
          dpShield = uVar19;
          uVar19 = __aFulmul((long)cshT,(long)dmgPer);
          dmgToApply = __aFulmul(uVar19 + CONCAT22(iVar8,sVar5),CONCAT22(uVar24,uVar4));
          dmgTot = dmgToApply + dmgTot;
          lVar20 = __aFlshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000fe06);
          uVar19 = dpShield;
          if (lVar20 <= (long)dpShield) {
            uVar19 = __aFlshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000fe06);
          }
          dmgToApply = dmgToApply - uVar19;
          uVar26 = 0;
          uVar24 = 100;
          dmgReduce = uVar19;
          uVar19 = __aFulmul((long)pFVar10->rgcsh[i],(ulong)((pFVar10->rgdv + i)->dp & 0x7f)
                                    );
          lVar20 = __aFldiv(uVar19,CONCAT22(uVar26,uVar24));
          iVar8 = (int)lVar20;
          uVar26 = 0;
          uVar24 = 500;
          iVar9 = iVar8 >> 0xf;
          cshDamaged = iVar8;
          uVar19 = __aFulmul(CONCAT22(local_bc,dpsh),
                                     (ulong)((uint)(pFVar10->rgdv + i)->dp >> 7));
          uVar19 = __aFulmul(uVar19,CONCAT22(iVar9,iVar8));
          lVar20 = __aFldiv(uVar19,CONCAT22(uVar26,uVar24));
          dmgToApply = lVar20 + dmgToApply;
          dmgExtra = 0;
          uVar19 = __aFldiv(dmgToApply,(long)cshT);
          if (CONCAT22(local_bc,dpsh) < (long)uVar19) {
            cshDead = cshDead + cshT;
            flDead.rgcsh[i] = cshT;
            flSrc.rgcsh[i] = 0;
            cshT = 0;
          }
          else {
            (flSrc.rgdv + i)->dp = (flSrc.rgdv + i)->dp & 0xff80U | 100;
            uVar24 = dpsh;
            uVar26 = local_bc;
            uVar19 = __aFulmul(uVar19,500);
            lVar20 = __aFldiv(uVar19,CONCAT22(uVar26,uVar24));
            (flSrc.rgdv + i)->dp = (flSrc.rgdv + i)->dp & 0x7fU | (int)lVar20 << 7;
            if ((uint)(flSrc.rgdv + i)->dp >> 7 == 0) {
              (flSrc.rgdv + i)->dp = (flSrc.rgdv + i)->dp & 0x7fU | 0x80;
            }
          }
          dmgToApply._0_2_ = 0;
          dmgToApply._2_2_ = 0;
        }
      }
      if ((lpthHit != (THING *)0x0) && (dmgTot == 0)) {
        return 0;
      }
      if ((cshDead != rgi[3]) || (cshDead >> 0xf != rgi[4])) {
        FleetTransferCargoBalance(&flSrc,&flDead);
      }
      pFVar14 = &flSrc;
      pFVar13 = pFVar10;
      for (iVar8 = 0x3e; iVar8 != 0; iVar8 = iVar8 + -1) {
        pFVar3 = pFVar13;
        pFVar13 = (FLEET *)&pFVar13->iPlayer;
        pFVar2 = pFVar14;
        pFVar14 = (FLEET *)&pFVar14->iPlayer;
        pFVar3->id = pFVar2->id;
      }
      if ((cshDead == rgi[3]) && (cshDead >> 0xf == rgi[4])) {
        pFVar10->wFlags = pFVar10->wFlags & 0xfbffU | 0x400;
      }
    }
    if (lpthHit == (THING *)0x0) {
      dx = ptDst - ptSrc;
      dy = local_32 - local_d6;
      uVar19 = __aFulmul((long)dy,(long)dy);
      uVar21 = __aFulmul((long)dx,(long)dx);
      lVar20 = uVar21 + uVar19;
      _sqrt(SUB84((double)lVar20,0),
                    (double)CONCAT26(unaff_SI,CONCAT24(unaff_DI,(long)((qword)(double)lVar20 >> 0x20
                                                                      ))));
      lVar20 = __ftol((double)CONCAT26((int)((ulong)lVar20 >> 0x10),
                                               CONCAT24((int)lVar20,CONCAT22(unaff_SI,unaff_DI))));
      dTravel = (short)lVar20;
      ptAct.x = MulDiv(dx,dEnd,dTravel);
      ptAct.x = ptAct.x + ptSrc;
      ptAct.y = MulDiv(dy,dEnd,dTravel);
      ptAct.y = ptAct.y + local_d6;
      if (cshDead != 0) {
        local_15c = lpThings._2_2_;
        lpthSalvage = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
        lpthMac = (THING *)lpThings + cThing;
        while( true ) {
          if ((lpthMac <= (THING *)lpthSalvage) ||
             (((((&((THING *)lpthSalvage)->pt)->x == ptAct.x &&
                ((((THING *)lpthSalvage)->pt).y == ptAct.y)) &&
               ((uint)lpthSalvage->idFull >> 0xd == 1)) &&
              ((*(uint *)((THING *)lpthSalvage)->rgb >> 10 & 0xf) == 0)))) break;
          lpthSalvage = (THING *)CONCAT22(lpthSalvage._2_2_,(THING *)lpthSalvage + 1);
        }
        if (((THING *)lpthSalvage == lpthMac) && (lpthSalvage._2_2_ == lpThings._2_2_)) {
          lpthSalvage = (THING *)0x0;
        }
        DropSalvage(&lpthSalvage,(long *)CONCAT22(uVar15,pFVar10->rgwtMin),
                            (uint)flSrc.id >> 9 & 0xf,&ptAct);
      }
      d2Closest = 0xe100;
      local_6 = 0x5f5;
      local_15c = lpThings._2_2_;
      lpthMac = (THING *)lpThings + cThing;
      lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
      while ((THING *)lpth < lpthMac) {
        if (((((uint)lpth->idFull >> 9 & 0xf) != iPlayer) && ((uint)lpth->idFull >> 0xd == 0)) &&
           ((*(char *)(((uint)lpth->idFull >> 9 & 0xf) * 0xc0 + 0x5a12 + iPlayer) != '\x01' &&
            (uVar24 = (undefined2)((ulong)lpth >> 0x10), (uint)((THING *)lpth)->rgb[6] == iType))))
        {
          dx = (&((THING *)lpth)->pt)->x - ptAct.x;
          dy = (((THING *)lpth)->pt).y - ptAct.y;
          uVar19 = __aFulmul((long)dy,(long)dy);
          uVar21 = __aFulmul((long)dx,(long)dx);
          uVar4 = (uint)(uVar21 + uVar19);
          uVar24 = (undefined2)((ulong)lpth >> 0x10);
          puVar1 = (uint *)((THING *)lpth)->rgb;
          d2._0_2_ = uVar4 - *puVar1;
          d2._2_2_ = ((int)(uVar21 + uVar19 >> 0x10) - *(int *)(((THING *)lpth)->rgb + 2)) -
                     (uint)(uVar4 < *puVar1);
          if ((d2._2_2_ <= local_6) && ((d2._2_2_ < local_6 || ((uint)d2 < d2Closest)))) {
            lpthClosest = lpth;
            d2Closest = (uint)d2;
            local_6 = d2._2_2_;
          }
        }
        lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
      }
      uVar24 = (undefined2)((ulong)lpthClosest >> 0x10);
      d2 = __aFldiv(CONCAT22(*(undefined2 *)(((THING *)lpthClosest)->rgb + 2),
                                     *(undefined2 *)((THING *)lpthClosest)->rgb),0x14);
      if (d2 < 0x33) {
        if (d2 < 10) {
          d2 = 10;
        }
      }
      else {
        uVar24 = (undefined2)((ulong)lpthClosest >> 0x10);
        lVar20 = __aFldiv(CONCAT22(*(undefined2 *)(((THING *)lpthClosest)->rgb + 2),
                                           *(undefined2 *)((THING *)lpthClosest)->rgb),100);
        d2 = lVar20;
        if (lVar20 < 0x32) {
          d2 = 0x32;
        }
      }
    }
    else {
      ptAct.x = (&((THING *)lpthHit)->pt)->x;
      ptAct.y = (((THING *)lpthHit)->pt).y;
      lpthClosest = lpthHit;
      d2 = CONCAT22(d2._2_2_,(uint)d2);
    }
    sVar5 = GetRaceStat((PLAYER *)rgplr + ((uint)lpthClosest->idFull >> 9 & 0xf),
                              rsMajorAdv);
    if (sVar5 == raMines) {
      uVar4 = 1 << ((byte)((uint)lpthClosest->idFull >> 9) & 0xf);
      if (cishInc == 0) {
        for (i = 0; i < 0x10; i = i + 1) {
          if (0 < pFVar10->rgcsh[i]) {
            puVar1 = (uint *)(*(int *)(iPlayer * 4 + 0xfe) + i * 0x93 + 0x8b);
            *puVar1 = *puVar1 | uVar4;
          }
        }
      }
      else {
        for (i = 0; i < cishInc; i = i + 1) {
          puVar1 = (uint *)(*(int *)(iPlayer * 4 + 0xfe) + rgishInc[i] * 0x93 + 0x8b);
          *puVar1 = *puVar1 | uVar4;
        }
      }
    }
    if (0x7ff8 < dmgTot) {
      dmgTot = 0x7ff8;
    }
    if (dmgTot == 0) {
      if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
        FSendPlrMsg(iPlayer,idmHasStoppedMineField,lpfl->id | 0x8000,lpfl->id | 0x8000,
                         (uint)lpthClosest->idFull >> 9 & 0xf,iType,ptAct.x,ptAct.y,0,0);
      }
      FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasStoppedMineField2,
                       lpfl->id | 0x8000,lpfl->id | 0x8000,iType,ptAct.x,ptAct.y,0,0,0);
      lVar20 = d2;
    }
    else if (cshDead == 0) {
      if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
        if (lpthHit == (THING *)0x0) {
          MVar6 = idmHasStoppedMineFieldFleetHasTaken;
        }
        else {
          MVar6 = idmHasDamagedDetonatingMineFieldFleetHas;
        }
        FSendPlrMsg(iPlayer,MVar6,lpfl->id | 0x8000,lpfl->id | 0x8000,
                         (uint)lpthClosest->idFull >> 9 & 0xf,iType,ptAct.x,ptAct.y,(short)dmgTot,0)
        ;
      }
      if (lpthHit == (THING *)0x0) {
        MVar6 = idmHasStoppedMineFieldMinesHaveInflicted;
      }
      else {
        MVar6 = idmHasDamagedDetonatingMineFieldMinesHave;
      }
      FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,MVar6,lpfl->id | 0x8000,
                       lpfl->id | 0x8000,iType,ptAct.x,ptAct.y,(short)dmgTot,0,0);
      lVar20 = d2;
    }
    else if ((rgi[4] < cshDead >> 0xf) ||
            ((rgi[4] <= cshDead >> 0xf && ((uint)rgi[3] <= (uint)cshDead)))) {
      if (((THING *)lpthSalvage == (THING *)0x0) && (lpthSalvage._2_2_ == 0)) {
        flDead.id = lpfl->id;
        if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
          sVar25 = 0;
          sVar27 = 0;
          uVar4 = (uint)lpthClosest->idFull >> 9 & 0xf;
          sVar5 = iType;
          sVar22 = ptAct.x;
          sVar23 = ptAct.y;
          uVar7 = WFromLpfl((FLEET *)&flDead);
          FSendPlrMsg(iPlayer,idmHasAnnihilatedMineField3,-1,uVar7,uVar4,sVar5,sVar22,sVar23,
                           sVar27,sVar25);
        }
        if (pFVar10->iPlayer == ((uint)lpthClosest->idFull >> 9 & 0xf)) {
          p7 = 0;
          sVar25 = 0;
          sVar27 = 0;
          sVar5 = iType;
          sVar22 = ptAct.x;
          sVar23 = ptAct.y;
          uVar7 = WFromLpfl((FLEET *)&flDead);
          FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasAnnihilatedMineField4,-1,uVar7
                           ,sVar5,sVar22,sVar23,sVar27,sVar25,p7);
          lVar20 = d2;
        }
        else {
          FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasAnnihilatedMineField2,-6,
                           lpthClosest->idFull,lpfl->id,iType,ptAct.x,ptAct.y,0,0);
          lVar20 = d2;
        }
      }
      else {
        flDead.id = lpfl->id;
        if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
          sVar27 = 0;
          uVar4 = (uint)lpthClosest->idFull >> 9 & 0xf;
          sVar5 = iType;
          sVar22 = ptAct.x;
          sVar23 = ptAct.y;
          uVar7 = WFromLpfl((FLEET *)&flDead);
          FSendPlrMsg(iPlayer,idmHasAnnihilatedMineField,-6,lpthSalvage->idFull,uVar7,uVar4,
                           sVar5,sVar22,sVar23,sVar27);
        }
        FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,idmHasAnnihilatedMineField2,-6,
                         lpthSalvage->idFull,lpfl->id,iType,ptAct.x,ptAct.y,0,0);
        lVar20 = d2;
      }
    }
    else {
      if (iPlayer != ((uint)lpthClosest->idFull >> 9 & 0xf)) {
        if (lpthHit == (THING *)0x0) {
          MVar6 = idmHasStoppedMineFieldFleetHasTaken2;
        }
        else {
          MVar6 = idmHasTakenDamageDetonatingMineFieldFleet;
        }
        FSendPlrMsg(iPlayer,MVar6,lpfl->id | 0x8000,lpfl->id | 0x8000,
                         (uint)lpthClosest->idFull >> 9 & 0xf,iType,ptAct.x,ptAct.y,(short)dmgTot,
                         cshDead);
      }
      if (lpthHit == (THING *)0x0) {
        MVar6 = idmHasStoppedMineFieldMinesHaveInflicted2;
      }
      else {
        MVar6 = idmHasDamagedDetonatingMineFieldMinesHave2;
      }
      FSendPlrMsg((uint)lpthClosest->idFull >> 9 & 0xf,MVar6,lpfl->id | 0x8000,
                       lpfl->id | 0x8000,iType,ptAct.x,ptAct.y,(short)dmgTot,cshDead,0);
      lVar20 = d2;
    }
    d2._2_2_ = (int)((ulong)lVar20 >> 0x10);
    d2._0_2_ = (uint)lVar20;
    if (lpthHit == (THING *)0x0) {
      uVar24 = (undefined2)((ulong)lpthClosest >> 0x10);
      pTVar12 = (THING *)lpthClosest;
      if (lVar20 < CONCAT22(*(undefined2 *)(pTVar12->rgb + 2),*(undefined2 *)pTVar12->rgb)) {
        puVar1 = (uint *)pTVar12->rgb;
        uVar4 = *puVar1;
        *puVar1 = *puVar1 - (uint)d2;
        *(uint *)(pTVar12->rgb + 2) =
             (*(int *)(pTVar12->rgb + 2) - d2._2_2_) - (uint)(uVar4 < (uint)d2);
        *(uint *)(pTVar12->rgb + 8) = *(uint *)(pTVar12->rgb + 8) | 1 << ((byte)iPlayer & 0x1f);
        *(uint *)(pTVar12->rgb + 4) = *(uint *)(pTVar12->rgb + 4) | 1 << ((byte)iPlayer & 0x1f);
      }
      else {
        d2 = lVar20;
        FreeLpth(lpthClosest);
      }
      *pdTravel = dEnd;
    }
    pFVar10->wFlags = pFVar10->wFlags & 0xbfffU | 0x4000;
    sVar5 = 0;
  }
  return sVar5;
}



// ======================================================================
// Function: SatisfyOrders
// Address: 10b0:6798
// Segment: MEMORY_TURN
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10b0711a) */
/* WARNING: Variable defined which should be unmapped: lMaxFuel */
/* WARNING: Removing unreachable block (ram,0x10b06b9c) */
/* WARNING: Removing unreachable block (ram,0x10b07f73) */
/* WARNING: Removing unreachable block (ram,0x10b07c0a) */
/* WARNING: Removing unreachable block (ram,0x10b07d05) */
/* WARNING: Removing unreachable block (ram,0x10b069bc) */
/* WARNING: Removing unreachable block (ram,0x10b07e13) */
/* WARNING: Removing unreachable block (ram,0x10b07e7f) */
/* WARNING: Removing unreachable block (ram,0x10b06e5a) */
/* WARNING: Removing unreachable block (ram,0x10b072ad) */
/* WARNING: Removing unreachable block (ram,0x10b0778f) */
/* WARNING: Removing unreachable block (ram,0x10b09c58) */
/* WARNING: Removing unreachable block (ram,0x10b07a6e) */
/* WARNING: Removing unreachable block (ram,0x10b0809e) */
/* WARNING: Removing unreachable block (ram,0x10b073cc) */
/* WARNING: Removing unreachable block (ram,0x10b080db) */

void SatisfyOrders(short iPass)

{
  char *pcVar1;
  int *piVar2;
  PLORD *pPVar3;
  uint *puVar4;
  short *psVar5;
  undefined2 *puVar6;
  HullDef *pHVar7;
  POINT *pPVar8;
  undefined2 *puVar9;
  SHDEF *pSVar10;
  undefined2 uVar11;
  uint uVar12;
  PLORD *pPVar13;
  THING *pTVar14;
  byte *pbVar15;
  byte *pbVar16;
  PLANET *pPVar17;
  byte *pbVar18;
  ushort uVar19;
  ushort p1;
  MessageId MVar20;
  uint uVar21;
  ushort uVar22;
  int iVar23;
  SHDEF *pSVar24;
  int iVar25;
  FLEET *pFVar26;
  FLEET *pFVar27;
  PLORD *pPVar28;
  int iVar29;
  ushort unaff_SI;
  short *psVar30;
  POINT *pPVar31;
  undefined2 *puVar32;
  HullDef *pHVar33;
  ushort unaff_DI;
  undefined2 *puVar34;
  SHDEF *pSVar35;
  undefined2 uVar36;
  undefined2 uVar37;
  undefined2 unaff_SS;
  bool bVar38;
  byte *pbVar39;
  byte *pbVar40;
  long lVar41;
  THING *pTVar42;
  ulong uVar43;
  long lVar44;
  short sVar45;
  short sVar46;
  short sVar47;
  short p7;
  short sVar48;
  undefined2 rgwt [6];
  short fColonize;
  short fUltimate;
  undefined4 lResUltimate;
  short fBleeding;
  short csh;
  undefined1 shdefT [122];
  SHDEF *lpshdefDest;
  short iplrDest;
  FLEET *lpflNew;
  short ish;
  short ishMatch;
  uint rgishMap;
  THING *local_b6;
  int dx;
  int local_b0;
  undefined4 rglQuan;
  THING *lpth;
  long lXferMinerals;
  long lMaxFuel;
  long iExcess;
  long cFuel2;
  THING *lpthWP;
  ushort idWP;
  short fDone;
  undefined4 l;
  undefined4 amountEdit;
  short fDunnage;
  undefined4 wtOptimalFuel;
  short fFueling;
  POINT ord;
  ushort local_7a;
  uint local_78;
  uint local_76 [4];
  undefined2 local_6e;
  short fFulfilled;
  short fHasPermission;
  FLEET *lpflWP;
  short fStealing;
  short fOptFuel;
  ushort xWP;
  short iLoad;
  short idm;
  short fAtPlanet;
  FLEET *lpfl;
  short ifltcur;
  short fSentBadFleetXfer;
  short iflWP;
  undefined4 amount;
  short j;
  undefined4 l2;
  PLANET pl;
  short action;
  byte *amountWP;
  int local_8;
  short fMining;
  
  if (cFleet < 1) {
    return;
  }
  ifltcur = 0;
LAB_10b0_67ba:
  if (cFleet <= ifltcur) {
    return;
  }
                    /* WARNING: Load size is inaccurate */
  pFVar26 = ((FLEET **)rglpfl)[ifltcur];
  iVar23 = *(int *)((int)((FLEET **)rglpfl + ifltcur) + 2);
  lpfl = (FLEET *)CONCAT22(iVar23,pFVar26);
  if ((pFVar26 == (FLEET *)0x0) && (iVar23 == 0)) {
    return;
  }
  if (iPass == 1) {
    pFVar26->wFlags = pFVar26->wFlags & 0xffdf;
    pFVar26->wFlags = pFVar26->wFlags & 0xffbf;
  }
  if ((((uint)pFVar26->wFlags >> 10 & 1) != 0) || (((uint)pFVar26->wFlags >> 7 & 1) != 0))
  goto LAB_10b0_67b6;
  uVar36 = *(undefined2 *)((int)&pFVar26->lpplord + 2);
  psVar30 = (short *)(*(int *)&pFVar26->lpplord + 4);
  pPVar31 = &ord;
  for (iVar23 = 9; iVar23 != 0; iVar23 = iVar23 + -1) {
    pPVar8 = pPVar31;
    pPVar31 = (POINT *)&pPVar31->y;
    psVar5 = psVar30;
    psVar30 = psVar30 + 1;
    pPVar8->x = *psVar5;
  }
  pFVar26 = (FLEET *)lpfl;
  uVar36 = (undefined2)((ulong)lpfl >> 0x10);
  if ((local_78 & 0xf) == 1) {
    fFulfilled = 1;
    fDone = 1;
    fSentBadFleetXfer = 0;
    fHasPermission = 1;
    fMining = 0;
    fFueling = 0;
    fStealing = 0;
    fDunnage = 0;
    lpflWP = (FLEET *)0x0;
    lpthWP = (THING *)0x0;
    if (pFVar26->idPlanet == -1) {
LAB_10b0_68f7:
      fAtPlanet = 0;
    }
    else {
      sVar45 = FLookupPlanet(pFVar26->idPlanet,&pl);
      if (sVar45 == 0) goto LAB_10b0_68f7;
      fAtPlanet = 1;
    }
    idWP = local_7a;
    uVar21 = local_78 >> 8 & 0xf;
    if (uVar21 == 1) {
      xWP = 0xffff;
      if (((FLEET *)lpfl)->iPlayer == pl.iPlayer) {
        fHasPermission = 3;
      }
      else {
        fHasPermission = 0;
      }
      if (fHasPermission == 0) {
        GetFleetScannerRange(lpfl,(short *)0x0,(short *)0x0,&fHasPermission);
        if (fHasPermission == 1) {
          fHasPermission = 0;
        }
        if (fHasPermission == 0) {
          if (pl.iPlayer == -1) {
            for (iflWP = 0; iflWP < cFleet; iflWP = iflWP + 1) {
                    /* WARNING: Load size is inaccurate */
              pFVar26 = ((FLEET **)rglpfl)[iflWP];
              iVar23 = *(int *)((int)((FLEET **)rglpfl + iflWP) + 2);
              lpflWP = (FLEET *)CONCAT22(iVar23,pFVar26);
              if ((pFVar26 == (FLEET *)0x0) && (iVar23 == 0)) break;
              if (((uint)pFVar26->wFlags >> 10 & 1) == 0) {
                iVar25 = (int)((ulong)lpfl >> 0x10);
                pFVar27 = (FLEET *)lpfl;
                if ((((pFVar26->iPlayer == pFVar27->iPlayer) &&
                     (pFVar27->idPlanet == pFVar26->idPlanet)) &&
                    ((pFVar26 != pFVar27 || (iVar23 != iVar25)))) &&
                   (((uint)pFVar26->wFlags >> 0xd & 1) != 0)) {
                  lVar44 = CMineFromLpfl((FLEET *)CONCAT22(iVar23,pFVar26));
                  if (0 < lVar44) {
                    fMining = 2;
                    fHasPermission = 1;
                    local_78 = local_78 & 0xf0ff | 0x200;
                    local_7a = lpflWP->id;
                    xWP = 0xffff;
                    idWP = lpflWP->id | 0x8000;
                    break;
                  }
                }
              }
            }
          }
        }
        else {
          fStealing = 1;
        }
      }
    }
    else if (uVar21 == 2) {
      lpflWP = LpflFromId(local_7a);
      uVar36 = (undefined2)((ulong)lpflWP >> 0x10);
      idWP = idWP | 0x8000;
      xWP = 0xffff;
      fHasPermission = (short)(((FLEET *)lpfl)->iPlayer == ((FLEET *)lpflWP)->iPlayer);
      if (fHasPermission == 0) {
        GetFleetScannerRange(lpfl,(short *)0x0,(short *)0x0,&fHasPermission);
        if (fHasPermission != 0) {
          fStealing = 1;
        }
      }
      else if ((((uint)((FLEET *)lpflWP)->wFlags >> 0xd & 1) != 0) && (fAtPlanet != 0)) {
        lVar44 = CMineFromLpfl(lpflWP);
        if ((lVar44 < 1) || ((pl.iPlayer != -1 && (pl.iPlayer != ((FLEET *)lpfl)->iPlayer)))) {
          lVar44 = LGetFleetStat(lpflWP,2);
          if ((lVar44 == 0) && (pl.iPlayer == ((FLEET *)lpfl)->iPlayer)) {
            fFueling = 1;
            xWP = 0xffff;
            idWP = lpflWP->id | 0x8000;
          }
        }
        else {
          fMining = 1;
          xWP = 0xffff;
          idWP = lpflWP->id | 0x8000;
        }
      }
    }
    else if (uVar21 == 4) {
      xWP = ord.x;
      idWP = ord.y;
    }
    else if (uVar21 == 8) {
      lpthWP = LpthFromId(local_7a);
      xWP = 0xfffe;
    }
    iLoad = iPass - 1U & 1;
    fOptFuel = 0;
    pbVar40 = l;
    pbVar39 = amount;
    lVar44 = l2;
    pbVar15 = amountEdit;
    if ((local_78 >> 8 & 0xf) != 8) {
TURN_LTryDunnage:
      do {
        j = 0;
        while( true ) {
          l = pbVar40;
          l2 = lVar44;
          amount = pbVar39;
          amountEdit = pbVar15;
          if (4 < j) break;
          action = local_76[j] >> 0xc;
          if ((((action == 0) || ((fDunnage == 2 && (action != 7)))) ||
              ((j == 4 && (((local_78 >> 8 & 0xf) != 2 && ((local_78 >> 8 & 0xf) != 4)))))) ||
             ((2 < j && ((local_78 >> 8 & 0xf) == 8)))) goto switchD_10b0_7b5d_default;
          amountWP = (byte *)0x0;
          local_8 = 0;
          uVar21 = local_78 >> 8 & 0xf;
          if (uVar21 == 1) {
LAB_10b0_6d92:
            if (j < 4) {
              amountWP = *(byte **)(pl.rgwtMin + j);
              local_8 = *(int *)((int)pl.rgwtMin + j * 4 + 2);
            }
          }
          else if (uVar21 == 2) {
            if (((fMining != 0) || (fFueling != 0)) && (j != 4)) goto LAB_10b0_6d92;
            amountWP = *(byte **)(((FLEET *)lpflWP)->rgwtMin + j);
            local_8 = *(int *)((int)(((FLEET *)lpflWP)->rgwtMin + j) + 2);
          }
          else if ((uVar21 == 8) && (j < 3)) {
            amountWP = *(byte **)(((THING *)lpthWP)->rgb + j * 2 + 2);
            local_8 = (int)*(byte **)(((THING *)lpthWP)->rgb + j * 2 + 2) >> 0xf;
          }
          switch(action) {
          case 1:
            if (iLoad == 0) goto switchD_10b0_7b5d_default;
          case 7:
            amountEdit._0_2_ = amountWP;
            amountEdit._2_2_ = local_8;
            pbVar15 = (byte *)CONCAT22(local_8,amountWP);
            break;
          case 2:
            if (iLoad != 0) goto switchD_10b0_7b5d_default;
            amountEdit._0_2_ = *(byte **)(((FLEET *)lpfl)->rgwtMin + j);
            amountEdit._2_2_ = *(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2);
            pbVar15 = (byte *)CONCAT22(amountEdit._2_2_,(byte *)amountEdit);
            break;
          case 3:
            if (iLoad == 0) goto switchD_10b0_7b5d_default;
            amountEdit._0_2_ = (byte *)(local_76[j] & 0xfff);
            amountEdit._2_2_ = 0;
            pbVar15 = (byte *)(ulong)(local_76[j] & 0xfff);
            break;
          case 4:
            if (iLoad != 0) goto switchD_10b0_7b5d_default;
          case 8:
          case 9:
            amountEdit._0_2_ = (byte *)(local_76[j] & 0xfff);
            amountEdit._2_2_ = 0;
            pbVar15 = (byte *)(ulong)(local_76[j] & 0xfff);
            break;
          case 5:
          case 6:
            if (iLoad == 0) goto switchD_10b0_7b5d_default;
            if (j == 4) {
              pbVar40 = (byte *)LGetFleetStat(lpfl,1);
            }
            else {
              pbVar40 = (byte *)LGetFleetStat(lpfl,2);
            }
            if (2000000 < (long)pbVar40) {
              pbVar40 = (byte *)0x1e8480;
            }
            amount = pbVar40;
            if (((long)pbVar40 < 0x20000) && ((long)pbVar40 < 0x10000)) {
              uVar37 = 0;
              uVar36 = 100;
              uVar43 = __aFulmul((ulong)pbVar40,(ulong)(local_76[j] & 0xfff));
              uVar43 = __aFuldiv(uVar43,CONCAT22(uVar37,uVar36));
              pbVar40 = l;
              lVar44 = l2;
              pbVar39 = amount;
            }
            else {
              uVar21 = local_76[j] & 0xfff;
              uVar36 = 0;
              uVar43 = __aFldiv((long)pbVar40,100);
              uVar43 = __aFulmul(uVar43,CONCAT22(uVar36,uVar21));
              pbVar40 = l;
              lVar44 = l2;
              pbVar39 = amount;
            }
            pbVar15 = (byte *)(uVar43 - CONCAT22(*(undefined2 *)
                                                  ((int)(((FLEET *)lpfl)->rgwtMin + j) + 2),
                                                 (int)((FLEET *)lpfl)->rgwtMin[j]));
            amountEdit = pbVar15;
            if (((long)pbVar15 < 0x10000) && ((long)pbVar15 < 0)) {
              amountEdit._0_2_ = (byte *)0x0;
              amountEdit._2_2_ = 0;
              pbVar15 = (byte *)0x0;
            }
          }
          amountEdit._2_2_ = (int)((ulong)pbVar15 >> 0x10);
          amountEdit._0_2_ = (byte *)pbVar15;
          l = pbVar40;
          l2 = lVar44;
          amountEdit = pbVar15;
          switch(action) {
          case 1:
          case 3:
          case 5:
          case 6:
            amount = pbVar15;
            pbVar16 = pbVar15;
TURN_Load:
            pbVar39 = pbVar16;
            if ((iLoad != 0) && (pbVar39 != (byte *)0x0)) {
              l = pbVar40;
              l2 = lVar44;
              amount = pbVar39;
              amountEdit = pbVar15;
              if (j == 4) {
                pbVar40 = (byte *)GetFuelFree(lpfl);
                l = pbVar40;
                lVar44 = l2;
                pbVar15 = amountEdit;
                pbVar39 = amount;
              }
              else {
                pbVar40 = (byte *)GetCargoFree(lpfl);
                l = pbVar40;
                lVar44 = l2;
                pbVar15 = amountEdit;
                pbVar39 = amount;
              }
              l = (byte *)CONCAT22(local_8,amountWP);
              if ((long)pbVar40 < (long)pbVar39) {
                pbVar39 = pbVar40;
              }
              amount = pbVar39;
              l2 = lVar44;
              amountEdit = pbVar15;
              if ((fHasPermission == 0) || ((local_78 >> 8 & 0xf) == 4)) {
                if ((j == 4) && (fOptFuel != 0)) {
                  amount._0_2_ = (byte *)0x0;
                  amount._2_2_ = 0;
                  pbVar39 = (byte *)0x0;
                }
                else {
                  if (iPass == 4) {
                    uVar21 = local_78 >> 8 & 0xf;
                    if (uVar21 == 1) {
                      idm = 0x11f;
                    }
                    else if (uVar21 == 2) {
                      idm = 0x120;
                    }
                    else if (uVar21 == 4) {
                      idm = 0x123;
                    }
                    l = pbVar40;
                    FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,j);
                    goto TURN_CancelOrder;
                  }
                  fDone = 0;
                }
              }
              else {
                if ((fStealing != 0) && ((j == 3 || (j == 4)))) {
                  fDone = 1;
                }
                if (pbVar39 == (byte *)0x0) {
                  if (action == 6) {
                    if (j == 4) {
                      fDone = 0;
                    }
                    else {
                      fFulfilled = 0;
                    }
                  }
                }
                else {
                  if ((long)pbVar39 < (long)l) {
                    l = pbVar39;
                  }
                  lVar44 = ChgCargo(local_78 >> 8 &
                                          (grobjThing|grobjOther|grobjFleet|grobjPlanet),local_7a,j,
                                          CONCAT22(-((int)((ulong)l >> 0x10) + (uint)((int)l != 0)),
                                                   -(int)l),(void *)0x0);
                  l2 = lVar44;
                  if (lVar44 != 0) {
                    pbVar40 = (byte *)ChgCargo(grobjFleet,lpfl->id,j,
                                                     CONCAT22(-((int)((ulong)lVar44 >> 0x10) +
                                                               (uint)((int)lVar44 != 0)),
                                                              -(int)lVar44),(void *)0x0);
                    l = pbVar40;
                    lVar44 = l2;
                    if (pbVar40 != (byte *)0x0) {
                      if (((local_78 >> 8 & 0xf) == 2) &&
                         (((FLEET *)lpfl)->iPlayer != ((FLEET *)lpflWP)->iPlayer)) {
                        sVar47 = 0;
                        sVar46 = 0;
                        uVar21 = idWP & 0x7fff;
                        sVar45 = j;
                        uVar43 = __aFulshr(CONCAT22(idWP,j) & 0x7fffffff,0);
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasStolen,lpfl->id | 0x8000,
                                         lpfl->id,(short)(byte *)l,(short)uVar43,sVar45,uVar21,
                                         sVar46,sVar47);
                        lVar44 = l2;
                      }
                      else {
                        sVar46 = 0;
                        sVar45 = j;
                        uVar22 = xWP;
                        uVar19 = idWP;
                        uVar43 = __aFulshr(CONCAT22(xWP,j),idWP);
                        if (j == 3) {
                          MVar20 = idmHasBeamed;
                        }
                        else {
                          MVar20 = idmHasLoaded;
                        }
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar20,lpfl->id | 0x8000,lpfl->id,
                                         (short)(byte *)l,(short)uVar43,sVar45,uVar22,uVar19,sVar46)
                        ;
                        lVar44 = l2;
                      }
                    }
                  }
                  l2._2_2_ = (int)((ulong)lVar44 >> 0x10);
                  l2._0_2_ = (int)lVar44;
                  pbVar40 = l;
                  pbVar39 = amount;
                  pbVar15 = amountEdit;
                  if (((fFueling != 0) || (fMining != 0)) &&
                     (amount != (undefined1 *)
                                CONCAT22(-(l2._2_2_ + (uint)((int)l2 != 0)),(undefined1 *)-(int)l2))
                     ) {
                    l = amount + lVar44;
                    l2 = lVar44;
                    lVar44 = ChgCargo(grobjPlanet,pl.id,j,
                                            CONCAT22(-((int)((ulong)l >> 0x10) + (uint)((int)l != 0)
                                                      ),-(int)l),(void *)0x0);
                    l2 = lVar44;
                    if (lVar44 == 0) {
                      l._0_2_ = (byte *)0x0;
                      l._2_2_ = 0;
                      pbVar40 = (byte *)0x0;
                      pbVar39 = amount;
                      pbVar15 = amountEdit;
                    }
                    else {
                      pbVar40 = (byte *)ChgCargo(grobjFleet,lpfl->id,j,
                                                       CONCAT22(-((int)((ulong)lVar44 >> 0x10) +
                                                                 (uint)((int)lVar44 != 0)),
                                                                -(int)lVar44),(void *)0x0);
                      l = pbVar40;
                      if (fMining == 0) {
                        sVar46 = 0;
                        sVar45 = j;
                        uVar22 = xWP;
                        uVar19 = pl.id;
                        uVar43 = __aFulshr(CONCAT22(xWP,j),pl.id);
                        if (j == 3) {
                          MVar20 = idmHasBeamed;
                        }
                        else {
                          MVar20 = idmHasLoaded;
                        }
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar20,lpfl->id | 0x8000,lpfl->id,
                                         (short)(byte *)l,(short)uVar43,sVar45,uVar22,uVar19,sVar46)
                        ;
                        pbVar40 = l;
                        lVar44 = l2;
                        pbVar39 = amount;
                        pbVar15 = amountEdit;
                      }
                      else {
                        sVar47 = 0;
                        sVar45 = lpflWP->id;
                        sVar46 = j;
                        uVar22 = pl.id;
                        uVar43 = __aFulshr(CONCAT22(sVar45,j),pl.id);
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasLoadedMiningRobotsWorking,
                                         lpfl->id | 0x8000,lpfl->id,(short)(byte *)l,(short)uVar43,
                                         sVar46,sVar45,uVar22,sVar47);
                        pbVar40 = l;
                        lVar44 = l2;
                        pbVar39 = amount;
                        pbVar15 = amountEdit;
                      }
                    }
                  }
                  if ((pbVar39 != pbVar40) && (action == 6)) {
                    fFulfilled = 0;
                  }
                  if (((pbVar40 != (byte *)0x0) && (action == 7)) && (j == 4)) {
                    wtOptimalFuel = pbVar40;
                  }
                }
              }
            }
            break;
          case 2:
          case 4:
            pbVar39 = pbVar15;
            if ((byte *)CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2),
                                 *(byte **)(((FLEET *)lpfl)->rgwtMin + j)) < pbVar15) {
              pbVar39 = (byte *)CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2),
                                         *(byte **)(((FLEET *)lpfl)->rgwtMin + j));
            }
            amount = pbVar39;
TURN_Unload:
            if (iLoad == 0) {
              amount = pbVar39;
              if (((j == 3) && ((local_78 >> 8 & 0xf) == 1)) &&
                 (pl.iPlayer != ((FLEET *)lpfl)->iPlayer)) {
                if ((pl.iPlayer == -1) && (((uint)pl.wFlags >> 0xd & 1) == 0)) {
                  idm = 0x55;
                }
                else {
                  sVar45 = GetRaceStat((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                             rsMajorAdv);
                  lVar44 = l2;
                  pbVar40 = l;
                  pbVar39 = amount;
                  pbVar15 = amountEdit;
                  if (sVar45 == raMacintosh) {
                    idm = 0x56;
                  }
                  else {
                    if (((uint)pl.wFlags >> 9 & 1) == 0) {
                      FQueueColonistDrop(lpfl,(PLANET *)&pl,(long)amount);
                      pbVar40 = l;
                      pbVar39 = amount;
                      lVar44 = l2;
                      pbVar15 = amountEdit;
                      goto LAB_10b0_7ae8;
                    }
                    idm = 0x135;
                  }
                }
              }
              else {
                if (((j != 3) || ((local_78 >> 8 & 0xf) != 2)) ||
                   (((FLEET *)lpfl)->iPlayer == (local_7a >> 9 & 0xf))) {
                  if ((local_78 >> 8 & 0xf) == 2) {
                    iVar23 = ((FLEET *)lpflWP)->iPlayer * 0xc0 + 0x5a12;
                    cFuel2 = CONCAT22(iVar23,(THING *)cFuel2);
                    if (*(char *)(iVar23 + ((FLEET *)lpfl)->iPlayer) == '\x02') {
                      amount._0_2_ = (byte *)0x0;
                      amount._2_2_ = 0;
                      pbVar39 = (byte *)0x0;
                      goto LAB_10b0_7ae8;
                    }
                  }
                  if ((j != 3) || ((local_78 >> 8 & 0xf) != 4)) {
                    if (pbVar39 != (byte *)0x0) {
                      if ((fFueling == 0) || (j == 4)) {
                        pbVar40 = (byte *)ChgCargo(local_78 >> 8 &
                                                         (grobjThing|grobjOther|grobjFleet|
                                                         grobjPlanet),local_7a,j,(long)pbVar39,
                                                         (void *)0x0);
                        l = pbVar40;
                        if (0 < (long)pbVar40) {
                          sVar46 = 0;
                          sVar45 = j;
                          uVar22 = xWP;
                          uVar19 = idWP;
                          uVar43 = __aFulshr(CONCAT22(xWP,j),idWP);
                          if (j == 3) {
                            MVar20 = idmHasBeamed2;
                          }
                          else {
                            MVar20 = idmHasUnloaded;
                          }
                          FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar20,lpfl->id | 0x8000,
                                           lpfl->id,(short)(byte *)l,(short)uVar43,sVar45,uVar22,
                                           uVar19,sVar46);
                          pbVar40 = l;
                        }
                        amount = pbVar40;
                        pbVar39 = pbVar40;
                        lVar44 = l2;
                        pbVar15 = amountEdit;
                      }
                      else {
                        pbVar40 = (byte *)ChgCargo(grobjPlanet,pl.id,j,(long)pbVar39,
                                                         (void *)0x0);
                        sVar46 = 0;
                        sVar45 = j;
                        uVar22 = xWP;
                        uVar19 = pl.id;
                        l = pbVar40;
                        uVar43 = __aFulshr(CONCAT22(xWP,j),pl.id);
                        if (j == 3) {
                          MVar20 = idmHasBeamed2;
                        }
                        else {
                          MVar20 = idmHasUnloaded;
                        }
                        FSendPlrMsg(((FLEET *)lpfl)->iPlayer,MVar20,lpfl->id | 0x8000,lpfl->id,
                                         (short)(byte *)l,(short)uVar43,sVar45,uVar22,uVar19,sVar46)
                        ;
                        pbVar40 = l;
                        pbVar39 = amount;
                        lVar44 = l2;
                        pbVar15 = amountEdit;
                      }
                    }
LAB_10b0_7ae8:
                    amount._2_2_ = (int)((ulong)pbVar39 >> 0x10);
                    amount._0_2_ = (byte *)pbVar39;
                    if (pbVar39 != (byte *)0x0) {
                      iVar23 = -(int)(byte *)amount;
                      iVar25 = amount._2_2_ + (uint)((byte *)amount != (byte *)0x0);
                      l = pbVar40;
                      amount = pbVar39;
                      l2 = lVar44;
                      amountEdit = pbVar15;
                      pbVar40 = (byte *)ChgCargo(grobjFleet,lpfl->id,j,
                                                       CONCAT22(-iVar25,iVar23),(void *)0x0);
                      l = pbVar40;
                      pbVar39 = amount;
                      lVar44 = l2;
                      pbVar15 = amountEdit;
                    }
                    amount = pbVar39;
                    l2 = lVar44;
                    local_76[j] = local_76[j] & 0xfff;
                    lVar44 = l2;
                    pbVar39 = amount;
                    break;
                  }
                  FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasTriedBeamColonistsDeepSpaceOrder,
                                    lpfl->id | 0x8000,lpfl->id,0);
                  goto TURN_CancelOrder;
                }
                idm = 0x155;
              }
              l = pbVar40;
              l2 = lVar44;
              amountEdit = pbVar15;
              amount = pbVar39;
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,pl.id);
              goto TURN_CancelOrder;
            }
            break;
          case 7:
            if (j == 4) {
              wtOptimalFuel._0_2_ = (byte *)0x0;
              wtOptimalFuel._2_2_ = 0;
              wtOptimalFuel = (byte *)0x0;
              fOptFuel = 1;
            }
            else if (iLoad != 0) {
              if (1 < fDunnage) {
                amount._0_2_ = amountWP;
                amount._2_2_ = local_8;
                pbVar16 = (byte *)CONCAT22(local_8,amountWP);
                pbVar39 = (byte *)CONCAT22(local_8,amountWP);
                iVar23 = local_8;
                if (amountWP == (byte *)0x0) goto joined_r0x10b070d0;
                goto TURN_Load;
              }
              fDunnage = 1;
            }
            break;
          case 8:
            puVar4 = (uint *)(((FLEET *)lpfl)->rgwtMin + j);
            pbVar18 = (byte *)amountEdit + -*puVar4;
            amount._2_2_ = (amountEdit._2_2_ - *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2)) -
                           (uint)((byte *)amountEdit < (byte *)*puVar4);
            amount._0_2_ = pbVar18;
            pbVar39 = (byte *)CONCAT22(amount._2_2_,pbVar18);
            if (amount._2_2_ < 0) {
              if (iLoad == 0) {
                amount._2_2_ = -(amount._2_2_ + (uint)(pbVar18 != (byte *)0x0));
                amount._0_2_ = (byte *)-(int)pbVar18;
                pbVar39 = (byte *)CONCAT22(amount._2_2_,(byte *)-(int)pbVar18);
                goto TURN_Unload;
              }
            }
            else {
              pbVar39 = (byte *)CONCAT22(amount._2_2_,pbVar18);
              if (iLoad != 0) {
                if ((local_8 <= amount._2_2_) &&
                   (((local_8 < amount._2_2_ || (amountWP < pbVar18)) && (fDone = 0, iPass == 4))))
                {
                  if (j == 3) {
                    idm = idmAttemptedSetNumberBoardUnfortunatelyCouldntProvi;
                  }
                  else {
                    idm = idmAttemptedSetAmountBoardUnfortunatelyCouldntProvi;
                  }
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,j,
                                   local_76[j] & 0xfff,0,xWP,idWP,0);
                  pbVar40 = l;
                  lVar44 = l2;
                  pbVar15 = amountEdit;
                }
                pbVar16 = (byte *)CONCAT22(amount._2_2_,(byte *)amount);
                goto TURN_Load;
              }
            }
            break;
          case 9:
            amount._0_2_ = amountWP + -(int)(byte *)amountEdit;
            amount._2_2_ = (local_8 - amountEdit._2_2_) - (uint)(amountWP < (byte *)amountEdit);
            pbVar16 = (byte *)CONCAT22(amount._2_2_,(byte *)amount);
            pbVar39 = (byte *)CONCAT22(amount._2_2_,(byte *)amount);
            iVar23 = iLoad;
            if ((amount._2_2_ < 1) && (amount._2_2_ < 0)) {
              pbVar39 = (byte *)CONCAT22(amount._2_2_,(byte *)amount);
              if (iLoad == 0) {
                pbVar18 = (byte *)-(int)(byte *)amount;
                amount._2_2_ = -(amount._2_2_ + (uint)((byte *)amount != (byte *)0x0));
                uVar21 = *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2);
                if (((int)uVar21 < amount._2_2_) ||
                   (((int)uVar21 <= amount._2_2_ &&
                    (*(byte **)(((FLEET *)lpfl)->rgwtMin + j) <= pbVar18)))) {
                  pbVar18 = *(byte **)(((FLEET *)lpfl)->rgwtMin + j);
                  amount._2_2_ = *(int *)((int)(((FLEET *)lpfl)->rgwtMin + j) + 2);
                }
                amount._0_2_ = pbVar18;
                pbVar39 = (byte *)CONCAT22(amount._2_2_,pbVar18);
                goto TURN_Unload;
              }
            }
            else {
joined_r0x10b070d0:
              if (iVar23 != 0) goto TURN_Load;
            }
          }
switchD_10b0_7b5d_default:
          j = j + 1;
        }
        if (((fOptFuel != 0) && (iLoad != 0)) && (fDunnage != 1)) {
          if (((FLEET *)lpfl)->cord < 2) {
            amount._0_2_ = (byte *)0x0;
            amount._2_2_ = 0;
            pbVar39 = (byte *)0x0;
            iExcess = CONCAT22(*(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12),
                               (int)((FLEET *)lpfl)->rgwtMin[4]);
TURN_SetOptAmount:
            amount = pbVar39;
            amountEdit = pbVar15;
            if (((int)iExcess == 0) && (iExcess._2_2_ == 0)) {
              l._0_2_ = (byte *)0x0;
              l._2_2_ = 0;
              l = (byte *)0x0;
            }
            else {
              l = pbVar40;
              l2 = lVar44;
              lVar44 = ChgCargo(local_78 >> 8 & (grobjThing|grobjOther|grobjFleet|grobjPlanet)
                                      ,local_7a,4,iExcess,(void *)0x0);
              l2 = lVar44;
              if (lVar44 != 0) {
                pbVar40 = (byte *)ChgCargo(grobjFleet,lpfl->id,4,
                                                 CONCAT22(-((int)((ulong)lVar44 >> 0x10) +
                                                           (uint)((int)lVar44 != 0)),-(int)lVar44),
                                                 (void *)0x0);
                l = pbVar40;
                lVar44 = l2;
              }
            }
            pbVar39 = amount;
            if (lVar44 != 0) {
              l = l + (long)wtOptimalFuel;
              l2 = lVar44;
              if ((long)l < 1) {
                if (((long)l < 0x10000) && ((long)l < 0)) {
                  sVar46 = 0;
                  sVar45 = 4;
                  uVar22 = xWP;
                  uVar19 = idWP;
                  uVar43 = __aFulshr(CONCAT22(xWP,4),idWP);
                  FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasUnloaded,lpfl->id | 0x8000,
                                   lpfl->id,-(int)(byte *)l,(short)uVar43,sVar45,uVar22,uVar19,
                                   sVar46);
                  lVar44 = l2;
                  pbVar39 = amount;
                }
              }
              else {
                sVar46 = 0;
                sVar45 = 4;
                uVar22 = xWP;
                uVar19 = idWP;
                uVar43 = __aFulshr(CONCAT22(xWP,4),idWP);
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasLoaded,lpfl->id | 0x8000,lpfl->id,
                                 (short)(byte *)l,(short)uVar43,sVar45,uVar22,uVar19,sVar46);
                lVar44 = l2;
                pbVar39 = amount;
              }
            }
          }
          else {
            pbVar39 = (byte *)EstFuelUse(lpfl,0,-1,-1,0);
            amount = pbVar39;
            uVar36 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar26 = (FLEET *)lpfl;
            lVar44 = l2;
            if (CONCAT22(*(undefined2 *)((int)pFVar26->rgwtMin + 0x12),(int)pFVar26->rgwtMin[4]) <
                (long)pbVar39) {
              fDone = 0;
              if (wtOptimalFuel != (byte *)0x0) {
                sVar46 = 0;
                sVar45 = 4;
                uVar22 = xWP;
                uVar19 = idWP;
                uVar43 = __aFulshr(CONCAT22(xWP,4),idWP);
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmHasLoaded,lpfl->id | 0x8000,lpfl->id,
                                 (short)(byte *)wtOptimalFuel,(short)uVar43,sVar45,uVar22,uVar19,
                                 sVar46);
                pbVar39 = amount;
                lVar44 = l2;
              }
              l2 = lVar44;
              amount = pbVar39;
              if ((iPass == 4) && (fHasPermission == 0)) {
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmFailedLoadFuel,lpfl->id | 0x8000,
                                 lpfl->id,xWP,idWP,0,0,0,0);
                pbVar39 = amount;
                pbVar40 = l;
                lVar44 = l2;
                pbVar15 = amountEdit;
              }
              else {
                pbVar40 = l;
                pbVar15 = amountEdit;
                if (iPass == 2) {
                  lMaxFuel = LGetFleetStat(lpfl,1);
                  if (lMaxFuel < (long)amount) {
                    sVar47 = 0;
                    uVar22 = 0;
                    uVar43 = __aFulshr(0,unaff_DI);
                    sVar46 = (short)uVar43;
                    sVar45 = (short)(byte *)amount;
                    uVar43 = __aFulshr(CONCAT22(sVar46,(byte *)amount),uVar22);
                    FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idmWillNeverMakeWaypointFuelCapacityMg
                                     ,lpfl->id | 0x8000,lpfl->id,(uint)lMaxFuel,(short)uVar43,sVar45
                                     ,sVar46,uVar22,sVar47);
                    pbVar39 = amount;
                    pbVar40 = l;
                    lVar44 = l2;
                    pbVar15 = amountEdit;
                  }
                  else {
                    uVar36 = (undefined2)((ulong)lpfl >> 0x10);
                    puVar4 = (uint *)(((FLEET *)lpfl)->rgwtMin + 4);
                    cFuel2 = CONCAT22((amount._2_2_ - *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12)
                                      ) - (uint)((byte *)amount < *puVar4),
                                      (int)(byte *)amount - *puVar4);
                    if (fMining == 2) {
                      idWP = pl.id;
                    }
                    sVar46 = 0;
                    sVar45 = 0;
                    uVar43 = __aFulshr(0,unaff_DI);
                    FSendPlrMsg(((FLEET *)lpfl)->iPlayer,
                                     idmThereIsntEnoughFuelAvailableAllowGet,lpfl->id | 0x8000,xWP,
                                     idWP,lpfl->id,(short)(THING *)cFuel2,(short)uVar43,sVar45,
                                     sVar46);
                    pbVar39 = amount;
                    pbVar40 = l;
                    lVar44 = l2;
                    pbVar15 = amountEdit;
                  }
                }
              }
              goto TURN_FinishFleet;
            }
            if ((long)pbVar39 <
                CONCAT22(*(undefined2 *)((int)pFVar26->rgwtMin + 0x12),(int)pFVar26->rgwtMin[4])) {
              lMaxFuel = CONCAT22(*(undefined2 *)((int)pFVar26->rgwtMin + 0x12),
                                  (int)pFVar26->rgwtMin[4]);
              do {
                amount._2_2_ = (int)((ulong)pbVar39 >> 0x10);
                amount._0_2_ = (byte *)pbVar39;
                uVar36 = (undefined2)((ulong)lpfl >> 0x10);
                *(byte **)(((FLEET *)lpfl)->rgwtMin + 4) = (byte *)amount;
                *(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12) = amount._2_2_;
                amount = pbVar39;
                pbVar39 = (byte *)EstFuelUse(lpfl,0,-1,-1,0);
                amount = pbVar39;
                uVar36 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar26 = (FLEET *)lpfl;
              } while ((long)pbVar39 <
                       CONCAT22(*(undefined2 *)((int)pFVar26->rgwtMin + 0x12),
                                (int)pFVar26->rgwtMin[4]));
              iExcess = CONCAT22((lMaxFuel._2_2_ - (int)((ulong)pbVar39 >> 0x10)) -
                                 (uint)((uint)lMaxFuel < (uint)pbVar39),
                                 (uint)lMaxFuel - (uint)pbVar39);
              *(uint *)(pFVar26->rgwtMin + 4) = (uint)lMaxFuel;
              *(int *)((int)pFVar26->rgwtMin + 0x12) = lMaxFuel._2_2_;
              pbVar40 = l;
              lVar44 = l2;
              pbVar15 = amountEdit;
              goto TURN_SetOptAmount;
            }
          }
          pbVar40 = l;
          pbVar15 = amountEdit;
          if ((fDone != 0) && (fFulfilled != 0)) {
            local_6e = 0;
          }
        }
TURN_FinishFleet:
        if (fFulfilled == 0) {
          l = pbVar40;
          amount = pbVar39;
          l2 = lVar44;
          amountEdit = pbVar15;
          lVar41 = GetCargoFree(lpfl);
          pbVar40 = l;
          pbVar39 = amount;
          lVar44 = l2;
          pbVar15 = amountEdit;
          if (0 < lVar41) {
            fDone = 0;
          }
        }
        l = pbVar40;
        amount = pbVar39;
        l2 = lVar44;
        amountEdit = pbVar15;
        if ((fDone == 0) || (fDunnage != 1)) goto LAB_10b0_80f5;
        lVar44 = GetCargoFree(lpfl);
        if ((lVar44 < 1) && (fOptFuel == 0)) goto LAB_10b0_80f5;
        fDunnage = 2;
        pbVar40 = l;
        pbVar39 = amount;
        lVar44 = l2;
        pbVar15 = amountEdit;
      } while( true );
    }
    if ((((THING *)lpthWP != (THING *)0x0) || (lpthWP._2_2_ != 0)) &&
       ((uint)lpthWP->idFull >> 0xd == 1)) goto TURN_LTryDunnage;
    if (((THING *)lpthWP != (THING *)0x0) || (lpthWP._2_2_ != 0)) {
      FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHadOrdersTransferCargoFutilePursuit,
                        lpfl->id | 0x8000,lpfl->id,(uint)lpthWP->idFull >> 0xd);
    }
    goto TURN_CancelOrder;
  }
  if ((((local_78 & 0xf) == 5) && (iPass == 1)) || ((local_78 & 0xf) == 2)) {
    if (pFVar26->idPlanet == -1) {
      if ((local_78 & 0xf) != 2) {
        pl.id = 0xffff;
        pl.iPlayer = -1;
        pl.wFlags = pl.wFlags & 0xfdff;
        goto TURN_LScrap;
      }
      FSendPlrMsg2(pFVar26->iPlayer,idmHasOrderColonizeCurrentlyOrbitPlanetOrder,
                        lpfl->id | 0x8000,lpfl->id,0);
    }
    else {
      sVar45 = FLookupPlanet(pFVar26->idPlanet,&pl);
      if ((sVar45 != 0) || ((local_78 & 0xf) != 2)) {
TURN_LScrap:
        if ((local_78 & 0xf) == 2) {
          pFVar26 = (FLEET *)lpfl;
          uVar36 = (undefined2)((ulong)lpfl >> 0x10);
          if (pl.iPlayer == -1) {
            if (((int)pFVar26->rgwtMin[3] != 0) || (*(int *)((int)pFVar26->rgwtMin + 0xe) != 0))
            goto LAB_10b0_829a;
            FSendPlrMsg2(pFVar26->iPlayer,idmHasOrdersColonizeHaveFailedBringAlong,
                              lpfl->id | 0x8000,lpfl->id,pl.id);
          }
          else {
            FSendPlrMsg(pFVar26->iPlayer,idmHasOrdersColonizeAlreadyPopulatedColonizeOrder,
                             lpfl->id | 0x8000,lpfl->id,pl.id,pl.id,0,0,0,0);
          }
        }
        else {
LAB_10b0_829a:
          lpth = (THING *)((ulong)lpth & 0xffff);
          while (iVar23 = lpth._2_2_, (int)lpth._2_2_ < 3) {
            rgwt[lpth._2_2_ * 2] = 0;
            rgwt[iVar23 * 2 + 1] = 0;
            lpth = (THING *)CONCAT22(lpth._2_2_ + 1,(THING *)lpth);
          }
          fColonize = 0;
          csh = 0;
          _memset((byte *)rgTechBattle,0,6);
          _memset((byte *)rgTechTrader,0,0xd);
          lpth = (THING *)((ulong)lpth & 0xffff);
          while( true ) {
            pFVar26 = (FLEET *)lpfl;
            uVar36 = (undefined2)((ulong)lpfl >> 0x10);
            if (0xf < (int)lpth._2_2_) break;
            if (0 < pFVar26->rgcsh[lpth._2_2_]) {
              csh = csh + pFVar26->rgcsh[lpth._2_2_];
              iVar23 = pFVar26->iPlayer * 4;
              MarkTechsSeen
                        ((HUL *)CONCAT22(*(undefined2 *)(iVar23 + 0x100),
                                         (HUL *)(*(int *)(iVar23 + 0xfe) + lpth._2_2_ * 0x93)),
                         pFVar26->iPlayer);
              cFuel2 = cFuel2 & 0xffff;
              while( true ) {
                uVar36 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar26 = (FLEET *)lpfl;
                iVar23 = pFVar26->iPlayer * 4;
                if ((int)(uint)*(byte *)(*(int *)(iVar23 + 0xfe) + lpth._2_2_ * 0x93 + 0x7a) <=
                    cFuel2._2_2_) break;
                iVar23 = pFVar26->iPlayer * 4;
                if ((*(int *)(*(int *)(iVar23 + 0xfe) + lpth._2_2_ * 0x93 + 0x3a + cFuel2._2_2_ * 4)
                     == 0x1000) &&
                   ((iVar23 = pFVar26->iPlayer * 4,
                    (*(uint *)(*(int *)(iVar23 + 0xfe) + lpth._2_2_ * 0x93 + cFuel2._2_2_ * 4 + 0x3c
                              ) & 0xff) == 0 ||
                    (iVar23 = pFVar26->iPlayer * 4,
                    (*(uint *)(*(int *)(iVar23 + 0xfe) + lpth._2_2_ * 0x93 + cFuel2._2_2_ * 4 + 0x3c
                              ) & 0xff) == 1)))) {
                  fColonize = 1;
                }
                cFuel2 = CONCAT22(cFuel2._2_2_ + 1,(THING *)cFuel2);
              }
            }
            lpth = (THING *)CONCAT22(lpth._2_2_ + 1,(THING *)lpth);
          }
          if (((local_78 & 0xf) == 2) && (fColonize == 0)) {
            FSendPlrMsg(pFVar26->iPlayer,idmHasOrdersColonizeNoneShipsHaveColonization,
                             lpfl->id | 0x8000,lpfl->id,pl.id,lpfl->id,0,0,0,0);
          }
          else {
            lXferMinerals = 0;
            if (((local_78 & 0xf) == 5) && (pl.iPlayer != -1)) {
              sVar45 = GetRaceGrbit((PLAYER *)rgplr + pl.iPlayer,
                                          ibitRaceGeneralizedResearch|ibitRaceTT);
              if (sVar45 == 0) goto LAB_10b0_8510;
              fUltimate = 1;
            }
            else {
LAB_10b0_8510:
              fUltimate = 0;
            }
            fBleeding = GetRaceGrbit((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                           ibitRaceBleedingEdgeTech);
            gd._4_2_ = gd._4_2_ & 0xfff7 | 8;
            idPlayer = ((FLEET *)lpfl)->iPlayer;
            lpth = (THING *)((ulong)lpth & 0xffff);
            while( true ) {
              if (2 < (int)lpth._2_2_) break;
              rglQuan._2_2_ = 0;
              lpth = (THING *)((ulong)lpth._2_2_ << 0x10);
              cFuel2 = cFuel2 & 0xffff;
              while (cFuel2._2_2_ < 0x10) {
                if (0 < ((FLEET *)lpfl)->rgcsh[cFuel2._2_2_]) {
                  if (fBleeding == 0) {
                    iVar23 = ((FLEET *)lpfl)->iPlayer * 4;
                    lMaxFuel = CONCAT22(*(undefined2 *)(iVar23 + 0x100),
                                        *(int *)(iVar23 + 0xfe) + cFuel2._2_2_ * 0x93);
                  }
                  else {
                    iVar23 = ((FLEET *)lpfl)->iPlayer * 4;
                    uVar36 = *(undefined2 *)(iVar23 + 0x100);
                    puVar32 = (undefined2 *)(*(int *)(iVar23 + 0xfe) + cFuel2._2_2_ * 0x93);
                    puVar34 = (undefined2 *)shdefT;
                    for (iVar23 = 0x49; iVar23 != 0; iVar23 = iVar23 + -1) {
                      puVar9 = puVar34;
                      puVar34 = puVar34 + 1;
                      puVar6 = puVar32;
                      puVar32 = puVar32 + 1;
                      *puVar9 = *puVar6;
                    }
                    *(undefined1 *)puVar34 = *(undefined1 *)puVar32;
                    UpdateShdefCost((SHDEF *)(SHDEF *)shdefT);
                    lMaxFuel = shdefT;
                  }
                  uVar43 = __aFulmul((long)((FLEET *)lpfl)->rgcsh[cFuel2._2_2_],
                                             (ulong)*(uint *)((uint)lMaxFuel + 0x2c + lpth._2_2_ * 2
                                                             ));
                  iExcess = CONCAT22((int)uVar43,(int)iExcess);
                  cFuel2 = CONCAT22(cFuel2._2_2_,(int)(uVar43 >> 0x10));
                  if (*(int *)((int)lMaxFuel + 0x7b) < 0) {
                    lVar44 = __aFldiv(uVar43,4);
                    iExcess = CONCAT22((int)lVar44,(int)iExcess);
                    cFuel2 = CONCAT22(cFuel2._2_2_,(int)((ulong)lVar44 >> 0x10));
                  }
                  bVar38 = CARRY2(rglQuan._2_2_,iExcess._2_2_);
                  rglQuan._2_2_ = rglQuan._2_2_ + iExcess._2_2_;
                  lpth = (THING *)CONCAT22(lpth._2_2_,
                                           (THING *)(((THING *)lpth)->rgb +
                                                    (uint)bVar38 + (int)(THING *)cFuel2 + -6));
                }
                cFuel2 = CONCAT22(cFuel2._2_2_ + 1,(THING *)cFuel2);
              }
              if ((local_78 & 0xf) == 2) {
                uVar37 = 0;
                uVar36 = 4;
                uVar43 = __aFulmul(CONCAT22((THING *)lpth,rglQuan._2_2_),3);
                lVar44 = __aFldiv(uVar43,CONCAT22(uVar37,uVar36));
                rglQuan._2_2_ = (uint)lVar44;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar44 >> 0x10));
              }
              else if (pl.id == 0xffff) {
                lVar44 = __aFldiv(CONCAT22((THING *)lpth,rglQuan._2_2_),3);
                rglQuan._2_2_ = (uint)lVar44;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar44 >> 0x10));
              }
              else if (((uint)pl.wFlags >> 9 & 1) == 0) {
                if (fUltimate == 0) {
                  lVar44 = __aFldiv(CONCAT22((THING *)lpth,rglQuan._2_2_),3);
                  rglQuan._2_2_ = (uint)lVar44;
                  lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar44 >> 0x10));
                }
                else {
                  uVar37 = 0;
                  uVar36 = 0x14;
                  uVar43 = __aFulmul(CONCAT22((THING *)lpth,rglQuan._2_2_),9);
                  lVar44 = __aFldiv(uVar43,CONCAT22(uVar37,uVar36));
                  rglQuan._2_2_ = (uint)lVar44;
                  lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar44 >> 0x10));
                }
              }
              else if (fUltimate == 0) {
                uVar37 = 0;
                uVar36 = 5;
                lVar44 = __aFlshl(5,unaff_DI);
                lVar44 = __aFldiv(lVar44,CONCAT22(uVar37,uVar36));
                rglQuan._2_2_ = (uint)lVar44;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar44 >> 0x10));
              }
              else {
                uVar37 = 0;
                uVar36 = 10;
                uVar43 = __aFulmul(CONCAT22((THING *)lpth,rglQuan._2_2_),9);
                lVar44 = __aFldiv(uVar43,CONCAT22(uVar37,uVar36));
                rglQuan._2_2_ = (uint)lVar44;
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((ulong)lVar44 >> 0x10));
              }
              uVar36 = lpPlanets._2_2_;
              uVar21 = *(uint *)(((FLEET *)lpfl)->rgwtMin + lpth._2_2_);
              bVar38 = CARRY2(rglQuan._2_2_,uVar21);
              uVar21 = rglQuan._2_2_ + uVar21;
              rglQuan = (byte *)CONCAT22(uVar21,(byte *)rglQuan);
              pTVar14 = (THING *)(((THING *)lpth)->rgb +
                                 (uint)bVar38 +
                                 *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + lpth._2_2_) + 2) + -6);
              lXferMinerals =
                   CONCAT22(pTVar14->rgb +
                            (uint)CARRY2((uint)lXferMinerals,uVar21) + lXferMinerals._2_2_ + -6,
                            (uint)lXferMinerals + uVar21);
              if (pl.id == 0xffff) {
                *(uint *)(pl.rgwtMin + lpth._2_2_) = uVar21;
                *(int *)((int)pl.rgwtMin + lpth._2_2_ * 4 + 2) = (int)pTVar14;
              }
              else {
                pPVar17 = (PLANET *)lpPlanets + pl.id;
                puVar4 = (uint *)(pPVar17->rgwtMin + lpth._2_2_);
                uVar12 = *puVar4;
                *puVar4 = *puVar4 + uVar21;
                puVar4 = (uint *)((int)(pPVar17->rgwtMin + lpth._2_2_) + 2);
                *puVar4 = (uint)(pTVar14->rgb + (uint)CARRY2(uVar12,uVar21) + *puVar4 + -6);
              }
              lpth = (THING *)CONCAT22(lpth._2_2_ + 1,pTVar14);
            }
            iExcess = CONCAT22(iExcess._2_2_,pl.id);
            if (fUltimate == 0) {
              if (pl.id == 0xffff) {
                lpthWP = (THING *)0x0;
                DropSalvage(&lpthWP,(long *)pl.rgwtMin,(uint)lpfl->id >> 9 & 0xf,&ord);
                uVar22 = WFromLpfl(lpfl);
                FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasDismantledScrapLeftDeepSpace,-6,
                                  lpthWP->idFull,uVar22);
              }
              else {
                idm = ((uint)pl.wFlags >> 9 & 1) + 0x59;
                p7 = 0;
                sVar48 = 0;
                sVar47 = 0;
                uVar21 = pl.id;
                uVar43 = __aFulshr((ulong)(uint)pl.id,0);
                sVar46 = (short)uVar43;
                sVar45 = (uint)lXferMinerals;
                uVar22 = WFromLpfl(lpfl);
                FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,(int)iExcess,uVar22,sVar45,sVar46,
                                 uVar21,sVar47,sVar48,p7);
                idm = ((uint)pl.wFlags >> 9 & 1) + 0x140;
                if (((uint)pl.wFlags >> 9 & 1) != 0) {
                  sVar45 = ITechLearnATech
                                     (pl.iPlayer,0,0,~idmColonistsDroppedMassacredGroundTroops,
                                      (ushort *)&iExcess);
                  lpth = (THING *)CONCAT22(sVar45,(THING *)lpth);
                  if (sVar45 == 0) {
                    iExcess = CONCAT22(iExcess._2_2_,pl.id);
                  }
                  else {
                    idm = 0x13c;
                    if (sVar45 < 0) {
                      iVar23 = -(sVar45 + 1);
                    }
                    else {
                      iVar23 = sVar45 + -1;
                      idm = 0x13d;
                    }
                    lpth = (THING *)CONCAT22(iVar23,(THING *)lpth);
                  }
                }
                sVar47 = 0;
                sVar46 = 0;
                uVar22 = pl.id;
                sVar45 = lpth._2_2_;
                uVar43 = __aFulshr(CONCAT22(lpth._2_2_,pl.id),0);
                FSendPlrMsg(pl.iPlayer,idm,(int)iExcess,lpfl->id,(uint)lXferMinerals,
                                 (short)uVar43,uVar22,sVar45,sVar46,sVar47);
              }
            }
            else {
              lResUltimate._0_2_ = 0;
              lResUltimate._2_2_ = 0;
              cFuel2 = cFuel2 & 0xffff;
              while (cFuel2._2_2_ < 0x10) {
                if (0 < ((FLEET *)lpfl)->rgcsh[cFuel2._2_2_]) {
                  if (fBleeding == 0) {
                    iVar23 = ((FLEET *)lpfl)->iPlayer * 4;
                    lMaxFuel = CONCAT22(*(undefined2 *)(iVar23 + 0x100),
                                        *(int *)(iVar23 + 0xfe) + cFuel2._2_2_ * 0x93);
                  }
                  else {
                    iVar23 = ((FLEET *)lpfl)->iPlayer * 4;
                    uVar36 = *(undefined2 *)(iVar23 + 0x100);
                    puVar32 = (undefined2 *)(*(int *)(iVar23 + 0xfe) + cFuel2._2_2_ * 0x93);
                    puVar34 = (undefined2 *)shdefT;
                    for (iVar23 = 0x49; iVar23 != 0; iVar23 = iVar23 + -1) {
                      puVar9 = puVar34;
                      puVar34 = puVar34 + 1;
                      puVar6 = puVar32;
                      puVar32 = puVar32 + 1;
                      *puVar9 = *puVar6;
                    }
                    *(undefined1 *)puVar34 = *(undefined1 *)puVar32;
                    UpdateShdefCost((SHDEF *)(SHDEF *)shdefT);
                    lMaxFuel = shdefT;
                  }
                  uVar43 = __aFulmul((long)((FLEET *)lpfl)->rgcsh[cFuel2._2_2_],
                                             (ulong)*(uint *)((int)lMaxFuel + 0x2a));
                  iExcess = CONCAT22((int)uVar43,(int)iExcess);
                  cFuel2 = CONCAT22(cFuel2._2_2_,(int)(uVar43 >> 0x10));
                  if (*(int *)((int)lMaxFuel + 0x7b) < 0) {
                    lVar44 = __aFldiv(uVar43,4);
                    iExcess = CONCAT22((int)lVar44,(int)iExcess);
                    cFuel2 = CONCAT22(cFuel2._2_2_,(int)((ulong)lVar44 >> 0x10));
                  }
                  bVar38 = CARRY2((uint)lResUltimate,iExcess._2_2_);
                  lResUltimate._0_2_ = (uint)lResUltimate + iExcess._2_2_;
                  lResUltimate._2_2_ = lResUltimate._2_2_ + (int)(THING *)cFuel2 + (uint)bVar38;
                }
                cFuel2 = CONCAT22(cFuel2._2_2_ + 1,(THING *)cFuel2);
              }
              if ((-1 < lResUltimate._2_2_) && (0 < lResUltimate._2_2_)) {
                lResUltimate._0_2_ = 0xffff;
                lResUltimate._2_2_ = 0;
              }
              ((ushort *)vrgPlanResExtra)[pl.id] =
                   ((ushort *)vrgPlanResExtra)[pl.id] + (uint)lResUltimate;
              if ((-1 < lResUltimate._2_2_) &&
                 (((0 < lResUltimate._2_2_ ||
                   (lResUltimate = CONCAT22(lResUltimate._2_2_,(uint)lResUltimate),
                   (uint)lResUltimate != 0)) &&
                  (lResUltimate = CONCAT22(lResUltimate._2_2_,(uint)lResUltimate), pl.iPlayer != -1)
                  ))) {
                uVar21 = CResourcesAtPlanet((PLANET *)&pl,pl.iPlayer);
                lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)((int)uVar21 >> 0xf));
                iVar23 = (uint)lResUltimate + uVar21;
                pbVar18 = ((THING *)((int)uVar21 >> 0xf))->rgb +
                          (uint)CARRY2((uint)lResUltimate,uVar21) + lResUltimate._2_2_ + -6;
                rglQuan._2_2_ = uVar21;
                uVar43 = __aFulmul(CONCAT22(lResUltimate._2_2_,(uint)lResUltimate),
                                           (long)(int)uVar21);
                lResUltimate = __aFldiv(uVar43,CONCAT22(pbVar18,iVar23));
              }
              idm = ((uint)pl.wFlags >> 9 & 1) + 0x5c;
              sVar48 = 0;
              uVar43 = __aFulshr((ulong)unaff_DI << 0x10,unaff_SI);
              uVar19 = (ushort)uVar43;
              uVar22 = pl.id;
              sVar46 = (uint)lResUltimate;
              uVar43 = __aFulshr(CONCAT22((uint)lResUltimate,pl.id),uVar19);
              sVar47 = (short)uVar43;
              sVar45 = (uint)lXferMinerals;
              p1 = WFromLpfl(lpfl);
              FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,(int)iExcess,p1,sVar45,sVar47,uVar22,
                               sVar46,uVar19,sVar48);
              idm = ((uint)pl.wFlags >> 9 & 1) + 0x142;
              if (((uint)pl.wFlags >> 9 & 1) == 0) {
                iExcess = CONCAT22(iExcess._2_2_,pl.id);
              }
              else {
                sVar45 = ITechLearnATech
                                   (pl.iPlayer,0,0,~idmColonistsDroppedMassacredGroundTroops,
                                    (ushort *)&iExcess);
                if (sVar45 == 0) {
                  iExcess = CONCAT22(iExcess._2_2_,pl.id);
                  iVar23 = 0;
                }
                else {
                  idm = 0x13e;
                  if (sVar45 < 0) {
                    iVar23 = -(sVar45 + 1);
                  }
                  else {
                    iVar23 = sVar45 + -1;
                    idm = 0x13f;
                  }
                }
                lpth = (THING *)CONCAT22(iVar23,(THING *)lpth);
              }
              sVar46 = lpth._2_2_;
              uVar43 = __aFulshr(CONCAT22(unaff_DI,lpth._2_2_),unaff_SI);
              uVar19 = (ushort)uVar43;
              uVar22 = pl.id;
              sVar45 = (uint)lResUltimate;
              uVar43 = __aFulshr(CONCAT22((uint)lResUltimate,pl.id),uVar19);
              FSendPlrMsg(pl.iPlayer,idm,(int)iExcess,lpfl->id,(uint)lXferMinerals,
                               (short)uVar43,uVar22,sVar45,uVar19,sVar46);
            }
            idPlayer = -1;
            gd._4_2_ = gd._4_2_ & 0xfff7;
            FRemovePlayerMessage
                      (((FLEET *)lpfl)->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000);
            uVar37 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar26 = (FLEET *)lpfl;
            pFVar26->wFlags = pFVar26->wFlags & 0xfbffU | 0x400;
            uVar36 = lpPlanets._2_2_;
            pPVar17 = (PLANET *)lpPlanets;
            if ((local_78 & 0xf) == 2) {
              FQueueColonistDrop
                        (lpfl,(PLANET *)&pl,
                         CONCAT22(*(undefined2 *)((int)pFVar26->rgwtMin + 0xe),
                                  (int)pFVar26->rgwtMin[3]));
            }
            else if ((pFVar26->idPlanet != -1) &&
                    (((PLANET *)lpPlanets)[pFVar26->idPlanet].iPlayer == pFVar26->iPlayer)) {
              uVar12 = *(uint *)(pFVar26->rgwtMin + 3);
              iVar23 = *(int *)((int)pFVar26->rgwtMin + 0xe);
              iVar25 = pFVar26->idPlanet;
              puVar4 = (uint *)(((PLANET *)lpPlanets)[iVar25].rgwtMin + 3);
              uVar21 = *puVar4;
              *puVar4 = *puVar4 + uVar12;
              piVar2 = (int *)((int)pPVar17[iVar25].rgwtMin + 0xe);
              *piVar2 = *piVar2 + iVar23 + (uint)CARRY2(uVar21,uVar12);
            }
          }
        }
      }
    }
    goto TURN_CancelOrder;
  }
  if ((local_78 & 0xf) == 3) {
    cFuel2 = 0;
    if ((iPass == 3) && (((uint)pFVar26->wFlags >> 0xd & 1) != 0)) {
      if (pFVar26->idPlanet == -1) {
        FSendPlrMsg2(pFVar26->iPlayer,idmRemoteMiningRobotsHadOrdersMineDeep,lpfl->id | 0x8000,
                          lpfl->id,0);
      }
      else {
        iExcess = (long)LpplFromId(pFVar26->idPlanet);
        if (((PLANET *)iExcess != (PLANET *)0x0) || ((int)((ulong)iExcess >> 0x10) != 0)) {
          cFuel2 = CMineFromLpfl(lpfl);
          uVar36 = (undefined2)((ulong)lpfl >> 0x10);
          if (((int)cFuel2 != 0) || ((int)((ulong)cFuel2 >> 0x10) != 0)) {
            if (*(int *)((int)iExcess + 2) == -1) {
              EstMineralsMined((PLANET *)iExcess,&rglQuan,cFuel2,1);
            }
            else {
              sVar45 = GetRaceStat((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,
                                         rsMajorAdv);
              if (sVar45 != raMacintosh) {
                FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmRemoteMiningRobotsHadOrdersMinePlanet,
                                  lpfl->id | 0x8000,lpfl->id,*(short *)iExcess);
                goto TURN_CancelOrder;
              }
            }
            goto LAB_10b0_67b6;
          }
          FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHadOrdersMineFleetDoesntHaveAny,
                            lpfl->id | 0x8000,lpfl->id,*(short *)iExcess);
        }
      }
      goto TURN_CancelOrder;
    }
  }
  else if ((local_78 & 0xf) == 8) {
    if ((pFVar26->cord == 1) && (pFVar26->idPlanet != -1)) {
      cFuel2 = (long)LpplFromId(pFVar26->idPlanet);
      uVar36 = (undefined2)((ulong)cFuel2 >> 0x10);
      if ((((PLANET *)cFuel2)->iPlayer == ((FLEET *)lpfl)->iPlayer) &&
         ((((PLANET *)cFuel2)->wRouting & 0x3ffU) != 0)) {
        AutoRouteFleet(lpfl,(PLANET *)cFuel2);
        uVar36 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar26 = (FLEET *)lpfl;
        if (((uint)((PLORD *)pFVar26->lpplord + 7)->wFlags >> 4 & 0xf) == 0) {
          MVar20 = idmHasReroutedUnfortuentlyDoesHaveEnoughFuel;
        }
        else {
          MVar20 = idmHasRerouted;
        }
        FSendPlrMsg(pFVar26->iPlayer,MVar20,lpfl->id | 0x8000,lpfl->id,pFVar26->idPlanet,
                         (*(uint *)((int)cFuel2 + 0x30) & 0x3ff) - 1,0,0,0,0);
      }
      else if (iPass == 4) {
        AutoFleetOrder(lpfl,(PLANET *)cFuel2);
        uVar37 = (undefined2)((ulong)lpfl >> 0x10);
        uVar36 = *(undefined2 *)((int)&((FLEET *)lpfl)->lpplord + 2);
        psVar30 = (short *)(*(int *)&((FLEET *)lpfl)->lpplord + 4);
        pPVar31 = &ord;
        for (iVar23 = 9; iVar23 != 0; iVar23 = iVar23 + -1) {
          pPVar8 = pPVar31;
          pPVar31 = (POINT *)&pPVar31->y;
          psVar5 = psVar30;
          psVar30 = psVar30 + 1;
          pPVar8->x = *psVar5;
        }
        if ((local_78 & 0xf) == 4) goto TURN_LDoMerge;
      }
    }
  }
  else if ((local_78 & 0xf) == 4) {
    if ((iPass & 1U) == 0) {
TURN_LDoMerge:
      if ((local_78 >> 8 & 0xf) == 2) {
        cFuel2 = (long)LpflFromId(local_7a);
        iVar23 = (int)((ulong)cFuel2 >> 0x10);
        pFVar26 = (FLEET *)cFuel2;
        if (((pFVar26 != (FLEET *)0x0) || (iVar23 != 0)) && (((uint)pFVar26->wFlags >> 10 & 1) == 0)
           ) {
          if (((FLEET *)lpfl != pFVar26) || (lpfl._2_2_ != iVar23)) {
            if (pFVar26->iPlayer == ((FLEET *)lpfl)->iPlayer) {
              sVar45 = ((FLEET *)cFuel2)->id;
              uVar22 = WFromLpfl(lpfl);
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasMerged,*(uint *)cFuel2 | 0x8000,
                                uVar22,sVar45);
              FRemovePlayerMessage
                        (((FLEET *)lpfl)->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000);
              Merge2Fleets((FLEET *)cFuel2,lpfl,1);
            }
            else {
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                idmUnableCompleteMergeOrdersDestinationFleetWasnt,lpfl->id | 0x8000,
                                lpfl->id,0);
            }
          }
          goto TURN_CancelOrder;
        }
      }
      FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmUnableCompleteMergeOrdersWaypointDestinationWasn
                        ,lpfl->id | 0x8000,lpfl->id,0);
      goto TURN_CancelOrder;
    }
  }
  else if ((local_78 & 0xf) == 9) {
    if (iPass == 4) {
      iplrDest = local_76[0];
      if (pFVar26->iPlayer <= (int)local_76[0]) {
        iplrDest = local_76[0] + 1;
      }
      if (((iplrDest < 0) || (game.cPlayer <= iplrDest)) ||
         ((*(uint *)((int)&rgplr[0].wFlags + iplrDest * 0xc0) & 1) != 0)) {
        FSendPlrMsg2(pFVar26->iPlayer,idmCouldntGiveAwayBecausePlayerDead,lpfl->id | 0x8000,
                          lpfl->id,0);
      }
      else {
        if ((*(uint *)((int)&rgplr[0].wMdPlr + iplrDest * 0xc0) >> 9 & 1) == 0) {
          iVar23 = iplrDest * 0xc0 + 0x5a12;
          lpshdefDest = (SHDEF *)CONCAT22(iVar23,(SHDEF *)lpshdefDest);
          if (*(char *)(iVar23 + pFVar26->iPlayer) != '\x02') {
            iVar23 = *(int *)((int)pFVar26->rgwtMin + 0xe);
            if ((iVar23 < 0) || ((iVar23 < 1 && ((int)pFVar26->rgwtMin[3] == 0)))) {
              cFuel2 = CONCAT22(0xffff,(THING *)cFuel2);
              ish = 0;
              while( true ) {
                if (0xf < ish) break;
                if (((FLEET *)lpfl)->rgcsh[ish] == 0) {
                  (&rgishMap)[ish] = 0xffff;
                }
                else {
                  iVar23 = ((FLEET *)lpfl)->iPlayer * 4;
                  ishMatch = IshFindSimilarDesign
                                       ((HUL *)CONCAT22(*(undefined2 *)(iVar23 + 0x100),
                                                        (HUL *)(*(int *)(iVar23 + 0xfe) + ish * 0x93
                                                               )),iplrDest);
                  if (ishMatch == 0xffff) {
                    do {
                      uVar21 = cFuel2._2_2_ + 1;
                      cFuel2 = CONCAT22(uVar21,(THING *)cFuel2);
                      if (0xf < (int)uVar21) break;
                    } while ((*(uint *)(*(int *)(iplrDest * 4 + 0xfe) + uVar21 * 0x93 + 0x7b) >> 9 &
                             1) == 0);
                    if (0xf < (int)uVar21) goto TURN_SellNoCap;
                    (&rgishMap)[ish] = uVar21;
                  }
                  else {
                    (&rgishMap)[ish] = ishMatch;
                  }
                }
                ish = ish + 1;
              }
              if ((*(uint *)((int)&rgplr[0].wFlags + iplrDest * 0xc0) & 0xfff) < 0x200) {
                lpflNew = LpflNew(iplrDest,((FLEET *)lpfl)->idPlanet);
                iVar23 = (int)((ulong)lpflNew >> 0x10);
                pFVar26 = (FLEET *)lpflNew;
                if ((pFVar26 != (FLEET *)0x0) || (iVar23 != 0)) {
                  uVar36 = (undefined2)((ulong)lpfl >> 0x10);
                  pFVar27 = (FLEET *)lpfl;
                  if (iplrDest < pFVar27->iPlayer) {
                    ifltcur = ifltcur + 1;
                  }
                  sVar45 = (pFVar27->pt).y;
                  (&pFVar26->pt)->x = (&pFVar27->pt)->x;
                  (pFVar26->pt).y = sVar45;
                  sVar45 = (pFVar27->pt).y;
                  uVar37 = (undefined2)((ulong)pFVar26->lpplord >> 0x10);
                  pPVar28 = (PLORD *)pFVar26->lpplord;
                  (pPVar28 + 1)->wFlags = (&pFVar27->pt)->x;
                  *(short *)&pPVar28[1].iordMax = sVar45;
                  for (ish = 0; ish < 5; ish = ish + 1) {
                    uVar37 = *(undefined2 *)((int)(pFVar27->rgwtMin + ish) + 2);
                    *(int *)(pFVar26->rgwtMin + ish) = (int)pFVar27->rgwtMin[ish];
                    *(undefined2 *)((int)(pFVar26->rgwtMin + ish) + 2) = uVar37;
                  }
                  for (ish = 0; ish < 0x10; ish = ish + 1) {
                    if (0 < pFVar27->rgcsh[ish]) {
                      uVar37 = *(undefined2 *)(iplrDest * 4 + 0x100);
                      pSVar24 = (SHDEF *)(*(int *)(iplrDest * 4 + 0xfe) + (&rgishMap)[ish] * 0x93);
                      lpshdefDest = (SHDEF *)CONCAT22(uVar37,pSVar24);
                      if (((uint)pSVar24->wFlags >> 9 & 1) != 0) {
                        iVar25 = pFVar27->iPlayer * 4;
                        uVar11 = *(undefined2 *)(iVar25 + 0x100);
                        pHVar33 = (HullDef *)(*(int *)(iVar25 + 0xfe) + ish * 0x93);
                        pSVar35 = pSVar24;
                        for (iVar25 = 0x49; iVar25 != 0; iVar25 = iVar25 + -1) {
                          pSVar10 = pSVar35;
                          pSVar35 = (SHDEF *)(pSVar35->hul).rgTech;
                          pHVar7 = pHVar33;
                          pHVar33 = pHVar33 + 1;
                          (pSVar10->hul).ihuldef = *pHVar7;
                        }
                        *(char *)&(pSVar35->hul).ihuldef = (char)*pHVar33;
                        shdefT._120_2_ = (&rgishMap)[ish];
                        pSVar24->wFlags = pSVar24->wFlags & 0x83ffU | (shdefT._120_2_ & 0x1f) << 10;
                        pSVar24->wFlags = pSVar24->wFlags & 0x7fffU | 0x8000;
                        *(undefined2 *)&pSVar24->cBuilt = 0;
                        *(undefined2 *)((int)&pSVar24->cBuilt + 2) = 0;
                        *(undefined2 *)&pSVar24->cExist = 0;
                        *(undefined2 *)((int)&pSVar24->cExist + 2) = 0;
                        pcVar1 = (char *)((int)&rgplr[0].cShDef + iplrDest * 0xc0);
                        *pcVar1 = *pcVar1 + '\x01';
                      }
                      pFVar26->rgcsh[(&rgishMap)[ish]] =
                           pFVar26->rgcsh[(&rgishMap)[ish]] + pFVar27->rgcsh[ish];
                      (pFVar26->rgdv + (&rgishMap)[ish])->dp = (pFVar27->rgdv + ish)->dp;
                      uVar12 = pFVar27->rgcsh[ish];
                      puVar4 = (uint *)&pSVar24->cBuilt;
                      uVar21 = *puVar4;
                      *puVar4 = *puVar4 + uVar12;
                      piVar2 = (int *)((int)&pSVar24->cBuilt + 2);
                      *piVar2 = *piVar2 + ((int)uVar12 >> 0xf) + (uint)CARRY2(uVar21,uVar12);
                      uVar12 = pFVar27->rgcsh[ish];
                      puVar4 = (uint *)&pSVar24->cExist;
                      uVar21 = *puVar4;
                      *puVar4 = *puVar4 + uVar12;
                      piVar2 = (int *)((int)&pSVar24->cExist + 2);
                      *piVar2 = *piVar2 + ((int)uVar12 >> 0xf) + (uint)CARRY2(uVar21,uVar12);
                    }
                  }
                  pFVar27->wFlags = pFVar27->wFlags & 0xfbffU | 0x400;
                  uVar21 = iplrDest | 0x30;
                  uVar22 = WFromLpfl(lpfl);
                  FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasSuccessfullyGiven,
                                    lpflNew->id | 0x8000,uVar22,uVar21);
                  uVar22 = WFromLpfl(lpflNew);
                  FSendPlrMsg2(iplrDest,idmHaveGiven,lpflNew->id | 0x8000,
                                    ((FLEET *)lpfl)->iPlayer | 0x30,uVar22);
                  uVar36 = (undefined2)((ulong)lpfl >> 0x10);
                  ((FLEET *)lpfl)->wFlags = ((FLEET *)lpfl)->wFlags & 0xfbffU | 0x400;
                  goto LAB_10b0_67b6;
                }
              }
TURN_SellNoCap:
              FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,
                                idmCouldntGiveAwayBecauseDidntHaveAdministrative,lpfl->id | 0x8000,
                                lpfl->id,iplrDest | 0x30);
              FSendPlrMsg2(iplrDest,idmAttemptedGiveFleetDontHaveEnoughExcess,-1,
                                ((FLEET *)lpfl)->iPlayer | 0x30,0);
            }
            else {
              FSendPlrMsg2(pFVar26->iPlayer,idmCouldntGiveAwayBecauseThereColonistsBoard,
                                lpfl->id | 0x8000,lpfl->id,0);
            }
            goto TURN_CancelOrder;
          }
        }
        FSendPlrMsg2(pFVar26->iPlayer,idmSnubAttemptedGiftRefuseFleet,lpfl->id | 0x8000,
                          iplrDest | 0x30,0);
      }
      goto TURN_CancelOrder;
    }
  }
  else if ((local_78 & 0xf) == 6) {
LAB_10b0_999e:
    idm = 0xc3;
    if (iPass == 3) {
      uVar36 = (undefined2)((ulong)lpfl >> 0x10);
      if (((uint)((FLEET *)lpfl)->wFlags >> 0xd & 1) == 0) {
        sVar45 = GetRaceStat((PLAYER *)rgplr + ((FLEET *)lpfl)->iPlayer,rsMajorAdv);
        if (sVar45 != raMines) goto LAB_10b0_67b6;
      }
      lMaxFuel = CLayMinesFromLpfl(lpfl,-1,-1);
      pFVar26 = (FLEET *)lpfl;
      uVar36 = (undefined2)((ulong)lpfl >> 0x10);
      if (((int)lMaxFuel == 0) && ((int)((ulong)lMaxFuel >> 0x10) == 0)) {
        FSendPlrMsg2(pFVar26->iPlayer,idmHasAttemptedLayMinesOrderHasCanceled,lpfl->id | 0x8000
                          ,lpfl->id,0);
        goto TURN_CancelOrder;
      }
      if ((local_78 & 0xf) == 6) {
        if (((PLORD *)pFVar26->lpplord + 3)->wFlags == 0) {
          *(uint *)&((PLORD *)pFVar26->lpplord)[2].iordMax =
               *(uint *)&((PLORD *)pFVar26->lpplord)[2].iordMax & 0xfff0;
        }
        else if (((PLORD *)pFVar26->lpplord + 3)->wFlags != 5) {
          pPVar3 = (PLORD *)pFVar26->lpplord + 3;
          pPVar3->wFlags = pPVar3->wFlags + -1;
        }
      }
      for (j = 0; j < 3; j = j + 1) {
        lMaxFuel = CLayMinesFromLpfl(lpfl,j,-1);
        if (((int)lMaxFuel != 0) || ((int)((ulong)lMaxFuel >> 0x10) != 0)) {
          if (((uint)((FLEET *)lpfl)->wFlags >> 0xd & 1) == 0) {
            lMaxFuel = __aFldiv(lMaxFuel,2);
          }
          lXferMinerals = 0;
          rglQuan = (byte *)0x989680;
          lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
          local_b6 = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
          cFuel2 = CONCAT22(lpThings._2_2_,(THING *)lpThings + cThing);
          while( true ) {
            pFVar26 = (FLEET *)lpfl;
            uVar36 = (undefined2)((ulong)lpfl >> 0x10);
            if ((THING *)cFuel2 <= (THING *)lpth) break;
            if (((((uint)lpth->idFull >> 9 & 0xf) == pFVar26->iPlayer) &&
                ((uint)lpth->idFull >> 0xd == 0)) &&
               (uVar37 = (undefined2)((ulong)lpth >> 0x10), (uint)((THING *)lpth)->rgb[6] == j)) {
              dx = (&pFVar26->pt)->x - (&((THING *)lpth)->pt)->x;
              local_b0 = dx >> 0xf;
              iVar23 = (pFVar26->pt).y - (((THING *)lpth)->pt).y;
              iExcess = (long)iVar23;
              pTVar42 = (THING *)__aFulmul((long)iVar23,(long)iVar23);
              local_b6 = pTVar42;
              uVar43 = __aFulmul(CONCAT22(local_b0,dx),CONCAT22(local_b0,dx));
              l = local_b6->rgb + (uVar43 - 6);
              iVar25 = (int)((ulong)l >> 0x10);
              uVar36 = (undefined2)((ulong)lpth >> 0x10);
              iVar23 = *(int *)(((THING *)lpth)->rgb + 2);
              if (((iVar25 <= iVar23) &&
                  ((iVar25 < iVar23 || ((uint)l <= *(uint *)((THING *)lpth)->rgb)))) &&
                 ((long)l < (long)rglQuan)) {
                lXferMinerals = (long)lpth;
                rglQuan = l;
              }
            }
            lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
          }
          if ((((uint)lXferMinerals == 0) && (lXferMinerals._2_2_ == 0)) ||
             ((0xf < *(int *)((uint)lXferMinerals + 8) ||
              ((0xe < *(int *)((uint)lXferMinerals + 8) &&
               (0x423f < *(uint *)((uint)lXferMinerals + 6))))))) {
            lpth = LpthNew(pFVar26->iPlayer,ithMinefield);
            iVar23 = (int)((ulong)lpth >> 0x10);
            pTVar14 = (THING *)lpth;
            pFVar26 = (FLEET *)lpfl;
            uVar36 = (undefined2)((ulong)lpfl >> 0x10);
            if ((pTVar14 == (THING *)0x0) && (iVar23 == 0)) {
              FSendPlrMsg2(pFVar26->iPlayer,idmFailedLayMinesYearDueTechnicalDifficulties,
                                lpfl->id | 0x8000,lpfl->id,0);
              goto LAB_10b0_9ea2;
            }
            sVar45 = (pFVar26->pt).y;
            (&pTVar14->pt)->x = (&pFVar26->pt)->x;
            (pTVar14->pt).y = sVar45;
            *(uint *)pTVar14->rgb = (uint)lMaxFuel;
            *(int *)(pTVar14->rgb + 2) = lMaxFuel._2_2_;
            pTVar14->rgb[6] = (byte)j;
          }
          else {
            iVar23 = (uint)lMaxFuel + *(uint *)((uint)lXferMinerals + 6);
            iVar25 = lMaxFuel._2_2_ + *(int *)((uint)lXferMinerals + 8) +
                     (uint)CARRY2((uint)lMaxFuel,*(uint *)((uint)lXferMinerals + 6));
            uVar43 = __aFulmul((long)(&pFVar26->pt)->x,lMaxFuel);
            uVar36 = (undefined2)((ulong)lXferMinerals >> 0x10);
            iVar29 = (int)lXferMinerals;
            local_b6 = (THING *)uVar43;
            uVar43 = __aFulmul((long)*(int *)(iVar29 + 2),
                                       CONCAT22(*(undefined2 *)(iVar29 + 8),
                                                *(undefined2 *)(iVar29 + 6)));
            lVar44 = __aFldiv(uVar43 + (long)local_b6,CONCAT22(iVar25,iVar23));
            uVar36 = (undefined2)((ulong)lXferMinerals >> 0x10);
            iVar25 = (int)lXferMinerals;
            *(undefined2 *)(iVar25 + 2) = (int)lVar44;
            iVar23 = (uint)lMaxFuel + *(uint *)(iVar25 + 6);
            iVar25 = lMaxFuel._2_2_ + *(int *)(iVar25 + 8) +
                     (uint)CARRY2((uint)lMaxFuel,*(uint *)(iVar25 + 6));
            pTVar42 = (THING *)__aFulmul((long)(((FLEET *)lpfl)->pt).y,lMaxFuel);
            uVar36 = (undefined2)((ulong)lXferMinerals >> 0x10);
            iVar29 = (int)lXferMinerals;
            local_b6 = pTVar42;
            uVar43 = __aFulmul((long)*(int *)(iVar29 + 4),
                                       CONCAT22(*(undefined2 *)(iVar29 + 8),
                                                *(undefined2 *)(iVar29 + 6)));
            lVar44 = __aFldiv((long)(local_b6->rgb + (uVar43 - 6)),CONCAT22(iVar25,iVar23));
            uVar36 = (undefined2)((ulong)lXferMinerals >> 0x10);
            iVar23 = (int)lXferMinerals;
            *(undefined2 *)(iVar23 + 4) = (int)lVar44;
            puVar4 = (uint *)(iVar23 + 6);
            uVar21 = *puVar4;
            *puVar4 = *puVar4 + (uint)lMaxFuel;
            *(int *)(iVar23 + 8) =
                 *(int *)(iVar23 + 8) + lMaxFuel._2_2_ + (uint)CARRY2(uVar21,(uint)lMaxFuel);
            idm = 0xc4;
          }
          sVar48 = 0;
          sVar47 = 0;
          sVar46 = 0;
          sVar45 = 0;
          uVar43 = __aFulshr(0,0);
          FSendPlrMsg(((FLEET *)lpfl)->iPlayer,idm,lpfl->id | 0x8000,lpfl->id,(uint)lMaxFuel,
                           (short)uVar43,sVar45,sVar46,sVar47,sVar48);
        }
LAB_10b0_9ea2:
      }
    }
  }
  else if (((local_78 & 0xf) == 0) && (1 < pFVar26->cord)) {
    sVar45 = GetRaceStat((PLAYER *)rgplr + pFVar26->iPlayer,rsMajorAdv);
    if ((sVar45 == raMines) &&
       (pPVar3 = ((FLEET *)lpfl)->lpplord, (((PLORD *)pPVar3 + 7)->wFlags & 0xfU) == 6))
    goto LAB_10b0_999e;
  }
  goto LAB_10b0_67b6;
LAB_10b0_80f5:
  if ((fDone == 0) || (iLoad == 0)) {
    if (fMining == 2) {
      local_7a = pl.id;
      local_78 = local_78 & 0xf0ff | 0x100;
    }
    uVar37 = (undefined2)((ulong)lpfl >> 0x10);
    uVar36 = *(undefined2 *)((int)&((FLEET *)lpfl)->lpplord + 2);
    psVar30 = (short *)(*(int *)&((FLEET *)lpfl)->lpplord + 4);
    pPVar31 = &ord;
    for (iVar23 = 9; iVar23 != 0; iVar23 = iVar23 + -1) {
      psVar5 = psVar30;
      psVar30 = psVar30 + 1;
      pPVar8 = pPVar31;
      pPVar31 = (POINT *)&pPVar31->y;
      *psVar5 = pPVar8->x;
    }
  }
  else {
TURN_CancelOrder:
    uVar36 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar26 = (FLEET *)lpfl;
    if (((pFVar26->cord == 1) && (((uint)pFVar26->wFlags >> 10 & 1) == 0)) &&
       ((*(uint *)&((PLORD *)pFVar26->lpplord)[2].iordMax & 0xf) != 0)) {
      FRemovePlayerMessage(pFVar26->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000);
      FSendPlrMsg2(((FLEET *)lpfl)->iPlayer,idmHasCompletedAssignedOrders,lpfl->id | 0x8000,
                        lpfl->id,0);
    }
    uVar36 = (undefined2)((ulong)lpfl >> 0x10);
    pPVar3 = ((FLEET *)lpfl)->lpplord;
    pPVar13 = ((FLEET *)lpfl)->lpplord;
    *(uint *)&((PLORD *)pPVar13)[2].iordMax = *(uint *)&((PLORD *)pPVar3)[2].iordMax & 0xfff0;
  }
LAB_10b0_67b6:
  ifltcur = ifltcur + 1;
  goto LAB_10b0_67ba;
}



