// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: InitBattlePlan
// Address: 1078:00c0
// Segment: MEMORY_CREATE
// ======================================================================


void InitBattlePlan(BTLPLAN *lpbtlplan,short iplan,short iplr)

{
  ushort *puVar1;
  BTLPLAN *pBVar2;
  int iVar3;
  ushort *puVar4;
  BTLPLAN *pBVar5;
  BTLPLAN *pBVar6;
  undefined2 uVar7;
  
  puVar4 = (ushort *)(iplan * 0x24 + 0xc);
  uVar7 = (undefined2)((ulong)lpbtlplan >> 0x10);
  pBVar5 = (BTLPLAN *)lpbtlplan;
  pBVar6 = pBVar5;
  for (iVar3 = 0x12; iVar3 != 0; iVar3 = iVar3 + -1) {
    pBVar2 = pBVar6;
    pBVar6 = (BTLPLAN *)&pBVar6->wFlags_0x2;
    puVar1 = puVar4;
    puVar4 = puVar4 + 1;
    pBVar2->wFlags = *puVar1;
  }
  lpbtlplan->wFlags = lpbtlplan->wFlags & 0xfff0 | iplr & 0xfU;
  if (((game.wCrap >> 2 & 1) != 0) && (iplan == 0)) {
    pBVar5->wFlags_0x2 = pBVar5->wFlags_0x2 & 0xe0ff | 0x300;
  }
  return;
}



// ======================================================================
// Function: GenerateWorld
// Address: 1078:0136
// Segment: MEMORY_CREATE
// ======================================================================

// Decompilation failed: 
Low-level Error: Forced merge caused intersection

// ======================================================================
// Function: CreateStartupShip
// Address: 1078:4690
// Segment: MEMORY_CREATE
// ======================================================================


short CreateStartupShip(short iplr,short idPlanet,short ishdef,short fAddShdef)

{
  char *pcVar1;
  uint *puVar2;
  int *piVar3;
  HullDef *pHVar4;
  char cVar5;
  FLEET *pFVar6;
  uint uVar7;
  undefined2 uVar8;
  undefined2 uVar9;
  int iVar10;
  SHDEF *pSVar11;
  HullDef *pHVar12;
  SHDEF *pSVar13;
  FLEET *lpfl_00;
  long lVar14;
  FLEET *lpfl;
  short ishMac;
  
  if (fAddShdef != 0) {
    cVar5 = *(char *)((int)&rgplr[0].cShDef + iplr * 0xc0);
    pcVar1 = (char *)((int)&rgplr[0].cShDef + iplr * 0xc0);
    *pcVar1 = *pcVar1 + '\x01';
    uVar7 = (uint)cVar5;
    pSVar13 = LpshdefT();
    uVar8 = (undefined2)((ulong)pSVar13 >> 0x10);
    pSVar11 = (SHDEF *)pSVar13 + ishdef;
    uVar9 = *(undefined2 *)(iplr * 4 + 0x100);
    pHVar12 = (HullDef *)(*(int *)(iplr * 4 + 0xfe) + uVar7 * 0x93);
    for (iVar10 = 0x49; iVar10 != 0; iVar10 = iVar10 + -1) {
      pHVar4 = pHVar12;
      pHVar12 = pHVar12 + 1;
      pSVar13 = pSVar11;
      pSVar11 = (SHDEF *)(pSVar11->hul).rgTech;
      *pHVar4 = (pSVar13->hul).ihuldef;
    }
    *(char *)pHVar12 = (char)(pSVar11->hul).ihuldef;
    *(uint *)(*(int *)(iplr * 4 + 0xfe) + uVar7 * 0x93 + 0x7b) =
         *(uint *)(*(int *)(iplr * 4 + 0xfe) + uVar7 * 0x93 + 0x7b) & 0x83ff | (uVar7 & 0x1f) << 10;
    ishdef = uVar7;
  }
  uVar9 = *(undefined2 *)(iplr * 4 + 0x100);
  iVar10 = *(int *)(iplr * 4 + 0xfe) + ishdef * 0x93;
  puVar2 = (uint *)(iVar10 + 0x83);
  uVar7 = *puVar2;
  *puVar2 = *puVar2 + 1;
  piVar3 = (int *)(iVar10 + 0x85);
  *piVar3 = *piVar3 + (uint)(0xfffe < uVar7);
  uVar9 = *(undefined2 *)(iplr * 4 + 0x100);
  iVar10 = *(int *)(iplr * 4 + 0xfe) + ishdef * 0x93;
  puVar2 = (uint *)(iVar10 + 0x7f);
  uVar7 = *puVar2;
  *puVar2 = *puVar2 + 1;
  piVar3 = (int *)(iVar10 + 0x81);
  *piVar3 = *piVar3 + (uint)(0xfffe < uVar7);
  lpfl_00 = LpflNew(iplr,idPlanet);
  uVar9 = (undefined2)((ulong)lpfl_00 >> 0x10);
  pFVar6 = (FLEET *)lpfl_00;
  pFVar6->rgcsh[ishdef] = 1;
  lVar14 = LGetFleetStat(lpfl_00,1);
  *(int *)(pFVar6->rgwtMin + 4) = (int)lVar14;
  *(undefined2 *)((int)pFVar6->rgwtMin + 0x12) = (int)((ulong)lVar14 >> 0x10);
  pFVar6->iplan = 0;
  return ishdef;
}



// ======================================================================
// Function: GenNewGameFromFile
// Address: 1078:4812
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10785712) */
/* WARNING: Removing unreachable block (ram,0x10785512) */
/* WARNING: Removing unreachable block (ram,0x10785311) */
/* WARNING: Removing unreachable block (ram,0x107851bf) */
/* WARNING: Removing unreachable block (ram,0x10785412) */
/* WARNING: Removing unreachable block (ram,0x10785612) */
/* WARNING: Removing unreachable block (ram,0x10785812) */
/* WARNING: Removing unreachable block (ram,0x10785085) */
/* WARNING: Variable defined which should be unmapped: lvlAi */
/* WARNING: Variable defined which should be unmapped: idAi */
/* WARNING: Removing unreachable block (ram,0x10784ba6) */
/* WARNING: Removing unreachable block (ram,0x10784a69) */
/* WARNING: Restarted to delay deadcode elimination for space: ram */

short GenNewGameFromFile(char *pszFile)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  PLAYER *pPVar3;
  char cVar4;
  short sVar5;
  ushort uVar6;
  char *pcVar7;
  char *pcVar8;
  short sVar9;
  uint uVar10;
  int iVar11;
  undefined2 uVar12;
  PLAYER *pPVar13;
  undefined2 *puVar14;
  PLAYER *pPVar15;
  long lVar16;
  char *pcVar17;
  PLAYER *pPVar18;
  short lvlAi;
  short idAi;
  short cb;
  char *lpb;
  short j;
  short env [9];
  char *lpbStart;
  short fSuccess;
  short i;
  short c;
  short cNum;
  uint rgplrbmp [16];
  short cPlr;
  uint rgl [2];
  char *local_28;
  int local_26;
  uint local_24;
  int local_22;
  uint local_20;
  undefined2 local_1e;
  uint local_1c;
  uint local_18;
  uint local_14;
  
  fSuccess = 0;
  _strcpy((char *)szWork,pszFile);
  penvMem = &env;
  sVar5 = __setjmp(env);
  if (sVar5 != 0) goto CREATE_LError_3;
  if ((int)ini.wFlags < 0) {
    _strcpy((char *)szBase,pszFile);
    pcVar7 = _strrchr((char *)szBase,0x2e);
    *pcVar7 = '\0';
    TurnLog(idsGeneratingYearD);
  }
  _memset((GAME *)&game,0,0x40);
  StreamOpen(pszFile,0x20);
  lVar16 = __filelength(hf);
  uVar6 = (ushort)lVar16;
  if (15999 < (int)uVar6) {
    FileError(idsUniverseCreationFileAppearsInvalid);
    goto CREATE_LError_3;
  }
  pcVar17 = LpAlloc(uVar6 + 1,htPerm);
  uVar12 = (undefined2)((ulong)pcVar17 >> 0x10);
  lpbDefMac._0_2_ = (char *)pcVar17 + uVar6;
  lpbDefMac._2_2_ = uVar12;
  RgFromStream(pcVar17,uVar6);
  StreamClose();
  ((char *)pcVar17)[uVar6] = '\0';
  lpb = pcVar17;
  lpbStart = PszGetLine(&lpb);
  if ((*lpbStart == '\0') || (uVar6 = __fstrlen(lpbStart), 0x1f < uVar6)) {
    sVar5 = 0x10;
    pcVar7 = PszFormatIds(idsIllegalGameTitle,(short *)0x0);
    AlertSz(pcVar7,sVar5);
    goto CREATE_LError_3;
  }
  __fstrcpy(game.szName,lpbStart);
  if ((char *)lpb < (char *)lpbDefMac) {
    lpbStart = PszGetLine(&lpb);
    cNum = CParseNumbers(lpbStart,(long *)rgl,4);
    if (cNum == -1) {
CREATE_LUniDefError:
      sVar5 = 0x10;
      pcVar7 = PszFormatIds(idsLine2HasBadUniverseDefinitionParameter,(short *)0x0);
      AlertSz(pcVar7,sVar5);
      goto CREATE_LError_3;
    }
    for (i = 0; i < cNum; i = i + 1) {
      if (i < 3) {
        if ((int)rgl[i * 2 + 1] < 0) goto CREATE_LUniDefError;
        if (((0 < (int)rgl[i * 2 + 1]) || ((-1 < (int)rgl[i * 2 + 1] && (4 < rgl[i * 2])))) ||
           ((rgl[i * 2] == 4 && ((rgl[i * 2 + 1] == 0 && (i != 0)))))) goto CREATE_LUniDefError;
      }
    }
    if (0 < cNum) {
      game.mdSize = rgl[0];
    }
    if (1 < cNum) {
      game.mdDensity = (short)local_28;
    }
    if (2 < cNum) {
      game.mdStartDist = local_24;
    }
    if (3 < cNum) {
      Randomize(CONCAT22(local_1e,local_20));
    }
    if ((char *)lpb < (char *)lpbDefMac) {
      lpbStart = PszGetLine(&lpb);
      cNum = CParseNumbers(lpbStart,(long *)rgl,7);
      if (cNum == -1) {
CREATE_LUniDefError3:
        pcVar7 = PszFormatIds(idsLine3HasBadUniverseDefinitionParameter,(short *)0x0);
        AlertSz(pcVar7,0x10);
        goto CREATE_LError_3;
      }
      for (i = 0; i < cNum; i = i + 1) {
        if ((int)rgl[i * 2 + 1] < 0) goto CREATE_LUniDefError3;
        if ((-1 < (int)rgl[i * 2 + 1]) && ((0 < (int)rgl[i * 2 + 1] || (1 < rgl[i * 2]))))
        goto CREATE_LUniDefError3;
      }
      if (0 < cNum) {
        game.wCrap = game.wCrap & 0xfffe | rgl[0] & 1;
      }
      if (1 < cNum) {
        game.wCrap = game.wCrap & 0xfffd | ((uint)local_28 & 1) << 1;
      }
      if (2 < cNum) {
        game.wCrap = game.wCrap & 0xffdf | (local_24 & 1) << 5;
      }
      if (3 < cNum) {
        game.wCrap = game.wCrap & 0xff7f | (local_20 & 1) << 7;
      }
      if (4 < cNum) {
        game.wCrap = game.wCrap & 0xffef | (local_1c & 1) << 4;
      }
      if (5 < cNum) {
        game.wCrap = game.wCrap & 0xffbf | (local_18 & 1) << 6;
      }
      if (6 < cNum) {
        game.wCrap = game.wCrap & 0xfeff | (local_14 & 1) << 8;
      }
      lpbStart = PszGetLine(&lpb);
      cNum = CParseNumbers(lpbStart,(long *)rgl,1);
      if ((((cNum < 1) || ((int)rgl[1] < 0)) || (((int)rgl[1] < 1 && (rgl[0] == 0)))) ||
         ((-1 < (int)rgl[1] && ((0 < (int)rgl[1] || (0x10 < rgl[0])))))) {
        pcVar7 = PszFormatIds(idsLine4HasImproperNumberPlayerFiles,(short *)0x0);
        AlertSz(pcVar7,0x10);
        goto CREATE_LError_3;
      }
      if ((char *)lpb < (char *)lpbDefMac) {
        cPlr = rgl[0];
        game.cPlayer = rgl[0];
        for (i = 0; i < cPlr; i = i + 1) {
          pcVar17 = PszGetLine(&lpb);
          lpbStart = pcVar17;
          if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
          lpbStart._0_2_ = (char *)pcVar17;
          lpbStart._2_2_ = (undefined2)((ulong)pcVar17 >> 0x10);
          if ((i < 1) || (*pcVar17 != '#')) {
            __fstrcpy(szWork,pcVar17);
            sVar5 = FWasRaceFile((char *)szWork,0);
            if (sVar5 == 0) goto CREATE_LCantGetRace;
            pPVar15 = (PLAYER *)rgplr + i;
            pPVar13 = (PLAYER *)&vplr;
            for (iVar11 = 0x60; iVar11 != 0; iVar11 = iVar11 + -1) {
              pPVar3 = pPVar15;
              pPVar15 = (PLAYER *)&pPVar15->cPlanet;
              pPVar18 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              cVar4 = pPVar18->cShDef;
              pPVar3->iPlayer = pPVar18->iPlayer;
              pPVar3->cShDef = cVar4;
            }
          }
          else {
            pcVar17 = (char *)CONCAT22(lpbStart._2_2_,(char *)lpbStart + 1);
            cNum = CParseNumbers(pcVar17,(long *)rgl,2);
            uVar10 = rgl[0];
            if ((((cNum < 2) || ((int)rgl[0] < 0)) || (6 < (int)rgl[0])) ||
               (((int)local_28 < 0 || (4 < (int)local_28)))) {
              __fstrcpy(szWork,lpbStart);
CREATE_LCantGetRace:
              iVar11 = i + 5;
              pcVar7 = (char *)lpbStart;
              uVar12 = lpbStart._2_2_;
              pcVar8 = PszGetCompressedString(idsLineDUnableLoadRaceFileS);
              _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar8),iVar11,pcVar7,uVar12);
              AlertSz((char *)szWork,0x10);
              goto CREATE_LError_3;
            }
            if (local_28 == (char *)0x0) {
              lvlAi = Random(4);
            }
            else {
              lvlAi = (short)(local_28 + -1);
            }
            if (uVar10 == 0) {
              idAi = Random(6);
            }
            else {
              idAi = uVar10 - 1;
            }
            pPVar18 = LpplrComp(idAi,lvlAi);
            pPVar13 = (PLAYER *)pPVar18;
            pPVar15 = (PLAYER *)rgplr + i;
            for (iVar11 = 0x60; iVar11 != 0; iVar11 = iVar11 + -1) {
              pPVar2 = pPVar15;
              pPVar15 = (PLAYER *)&pPVar15->cPlanet;
              pPVar3 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              cVar4 = pPVar3->cShDef;
              pPVar2->iPlayer = pPVar3->iPlayer;
              pPVar2->cShDef = cVar4;
            }
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xfdff | 0x200;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0x1fff | idAi << 0xd;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xe3ff | (lvlAi & 7U) << 10
            ;
          }
        }
        lpbStart = PszGetLine(&lpb);
        cNum = CParseNumbers(lpbStart,(long *)rgl,2);
        if ((char *)lpb < (char *)lpbDefMac) {
          i = 0;
          if (((0 < cNum) && (-1 < (int)rgl[1])) &&
             (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
            if ((rgl[0] == 1) && (rgl[1] == 0)) {
              if ((((cNum < 2) || (local_26 < 0)) ||
                  ((local_26 < 1 && (local_28 < hbrButtonHilite)))) ||
                 ((-1 < local_26 &&
                  ((0 < local_26 ||
                   ((char *)((int)(ulong *)rgcrPlrHistory + 0x36) < local_28))))))
              goto CREATE_LBadDefVc;
              SetVCCheck((GAME *)&game,0,1);
              SetVCVal((GAME *)&game,0,(int)(local_28 + -0x14) / 5);
            }
            lpbStart = PszGetLine(&lpb);
            cNum = CParseNumbers(lpbStart,(long *)rgl,3);
            if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
            i = 1;
            if (((0 < cNum) && (-1 < (int)rgl[1])) &&
               (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
              if ((rgl[0] == 1) && (rgl[1] == 0)) {
                if (((cNum < 3) || (local_26 < 0)) ||
                   ((((local_26 < 1 && (local_28 < (char *)0x8)) || (0 < local_26)) ||
                    ((((-1 < local_26 && (hbrWindowText < local_28)) || (local_22 < 0)) ||
                     (((local_22 < 1 && (local_24 < 2)) ||
                      ((-1 < local_22 && ((0 < local_22 || (6 < local_24))))))))))))
                goto CREATE_LBadDefVc;
                SetVCCheck((GAME *)&game,1,1);
                SetVCCheck((GAME *)&game,2,1);
                SetVCVal((GAME *)&game,1,(short)(local_28 + -8));
                SetVCVal((GAME *)&game,2,local_24 - 2);
              }
              lpbStart = PszGetLine(&lpb);
              cNum = CParseNumbers(lpbStart,(long *)rgl,2);
              if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
              i = 2;
              if (((0 < cNum) && (-1 < (int)rgl[1])) &&
                 (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
                if ((rgl[0] == 1) && (rgl[1] == 0)) {
                  if ((((cNum < 2) || (local_26 < 0)) ||
                      ((local_26 < 1 && (local_28 < (char *)0x3e8)))) ||
                     ((-1 < local_26 &&
                      ((0 < local_26 || ((char *)rgbCur + 0x289 <= local_28))))))
                  goto CREATE_LBadDefVc;
                  SetVCCheck((GAME *)&game,3,1);
                  SetVCVal((GAME *)&game,3,(int)(local_28 + -1000) / 1000);
                }
                lpbStart = PszGetLine(&lpb);
                cNum = CParseNumbers(lpbStart,(long *)rgl,2);
                if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                i = 3;
                if (((0 < cNum) && (-1 < (int)rgl[1])) &&
                   (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
                  if ((rgl[0] == 1) && (rgl[1] == 0)) {
                    if ((((cNum < 2) || (local_26 < 0)) ||
                        ((local_26 < 1 && (local_28 < hbrButtonHilite)))) ||
                       ((-1 < local_26 && ((0 < local_26 || ((char *)0x12c < local_28))))))
                    goto CREATE_LBadDefVc;
                    SetVCCheck((GAME *)&game,4,1);
                    SetVCVal((GAME *)&game,4,(int)(local_28 + -0x14) / 10);
                  }
                  lpbStart = PszGetLine(&lpb);
                  cNum = CParseNumbers(lpbStart,(long *)rgl,2);
                  if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                  i = 4;
                  if (((0 < cNum) && (-1 < (int)rgl[1])) &&
                     (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
                    if ((rgl[0] == 1) && (rgl[1] == 0)) {
                      if ((((cNum < 2) || (local_26 < 0)) ||
                          ((local_26 < 1 && (local_28 < (char *)0xa)))) ||
                         ((-1 < local_26 &&
                          ((0 < local_26 || ((char *)szMine + 8 < local_28))))))
                      goto CREATE_LBadDefVc;
                      SetVCCheck((GAME *)&game,5,1);
                      SetVCVal((GAME *)&game,5,(int)(local_28 + -10) / 10);
                    }
                    lpbStart = PszGetLine(&lpb);
                    cNum = CParseNumbers(lpbStart,(long *)rgl,2);
                    if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                    i = 5;
                    if (((0 < cNum) && (-1 < (int)rgl[1])) &&
                       (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
                      if ((rgl[0] == 1) && (rgl[1] == 0)) {
                        if ((((cNum < 2) || (local_26 < 0)) ||
                            ((local_26 < 1 && (local_28 < (char *)0xa)))) ||
                           ((-1 < local_26 && ((0 < local_26 || ((char *)0x12c < local_28))))))
                        goto CREATE_LBadDefVc;
                        SetVCCheck((GAME *)&game,6,1);
                        SetVCVal((GAME *)&game,6,(int)(local_28 + -10) / 10);
                      }
                      lpbStart = PszGetLine(&lpb);
                      cNum = CParseNumbers(lpbStart,(long *)rgl,2);
                      if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                      i = 6;
                      if (((0 < cNum) && (-1 < (int)rgl[1])) &&
                         (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 2)))))) {
                        if ((rgl[0] == 1) && (rgl[1] == 0)) {
                          if ((((cNum < 2) || (local_26 < 0)) ||
                              ((local_26 < 1 && (local_28 < hbrDesktop)))) ||
                             ((-1 < local_26 &&
                              ((0 < local_26 ||
                               ((char *)s_Stars______s_____s_____s_1120_0373 + 0x11 < local_28))))))
                          goto CREATE_LBadDefVc;
                          SetVCCheck((GAME *)&game,7,1);
                          SetVCVal((GAME *)&game,7,(int)(local_28 + -0x1e) / 10);
                        }
                        lpbStart = PszGetLine(&lpb);
                        cNum = CParseNumbers(lpbStart,(long *)rgl,2);
                        if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                        i = 7;
                        if (((0 < cNum) && (-1 < (int)rgl[1])) &&
                           (((int)rgl[1] < 0 || (((int)rgl[1] < 1 && (rgl[0] < 8)))))) {
                          if ((-1 < (int)rgl[1]) && ((0 < (int)rgl[1] || (rgl[0] != 0)))) {
                            if ((((cNum < 2) || (local_26 < 0)) ||
                                ((local_26 < 1 && (local_28 < hbrDesktop)))) ||
                               ((-1 < local_26 &&
                                ((0 < local_26 || ((char *)szMine + 8 < local_28))))))
                            goto CREATE_LBadDefVc;
                            SetVCVal((GAME *)&game,8,rgl[0]);
                            SetVCVal((GAME *)&game,9,(int)(local_28 + -0x1e) / 10);
                          }
                          lpbStart = PszGetLine(&lpb);
                          uVar6 = __fstrlen(lpbStart);
                          lpb = (char *)CONCAT22(lpbStart._2_2_,(char *)lpbStart + (uVar6 - 1));
                          if ((((2 < (int)((char *)lpbStart + (uVar6 - 1)) - (int)(char *)lpbStart)
                               && (*lpb == 'y')) && (((char *)lpbStart)[uVar6 - 2] == 'x')) &&
                             (((char *)lpbStart)[uVar6 - 3] == '.')) {
                            ((char *)lpbStart)[uVar6 - 3] = '\0';
                          }
                          __fstrcpy(szBase,lpbStart);
                          if ((char *)lpb + 4 < (char *)lpbDefMac) {
                            lpbDefUni._0_2_ = (char *)lpb;
                            lpbDefUni._2_2_ = lpb._2_2_;
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) ==
                                 0) && (sVar5 = CAdvantagePoints
                                                          ((PLAYER *)rgplr + i), sVar5 < 0
                                       )) {
                              pPVar13 = (PLAYER *)rgplr + i;
                              puVar14 = (undefined2 *)&vrgplrDef;
                              for (iVar11 = 0x60; iVar11 != 0; iVar11 = iVar11 + -1) {
                                pPVar18 = pPVar13;
                                pPVar13 = (PLAYER *)&pPVar13->cPlanet;
                                puVar1 = puVar14;
                                puVar14 = puVar14 + 1;
                                uVar12 = *puVar1;
                                pPVar18->iPlayer = (char)uVar12;
                                pPVar18->cShDef = (char)((uint)uVar12 >> 8);
                              }
                              *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) =
                                   *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xffef |
                                   0x10;
                            }
                            if (*(char *)((int)rgplr[0].szName + i * 0xc0) == '\0') {
                              iVar11 = i * 0xc0;
                              sVar5 = Random(0x18);
                              CchGetString
                                        (sVar5 + idsBerserker,
                                         (char *)((int)rgplr[0].szName + iVar11));
                              _wsprintf((char *)CONCAT22(0x1120,(char *)((int)rgplr[0].
                                                                              szNames + i * 0xc0)),
                                        (char *)0x11200a2e,i * 0xc0 + 0x5a22,0x1120);
                            }
                          }
                          for (i = 1; i < game.cPlayer; i = i + 1) {
                            j = 0;
                            while ((j < i && (sVar5 = _strcmp((char *)((int)rgplr
                                                                                    [0].szName +
                                                                              i * 0xc0),
                                                                      (char *)((int)rgplr
                                                                                    [0].szName +
                                                                              j * 0xc0)), sVar5 != 0
                                             ))) {
                              j = j + 1;
                            }
                            if (j < i) {
                              c = Random(0x18);
LAB_1078_5b09:
                              for (j = 0; j < game.cPlayer; j = j + 1) {
                                pcVar7 = PszGetCompressedString(c + idsBerserker);
                                sVar5 = _strcmp((char *)((int)rgplr[0].szName +
                                                                j * 0xc0),pcVar7);
                                if (sVar5 == 0) break;
                              }
                              if (j != game.cPlayer) {
                                c = c + 1;
                                if (0x17 < c) {
                                  c = 0;
                                }
                                goto LAB_1078_5b09;
                              }
                              CchGetString
                                        (c + idsBerserker,
                                         (char *)((int)rgplr[0].szName + i * 0xc0));
                              _strcpy((char *)((int)rgplr[0].szNames + i * 0xc0),
                                              (char *)((int)rgplr[0].szName + i * 0xc0));
                              _strcat((char *)((int)rgplr[0].szNames + i * 0xc0),
                                              (char *)0xa32);
                            }
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            rgplrbmp[i] = *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 3
                                          & 0x1f;
                            if (((int)rgplrbmp[i] < 0) || (0x1f < (int)rgplrbmp[i])) {
                              rgplrbmp[i] = 0xffff;
                            }
                          }
                          for (i = 1; i < game.cPlayer; i = i + 1) {
                            if (rgplrbmp[i] != 0xffff) {
                              for (j = 0; (j < i && (rgplrbmp[j] != rgplrbmp[i])); j = j + 1) {
                              }
                              if (j < i) {
                                sVar9 = Random(2);
                                sVar5 = i;
                                if (sVar9 == 0) {
                                  sVar5 = j;
                                }
                                rgplrbmp[sVar5] = 0xffff;
                              }
                            }
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            if (rgplrbmp[i] == 0xffff) {
                              uVar10 = Random(0x20);
                              rgplrbmp[i] = uVar10;
                              while( true ) {
                                for (j = 0; (j < game.cPlayer &&
                                            ((j == i || (rgplrbmp[i] != rgplrbmp[j])))); j = j + 1)
                                {
                                }
                                if (j == game.cPlayer) break;
                                rgplrbmp[i] = rgplrbmp[i] + 1;
                                if (0x1f < (int)rgplrbmp[i]) {
                                  rgplrbmp[i] = 0;
                                }
                              }
                            }
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xff07 |
                                 (rgplrbmp[i] & 0x1f) << 3;
                          }
                          GenerateWorld(1);
                          fSuccess = 1;
                          goto CREATE_LError_3;
                        }
                      }
                    }
                  }
                }
              }
            }
          }
CREATE_LBadDefVc:
          iVar11 = i + cPlr + 5;
          i = iVar11;
          pcVar7 = PszGetCompressedString(idsLineDHasImproperVictoryConditionDefinition);
          _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar7),iVar11);
          AlertSz((char *)szWork,0x10);
          goto CREATE_LError_3;
        }
      }
    }
  }
CREATE_LUniDefShort:
  pcVar7 = PszFormatIds(idsUniverseDefinitionFileAppearsTooShort,(short *)0x0);
  AlertSz(pcVar7,0x10);
CREATE_LError_3:
  penvMem = (short (*) [9])0x0;
  StreamClose();
  lpbDefUni._0_2_ = (char *)0x0;
  lpbDefUni._2_2_ = 0;
  TurnLog(fSuccess + idsFailed);
  return fSuccess;
}



// ======================================================================
// Function: CreateTutorWorld
// Address: 1078:5e5e
// Segment: MEMORY_CREATE
// ======================================================================


void CreateTutorWorld(void)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  undefined2 uVar3;
  PLAYER *pPVar4;
  char cVar5;
  char *pcVar6;
  int iVar7;
  undefined2 unaff_SI;
  undefined2 *puVar8;
  undefined2 unaff_DI;
  PLAYER *pPVar9;
  PLAYER *pPVar10;
  PLAYER *pPVar11;
  char *pcVar12;
  undefined4 uVar13;
  short i;
  
  uVar13 = CONCAT22(unaff_SI,unaff_DI);
  _memset((GAME *)&game,0,0x40);
  game.cPlayer = 2;
  game.mdDensity = 0;
  game.mdSize = 0;
  game.mdStartDist = 1;
  game.wCrap = game.wCrap & 0xff17 | 0xe8;
  game.lid._0_2_ = 0xef49;
  game.lid._2_2_ = 0x8c;
  game.rgvc[7] = 0x80;
  game.rgvc[8] = 0x81;
  CchGetString(idsTutorialGame,(char *)game.szName);
  puVar8 = (undefined2 *)&vrgplrDef;
  pPVar9 = (PLAYER *)rgplr;
  for (iVar7 = 0x60; iVar7 != 0; iVar7 = iVar7 + -1) {
    pPVar11 = pPVar9;
    pPVar9 = (PLAYER *)&pPVar9->cPlanet;
    puVar1 = puVar8;
    puVar8 = puVar8 + 1;
    uVar3 = *puVar1;
    pPVar11->iPlayer = (char)uVar3;
    pPVar11->cShDef = (char)((uint)uVar3 >> 8);
  }
  CchGetString(idsHumanoid,(char *)rgplr[0].szName);
  _wsprintf(rgplr[0].szNames,(char *)0x11200a34,0x5a22,0x1120,uVar13);
  pPVar11 = LpplrComp(1,0);
  pPVar9 = (PLAYER *)pPVar11;
  pPVar10 = (PLAYER *)(rgplr + 1);
  for (iVar7 = 0x60; iVar7 != 0; iVar7 = iVar7 + -1) {
    pPVar4 = pPVar10;
    pPVar10 = (PLAYER *)&pPVar10->cPlanet;
    pPVar2 = pPVar9;
    pPVar9 = (PLAYER *)&pPVar9->cPlanet;
    cVar5 = pPVar2->cShDef;
    pPVar4->iPlayer = pPVar2->iPlayer;
    pPVar4->cShDef = cVar5;
  }
  rgplr[1].wMdPlr = rgplr[1].wMdPlr & 0x1ff | 0x2200;
  CchGetString(idsBerserker,(char *)rgplr[1].szName);
  Randomize(0x499602d2);
  for (i = 1; i < 3; i = i + 1) {
    uVar13 = CONCAT22(i,0x1120);
    pcVar12 = (char *)szBase;
    pcVar6 = PszGetCompressedString(idsSHD);
    _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar6),pcVar12,uVar13);
    _remove((char *)szWork);
    uVar13 = CONCAT22(i,0x1120);
    pcVar12 = (char *)szBase;
    pcVar6 = PszGetCompressedString(idsSXD);
    _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar6),pcVar12,uVar13);
    _remove((char *)szWork);
  }
  GenerateWorld(0);
  return;
}



// ======================================================================
// Function: NewGameWizard
// Address: 1078:6022
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Restarted to delay deadcode elimination for space: ram */

void NewGameWizard(HWND hwnd,short fReadOnly)

{
  GAME *pGVar1;
  undefined2 uVar2;
  undefined2 *puVar3;
  PLAYER *pPVar4;
  PLAYER *pPVar5;
  char cVar6;
  byte bVar7;
  short sVar8;
  ushort uVar9;
  PLAYER *pPVar10;
  char *pcVar11;
  short sVar12;
  uint uVar13;
  int iVar14;
  GAME *pGVar15;
  undefined2 *puVar16;
  PLAYER *pPVar17;
  undefined2 unaff_SS;
  FARPROC pvVar18;
  PLAYER *pPVar19;
  undefined2 gameT [4];
  short local_ee2;
  short local_ee0;
  undefined2 local_ed8;
  short lvlAi;
  PLAYER rgplrLocal [16];
  RECT rgrcStack [20];
  short j;
  char szFileLocal [208];
  short fEasy;
  short idAi;
  char szFile [256];
  short c;
  short i;
  uint rgplrbmp [16];
  short fIdleSav;
  undefined4 lpProc;
  short mdRet;
  short iStepMaxSoFar;
  
  iStepMaxSoFar = 0;
  fEasy = 0;
  vrgrcRCW = rgrcStack;
  iPanelActive = -1;
  fRCWReadOnly = fReadOnly;
  fIdleSav = (uint)gd.grBits >> 7 & 1;
  gd.grBits._0_2_ = (uint)gd.grBits & 0xff7f | 0x80;
  vrgplrNew = rgplrLocal;
  vrgszFileNew = szFileLocal;
  vcplrNew = 0;
  _memset((byte *)vrgplrTypeNew,0,0x10);
  if (fReadOnly != 0) {
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) {
        ((byte *)vrgplrTypeNew)[i] = 0x19;
      }
      else {
        ((byte *)vrgplrTypeNew)[i] = (byte)(i << 2) | 2;
        pPVar10 = (PLAYER *)rgplr + i;
        pPVar17 = vrgplrNew + i;
        for (iVar14 = 0x60; iVar14 != 0; iVar14 = iVar14 + -1) {
          pPVar4 = pPVar17;
          pPVar17 = (PLAYER *)&pPVar17->cPlanet;
          pPVar19 = pPVar10;
          pPVar10 = (PLAYER *)&pPVar10->cPlanet;
          cVar6 = pPVar19->cShDef;
          pPVar4->iPlayer = pPVar19->iPlayer;
          pPVar4->cShDef = cVar6;
        }
        vrgszFileNew[i * 0xd] = '\0';
      }
    }
CREATE_Step1_2:
    do {
      pvVar18 = MakeProcInstance(NewGameDlg,hInst);
      lpProc = pvVar18;
      mdRet = DialogBox(0,(LPCSTR)CONCAT22(0x186,hwnd),(HWND)((ulong)pvVar18 >> 0x10),(char)pvVar18)
      ;
      FreeProcInstance(lpProc);
      if (mdRet == 0) goto CREATE_Cancel;
      InitNewGamePlr(iStepMaxSoFar,lvlAi);
      if (mdRet != 3) {
        do {
          pvVar18 = MakeProcInstance(NewGameDlg2,hInst);
          lpProc = pvVar18;
          mdRet = DialogBox(0,(LPCSTR)CONCAT22(0x187,hwnd),(HWND)((ulong)pvVar18 >> 0x10),
                            (char)pvVar18);
          FreeProcInstance(lpProc);
          if (mdRet == 0) goto CREATE_Cancel;
          if (iStepMaxSoFar < 1) {
            iStepMaxSoFar = 1;
          }
          InitNewGamePlr(iStepMaxSoFar,lvlAi);
          if (mdRet == 1) goto CREATE_Step1_2;
          if (mdRet == 3) break;
          pvVar18 = MakeProcInstance(NewGameDlg3,hInst);
          lpProc = pvVar18;
          mdRet = DialogBox(0,(LPCSTR)CONCAT22(0x188,hwnd),(HWND)((ulong)pvVar18 >> 0x10),
                            (char)pvVar18);
          FreeProcInstance(lpProc);
          if (mdRet == 0) goto CREATE_Cancel;
          if (iStepMaxSoFar < 2) {
            iStepMaxSoFar = 2;
          }
        } while (mdRet == 1);
      }
CREATE_Finish_2:
      if (fRCWReadOnly != 0) goto CREATE_Cancel;
      CchGetString(idsGameXy,szFile);
      sVar8 = FGetNewGameName(szFile);
      if (sVar8 != 0) {
        pGVar15 = (GAME *)&game;
        puVar16 = gameT;
        for (iVar14 = 0x20; iVar14 != 0; iVar14 = iVar14 + -1) {
          puVar3 = puVar16;
          puVar16 = puVar16 + 1;
          pGVar1 = pGVar15;
          pGVar15 = (GAME *)((int)&pGVar15->lid + 2);
          *puVar3 = (int)pGVar1->lid;
        }
        local_ed8 = 0;
        DestroyCurGame();
        puVar16 = gameT;
        pGVar15 = (GAME *)&game;
        for (iVar14 = 0x20; iVar14 != 0; iVar14 = iVar14 + -1) {
          pGVar1 = pGVar15;
          pGVar15 = (GAME *)((int)&pGVar15->lid + 2);
          puVar3 = puVar16;
          puVar16 = puVar16 + 1;
          *(undefined2 *)&pGVar1->lid = *puVar3;
        }
        _strcpy((char *)szBase,szFile);
        uVar9 = _strlen((char *)szBase);
        *(undefined1 *)((int)rghbrMinSum[3] + 1 + uVar9) = 0;
        for (i = 0; (i < 0x10 && (((byte *)vrgplrTypeNew)[i] != 0)); i = i + 1) {
          bVar7 = ((byte *)vrgplrTypeNew)[i] & 3;
          if (bVar7 == 1) {
            if ((uint)((int)(uint)((byte *)vrgplrTypeNew)[i] >> 2) < 7) {
              c = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 2;
              puVar16 = (undefined2 *)(c * 0xc0 + 0xda2);
              pPVar10 = (PLAYER *)rgplr + i;
              for (iVar14 = 0x60; iVar14 != 0; iVar14 = iVar14 + -1) {
                pPVar19 = pPVar10;
                pPVar10 = (PLAYER *)&pPVar10->cPlanet;
                puVar3 = puVar16;
                puVar16 = puVar16 + 1;
                uVar2 = *puVar3;
                pPVar19->iPlayer = (char)uVar2;
                pPVar19->cShDef = (char)((uint)uVar2 >> 8);
              }
            }
            else {
              c = Random(7);
              puVar16 = (undefined2 *)(c * 0xc0 + 0xda2);
              pPVar10 = (PLAYER *)rgplr + i;
              for (iVar14 = 0x60; iVar14 != 0; iVar14 = iVar14 + -1) {
                pPVar19 = pPVar10;
                pPVar10 = (PLAYER *)&pPVar10->cPlanet;
                puVar3 = puVar16;
                puVar16 = puVar16 + 1;
                uVar2 = *puVar3;
                pPVar19->iPlayer = (char)uVar2;
                pPVar19->cShDef = (char)((uint)uVar2 >> 8);
              }
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xfdff | 0x200;
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xe3ff;
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0x1fff | 0xe000;
              *(undefined2 *)((int)&rgplr[0].lSalt + i * 0xc0) = 0xffff;
              *(undefined2 *)((int)&rgplr[0].lSalt + 2 + i * 0xc0) = 0xffff;
            }
            CchGetString
                      (c + idsHumanoid,(char *)((int)rgplr[0].szName + i * 0xc0));
            _wsprintf((char *)CONCAT22(0x1120,(char *)((int)rgplr[0].szNames + i * 0xc0)),
                      (char *)0x11200ab8,i * 0xc0 + 0x5a22);
          }
          else if (bVar7 == 2) {
            pPVar10 = rgplrLocal + ((int)(uint)((byte *)vrgplrTypeNew)[i] >> 2);
            pPVar17 = (PLAYER *)rgplr + i;
            for (iVar14 = 0x60; iVar14 != 0; iVar14 = iVar14 + -1) {
              pPVar4 = pPVar17;
              pPVar17 = (PLAYER *)&pPVar17->cPlanet;
              pPVar19 = pPVar10;
              pPVar10 = (PLAYER *)&pPVar10->cPlanet;
              cVar6 = pPVar19->cShDef;
              pPVar4->iPlayer = pPVar19->iPlayer;
              pPVar4->cShDef = cVar6;
            }
          }
          else if (bVar7 == 3) {
            idAi = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 2 & 7;
            lvlAi = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 5;
            if (3 < (uint)lvlAi) {
              lvlAi = Random(4);
            }
            if (5 < idAi) {
              idAi = Random(6);
            }
            pPVar19 = LpplrComp(idAi,lvlAi);
            pPVar10 = (PLAYER *)pPVar19;
            pPVar17 = (PLAYER *)rgplr + i;
            for (iVar14 = 0x60; iVar14 != 0; iVar14 = iVar14 + -1) {
              pPVar5 = pPVar17;
              pPVar17 = (PLAYER *)&pPVar17->cPlanet;
              pPVar4 = pPVar10;
              pPVar10 = (PLAYER *)&pPVar10->cPlanet;
              cVar6 = pPVar4->cShDef;
              pPVar5->iPlayer = pPVar4->iPlayer;
              pPVar5->cShDef = cVar6;
            }
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xfdff | 0x200;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xe3ff | (lvlAi & 7U) << 10
            ;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0x1fff | idAi << 0xd;
          }
        }
        game.cPlayer = i;
        for (i = 0; i < game.cPlayer; i = i + 1) {
          if ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0) {
            sVar8 = CAdvantagePoints((PLAYER *)rgplr + i);
            if (sVar8 < 0) {
              pPVar10 = (PLAYER *)rgplr + i;
              puVar16 = (undefined2 *)&vrgplrDef;
              for (iVar14 = 0x60; iVar14 != 0; iVar14 = iVar14 + -1) {
                pPVar19 = pPVar10;
                pPVar10 = (PLAYER *)&pPVar10->cPlanet;
                puVar3 = puVar16;
                puVar16 = puVar16 + 1;
                uVar2 = *puVar3;
                pPVar19->iPlayer = (char)uVar2;
                pPVar19->cShDef = (char)((uint)uVar2 >> 8);
              }
              *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xffef | 0x10;
            }
          }
          if (*(char *)((int)rgplr[0].szName + i * 0xc0) == '\0') {
            pcVar11 = (char *)((int)rgplr[0].szName + i * 0xc0);
            sVar8 = Random(0x18);
            CchGetString(sVar8 + idsBerserker,pcVar11);
          }
          if (*(char *)((int)rgplr[0].szNames + i * 0xc0) == '\0') {
            _wsprintf((char *)CONCAT22(0x1120,(char *)((int)rgplr[0].szNames + i * 0xc0)),
                      (char *)0x11200abc,i * 0xc0 + 0x5a22);
          }
        }
        i = 1;
        do {
          if (game.cPlayer <= i) {
            for (i = 0; i < game.cPlayer; i = i + 1) {
              rgplrbmp[i] = *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 3 & 0x1f;
              if ((((int)rgplrbmp[i] < 0) || (0x1f < (int)rgplrbmp[i])) ||
                 ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) != 0)) {
                rgplrbmp[i] = 0xffff;
              }
            }
            for (i = 1; i < game.cPlayer; i = i + 1) {
              if (rgplrbmp[i] != 0xffff) {
                for (j = 0; (j < i && (rgplrbmp[j] != rgplrbmp[i])); j = j + 1) {
                }
                if (j < i) {
                  sVar12 = Random(2);
                  sVar8 = i;
                  if (sVar12 == 0) {
                    sVar8 = j;
                  }
                  rgplrbmp[sVar8] = 0xffff;
                }
              }
            }
            for (i = 0; i < game.cPlayer; i = i + 1) {
              if (rgplrbmp[i] == 0xffff) {
                uVar13 = Random(0x20);
                rgplrbmp[i] = uVar13;
                while( true ) {
                  for (j = 0; (j < game.cPlayer && ((j == i || (rgplrbmp[i] != rgplrbmp[j])))
                              ); j = j + 1) {
                  }
                  if (j == game.cPlayer) break;
                  rgplrbmp[i] = rgplrbmp[i] + 1;
                  if (0x1f < (int)rgplrbmp[i]) {
                    rgplrbmp[i] = 0;
                  }
                }
              }
            }
            for (i = 0; i < game.cPlayer; i = i + 1) {
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xff07 |
                   (rgplrbmp[i] & 0x1f) << 3;
            }
            if (fFreeingTitle == 0) {
              fFreeingTitle = 1;
              DestroyWindow(hwndTitle);
              hwndTitle = 0;
              ShowWindow(hwndFrame,5);
            }
            GenerateWorld(0);
            if (idPlayer == -1) {
              BringUpHostDlg();
            }
            gd.grBits._0_2_ = (uint)gd.grBits & 0xff7f | (fIdleSav & 1U) << 7;
            return;
          }
          for (j = 0; j < i; j = j + 1) {
            sVar8 = _strcmp((char *)((int)rgplr[0].szName + i * 0xc0),
                                    (char *)((int)rgplr[0].szName + j * 0xc0));
            if (sVar8 == 0) break;
          }
          if (j < i) {
            c = Random(0x18);
LAB_1078_6a97:
            for (j = 0; j < game.cPlayer; j = j + 1) {
              pcVar11 = PszGetCompressedString(c + idsBerserker);
              sVar8 = _strcmp((char *)((int)rgplr[0].szName + j * 0xc0),pcVar11);
              if (sVar8 == 0) break;
            }
            if (j != game.cPlayer) {
              c = c + 1;
              if (0x17 < c) {
                c = 0;
              }
              goto LAB_1078_6a97;
            }
            CchGetString
                      (c + idsBerserker,(char *)((int)rgplr[0].szName + i * 0xc0));
            _strcpy((char *)((int)rgplr[0].szNames + i * 0xc0),
                            (char *)((int)rgplr[0].szName + i * 0xc0));
            _strcat((char *)((int)rgplr[0].szNames + i * 0xc0),(char *)0xac0);
          }
          i = i + 1;
        } while( true );
      }
      if (fEasy != 0) goto CREATE_Cancel;
    } while( true );
  }
  pGVar15 = (GAME *)&game;
  puVar16 = gameT;
  for (iVar14 = 0x20; iVar14 != 0; iVar14 = iVar14 + -1) {
    puVar3 = puVar16;
    puVar16 = puVar16 + 1;
    pGVar1 = pGVar15;
    pGVar15 = (GAME *)((int)&pGVar15->lid + 2);
    *puVar3 = (int)pGVar1->lid;
  }
  _memset((GAME *)&game,0,0x40);
  game.cPlanMax = local_ee0;
  game.cPlayer = local_ee2;
  vrgplrTypeNew[0] = 1;
  vrgplrTypeNew[1] = 0x23;
  vrgplrTypeNew[2] = 0x27;
  vrgplrTypeNew[3] = 0x8b;
  lpProc = MakeProcInstance(SimpleNewGameDlg,hInst);
  mdRet = DialogBox(0,(LPCSTR)CONCAT22(0xd1,hwnd),(HWND)((ulong)lpProc >> 0x10),(char)lpProc);
  FreeProcInstance(lpProc);
  game.rgvc[0] = 0x88;
  game.rgvc[1] = 0x8e;
  game.rgvc[2] = 0x82;
  game.rgvc[3] = 10;
  game.rgvc[4] = 0x88;
  game.rgvc[5] = 9;
  game.rgvc[6] = 9;
  game.rgvc[7] = 7;
  game.rgvc[8] = 1;
  if (mdRet == 2) {
CREATE_Cancel:
    if (fRCWReadOnly == 0) {
      puVar16 = gameT;
      pGVar15 = (GAME *)&game;
      for (iVar14 = 0x20; iVar14 != 0; iVar14 = iVar14 + -1) {
        pGVar1 = pGVar15;
        pGVar15 = (GAME *)((int)&pGVar15->lid + 2);
        puVar3 = puVar16;
        puVar16 = puVar16 + 1;
        *(undefined2 *)&pGVar1->lid = *puVar3;
      }
    }
    gd.grBits._0_2_ = (uint)gd.grBits & 0xff7f | (fIdleSav & 1U) << 7;
  }
  else {
    if (mdRet != 0xd4) {
      if ((mdRet == 0x430) || (mdRet == 0xd3)) {
        _memset((byte *)vrgplrTypeNew,0,0x10);
        if (game.turn < 7) {
          vrgplrTypeNew[0] = (byte)((game.turn & 0xff) << 2) | 1;
        }
        else {
          vrgplrTypeNew[0] = 2;
          *vrgszFileNew = '\0';
          vcplrNew = 1;
        }
        lvlAi = game.mdDensity;
        InitNewGamePlr(iStepMaxSoFar,game.mdDensity);
        game.mdDensity = 1;
        if (lvlAi < 2) {
          game.mdStartDist = 1;
        }
        else {
          game.mdStartDist = 2;
        }
        game.wCrap = game.wCrap & 0xff0c | (uint)(lvlAi == 3) << 4;
        CchGetString(lvlAi * 5 + 0x1cb + game.mdSize,(char *)game.szName);
        if (mdRet == 0x430) {
          fEasy = 1;
          goto CREATE_Finish_2;
        }
      }
      goto CREATE_Step1_2;
    }
    puVar16 = gameT;
    pGVar15 = (GAME *)&game;
    for (iVar14 = 0x20; iVar14 != 0; iVar14 = iVar14 + -1) {
      pGVar1 = pGVar15;
      pGVar15 = (GAME *)((int)&pGVar15->lid + 2);
      puVar3 = puVar16;
      puVar16 = puVar16 + 1;
      *(undefined2 *)&pGVar1->lid = *puVar3;
    }
    StartTutor(0);
    gd.grBits._0_2_ = (uint)gd.grBits & 0xff7f | (fIdleSav & 1U) << 7;
  }
  return;
}



// ======================================================================
// Function: InitNewGamePlr
// Address: 1078:6e44
// Segment: MEMORY_CREATE
// ======================================================================


void InitNewGamePlr(short iStepMaxSoFar,short lvlAi)

{
  byte bVar1;
  short sVar2;
  byte ch;
  short c;
  short i;
  
  if (((iStepMaxSoFar < 2) && (fRCWReadOnly == 0)) &&
     (SetVCVal((GAME *)&game,9,game.mdSize << 1), iStepMaxSoFar < 1)) {
    if (game.mdSize == 0) {
      if ((lvlAi == 3) && (sVar2 = Random(3), sVar2 == 0)) {
        game.cPlayer = 3;
      }
      else {
        game.cPlayer = 2;
      }
    }
    else if (game.mdSize == 1) {
      if ((lvlAi == 3) && (sVar2 = Random(4), sVar2 == 0)) {
        game.cPlayer = 5;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(6 - lvlAi), sVar2 != 0)) {
        game.cPlayer = 3;
      }
      else {
        game.cPlayer = 4;
      }
    }
    else if (game.mdSize == 2) {
      if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        game.cPlayer = 9;
      }
      else if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        game.cPlayer = 5;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
        if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
          game.cPlayer = 7;
        }
        else {
          game.cPlayer = 6;
        }
      }
      else {
        game.cPlayer = 8;
      }
    }
    else if (game.mdSize == 3) {
      if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        sVar2 = Random(2);
        game.cPlayer = sVar2 + 0xe;
      }
      else if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        sVar2 = Random(2);
        game.cPlayer = 10 - sVar2;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
        if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
          game.cPlayer = 0xc;
        }
        else {
          game.cPlayer = 0xb;
        }
      }
      else {
        game.cPlayer = 0xd;
      }
    }
    else if (game.mdSize == 4) {
      if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        sVar2 = Random(3);
        game.cPlayer = 0xd - sVar2;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(9 - lvlAi), sVar2 != 0)) {
        if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
          game.cPlayer = 0x10;
        }
        else {
          game.cPlayer = 0xf;
        }
      }
      else {
        game.cPlayer = 0xe;
      }
    }
    i = 1;
    if (lvlAi == 0) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < (game.cPlayer + 1) / 3 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0xb;
        }
        else if (i < ((game.cPlayer + 1) * 2) / 3 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0xf;
        }
        else if (i < ((game.cPlayer + 1) * 5) / 6 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 7;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x1b;
        }
      }
    }
    else if (lvlAi == 1) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < ((game.cPlayer + 5) * 2) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x27;
        }
        else if (i < ((game.cPlayer + -1) * 3 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x23;
        }
        else if (i < ((game.cPlayer + -1) * 4 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x2b;
        }
        else if (i < ((game.cPlayer + -1) * 5 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x2f;
        }
        else if (i < ((game.cPlayer + -1) * 6 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x33;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x9b;
        }
      }
    }
    else if (lvlAi == 2) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < ((game.cPlayer + 5) * 2) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x53;
        }
        else if (i < ((game.cPlayer + -1) * 3 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x47;
        }
        else if (i < ((game.cPlayer + -1) * 4 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x43;
        }
        else if (i < ((game.cPlayer + -1) * 5 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x57;
        }
        else if (i < ((game.cPlayer + -1) * 6 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x5b;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x9b;
        }
      }
    }
    else if (lvlAi == 3) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < (game.cPlayer + 1) / 3 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 99;
        }
        else if (i < ((game.cPlayer + -1) * 6 + 0xb) / 0xc + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x77;
        }
        else if (i < ((game.cPlayer + -1) * 5 + 5) / 6 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x73;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x7b;
        }
      }
    }
    for (i = 1; i < game.cPlayer + -1; i = i + 1) {
      sVar2 = Random((game.cPlayer - i) + -1);
      bVar1 = ((byte *)vrgplrTypeNew)[i];
      ((byte *)vrgplrTypeNew)[i] = ((byte *)vrgplrTypeNew + 1)[sVar2 + i];
      ((byte *)vrgplrTypeNew + 1)[sVar2 + i] = bVar1;
    }
  }
  return;
}



// ======================================================================
// Function: InitNewGame3
// Address: 1078:74f8
// Segment: MEMORY_CREATE
// ======================================================================


void InitNewGame3(void)

{
  return;
}



// ======================================================================
// Function: FGetNewGameName
// Address: 1078:7508
// Segment: MEMORY_CREATE
// ======================================================================


short FGetNewGameName(char *szFileSuggest)

{
  int iVar1;
  short sVar2;
  undefined2 ofn;
  undefined2 local_350;
  HWND local_34e;
  char *local_34a;
  int local_31c;
  char szFilter [256];
  char szFile [512];
  ushort i;
  char szXY [6];
  
  if (szFileSuggest == (char *)0x0) {
    szFile[0] = '\0';
  }
  else {
    _strcpy(szFile,szFileSuggest);
  }
  CchGetString(idsStarsGameFilesXy,szFilter);
  for (i = 0; szFilter[i] != '\0'; i = i + 1) {
    if (szFilter[i] == '|') {
      szFilter[i] = '\0';
    }
  }
  _memset(&ofn,0,0x48);
  szXY[0] = 'x';
  szXY[1] = 0x79;
  szXY[2] = 0;
  ofn = 0x48;
  local_350 = 0;
  local_34e = hwndFrame;
  local_34a = szFilter;
  iVar1 = GetSaveFileName(0x1118,&ofn);
  if (iVar1 == 0) {
    sVar2 = 0;
  }
  else {
    if (local_31c == 0) {
      _strcat(szFile,szXY);
    }
    else {
      _strcpy(szFile + local_31c,szXY);
    }
    _strcpy(szFileSuggest,szFile);
    sVar2 = 1;
  }
  return sVar2;
}



// ======================================================================
// Function: SimpleNewGameDlg
// Address: 1078:76aa
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10787db7) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short SimpleNewGameDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  undefined2 uVar3;
  PLAYER *pPVar4;
  char cVar5;
  char *pcVar6;
  HWND HVar7;
  short sVar8;
  int iVar9;
  undefined2 unaff_SI;
  undefined2 *puVar10;
  PLAYER *pPVar11;
  undefined2 unaff_DI;
  PLAYER *pPVar12;
  undefined2 unaff_SS;
  ulong uVar13;
  LRESULT LVar14;
  WPARAM WVar15;
  UINT UVar16;
  ushort in_stack_0000ffc4;
  short c;
  short dy;
  int rcGBox;
  RECT *local_16;
  short local_14;
  RECT *prcSav;
  HWND hwndDD;
  undefined8 rc;
  short i;
  
  uVar13 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hwndDD = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)&stack0xffc4));
    HVar7 = GetDlgItem(hwnd,200);
    GetWindowRect(HVar7,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffe8));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffe8));
    HVar7 = GetDlgItem(hwnd,0xcb);
    GetWindowRect(HVar7,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)((int)&rc + 4)));
    local_14 = rc._4_2_;
    prcSav = rc._6_2_;
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hwndDD,rghfontArial8[1]);
    SetBkColor(hwndDD,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar8 = CchGetString(idsDifficultyLevel,(char *)szWork);
    TextOut(hwndDD,rcGBox + 8,(int)local_16 - (dyArial8 >> 1),szWork,sVar8);
    HVar7 = GetDlgItem(hwnd,1000);
    GetWindowRect(HVar7,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffe8));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffe8));
    HVar7 = GetDlgItem(hwnd,0x3ec);
    GetWindowRect(HVar7,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)((int)&rc + 4)));
    local_14 = rc._4_2_;
    prcSav = rc._6_2_;
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hwndDD,rghfontArial8[1]);
    sVar8 = CchGetString(idsUniverseSize,(char *)szWork);
    TextOut(hwndDD,rcGBox + 8,(int)local_16 - (dyArial8 >> 1),szWork,sVar8);
    local_16 = prcSav + 1;
    HVar7 = GetDlgItem(hwnd,0x81a);
    GetWindowRect(HVar7,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffe8));
    MapWindowPoints(0,hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffe8),2);
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    prcSav = (RECT *)(&prcSav->left + dyArial8);
    _Draw3dFrame();
    SelectObject(hwndDD,rghfontArial8[1]);
    sVar8 = CchGetString(idsPlayerRace,(char *)szWork);
    TextOut(hwndDD,rcGBox + 8,(int)local_16 - (dyArial8 >> 1),szWork,sVar8);
    local_16 = (RECT *)((int)&prcSav->left + dyArial8 * 3);
    prcSav = (RECT *)0x3e8;
    ExpandRc((RECT *)&stack0xffe8,-dyArial8,0);
    sVar8 = CchGetString
                      (idsButtonAllowsConfigureMultiPlayerGamesCustom,(char *)szWork);
    sVar8 = DRAWTEXT(hwndDD,szWork,sVar8,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffe8),
                     0x810);
    HVar7 = GetDlgItem(hwnd,0xd3);
    SetWindowPos(HVar7,0,rcGBox,(int)local_16 + sVar8 + dyArial8 / 2,0,0,5);
    prcSav = (RECT *)((int)local_16 + sVar8 + dyArial8 * 2);
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    sVar8 = CchGetString(idsAdvancedGame,(char *)szWork);
    TextOut(hwndDD,rcGBox + 8,(int)local_16 - (dyArial8 >> 1),szWork,sVar8);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)&stack0xffc4));
    sVar8 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    FillRect(wParam,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc),hbrButtonFace);
    sVar8 = 1;
  }
  else {
    if (message == WM_CTLCOLOR) {
      for (i = 200; i < 0xcc; i = i + 1) {
        hwndDD = (HWND)lParam;
        HVar7 = GetDlgItem(hwnd,i);
        if (hwndDD == HVar7) {
          i = -1;
          break;
        }
      }
      if (i != -1) {
        for (i = 1000; i < 0x3ed; i = i + 1) {
          hwndDD = (HWND)lParam;
          HVar7 = GetDlgItem(hwnd,i);
          if (hwndDD == HVar7) {
            i = -1;
            break;
          }
        }
      }
      if ((i == -1) || (uVar13 = __aFulshr(uVar13,in_stack_0000ffc4), (int)uVar13 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        CheckRadioButton(hwnd,200,0xcb,0xc9);
        CheckRadioButton(hwnd,1000,0x3ec,0x3e9);
        hwndDD = GetDlgItem(hwnd,0x81a);
        SendMessage(hwndDD,0x40b,0,0);
        for (i = 0; i < 7; i = i + 1) {
          UVar16 = 0x403;
          WVar15 = 0;
          HVar7 = hwndDD;
          pcVar6 = PszGetCompressedString(i + idsHumanoid);
          SendMessage(HVar7,UVar16,WVar15,(LPARAM)CONCAT22(0x1120,pcVar6));
        }
        SendMessage(hwndDD,0x40e,0,0);
        StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
        return 1;
      }
      if (message == WM_COMMAND) {
        if (((wParam == 0x430) || (wParam == 2)) || (wParam == 0xd3)) {
          i = 200;
          while ((i < 0xcc && (UVar16 = IsDlgButtonChecked(hwnd,i), UVar16 == 0))) {
            i = i + 1;
          }
          game.mdDensity = i + -200;
          i = 1000;
          while ((i < 0x3ed && (UVar16 = IsDlgButtonChecked(hwnd,i), UVar16 == 0))) {
            i = i + 1;
          }
          game.mdSize = i + -1000;
          HVar7 = GetDlgItem(hwnd,0x81a);
          LVar14 = SendMessage(HVar7,0x407,0,0);
          game.turn = (ushort)LVar14;
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,wParam);
          return 1;
        }
        if (wParam == 0xd4) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,0xd4);
          return 1;
        }
        if (wParam == 0xd2) {
          hwndDD = GetDlgItem(hwnd,0x81a);
          LVar14 = SendMessage(hwndDD,0x407,0,0);
          game.turn = (ushort)LVar14;
          if (game.turn < 7) {
            puVar10 = (undefined2 *)(game.turn * 0xc0 + 0xda2);
            pPVar11 = (PLAYER *)&vplr;
            for (iVar9 = 0x60; iVar9 != 0; iVar9 = iVar9 + -1) {
              pPVar2 = pPVar11;
              pPVar11 = (PLAYER *)&pPVar11->cPlanet;
              puVar1 = puVar10;
              puVar10 = puVar10 + 1;
              uVar3 = *puVar1;
              pPVar2->iPlayer = (char)uVar3;
              pPVar2->cShDef = (char)((uint)uVar3 >> 8);
            }
            CchGetString(game.turn + idsHumanoid,(char *)vplr.szName);
            _wsprintf(vplr.szNames,(char *)0x11200adc,0x501a,0x1120);
          }
          else {
            pPVar12 = (PLAYER *)&vplr;
            pPVar11 = vrgplrNew;
            for (iVar9 = 0x60; iVar9 != 0; iVar9 = iVar9 + -1) {
              pPVar4 = pPVar12;
              pPVar12 = (PLAYER *)&pPVar12->cPlanet;
              pPVar2 = pPVar11;
              pPVar11 = (PLAYER *)&pPVar11->cPlanet;
              cVar5 = pPVar2->cShDef;
              pPVar4->iPlayer = pPVar2->iPlayer;
              pPVar4->cShDef = cVar5;
            }
          }
          prcSav = vrgrcRCW;
          sVar8 = RaceCreationWizard(hwnd,0,1);
          if (sVar8 != 0) {
            LVar14 = SendMessage(hwndDD,0x406,0,0);
            if (7 < LVar14) {
              SendMessage(hwndDD,0x404,7,0);
            }
            SendMessage(hwndDD,0x403,0,0x1120501a);
            SendMessage(hwndDD,0x40e,7,0);
            pPVar11 = (PLAYER *)&vplr;
            pPVar12 = vrgplrNew;
            for (iVar9 = 0x60; iVar9 != 0; iVar9 = iVar9 + -1) {
              pPVar4 = pPVar12;
              pPVar12 = (PLAYER *)&pPVar12->cPlanet;
              pPVar2 = pPVar11;
              pPVar11 = (PLAYER *)&pPVar11->cPlanet;
              cVar5 = pPVar2->cShDef;
              pPVar4->iPlayer = pPVar2->iPlayer;
              pPVar4->cShDef = cVar5;
            }
          }
          vrgrcRCW = prcSav;
          SetFocus(hwnd);
        }
        else if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)CONCAT22(0x1120,_szHelpFile),1,0x3ea);
          return 1;
        }
      }
    }
    sVar8 = 0;
  }
  return sVar8;
}



// ======================================================================
// Function: NewGameDlg
// Address: 1078:7e92
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short NewGameDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  HWND HVar1;
  short sVar2;
  UINT UVar3;
  HBRUSH HVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar5;
  ushort in_stack_0000ffc6;
  short c;
  RECT rcGBox;
  HDC hdc;
  undefined8 rc;
  short i;
  
  uVar5 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hdc = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)&stack0xffc6));
    HVar1 = GetDlgItem(hwnd,1000);
    GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,&rcGBox));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,&rcGBox));
    HVar1 = GetDlgItem(hwnd,0x3ec);
    GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)((int)&rc + 4)));
    rcGBox.right = rc._4_2_;
    rcGBox.bottom = rc._6_2_;
    ExpandRc(&rcGBox,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hdc,rghfontArial8[1]);
    SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar2 = CchGetString(idsUniverseSize,(char *)szWork);
    TextOut(hdc,rcGBox.left + 8,rcGBox.top - (dyArial8 >> 1),szWork,sVar2);
    HVar1 = GetDlgItem(hwnd,0x3ed);
    GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,&rcGBox));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,&rcGBox));
    HVar1 = GetDlgItem(hwnd,0x3f0);
    GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)((int)&rc + 4)));
    rcGBox.right = rc._4_2_;
    rcGBox.bottom = rc._6_2_;
    ExpandRc(&rcGBox,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hdc,rghfontArial8[1]);
    SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar2 = CchGetString(idsDensity,(char *)szWork);
    TextOut(hdc,rcGBox.left + 8,rcGBox.top - (dyArial8 >> 1),szWork,sVar2);
    HVar1 = GetDlgItem(hwnd,0x3f1);
    GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,&rcGBox));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,&rcGBox));
    HVar1 = GetDlgItem(hwnd,0x3f4);
    GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)((int)&rc + 4)));
    rcGBox.right = rc._4_2_;
    rcGBox.bottom = rc._6_2_;
    ExpandRc(&rcGBox,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hdc,rghfontArial8[1]);
    SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar2 = CchGetString(idsPlayerPositions,(char *)szWork);
    TextOut(hdc,rcGBox.left + 8,rcGBox.top - (dyArial8 >> 1),szWork,sVar2);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)&stack0xffc6));
    return 1;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc));
    FillRect(wParam,(RECT *)CONCAT22(unaff_SS,(RECT *)&rc),hbrButtonFace);
    return 1;
  }
  if (message == WM_CTLCOLOR) {
    for (i = 1000; i < 0x3fe; i = i + 1) {
      hdc = (HDC)lParam;
      HVar1 = GetDlgItem(hwnd,i);
      if (hdc == HVar1) break;
    }
    if ((0x3fd < i) && (uVar5 = __aFulshr(uVar5,in_stack_0000ffc6), (int)uVar5 != 6)) {
      hdc = (HDC)lParam;
      HVar1 = GetDlgItem(hwnd,0x41a);
      if (hdc != HVar1) goto LAB_1078_87c3;
    }
    SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    HVar4 = hbrButtonFace;
  }
  else {
    if (message == WM_INITDIALOG) {
      SetNGWTitle(hwnd,1);
      CheckRadioButton(hwnd,1000,0x3ec,game.mdSize + 1000);
      CheckRadioButton(hwnd,0x3ed,0x3f0,game.mdDensity + 0x3ed);
      CheckRadioButton(hwnd,0x3f1,0x3f4,game.mdStartDist + 0x3f1);
      HVar1 = GetDlgItem(hwnd,0x406);
      SetWindowText(HVar1,game.szName);
      SendDlgItemMessage(hwnd,0x406,0x415,0x1f,0);
      HVar1 = GetDlgItem(hwnd,0x3f8);
      uVar5 = CONCAT22(0x401,game.wCrap) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      HVar1 = GetDlgItem(hwnd,0x3f9);
      uVar5 = CONCAT22(0x401,game.wCrap >> 1) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      HVar1 = GetDlgItem(hwnd,0x3fa);
      uVar5 = CONCAT22(0x401,game.wCrap >> 5) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      HVar1 = GetDlgItem(hwnd,0x3fb);
      uVar5 = CONCAT22(0x401,game.wCrap >> 7) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      HVar1 = GetDlgItem(hwnd,0x3fc);
      uVar5 = CONCAT22(0x401,game.wCrap >> 4) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      HVar1 = GetDlgItem(hwnd,0x3fd);
      uVar5 = CONCAT22(0x401,game.wCrap >> 6) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      HVar1 = GetDlgItem(hwnd,0x41a);
      uVar5 = CONCAT22(0x401,game.wCrap >> 8) & 0xffff0001;
      SendMessage(HVar1,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
      if (fRCWReadOnly != 0) {
        for (i = 1000; i < 0x3ed; i = i + 1) {
          HVar1 = GetDlgItem(hwnd,i);
          EnableWindow(HVar1,0);
        }
        for (i = 0x3ed; i < 0x3f1; i = i + 1) {
          HVar1 = GetDlgItem(hwnd,i);
          EnableWindow(HVar1,0);
        }
        for (i = 0x3f1; i < 0x3f5; i = i + 1) {
          HVar1 = GetDlgItem(hwnd,i);
          EnableWindow(HVar1,0);
        }
        HVar1 = GetDlgItem(hwnd,0x3f8);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x3f9);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x3fa);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x3fb);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x41a);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x3fc);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x406);
        EnableWindow(HVar1,0);
        HVar1 = GetDlgItem(hwnd,0x3fd);
        EnableWindow(HVar1,0);
      }
      StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
      return 1;
    }
    if (message == WM_COMMAND) {
      if (wParam == 0x76) {
        WinHelp(hwnd,(LPCSTR)CONCAT22(0x1120,_szHelpFile),1,0x3f4);
        return 1;
      }
      hdc = 0;
      while (((int)hdc < 4 && (wParam != *(ushort *)((ushort_0_ *)&rgidRaceBtn + hdc * 2))))
      {
        hdc = hdc + 1;
      }
      if ((int)hdc < 4) {
        if (hdc != 0) {
          i = 1000;
          while ((i < 0x3ed && (UVar3 = IsDlgButtonChecked(hwnd,i), UVar3 == 0))) {
            i = i + 1;
          }
          game.mdSize = i + -1000;
          i = 0x3ed;
          while ((i < 0x3f1 && (UVar3 = IsDlgButtonChecked(hwnd,i), UVar3 == 0))) {
            i = i + 1;
          }
          game.mdDensity = i + -0x3ed;
          i = 0x3f1;
          while ((i < 0x3f5 && (UVar3 = IsDlgButtonChecked(hwnd,i), UVar3 == 0))) {
            i = i + 1;
          }
          game.mdStartDist = i + -0x3f1;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3f8);
          game.wCrap = game.wCrap & 0xfffe | rcGBox.bottom & 1U;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3f9);
          game.wCrap = game.wCrap & 0xfffd | (rcGBox.bottom & 1U) << 1;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fa);
          game.wCrap = game.wCrap & 0xffdf | (rcGBox.bottom & 1U) << 5;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fb);
          game.wCrap = game.wCrap & 0xff7f | (rcGBox.bottom & 1U) << 7;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fc);
          game.wCrap = game.wCrap & 0xffef | (rcGBox.bottom & 1U) << 4;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fd);
          game.wCrap = game.wCrap & 0xffbf | (rcGBox.bottom & 1U) << 6;
          rcGBox.bottom = IsDlgButtonChecked(hwnd,0x41a);
          game.wCrap = game.wCrap & 0xfeff | (rcGBox.bottom & 1U) << 8;
          HVar1 = GetDlgItem(hwnd,0x406);
          i = GetWindowText(HVar1,game.szName,0x20);
          if (i == 0) {
            _strcpy((char *)game.szName,(char *)szBase);
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
        EndDialog(hwnd,hdc);
        return 1;
      }
    }
LAB_1078_87c3:
    HVar4 = 0;
  }
  return HVar4;
}



// ======================================================================
// Function: NewGameDlg2
// Address: 1078:87d2
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Variable defined which should be unmapped: prcSav */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short NewGameDlg2(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  undefined2 uVar3;
  PLAYER *pPVar4;
  byte bVar5;
  char cVar6;
  RECT *pRVar7;
  HWND HVar8;
  uint uVar9;
  UINT UVar10;
  HMENU HVar11;
  uint uVar12;
  BOOL BVar13;
  char *pcVar14;
  int iVar15;
  int iVar16;
  undefined2 unaff_SI;
  PLAYER *pPVar17;
  undefined2 *puVar18;
  undefined2 unaff_DI;
  PLAYER *pPVar19;
  undefined2 unaff_SS;
  ulong uVar20;
  HMENU HVar21;
  UINT UVar22;
  short sVar23;
  RECT *prcSav;
  short iCurVal;
  short iDiamond;
  MSG msg;
  HMENU hmenuPopup;
  HMENU rghmenuSubPopup [5];
  undefined1 ps [18];
  HWND hwndBtn;
  short dyCur;
  short dy;
  short dyBut;
  int rcT;
  int pt;
  int pt__18;
  short iNewVal;
  RECT rc;
  short i;
  
  uVar20 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    iNewVal = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)ps));
    DrawNewGame2(hwnd,iNewVal,-1);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)ps));
    return 1;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(RECT *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    return 1;
  }
  if (message == WM_CTLCOLOR) {
    for (i = 0x191; i < 0x1c1; i = i + 1) {
      iNewVal = (int)lParam;
      HVar8 = GetDlgItem(hwnd,i);
      if (iNewVal == HVar8) break;
    }
    if ((0x1c0 < i) && (uVar20 = __aFulshr(uVar20,(ushort)prcSav), (int)uVar20 != 6)) {
      return 0;
    }
    SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    return hbrButtonFace;
  }
  if (message == WM_SETCURSOR) {
    if (fRCWReadOnly != 0) {
      return 0;
    }
    GetCursorPos((POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffee));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffee));
    if (pt__18 < xNewGameDiamond) {
      return 0;
    }
    if (xNewGameDiamond + dyArial8 + 1 <= pt__18) {
      return 0;
    }
    if (iNewVal < 6) {
      return 0;
    }
    pt = (iNewVal + -6) / (dyArial8 + 4);
    if (0xf < pt) {
      return 0;
    }
    if (dyArial8 + 1 <= (iNewVal + -6) % (dyArial8 + 4)) {
      return 0;
    }
    setcursor(hcurHand);
    return 1;
  }
  if (message == WM_INITDIALOG) {
    SetNGWTitle(hwnd,2);
    dy = (dyArial8 + 4) * 0x10 + 8;
    HVar8 = GetDlgItem(hwnd,_rgidRaceBtn);
    GetWindowRect(HVar8,(RECT *)CONCAT22(unaff_SS,&rc));
    dyBut = rc.bottom - rc.top;
    GetWindowRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffea));
    dyCur = iNewVal - pt;
    if (dyCur < dy + dyBut + 6) {
      for (i = 0; i < 5; i = i + 1) {
        hwndBtn = GetDlgItem(hwnd,*(short *)((ushort_0_ *)&rgidRaceBtn + i * 2));
        GetWindowRect(hwndBtn,(RECT *)CONCAT22(unaff_SS,&rc));
        MapWindowPoints(0,hwnd,(POINT *)CONCAT22(unaff_SS,&rc),2);
        OffsetRect((RECT *)CONCAT22(unaff_SS,&rc),0,dy - rc.top);
        SetWindowPos(hwndBtn,0,rc.left,rc.top,0,0,5);
      }
      dy = rc.bottom + 6;
      GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
      if (dyCur < dy) {
        SetWindowPos(hwnd,0,0,0,pt__18 - rcT,((dy + iNewVal) - pt) - rc.bottom,6);
      }
    }
    StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
    return 1;
  }
  if (message == WM_COMMAND) {
    if (wParam == 0x76) {
      WinHelp(hwnd,(LPCSTR)CONCAT22(0x1120,_szHelpFile),1,0x3fc);
      return 1;
    }
    i = 0;
    while ((i < 4 && (wParam != *(ushort *)((ushort_0_ *)&rgidRaceBtn + i * 2)))) {
      i = i + 1;
    }
    if (3 < i) {
      return 0;
    }
    if (((i != 0) && (vrgplrTypeNew[0] == 0)) && (fRCWReadOnly == 0)) {
      sVar23 = 0x10;
      pcVar14 = PszFormatIds(idsMustHaveLeastOnePlayerGame,(short *)0x0);
      AlertSz(pcVar14,sVar23);
      return 0;
    }
    StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
    EndDialog(hwnd,i);
    return 1;
  }
  if ((message != WM_LBUTTONDOWN) && (message != WM_RBUTTONDOWN)) {
    return 0;
  }
  if (fRCWReadOnly != 0) {
    return 0;
  }
  pt = (int)lParam;
  uVar20 = __aFulshr(uVar20,(ushort)prcSav);
  pt__18 = (int)uVar20;
  if (pt < xNewGameDiamond) {
    return 0;
  }
  if (xNewGameDiamond + dyArial8 + 1 <= pt) {
    return 0;
  }
  if (pt__18 < 6) {
    return 0;
  }
  iDiamond = (pt__18 + -6) / (dyArial8 + 4);
  if (0xf < iDiamond) {
    return 0;
  }
  if (dyArial8 + 1 <= (pt__18 + -6) % (dyArial8 + 4)) {
    return 0;
  }
  bVar5 = ((byte *)vrgplrTypeNew)[iDiamond];
  uVar9 = (uint)bVar5;
  ClientToScreen(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffec));
  rghmenuSubPopup[0] = CreatePopupMenu();
  for (rcT = 0; rcT < 6; rcT = rcT + 1) {
    if (uVar9 == rcT * 4 + 1U) {
      hwndBtn = 8;
    }
    else {
      hwndBtn = 0;
    }
    dy = (short)PszGetCompressedString(rcT + idsHumanoid);
    AppendMenu(rghmenuSubPopup[0],hwndBtn,rcT + 0x3aa8,(LPCSTR)CONCAT22(0x1120,dy));
  }
  UVar10 = rcT + 0x3aa8;
  HVar8 = hwndBtn;
  HVar11 = rghmenuSubPopup[0];
  pcVar14 = PszGetCompressedString(idsRandom);
  AppendMenu(HVar11,HVar8,UVar10,(LPCSTR)CONCAT22(0x1120,pcVar14));
  UVar10 = rcT + 0x3aa9;
  HVar8 = hwndBtn;
  HVar11 = rghmenuSubPopup[0];
  pcVar14 = PszGetCompressedString(idsExpansionPlayer);
  AppendMenu(HVar11,HVar8,UVar10,(LPCSTR)CONCAT22(0x1120,pcVar14));
  HVar11 = CreatePopupMenu();
  UVar22 = 0;
  UVar10 = 15000;
  rghmenuSubPopup[1] = HVar11;
  pcVar14 = PszGetCompressedString(idsNew);
  AppendMenu(HVar11,UVar22,UVar10,(LPCSTR)CONCAT22(0x1120,pcVar14));
  UVar22 = 0;
  UVar10 = 0x3a99;
  HVar11 = rghmenuSubPopup[1];
  pcVar14 = PszGetCompressedString(idsOpen);
  AppendMenu(HVar11,UVar22,UVar10,(LPCSTR)CONCAT22(0x1120,pcVar14));
  for (rcT = 0; rcT < vcplrNew; rcT = rcT + 1) {
    if (uVar9 == rcT * 4 + 2U) {
      hwndBtn = 8;
    }
    else {
      hwndBtn = 0;
    }
    dy = (short)PszPlayerName(0,1,1,1,0,vrgplrNew + rcT);
    AppendMenu(rghmenuSubPopup[1],hwndBtn,rcT + 0x3ab8,(LPCSTR)CONCAT22(0x1120,dy));
  }
  rghmenuSubPopup[2] = CreatePopupMenu();
  for (rcT = 0; rcT < 7; rcT = rcT + 1) {
    HVar11 = CreatePopupMenu();
    rghmenuSubPopup[rcT + 5] = HVar11;
    for (dyBut = 0; dyBut < 5; dyBut = dyBut + 1) {
      if (uVar9 == dyBut * 0x20 + rcT * 4 + 5U) {
        hwndBtn = 8;
      }
      else {
        hwndBtn = 0;
      }
      AppendMenu(rghmenuSubPopup[rcT + 5],hwndBtn,rcT + 0x3ac8 + dyBut * 8,
                 (LPCSTR)CONCAT22(0x1120,(char *)*(undefined2 *)(dyBut * 2 + 0xaae)));
    }
    if ((uVar9 & 0x1f) == rcT * 4 + 5U) {
      hwndBtn = 8;
    }
    else {
      hwndBtn = 0;
    }
    AppendMenu(rghmenuSubPopup[2],hwndBtn | 0x10,rghmenuSubPopup[rcT + 5],
               (LPCSTR)CONCAT22(0x1120,(char *)*(undefined2 *)(rcT * 2 + 0xa7e)));
  }
  HVar11 = CreatePopupMenu();
  iPopMenuSel = -1;
  if ((uVar9 & 3) == 1) {
    hwndBtn = 8;
  }
  else {
    hwndBtn = 0;
  }
  uVar12 = hwndBtn | 0x10;
  HVar21 = rghmenuSubPopup[0];
  hmenuPopup = HVar11;
  pcVar14 = PszGetCompressedString(idsPredefinedRace);
  AppendMenu(HVar11,uVar12,HVar21,(LPCSTR)CONCAT22(0x1120,pcVar14));
  if ((uVar9 & 3) == 2) {
    hwndBtn = 8;
  }
  else {
    hwndBtn = 0;
  }
  uVar12 = hwndBtn | 0x10;
  HVar11 = rghmenuSubPopup[1];
  HVar21 = hmenuPopup;
  pcVar14 = PszGetCompressedString(idsCustomRace);
  AppendMenu(HVar21,uVar12,HVar11,(LPCSTR)CONCAT22(0x1120,pcVar14));
  if (((uVar9 & 3) == 1) || ((uVar9 & 3) == 2)) {
    UVar22 = 0;
    UVar10 = 0x3a9a;
    HVar11 = hmenuPopup;
    pcVar14 = PszGetCompressedString(idsEditRace);
    AppendMenu(HVar11,UVar22,UVar10,(LPCSTR)CONCAT22(0x1120,pcVar14));
  }
  AppendMenu(hmenuPopup,0x800,0,(LPCSTR)0x0);
  if ((uVar9 & 3) == 3) {
    hwndBtn = 8;
  }
  else {
    hwndBtn = 0;
  }
  uVar12 = hwndBtn | 0x10;
  HVar11 = rghmenuSubPopup[2];
  HVar21 = hmenuPopup;
  pcVar14 = PszGetCompressedString(idsComputerPlayer);
  AppendMenu(HVar21,uVar12,HVar11,(LPCSTR)CONCAT22(0x1120,pcVar14));
  AppendMenu(hmenuPopup,0x800,0,(LPCSTR)0x0);
  if ((bVar5 & 3) == 0) {
    UVar10 = 8;
  }
  else {
    UVar10 = 0;
  }
  UVar22 = 0x3a9b;
  HVar11 = hmenuPopup;
  hwndBtn = UVar10;
  pcVar14 = PszGetCompressedString(idsPlayer);
  AppendMenu(HVar11,UVar10,UVar22,(LPCSTR)CONCAT22(0x1120,pcVar14));
  if (message == WM_LBUTTONDOWN) {
    dyCur = 0;
  }
  else {
    dyCur = 2;
  }
  TrackPopupMenu(hmenuPopup,dyCur | 4,pt,pt__18,0,hwnd,(RECT *)0x0);
  DestroyMenu(hmenuPopup);
  for (rcT = 0; rcT < 6; rcT = rcT + 1) {
    DestroyMenu(rghmenuSubPopup[rcT]);
  }
  BVar13 = PeekMessage((MSG *)CONCAT22(unaff_SS,&msg),hwnd,0x111,0x111,2);
  if (((BVar13 != 0) && (14999 < msg.wParam)) && (msg.wParam < 0x3afc)) {
    iPopMenuSel = msg.wParam + 0xc568;
  }
  iNewVal = -1;
  iCurVal = uVar9;
  if (iPopMenuSel != -1) {
    if (iPopMenuSel == 0) {
      puVar18 = (undefined2 *)&vrgplrDef;
      pPVar17 = (PLAYER *)&vplr;
      for (iVar15 = 0x60; iVar15 != 0; iVar15 = iVar15 + -1) {
        pPVar2 = pPVar17;
        pPVar17 = (PLAYER *)&pPVar17->cPlanet;
        puVar1 = puVar18;
        puVar18 = puVar18 + 1;
        uVar3 = *puVar1;
        pPVar2->iPlayer = (char)uVar3;
        pPVar2->cShDef = (char)((uint)uVar3 >> 8);
      }
      CchGetString(idsHumanoid,(char *)vplr.szName);
      _wsprintf(vplr.szNames,(char *)0x11200ae0,0x501a,0x1120);
      pRVar7 = vrgrcRCW;
      sVar23 = RaceCreationWizard(hwnd,0,0);
      vrgrcRCW = pRVar7;
      if (sVar23 == 0) goto LAB_1078_9035;
CREATE_PlaceNew:
      if (vcplrNew < 0x10) {
        iNewVal = vcplrNew;
        vcplrNew = vcplrNew + 1;
      }
      else {
        for (iNewVal = 0xf; -1 < iNewVal; iNewVal = iNewVal + -1) {
          rcT = 0;
          while ((rcT < 0x10 &&
                 (((((byte *)vrgplrTypeNew)[rcT] & 3) != 2 ||
                  (((int)(uint)((byte *)vrgplrTypeNew)[rcT] >> 2 & 0xfU) != iNewVal))))) {
            rcT = rcT + 1;
          }
          if (rcT == 0x10) break;
        }
      }
      pPVar19 = vrgplrNew + iNewVal;
      pPVar17 = (PLAYER *)&vplr;
      for (iVar15 = 0x60; iVar15 != 0; iVar15 = iVar15 + -1) {
        pPVar4 = pPVar19;
        pPVar19 = (PLAYER *)&pPVar19->cPlanet;
        pPVar2 = pPVar17;
        pPVar17 = (PLAYER *)&pPVar17->cPlanet;
        cVar6 = pPVar2->cShDef;
        pPVar4->iPlayer = pPVar2->iPlayer;
        pPVar4->cShDef = cVar6;
      }
      _strcpy(vrgszFileNew + iNewVal * 0xd,(char *)&szRaceFile);
      iNewVal = iNewVal << 2 | 2;
    }
    else {
LAB_1078_9035:
      if (iPopMenuSel == 1) {
        sVar23 = FOpenGame(hwnd,1);
        if (0 < sVar23) goto CREATE_PlaceNew;
      }
      else if (iPopMenuSel == 2) {
        iVar15 = (int)uVar9 >> 2;
        if ((uVar9 & 3) == 1) {
          puVar18 = (undefined2 *)(iVar15 * 0xc0 + 0xda2);
          pPVar17 = (PLAYER *)&vplr;
          for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
            pPVar2 = pPVar17;
            pPVar17 = (PLAYER *)&pPVar17->cPlanet;
            puVar1 = puVar18;
            puVar18 = puVar18 + 1;
            uVar3 = *puVar1;
            pPVar2->iPlayer = (char)uVar3;
            pPVar2->cShDef = (char)((uint)uVar3 >> 8);
          }
          CchGetString(iVar15 + idsHumanoid,(char *)vplr.szName);
          _wsprintf(vplr.szNames,(char *)0x11200ae4,0x501a,0x1120);
        }
        else {
          pPVar17 = vrgplrNew + iVar15;
          pPVar19 = (PLAYER *)&vplr;
          for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
            pPVar4 = pPVar19;
            pPVar19 = (PLAYER *)&pPVar19->cPlanet;
            pPVar2 = pPVar17;
            pPVar17 = (PLAYER *)&pPVar17->cPlanet;
            cVar6 = pPVar2->cShDef;
            pPVar4->iPlayer = pPVar2->iPlayer;
            pPVar4->cShDef = cVar6;
          }
          _strcpy((char *)&szRaceFile,vrgszFileNew + iVar15 * 0xd);
        }
        lSaltCur._0_2_ = (int)vplr.lSalt;
        lSaltCur._2_2_ = vplr.lSalt._2_2_;
        lSaltLast._0_2_ = 0;
        lSaltLast._2_2_ = 0;
        sVar23 = FCheckPassword();
        if (sVar23 == 0) goto CREATE_FinishClick;
        if (((int)vplr.lSalt == 0) && (vplr.lSalt._2_2_ == 0)) {
          szRacePass = 0;
        }
        else {
          _strcpy((char *)&szRacePass,(char *)szPassLast);
        }
        pRVar7 = vrgrcRCW;
        sVar23 = RaceCreationWizard(hwnd,0,0);
        vrgrcRCW = pRVar7;
        if (sVar23 != 0) {
          if (((uVar9 & 3) == 1) ||
             (sVar23 = _strcmp((char *)&szRaceFile,
                                       vrgszFileNew + iVar15 * 0xd), sVar23 != 0))
          goto CREATE_PlaceNew;
          pPVar19 = vrgplrNew + iVar15;
          pPVar17 = (PLAYER *)&vplr;
          for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
            pPVar4 = pPVar19;
            pPVar19 = (PLAYER *)&pPVar19->cPlanet;
            pPVar2 = pPVar17;
            pPVar17 = (PLAYER *)&pPVar17->cPlanet;
            cVar6 = pPVar2->cShDef;
            pPVar4->iPlayer = pPVar2->iPlayer;
            pPVar4->cShDef = cVar6;
          }
          _strcpy(vrgszFileNew + iVar15 * 0xd,(char *)&szRaceFile);
          iCurVal = -1;
          vrgrcRCW = pRVar7;
          iNewVal = uVar9;
        }
      }
      else if (iPopMenuSel == 3) {
        iNewVal = 0;
      }
      else if ((iPopMenuSel < 0x10) || (0x1f < iPopMenuSel)) {
        if ((iPopMenuSel < 0x20) || (0x2f < iPopMenuSel)) {
          if (0x2f < iPopMenuSel) {
            iNewVal = (iPopMenuSel + -0x30) * 4 | 3;
          }
        }
        else {
          iNewVal = (iPopMenuSel + -0x20) * 4 | 2;
        }
      }
      else {
        iNewVal = (iPopMenuSel + -0x10) * 4 | 1;
      }
    }
  }
  if ((iNewVal != -1) && (iNewVal != iCurVal)) {
    ((byte *)vrgplrTypeNew)[iDiamond] = (byte)iNewVal;
    if (iNewVal == 0) {
      while (iDiamond + 1 < 0x10) {
        ((byte *)vrgplrTypeNew + 1)[iDiamond] = 0;
        iDiamond = iDiamond + 1;
      }
    }
    else if (0 < iDiamond) {
      while ((-1 < iDiamond + -1 &&
             (*(char *)((int)(short **)&vrgiflMerge + iDiamond + 1) == '\0'))) {
        *(byte *)((int)(short **)&vrgiflMerge + iDiamond + 1) = (byte)iNewVal;
        iDiamond = iDiamond + -1;
      }
    }
    InvalidateRect(hwnd,(RECT *)0x0,1);
  }
CREATE_FinishClick:
  SetFocus(hwnd);
  return 0;
}



// ======================================================================
// Function: DrawNewGame2
// Address: 1078:9556
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x107897f8) */
/* WARNING: Removing unreachable block (ram,0x10789791) */
/* WARNING: Removing unreachable block (ram,0x10789894) */

void DrawNewGame2(HWND hwnd,HDC hdc,short iDraw)

{
  byte bVar1;
  char *pcVar2;
  int iVar3;
  short sVar4;
  uint uVar5;
  ushort uVar6;
  char *pcVar7;
  undefined2 unaff_SS;
  DWORD DVar8;
  char *pcVar9;
  undefined2 uVar10;
  undefined2 uVar11;
  HDC HVar12;
  undefined2 uVar13;
  undefined2 uVar14;
  char szT [18];
  short ids;
  RECT rc;
  RECT rcDiamond;
  short cch;
  short bkMode;
  short iPlr;
  short i;
  short yCur;
  short fCreatedDC;
  
  fCreatedDC = 0;
  if (hdc == 0) {
    fCreatedDC = 1;
    hdc = GetDC(hwnd);
  }
  GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
  bkMode = SetBkMode(hdc,1);
  SelectObject(hdc,rghfontArial8[1]);
  HVar12 = hdc;
  pcVar2 = PszGetCompressedString(idsPlayer16);
  DVar8 = GetTextExtent(HVar12,(LPCSTR)CONCAT22(0x1120,pcVar2),0xb);
  xNewGameDiamond = (int)DVar8 + 0xc;
  yCur = 6;
  SetRect((RECT *)CONCAT22(unaff_SS,&rcDiamond),xNewGameDiamond,6,
          xNewGameDiamond + dyArial8 + 1,dyArial8 + 7);
  for (i = 0; (i < 0x10 && ((fRCWReadOnly == 0 || (i < game.cPlayer)))); i = i + 1)
  {
    iVar3 = i + 1;
    pcVar2 = PszGetCompressedString(idsPlayerD);
    sVar4 = _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar2),iVar3);
    cch = sVar4 + 1;
    ((char *)szWork)[sVar4] = ':';
    ((char *)szWork + 1)[sVar4] = '\0';
    RightTextOut(hdc,xNewGameDiamond + -6,yCur,(char *)szWork,cch,0);
    DrawDiamond(hdc,&rcDiamond,hbrBBlue);
    uVar5 = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 2;
    iPlr = uVar5 & 0xf;
    if (fRCWReadOnly == 0) {
      bVar1 = ((byte *)vrgplrTypeNew)[i] & 3;
      if ((((byte *)vrgplrTypeNew)[i] & 3) == 0) {
        CchGetString(idsPlayer2,(char *)szWork);
      }
      else if (bVar1 == 1) {
        if ((uint)iPlr < 6) {
          CchGetString(idsS,szT);
          pcVar2 = PszGetCompressedString(iPlr + idsHumanoid);
          _wsprintf(szWork,(char *)CONCAT22(unaff_SS,szT),pcVar2,0x1120);
        }
        else {
          if (iPlr == 6) {
            ids = idsRandom;
          }
          else {
            ids = idsExpansionPlayer;
          }
          CchGetString(ids,(char *)szWork);
        }
      }
      else if (bVar1 == 2) {
        if (((gd.grBits2._2_2_ >> 6 & 1) == 0) ||
           (vrgszFileNew[iPlr * 0xd] == '\0')) {
          if (vrgszFileNew[iPlr * 0xd] == '\0') {
            pcVar7 = vrgplrNew[iPlr].szNames;
            uVar10 = 0x1120;
            pcVar2 = PszGetCompressedString(idsS);
            _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar2),pcVar7,uVar10);
          }
          else {
            pcVar7 = vrgszFileNew + iPlr * 0xd;
            uVar13 = 0x1120;
            pcVar9 = vrgplrNew[iPlr].szNames;
            uVar10 = 0x1120;
            pcVar2 = PszGetCompressedString(idsSS2);
            _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar2),pcVar9,uVar10,pcVar7,uVar13);
          }
        }
        else {
          _wsprintf(szWork,(char *)0x11200aee,vrgszFileNew + iPlr * 0xd,0x1120);
        }
      }
      else if (bVar1 == 3) {
        uVar10 = *(undefined2 *)(((int)(uint)((byte *)vrgplrTypeNew)[i] >> 5) * 2 + 0xaae)
        ;
        uVar14 = 0x1120;
        uVar13 = *(undefined2 *)((uVar5 & 7) * 2 + 0xa7e);
        uVar11 = 0x1120;
        pcVar2 = PszGetCompressedString(idsSSComputerPlayer);
        _wsprintf(szWork,(char *)CONCAT22(0x1120,pcVar2),uVar13,uVar11,uVar10,uVar14);
      }
    }
    else if ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) {
      CchGetString(idsUnknownPlayer,(char *)szWork);
    }
    else {
      PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
      if ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) != 0) {
        pcVar2 = PszGetCompressedString(idsDeceased);
        uVar10 = 0x1120;
        pcVar7 = (char *)0xae8;
        uVar6 = _strlen((char *)szWork);
        _wsprintf((char *)CONCAT22(0x1120,(char *)szWork + uVar6),
                  (char *)CONCAT22(uVar10,pcVar7),pcVar2);
        SetTextColor(hdc,0x7f);
      }
    }
    iVar3 = rcDiamond.right + 6;
    uVar10 = 0x1120;
    pcVar2 = (char *)szWork;
    sVar4 = yCur;
    HVar12 = hdc;
    uVar6 = _strlen((char *)szWork);
    TextOut(HVar12,iVar3,sVar4,(LPCSTR)CONCAT22(uVar10,pcVar2),uVar6);
    SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
    OffsetRect((RECT *)CONCAT22(unaff_SS,&rcDiamond),0,dyArial8 + 4);
    yCur = yCur + dyArial8 + 4;
  }
  SetBkMode(hdc,bkMode);
  if (fCreatedDC != 0) {
    ReleaseDC(hwnd,hdc);
  }
  return;
}



// ======================================================================
// Function: NewGameDlg3
// Address: 1078:99f4
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short NewGameDlg3(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  POINT pt_00;
  POINT pt_01;
  WPARAM WVar1;
  HWND HVar2;
  short sVar3;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar4;
  LRESULT LVar5;
  UINT UVar6;
  ushort in_stack_0000ffd0;
  HDC pt;
  HDC hdc;
  RECT rc;
  short i;
  
  uVar4 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hdc = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)&stack0xffd0));
    DrawNewGame3(hwnd,hdc,-1);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,(PAINTSTRUCT *)&stack0xffd0));
    sVar3 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(RECT *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    sVar3 = 1;
  }
  else {
    if (message == WM_CTLCOLOR) {
      for (i = 0x123; i < 0x12a; i = i + 1) {
        hdc = (HDC)lParam;
        HVar2 = GetDlgItem(hwnd,i);
        if (hdc == HVar2) break;
      }
      if ((i < 0x12a) || (uVar4 = __aFulshr(uVar4,in_stack_0000ffd0), (int)uVar4 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else if (message == WM_SETCURSOR) {
      GetCursorPos((POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffee));
      ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffee));
      pt_00.y = hdc;
      pt_00.x = pt;
      sVar3 = IrcRaceDlgHitTest(pt_00);
      if (-1 < sVar3) {
        setcursor(hcurHand);
        return 1;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        SetNGWTitle(hwnd,3);
        for (i = 0; i < 7; i = i + 1) {
          HVar2 = GetDlgItem(hwnd,i + 0x123);
          UVar6 = 0x401;
          WVar1 = GetVCCheck((GAME *)&game,(uint)(1 < i) + i);
          SendMessage(HVar2,UVar6,WVar1,0);
          if (fRCWReadOnly != 0) {
            HVar2 = GetDlgItem(hwnd,i + 0x123);
            EnableWindow(HVar2,0);
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)CONCAT22(0x1120,_szHelpFile),1,0x3fd);
          return 1;
        }
        i = 0;
        while ((i < 4 && (wParam != *(ushort *)((ushort_0_ *)&rgidRaceBtn + i * 2)))) {
          i = i + 1;
        }
        if (i < 4) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,i);
          return 1;
        }
        if ((0x122 < wParam) && (wParam < 0x12a)) {
          HVar2 = GetDlgItem(hwnd,wParam);
          LVar5 = SendMessage(HVar2,0x400,0,0);
          i = (short)LVar5;
          SetVCCheck((GAME *)&game,(wParam - 0x123) + (uint)(1 < wParam - 0x123),i);
          DrawNewGame3(hwnd,0,8);
        }
      }
      else if ((message == WM_LBUTTONDOWN) || (message == WM_LBUTTONDBLCLK)) {
        pt = (HDC)lParam;
        uVar4 = __aFulshr(uVar4,in_stack_0000ffd0);
        hdc = (HDC)uVar4;
        pt_01.y = hdc;
        pt_01.x = pt;
        sVar3 = FTrackNewGameDlg3(hwnd,pt_01,wParam);
        return sVar3;
      }
    }
    sVar3 = 0;
  }
  return sVar3;
}



// ======================================================================
// Function: DrawNewGame3
// Address: 1078:9d5e
// Segment: MEMORY_CREATE
// ======================================================================


void DrawNewGame3(HWND hwnd,HDC hdc,short iDraw)

{
  HWND HVar1;
  short sVar2;
  RECT *pRVar3;
  RECT *pRVar4;
  undefined2 unaff_SS;
  DWORD DVar5;
  RECT rc;
  short cch;
  short xLeft;
  short dxDig;
  short bkMode;
  COLORREF crBkSav;
  short j;
  RECT rcCBox;
  short dxItem;
  short i;
  short fCreatedDC;
  short ids;
  short irc;
  short vcCur;
  short bt;
  short yTop;
  
  fCreatedDC = 0;
  if (fRCWReadOnly == 0) {
    bt = 0;
  }
  else {
    bt = 4;
  }
  if (hdc == 0) {
    fCreatedDC = 1;
    hdc = GetDC(hwnd);
  }
  GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
  bkMode = SetBkMode(hdc,2);
  crBkSav = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace)
                      );
  SelectObject(hdc,rghfontArial8[1]);
  yTop = dyArial8 * 3 + 6;
  DVar5 = GetTextExtent(hdc,(LPCSTR)0x11200af2,1);
  dxDig = (short)DVar5;
  ids = 0x3aa;
  irc = 0;
  vcCur = 0;
  i = 0;
  do {
    if (8 < i) {
      crcRCW = irc;
      SetBkColor(hdc,crBkSav);
      SetBkMode(hdc,bkMode);
      if (fCreatedDC != 0) {
        ReleaseDC(hwnd,hdc);
      }
      return;
    }
    if (i < 7) {
      HVar1 = GetDlgItem(hwnd,i + 0x123);
      GetWindowRect(HVar1,(RECT *)CONCAT22(unaff_SS,&rcCBox));
      MapWindowPoints(0,hwnd,(POINT *)CONCAT22(unaff_SS,&rcCBox),2);
      xLeft = rcCBox.right + 2;
      yTop = ((rcCBox.bottom - rcCBox.top) / 2 + rcCBox.top) - (dyArial8 >> 1);
    }
    else if (i == 7) {
      xLeft = rcCBox.left;
      yTop = rcCBox.bottom + 6;
    }
    else {
      xLeft = rcCBox.left;
      yTop = rcCBox.bottom + 6 + (dyArial8 * 3) / 2;
    }
    sVar2 = ids;
    ids = ids + 1;
    cch = CchGetString(sVar2,(char *)szWork);
    if (iDraw == -1) {
      TextOut(hdc,xLeft,yTop,szWork,cch);
    }
    DVar5 = GetTextExtent(hdc,szWork,cch);
    xLeft = xLeft + (int)DVar5;
    for (j = 0; j < 2; j = j + 1) {
      sVar2 = _abs((int)((char (*) [2])rgNG3Width)[i][j]);
      dxItem = sVar2 * dxDig;
      if (dxItem == 0) {
        ids = ids + 1;
        break;
      }
      sVar2 = GetVCVal((GAME *)&game,vcCur,0);
      _wsprintf(szWork,(char *)CONCAT22(0x1120,PCTD),sVar2);
      if (((char (*) [2])rgNG3Width)[i][j] < '\0') {
        dxItem = dxItem + (dxDig * 3) / 2;
        _strcat((char *)szWork,(char *)0xaf4);
      }
      xLeft = xLeft + dxItem;
      if (((iDraw == -1) || (iDraw == vcCur)) || (vcCur == 8)) {
        RightTextOut(hdc,xLeft,yTop,(char *)szWork,0,dxItem);
      }
      vcCur = vcCur + 1;
      (vrgrcRCW + irc)->left = xLeft + 4;
      vrgrcRCW[irc].top = yTop + -3;
      vrgrcRCW[irc].right = (vrgrcRCW + irc)->left + 0xf;
      vrgrcRCW[irc].bottom = (dyArial8 >> 1) + vrgrcRCW[irc].top + 3;
      pRVar3 = vrgrcRCW + irc;
      pRVar4 = vrgrcRCW + irc + 1;
      pRVar4->left = pRVar3->left;
      pRVar4->top = pRVar3->top;
      pRVar4->right = pRVar3->right;
      pRVar4->bottom = pRVar3->bottom;
      OffsetRect((RECT *)CONCAT22(0x1120,vrgrcRCW + irc + 1),0,
                 (vrgrcRCW[irc].bottom - vrgrcRCW[irc].top) + -1);
      if (iDraw == -1) {
        DrawBtn(hdc,vrgrcRCW + irc,bt | 0xa0,0,(char *)0x0);
        DrawBtn(hdc,vrgrcRCW + irc + 1,bt | 0xa1,0,(char *)0x0);
      }
      xLeft = vrgrcRCW[irc].right + 4;
      cch = CchGetString(ids,(char *)szWork);
      if (iDraw == -1) {
        TextOut(hdc,xLeft,yTop,szWork,cch);
      }
      DVar5 = GetTextExtent(hdc,szWork,cch);
      xLeft = xLeft + (int)DVar5;
      ids = ids + 1;
      irc = irc + 2;
    }
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: FTrackNewGameDlg3
// Address: 1078:a210
// Segment: MEMORY_CREATE
// ======================================================================


short FTrackNewGameDlg3(HWND hwnd,POINT pt,short kbd)

{
  int vc;
  short sVar1;
  short sVar2;
  short iStat;
  short iMod;
  short dShift;
  short i;
  BTNT btnt;
  short irc;
  short bt;
  
  irc = IrcRaceDlgHitTest(pt);
  if (irc < 0) {
    sVar1 = 0;
  }
  else {
    vc = irc >> 1;
    if ((irc & 1U) == 0) {
      dShift = 1;
      bt = 0xa0;
    }
    else {
      dShift = -1;
      bt = 0xa1;
    }
    InitBtnTrack(&btnt,hwnd,0,vrgrcRCW + irc,bt,0x50,0,0,(char *)0x0);
    if ((kbd & 0xcU) != 0) {
      dShift = dShift * 5;
    }
    while (sVar1 = FTrackBtn(&btnt), sVar1 != 0) {
      sVar1 = GetVCVal((GAME *)&game,vc,1);
      sVar2 = SetVCVal((GAME *)&game,vc,sVar1 + dShift);
      if (sVar2 != sVar1) {
        DrawNewGame3(hwnd,btnt.hdc,vc);
      }
    }
    sVar1 = 1;
  }
  return sVar1;
}



// ======================================================================
// Function: SetNGWTitle
// Address: 1078:a320
// Segment: MEMORY_CREATE
// ======================================================================


void SetNGWTitle(HWND hwnd,short iStep)

{
  undefined2 unaff_SS;
  char szBuf [50];
  short cch;
  
  cch = CchGetString(fRCWReadOnly + idsAdvancedNewGameWizardStepD3,szBuf);
  cch = _wsprintf(szWork,(char *)CONCAT22(unaff_SS,szBuf),iStep);
  SetWindowText(hwnd,szWork);
  return;
}



// ======================================================================
// Function: LpplrComp
// Address: 1078:b570
// Segment: MEMORY_CREATE
// ======================================================================


PLAYER * LpplrComp(short idAi,short lvlAi)

{
  return (PLAYER *)CONCAT22(0x1078,((PLAYER (*) [4])vrgplrComp)[idAi] + lvlAi);
}



// ======================================================================
// Function: SetVCCheck
// Address: 1078:b5bc
// Segment: MEMORY_CREATE
// ======================================================================


void SetVCCheck(GAME *pgame,short vc,short fChecked)

{
  byte bVar1;
  
  if (fChecked == 0) {
    bVar1 = 0;
  }
  else {
    bVar1 = 0x80;
  }
  pgame->rgvc[vc] = pgame->rgvc[vc] & 0x7f | bVar1;
  return;
}



// ======================================================================
// Function: GetVCCheck
// Address: 1078:b60c
// Segment: MEMORY_CREATE
// ======================================================================


short GetVCCheck(GAME *pgame,short vc)

{
  return (uint)((pgame->rgvc[vc] & 0x80) != 0);
}



// ======================================================================
// Function: SetVCVal
// Address: 1078:b644
// Segment: MEMORY_CREATE
// ======================================================================


short SetVCVal(GAME *pgame,short vc,short val)

{
  short sVar1;
  short cur;
  
  if (val < 0) {
    val = 0;
  }
  else if (((short *)vrgvcMax)[vc] < val) {
    val = ((short *)vrgvcMax)[vc];
  }
  pgame->rgvc[vc] = pgame->rgvc[vc] & 0x80 | (byte)val;
  if ((vc == 8) && (sVar1 = GetVCVal(pgame,8,0), sVar1 != val)) {
    pgame->rgvc[8] = pgame->rgvc[8] & 0x80 | (byte)sVar1;
    val = sVar1;
  }
  return val;
}



// ======================================================================
// Function: GetVCVal
// Address: 1078:b710
// Segment: MEMORY_CREATE
// ======================================================================


short GetVCVal(GAME *pgame,short vc,short fRaw)

{
  uint uVar1;
  short val;
  short i;
  short c;
  
  uVar1 = pgame->rgvc[vc] & 0x7f;
  if (fRaw == 0) {
    switch(vc) {
    case 0:
      uVar1 = uVar1 * 5 + 0x14;
      break;
    case 1:
      uVar1 = uVar1 + 8;
      break;
    case 2:
      uVar1 = uVar1 + 2;
      break;
    case 3:
      uVar1 = uVar1 * 1000 + 1000;
      break;
    case 4:
      uVar1 = uVar1 * 10 + 0x14;
      break;
    case 5:
    case 6:
      uVar1 = uVar1 * 10 + 10;
      break;
    case 7:
      uVar1 = uVar1 * 10 + 0x1e;
      break;
    default:
      c = 0;
      for (i = 0; i < 8; i = i + 1) {
        if ((i != 2) && ((*(byte *)(i + 0x84) & 0x80) != 0)) {
          c = c + 1;
        }
      }
      if (c < (int)uVar1) {
        uVar1 = c;
      }
      break;
    case 9:
      uVar1 = uVar1 * 10 + 0x1e;
    }
  }
  return uVar1;
}



