// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: InitBattlePlan
// Address: 1078:00c0
// Segment: MEMORY_CREATE
// ======================================================================


void InitBattlePlan(BTLPLAN *lpbtlplan,short iplan,short iplr)

{
  short *psVar1;
  BTLPLAN *pBVar2;
  int iVar3;
  short *psVar4;
  BTLPLAN *pBVar5;
  BTLPLAN *pBVar6;
  undefined2 uVar7;
  
  psVar4 = (short *)(iplan * 0x24 + 0xc);
  uVar7 = (undefined2)((ulong)lpbtlplan >> 0x10);
  pBVar5 = (BTLPLAN *)lpbtlplan;
  pBVar6 = pBVar5;
  for (iVar3 = 0x12; iVar3 != 0; iVar3 = iVar3 + -1) {
    pBVar2 = pBVar6;
    pBVar6 = (BTLPLAN *)&pBVar6->wFlags;
    psVar1 = psVar4;
    psVar4 = psVar4 + 1;
    pBVar2->wFlags = *psVar1;
  }
  lpbtlplan->wFlags = lpbtlplan->wFlags & 0xfff0U | iplr & 0xfU;
  if ((((uint)game.wCrap >> 2 & 1) != 0) && (iplan == 0)) {
    pBVar5->wFlags = pBVar5->wFlags & 0xe0ffU | 0x300;
  }
  return;
}



// ======================================================================
// Function: GenerateWorld
// Address: 1078:0136
// Segment: MEMORY_CREATE
// ======================================================================

// Decompilation failed: 
Low-level Error: Forced merge caused intersection

// ======================================================================
// Function: CreateStartupShip
// Address: 1078:4690
// Segment: MEMORY_CREATE
// ======================================================================


short CreateStartupShip(short iplr,short idPlanet,short ishdef,short fAddShdef)

{
  char *pcVar1;
  uint *puVar2;
  int *piVar3;
  HullDef *pHVar4;
  char cVar5;
  FLEET *pFVar6;
  uint uVar7;
  undefined2 uVar8;
  undefined2 uVar9;
  int iVar10;
  SHDEF *pSVar11;
  HullDef *pHVar12;
  SHDEF *pSVar13;
  FLEET *lpfl_00;
  long lVar14;
  FLEET *lpfl;
  short ishMac;
  
  if (fAddShdef != 0) {
    cVar5 = *(char *)((int)&rgplr[0].cShDef + iplr * 0xc0);
    pcVar1 = (char *)((int)&rgplr[0].cShDef + iplr * 0xc0);
    *pcVar1 = *pcVar1 + '\x01';
    uVar7 = (uint)cVar5;
    pSVar13 = LpshdefT();
    uVar8 = (undefined2)((ulong)pSVar13 >> 0x10);
    pSVar11 = (SHDEF *)pSVar13 + ishdef;
    uVar9 = *(undefined2 *)(iplr * 4 + 0x100);
    pHVar12 = (HullDef *)(*(int *)(iplr * 4 + 0xfe) + uVar7 * 0x93);
    for (iVar10 = 0x49; iVar10 != 0; iVar10 = iVar10 + -1) {
      pHVar4 = pHVar12;
      pHVar12 = pHVar12 + 1;
      pSVar13 = pSVar11;
      pSVar11 = (SHDEF *)(pSVar11->hul).rgTech;
      *pHVar4 = (pSVar13->hul).ihuldef;
    }
    *(char *)pHVar12 = (char)(pSVar11->hul).ihuldef;
    *(uint *)(*(int *)(iplr * 4 + 0xfe) + uVar7 * 0x93 + 0x7b) =
         *(uint *)(*(int *)(iplr * 4 + 0xfe) + uVar7 * 0x93 + 0x7b) & 0x83ff | (uVar7 & 0x1f) << 10;
    ishdef = uVar7;
  }
  uVar9 = *(undefined2 *)(iplr * 4 + 0x100);
  iVar10 = *(int *)(iplr * 4 + 0xfe) + ishdef * 0x93;
  puVar2 = (uint *)(iVar10 + 0x83);
  uVar7 = *puVar2;
  *puVar2 = *puVar2 + 1;
  piVar3 = (int *)(iVar10 + 0x85);
  *piVar3 = *piVar3 + (uint)(0xfffe < uVar7);
  uVar9 = *(undefined2 *)(iplr * 4 + 0x100);
  iVar10 = *(int *)(iplr * 4 + 0xfe) + ishdef * 0x93;
  puVar2 = (uint *)(iVar10 + 0x7f);
  uVar7 = *puVar2;
  *puVar2 = *puVar2 + 1;
  piVar3 = (int *)(iVar10 + 0x81);
  *piVar3 = *piVar3 + (uint)(0xfffe < uVar7);
  lpfl_00 = LpflNew(iplr,idPlanet);
  uVar9 = (undefined2)((ulong)lpfl_00 >> 0x10);
  pFVar6 = (FLEET *)lpfl_00;
  pFVar6->rgcsh[ishdef] = 1;
  lVar14 = LGetFleetStat(lpfl_00,1);
  *(int *)(pFVar6->rgwtMin + 4) = (int)lVar14;
  *(undefined2 *)((int)pFVar6->rgwtMin + 0x12) = (int)((ulong)lVar14 >> 0x10);
  pFVar6->iplan = 0;
  return ishdef;
}



// ======================================================================
// Function: GenNewGameFromFile
// Address: 1078:4812
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10785712) */
/* WARNING: Removing unreachable block (ram,0x10785512) */
/* WARNING: Removing unreachable block (ram,0x10785311) */
/* WARNING: Removing unreachable block (ram,0x107851bf) */
/* WARNING: Removing unreachable block (ram,0x10785412) */
/* WARNING: Removing unreachable block (ram,0x10785612) */
/* WARNING: Removing unreachable block (ram,0x10785812) */
/* WARNING: Removing unreachable block (ram,0x10785085) */
/* WARNING: Removing unreachable block (ram,0x10784ba6) */
/* WARNING: Removing unreachable block (ram,0x10784a69) */
/* WARNING: Restarted to delay deadcode elimination for space: ram */

short GenNewGameFromFile(char *pszFile)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  PLAYER *pPVar3;
  char cVar4;
  uint uVar5;
  uint uVar6;
  short sVar7;
  ushort uVar8;
  char *pcVar9;
  short sVar10;
  int iVar11;
  undefined2 uVar12;
  PLAYER *pPVar13;
  undefined2 *puVar14;
  PLAYER *pPVar15;
  long lVar16;
  char *pcVar17;
  PLAYER *pPVar18;
  short lvlAi;
  short idAi;
  short cb;
  char *lpbDef;
  char *lpb;
  short j;
  short env [9];
  char *lpbStart;
  short fSuccess;
  short i;
  short c;
  short cNum;
  short rgplrbmp [16];
  short cPlr;
  long rgl [10];
  
  fSuccess = 0;
  _strcpy((char *)szWork,pszFile);
  penvMem = env;
  sVar7 = __setjmp(env);
  if (sVar7 != 0) goto CREATE_LError_3;
  if (ini.wFlags < 0) {
    _strcpy((char *)szBase,pszFile);
    pcVar9 = _strrchr((char *)szBase,0x2e);
    *pcVar9 = '\0';
    TurnLog(idsGeneratingYearD);
  }
  _memset((GAME *)&game,0,0x40);
  StreamOpen(pszFile,0x20);
  lVar16 = __filelength(hf);
  uVar8 = (ushort)lVar16;
  if (15999 < (int)uVar8) {
    FileError(idsUniverseCreationFileAppearsInvalid);
    goto CREATE_LError_3;
  }
  pcVar17 = LpAlloc(uVar8 + 1,htPerm);
  uVar12 = (undefined2)((ulong)pcVar17 >> 0x10);
  lpbDefMac._0_2_ = (char *)pcVar17 + uVar8;
  lpbDefMac._2_2_ = uVar12;
  RgFromStream(pcVar17,uVar8);
  StreamClose();
  ((char *)pcVar17)[uVar8] = '\0';
  lpb = pcVar17;
  pcVar17 = PszGetLine(&lpb);
  if ((*pcVar17 == '\0') || (uVar8 = __fstrlen(pcVar17), 0x1f < uVar8)) {
    sVar7 = 0x10;
    pcVar9 = PszFormatIds(idsIllegalGameTitle,(short *)0x0);
    AlertSz(pcVar9,sVar7);
    goto CREATE_LError_3;
  }
  __fstrcpy(game.szName,pcVar17);
  if ((char *)lpb < (char *)lpbDefMac) {
    pcVar17 = PszGetLine(&lpb);
    sVar7 = CParseNumbers(pcVar17,rgl,4);
    if (sVar7 == -1) {
CREATE_LUniDefError:
      sVar7 = 0x10;
      pcVar9 = PszFormatIds(idsLine2HasBadUniverseDefinitionParameter,(short *)0x0);
      AlertSz(pcVar9,sVar7);
      goto CREATE_LError_3;
    }
    for (i = 0; i < sVar7; i = i + 1) {
      if (i < 3) {
        if (*(int *)((int)rgl + i * 4 + 2) < 0) goto CREATE_LUniDefError;
        iVar11 = *(int *)((int)rgl + i * 4 + 2);
        if (((0 < iVar11) || ((-1 < iVar11 && (4 < *(uint *)(rgl + i))))) ||
           (((int)rgl[i] == 4 && ((*(int *)((int)rgl + i * 4 + 2) == 0 && (i != 0))))))
        goto CREATE_LUniDefError;
      }
    }
    if (0 < sVar7) {
      game.mdSize = (uint)rgl[0];
    }
    if (1 < sVar7) {
      game.mdDensity = (short)(char *)rgl[1];
    }
    if (2 < sVar7) {
      game.mdStartDist = (uint)rgl[2];
    }
    if (3 < sVar7) {
      Randomize(CONCAT22(rgl[3]._2_2_,(uint)rgl[3]));
    }
    if ((char *)lpb < (char *)lpbDefMac) {
      pcVar17 = PszGetLine(&lpb);
      sVar7 = CParseNumbers(pcVar17,rgl,7);
      if (sVar7 == -1) {
CREATE_LUniDefError3:
        sVar7 = 0x10;
        pcVar9 = PszFormatIds(idsLine3HasBadUniverseDefinitionParameter,(short *)0x0);
        AlertSz(pcVar9,sVar7);
        goto CREATE_LError_3;
      }
      for (i = 0; i < sVar7; i = i + 1) {
        if (*(int *)((int)rgl + i * 4 + 2) < 0) goto CREATE_LUniDefError3;
        iVar11 = *(int *)((int)rgl + i * 4 + 2);
        if ((-1 < iVar11) && ((0 < iVar11 || (1 < *(uint *)(rgl + i))))) goto CREATE_LUniDefError3;
      }
      if (0 < sVar7) {
        game.wCrap = game.wCrap & 0xfffeU | (uint)rgl[0] & 1;
      }
      if (1 < sVar7) {
        game.wCrap = game.wCrap & 0xfffdU | ((uint)(char *)rgl[1] & 1) << 1;
      }
      if (2 < sVar7) {
        game.wCrap = game.wCrap & 0xffdfU | ((uint)rgl[2] & 1) << 5;
      }
      if (3 < sVar7) {
        game.wCrap = game.wCrap & 0xff7fU | ((uint)rgl[3] & 1) << 7;
      }
      if (4 < sVar7) {
        game.wCrap = game.wCrap & 0xffefU | ((uint)rgl[4] & 1) << 4;
      }
      if (5 < sVar7) {
        game.wCrap = game.wCrap & 0xffbfU | ((uint)rgl[5] & 1) << 6;
      }
      if (6 < sVar7) {
        game.wCrap = game.wCrap & 0xfeffU | ((uint)rgl[6] & 1) << 8;
      }
      pcVar17 = PszGetLine(&lpb);
      sVar7 = CParseNumbers(pcVar17,rgl,1);
      uVar5 = (uint)rgl[0];
      if ((((sVar7 < 1) || (rgl[0]._2_2_ < 0)) || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] == 0)))) ||
         ((-1 < rgl[0]._2_2_ && ((0 < rgl[0]._2_2_ || (0x10 < (uint)rgl[0])))))) {
        sVar7 = 0x10;
        pcVar9 = PszFormatIds(idsLine4HasImproperNumberPlayerFiles,(short *)0x0);
        AlertSz(pcVar9,sVar7);
        goto CREATE_LError_3;
      }
      if ((char *)lpb < (char *)lpbDefMac) {
        game.cPlayer = (uint)rgl[0];
        for (i = 0; i < (int)uVar5; i = i + 1) {
          pcVar17 = PszGetLine(&lpb);
          if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
          lpbStart._0_2_ = (char *)pcVar17;
          lpbStart._2_2_ = (undefined2)((ulong)pcVar17 >> 0x10);
          if ((i < 1) || (*pcVar17 != '#')) {
            __fstrcpy(szWork,pcVar17);
            sVar7 = FWasRaceFile((char *)szWork,0);
            if (sVar7 == 0) goto CREATE_LCantGetRace;
            pPVar15 = (PLAYER *)rgplr + i;
            pPVar13 = (PLAYER *)&vplr;
            for (iVar11 = 0x60; iVar11 != 0; iVar11 = iVar11 + -1) {
              pPVar3 = pPVar15;
              pPVar15 = (PLAYER *)&pPVar15->cPlanet;
              pPVar18 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              cVar4 = pPVar18->cShDef;
              pPVar3->iPlayer = pPVar18->iPlayer;
              pPVar3->cShDef = cVar4;
            }
          }
          else {
            sVar7 = CParseNumbers
                              ((char *)CONCAT22(lpbStart._2_2_,(char *)lpbStart + 1),rgl,2);
            uVar6 = (uint)rgl[0];
            if ((((sVar7 < 2) || ((int)(uint)rgl[0] < 0)) || (6 < (int)(uint)rgl[0])) ||
               (((int)(char *)rgl[1] < 0 || (4 < (int)(char *)rgl[1])))) {
              __fstrcpy(szWork,pcVar17);
CREATE_LCantGetRace:
              iVar11 = i + 5;
              pcVar9 = PszGetCompressedString(idsLineDUnableLoadRaceFileS);
              _WSPRINTF((LPSTR)CONCAT22(iVar11,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(pcVar9,(char *)&DAT_1120_1120),(char *)szWork);
              AlertSz((char *)szWork,0x10);
              goto CREATE_LError_3;
            }
            if ((char *)rgl[1] == (char *)0x0) {
              lvlAi = Random(4);
            }
            else {
              lvlAi = (short)((char *)rgl[1] + -1);
            }
            if (uVar6 == 0) {
              idAi = Random(6);
            }
            else {
              idAi = uVar6 - 1;
            }
            pPVar18 = LpplrComp(idAi,lvlAi);
            pPVar13 = (PLAYER *)pPVar18;
            pPVar15 = (PLAYER *)rgplr + i;
            for (iVar11 = 0x60; iVar11 != 0; iVar11 = iVar11 + -1) {
              pPVar2 = pPVar15;
              pPVar15 = (PLAYER *)&pPVar15->cPlanet;
              pPVar3 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              cVar4 = pPVar3->cShDef;
              pPVar2->iPlayer = pPVar3->iPlayer;
              pPVar2->cShDef = cVar4;
            }
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xfdff | 0x200;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0x1fff | idAi << 0xd;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xe3ff | (lvlAi & 7U) << 10
            ;
          }
        }
        pcVar17 = PszGetLine(&lpb);
        sVar7 = CParseNumbers(pcVar17,rgl,2);
        if ((char *)lpb < (char *)lpbDefMac) {
          i = 0;
          if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
             ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
            if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
              if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                  ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < hbrButtonHilite)))) ||
                 ((-1 < rgl[1]._2_2_ &&
                  ((0 < rgl[1]._2_2_ ||
                   ((char *)((int)(ulong *)rgcrPlrHistory + 0x36) < (char *)rgl[1]))))))
              goto CREATE_LBadDefVc;
              SetVCCheck((GAME *)&game,0,1);
              SetVCVal((GAME *)&game,0,(int)((char *)rgl[1] + -0x14) / 5);
            }
            pcVar17 = PszGetLine(&lpb);
            sVar7 = CParseNumbers(pcVar17,rgl,3);
            if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
            i = 1;
            if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
               ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
              if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
                if (((sVar7 < 3) || (rgl[1]._2_2_ < 0)) ||
                   ((((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < (char *)0x8)) || (0 < rgl[1]._2_2_)) ||
                    ((((-1 < rgl[1]._2_2_ && (hbrWindowText < (char *)rgl[1])) ||
                      (rgl[2]._2_2_ < 0)) ||
                     (((rgl[2]._2_2_ < 1 && ((uint)rgl[2] < 2)) ||
                      ((-1 < rgl[2]._2_2_ && ((0 < rgl[2]._2_2_ || (6 < (uint)rgl[2]))))))))))))
                goto CREATE_LBadDefVc;
                SetVCCheck((GAME *)&game,1,1);
                SetVCCheck((GAME *)&game,2,1);
                SetVCVal((GAME *)&game,1,(short)((char *)rgl[1] + -8));
                SetVCVal((GAME *)&game,2,(uint)rgl[2] - 2);
              }
              pcVar17 = PszGetLine(&lpb);
              sVar7 = CParseNumbers(pcVar17,rgl,2);
              if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
              i = 2;
              if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
                 ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
                if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
                  if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                      ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < (char *)0x3e8)))) ||
                     ((-1 < rgl[1]._2_2_ &&
                      ((0 < rgl[1]._2_2_ || ((char *)rgbCur + 0x289 <= (char *)rgl[1])))))
                     ) goto CREATE_LBadDefVc;
                  SetVCCheck((GAME *)&game,3,1);
                  SetVCVal((GAME *)&game,3,(int)((char *)rgl[1] + -1000) / 1000);
                }
                pcVar17 = PszGetLine(&lpb);
                sVar7 = CParseNumbers(pcVar17,rgl,2);
                if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                i = 3;
                if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
                   ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
                  if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
                    if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                        ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < hbrButtonHilite)))) ||
                       ((-1 < rgl[1]._2_2_ &&
                        ((0 < rgl[1]._2_2_ || ((char *)0x12c < (char *)rgl[1]))))))
                    goto CREATE_LBadDefVc;
                    SetVCCheck((GAME *)&game,4,1);
                    SetVCVal((GAME *)&game,4,(int)((char *)rgl[1] + -0x14) / 10);
                  }
                  pcVar17 = PszGetLine(&lpb);
                  sVar7 = CParseNumbers(pcVar17,rgl,2);
                  if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                  i = 4;
                  if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
                     ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
                    if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
                      if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                          ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < (char *)0xa)))) ||
                         ((-1 < rgl[1]._2_2_ &&
                          ((0 < rgl[1]._2_2_ || ((char *)szMine + 8 < (char *)rgl[1]))))))
                      goto CREATE_LBadDefVc;
                      SetVCCheck((GAME *)&game,5,1);
                      SetVCVal((GAME *)&game,5,(int)((char *)rgl[1] + -10) / 10);
                    }
                    pcVar17 = PszGetLine(&lpb);
                    sVar7 = CParseNumbers(pcVar17,rgl,2);
                    if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                    i = 5;
                    if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
                       ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
                      if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
                        if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                            ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < (char *)0xa)))) ||
                           ((-1 < rgl[1]._2_2_ &&
                            ((0 < rgl[1]._2_2_ || ((char *)0x12c < (char *)rgl[1]))))))
                        goto CREATE_LBadDefVc;
                        SetVCCheck((GAME *)&game,6,1);
                        SetVCVal((GAME *)&game,6,(int)((char *)rgl[1] + -10) / 10);
                      }
                      pcVar17 = PszGetLine(&lpb);
                      sVar7 = CParseNumbers(pcVar17,rgl,2);
                      if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                      i = 6;
                      if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
                         ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 2)))))) {
                        if (((uint)rgl[0] == 1) && (rgl[0]._2_2_ == 0)) {
                          if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                              ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < hbrDesktop)))) ||
                             ((-1 < rgl[1]._2_2_ &&
                              ((0 < rgl[1]._2_2_ ||
                               ((char *)s_Stars______s_____s_____s_1120_0373 + 0x11 < (char *)rgl[1]
                               )))))) goto CREATE_LBadDefVc;
                          SetVCCheck((GAME *)&game,7,1);
                          SetVCVal((GAME *)&game,7,(int)((char *)rgl[1] + -0x1e) / 10);
                        }
                        pcVar17 = PszGetLine(&lpb);
                        sVar7 = CParseNumbers(pcVar17,rgl,2);
                        if ((char *)lpbDefMac <= (char *)lpb) goto CREATE_LUniDefShort;
                        i = 7;
                        if (((0 < sVar7) && (-1 < rgl[0]._2_2_)) &&
                           ((rgl[0]._2_2_ < 0 || ((rgl[0]._2_2_ < 1 && ((uint)rgl[0] < 8)))))) {
                          if ((-1 < rgl[0]._2_2_) && ((0 < rgl[0]._2_2_ || ((uint)rgl[0] != 0)))) {
                            if ((((sVar7 < 2) || (rgl[1]._2_2_ < 0)) ||
                                ((rgl[1]._2_2_ < 1 && ((char *)rgl[1] < hbrDesktop)))) ||
                               ((-1 < rgl[1]._2_2_ &&
                                ((0 < rgl[1]._2_2_ || ((char *)szMine + 8 < (char *)rgl[1])))
                                ))) goto CREATE_LBadDefVc;
                            SetVCVal((GAME *)&game,8,(uint)rgl[0]);
                            SetVCVal((GAME *)&game,9,(int)((char *)rgl[1] + -0x1e) / 10);
                          }
                          pcVar17 = PszGetLine(&lpb);
                          uVar12 = (undefined2)((ulong)pcVar17 >> 0x10);
                          pcVar9 = (char *)pcVar17;
                          uVar8 = __fstrlen(pcVar17);
                          lpb = (char *)CONCAT22(uVar12,pcVar9 + (uVar8 - 1));
                          if ((((2 < (int)(pcVar9 + (uVar8 - 1)) - (int)pcVar9) && (*lpb == 'y')) &&
                              (pcVar9[uVar8 - 2] == 'x')) && (pcVar9[uVar8 - 3] == '.')) {
                            pcVar9[uVar8 - 3] = '\0';
                          }
                          __fstrcpy(szBase,pcVar17);
                          if ((char *)lpb + 4 < (char *)lpbDefMac) {
                            lpbDefUni._0_2_ = (char *)lpb;
                            lpbDefUni._2_2_ = lpb._2_2_;
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) ==
                                 0) && (sVar7 = CAdvantagePoints
                                                          ((PLAYER *)rgplr + i), sVar7 < 0
                                       )) {
                              pPVar13 = (PLAYER *)rgplr + i;
                              puVar14 = (undefined2 *)&vrgplrDef;
                              for (iVar11 = 0x60; iVar11 != 0; iVar11 = iVar11 + -1) {
                                pPVar18 = pPVar13;
                                pPVar13 = (PLAYER *)&pPVar13->cPlanet;
                                puVar1 = puVar14;
                                puVar14 = puVar14 + 1;
                                uVar12 = *puVar1;
                                pPVar18->iPlayer = (char)uVar12;
                                pPVar18->cShDef = (char)((uint)uVar12 >> 8);
                              }
                              *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) =
                                   *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xffef |
                                   0x10;
                            }
                            if (*(char *)((int)rgplr[0].szName + i * 0xc0) == '\0') {
                              pcVar9 = (char *)((int)rgplr[0].szName + i * 0xc0);
                              sVar7 = Random(0x18);
                              CchGetString(sVar7 + idsBerserker,pcVar9);
                              _WSPRINTF((LPSTR)CONCAT22(i * 0xc0 + 0x5a22,(char *)&DAT_1120_1120),
                                        (LPCSTR)0xa2e1120,i * 0xc0 + 0x5a42);
                            }
                          }
                          for (i = 1; i < game.cPlayer; i = i + 1) {
                            j = 0;
                            while ((j < i && (sVar7 = _strcmp((char *)((int)rgplr
                                                                                    [0].szName +
                                                                              i * 0xc0),
                                                                      (char *)((int)rgplr
                                                                                    [0].szName +
                                                                              j * 0xc0)), sVar7 != 0
                                             ))) {
                              j = j + 1;
                            }
                            if (j < i) {
                              c = Random(0x18);
LAB_1078_5b09:
                              for (j = 0; j < game.cPlayer; j = j + 1) {
                                pcVar9 = PszGetCompressedString(c + idsBerserker);
                                sVar7 = _strcmp((char *)((int)rgplr[0].szName +
                                                                j * 0xc0),pcVar9);
                                if (sVar7 == 0) break;
                              }
                              if (j != game.cPlayer) {
                                c = c + 1;
                                if (0x17 < c) {
                                  c = 0;
                                }
                                goto LAB_1078_5b09;
                              }
                              CchGetString
                                        (c + idsBerserker,
                                         (char *)((int)rgplr[0].szName + i * 0xc0));
                              _strcpy((char *)((int)rgplr[0].szNames + i * 0xc0),
                                              (char *)((int)rgplr[0].szName + i * 0xc0));
                              _strcat((char *)((int)rgplr[0].szNames + i * 0xc0),
                                              (char *)0xa32);
                            }
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            rgplrbmp[i] = *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 3
                                          & 0x1f;
                            if ((rgplrbmp[i] < 0) || (0x1f < rgplrbmp[i])) {
                              rgplrbmp[i] = -1;
                            }
                          }
                          for (i = 1; i < game.cPlayer; i = i + 1) {
                            if (rgplrbmp[i] != -1) {
                              for (j = 0; (j < i && (rgplrbmp[j] != rgplrbmp[i])); j = j + 1) {
                              }
                              if (j < i) {
                                sVar10 = Random(2);
                                sVar7 = i;
                                if (sVar10 == 0) {
                                  sVar7 = j;
                                }
                                rgplrbmp[sVar7] = -1;
                              }
                            }
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            if (rgplrbmp[i] == -1) {
                              sVar7 = Random(0x20);
                              rgplrbmp[i] = sVar7;
                              while( true ) {
                                for (j = 0; (j < game.cPlayer &&
                                            ((j == i || (rgplrbmp[i] != rgplrbmp[j])))); j = j + 1)
                                {
                                }
                                if (j == game.cPlayer) break;
                                rgplrbmp[i] = rgplrbmp[i] + 1;
                                if (0x1f < rgplrbmp[i]) {
                                  rgplrbmp[i] = 0;
                                }
                              }
                            }
                          }
                          for (i = 0; i < game.cPlayer; i = i + 1) {
                            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xff07 |
                                 (rgplrbmp[i] & 0x1fU) << 3;
                          }
                          GenerateWorld(1);
                          fSuccess = 1;
                          goto CREATE_LError_3;
                        }
                      }
                    }
                  }
                }
              }
            }
          }
CREATE_LBadDefVc:
          iVar11 = i + uVar5 + 5;
          pcVar9 = PszGetCompressedString(idsLineDHasImproperVictoryConditionDefinition);
          _WSPRINTF((LPSTR)CONCAT22(iVar11,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar9,(char *)&DAT_1120_1120),(char *)szWork);
          AlertSz((char *)szWork,0x10);
          goto CREATE_LError_3;
        }
      }
    }
  }
CREATE_LUniDefShort:
  sVar7 = 0x10;
  pcVar9 = PszFormatIds(idsUniverseDefinitionFileAppearsTooShort,(short *)0x0);
  AlertSz(pcVar9,sVar7);
CREATE_LError_3:
  penvMem = (short *)0x0;
  StreamClose();
  lpbDefUni._0_2_ = (char *)0x0;
  lpbDefUni._2_2_ = 0;
  TurnLog(fSuccess + idsFailed);
  return fSuccess;
}



// ======================================================================
// Function: CreateTutorWorld
// Address: 1078:5e5e
// Segment: MEMORY_CREATE
// ======================================================================


void CreateTutorWorld(void)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  undefined2 uVar3;
  PLAYER *pPVar4;
  char cVar5;
  char *pcVar6;
  int iVar7;
  undefined2 *puVar8;
  PLAYER *pPVar9;
  PLAYER *pPVar10;
  PLAYER *pPVar11;
  char *pcVar12;
  short i;
  
  _memset((GAME *)&game,0,0x40);
  game.cPlayer = 2;
  game.mdDensity = 0;
  game.mdSize = 0;
  game.mdStartDist = 1;
  game.wCrap = game.wCrap & 0xff17U | 0xe8;
  game.lid._0_2_ = 0xef49;
  game.lid._2_2_ = 0x8c;
  game.rgvc[7] = 0x80;
  game.rgvc[8] = 0x81;
  CchGetString(idsTutorialGame,(char *)game.szName);
  puVar8 = (undefined2 *)&vrgplrDef;
  pPVar9 = (PLAYER *)rgplr;
  for (iVar7 = 0x60; iVar7 != 0; iVar7 = iVar7 + -1) {
    pPVar11 = pPVar9;
    pPVar9 = (PLAYER *)&pPVar9->cPlanet;
    puVar1 = puVar8;
    puVar8 = puVar8 + 1;
    uVar3 = *puVar1;
    pPVar11->iPlayer = (char)uVar3;
    pPVar11->cShDef = (char)((uint)uVar3 >> 8);
  }
  CchGetString(idsHumanoid,(char *)rgplr[0].szName);
  _WSPRINTF((LPSTR)0x5a221120,(LPCSTR)0xa341120,0x5a42);
  pPVar11 = LpplrComp(1,0);
  pPVar9 = (PLAYER *)pPVar11;
  pPVar10 = (PLAYER *)(rgplr + 1);
  for (iVar7 = 0x60; iVar7 != 0; iVar7 = iVar7 + -1) {
    pPVar4 = pPVar10;
    pPVar10 = (PLAYER *)&pPVar10->cPlanet;
    pPVar2 = pPVar9;
    pPVar9 = (PLAYER *)&pPVar9->cPlanet;
    cVar5 = pPVar2->cShDef;
    pPVar4->iPlayer = pPVar2->iPlayer;
    pPVar4->cShDef = cVar5;
  }
  rgplr[1].wMdPlr = rgplr[1].wMdPlr & 0x1ffU | 0x2200;
  CchGetString(idsBerserker,(char *)rgplr[1].szName);
  Randomize(0x499602d2);
  for (i = 1; i < 3; i = i + 1) {
    pcVar12 = (char *)szBase;
    pcVar6 = PszGetCompressedString(idsSHD);
    _WSPRINTF((LPSTR)CONCAT22(pcVar12,(char *)&DAT_1120_1120),
              (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    _remove((char *)szWork);
    pcVar12 = (char *)szBase;
    pcVar6 = PszGetCompressedString(idsSXD);
    _WSPRINTF((LPSTR)CONCAT22(pcVar12,(char *)&DAT_1120_1120),
              (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    _remove((char *)szWork);
  }
  GenerateWorld(0);
  return;
}



// ======================================================================
// Function: NewGameWizard
// Address: 1078:6022
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Restarted to delay deadcode elimination for space: ram */

void NewGameWizard(HWND hwnd,short fReadOnly)

{
  GAME *pGVar1;
  undefined2 *puVar2;
  undefined2 uVar3;
  GAME *pGVar4;
  PLAYER *pPVar5;
  PLAYER *pPVar6;
  bool bVar7;
  char cVar8;
  byte bVar9;
  uint uVar10;
  short sVar11;
  ushort uVar12;
  PLAYER *pPVar13;
  char *pcVar14;
  short sVar15;
  int iVar16;
  GAME *pGVar17;
  GAME *pGVar18;
  undefined2 *puVar19;
  PLAYER *pPVar20;
  undefined2 unaff_SS;
  FARPROC pvVar21;
  PLAYER *pPVar22;
  GAME gameT;
  short lvlAi;
  PLAYER rgplrLocal [16];
  RECT rgrcStack [20];
  short j;
  char szFileLocal [208];
  short fEasy;
  short idAi;
  char szFile [256];
  short c;
  short i;
  short rgplrbmp [16];
  short fIdleSav;
  void *lpProc;
  short mdRet;
  short iStepMaxSoFar;
  
  iStepMaxSoFar = 0;
  bVar7 = false;
  vrgrcRCW = rgrcStack;
  iPanelActive = -1;
  fRCWReadOnly = fReadOnly;
  uVar10 = (uint)gd._0_2_ >> 7 & 1;
  gd._0_2_ = gd._0_2_ & 0xff7f | 0x80;
  vrgplrNew = rgplrLocal;
  vrgszFileNew = szFileLocal;
  vcplrNew = 0;
  _memset((byte *)vrgplrTypeNew,0,0x10);
  if (fReadOnly != 0) {
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) {
        ((byte *)vrgplrTypeNew)[i] = 0x19;
      }
      else {
        ((byte *)vrgplrTypeNew)[i] = (byte)(i << 2) | 2;
        pPVar13 = (PLAYER *)rgplr + i;
        pPVar20 = vrgplrNew + i;
        for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
          pPVar5 = pPVar20;
          pPVar20 = (PLAYER *)&pPVar20->cPlanet;
          pPVar22 = pPVar13;
          pPVar13 = (PLAYER *)&pPVar13->cPlanet;
          cVar8 = pPVar22->cShDef;
          pPVar5->iPlayer = pPVar22->iPlayer;
          pPVar5->cShDef = cVar8;
        }
        vrgszFileNew[i * 0xd] = '\0';
      }
    }
CREATE_Step1_2:
    do {
      pvVar21 = MakeProcInstance(NewGameDlg,hInst);
      sVar11 = DialogBox(0,(LPCSTR)CONCAT22(0x186,hwnd),(HWND)((ulong)pvVar21 >> 0x10),
                         (void *)pvVar21);
      FreeProcInstance(pvVar21);
      if (sVar11 == 0) goto CREATE_Cancel;
      InitNewGamePlr(iStepMaxSoFar,lvlAi);
      if (sVar11 != 3) {
        do {
          pvVar21 = MakeProcInstance(NewGameDlg2,hInst);
          sVar11 = DialogBox(0,(LPCSTR)CONCAT22(0x187,hwnd),(HWND)((ulong)pvVar21 >> 0x10),
                             (void *)pvVar21);
          FreeProcInstance(pvVar21);
          if (sVar11 == 0) goto CREATE_Cancel;
          if (iStepMaxSoFar == 0) {
            iStepMaxSoFar = 1;
          }
          InitNewGamePlr(iStepMaxSoFar,lvlAi);
          if (sVar11 == 1) goto CREATE_Step1_2;
          if (sVar11 == 3) break;
          pvVar21 = MakeProcInstance(NewGameDlg3,hInst);
          sVar11 = DialogBox(0,(LPCSTR)CONCAT22(0x188,hwnd),(HWND)((ulong)pvVar21 >> 0x10),
                             (void *)pvVar21);
          FreeProcInstance(pvVar21);
          if (sVar11 == 0) goto CREATE_Cancel;
          if ((uint)iStepMaxSoFar < 2) {
            iStepMaxSoFar = 2;
          }
        } while (sVar11 == 1);
      }
CREATE_Finish_2:
      if (fRCWReadOnly != 0) goto CREATE_Cancel;
      CchGetString(idsGameXy,szFile);
      sVar11 = FGetNewGameName(szFile);
      if (sVar11 != 0) {
        pGVar17 = (GAME *)&game;
        pGVar18 = &gameT;
        for (iVar16 = 0x20; iVar16 != 0; iVar16 = iVar16 + -1) {
          pGVar4 = pGVar18;
          pGVar18 = (GAME *)((int)&pGVar18->lid + 2);
          pGVar1 = pGVar17;
          pGVar17 = (GAME *)((int)&pGVar17->lid + 2);
          *(int *)&pGVar4->lid = (int)pGVar1->lid;
        }
        gameT.turn = 0;
        DestroyCurGame();
        pGVar18 = &gameT;
        pGVar17 = (GAME *)&game;
        for (iVar16 = 0x20; iVar16 != 0; iVar16 = iVar16 + -1) {
          pGVar4 = pGVar17;
          pGVar17 = (GAME *)((int)&pGVar17->lid + 2);
          pGVar1 = pGVar18;
          pGVar18 = (GAME *)((int)&pGVar18->lid + 2);
          *(int *)&pGVar4->lid = (int)pGVar1->lid;
        }
        _strcpy((char *)szBase,szFile);
        uVar12 = _strlen((char *)szBase);
        *(undefined1 *)((int)rghbrMinSum[3] + 1 + uVar12) = 0;
        for (i = 0; (i < 0x10 && (((byte *)vrgplrTypeNew)[i] != 0)); i = i + 1) {
          bVar9 = ((byte *)vrgplrTypeNew)[i] & 3;
          if (bVar9 == 1) {
            if ((uint)((int)(uint)((byte *)vrgplrTypeNew)[i] >> 2) < 7) {
              c = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 2;
              puVar19 = (undefined2 *)(c * 0xc0 + 0xda2);
              pPVar13 = (PLAYER *)rgplr + i;
              for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
                pPVar22 = pPVar13;
                pPVar13 = (PLAYER *)&pPVar13->cPlanet;
                puVar2 = puVar19;
                puVar19 = puVar19 + 1;
                uVar3 = *puVar2;
                pPVar22->iPlayer = (char)uVar3;
                pPVar22->cShDef = (char)((uint)uVar3 >> 8);
              }
            }
            else {
              c = Random(7);
              puVar19 = (undefined2 *)(c * 0xc0 + 0xda2);
              pPVar13 = (PLAYER *)rgplr + i;
              for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
                pPVar22 = pPVar13;
                pPVar13 = (PLAYER *)&pPVar13->cPlanet;
                puVar2 = puVar19;
                puVar19 = puVar19 + 1;
                uVar3 = *puVar2;
                pPVar22->iPlayer = (char)uVar3;
                pPVar22->cShDef = (char)((uint)uVar3 >> 8);
              }
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xfdff | 0x200;
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xe3ff;
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0x1fff | 0xe000;
              *(undefined2 *)((int)&rgplr[0].lSalt + i * 0xc0) = 0xffff;
              *(undefined2 *)((int)&rgplr[0].lSalt + 2 + i * 0xc0) = 0xffff;
            }
            CchGetString
                      (c + idsHumanoid,(char *)((int)rgplr[0].szName + i * 0xc0));
            _WSPRINTF((LPSTR)CONCAT22(i * 0xc0 + 0x5a22,(char *)&DAT_1120_1120),(LPCSTR)0xab81120,
                      i * 0xc0 + 0x5a42);
          }
          else if (bVar9 == 2) {
            pPVar13 = rgplrLocal + ((int)(uint)((byte *)vrgplrTypeNew)[i] >> 2);
            pPVar20 = (PLAYER *)rgplr + i;
            for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
              pPVar5 = pPVar20;
              pPVar20 = (PLAYER *)&pPVar20->cPlanet;
              pPVar22 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              cVar8 = pPVar22->cShDef;
              pPVar5->iPlayer = pPVar22->iPlayer;
              pPVar5->cShDef = cVar8;
            }
          }
          else if (bVar9 == 3) {
            idAi = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 2 & 7;
            lvlAi = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 5;
            if (3 < (uint)lvlAi) {
              lvlAi = Random(4);
            }
            if (5 < (uint)idAi) {
              idAi = Random(6);
            }
            pPVar22 = LpplrComp(idAi,lvlAi);
            pPVar13 = (PLAYER *)pPVar22;
            pPVar20 = (PLAYER *)rgplr + i;
            for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
              pPVar6 = pPVar20;
              pPVar20 = (PLAYER *)&pPVar20->cPlanet;
              pPVar5 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              cVar8 = pPVar5->cShDef;
              pPVar6->iPlayer = pPVar5->iPlayer;
              pPVar6->cShDef = cVar8;
            }
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xfdff | 0x200;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xe3ff | (lvlAi & 7U) << 10
            ;
            *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0x1fff | idAi << 0xd;
          }
        }
        game.cPlayer = i;
        for (i = 0; i < game.cPlayer; i = i + 1) {
          if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) == 0) &&
             (sVar11 = CAdvantagePoints((PLAYER *)rgplr + i), sVar11 < 0)) {
            pPVar13 = (PLAYER *)rgplr + i;
            puVar19 = (undefined2 *)&vrgplrDef;
            for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
              pPVar22 = pPVar13;
              pPVar13 = (PLAYER *)&pPVar13->cPlanet;
              puVar2 = puVar19;
              puVar19 = puVar19 + 1;
              uVar3 = *puVar2;
              pPVar22->iPlayer = (char)uVar3;
              pPVar22->cShDef = (char)((uint)uVar3 >> 8);
            }
            *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) =
                 *(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 0xffef | 0x10;
          }
          if (*(char *)((int)rgplr[0].szName + i * 0xc0) == '\0') {
            pcVar14 = (char *)((int)rgplr[0].szName + i * 0xc0);
            sVar11 = Random(0x18);
            CchGetString(sVar11 + idsBerserker,pcVar14);
          }
          if (*(char *)((int)rgplr[0].szNames + i * 0xc0) == '\0') {
            _WSPRINTF((LPSTR)CONCAT22(i * 0xc0 + 0x5a22,(char *)&DAT_1120_1120),(LPCSTR)0xabc1120,
                      i * 0xc0 + 0x5a42);
          }
        }
        i = 1;
        do {
          if (game.cPlayer <= i) {
            for (i = 0; i < game.cPlayer; i = i + 1) {
              rgplrbmp[i] = *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 3 & 0x1f;
              if (((rgplrbmp[i] < 0) || (0x1f < rgplrbmp[i])) ||
                 ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 9 & 1) != 0)) {
                rgplrbmp[i] = -1;
              }
            }
            for (i = 1; i < game.cPlayer; i = i + 1) {
              if (rgplrbmp[i] != -1) {
                for (j = 0; (j < i && (rgplrbmp[j] != rgplrbmp[i])); j = j + 1) {
                }
                if (j < i) {
                  sVar15 = Random(2);
                  sVar11 = i;
                  if (sVar15 == 0) {
                    sVar11 = j;
                  }
                  rgplrbmp[sVar11] = -1;
                }
              }
            }
            for (i = 0; i < game.cPlayer; i = i + 1) {
              if (rgplrbmp[i] == -1) {
                sVar11 = Random(0x20);
                rgplrbmp[i] = sVar11;
                while( true ) {
                  for (j = 0; (j < game.cPlayer && ((j == i || (rgplrbmp[i] != rgplrbmp[j])))
                              ); j = j + 1) {
                  }
                  if (j == game.cPlayer) break;
                  rgplrbmp[i] = rgplrbmp[i] + 1;
                  if (0x1f < rgplrbmp[i]) {
                    rgplrbmp[i] = 0;
                  }
                }
              }
            }
            for (i = 0; i < game.cPlayer; i = i + 1) {
              *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) =
                   *(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) & 0xff07 |
                   (rgplrbmp[i] & 0x1fU) << 3;
            }
            if (fFreeingTitle == 0) {
              fFreeingTitle = 1;
              DestroyWindow(hwndTitle);
              hwndTitle = 0;
              ShowWindow(hwndFrame,5);
            }
            GenerateWorld(0);
            if (idPlayer == -1) {
              BringUpHostDlg();
            }
            uVar10 = gd._0_2_ & 0xff7f | uVar10 << 7;
            gd.field0_0x0 = (char)uVar10;
            gd.field1_0x1 = (char)(uVar10 >> 8);
            return;
          }
          j = 0;
          while ((j < i && (sVar11 = _strcmp((char *)((int)rgplr[0].szName +
                                                             i * 0xc0),
                                                     (char *)((int)rgplr[0].szName +
                                                             j * 0xc0)), sVar11 != 0))) {
            j = j + 1;
          }
          if (j < i) {
            c = Random(0x18);
LAB_1078_6a97:
            for (j = 0; j < game.cPlayer; j = j + 1) {
              pcVar14 = PszGetCompressedString(c + idsBerserker);
              sVar11 = _strcmp((char *)((int)rgplr[0].szName + j * 0xc0),pcVar14);
              if (sVar11 == 0) break;
            }
            if (j != game.cPlayer) {
              c = c + 1;
              if (0x17 < c) {
                c = 0;
              }
              goto LAB_1078_6a97;
            }
            CchGetString
                      (c + idsBerserker,(char *)((int)rgplr[0].szName + i * 0xc0));
            _strcpy((char *)((int)rgplr[0].szNames + i * 0xc0),
                            (char *)((int)rgplr[0].szName + i * 0xc0));
            _strcat((char *)((int)rgplr[0].szNames + i * 0xc0),(char *)0xac0);
          }
          i = i + 1;
        } while( true );
      }
      if (bVar7) goto CREATE_Cancel;
    } while( true );
  }
  pGVar17 = (GAME *)&game;
  pGVar18 = &gameT;
  for (iVar16 = 0x20; iVar16 != 0; iVar16 = iVar16 + -1) {
    pGVar4 = pGVar18;
    pGVar18 = (GAME *)((int)&pGVar18->lid + 2);
    pGVar1 = pGVar17;
    pGVar17 = (GAME *)((int)&pGVar17->lid + 2);
    *(int *)&pGVar4->lid = (int)pGVar1->lid;
  }
  _memset((GAME *)&game,0,0x40);
  game.cPlanMax = gameT.cPlanMax;
  game.cPlayer = gameT.cPlayer;
  vrgplrTypeNew[0] = 1;
  vrgplrTypeNew[1] = 0x23;
  vrgplrTypeNew[2] = 0x27;
  vrgplrTypeNew[3] = 0x8b;
  pvVar21 = MakeProcInstance(SimpleNewGameDlg,hInst);
  sVar11 = DialogBox(0,(LPCSTR)CONCAT22(0xd1,hwnd),(HWND)((ulong)pvVar21 >> 0x10),(void *)pvVar21);
  FreeProcInstance(pvVar21);
  game.rgvc[0] = 0x88;
  game.rgvc[1] = 0x8e;
  game.rgvc[2] = 0x82;
  game.rgvc[3] = 10;
  game.rgvc[4] = 0x88;
  game.rgvc[5] = 9;
  game.rgvc[6] = 9;
  game.rgvc[7] = 7;
  game.rgvc[8] = 1;
  if (sVar11 == 2) {
CREATE_Cancel:
    if (fRCWReadOnly == 0) {
      pGVar18 = &gameT;
      pGVar17 = (GAME *)&game;
      for (iVar16 = 0x20; iVar16 != 0; iVar16 = iVar16 + -1) {
        pGVar4 = pGVar17;
        pGVar17 = (GAME *)((int)&pGVar17->lid + 2);
        pGVar1 = pGVar18;
        pGVar18 = (GAME *)((int)&pGVar18->lid + 2);
        *(int *)&pGVar4->lid = (int)pGVar1->lid;
      }
    }
    gd._0_2_ = gd._0_2_ & 0xff7f | uVar10 << 7;
  }
  else {
    if (sVar11 != 0xd4) {
      if ((sVar11 == 0x430) || (sVar11 == 0xd3)) {
        _memset((byte *)vrgplrTypeNew,0,0x10);
        if ((uint)game.turn < 7) {
          vrgplrTypeNew[0] = (byte)((game.turn & 0xffU) << 2) | 1;
        }
        else {
          vrgplrTypeNew[0] = 2;
          *vrgszFileNew = '\0';
          vcplrNew = 1;
        }
        sVar15 = game.mdDensity;
        lvlAi = game.mdDensity;
        InitNewGamePlr(0,game.mdDensity);
        game.mdDensity = 1;
        if (sVar15 < 2) {
          game.mdStartDist = 1;
        }
        else {
          game.mdStartDist = 2;
        }
        game.wCrap = game.wCrap & 0xff0cU | (uint)(sVar15 == 3) << 4;
        CchGetString(sVar15 * 5 + 0x1cb + game.mdSize,(char *)game.szName);
        if (sVar11 == 0x430) {
          bVar7 = true;
          goto CREATE_Finish_2;
        }
      }
      goto CREATE_Step1_2;
    }
    pGVar18 = &gameT;
    pGVar17 = (GAME *)&game;
    for (iVar16 = 0x20; iVar16 != 0; iVar16 = iVar16 + -1) {
      pGVar4 = pGVar17;
      pGVar17 = (GAME *)((int)&pGVar17->lid + 2);
      pGVar1 = pGVar18;
      pGVar18 = (GAME *)((int)&pGVar18->lid + 2);
      *(int *)&pGVar4->lid = (int)pGVar1->lid;
    }
    StartTutor(0);
    gd._0_2_ = gd._0_2_ & 0xff7f | uVar10 << 7;
  }
  return;
}



// ======================================================================
// Function: InitNewGamePlr
// Address: 1078:6e44
// Segment: MEMORY_CREATE
// ======================================================================


void InitNewGamePlr(short iStepMaxSoFar,short lvlAi)

{
  byte bVar1;
  short sVar2;
  byte ch;
  short c;
  short i;
  
  if (((iStepMaxSoFar < 2) && (fRCWReadOnly == 0)) &&
     (SetVCVal((GAME *)&game,9,game.mdSize << 1), iStepMaxSoFar < 1)) {
    if (game.mdSize == 0) {
      if ((lvlAi == 3) && (sVar2 = Random(3), sVar2 == 0)) {
        game.cPlayer = 3;
      }
      else {
        game.cPlayer = 2;
      }
    }
    else if (game.mdSize == 1) {
      if ((lvlAi == 3) && (sVar2 = Random(4), sVar2 == 0)) {
        game.cPlayer = 5;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(6 - lvlAi), sVar2 != 0)) {
        game.cPlayer = 3;
      }
      else {
        game.cPlayer = 4;
      }
    }
    else if (game.mdSize == 2) {
      if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        game.cPlayer = 9;
      }
      else if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        game.cPlayer = 5;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
        if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
          game.cPlayer = 7;
        }
        else {
          game.cPlayer = 6;
        }
      }
      else {
        game.cPlayer = 8;
      }
    }
    else if (game.mdSize == 3) {
      if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        sVar2 = Random(2);
        game.cPlayer = sVar2 + 0xe;
      }
      else if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        sVar2 = Random(2);
        game.cPlayer = 10 - sVar2;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
        if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
          game.cPlayer = 0xc;
        }
        else {
          game.cPlayer = 0xb;
        }
      }
      else {
        game.cPlayer = 0xd;
      }
    }
    else if (game.mdSize == 4) {
      if ((lvlAi == 3) && (sVar2 = Random(10), sVar2 == 0)) {
        sVar2 = Random(3);
        game.cPlayer = 0xd - sVar2;
      }
      else if ((lvlAi < 2) || (sVar2 = Random(9 - lvlAi), sVar2 != 0)) {
        if ((lvlAi < 2) || (sVar2 = Random(7 - lvlAi), sVar2 != 0)) {
          game.cPlayer = 0x10;
        }
        else {
          game.cPlayer = 0xf;
        }
      }
      else {
        game.cPlayer = 0xe;
      }
    }
    i = 1;
    if (lvlAi == 0) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < (game.cPlayer + 1) / 3 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0xb;
        }
        else if (i < ((game.cPlayer + 1) * 2) / 3 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0xf;
        }
        else if (i < ((game.cPlayer + 1) * 5) / 6 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 7;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x1b;
        }
      }
    }
    else if (lvlAi == 1) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < ((game.cPlayer + 5) * 2) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x27;
        }
        else if (i < ((game.cPlayer + -1) * 3 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x23;
        }
        else if (i < ((game.cPlayer + -1) * 4 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x2b;
        }
        else if (i < ((game.cPlayer + -1) * 5 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x2f;
        }
        else if (i < ((game.cPlayer + -1) * 6 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x33;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x9b;
        }
      }
    }
    else if (lvlAi == 2) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < ((game.cPlayer + 5) * 2) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x53;
        }
        else if (i < ((game.cPlayer + -1) * 3 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x47;
        }
        else if (i < ((game.cPlayer + -1) * 4 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x43;
        }
        else if (i < ((game.cPlayer + -1) * 5 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x57;
        }
        else if (i < ((game.cPlayer + -1) * 6 + 6) / 7 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x5b;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x9b;
        }
      }
    }
    else if (lvlAi == 3) {
      for (; i < game.cPlayer; i = i + 1) {
        if (i < (game.cPlayer + 1) / 3 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 99;
        }
        else if (i < ((game.cPlayer + -1) * 6 + 0xb) / 0xc + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x77;
        }
        else if (i < ((game.cPlayer + -1) * 5 + 5) / 6 + 1) {
          ((byte *)vrgplrTypeNew)[i] = 0x73;
        }
        else {
          ((byte *)vrgplrTypeNew)[i] = 0x7b;
        }
      }
    }
    for (i = 1; i < game.cPlayer + -1; i = i + 1) {
      sVar2 = Random((game.cPlayer - i) + -1);
      bVar1 = ((byte *)vrgplrTypeNew)[i];
      ((byte *)vrgplrTypeNew)[i] = ((byte *)vrgplrTypeNew + 1)[sVar2 + i];
      ((byte *)vrgplrTypeNew + 1)[sVar2 + i] = bVar1;
    }
  }
  return;
}



// ======================================================================
// Function: InitNewGame3
// Address: 1078:74f8
// Segment: MEMORY_CREATE
// ======================================================================


void InitNewGame3(void)

{
  return;
}



// ======================================================================
// Function: FGetNewGameName
// Address: 1078:7508
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Variable defined which should be unmapped: ofn */

short FGetNewGameName(char *szFileSuggest)

{
  int iVar1;
  short sVar2;
  OFN ofn;
  char szFilter [256];
  char szFile [256];
  char szFileTitle [256];
  ushort i;
  char szXY [3];
  
  if (szFileSuggest == (char *)0x0) {
    szFile[0] = '\0';
  }
  else {
    _strcpy(szFile,szFileSuggest);
  }
  CchGetString(idsStarsGameFilesXy,szFilter);
  for (i = 0; szFilter[i] != '\0'; i = i + 1) {
    if (szFilter[i] == '|') {
      szFilter[i] = '\0';
    }
  }
  _memset(&ofn,0,0x48);
  szXY[0] = 'x';
  szXY[1] = 'y';
  szXY[2] = '\0';
  ofn.lStructSize._0_2_ = 0x48;
  ofn.lStructSize._2_2_ = 0;
  ofn.hwndOwner = hwndFrame;
  ofn.lpstrFilter._0_2_ = szFilter;
  ofn.nFilterIndex._0_2_ = 1;
  ofn.nFilterIndex._2_2_ = 0;
  ofn.lpstrFile._0_2_ = szFile;
  ofn.nMaxFile._0_2_ = 0x100;
  ofn.nMaxFile._2_2_ = 0;
  ofn.lpstrFileTitle._0_2_ = szFileTitle;
  ofn.nMaxFileTitle._0_2_ = 0x100;
  ofn.nMaxFileTitle._2_2_ = 0;
  ofn.lpstrInitialDir._0_2_ = (char *)szDirName;
  ofn.lpstrInitialDir._2_2_ = (undefined1 *)&DAT_1120_1120;
  ofn.lpstrTitle._0_2_ = (char *)s_Choose_New_Game_Name_1120_0ac2;
  ofn.lpstrTitle._2_2_ = (undefined1 *)&DAT_1120_1120;
  ofn.lpstrDefExt._0_2_ = szXY;
  ofn.Flags._0_2_ = 0x8806;
  ofn.Flags._2_2_ = 0;
  iVar1 = GetSaveFileName(0x1118,&ofn);
  if (iVar1 == 0) {
    sVar2 = 0;
  }
  else {
    if (ofn.nFileExtension == 0) {
      _strcat(szFile,szXY);
    }
    else {
      _strcpy(szFile + ofn.nFileExtension,szXY);
    }
    _strcpy(szFileSuggest,szFile);
    sVar2 = 1;
  }
  return sVar2;
}



// ======================================================================
// Function: SimpleNewGameDlg
// Address: 1078:76aa
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Variable defined which should be unmapped: ps */
/* WARNING: Removing unreachable block (ram,0x10787db7) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short SimpleNewGameDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  undefined2 uVar3;
  PLAYER *pPVar4;
  char cVar5;
  char *pcVar6;
  HWND HVar7;
  short sVar8;
  int iVar9;
  undefined2 unaff_SI;
  undefined2 *puVar10;
  PLAYER *pPVar11;
  undefined2 unaff_DI;
  PLAYER *pPVar12;
  undefined2 unaff_SS;
  ulong uVar13;
  LRESULT LVar14;
  WPARAM WVar15;
  UINT UVar16;
  PAINTSTRUCT ps;
  short c;
  short dy;
  int iStack_18;
  RECT *pRStack_16;
  short sStack_14;
  RECT *prcSav;
  HWND hwndDD_2;
  RECT rc;
  short i;
  
  uVar13 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hwndDD_2 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    HVar7 = GetDlgItem(hwnd,200);
    GetWindowRect(HVar7,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8));
    HVar7 = GetDlgItem(hwnd,0xcb);
    GetWindowRect(HVar7,(undefined2 *)CONCAT22(unaff_SS,&rc));
    ScreenToClient(hwnd,(short *)CONCAT22(unaff_SS,&rc.right));
    sStack_14 = rc.right;
    prcSav = (RECT *)rc.bottom;
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hwndDD_2,rghfontArial8[1]);
    SetBkColor(hwndDD_2,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar8 = CchGetString(idsDifficultyLevel,(char *)szWork);
    TextOut(hwndDD_2,iStack_18 + 8,(int)pRStack_16 - (dyArial8 >> 1),szWork,
            sVar8);
    HVar7 = GetDlgItem(hwnd,1000);
    GetWindowRect(HVar7,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8));
    HVar7 = GetDlgItem(hwnd,0x3ec);
    GetWindowRect(HVar7,(undefined2 *)CONCAT22(unaff_SS,&rc));
    ScreenToClient(hwnd,(short *)CONCAT22(unaff_SS,&rc.right));
    sStack_14 = rc.right;
    prcSav = (RECT *)rc.bottom;
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(hwndDD_2,rghfontArial8[1]);
    sVar8 = CchGetString(idsUniverseSize,(char *)szWork);
    TextOut(hwndDD_2,iStack_18 + 8,(int)pRStack_16 - (dyArial8 >> 1),szWork,
            sVar8);
    pRStack_16 = prcSav + 1;
    HVar7 = GetDlgItem(hwnd,0x81a);
    GetWindowRect(HVar7,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8));
    MapWindowPoints(0,hwnd,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8),2);
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    prcSav = (RECT *)(&prcSav->left + dyArial8);
    _Draw3dFrame();
    SelectObject(hwndDD_2,rghfontArial8[1]);
    sVar8 = CchGetString(idsPlayerRace,(char *)szWork);
    TextOut(hwndDD_2,iStack_18 + 8,(int)pRStack_16 - (dyArial8 >> 1),szWork,
            sVar8);
    pRStack_16 = (RECT *)((int)&prcSav->left + dyArial8 * 3);
    prcSav = (RECT *)0x3e8;
    ExpandRc((RECT *)&stack0xffe8,-dyArial8,0);
    sVar8 = CchGetString
                      (idsButtonAllowsConfigureMultiPlayerGamesCustom,(char *)szWork);
    sVar8 = DRAWTEXT(hwndDD_2,szWork,sVar8,(undefined2 *)CONCAT22(unaff_SS,&stack0xffe8),
                     0x810);
    HVar7 = GetDlgItem(hwnd,0xd3);
    SetWindowPos(HVar7,0,iStack_18,(int)pRStack_16 + sVar8 + dyArial8 / 2,0,0,5);
    prcSav = (RECT *)((int)pRStack_16 + sVar8 + dyArial8 * 2);
    ExpandRc((RECT *)&stack0xffe8,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    sVar8 = CchGetString(idsAdvancedGame,(char *)szWork);
    TextOut(hwndDD_2,iStack_18 + 8,(int)pRStack_16 - (dyArial8 >> 1),szWork,
            sVar8);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    sVar8 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    sVar8 = 1;
  }
  else {
    if (message == WM_CTLCOLOR) {
      for (i = 200; i < 0xcc; i = i + 1) {
        hwndDD_2 = (HWND)lParam;
        HVar7 = GetDlgItem(hwnd,i);
        if (hwndDD_2 == HVar7) {
          i = -1;
          break;
        }
      }
      if (i != -1) {
        for (i = 1000; i < 0x3ed; i = i + 1) {
          hwndDD_2 = (HWND)lParam;
          HVar7 = GetDlgItem(hwnd,i);
          if (hwndDD_2 == HVar7) {
            i = -1;
            break;
          }
        }
      }
      if ((i == -1) || (uVar13 = __aFulshr(uVar13,ps.hdc), (int)uVar13 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        CheckRadioButton(hwnd,200,0xcb,0xc9);
        CheckRadioButton(hwnd,1000,0x3ec,0x3e9);
        hwndDD_2 = GetDlgItem(hwnd,0x81a);
        SendMessage(hwndDD_2,0x40b,0,0);
        for (i = 0; i < 7; i = i + 1) {
          UVar16 = 0x403;
          WVar15 = 0;
          HVar7 = hwndDD_2;
          pcVar6 = PszGetCompressedString(i + idsHumanoid);
          SendMessage(HVar7,UVar16,WVar15,(LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar6));
        }
        SendMessage(hwndDD_2,0x40e,0,0);
        StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
        return 1;
      }
      if (message == WM_COMMAND) {
        if (((wParam == 0x430) || (wParam == 2)) || (wParam == 0xd3)) {
          i = 200;
          while ((i < 0xcc && (UVar16 = IsDlgButtonChecked(hwnd,i), UVar16 == 0))) {
            i = i + 1;
          }
          game.mdDensity = i + -200;
          i = 1000;
          while ((i < 0x3ed && (UVar16 = IsDlgButtonChecked(hwnd,i), UVar16 == 0))) {
            i = i + 1;
          }
          game.mdSize = i + -1000;
          HVar7 = GetDlgItem(hwnd,0x81a);
          LVar14 = SendMessage(HVar7,0x407,0,0);
          game.turn = (short)LVar14;
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,wParam);
          return 1;
        }
        if (wParam == 0xd4) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,0xd4);
          return 1;
        }
        if (wParam == 0xd2) {
          hwndDD_2 = GetDlgItem(hwnd,0x81a);
          LVar14 = SendMessage(hwndDD_2,0x407,0,0);
          game.turn = (short)LVar14;
          if ((uint)game.turn < 7) {
            puVar10 = (undefined2 *)(game.turn * 0xc0 + 0xda2);
            pPVar11 = (PLAYER *)&vplr;
            for (iVar9 = 0x60; iVar9 != 0; iVar9 = iVar9 + -1) {
              pPVar2 = pPVar11;
              pPVar11 = (PLAYER *)&pPVar11->cPlanet;
              puVar1 = puVar10;
              puVar10 = puVar10 + 1;
              uVar3 = *puVar1;
              pPVar2->iPlayer = (char)uVar3;
              pPVar2->cShDef = (char)((uint)uVar3 >> 8);
            }
            CchGetString(game.turn + idsHumanoid,(char *)vplr.szName);
            _WSPRINTF((LPSTR)0x501a1120,(LPCSTR)0xadc1120,0x503a);
          }
          else {
            pPVar12 = (PLAYER *)&vplr;
            pPVar11 = vrgplrNew;
            for (iVar9 = 0x60; iVar9 != 0; iVar9 = iVar9 + -1) {
              pPVar4 = pPVar12;
              pPVar12 = (PLAYER *)&pPVar12->cPlanet;
              pPVar2 = pPVar11;
              pPVar11 = (PLAYER *)&pPVar11->cPlanet;
              cVar5 = pPVar2->cShDef;
              pPVar4->iPlayer = pPVar2->iPlayer;
              pPVar4->cShDef = cVar5;
            }
          }
          prcSav = vrgrcRCW;
          sVar8 = RaceCreationWizard(hwnd,0,1);
          if (sVar8 != 0) {
            LVar14 = SendMessage(hwndDD_2,0x406,0,0);
            if (7 < LVar14) {
              SendMessage(hwndDD_2,0x404,7,0);
            }
            SendMessage(hwndDD_2,0x403,0,0x1120501a);
            SendMessage(hwndDD_2,0x40e,7,0);
            pPVar11 = (PLAYER *)&vplr;
            pPVar12 = vrgplrNew;
            for (iVar9 = 0x60; iVar9 != 0; iVar9 = iVar9 + -1) {
              pPVar4 = pPVar12;
              pPVar12 = (PLAYER *)&pPVar12->cPlanet;
              pPVar2 = pPVar11;
              pPVar11 = (PLAYER *)&pPVar11->cPlanet;
              cVar5 = pPVar2->cShDef;
              pPVar4->iPlayer = pPVar2->iPlayer;
              pPVar4->cShDef = cVar5;
            }
          }
          vrgrcRCW = prcSav;
          SetFocus(hwnd);
        }
        else if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0x3ea);
          return 1;
        }
      }
    }
    sVar8 = 0;
  }
  return sVar8;
}



// ======================================================================
// Function: NewGameDlg
// Address: 1078:7e92
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Variable defined which should be unmapped: ps */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short NewGameDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  HDC HVar1;
  HWND HVar2;
  short sVar3;
  UINT UVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar5;
  PAINTSTRUCT ps;
  short c;
  RECT rcGBox;
  short iRet;
  RECT rc;
  short i;
  
  uVar5 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    HVar1 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    HVar2 = GetDlgItem(hwnd,1000);
    GetWindowRect(HVar2,(undefined2 *)CONCAT22(unaff_SS,&rcGBox));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcGBox));
    HVar2 = GetDlgItem(hwnd,0x3ec);
    GetWindowRect(HVar2,(undefined2 *)CONCAT22(unaff_SS,&rc));
    ScreenToClient(hwnd,(short *)CONCAT22(unaff_SS,&rc.right));
    rcGBox.right = rc.right;
    rcGBox.bottom = rc.bottom;
    ExpandRc(&rcGBox,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(HVar1,rghfontArial8[1]);
    SetBkColor(HVar1,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar3 = CchGetString(idsUniverseSize,(char *)szWork);
    TextOut(HVar1,rcGBox.left + 8,rcGBox.top - (dyArial8 >> 1),szWork,sVar3);
    HVar2 = GetDlgItem(hwnd,0x3ed);
    GetWindowRect(HVar2,(undefined2 *)CONCAT22(unaff_SS,&rcGBox));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcGBox));
    HVar2 = GetDlgItem(hwnd,0x3f0);
    GetWindowRect(HVar2,(undefined2 *)CONCAT22(unaff_SS,&rc));
    ScreenToClient(hwnd,(short *)CONCAT22(unaff_SS,&rc.right));
    rcGBox.right = rc.right;
    rcGBox.bottom = rc.bottom;
    ExpandRc(&rcGBox,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(HVar1,rghfontArial8[1]);
    SetBkColor(HVar1,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar3 = CchGetString(idsDensity,(char *)szWork);
    TextOut(HVar1,rcGBox.left + 8,rcGBox.top - (dyArial8 >> 1),szWork,sVar3);
    HVar2 = GetDlgItem(hwnd,0x3f1);
    GetWindowRect(HVar2,(undefined2 *)CONCAT22(unaff_SS,&rcGBox));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcGBox));
    HVar2 = GetDlgItem(hwnd,0x3f4);
    GetWindowRect(HVar2,(undefined2 *)CONCAT22(unaff_SS,&rc));
    ScreenToClient(hwnd,(short *)CONCAT22(unaff_SS,&rc.right));
    rcGBox.right = rc.right;
    rcGBox.bottom = rc.bottom;
    ExpandRc(&rcGBox,dyArial8,dyArial8 >> 1);
    _Draw3dFrame();
    SelectObject(HVar1,rghfontArial8[1]);
    SetBkColor(HVar1,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    sVar3 = CchGetString(idsPlayerPositions,(char *)szWork);
    TextOut(HVar1,rcGBox.left + 8,rcGBox.top - (dyArial8 >> 1),szWork,sVar3);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    sVar3 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    sVar3 = 1;
  }
  else {
    if (message == WM_CTLCOLOR) {
      i = 1000;
      while ((i < 0x3fe && (HVar2 = GetDlgItem(hwnd,i), (HWND)lParam != HVar2))) {
        i = i + 1;
      }
      if (((i < 0x3fe) || (uVar5 = __aFulshr(uVar5,ps.hdc), (int)uVar5 == 6)) ||
         (HVar2 = GetDlgItem(hwnd,0x41a), (HWND)lParam == HVar2)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        SetNGWTitle(hwnd,1);
        CheckRadioButton(hwnd,1000,0x3ec,game.mdSize + 1000);
        CheckRadioButton(hwnd,0x3ed,0x3f0,game.mdDensity + 0x3ed);
        CheckRadioButton(hwnd,0x3f1,0x3f4,game.mdStartDist + 0x3f1);
        HVar2 = GetDlgItem(hwnd,0x406);
        SetWindowText(HVar2,game.szName);
        SendDlgItemMessage(hwnd,0x406,0x415,0x1f,0);
        HVar2 = GetDlgItem(hwnd,0x3f8);
        uVar5 = CONCAT22(0x401,game.wCrap) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        HVar2 = GetDlgItem(hwnd,0x3f9);
        uVar5 = CONCAT22(0x401,(uint)game.wCrap >> 1) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        HVar2 = GetDlgItem(hwnd,0x3fa);
        uVar5 = CONCAT22(0x401,(uint)game.wCrap >> 5) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        HVar2 = GetDlgItem(hwnd,0x3fb);
        uVar5 = CONCAT22(0x401,(uint)game.wCrap >> 7) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        HVar2 = GetDlgItem(hwnd,0x3fc);
        uVar5 = CONCAT22(0x401,(uint)game.wCrap >> 4) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        HVar2 = GetDlgItem(hwnd,0x3fd);
        uVar5 = CONCAT22(0x401,(uint)game.wCrap >> 6) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        HVar2 = GetDlgItem(hwnd,0x41a);
        uVar5 = CONCAT22(0x401,(uint)game.wCrap >> 8) & 0xffff0001;
        SendMessage(HVar2,(UINT)(uVar5 >> 0x10),(WPARAM)uVar5,0);
        if (fRCWReadOnly != 0) {
          for (i = 1000; i < 0x3ed; i = i + 1) {
            HVar2 = GetDlgItem(hwnd,i);
            EnableWindow(HVar2,0);
          }
          for (i = 0x3ed; i < 0x3f1; i = i + 1) {
            HVar2 = GetDlgItem(hwnd,i);
            EnableWindow(HVar2,0);
          }
          for (i = 0x3f1; i < 0x3f5; i = i + 1) {
            HVar2 = GetDlgItem(hwnd,i);
            EnableWindow(HVar2,0);
          }
          HVar2 = GetDlgItem(hwnd,0x3f8);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x3f9);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x3fa);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x3fb);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x41a);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x3fc);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x406);
          EnableWindow(HVar2,0);
          HVar2 = GetDlgItem(hwnd,0x3fd);
          EnableWindow(HVar2,0);
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0x3f4);
          return 1;
        }
        for (iRet = 0; (iRet < 4 && (wParam != ((undefined2 *)&rgidRaceBtn)[iRet]));
            iRet = iRet + 1) {
        }
        if (iRet < 4) {
          if (iRet != 0) {
            i = 1000;
            while ((i < 0x3ed && (UVar4 = IsDlgButtonChecked(hwnd,i), UVar4 == 0))) {
              i = i + 1;
            }
            game.mdSize = i + -1000;
            i = 0x3ed;
            while ((i < 0x3f1 && (UVar4 = IsDlgButtonChecked(hwnd,i), UVar4 == 0))) {
              i = i + 1;
            }
            game.mdDensity = i + -0x3ed;
            i = 0x3f1;
            while ((i < 0x3f5 && (UVar4 = IsDlgButtonChecked(hwnd,i), UVar4 == 0))) {
              i = i + 1;
            }
            game.mdStartDist = i + -0x3f1;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3f8);
            game.wCrap = game.wCrap & 0xfffeU | rcGBox.bottom & 1U;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3f9);
            game.wCrap = game.wCrap & 0xfffdU | (rcGBox.bottom & 1U) << 1;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fa);
            game.wCrap = game.wCrap & 0xffdfU | (rcGBox.bottom & 1U) << 5;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fb);
            game.wCrap = game.wCrap & 0xff7fU | (rcGBox.bottom & 1U) << 7;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fc);
            game.wCrap = game.wCrap & 0xffefU | (rcGBox.bottom & 1U) << 4;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x3fd);
            game.wCrap = game.wCrap & 0xffbfU | (rcGBox.bottom & 1U) << 6;
            rcGBox.bottom = IsDlgButtonChecked(hwnd,0x41a);
            game.wCrap = game.wCrap & 0xfeffU | (rcGBox.bottom & 1U) << 8;
            HVar2 = GetDlgItem(hwnd,0x406);
            sVar3 = GetWindowText(HVar2,game.szName,0x20);
            if (sVar3 == 0) {
              _strcpy((char *)game.szName,(char *)szBase);
            }
          }
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,iRet);
          return 1;
        }
      }
    }
    sVar3 = 0;
  }
  return sVar3;
}



// ======================================================================
// Function: NewGameDlg2
// Address: 1078:87d2
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Variable defined which should be unmapped: prcSav_2 */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short NewGameDlg2(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  undefined2 *puVar1;
  PLAYER *pPVar2;
  undefined2 uVar3;
  PLAYER *pPVar4;
  byte bVar5;
  char cVar6;
  RECT *pRVar7;
  HWND HVar8;
  uint uVar9;
  UINT UVar10;
  HMENU HVar11;
  uint uVar12;
  BOOL BVar13;
  HDC hdc_00;
  char *pcVar14;
  int iVar15;
  int iVar16;
  undefined2 unaff_SI;
  PLAYER *pPVar17;
  undefined2 *puVar18;
  undefined2 unaff_DI;
  PLAYER *pPVar19;
  undefined2 unaff_SS;
  ulong uVar20;
  UINT UVar21;
  HMENU HVar22;
  HMENU HVar23;
  short sVar24;
  RECT *prcSav_2;
  short iCurVal;
  short iDiamond_2;
  MSG msg;
  HMENU hmenuPopup;
  HMENU aHStack_3a [5];
  PAINTSTRUCT ps;
  HDC hdc;
  RECT rc;
  short i;
  
  uVar20 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hdc_00 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    DrawNewGame2(hwnd,hdc_00,-1);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    return 1;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    return 1;
  }
  if (message == WM_CTLCOLOR) {
    i = 0x191;
    while ((i < 0x1c1 && (HVar8 = GetDlgItem(hwnd,i), (HWND)lParam != HVar8))) {
      i = i + 1;
    }
    if ((0x1c0 < i) && (uVar20 = __aFulshr(uVar20,(ushort)prcSav_2), (int)uVar20 != 6)) {
      return 0;
    }
    SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
    return hbrButtonFace;
  }
  if (message == WM_SETCURSOR) {
    if (fRCWReadOnly != 0) {
      return 0;
    }
    GetCursorPos((undefined2 *)CONCAT22(unaff_SS,ps.rgbReserved + 0xe));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,ps.rgbReserved + 0xe));
    if ((int)ps.rgbReserved._14_2_ < xNewGameDiamond) {
      return 0;
    }
    if (xNewGameDiamond + dyArial8 + 1 <= (int)ps.rgbReserved._14_2_) {
      return 0;
    }
    if ((int)hdc < 6) {
      return 0;
    }
    ps.rgbReserved._12_2_ = (int)(hdc - 6) / (dyArial8 + 4);
    if (0xf < (int)ps.rgbReserved._12_2_) {
      return 0;
    }
    if (dyArial8 + 1 <= (int)(hdc - 6) % (dyArial8 + 4)) {
      return 0;
    }
    setcursor(hcurHand);
    return 1;
  }
  if (message == WM_INITDIALOG) {
    SetNGWTitle(hwnd,2);
    ps.rgbReserved._6_2_ = (dyArial8 + 4) * 0x10 + 8;
    HVar8 = GetDlgItem(hwnd,rgidRaceBtn);
    GetWindowRect(HVar8,(undefined2 *)CONCAT22(unaff_SS,&rc));
    ps.rgbReserved._8_2_ = rc.bottom - rc.top;
    GetWindowRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,ps.rgbReserved + 10));
    ps.rgbReserved._4_2_ = hdc - ps.rgbReserved._12_2_;
    if ((int)ps.rgbReserved._4_2_ < ps.rgbReserved._6_2_ + ps.rgbReserved._8_2_ + 6) {
      for (i = 0; i < 5; i = i + 1) {
        ps.rgbReserved._2_2_ = GetDlgItem(hwnd,((undefined2 *)&rgidRaceBtn)[i]);
        GetWindowRect(ps.rgbReserved._2_2_,(undefined2 *)CONCAT22(unaff_SS,&rc));
        MapWindowPoints(0,hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc),2);
        OffsetRect((undefined2 *)CONCAT22(unaff_SS,&rc),0,ps.rgbReserved._6_2_ - rc.top);
        SetWindowPos(ps.rgbReserved._2_2_,0,rc.left,rc.top,0,0,5);
      }
      ps.rgbReserved._6_2_ = rc.bottom + 6;
      GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
      if ((int)ps.rgbReserved._4_2_ < (int)ps.rgbReserved._6_2_) {
        SetWindowPos(hwnd,0,0,0,ps.rgbReserved._14_2_ - ps.rgbReserved._10_2_,
                     ((ps.rgbReserved._6_2_ + hdc) - ps.rgbReserved._12_2_) - rc.bottom,6);
      }
    }
    StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
    return 1;
  }
  if (message == WM_COMMAND) {
    if (wParam == 0x76) {
      WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0x3fc);
      return 1;
    }
    for (i = 0; (i < 4 && (wParam != ((undefined2 *)&rgidRaceBtn)[i])); i = i + 1) {
    }
    if (3 < i) {
      return 0;
    }
    if (((i != 0) && (vrgplrTypeNew[0] == 0)) && (fRCWReadOnly == 0)) {
      sVar24 = 0x10;
      pcVar14 = PszFormatIds(idsMustHaveLeastOnePlayerGame,(short *)0x0);
      AlertSz(pcVar14,sVar24);
      return 0;
    }
    StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
    EndDialog(hwnd,i);
    return 1;
  }
  if ((message != WM_LBUTTONDOWN) && (message != WM_RBUTTONDOWN)) {
    return 0;
  }
  if (fRCWReadOnly != 0) {
    return 0;
  }
  ps.rgbReserved[0xc] = (undefined1)lParam;
  ps.rgbReserved[0xd] = lParam._1_1_;
  uVar20 = __aFulshr(uVar20,(ushort)prcSav_2);
  ps.rgbReserved._14_2_ = SUB42(uVar20,0);
  if ((int)ps.rgbReserved._12_2_ < xNewGameDiamond) {
    return 0;
  }
  if (xNewGameDiamond + dyArial8 + 1 <= (int)ps.rgbReserved._12_2_) {
    return 0;
  }
  if ((int)ps.rgbReserved._14_2_ < 6) {
    return 0;
  }
  iDiamond_2 = (ps.rgbReserved._14_2_ + -6) / (dyArial8 + 4);
  if (0xf < iDiamond_2) {
    return 0;
  }
  if (dyArial8 + 1 <= (ps.rgbReserved._14_2_ + -6) % (dyArial8 + 4)) {
    return 0;
  }
  bVar5 = ((byte *)vrgplrTypeNew)[iDiamond_2];
  uVar9 = (uint)bVar5;
  ClientToScreen(hwnd,(undefined2 *)CONCAT22(unaff_SS,ps.rgbReserved + 0xc));
  aHStack_3a[0] = CreatePopupMenu();
  ps.rgbReserved[10] = 0;
  ps.rgbReserved[0xb] = 0;
  for (; (int)ps.rgbReserved._10_2_ < 6; ps.rgbReserved._10_2_ = ps.rgbReserved._10_2_ + 1) {
    if (uVar9 == ps.rgbReserved._10_2_ * 4 + 1U) {
      ps.rgbReserved[2] = 8;
      ps.rgbReserved[3] = 0;
    }
    else {
      ps.rgbReserved[2] = 0;
      ps.rgbReserved[3] = 0;
    }
    ps.rgbReserved._6_2_ = PszGetCompressedString(ps.rgbReserved._10_2_ + idsHumanoid);
    AppendMenu(aHStack_3a[0],ps.rgbReserved._2_2_,ps.rgbReserved._10_2_ + 0x3aa8,
               (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,ps.rgbReserved._6_2_));
  }
  UVar10 = ps.rgbReserved._10_2_ + 0x3aa8;
  UVar21 = ps.rgbReserved._2_2_;
  HVar11 = aHStack_3a[0];
  pcVar14 = PszGetCompressedString(idsRandom);
  AppendMenu(HVar11,UVar21,UVar10,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  UVar10 = ps.rgbReserved._10_2_ + 0x3aa9;
  UVar21 = ps.rgbReserved._2_2_;
  HVar11 = aHStack_3a[0];
  pcVar14 = PszGetCompressedString(idsExpansionPlayer);
  AppendMenu(HVar11,UVar21,UVar10,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  HVar11 = CreatePopupMenu();
  UVar10 = 0;
  UVar21 = 15000;
  aHStack_3a[1] = HVar11;
  pcVar14 = PszGetCompressedString(idsNew);
  AppendMenu(HVar11,UVar10,UVar21,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  UVar10 = 0;
  UVar21 = 0x3a99;
  HVar11 = aHStack_3a[1];
  pcVar14 = PszGetCompressedString(idsOpen);
  AppendMenu(HVar11,UVar10,UVar21,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  ps.rgbReserved[10] = 0;
  ps.rgbReserved[0xb] = 0;
  for (; (int)ps.rgbReserved._10_2_ < vcplrNew;
      ps.rgbReserved._10_2_ = ps.rgbReserved._10_2_ + 1) {
    if (uVar9 == ps.rgbReserved._10_2_ * 4 + 2U) {
      ps.rgbReserved[2] = 8;
      ps.rgbReserved[3] = 0;
    }
    else {
      ps.rgbReserved[2] = 0;
      ps.rgbReserved[3] = 0;
    }
    ps.rgbReserved._6_2_ =
         PszPlayerName(0,1,1,1,0,vrgplrNew + ps.rgbReserved._10_2_);
    AppendMenu(aHStack_3a[1],ps.rgbReserved._2_2_,ps.rgbReserved._10_2_ + 0x3ab8,
               (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,ps.rgbReserved._6_2_));
  }
  aHStack_3a[2] = CreatePopupMenu();
  ps.rgbReserved[10] = 0;
  ps.rgbReserved[0xb] = 0;
  for (; (int)ps.rgbReserved._10_2_ < 7; ps.rgbReserved._10_2_ = ps.rgbReserved._10_2_ + 1) {
    HVar11 = CreatePopupMenu();
    aHStack_3a[ps.rgbReserved._10_2_ + 5] = HVar11;
    ps.rgbReserved[8] = 0;
    ps.rgbReserved[9] = 0;
    for (; (int)ps.rgbReserved._8_2_ < 5; ps.rgbReserved._8_2_ = ps.rgbReserved._8_2_ + 1) {
      if (uVar9 == ps.rgbReserved._8_2_ * 0x20 + ps.rgbReserved._10_2_ * 4 + 5U) {
        UVar21 = 8;
      }
      else {
        UVar21 = 0;
      }
      ps.rgbReserved[2] = (char)UVar21;
      ps.rgbReserved[3] = (char)(UVar21 >> 8);
      AppendMenu(aHStack_3a[ps.rgbReserved._10_2_ + 5],UVar21,
                 ps.rgbReserved._10_2_ + 0x3ac8 + ps.rgbReserved._8_2_ * 8,
                 (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                  (char *)*(undefined2 *)(ps.rgbReserved._8_2_ * 2 + 0xaae)));
    }
    if ((uVar9 & 0x1f) == ps.rgbReserved._10_2_ * 4 + 5U) {
      uVar12 = 8;
    }
    else {
      uVar12 = 0;
    }
    ps.rgbReserved[2] = (char)uVar12;
    ps.rgbReserved[3] = (char)(uVar12 >> 8);
    AppendMenu(aHStack_3a[2],uVar12 | 0x10,aHStack_3a[ps.rgbReserved._10_2_ + 5],
               (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                (char *)*(undefined2 *)(ps.rgbReserved._10_2_ * 2 + 0xa7e)));
  }
  HVar11 = CreatePopupMenu();
  iPopMenuSel = -1;
  if ((uVar9 & 3) == 1) {
    ps.rgbReserved._2_2_ = 8;
  }
  else {
    ps.rgbReserved._2_2_ = 0;
  }
  uVar12 = ps.rgbReserved._2_2_ | 0x10;
  HVar22 = aHStack_3a[0];
  HVar23 = HVar11;
  pcVar14 = PszGetCompressedString(idsPredefinedRace);
  AppendMenu(HVar23,uVar12,HVar22,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  if ((uVar9 & 3) == 2) {
    ps.rgbReserved._2_2_ = 8;
  }
  else {
    ps.rgbReserved._2_2_ = 0;
  }
  uVar12 = ps.rgbReserved._2_2_ | 0x10;
  HVar22 = aHStack_3a[1];
  HVar23 = HVar11;
  pcVar14 = PszGetCompressedString(idsCustomRace);
  AppendMenu(HVar23,uVar12,HVar22,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  if (((uVar9 & 3) == 1) || ((uVar9 & 3) == 2)) {
    UVar10 = 0;
    UVar21 = 0x3a9a;
    HVar22 = HVar11;
    pcVar14 = PszGetCompressedString(idsEditRace);
    AppendMenu(HVar22,UVar10,UVar21,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  }
  AppendMenu(HVar11,0x800,0,(LPCSTR)0x0);
  if ((uVar9 & 3) == 3) {
    ps.rgbReserved._2_2_ = 8;
  }
  else {
    ps.rgbReserved._2_2_ = 0;
  }
  uVar12 = ps.rgbReserved._2_2_ | 0x10;
  HVar22 = aHStack_3a[2];
  HVar23 = HVar11;
  pcVar14 = PszGetCompressedString(idsComputerPlayer);
  AppendMenu(HVar23,uVar12,HVar22,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  AppendMenu(HVar11,0x800,0,(LPCSTR)0x0);
  if ((bVar5 & 3) == 0) {
    UVar21 = 8;
  }
  else {
    UVar21 = 0;
  }
  UVar10 = 0x3a9b;
  HVar22 = HVar11;
  ps.rgbReserved._2_2_ = UVar21;
  pcVar14 = PszGetCompressedString(idsPlayer);
  AppendMenu(HVar22,UVar21,UVar10,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar14));
  if (message == WM_LBUTTONDOWN) {
    ps.rgbReserved._4_2_ = 0;
  }
  else {
    ps.rgbReserved._4_2_ = 2;
  }
  TrackPopupMenu(HVar11,ps.rgbReserved._4_2_ | 4,ps.rgbReserved._12_2_,ps.rgbReserved._14_2_,0,hwnd,
                 (undefined2 *)0x0);
  DestroyMenu(HVar11);
  ps.rgbReserved[10] = 0;
  ps.rgbReserved[0xb] = 0;
  for (; (int)ps.rgbReserved._10_2_ < 6; ps.rgbReserved._10_2_ = ps.rgbReserved._10_2_ + 1) {
    DestroyMenu(aHStack_3a[ps.rgbReserved._10_2_]);
  }
  BVar13 = PeekMessage((undefined2 *)CONCAT22(unaff_SS,&msg),hwnd,0x111,0x111,2);
  if (((BVar13 != 0) && (14999 < (uint)msg.wParam)) && ((uint)msg.wParam < 0x3afc)) {
    iPopMenuSel = msg.wParam + -15000;
  }
  hdc = 0xffff;
  iCurVal = uVar9;
  if (iPopMenuSel != -1) {
    if (iPopMenuSel == 0) {
      puVar18 = (undefined2 *)&vrgplrDef;
      pPVar17 = (PLAYER *)&vplr;
      for (iVar15 = 0x60; iVar15 != 0; iVar15 = iVar15 + -1) {
        pPVar2 = pPVar17;
        pPVar17 = (PLAYER *)&pPVar17->cPlanet;
        puVar1 = puVar18;
        puVar18 = puVar18 + 1;
        uVar3 = *puVar1;
        pPVar2->iPlayer = (char)uVar3;
        pPVar2->cShDef = (char)((uint)uVar3 >> 8);
      }
      CchGetString(idsHumanoid,(char *)vplr.szName);
      _WSPRINTF((LPSTR)0x501a1120,(LPCSTR)0xae01120,0x503a);
      pRVar7 = vrgrcRCW;
      sVar24 = RaceCreationWizard(hwnd,0,0);
      vrgrcRCW = pRVar7;
      if (sVar24 == 0) goto LAB_1078_9035;
CREATE_PlaceNew:
      if (vcplrNew < 0x10) {
        hdc = vcplrNew;
        vcplrNew = vcplrNew + 1;
      }
      else {
        for (hdc = 0xf; -1 < (int)hdc; hdc = hdc - 1) {
          ps.rgbReserved[10] = 0;
          ps.rgbReserved[0xb] = 0;
          while (((int)ps.rgbReserved._10_2_ < 0x10 &&
                 (((((byte *)vrgplrTypeNew)[ps.rgbReserved._10_2_] & 3) != 2 ||
                  (((int)(uint)((byte *)vrgplrTypeNew)[ps.rgbReserved._10_2_] >> 2 & 0xfU)
                   != hdc))))) {
            ps.rgbReserved._10_2_ = ps.rgbReserved._10_2_ + 1;
          }
          if (ps.rgbReserved._10_2_ == 0x10) break;
        }
      }
      pPVar19 = vrgplrNew + hdc;
      pPVar17 = (PLAYER *)&vplr;
      for (iVar15 = 0x60; iVar15 != 0; iVar15 = iVar15 + -1) {
        pPVar4 = pPVar19;
        pPVar19 = (PLAYER *)&pPVar19->cPlanet;
        pPVar2 = pPVar17;
        pPVar17 = (PLAYER *)&pPVar17->cPlanet;
        cVar6 = pPVar2->cShDef;
        pPVar4->iPlayer = pPVar2->iPlayer;
        pPVar4->cShDef = cVar6;
      }
      _strcpy(vrgszFileNew + hdc * 0xd,(char *)&szRaceFile);
      hdc = hdc << 2 | 2;
    }
    else {
LAB_1078_9035:
      if (iPopMenuSel == 1) {
        sVar24 = FOpenGame(hwnd,1);
        if (0 < sVar24) goto CREATE_PlaceNew;
      }
      else if (iPopMenuSel == 2) {
        iVar15 = (int)uVar9 >> 2;
        if ((uVar9 & 3) == 1) {
          puVar18 = (undefined2 *)(iVar15 * 0xc0 + 0xda2);
          pPVar17 = (PLAYER *)&vplr;
          for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
            pPVar2 = pPVar17;
            pPVar17 = (PLAYER *)&pPVar17->cPlanet;
            puVar1 = puVar18;
            puVar18 = puVar18 + 1;
            uVar3 = *puVar1;
            pPVar2->iPlayer = (char)uVar3;
            pPVar2->cShDef = (char)((uint)uVar3 >> 8);
          }
          CchGetString(iVar15 + idsHumanoid,(char *)vplr.szName);
          _WSPRINTF((LPSTR)0x501a1120,(LPCSTR)0xae41120,0x503a);
        }
        else {
          pPVar17 = vrgplrNew + iVar15;
          pPVar19 = (PLAYER *)&vplr;
          for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
            pPVar4 = pPVar19;
            pPVar19 = (PLAYER *)&pPVar19->cPlanet;
            pPVar2 = pPVar17;
            pPVar17 = (PLAYER *)&pPVar17->cPlanet;
            cVar6 = pPVar2->cShDef;
            pPVar4->iPlayer = pPVar2->iPlayer;
            pPVar4->cShDef = cVar6;
          }
          _strcpy((char *)&szRaceFile,vrgszFileNew + iVar15 * 0xd);
        }
        lSaltCur._0_2_ = (int)vplr.lSalt;
        lSaltCur._2_2_ = vplr.lSalt._2_2_;
        lSaltLast._0_2_ = 0;
        lSaltLast._2_2_ = 0;
        sVar24 = FCheckPassword();
        if (sVar24 == 0) goto CREATE_FinishClick;
        if (((int)vplr.lSalt == 0) && (vplr.lSalt._2_2_ == 0)) {
          szRacePass = 0;
        }
        else {
          _strcpy((char *)&szRacePass,(char *)szPassLast);
        }
        pRVar7 = vrgrcRCW;
        sVar24 = RaceCreationWizard(hwnd,0,0);
        vrgrcRCW = pRVar7;
        if (sVar24 != 0) {
          if (((uVar9 & 3) == 1) ||
             (sVar24 = _strcmp((char *)&szRaceFile,
                                       vrgszFileNew + iVar15 * 0xd), sVar24 != 0))
          goto CREATE_PlaceNew;
          pPVar19 = vrgplrNew + iVar15;
          pPVar17 = (PLAYER *)&vplr;
          for (iVar16 = 0x60; iVar16 != 0; iVar16 = iVar16 + -1) {
            pPVar4 = pPVar19;
            pPVar19 = (PLAYER *)&pPVar19->cPlanet;
            pPVar2 = pPVar17;
            pPVar17 = (PLAYER *)&pPVar17->cPlanet;
            cVar6 = pPVar2->cShDef;
            pPVar4->iPlayer = pPVar2->iPlayer;
            pPVar4->cShDef = cVar6;
          }
          _strcpy(vrgszFileNew + iVar15 * 0xd,(char *)&szRaceFile);
          iCurVal = -1;
          vrgrcRCW = pRVar7;
          hdc = uVar9;
        }
      }
      else if (iPopMenuSel == 3) {
        hdc = 0;
      }
      else if ((iPopMenuSel < 0x10) || (0x1f < iPopMenuSel)) {
        if ((iPopMenuSel < 0x20) || (0x2f < iPopMenuSel)) {
          if (0x2f < iPopMenuSel) {
            hdc = (iPopMenuSel + -0x30) * 4 | 3;
          }
        }
        else {
          hdc = (iPopMenuSel + -0x20) * 4 | 2;
        }
      }
      else {
        hdc = (iPopMenuSel + -0x10) * 4 | 1;
      }
    }
  }
  if ((hdc != 0xffff) && (hdc != iCurVal)) {
    ((byte *)vrgplrTypeNew)[iDiamond_2] = (byte)hdc;
    if (hdc == 0) {
      while (iDiamond_2 + 1 < 0x10) {
        ((byte *)vrgplrTypeNew + 1)[iDiamond_2] = 0;
        iDiamond_2 = iDiamond_2 + 1;
      }
    }
    else if (0 < iDiamond_2) {
      while ((-1 < iDiamond_2 + -1 &&
             (*(char *)((int)(short **)&vrgiflMerge + iDiamond_2 + 1) == '\0'))) {
        *(byte *)((int)(short **)&vrgiflMerge + iDiamond_2 + 1) = (byte)hdc;
        iDiamond_2 = iDiamond_2 + -1;
      }
    }
    InvalidateRect(hwnd,(undefined2 *)0x0,1);
  }
CREATE_FinishClick:
  SetFocus(hwnd);
  return 0;
}



// ======================================================================
// Function: DrawNewGame2
// Address: 1078:9556
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x107897f8) */
/* WARNING: Removing unreachable block (ram,0x10789791) */
/* WARNING: Removing unreachable block (ram,0x10789894) */

void DrawNewGame2(HWND hwnd,HDC hdc,short iDraw)

{
  byte bVar1;
  short sVar2;
  char *pcVar3;
  int iVar4;
  uint uVar5;
  uint uVar6;
  ushort uVar7;
  char *unaff_SS;
  bool bVar8;
  DWORD DVar9;
  undefined1 *puVar10;
  undefined2 uVar11;
  short sVar12;
  char *pcVar13;
  HDC HVar14;
  char szT [20];
  RECT rc;
  RECT rcDiamond;
  short cch;
  short bkMode;
  short iPlr;
  short i;
  short yCur;
  short fCreatedDC;
  
  bVar8 = hdc == 0;
  if (bVar8) {
    hdc = GetDC(hwnd);
  }
  GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
  sVar2 = SetBkMode(hdc,1);
  SelectObject(hdc,rghfontArial8[1]);
  HVar14 = hdc;
  pcVar3 = PszGetCompressedString(idsPlayer16);
  DVar9 = GetTextExtent(HVar14,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar3),0xb);
  xNewGameDiamond = (int)DVar9 + 0xc;
  yCur = 6;
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rcDiamond),xNewGameDiamond,6,
          xNewGameDiamond + dyArial8 + 1,dyArial8 + 7);
  for (i = 0; (i < 0x10 && ((fRCWReadOnly == 0 || (i < game.cPlayer)))); i = i + 1)
  {
    iVar4 = i + 1;
    pcVar3 = PszGetCompressedString(idsPlayerD);
    iVar4 = _WSPRINTF((LPSTR)CONCAT22(iVar4,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
    ((char *)szWork)[iVar4] = ':';
    ((char *)szWork + 1)[iVar4] = '\0';
    RightTextOut
              (hdc,xNewGameDiamond + -6,yCur,(char *)szWork,iVar4 + 1,0);
    DrawDiamond(hdc,&rcDiamond,hbrBBlue);
    uVar5 = (int)(uint)((byte *)vrgplrTypeNew)[i] >> 2;
    uVar6 = uVar5 & 0xf;
    if (fRCWReadOnly == 0) {
      bVar1 = ((byte *)vrgplrTypeNew)[i] & 3;
      if ((((byte *)vrgplrTypeNew)[i] & 3) == 0) {
        CchGetString(idsPlayer2,(char *)szWork);
      }
      else if (bVar1 == 1) {
        if (uVar6 < 6) {
          CchGetString(idsS,szT);
          pcVar3 = PszGetCompressedString(uVar6 + idsHumanoid);
          _WSPRINTF((LPSTR)CONCAT22(pcVar3,unaff_SS),(LPCSTR)CONCAT22(szT,(char *)&DAT_1120_1120),
                    (char *)szWork);
        }
        else {
          if (uVar6 == 6) {
            szT._18_2_ = idsRandom;
          }
          else {
            szT._18_2_ = idsExpansionPlayer;
          }
          CchGetString(szT._18_2_,(char *)szWork);
        }
      }
      else if (bVar1 == 2) {
        if ((((uint)gd.wFlags >> 6 & 1) == 0) ||
           (vrgszFileNew[uVar6 * 0xd] == '\0')) {
          if (vrgszFileNew[uVar6 * 0xd] == '\0') {
            pcVar13 = vrgplrNew[uVar6].szNames;
            pcVar3 = PszGetCompressedString(idsS);
            _WSPRINTF((LPSTR)CONCAT22(pcVar13,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
          }
          else {
            pcVar13 = vrgplrNew[uVar6].szNames;
            pcVar3 = PszGetCompressedString(idsSS2);
            _WSPRINTF((LPSTR)CONCAT22(pcVar13,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
          }
        }
        else {
          _WSPRINTF((LPSTR)CONCAT22(vrgszFileNew + uVar6 * 0xd,(char *)&DAT_1120_1120),
                    (LPCSTR)0xaee1120,(char *)szWork);
        }
      }
      else if (bVar1 == 3) {
        uVar11 = *(undefined2 *)((uVar5 & 7) * 2 + 0xa7e);
        pcVar3 = PszGetCompressedString(idsSSComputerPlayer);
        _WSPRINTF((LPSTR)CONCAT22(uVar11,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
      }
    }
    else if ((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) {
      CchGetString(idsUnknownPlayer,(char *)szWork);
    }
    else {
      PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
      if ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) != 0) {
        pcVar3 = PszGetCompressedString(idsDeceased);
        pcVar13 = (char *)&DAT_1120_1120;
        uVar11 = 0xae8;
        uVar7 = _strlen((char *)szWork);
        _WSPRINTF((LPSTR)CONCAT22(pcVar3,pcVar13),(LPCSTR)CONCAT22(uVar11,(char *)&DAT_1120_1120),
                  (char *)szWork + uVar7);
        SetTextColor(hdc,0x7f);
      }
    }
    iVar4 = rcDiamond.right + 6;
    puVar10 = (undefined1 *)&DAT_1120_1120;
    pcVar3 = (char *)szWork;
    sVar12 = yCur;
    HVar14 = hdc;
    uVar7 = _strlen((char *)szWork);
    TextOut(HVar14,iVar4,sVar12,(LPCSTR)CONCAT22(puVar10,pcVar3),uVar7);
    SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
    OffsetRect((undefined2 *)CONCAT22(unaff_SS,&rcDiamond),0,dyArial8 + 4);
    yCur = yCur + dyArial8 + 4;
  }
  SetBkMode(hdc,sVar2);
  if (bVar8) {
    ReleaseDC(hwnd,hdc);
  }
  return;
}



// ======================================================================
// Function: NewGameDlg3
// Address: 1078:99f4
// Segment: MEMORY_CREATE
// ======================================================================


/* WARNING: Variable defined which should be unmapped: ps */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short NewGameDlg3(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  POINT pt;
  POINT pt_00;
  WPARAM WVar1;
  HWND HVar2;
  HDC hdc_00;
  short sVar3;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar4;
  LRESULT LVar5;
  UINT UVar6;
  PAINTSTRUCT ps;
  HDC hdc;
  RECT rc;
  short i;
  
  uVar4 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hdc_00 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    DrawNewGame3(hwnd,hdc_00,-1);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    sVar3 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    sVar3 = 1;
  }
  else {
    if (message == WM_CTLCOLOR) {
      i = 0x123;
      while ((i < 0x12a && (HVar2 = GetDlgItem(hwnd,i), (HWND)lParam != HVar2))) {
        i = i + 1;
      }
      if ((i < 0x12a) || (uVar4 = __aFulshr(uVar4,ps.hdc), (int)uVar4 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else if (message == WM_SETCURSOR) {
      GetCursorPos((undefined2 *)CONCAT22(unaff_SS,ps.rgbReserved + 0xe));
      ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,ps.rgbReserved + 0xe));
      pt.y = hdc;
      pt.x._0_1_ = ps.rgbReserved[0xe];
      pt.x._1_1_ = ps.rgbReserved[0xf];
      sVar3 = IrcRaceDlgHitTest(pt);
      if (-1 < sVar3) {
        setcursor(hcurHand);
        return 1;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        SetNGWTitle(hwnd,3);
        for (i = 0; i < 7; i = i + 1) {
          HVar2 = GetDlgItem(hwnd,i + 0x123);
          UVar6 = 0x401;
          WVar1 = GetVCCheck((GAME *)&game,(uint)(1 < i) + i);
          SendMessage(HVar2,UVar6,WVar1,0);
          if (fRCWReadOnly != 0) {
            HVar2 = GetDlgItem(hwnd,i + 0x123);
            EnableWindow(HVar2,0);
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,1);
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0x3fd);
          return 1;
        }
        for (i = 0; (i < 4 && (wParam != ((undefined2 *)&rgidRaceBtn)[i])); i = i + 1) {
        }
        if (i < 4) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyNewDlg,0);
          EndDialog(hwnd,i);
          return 1;
        }
        if ((0x122 < wParam) && (wParam < 0x12a)) {
          HVar2 = GetDlgItem(hwnd,wParam);
          LVar5 = SendMessage(HVar2,0x400,0,0);
          SetVCCheck((GAME *)&game,(wParam - 0x123) + (uint)(1 < wParam - 0x123),(short)LVar5
                    );
          DrawNewGame3(hwnd,0,8);
        }
      }
      else if ((message == WM_LBUTTONDOWN) || (message == WM_LBUTTONDBLCLK)) {
        ps.rgbReserved[0xe] = (undefined1)lParam;
        ps.rgbReserved[0xf] = lParam._1_1_;
        uVar4 = __aFulshr(uVar4,ps.hdc);
        pt_00.y = (short)uVar4;
        pt_00.x._0_1_ = ps.rgbReserved[0xe];
        pt_00.x._1_1_ = ps.rgbReserved[0xf];
        sVar3 = FTrackNewGameDlg3(hwnd,pt_00,wParam);
        return sVar3;
      }
    }
    sVar3 = 0;
  }
  return sVar3;
}



// ======================================================================
// Function: DrawNewGame3
// Address: 1078:9d5e
// Segment: MEMORY_CREATE
// ======================================================================


void DrawNewGame3(HWND hwnd,HDC hdc,short iDraw)

{
  uint uVar1;
  short sVar2;
  HWND HVar3;
  short sVar4;
  int iVar5;
  RECT *pRVar6;
  RECT *pRVar7;
  undefined2 unaff_SS;
  bool bVar8;
  COLORREF CVar9;
  DWORD DVar10;
  DWORD DVar11;
  RECT rc;
  short cch;
  short xLeft;
  short dxDig;
  short bkMode;
  COLORREF crBkSav;
  short j;
  RECT rcCBox;
  short dxItem;
  short i;
  short fCreatedDC;
  short ids;
  short irc;
  short vcCur;
  short bt;
  short yTop;
  
  if (fRCWReadOnly == 0) {
    uVar1 = 0;
  }
  else {
    uVar1 = 4;
  }
  bVar8 = hdc == 0;
  if (bVar8) {
    hdc = GetDC(hwnd);
  }
  GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
  sVar2 = SetBkMode(hdc,2);
  CVar9 = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
  SelectObject(hdc,rghfontArial8[1]);
  DVar10 = GetTextExtent(hdc,(LPCSTR)0x11200af2,1);
  ids = 0x3aa;
  irc = 0;
  vcCur = 0;
  i = 0;
  do {
    if (8 < i) {
      crcRCW = irc;
      SetBkColor(hdc,CVar9);
      SetBkMode(hdc,sVar2);
      if (bVar8) {
        ReleaseDC(hwnd,hdc);
      }
      return;
    }
    if (i < 7) {
      HVar3 = GetDlgItem(hwnd,i + 0x123);
      GetWindowRect(HVar3,(undefined2 *)CONCAT22(unaff_SS,&rcCBox));
      MapWindowPoints(0,hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcCBox),2);
      xLeft = rcCBox.right + 2;
      yTop = ((rcCBox.bottom - rcCBox.top) / 2 + rcCBox.top) - (dyArial8 >> 1);
    }
    else if (i == 7) {
      xLeft = rcCBox.left;
      yTop = rcCBox.bottom + 6;
    }
    else {
      xLeft = rcCBox.left;
      yTop = rcCBox.bottom + 6 + (dyArial8 * 3) / 2;
    }
    sVar4 = CchGetString(ids,(char *)szWork);
    if (iDraw == -1) {
      TextOut(hdc,xLeft,yTop,szWork,sVar4);
    }
    DVar11 = GetTextExtent(hdc,szWork,sVar4);
    xLeft = xLeft + (int)DVar11;
    iVar5 = ids;
    for (j = 0; ids = iVar5 + 1, j < 2; j = j + 1) {
      sVar4 = _abs((int)((char (*) [2])rgNG3Width)[i][j]);
      dxItem = sVar4 * (int)DVar10;
      if (dxItem == 0) {
        ids = iVar5 + 2;
        break;
      }
      sVar4 = GetVCVal((GAME *)&game,vcCur,0);
      _WSPRINTF((LPSTR)CONCAT22(sVar4,(char *)&DAT_1120_1120),
                (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
      if (((char (*) [2])rgNG3Width)[i][j] < '\0') {
        dxItem = dxItem + ((int)DVar10 * 3) / 2;
        _strcat((char *)szWork,(char *)0xaf4);
      }
      if (((iDraw == -1) || (iDraw == vcCur)) || (vcCur == 8)) {
        RightTextOut(hdc,xLeft + dxItem,yTop,(char *)szWork,0,dxItem);
      }
      vcCur = vcCur + 1;
      (vrgrcRCW + irc)->left = xLeft + dxItem + 4;
      vrgrcRCW[irc].top = yTop + -3;
      vrgrcRCW[irc].right = (vrgrcRCW + irc)->left + 0xf;
      vrgrcRCW[irc].bottom = (dyArial8 >> 1) + vrgrcRCW[irc].top + 3;
      pRVar6 = vrgrcRCW + irc;
      pRVar7 = vrgrcRCW + irc + 1;
      pRVar7->left = pRVar6->left;
      pRVar7->top = pRVar6->top;
      pRVar7->right = pRVar6->right;
      pRVar7->bottom = pRVar6->bottom;
      OffsetRect((undefined2 *)CONCAT22((undefined1 *)&DAT_1120_1120,vrgrcRCW + irc + 1),0
                 ,(vrgrcRCW[irc].bottom - vrgrcRCW[irc].top) + -1);
      if (iDraw == -1) {
        DrawBtn(hdc,vrgrcRCW + irc,uVar1 | 0xa0,0,(char *)0x0);
        DrawBtn(hdc,vrgrcRCW + irc + 1,uVar1 | 0xa1,0,(char *)0x0);
      }
      iVar5 = vrgrcRCW[irc].right + 4;
      sVar4 = CchGetString(ids,(char *)szWork);
      if (iDraw == -1) {
        TextOut(hdc,iVar5,yTop,szWork,sVar4);
      }
      DVar11 = GetTextExtent(hdc,szWork,sVar4);
      xLeft = iVar5 + (int)DVar11;
      irc = irc + 2;
      iVar5 = ids;
    }
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: FTrackNewGameDlg3
// Address: 1078:a210
// Segment: MEMORY_CREATE
// ======================================================================


short FTrackNewGameDlg3(HWND hwnd,POINT pt,short kbd)

{
  uint uVar1;
  int vc;
  short sVar2;
  short sVar3;
  short iStat;
  short iMod;
  short dShift;
  short i;
  BTNT btnt;
  short irc;
  short bt;
  
  uVar1 = IrcRaceDlgHitTest(pt);
  if ((int)uVar1 < 0) {
    sVar2 = 0;
  }
  else {
    vc = (int)uVar1 >> 1;
    if ((uVar1 & 1) == 0) {
      dShift = 1;
      bt = 0xa0;
    }
    else {
      dShift = -1;
      bt = 0xa1;
    }
    InitBtnTrack(&btnt,hwnd,0,vrgrcRCW + uVar1,bt,0x50,0,0,(char *)0x0);
    if ((kbd & 0xcU) != 0) {
      dShift = dShift * 5;
    }
    while (sVar2 = FTrackBtn(&btnt), sVar2 != 0) {
      sVar2 = GetVCVal((GAME *)&game,vc,1);
      sVar3 = SetVCVal((GAME *)&game,vc,sVar2 + dShift);
      if (sVar3 != sVar2) {
        DrawNewGame3(hwnd,btnt.hdc,vc);
      }
    }
    sVar2 = 1;
  }
  return sVar2;
}



// ======================================================================
// Function: SetNGWTitle
// Address: 1078:a320
// Segment: MEMORY_CREATE
// ======================================================================


void SetNGWTitle(HWND hwnd,short iStep)

{
  char *unaff_SS;
  char szBuf [50];
  short cch;
  
  CchGetString(fRCWReadOnly + idsAdvancedNewGameWizardStepD3,szBuf);
  _WSPRINTF((LPSTR)CONCAT22(iStep,unaff_SS),(LPCSTR)CONCAT22(szBuf,(char *)&DAT_1120_1120),
            (char *)szWork);
  SetWindowText(hwnd,szWork);
  return;
}



// ======================================================================
// Function: LpplrComp
// Address: 1078:b570
// Segment: MEMORY_CREATE
// ======================================================================


PLAYER * LpplrComp(short idAi,short lvlAi)

{
  return (PLAYER *)CONCAT22((undefined *)&DAT_1120_1078,((PLAYER (*) [4])vrgplrComp)[idAi] + lvlAi);
}



// ======================================================================
// Function: SetVCCheck
// Address: 1078:b5bc
// Segment: MEMORY_CREATE
// ======================================================================


void SetVCCheck(GAME *pgame,short vc,short fChecked)

{
  byte bVar1;
  
  if (fChecked == 0) {
    bVar1 = 0;
  }
  else {
    bVar1 = 0x80;
  }
  pgame->rgvc[vc] = pgame->rgvc[vc] & 0x7f | bVar1;
  return;
}



// ======================================================================
// Function: GetVCCheck
// Address: 1078:b60c
// Segment: MEMORY_CREATE
// ======================================================================


short GetVCCheck(GAME *pgame,short vc)

{
  return (uint)((pgame->rgvc[vc] & 0x80) != 0);
}



// ======================================================================
// Function: SetVCVal
// Address: 1078:b644
// Segment: MEMORY_CREATE
// ======================================================================


short SetVCVal(GAME *pgame,short vc,short val)

{
  short sVar1;
  short cur;
  
  if (val < 0) {
    val = 0;
  }
  else if (((short *)vrgvcMax)[vc] < val) {
    val = ((short *)vrgvcMax)[vc];
  }
  pgame->rgvc[vc] = pgame->rgvc[vc] & 0x80 | (byte)val;
  if ((vc == 8) && (sVar1 = GetVCVal(pgame,8,0), sVar1 != val)) {
    pgame->rgvc[8] = pgame->rgvc[8] & 0x80 | (byte)sVar1;
    val = sVar1;
  }
  return val;
}



// ======================================================================
// Function: GetVCVal
// Address: 1078:b710
// Segment: MEMORY_CREATE
// ======================================================================


short GetVCVal(GAME *pgame,short vc,short fRaw)

{
  uint uVar1;
  short val;
  short i;
  short c;
  
  uVar1 = pgame->rgvc[vc] & 0x7f;
  if (fRaw == 0) {
    switch(vc) {
    case 0:
      uVar1 = uVar1 * 5 + 0x14;
      break;
    case 1:
      uVar1 = uVar1 + 8;
      break;
    case 2:
      uVar1 = uVar1 + 2;
      break;
    case 3:
      uVar1 = uVar1 * 1000 + 1000;
      break;
    case 4:
      uVar1 = uVar1 * 10 + 0x14;
      break;
    case 5:
    case 6:
      uVar1 = uVar1 * 10 + 10;
      break;
    case 7:
      uVar1 = uVar1 * 10 + 0x1e;
      break;
    default:
      c = 0;
      for (i = 0; i < 8; i = i + 1) {
        if ((i != 2) && ((*(byte *)(i + 0x84) & 0x80) != 0)) {
          c = c + 1;
        }
      }
      if (c < (int)uVar1) {
        uVar1 = c;
      }
      break;
    case 9:
      uVar1 = uVar1 * 10 + 0x1e;
    }
  }
  return uVar1;
}



