// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: LphuldefSBFromId
// Address: 1008:510a
// Segment: MEMORY_PARTS
// ======================================================================


HULDEF * LphuldefSBFromId(short id)

{
  return (HULDEF *)CONCAT22(0x1008,(HULDEF *)rghuldefSB + id);
}



// ======================================================================
// Function: LphuldefFromId
// Address: 1008:512c
// Segment: MEMORY_PARTS
// ======================================================================


HULDEF * LphuldefFromId(HullDef id)

{
  HULDEF *pHVar1;
  
  if ((int)id < 0x20) {
    pHVar1 = (HULDEF *)CONCAT22(0x1008,(HULDEF *)rghuldef + id);
  }
  else {
    pHVar1 = LphuldefSBFromId(id - ihuldefCount);
  }
  return pHVar1;
}



// ======================================================================
// Function: LpengineFromId
// Address: 1008:5168
// Segment: MEMORY_PARTS
// ======================================================================


ENGINE * LpengineFromId(short id)

{
  return (ENGINE *)CONCAT22(0x1008,(ENGINE *)(id * 0x4e));
}



// ======================================================================
// Function: LpscannerFromId
// Address: 1008:518a
// Segment: MEMORY_PARTS
// ======================================================================


SCANNER * LpscannerFromId(short id)

{
  return (SCANNER *)CONCAT22(0x1008,(SCANNER *)(id * 0x38 + 0x768));
}



// ======================================================================
// Function: LpshdefT
// Address: 1008:51ac
// Segment: MEMORY_PARTS
// ======================================================================


SHDEF * LpshdefT(void)

{
  return rgshdefT;
}



// ======================================================================
// Function: LpshdefSBT
// Address: 1008:51c4
// Segment: MEMORY_PARTS
// ======================================================================


SHDEF * LpshdefSBT(void)

{
  return rgshdefSBT;
}



// ======================================================================
// Function: LpplanetaryFromId
// Address: 1008:51dc
// Segment: MEMORY_PARTS
// ======================================================================


PLANETARY * LpplanetaryFromId(short id)

{
  return (PLANETARY *)CONCAT22(0x1008,(PLANETARY *)((HWND *)&hwndZipOrderDlg + id * 0x1b));
}



// ======================================================================
// Function: FLookupPartX
// Address: 1008:51fe
// Segment: MEMORY_PARTS
// ======================================================================


short FLookupPartX(PART *ppart,ushort grhst,ushort iItem)

{
  short sVar1;
  
  (ppart->hs).grhst = grhst;
  (ppart->hs).wFlags = (ppart->hs).wFlags & 0xff00U | iItem & 0xff;
  (ppart->hs).wFlags = (ppart->hs).wFlags & 0xff;
  sVar1 = FLookupPart(ppart);
  return sVar1;
}



// ======================================================================
// Function: FLookupPart
// Address: 1008:524e
// Segment: MEMORY_PARTS
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10085eaf) */
/* WARNING: Removing unreachable block (ram,0x10085fdb) */
/* WARNING: Removing unreachable block (ram,0x10085997) */
/* WARNING: Removing unreachable block (ram,0x10085f02) */

short FLookupPart(PART *ppart)

{
  HullSlotType HVar1;
  uint uVar2;
  short sVar3;
  short sVar4;
  short raMajor;
  
  sVar3 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  HVar1 = (ppart->hs).grhst;
  uVar2 = (ppart->hs).wFlags;
  if (HVar1 == hstEngine) {
    if (0xf < (uVar2 & 0xff)) {
      return 0;
    }
    *(uint *)&ppart->pcom = (uVar2 & 0xff) * 0x4e;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if (((uVar2 & 0xff) == 0) && (sVar3 != raCheapCol)) {
        return -1;
      }
      if ((((10 < (uVar2 & 0xff)) && ((uVar2 & 0xff) < 0x10)) || ((uVar2 & 0xff) == 10)) &&
         (sVar3 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceNoRamscoops
                                    ), sVar3 != 0)) {
        return -1;
      }
      if ((((uVar2 & 0xff) == 0xf) || ((uVar2 & 0xff) == 2)) &&
         (sVar3 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceIFE),
         sVar3 == 0)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 7) &&
         (sVar3 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceNoRamscoops
                                    ), sVar3 == 0)) {
        return -1;
      }
      sVar3 = FShouldPartBeHidden(ppart);
      if (sVar3 != 0) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstScanner) {
    if (0xf < (uVar2 & 0xff)) {
      return 0;
    }
    *(uint *)&ppart->pcom = (uVar2 & 0xff) * 0x38 + 0x768;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if (((((uVar2 & 0xff) == 7) || ((uVar2 & 0xff) == 8)) || ((uVar2 & 0xff) == 0xc)) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                     ibitRaceNoAdvScanner), sVar4 != 0)) {
        return -1;
      }
      if (((((uVar2 & 0xff) == 6) || ((uVar2 & 0xff) == 5)) || ((uVar2 & 0xff) == 0xe)) &&
         (sVar3 != raStealth)) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstShield) {
    if (9 < (uVar2 & 0xff)) {
      return 0;
    }
    *(uint *)&ppart->pcom = (uVar2 & 0xff) * 0x36 + 0xae8;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (((uVar2 & 0xff) == 4) && (sVar3 != raStealth)) {
      return -1;
    }
    if (((uVar2 & 0xff) == 3) && (sVar3 != raDefend)) {
      return -1;
    }
    sVar3 = FShouldPartBeHidden(ppart);
    if (sVar3 != 0) {
      return -1;
    }
  }
  else if (HVar1 == hstArmor) {
    if (0xb < (uVar2 & 0xff)) {
      return 0;
    }
    *(uint *)&ppart->pcom = (uVar2 & 0xff) * 0x36 + 0x4e0;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (((uVar2 & 0xff) == 7) && (sVar3 != raStealth)) {
      return -1;
    }
    if (((uVar2 & 0xff) == 6) && (sVar3 != raDefend)) {
      return -1;
    }
    sVar3 = FShouldPartBeHidden(ppart);
    if (sVar3 != 0) {
      return -1;
    }
  }
  else if (HVar1 == hstBeam) {
    if (0x17 < (uVar2 & 0xff)) {
      return 0;
    }
    *(BEAM **)&ppart->pcom = (BEAM *)rgbeam + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (((uVar2 & 0xff) == 2) && (sVar3 != raDefend)) {
      return -1;
    }
    if ((((uVar2 & 0xff) == 0x10) || ((uVar2 & 0xff) == 0xe)) && (sVar3 != raAttack)) {
      return -1;
    }
    sVar3 = FShouldPartBeHidden(ppart);
    if (sVar3 != 0) {
      return -1;
    }
  }
  else if (HVar1 == hstTorp) {
    if (0xb < (uVar2 & 0xff)) {
      return 0;
    }
    *(TORP **)&ppart->pcom = (TORP *)rgtorp + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if ((idPlayer != -1) && (sVar3 = FShouldPartBeHidden(ppart), sVar3 != 0)) {
      return -1;
    }
  }
  else if (HVar1 == hstBomb) {
    if (0xe < (uVar2 & 0xff)) {
      return 0;
    }
    *(BOMB **)&ppart->pcom = (BOMB *)rgbomb + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if (((9 < (uVar2 & 0xff)) && ((uVar2 & 0xff) < 0xf)) && (sVar3 == raDefend)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 9) && (sVar3 != raTerra)) {
        return -1;
      }
      sVar3 = FShouldPartBeHidden(ppart);
      if (sVar3 != 0) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstMining) {
    if (7 < (uVar2 & 0xff)) {
      return 0;
    }
    *(MINING **)&ppart->pcom = (MINING *)rgmining + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if ((((((uVar2 & 0xff) == 2) || ((uVar2 & 0xff) == 3)) || ((uVar2 & 0xff) == 4)) ||
          (((uVar2 & 0xff) == 0 || ((uVar2 & 0xff) == 5)))) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceOBRM),
         sVar4 != 0)) {
        return -1;
      }
      if ((((uVar2 & 0xff) == 0) || ((uVar2 & 0xff) == 5)) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceARM),
         sVar4 == 0)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 7) && (sVar3 != raTerra)) {
        return -1;
      }
      sVar3 = FShouldPartBeHidden(ppart);
      if (sVar3 != 0) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstMines) {
    if (9 < (uVar2 & 0xff)) {
      return 0;
    }
    *(uint *)&ppart->pcom = (int)(POINT *)&ptStickyRaceDlg + (uVar2 & 0xff) * 0x36;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if (((((uVar2 & 0xff) == 0) || ((uVar2 & 0xff) == 2)) ||
          (((uVar2 & 0xff) == 3 ||
           (((((uVar2 & 0xff) == 4 || ((uVar2 & 0xff) == 5)) || ((uVar2 & 0xff) == 6)) ||
            (((uVar2 & 0xff) == 8 || ((uVar2 & 0xff) == 9)))))))) && (sVar3 != raMines)) {
        return -1;
      }
      if ((((uVar2 & 0xff) == 7) && (sVar3 != raMines)) && (sVar3 != raDefend)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 1) && (sVar3 == raAttack)) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstSpecialSB) {
    if (0xf < (uVar2 & 0xff)) {
      return 0;
    }
    *(SPECIALSB **)&ppart->pcom = (SPECIALSB *)rgspecialSB + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if (((uVar2 & 0xff) < 7) || (0xf < (uVar2 & 0xff))) {
        if ((uVar2 & 0xff) < 7) {
          if ((sVar3 != raStargate) && (((uVar2 & 0xff) == 1 || (3 < (uVar2 & 0xff))))) {
            return -1;
          }
          if (sVar3 == raCheapCol) {
            return -1;
          }
        }
      }
      else if ((((uVar2 & 0xff) != 9) && ((uVar2 & 0xff) != 0xc)) && (sVar3 != raMassAccel)) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstSBHull) {
    if (4 < (uVar2 & 0xff)) {
      return 0;
    }
    *(HULDEF **)&ppart->pcom = (HULDEF *)rghuldefSB + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if ((((uVar2 & 0xff) == 1) || ((uVar2 & 0xff) == 3)) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceISB),
         sVar4 == 0)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 4) && (sVar3 != raMacintosh)) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstSpecialE) {
    if (0x10 < (uVar2 & 0xff)) {
      return 0;
    }
    *(uint *)&ppart->pcom = (uVar2 & 0xff) * 0x36 + 0xd04;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      sVar4 = FShouldPartBeHidden(ppart);
      if (sVar4 != 0) {
        return -1;
      }
      switch(uVar2 & 0xff) {
      case 0:
      case 3:
        if (sVar3 != raStealth) {
          return -1;
        }
        break;
      case 8:
      case 0xb:
      case 0xf:
        if (sVar3 != raDefend) {
          return -1;
        }
        break;
      case 0xd:
        if (sVar3 != raCheapCol) {
          return -1;
        }
        break;
      case 0xe:
        if (sVar3 != raMines) {
          return -1;
        }
        break;
      case 0x10:
        if (sVar3 != raStargate) {
          return -1;
        }
      }
    }
  }
  else if (HVar1 == hstSpecialM) {
    if (10 < (uVar2 & 0xff)) {
      return 0;
    }
    *(undefined **)&ppart->pcom = (undefined *)&DAT_1120_109a + (uVar2 & 0xff) * 0x36;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      sVar4 = FShouldPartBeHidden(ppart);
      if (sVar4 != 0) {
        return -1;
      }
      if (((uVar2 & 0xff) == 0) && (sVar3 == raMacintosh)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 1) && (sVar3 != raMacintosh)) {
        return -1;
      }
    }
  }
  else if (HVar1 == hstTerra) {
    if (0x13 < (uVar2 & 0xff)) {
      return 0;
    }
    *(undefined **)&ppart->pcom = (undefined *)&DAT_1120_19e2 + (uVar2 & 0xff) * 0x36;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (((idPlayer != -1) && ((uVar2 & 0xff) < 8)) &&
       (sVar3 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceTT),
       sVar3 == 0)) {
      return -1;
    }
  }
  else if (HVar1 == hstHull) {
    if (0x1f < (uVar2 & 0xff)) {
      return 0;
    }
    *(HULDEF **)&ppart->pcom = (HULDEF *)rghuldef + (uVar2 & 0xff);
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if ((((uVar2 & 0xff) == 0xe) || ((uVar2 & 0xff) == 0x1f)) && (sVar3 != raCheapCol)) {
        return -1;
      }
      if ((((uVar2 & 0xff) == 0x19) || ((uVar2 & 0xff) == 3)) && (sVar3 != raDefend)) {
        return -1;
      }
      if (((((uVar2 & 0xff) == 0x16) || ((uVar2 & 0xff) == 0x17)) ||
          (((uVar2 & 0xff) == 0x14 || ((uVar2 & 0xff) == 0x18)))) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceOBRM),
         sVar4 != 0)) {
        return -1;
      }
      if (((((uVar2 & 0xff) == 0x14) || ((uVar2 & 0xff) == 0x16)) || ((uVar2 & 0xff) == 0x18)) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceARM),
         sVar4 == 0)) {
        return -1;
      }
      if ((((uVar2 & 0xff) == 10) || ((uVar2 & 0xff) == 8)) && (sVar3 != raAttack)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 0xc) && (sVar3 != raStealth)) {
        return -1;
      }
      if (((uVar2 & 0xff) == 0x12) && (sVar3 != raStealth)) {
        return -1;
      }
      if ((((uVar2 & 0xff) == 0x1b) || ((uVar2 & 0xff) == 0x1c)) && (sVar3 != raMines)) {
        return -1;
      }
      sVar3 = FShouldPartBeHidden(ppart);
      if (sVar3 != 0) {
        return -1;
      }
    }
  }
  else {
    if (HVar1 != hstPlanetary) {
      return 0;
    }
    if (0xe < (uVar2 & 0xff)) {
      return 0;
    }
    *(HWND **)&ppart->pcom = (HWND *)&hwndZipOrderDlg + (uVar2 & 0xff) * 0x1b;
    *(undefined2 *)((int)&ppart->pcom + 2) = (undefined *)&DAT_1120_10e0;
    if (idPlayer != -1) {
      if ((((uVar2 & 0xff) < 9) && (((COMPART *)ppart->pcom + 1)->id < 0)) &&
         (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                     ibitRaceNoAdvScanner), sVar4 != 0)) {
        return -1;
      }
      if (((uVar2 & 0xff) < 9) && (sVar3 == raMacintosh)) {
        return -1;
      }
      if (((8 < (uVar2 & 0xff)) && ((uVar2 & 0xff) < 0xe)) && (sVar3 == raMacintosh)) {
        return -1;
      }
      if (((10 < (uVar2 & 0xff)) && ((uVar2 & 0xff) < 0xe)) && (sVar3 == raAttack)) {
        return -1;
      }
      sVar3 = FShouldPartBeHidden(ppart);
      if (sVar3 != 0) {
        return -1;
      }
    }
  }
  sVar3 = TechStatus((char *)CONCAT22(*(undefined2 *)((int)&ppart->pcom + 2),
                                      (char *)(*(int *)&ppart->pcom + 2)));
  return sVar3;
}



// ======================================================================
// Function: LookupBestPlanetaryScanner
// Address: 1008:60be
// Segment: MEMORY_PARTS
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x100860ee) */

void LookupBestPlanetaryScanner(PART *ppart)

{
  uint *puVar1;
  int iVar2;
  short sVar3;
  
  (ppart->hs).wFlags = (ppart->hs).wFlags & 0xff00U | 8;
  (ppart->hs).grhst = hstPlanetary;
  while ((sVar3 = FLookupPart(ppart), sVar3 != 1 && (((ppart->hs).wFlags & 0xffU) != 0))) {
    iVar2 = (ppart->hs).wFlags;
    puVar1 = (uint *)&(ppart->hs).wFlags;
    *puVar1 = *puVar1 & 0xff00;
    puVar1 = (uint *)&(ppart->hs).wFlags;
    *puVar1 = *puVar1 | iVar2 - 1U & 0xff;
  }
  return;
}



// ======================================================================
// Function: TechStatus
// Address: 1008:6148
// Segment: MEMORY_PARTS
// ======================================================================


short TechStatus(char *rgTech)

{
  bool bVar1;
  short sVar2;
  short cMiss;
  short fAlmost;
  short i;
  short fInAWhile;
  
  cMiss = 0;
  bVar1 = false;
  fInAWhile = 0;
  i = 0;
  while( true ) {
    if (5 < i) break;
    if ((*(char *)(idPlayer * 0xc0 + 0x59bc + i) < ((char *)rgTech)[i]) &&
       (cMiss = cMiss + 1,
       i == ((int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xfU))) {
      if (*(char *)(idPlayer * 0xc0 + 0x59bc + i) + 1 == (int)((char *)rgTech)[i]) {
        bVar1 = true;
      }
      else {
        fInAWhile = i + 1;
      }
    }
    i = i + 1;
  }
  if (cMiss == 0) {
    sVar2 = 1;
  }
  else if ((cMiss == 1) && (bVar1)) {
    sVar2 = 2;
  }
  else if ((cMiss == 1) && (fInAWhile != 0)) {
    sVar2 = ((int)((char *)rgTech)[fInAWhile + -1] -
            (int)*(char *)(idPlayer * 0xc0 + fInAWhile + 0x59bb)) + 1;
  }
  else {
    sVar2 = 99;
  }
  return sVar2;
}



