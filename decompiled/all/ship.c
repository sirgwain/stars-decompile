// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: DrawShipOrders
// Address: 1050:0000
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050081b) */
/* WARNING: Removing unreachable block (ram,0x1050029b) */
/* WARNING: Removing unreachable block (ram,0x10500866) */
/* WARNING: Restarted to delay deadcode elimination for space: ram */

void DrawShipOrders(HDC param_1,TILE *param_2,FLEET *param_3)

{
  byte *pbVar1;
  PLORD *pPVar2;
  short *psVar3;
  short *psVar4;
  char *pcVar5;
  short sVar6;
  int iVar7;
  StringId ids;
  short *psVar8;
  short *psVar9;
  byte *pbVar10;
  PLORD *pPVar11;
  undefined2 unaff_SS;
  DWORD DVar12;
  uint uVar13;
  RECT local_50;
  DWORD local_48;
  short local_44;
  short local_42;
  short local_40;
  uint local_3e;
  int local_32;
  char *local_30;
  RECT local_2e;
  short local_26;
  int local_24;
  FLEET *local_22;
  short local_20;
  DWORD local_1e;
  int local_1a;
  int local_18;
  int local_16;
  int local_14;
  int local_12;
  short local_10;
  short local_e;
  short local_c;
  uint local_a;
  int local_8;
  UINT local_6;
  
                    /* Segment:    11
                       Offset:     0004aec0
                       Length:     d291
                       Min Alloc:  d291
                       Flags:      1d50
                           Code
                           Discardable
                           Moveable
                           Preload
                           Impure (Non-shareable)
                        */
  local_22 = param_3;
  if (((uint)param_2->wFlags >> 0xb & 1) != 0) {
    rgrcRef[0].top = -5;
    rgrcRef[0].bottom = -6;
    rgrcRef[0xc].top = -5;
    rgrcRef[0xc].bottom = -6;
    ShowWindow(hwndShipLB,0);
    ShowWindow(hwndRepCB,0);
    param_2->wFlags = param_2->wFlags & 0xf7ff;
  }
  pcVar5 = PszGetCompressedString(idsFleetWaypoints);
  sVar6 = FDrawTileNC(param_1,param_2,&local_50,pcVar5);
  if (sVar6 == 0) {
    ShowWindow(hwndShipLB,0);
    ShowWindow(hwndRepCB,0);
    return;
  }
  local_32 = local_50.left + 4;
  local_24 = local_50.right + -4;
  if (((uint)gd.wFlags >> 3 & 1) == 0) {
    local_c = 4;
  }
  else {
    local_c = 2;
  }
  local_c = local_c + local_50.top;
  rgrcRef[0xc].top = -5;
  rgrcRef[0xc].bottom = -6;
  GetClientRect(hwndShipLB,(int *)CONCAT22(unaff_SS,&local_18));
  local_6 = 0x14;
  if (((uint)gd.wFlags >> 3 & 1) == 0) {
    iVar7 = 4;
  }
  else {
    iVar7 = 3;
  }
  dyShipLB = (dyArial8 + 2) * iVar7;
  local_1a = dyShipLB - (local_12 - local_16);
  if (((dxShipLB == local_24 - local_32) && (-1 < local_1a)) &&
     (local_1a < dyArial8)) {
    local_6 = 0x15;
  }
  else {
    dxShipLB = local_24 - local_32;
  }
  SetWindowPos(hwndShipLB,0,local_32,local_c,local_24 - local_32,dyShipLB,local_6);
  ShowWindow(hwndShipLB,5);
  GetClientRect(hwndShipLB,(int *)CONCAT22(unaff_SS,&local_18));
  dyShipLB = local_12 - local_16;
  if (((uint)gd.wFlags >> 3 & 1) == 0) {
    iVar7 = 4;
  }
  else {
    iVar7 = 2;
  }
  local_c = local_c + iVar7 + dyShipLB;
  SelectObject(param_1,rghfontArial8[1]);
  if (((uint)param_2->wFlags >> 0xc & 1) == 0) {
    local_16 = local_c;
    local_12 = local_c + dyArial8;
    local_18 = local_32;
    local_14 = local_24;
    FillRect(param_1,(int *)CONCAT22(unaff_SS,&local_18),hbrButtonFace);
  }
  local_20 = CchGetString(idsComing,(char *)szWork);
  local_48 = GetTextExtent(param_1,szWork,local_20);
  local_20 = CchGetString(idsWayPt,(char *)szWork);
  local_1e = GetTextExtent(param_1,szWork,local_20);
  if ((long)local_48 < (long)local_1e) {
    local_48 = local_1e;
  }
  local_8 = (local_24 - local_32) - (int)local_48;
  if (((uint)param_2->wFlags >> 0xc & 1) == 0) {
    if (sel.iwpAct < 1) {
      ids = idsWayPt;
    }
    else {
      ids = idsComing;
    }
    local_20 = CchGetString(ids,(char *)szWork);
    TextOut(param_1,local_32,local_c,szWork,local_20);
  }
  SelectObject(param_1,rghfontArial8[0]);
  if (sel.iwpAct < 1) {
    if (sel.fl.cord < 2) {
      local_30 = (char *)0x97e;
    }
    else {
      pbVar10 = &((PLORD *)sel.fl.lpplord)[5].iordMax;
      psVar8 = &local_44;
      for (iVar7 = 9; iVar7 != 0; iVar7 = iVar7 + -1) {
        psVar4 = psVar8;
        psVar8 = psVar8 + 1;
        pbVar1 = pbVar10;
        pbVar10 = pbVar10 + 2;
        *psVar4 = *(short *)pbVar1;
      }
      local_30 = PszGetLocName(local_3e >> 8 & (grobjThing|grobjOther|grobjFleet|grobjPlanet),
                                     local_40,local_44,local_42);
      pPVar11 = (PLORD *)sel.fl.lpplord + 1;
      psVar8 = &local_44;
      for (iVar7 = 9; iVar7 != 0; iVar7 = iVar7 + -1) {
        psVar4 = psVar8;
        psVar8 = psVar8 + 1;
        pPVar2 = pPVar11;
        pPVar11 = (PLORD *)&pPVar11->iordMax;
        *psVar4 = pPVar2->wFlags;
      }
      local_26 = 1;
    }
  }
  else {
    psVar9 = (short *)((int)(PLORD *)sel.fl.lpplord +
                      (sel.iwpAct + -1) * 0x12 + 4);
    psVar8 = &local_44;
    for (iVar7 = 9; iVar7 != 0; iVar7 = iVar7 + -1) {
      psVar3 = psVar8;
      psVar8 = psVar8 + 1;
      psVar4 = psVar9;
      psVar9 = psVar9 + 1;
      *psVar3 = *psVar4;
    }
    local_30 = PszGetLocName(local_3e >> 8 & (grobjThing|grobjOther|grobjFleet|grobjPlanet),
                                   local_40,local_44,local_42);
    local_26 = sel.iwpAct;
  }
  RightTextOut(param_1,local_24,local_c,local_30,0,local_8);
  local_c = local_c + dyArial8;
  if ((sel.fl.cord < 2) || (sel.iwpAct == 0)) {
    rgrcRef[0].top = -5;
    rgrcRef[0].bottom = -6;
    if (sel.fl.cord < 2) {
      SetRect((undefined2 *)CONCAT22(unaff_SS,&local_50),local_32 + -1,local_c,local_24 + -1,
              dyArial8 * 4 + local_c);
      FillRect(param_1,(undefined2 *)CONCAT22(unaff_SS,&local_50),hbrButtonFace);
      local_c = local_c + (dyArial8 - ((uint)gd.wFlags >> 3 & 1)) * 4 +
                          ((uint)gd.wFlags >> 3 & 1) * 2;
      goto SHIP_DoCheckBox;
    }
  }
  if (((uint)param_2->wFlags >> 0xc & 1) == 0) {
    SelectObject(param_1,rghfontArial8[1]);
    local_20 = CchGetString(idsDistance,(char *)szWork);
    TextOut(param_1,local_32,local_c,szWork,local_20);
  }
  SelectObject(param_1,rghfontArial8[0]);
  psVar8 = (short *)((int)(PLORD *)sel.fl.lpplord + local_26 * 0x12 + 4);
  local_10 = *psVar8;
  local_e = psVar8[1];
  sVar6 = 0;
  iVar7 = local_8;
  pcVar5 = PszGetDistance(local_44,local_42,local_10,local_e);
  RightTextOut(param_1,local_24,local_c,pcVar5,sVar6,iVar7);
  local_c = local_c + (dyArial8 - ((uint)gd.wFlags >> 3 & 1));
  SelectObject(param_1,rghfontArial8[1]);
  if (((uint)param_2->wFlags >> 0xc & 1) == 0) {
    local_20 = CchGetString(idsWarpFactor,(char *)szWork);
    TextOut(param_1,local_32,local_c,szWork,local_20);
  }
  local_a = *(uint *)((int)(PLORD *)sel.fl.lpplord + local_26 * 0x12 + 10) >> 4 & 0xf;
  if (sel.iwpAct == 0) {
    SelectObject(param_1,rghfontArial8[0]);
    if ((int)local_a < 0xb) {
      uVar13 = local_a;
      pcVar5 = PszGetCompressedString(idsWarpD2);
      local_20 = _WSPRINTF((LPSTR)CONCAT22(uVar13,(char *)&DAT_1120_1120),
                           (LPCSTR)CONCAT22(pcVar5,(char *)&DAT_1120_1120),(char *)szWork)
      ;
    }
    else {
      local_20 = CchGetString(idsUseStargate,(char *)szWork);
    }
    RightTextOut(param_1,local_24,local_c,(char *)szWork,local_20,local_8);
  }
  else {
    SetRect((undefined2 *)CONCAT22(unaff_SS,&local_2e),local_32 + (int)local_48,local_c,
            local_24 + -1,local_c + dyArial8);
    rgrcRef[0].left = local_2e.left;
    rgrcRef[0].top = local_2e.top;
    rgrcRef[0].right = local_2e.right;
    rgrcRef[0].bottom = local_2e.bottom;
    DrawFleetGauge(param_1,&local_2e,(FLEET *)0x0,6);
  }
  local_c = local_c + dyArial8;
  if (((uint)param_2->wFlags >> 0xc & 1) == 0) {
    SelectObject(param_1,rghfontArial8[1]);
    local_20 = CchGetString(idsTravelTime,(char *)szWork);
    TextOut(param_1,local_32,local_c,szWork,local_20);
  }
  SelectObject(param_1,rghfontArial8[0]);
  local_20 = CchGetETA(param_1,(FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,local_22),
                             (char *)szWork,local_26,0);
  RightTextOut(param_1,local_24,local_c,(char *)szWork,local_20,local_8);
  SetTextColor(param_1,0);
  local_c = local_c + (dyArial8 - ((uint)gd.wFlags >> 3 & 1));
  if (((uint)param_2->wFlags >> 0xc & 1) == 0) {
    SelectObject(param_1,rghfontArial8[1]);
    local_20 = CchGetString(idsEstFuelUsage,(char *)szWork);
    TextOut(param_1,local_32,local_c,szWork,local_20);
  }
  SelectObject(param_1,rghfontArial8[0]);
  DVar12 = LFuelUseToWaypoint(&sel.fl,local_26,0);
  local_1e = DVar12;
  pcVar5 = PszGetCompressedString(idsLdmg);
  local_20 = _WSPRINTF((LPSTR)CONCAT22((int)DVar12,(char *)&DAT_1120_1120),
                       (LPCSTR)CONCAT22(pcVar5,(char *)&DAT_1120_1120),(char *)szWork);
  if (CONCAT22(sel.fl.rgwtMin[4]._2_2_,(undefined2)sel.fl.rgwtMin[4]) <
      (long)local_1e) {
    SetTextColor(param_1,0xff);
  }
  RightTextOut(param_1,local_24,local_c,(char *)szWork,local_20,local_8 + -0x14);
  if (CONCAT22(sel.fl.rgwtMin[4]._2_2_,(undefined2)sel.fl.rgwtMin[4]) <
      (long)local_1e) {
    SetTextColor(param_1,0);
  }
  local_c = local_c + dyArial8;
SHIP_DoCheckBox:
  SendMessage(hwndRepCB,0x401,(uint)sel.fl.wFlags >> 9 & 1,0);
  SetWindowPos(hwndRepCB,0,local_32,local_c,0,0,0x15);
  ShowWindow(hwndRepCB,5);
  SetRect(&rgrcRef[0xc].left,local_24 - (dyArial8 | 1U),local_c,local_24,
          (dyArial8 | 1U) + local_c);
  DrawDiamond(param_1,(RECT *)0x4910,hbrBBlue);
  return;
}



// ======================================================================
// Function: DrawShipWayPtOrders
// Address: 1050:0912
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050155f) */
/* WARNING: Removing unreachable block (ram,0x10501311) */

void DrawShipWayPtOrders(HDC hdc,TILE *ptile,OBJ obj)

{
  bool bVar1;
  char *pcVar2;
  short sVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  int iVar7;
  BOOL BVar8;
  int iVar9;
  undefined2 uVar10;
  ushort uVar11;
  undefined2 uVar12;
  undefined2 unaff_SS;
  LRESULT LVar13;
  DWORD DVar14;
  long lVar15;
  undefined1 *puVar16;
  HDC HVar17;
  long rgl [4];
  short c;
  char *psz_2;
  int iStack_4c;
  short ids_2;
  short dyCur;
  char *pcStack_46;
  RECT rc;
  long l;
  short xLeft;
  short cch;
  char *psz;
  short dxRight2;
  short yBot;
  char szT [8];
  ushort grtask;
  short xRight;
  short fActive;
  short i;
  FLEET *pfl;
  ORDER *lpord;
  PLANET *lppl;
  short edWid;
  short ids;
  short yTopMsg;
  short yTop;
  short dxRight;
  short swp;
  short dxT;
  short dxKt;
  
  if (((uint)ptile->wFlags >> 0xb & 1) != 0) {
    for (i = 0; i < 3; i = i + 1) {
      ShowWindow(((ushort *)rghwndOrderDD)[i],0);
    }
    ShowWindow(hwndOrderED,0);
    ptile->wFlags = ptile->wFlags & 0xf7ff;
    rgrcRef[5].top = -5;
    rgrcRef[5].bottom = -6;
    rgrcRef[0x12].top = -5;
    rgrcRef[0x12].bottom = -6;
  }
  pcVar2 = PszGetCompressedString(idsWaypointTask);
  sVar3 = FDrawTileNC(hdc,ptile,&rc,pcVar2);
  if (sVar3 == 0) {
    for (i = 0; i < 3; i = i + 1) {
      ShowWindow(((ushort *)rghwndOrderDD)[i],0);
    }
    ShowWindow(hwndOrderED,0);
    return;
  }
  xLeft = rc.left + 4;
  iVar4 = rc.right + -4;
  if (((uint)gd.wFlags >> 3 & 1) == 0) {
    iVar5 = 4;
  }
  else {
    iVar5 = 2;
  }
  iVar6 = rc.bottom + -4;
  dxRight = iVar4 - xLeft;
  rgrcRef[5].top = -5;
  rgrcRef[5].bottom = -6;
  swp = 0x14;
  sVar3 = dxRight;
  if (rgdxOrderDD[0] == dxRight) {
    swp = 0x15;
    sVar3 = rgdxOrderDD[0];
  }
  rgdxOrderDD[0] = sVar3;
  SetWindowPos(rghwndOrderDD[0],0,xLeft,iVar5 + rc.top,dxRight,
               dyArial8 * 10 + dyShipDD,swp);
  ShowWindow(rghwndOrderDD[0],5);
  iVar5 = iVar5 + rc.top + dyShipDD + 3;
  LVar13 = SendMessage(rghwndOrderDD[0],0x407,0,0);
  iVar7 = (int)LVar13;
  BVar8 = IsWindowVisible(rghwndOrderDD[1]);
  if (BVar8 == 0) {
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),rc.left + 3,iVar5,rc.right + -3,rc.bottom + -2);
    FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
  }
  else {
    BVar8 = IsWindowVisible(rghwndOrderDD[2]);
    if (BVar8 == 0) {
      SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),rc.left + 3,iVar5 + dyShipDD + 3,
              rc.right + -3,rc.bottom + -2);
      FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    }
  }
  yTop = iVar5;
  if ((((iVar7 == 1) || (iVar7 == 6)) || (iVar7 == 7)) || (iVar7 == 9)) {
    swp = 0x14;
    if (iVar7 == 1) {
      dxRight2 = (dxRight - dyShipDD) + 2;
    }
    else if (iVar7 == 7) {
      SelectObject(hdc,rghfontArial8[1]);
      pcVar2 = PszGetCompressedString(idsWarpFactor);
      uVar11 = _strlen(pcVar2);
      DVar14 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2),uVar11);
      dxT = (int)DVar14 + 2;
      pcVar2 = PszGetCompressedString(idsIntercept);
      uVar11 = _strlen(pcVar2);
      SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xLeft,iVar5 + 4,xLeft + dxT,iVar6);
      FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
      DRAWTEXT(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2),uVar11,
               (undefined2 *)CONCAT22(unaff_SS,&rc),0x800);
      dxRight2 = (dxRight - dxT) + -2;
      xLeft = xLeft + dxT + 2;
    }
    else if (iVar7 == 9) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar3 = CchGetString(idsTo3,szT);
      szT[sVar3] = ' ';
      szT[sVar3 + 1] = '\0';
      DVar14 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),sVar3 + 1);
      dxT = (int)DVar14 + 2;
      SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xLeft,iVar5 + 4,xLeft + dxT,iVar6);
      FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
      DRAWTEXT(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),sVar3 + 1,(undefined2 *)CONCAT22(unaff_SS,&rc),
               0x800);
      dxRight2 = (dxRight - dxT) + -2;
      xLeft = xLeft + dxT + 2;
    }
    else {
      dxRight2 = dxRight;
    }
    if (rgdxOrderDD[1] == dxRight2) {
      swp = swp | 1;
    }
    else {
      rgdxOrderDD[1] = dxRight2;
    }
    SetWindowPos(rghwndOrderDD[1],0,xLeft,iVar5,dxRight2,dyShipDD * 6,swp);
    ShowWindow(rghwndOrderDD[1],5);
    if (iVar7 == 1) {
      SetRect((undefined2 *)CONCAT22(unaff_SS,&stack0xffb4),
              ((xLeft + dxRight) - (dyShipDD | 1U)) + 8,iVar5 + 3,xLeft + dxRight,
              (dyShipDD | 1U) + iVar5 + -5);
      rgrcRef[5].left = iStack_4c;
      rgrcRef[5].top = ids_2;
      rgrcRef[5].right = dyCur;
      rgrcRef[5].bottom = (short)pcStack_46;
      DrawDiamond(hdc,(RECT *)&stack0xffb4,hbrBBlue);
    }
    else if (iVar7 == 7) {
      yTop = iVar5 + dyShipDD + 4;
      SetRect((undefined2 *)CONCAT22(unaff_SS,&stack0xffb4),(xLeft - dxT) + -2,yTop,rc.right + -5,
              yTop + dyArial8);
      SelectObject(hdc,rghfontArial8[1]);
      pcVar2 = PszGetCompressedString(idsWarpFactor);
      uVar11 = _strlen(pcVar2);
      DRAWTEXT(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2),uVar11,
               (undefined2 *)CONCAT22(unaff_SS,&stack0xffb4),0x800);
      iStack_4c = iStack_4c + dxT + 2;
      rgrcRef[0x12].top = ids_2;
      rgrcRef[0x12].right = dyCur;
      rgrcRef[0x12].bottom = (short)pcStack_46;
      rgrcRef[0x12].left = iStack_4c;
      DrawFleetGauge(hdc,(RECT *)&stack0xffb4,(FLEET *)0x0,7);
    }
  }
  else {
    BVar8 = IsWindowVisible(rghwndOrderDD[1]);
    if (BVar8 != 0) {
      ShowWindow(rghwndOrderDD[1],0);
      SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),rc.left + 3,iVar5,rc.right + -3,rc.bottom + -2);
      FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    }
  }
  yTopMsg = yTop + dyShipDD + 3;
  dyCur = (short)((PLORD *)sel.fl.lpplord + 1);
  pcStack_46 = sel.fl.lpplord._2_2_;
  if ((*(uint *)(dyCur + sel.iwpAct * 0x12 + 6) >> 8 & 0xf) == 1) {
    lppl = LpplFromId(*(short *)(dyCur + sel.iwpAct * 0x12 + 4));
  }
  else {
    lppl = (PLANET *)0x0;
  }
  if (iVar7 == 1) {
    dxKt = 0;
    for (i = 0; i < 5; i = i + 1) {
      DVar14 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                                  (char *)*(undefined2 *)(i * 2 + 0xb48)),2);
      if (dxKt < (int)DVar14) {
        DVar14 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                                    (char *)*(undefined2 *)(i * 2 + 0xb48)),2);
        dxKt = (short)DVar14;
      }
    }
    LVar13 = SendMessage(rghwndOrderDD[1],0x407,0,0);
    if ((int)LVar13 == 0) {
      i = 4;
    }
    else {
      i = (int)LVar13 + -1;
    }
    SelectObject(hdc,rghfontArial8[1]);
    HVar17 = hdc;
    pcVar2 = PszGetCompressedString(idsN99999Kt);
    DVar14 = GetTextExtent(HVar17,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2),9);
    iVar9 = (int)DVar14;
    dxRight = dxRight - (iVar9 + 8);
    swp = 0x14;
    sVar3 = dxRight;
    if (rgdxOrderDD[2] == dxRight) {
      swp = 0x15;
      sVar3 = rgdxOrderDD[2];
    }
    rgdxOrderDD[2] = sVar3;
    SetWindowPos(rghwndOrderDD[2],0,xLeft,yTopMsg,dxRight,dyShipDD * 9,swp);
    ShowWindow(rghwndOrderDD[2],5);
    LVar13 = SendMessage(rghwndOrderDD[2],0x407,0,0);
    fActive = 1;
    if (((LVar13 == 0) || (LVar13 == 1)) || (LVar13 == 2)) {
LAB_1050_10a5:
      fActive = 0;
    }
    else if ((LVar13 == 5) || (LVar13 == 6)) {
      i = 5;
    }
    else if (LVar13 == 7) goto LAB_1050_10a5;
    pcVar2 = (char *)*(undefined2 *)(i * 2 + 0xb48);
    swp = 0x14;
    if (dxOrderED == iVar9 - dxKt) {
      swp = 0x15;
    }
    else {
      dxOrderED = iVar9 - dxKt;
    }
    SetWindowPos(hwndOrderED,0,(iVar4 - iVar9) + -4,yTopMsg,iVar9 - dxKt,dyShipDD,
                 swp);
    EnableWindow(hwndOrderED,fActive);
    ShowWindow(hwndOrderED,5);
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),(iVar4 - dxKt) + -1,yTopMsg + 2,rc.right + -5,iVar6
           );
    FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    if (fActive != 0) {
      DRAWTEXT(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2),2,
               (undefined2 *)CONCAT22(unaff_SS,&rc),0x800);
    }
  }
  else {
    ShowWindow(rghwndOrderDD[2],0);
    ShowWindow(hwndOrderED,0);
  }
  if (iVar7 == 5) {
    ids = 0x25;
    yTopMsg = iVar5;
  }
  else {
    if (iVar7 == 4) {
      if ((*(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) >> 8
          & 0xf) == 2) {
        return;
      }
      pcVar2 = PszGetCompressedString(idsWarningDestinationWaypointFleetMergeWillSucessfu);
      SetTextColor(hdc,0x7f);
      SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xLeft,iVar5,iVar4,rc.bottom + -2);
      SelectObject(hdc,rghfontArial7[0]);
      puVar16 = (undefined1 *)&DAT_1120_1120;
      HVar17 = hdc;
      uVar11 = _strlen(pcVar2);
      DRAWTEXT(HVar17,(LPCSTR)CONCAT22(puVar16,pcVar2),uVar11,(undefined2 *)CONCAT22(unaff_SS,&rc),
               0x810);
      SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
      return;
    }
    if (iVar7 == 6) {
      lVar15 = CLayMinesFromLpfl(&sel.fl,-1,-1);
      if (0 < lVar15) {
        pcStack_46 = PszGetCompressedString(idsFleetCanLayLdMinesPerYear);
        _WSPRINTF((LPSTR)CONCAT22((int)lVar15,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcStack_46,(char *)&DAT_1120_1120),(char *)szWork);
        psz = (char *)szWork;
        goto SHIP_LDisplayMsg2;
      }
      ids = 0xe6;
    }
    else {
      if (iVar7 != 2) {
        if (iVar7 != 3) {
          return;
        }
        lVar15 = CMineFromLpfl(&sel.fl);
        pcStack_46 = (char *)((ulong)lVar15 >> 0x10);
        dyCur = (short)lVar15;
        if (lVar15 < 1) {
          ids_2 = 0xe2;
LAB_1050_1706:
          pcStack_46 = (char *)((ulong)lVar15 >> 0x10);
          dyCur = (short)lVar15;
          if (dyArial8 < 0xf) {
            SelectObject(hdc,rghfontArial7[0]);
          }
          else {
            SelectObject(hdc,rghfontArial6[0]);
          }
        }
        else {
          if (((PLANET *)lppl == (PLANET *)0x0) && (lppl._2_2_ == 0)) {
LAB_1050_16f9:
            ids_2 = 0xe5;
            goto LAB_1050_1706;
          }
          if (((PLANET *)lppl)->iPlayer != -1) {
            if (((PLANET *)lppl)->iPlayer == sel.fl.iPlayer) {
              sVar3 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
              lVar15 = CONCAT22(pcStack_46,dyCur);
              if (sVar3 == 8) goto LAB_1050_15b7;
            }
            goto LAB_1050_16f9;
          }
LAB_1050_15b7:
          pcStack_46 = (char *)((ulong)lVar15 >> 0x10);
          dyCur = (short)lVar15;
          if (dyArial8 < 0xf) {
            SelectObject(hdc,rghfontArial8[0]);
            iStack_4c = dyArial8;
          }
          else {
            SelectObject(hdc,rghfontArial7[0]);
            iStack_4c = dyArial7;
          }
          if (1 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            EstMineralsMined(lppl,rgl,CONCAT22(pcStack_46,dyCur),0);
            sVar3 = CchGetString(idsMiningRatePerYear,(char *)szWork);
            TextOut(hdc,xLeft,iVar5,szWork,sVar3);
            iVar5 = iVar5 + iStack_4c;
            dxRight = xLeft;
            for (i = 0; i < 3; i = i + 1) {
              SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + 0x44a),
                                        *(undefined2 *)(i * 4 + 0x448)));
              sVar3 = _WSPRINTF((LPSTR)CONCAT22((int)rgl[i],(char *)&DAT_1120_1120),
                                (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),
                                (char *)szWork);
              DxStreamTextOut(hdc,&dxRight,iVar5,(char *)szWork,sVar3,1);
              SetTextColor(hdc,CONCAT22(crButtonText._2_2_,
                                        (undefined2)crButtonText));
              DxStreamTextOut(hdc,&dxRight,iVar5,(char *)0x97f,4,1);
            }
            goto SHIP_DoneMine;
          }
          ids_2 = 0xf3;
        }
        uVar10 = (undefined2)crButtonText;
        uVar12 = crButtonText._2_2_;
        if (ids_2 != 0xe5) {
          uVar10 = 0x7f;
          uVar12 = 0;
        }
        SetTextColor(hdc,CONCAT22(uVar12,uVar10));
        pcVar2 = PszGetCompressedString(ids_2);
        SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xLeft,iVar5,iVar4,rc.bottom + -2);
        puVar16 = (undefined1 *)&DAT_1120_1120;
        HVar17 = hdc;
        uVar11 = _strlen(pcVar2);
        DRAWTEXT(HVar17,(LPCSTR)CONCAT22(puVar16,pcVar2),uVar11,(undefined2 *)CONCAT22(unaff_SS,&rc)
                 ,0x810);
SHIP_DoneMine:
        SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
        return;
      }
      bVar1 = false;
      for (i = 0; i < 0x10; i = i + 1) {
        if (0 < *(int *)((int)&sel.fl + 0xc + i * 2)) {
          for (pcStack_46 = (char *)0x0;
              (int)pcStack_46 <
              (int)(uint)*(byte *)(*(int *)(sel.fl.iPlayer * 4 + 0xfe) + i * 0x93 + 0x7a);
              pcStack_46 = pcStack_46 + 1) {
            if ((*(int *)(*(int *)(sel.fl.iPlayer * 4 + 0xfe) + i * 0x93 + 0x3a +
                         (int)pcStack_46 * 4) == 0x1000) &&
               (((*(uint *)(*(int *)(sel.fl.iPlayer * 4 + 0xfe) + i * 0x93 +
                            (int)pcStack_46 * 4 + 0x3c) & 0xff) == 0 ||
                ((*(uint *)(*(int *)(sel.fl.iPlayer * 4 + 0xfe) + i * 0x93 +
                            (int)pcStack_46 * 4 + 0x3c) & 0xff) == 1)))) {
              bVar1 = true;
              goto SHIP_FoundColony;
            }
          }
        }
      }
SHIP_FoundColony:
      if (bVar1) {
        if (((int)sel.fl.rgwtMin[3] == 0) && (sel.fl.rgwtMin[3]._2_2_ == 0)) {
          ids = 0xde;
          yTopMsg = iVar5;
        }
        else {
          ids = 0x24;
          yTopMsg = iVar5;
        }
      }
      else {
        ids = 0x23;
        yTopMsg = iVar5;
      }
    }
  }
  psz = PszGetCompressedString(ids);
SHIP_LDisplayMsg2:
  uVar10 = (undefined2)crButtonText;
  uVar12 = crButtonText._2_2_;
  if (ids != 0x24) {
    uVar10 = 0x7f;
    uVar12 = 0;
  }
  SetTextColor(hdc,CONCAT22(uVar12,uVar10));
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xLeft,yTopMsg,iVar4,rc.bottom + -2);
  SelectObject(hdc,rghfontArial7[0]);
  puVar16 = (undefined1 *)&DAT_1120_1120;
  HVar17 = hdc;
  uVar11 = _strlen(psz);
  DRAWTEXT(HVar17,(LPCSTR)CONCAT22(puVar16,psz),uVar11,(undefined2 *)CONCAT22(unaff_SS,&rc),0x810);
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  return;
}



// ======================================================================
// Function: DrawShipPlanet
// Address: 1050:17b6
// Segment: MEMORY_SHIP
// ======================================================================


void DrawShipPlanet(HDC hdc,TILE *ptile,OBJ obj)

{
  short sVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  BOOL BVar5;
  StringId ids;
  char *pcVar6;
  ushort uVar7;
  THING *lpthMac;
  THING *lpth;
  RECT rc;
  short xLeft;
  short dx;
  char *psz;
  short xRight;
  short i;
  short dy;
  short yTop;
  
  if (*(int *)(obj.ppl)->rgpctMinLevel == -1) {
    psz = PszGetCompressedString(idsDeepSpace2);
  }
  else {
    psz = PszGetPlanetName(*(uint *)(obj.ppl)->rgpctMinLevel | 0x8000);
  }
  if (((uint)ptile->wFlags >> 0xb & 1) != 0) {
    ShowWindow(rghwndBtn[3],0);
    ShowWindow(rghwndBtn[7],0);
    ptile->wFlags = ptile->wFlags & 0xf7ff;
  }
  sVar1 = FDrawTileNC(hdc,ptile,&rc,psz);
  if (sVar1 == 0) {
    ShowWindow(rghwndBtn[3],0);
    ShowWindow(rghwndBtn[7],0);
  }
  else {
    xLeft = rc.left + 4;
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      iVar2 = 4;
    }
    else {
      iVar2 = 1;
    }
    iVar3 = ((rc.right - xLeft) + -0x14) / 3;
    iVar4 = dyArial8 * 3;
    if ((*(int *)(obj.ppl)->rgpctMinLevel == -1) || (sel.pl.iPlayer != idPlayer)) {
      BVar5 = 0;
    }
    else {
      BVar5 = 1;
    }
    EnableWindow(rghwndBtn[3],BVar5);
    if (*(int *)(obj.ppl)->rgpctMinLevel == -1) {
      ids = idsJettison2;
    }
    else {
      ids = idsXFer;
    }
    uVar7 = rghwndBtn[7];
    pcVar6 = PszGetCompressedString(ids);
    SetWindowText(uVar7,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar6));
    if (*(int *)(obj.ppl)->rgpctMinLevel == -1) {
      lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
      while( true ) {
        if (((THING *)lpThings + cThing <= (THING *)lpth) ||
           ((((uint)lpth->idFull >> 0xd == 1 &&
             (*(int *)((obj.ppl)->rgpctMinLevel + 2) == (&((THING *)lpth)->pt)->x)) &&
            (*(int *)((obj.ppl)->rgMinConc + 1) == (((THING *)lpth)->pt).y)))) break;
        lpth = (THING *)CONCAT22(lpth._2_2_,(THING *)lpth + 1);
      }
      if (((THING *)lpth == (THING *)lpThings + cThing) &&
         (lpth._2_2_ == lpThings._2_2_)) {
        BVar5 = 1;
      }
      else {
        BVar5 = 0;
      }
      EnableWindow(rghwndBtn[7],BVar5);
    }
    else {
      EnableWindow(rghwndBtn[7],1);
    }
    if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
      for (i = 3; i < 8; i = i + 4) {
        SetWindowPos(((ushort *)rghwndBtn)[i],0,xLeft,iVar2 + rc.top,iVar3,iVar4 >> 1,0x14
                    );
        ShowWindow(((ushort *)rghwndBtn)[i],5);
        xLeft = xLeft + iVar3 * 2 + 0x10;
      }
    }
  }
  return;
}



// ======================================================================
// Function: DrawShipCargo
// Address: 1050:1a54
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10501b51) */

void DrawShipCargo(HDC hdc,TILE *ptile,OBJ obj)

{
  short dxErase;
  char *pcVar1;
  short sVar2;
  int iVar3;
  int x;
  int iVar4;
  int iVar5;
  short sVar6;
  undefined2 unaff_SS;
  DWORD DVar7;
  DWORD DVar8;
  LPCSTR pcVar9;
  undefined2 uVar10;
  HDC HVar11;
  RECT rc;
  long l;
  short xLeft;
  RECT rcGauge;
  short xRight;
  FLEET *pfl;
  short c;
  short i;
  short yTop;
  long l2;
  short dxRight;
  
  if (((uint)ptile->wFlags >> 0xb & 1) != 0) {
    rgrcRef[2].top = -5;
    rgrcRef[2].bottom = -6;
    rgrcRef[3].top = -5;
    rgrcRef[3].bottom = -6;
  }
  pcVar1 = PszGetCompressedString(idsFuelCargo);
  sVar2 = FDrawTileNC(hdc,ptile,&rc,pcVar1);
  dxErase = dxMaxMineralQuan;
  if (sVar2 != 0) {
    iVar3 = rc.left + 4;
    x = rc.right + -4;
    iVar4 = rc.top + 1;
    SelectObject(hdc,rghfontArial8[1]);
    sVar2 = CchGetString(idsCargo3,(char *)szWork);
    DVar7 = GetTextExtent(hdc,szWork,sVar2);
    sVar2 = CchGetString(idsFuel3,(char *)szWork);
    DVar8 = GetTextExtent(hdc,szWork,sVar2);
    if ((long)DVar7 < (long)DVar8) {
      DVar7 = DVar8;
    }
    if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
      TextOut(hdc,iVar3,iVar4,szWork,sVar2);
    }
    l._0_2_ = (int)DVar7;
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rcGauge),iVar3 + (int)l,iVar4,x,
            iVar4 + dyArial8);
    rgrcRef[2].left = rcGauge.left;
    rgrcRef[2].top = rcGauge.top;
    rgrcRef[2].right = rcGauge.right;
    rgrcRef[2].bottom = rcGauge.bottom;
    DrawFleetGauge(hdc,&rcGauge,(FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,obj.ppl),4);
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      iVar5 = 4;
    }
    else {
      iVar5 = 2;
    }
    iVar4 = iVar4 + iVar5 + dyArial8;
    if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
      sVar2 = CchGetString(idsCargo3,(char *)szWork);
      TextOut(hdc,iVar3,iVar4,szWork,sVar2);
    }
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rcGauge),iVar3 + (int)l,iVar4,x,
            iVar4 + dyArial8);
    rgrcRef[3].left = rcGauge.left;
    rgrcRef[3].top = rcGauge.top;
    rgrcRef[3].right = rcGauge.right;
    rgrcRef[3].bottom = rcGauge.bottom;
    DrawFleetGauge(hdc,&rcGauge,(FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,obj.ppl),5);
    yTop = iVar4 + dyArial8 + 4;
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      for (i = 0; i < 3; i = i + 1) {
        if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
          SelectObject(hdc,rghfontArial8[1]);
          SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + 0x44a),*(undefined2 *)(i * 4 + 0x448)));
          pcVar9 = (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                    (char *)*(undefined2 *)(i * 2 + 0x4cc));
          sVar2 = yTop;
          iVar4 = iVar3;
          HVar11 = hdc;
          sVar6 = lstrlen((LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                           (char *)*(undefined2 *)(i * 2 + 0x4cc)));
          TextOut(HVar11,iVar4,sVar2,pcVar9,sVar6);
        }
        SelectObject(hdc,rghfontArial8[0]);
        SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
        uVar10 = (undefined2)obj.ppl[1].rgwtMin[i + -2];
        pcVar1 = PszGetCompressedString(idsLdkt);
        sVar2 = _WSPRINTF((LPSTR)CONCAT22(uVar10,(char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(pcVar1,(char *)&DAT_1120_1120),(char *)szWork);
        RightTextOut(hdc,x,yTop,(char *)szWork,sVar2,dxErase);
        yTop = yTop + dyArial8;
      }
      if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
        SelectObject(hdc,rghfontArial8[1]);
        SetTextColor(hdc,0xffffff);
        sVar2 = CchGetString(idsColonists2,(char *)szWork);
        TextOut(hdc,iVar3,yTop,szWork,sVar2);
        SelectObject(hdc,rghfontArial8[0]);
        SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
      }
      uVar10 = (undefined2)obj.ppl[1].rgwtMin[1];
      pcVar1 = PszGetCompressedString(idsLdkt);
      sVar2 = _WSPRINTF((LPSTR)CONCAT22(uVar10,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(pcVar1,(char *)&DAT_1120_1120),(char *)szWork);
      RightTextOut(hdc,x,yTop,(char *)szWork,sVar2,dxErase);
    }
  }
  return;
}



// ======================================================================
// Function: DrawFleetComp
// Address: 1050:1e72
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050220e) */

void DrawFleetComp(HDC hdc,TILE *ptile,OBJ obj)

{
  char *pcVar1;
  short sVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  undefined2 uVar6;
  uint uVar7;
  undefined2 unaff_SS;
  bool bVar8;
  DWORD DVar9;
  long lVar10;
  ushort uVar11;
  RECT rc;
  long l;
  short xLeft;
  short dxLabel;
  short xRight;
  short xStart;
  FLEET *pfl;
  short i;
  short c;
  short dyWrong;
  RECT rcT;
  short yTop;
  short dxRight;
  short swp;
  long cBoat;
  
  if (((uint)ptile->wFlags >> 0xb & 1) != 0) {
    ShowWindow(hwndFleetCompLB,0);
    ShowWindow(rghwndBtn[8],0);
    ShowWindow(rghwndBtn[9],0);
    ShowWindow(rghwndBtn[10],0);
    ShowWindow(hwndBattleDD,0);
    ptile->wFlags = ptile->wFlags & 0xf7ff;
  }
  pcVar1 = PszGetCompressedString(idsFleetComposition);
  sVar2 = FDrawTileNC(hdc,ptile,&rc,pcVar1);
  if (sVar2 == 0) {
    ShowWindow(hwndFleetCompLB,0);
    ShowWindow(rghwndBtn[8],0);
    ShowWindow(rghwndBtn[9],0);
    ShowWindow(rghwndBtn[10],0);
    ShowWindow(hwndBattleDD,0);
  }
  else {
    xStart = rc.left + 4;
    iVar3 = rc.right + -4;
    GetClientRect(hwndFleetCompLB,(undefined2 *)CONCAT22(unaff_SS,&rcT));
    swp = 0x14;
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      iVar4 = 5;
    }
    else {
      iVar4 = 3;
    }
    dyFleetCompLB = (dyArial8 + 2) * iVar4;
    iVar4 = dyFleetCompLB - (rcT.bottom - rcT.top);
    if (((dxFleetCompLB == iVar3 - xStart) && (-1 < iVar4)) && (iVar4 < dyArial8))
    {
      swp = 0x15;
    }
    else {
      dxFleetCompLB = iVar3 - xStart;
    }
    SetWindowPos(hwndFleetCompLB,0,xStart,rc.top + 3,iVar3 - xStart,dyFleetCompLB,
                 swp);
    ShowWindow(hwndFleetCompLB,5);
    GetClientRect(hwndFleetCompLB,(undefined2 *)CONCAT22(unaff_SS,&rcT));
    dyFleetCompLB = rcT.bottom - rcT.top;
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      iVar4 = 4;
    }
    else {
      iVar4 = 2;
    }
    iVar4 = rc.top + 3 + iVar4 + dyFleetCompLB;
    SelectObject(hdc,rghfontArial8[1]);
    sVar2 = CchGetString(idsBattlePlan2,(char *)szWork);
    DVar9 = GetTextExtent(hdc,szWork,sVar2);
    iVar5 = (int)DVar9;
    if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
      TextOut(hdc,xStart,iVar4 + 4,szWork,sVar2);
    }
    swp = 0x14;
    if (dxBattleDD == (iVar3 - xStart) - iVar5) {
      swp = 0x15;
    }
    else {
      dxBattleDD = (iVar3 - xStart) - iVar5;
    }
    SetWindowPos(hwndBattleDD,0,xStart + iVar5,iVar4,dxBattleDD,
                 dyShipDD * 5,swp);
    ShowWindow(hwndBattleDD,5);
    yTop = iVar4 + dyShipDD + 3;
    sVar2 = CchGetString(idsEstRange,(char *)szWork);
    GetTextExtent(hdc,szWork,sVar2);
    if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
      TextOut(hdc,xStart,yTop,szWork,sVar2);
    }
    SelectObject(hdc,rghfontArial8[0]);
    sVar2 = CchGetString(idsN9999LY,(char *)szWork);
    DVar9 = GetTextExtent(hdc,szWork,sVar2);
    iVar4 = (int)DVar9 + 6;
    sVar2 = IFindIdealWarp((FLEET *)0x0,0);
    lVar10 = EstFuelUse(&sel.fl,0,sVar2,-1,1);
    uVar6 = (undefined2)lVar10;
    if (lVar10 < 1000000000) {
      pcVar1 = PszGetCompressedString(idsLdLY);
      c = _WSPRINTF((LPSTR)CONCAT22(uVar6,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar1,(char *)&DAT_1120_1120),(char *)szWork);
    }
    else {
      c = CchGetString(idsInfinite,(char *)szWork);
    }
    RightTextOut(hdc,iVar3,yTop,(char *)szWork,c,iVar4);
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      yTop = yTop + dyArial8;
      if (((uint)ptile->wFlags >> 0xc & 1) == 0) {
        SelectObject(hdc,rghfontArial8[1]);
        sVar2 = CchGetString(idsPercentCloaked,(char *)szWork);
        TextOut(hdc,xStart,yTop,szWork,sVar2);
      }
      SelectObject(hdc,rghfontArial8[0]);
      sVar2 = PctCloakFromLpfl(&sel.fl);
      if (sVar2 == 0) {
        c = CchGetString(idsNone2,(char *)szWork);
      }
      else {
        c = _WSPRINTF((LPSTR)CONCAT22(sVar2,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTDPCTPCT,(char *)&DAT_1120_1120),
                      (char *)szWork);
      }
      RightTextOut(hdc,iVar3,yTop,(char *)szWork,c,iVar4);
    }
    uVar7 = (uint)gd.wFlags >> 3;
    iVar4 = dyArial8 + 2;
    iVar3 = ((iVar3 - xStart) + -10) / 3;
    for (i = 8; i < 0xb; i = i + 1) {
      SetWindowPos(((ushort *)rghwndBtn)[i],0,xStart,yTop + (iVar4 - (uVar7 & 1)),iVar3,
                   (dyArial8 >> 1) + dyArial8,0x14);
      ShowWindow(((ushort *)rghwndBtn)[i],5);
      xStart = xStart + iVar3 + 6;
    }
    cBoat._0_2_ = 0;
    cBoat._2_2_ = 0;
    for (i = 0; i < 0x10; i = i + 1) {
      uVar7 = *(uint *)((int)&sel.fl + 0xc + i * 2);
      bVar8 = CARRY2((uint)cBoat,uVar7);
      cBoat._0_2_ = (uint)cBoat + uVar7;
      cBoat._2_2_ = cBoat._2_2_ + ((int)uVar7 >> 0xf) + (uint)bVar8;
    }
    uVar11 = rghwndBtn[8];
    sVar2 = FCanSplit(CONCAT22(cBoat._2_2_,(uint)cBoat));
    EnableWindow(uVar11,sVar2);
    uVar11 = rghwndBtn[9];
    sVar2 = FCanSplitAll(CONCAT22(cBoat._2_2_,(uint)cBoat));
    EnableWindow(uVar11,sVar2);
    uVar11 = rghwndBtn[10];
    sVar2 = FCanMerge((FLEET *)obj.ppl);
    EnableWindow(uVar11,sVar2);
  }
  return;
}



// ======================================================================
// Function: FCanSplit
// Address: 1050:245c
// Segment: MEMORY_SHIP
// ======================================================================


short FCanSplit(long cBoat)

{
  short sVar1;
  
  if ((*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) & 0xfff) == 0x200) {
    sVar1 = 0;
  }
  else if ((cBoat < 0) || ((cBoat < 0x10000 && ((uint)cBoat < 2)))) {
    sVar1 = 0;
  }
  else {
    sVar1 = 1;
  }
  return sVar1;
}



// ======================================================================
// Function: FCanSplitAll
// Address: 1050:24ae
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x105024e9) */
/* WARNING: Removing unreachable block (ram,0x10502506) */

short FCanSplitAll(long cBoat)

{
  short sVar1;
  
  if ((long)(cBoat + -1 +
            (ulong)(*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) & 0xfff)) <
      0x201) {
    if (cBoat < 2) {
      sVar1 = 0;
    }
    else {
      sVar1 = 1;
    }
  }
  else {
    sVar1 = 0;
  }
  return sVar1;
}



// ======================================================================
// Function: FCanMerge
// Address: 1050:2522
// Segment: MEMORY_SHIP
// ======================================================================


short FCanMerge(FLEET *pfl)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  short sVar4;
  bool bVar5;
  short ishdef;
  short cfl;
  long csh;
  FLEET *lpfl;
  short i;
  
  cfl = 0;
  csh._0_2_ = 0;
  csh._2_2_ = 0;
  for (i = 0; i < cFleet; i = i + 1) {
    iVar1 = *(int *)((FLEET **)rglpfl + i);
    iVar2 = *(int *)((int)((FLEET **)rglpfl + i) + 2);
    if ((iVar1 == 0) && (iVar2 == 0)) break;
    if ((*(int *)(iVar1 + 2) == pfl->iPlayer) &&
       ((*(int *)(iVar1 + 8) == sel.fl.pt.x &&
        (*(int *)(iVar1 + 10) == sel.fl.pt.y)))) {
      cfl = cfl + 1;
      for (ishdef = 0; ishdef < 0x10; ishdef = ishdef + 1) {
        uVar3 = *(uint *)(iVar1 + 0xc + ishdef * 2);
        bVar5 = CARRY2((uint)csh,uVar3);
        csh._0_2_ = (uint)csh + uVar3;
        csh._2_2_ = csh._2_2_ + ((int)uVar3 >> 0xf) + (uint)bVar5;
      }
    }
  }
  if ((cfl == 1) ||
     ((-1 < csh._2_2_ &&
      ((0 < csh._2_2_ ||
       (0x7ffe - ((*(uint *)((int)&rgplr[0].wFlags + pfl->iPlayer * 0xc0) & 0xfff) - 1) <
        (uint)csh)))))) {
    sVar4 = 0;
  }
  else {
    sVar4 = 1;
  }
  return sVar4;
}



// ======================================================================
// Function: ShipCommandProc
// Address: 1050:2640
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10502a10) */
/* WARNING: Removing unreachable block (ram,0x10502a4a) */

void ShipCommandProc(HWND hwnd,ushort wParam,long lParam)

{
  int iVar1;
  bool bVar2;
  PLORD *pPVar3;
  PLORD *pPVar4;
  undefined2 uVar5;
  undefined2 uVar6;
  uint uVar7;
  char *pcVar8;
  int iVar9;
  int *piVar10;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar11;
  FARPROC pvVar12;
  FLEET *pFVar13;
  LRESULT LVar14;
  long lVar15;
  char *pcVar16;
  undefined1 *puVar17;
  short sVar18;
  ulong uVar19;
  ushort in_stack_0000fb44;
  int *piStack_c2;
  short iInit;
  short i;
  char rgb [8];
  long lMin;
  char szT [34];
  XFER xf;
  long lSel;
  void *lpProc;
  short fPercent;
  
  uVar19 = CONCAT22(unaff_SI,unaff_DI);
  bVar2 = false;
  uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
  if ((int)uVar11 == 0) {
    SetFocus(hwndFrame);
  }
  if (((HWND)lParam == rghwndBtn[4]) &&
     (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    SelectAdjFleet(-1,0);
  }
  else if (((HWND)lParam == rghwndBtn[5]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    SelectAdjFleet(1,0);
  }
  else if (((HWND)lParam == rghwndBtn[6]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    pcVar8 = PszGetFleetName(sel.fl.id);
    _strcpy((char *)szWork,pcVar8);
    StickyDlgPos(hwnd,(POINT *)&ptStickyRenameDlg,0);
    pvVar12 = MakeProcInstance(RenameDlg,hInst);
    sVar18 = DialogBox(0,(LPCSTR)CONCAT22(0x7e3,hwndFrame),(HWND)((ulong)pvVar12 >> 0x10),
                       (void *)pvVar12);
    if (sVar18 == 0) {
      FreeProcInstance(pvVar12);
    }
    else {
      FreeProcInstance(pvVar12);
      _strcpy(szT,(char *)szWork);
      pcVar8 = PszGetFleetName(sel.fl.id);
      sVar18 = _strcmp(szT,pcVar8);
      if (sVar18 != 0) {
        LogChangeName(grobjFleet,sel.fl.id,szT);
        InvalidateReport(1,1);
        FillOrdersLB();
        DrawPlanShip(0,-0x7f60);
        InvalidateRect(hwndMessage,(undefined2 *)0x0,1);
        InvalidateRect(hwndScanner,(undefined2 *)0x0,1);
        SetMineralTitleBar(hwndMine);
      }
    }
  }
  else if (((HWND)lParam == rghwndBtn[3]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    SelectAdjPlanet(0,sel.fl.idPlanet);
    SetFleetDropDownSel(sel.fl.id);
  }
  else if (((HWND)lParam == rghwndBtn[7]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    if (sel.fl.idPlanet == -1) {
      TransferStuff(sel.fl.id,2,-1,4,0);
    }
    else {
      TransferStuff(sel.fl.id,2,sel.fl.idPlanet,1,0);
    }
  }
  else if ((HWND)lParam == hwndShipDD) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if ((int)uVar11 == 1) {
      DrawPlanShip(0,-0x7ffc);
    }
  }
  else if ((HWND)lParam == hwndShipLB) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if ((int)uVar11 == 1) {
      LVar14 = SendMessage(hwndShipLB,0x409,0,0);
      SetScanWp((short)LVar14);
    }
  }
  else if ((HWND)lParam == hwndFleetCompLB) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if (((int)uVar11 == 1) &&
       (lVar15 = SendMessage(hwndFleetCompLB,0x409,0,0), -1 < lVar15)) {
      rgb[6] = '\0';
      rgb[7] = '\0';
      while( true ) {
        lSel._2_2_ = (int)((ulong)lVar15 >> 0x10);
        lSel._0_2_ = (int)lVar15;
        if ((0xf < (int)rgb._6_2_) ||
           ((0 < *(int *)((int)&sel.fl + 0xc + rgb._6_2_ * 2) &&
            (bVar2 = lVar15 < 1,
            lVar15 = CONCAT22(lSel._2_2_ - (uint)((int)lSel == 0),(int)lSel + -1), bVar2)))) break;
        rgb._6_2_ = rgb._6_2_ + 1;
      }
      GlobalPD.grPopup = 0xb;
      GlobalPD._2_2_ = rgb._6_2_ * 0x93 + 0x3f00;
      GlobalPD.psz = (char *)&DAT_1120_1120;
      GlobalPD.iPlanMin = 0;
      GlobalPD.iPlanVal = 1;
      GlobalPD.iPlanMax = 0;
      GlobalPD.iPlrVal = 0;
      Popup(hwndFleetCompLB,10,10);
    }
  }
  else if ((HWND)lParam == hwndBattleDD) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if (((int)uVar11 == 1) && (LVar14 = SendMessage(hwndBattleDD,0x407,0,0), LVar14 != -1)
       ) {
      if (LVar14 == 0) {
        pvVar12 = MakeProcInstance(BattlePlansDlg,hInst);
        sVar18 = DialogBox(0,(LPCSTR)CONCAT22(0x7dd,hwndFrame),
                           (HWND)((ulong)pvVar12 >> 0x10),(void *)pvVar12);
        FreeProcInstance(pvVar12);
        sel.fl.iplan = (byte)sVar18;
      }
      else {
        sel.fl.iplan = (char)LVar14 - 1;
      }
      FLookupFleet(-1,(FLEET *)&sel.fl);
    }
  }
  else if (((HWND)lParam == rghwndBtn[0]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    LVar14 = SendMessage(hwndShipDD,0x407,0,0);
    if ((LVar14 != -1) &&
       (sVar18 = FLookupOrbitingXfer
                           (sel.pl.id,(short)LVar14,&xf,sel.fl.id), sVar18 != 0)
       ) {
      TransferStuff(sel.fl.id,2,xf.id,xf.grobj,0);
    }
  }
  else if (((HWND)lParam == rghwndBtn[1]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    LVar14 = SendMessage(hwndShipDD,0x407,0,0);
    if (((LVar14 != -1) &&
        (sVar18 = FLookupOrbitingXfer
                            (sel.pl.id,(short)LVar14,&xf,sel.fl.id), sVar18 != 0
        )) && (xf.grobj == grobjFleet)) {
      SelectAdjFleet(0,xf.id);
    }
  }
  else if (((HWND)lParam == rghwndBtn[2]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    LVar14 = SendMessage(hwndShipDD,0x407,0,0);
    if (((LVar14 != -1) &&
        (sVar18 = FLookupOrbitingXfer
                            (sel.pl.id,(short)LVar14,&xf,sel.fl.id), sVar18 != 0
        )) && (xf.grobj == grobjFleet)) {
      TransferStuff(sel.fl.id,2,xf.id,2,1);
      if ((grbitScan & 0x80) != 0) {
        InvalidateRect(hwndScanner,(undefined2 *)0x0,1);
      }
      InvalidateReport(1,1);
    }
  }
  else if (((HWND)lParam == rghwndBtn[8]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    TransferStuff(sel.fl.id,2,-1,4,1);
    InvalidateReport(1,1);
    if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
      AdvanceTutor();
    }
  }
  else if (((HWND)lParam == rghwndBtn[9]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    FFleetSplitAll((FLEET *)&sel.fl);
    FillShipDD(sel.fl.id);
    rgb[6] = -0x4b;
    rgb[7] = -0x7d;
    FLookupFleet(sel.fl.id,(FLEET *)&sel.fl);
    FillFleetCompLB();
    DrawPlanShip(0,rgb._6_2_);
    InvalidateRect(hwndMine,(undefined2 *)0x0,1);
  }
  else if (((HWND)lParam == rghwndBtn[10]) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    vrgiflMerge = (short *)&stack0xfb44;
    vcflMerge = 0;
    rgb[6] = '\0';
    rgb[7] = '\0';
    for (; (int)rgb._6_2_ < cFleet; rgb._6_2_ = rgb._6_2_ + 1) {
      iVar9 = *(int *)((FLEET **)rglpfl + rgb._6_2_);
      iVar1 = *(int *)((int)((FLEET **)rglpfl + rgb._6_2_) + 2);
      if ((iVar9 == 0) && (iVar1 == 0)) break;
      if ((*(int *)(iVar9 + 2) == idPlayer) &&
         ((((*(uint *)(iVar9 + 4) >> 10 & 1) == 0 && (*(int *)(iVar9 + 8) == sel.fl.pt.x))
          && (*(int *)(iVar9 + 10) == sel.fl.pt.y)))) {
        *(undefined2 *)(&stack0xfb44 + vcflMerge * 2) = rgb._6_2_;
        vcflMerge = vcflMerge + 1;
      }
    }
    rgb[2] = '\0';
    rgb[3] = '\0';
    rgb[4] = '\0';
    rgb[5] = '\0';
    pvVar12 = MakeProcInstance(MergeFleetsDlg,hInst);
    sVar18 = DialogBox(0,(LPCSTR)CONCAT22(0x52,hwndFrame),(HWND)((ulong)pvVar12 >> 0x10),
                       (void *)pvVar12);
    pFVar13 = (FLEET *)CONCAT22(rgb._4_2_,rgb._2_2_);
    if (sVar18 != 0) {
      rgb[6] = '\0';
      rgb[7] = '\0';
      for (; pFVar13 = (FLEET *)CONCAT22(rgb._4_2_,rgb._2_2_), (int)rgb._6_2_ < vcflMerge;
          rgb._6_2_ = rgb._6_2_ + 1) {
        if (vrgiflMerge[rgb._6_2_] != -1) {
          if (((FLEET **)rglpfl)[vrgiflMerge[rgb._6_2_]]->id == sel.fl.id
             ) {
            rgb._2_2_ = *(undefined2 *)((FLEET **)rglpfl + vrgiflMerge[rgb._6_2_]);
            rgb._4_2_ = *(undefined2 *)
                         (char *)((int)((FLEET **)rglpfl + vrgiflMerge[rgb._6_2_])
                                 + 2);
          }
          vrgiflMerge[rgb._6_2_] =
               ((FLEET **)rglpfl)[vrgiflMerge[rgb._6_2_]]->id;
        }
      }
      rgb[6] = '\0';
      rgb[7] = '\0';
      for (; rgb._2_4_ = pFVar13, (int)rgb._6_2_ < vcflMerge; rgb._6_2_ = rgb._6_2_ + 1) {
        if (vrgiflMerge[rgb._6_2_] != -1) {
          if (pFVar13 == (FLEET *)0x0) {
            pFVar13 = LpflFromId(vrgiflMerge[rgb._6_2_]);
          }
          else if (vrgiflMerge[rgb._6_2_] != pFVar13->id) break;
        }
      }
      if (rgb._6_2_ == vcflMerge) {
        pFVar13 = (FLEET *)0x0;
      }
      else if (pFVar13->id != sel.fl.id) {
        SelectAdjFleet(0,pFVar13->id);
        pFVar13 = (FLEET *)rgb._2_4_;
      }
    }
    rgb._2_4_ = pFVar13;
    FreeProcInstance(pvVar12);
    if (rgb._2_4_ != 0) {
      FFleetMergeAll((FLEET *)&sel.fl);
      FillShipDD(sel.fl.id);
      rgb[0] = -0x4b;
      rgb[1] = -0x7d;
      FLookupFleet(sel.fl.id,(FLEET *)&sel.fl);
      FillFleetCompLB();
      DrawPlanShip(0,rgb._0_2_);
      InvalidateRect(hwndMine,(undefined2 *)0x0,1);
      if ((grbitScan & 0x80) != 0) {
        InvalidateRect(hwndScanner,(undefined2 *)0x0,1);
      }
      vrgiflMerge = (short *)0x0;
      vcflMerge = 0;
      if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
        AdvanceTutor();
      }
    }
  }
  else if (((HWND)lParam == hwndRepCB) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0)) {
    LVar14 = SendMessage(hwndRepCB,0x400,0,0);
    rgb._6_2_ = (undefined2)LVar14;
    sel.fl.wFlags = sel.fl.wFlags & 0xfdffU | (rgb._6_2_ & 1) << 9;
    FLookupFleet(-1,(FLEET *)&sel.fl);
  }
  else if ((HWND)lParam == rghwndOrderDD[0]) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if ((int)uVar11 == 1) {
      LVar14 = SendMessage(rghwndOrderDD[0],0x407,0,0);
      uVar7 = (uint)LVar14;
      if (uVar7 != (*(uint *)((int)(PLORD *)sel.fl.lpplord +
                             sel.iwpAct * 0x12 + 10) & 0xf)) {
        if ((LVar14 == 3) ||
           ((*(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) &
            0xf) == 3)) {
          rgb._6_2_ = uVar7;
          InvalidateRect(hwndMine,(undefined2 *)0x0,1);
        }
        rgb._2_2_ = *(uint *)((int)(PLORD *)sel.fl.lpplord +
                             sel.iwpAct * 0x12 + 10) & 0xfff0 | uVar7 & 0xf;
        *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) =
             rgb._2_2_;
        rgb._4_2_ = (PLORD *)sel.fl.lpplord + 1;
        rgb[6] = sel.fl.lpplord._2_1_;
        rgb[7] = sel.fl.lpplord._3_1_;
        __fmemset((void *)CONCAT22(sel.fl.lpplord._2_2_,
                                           (void *)(rgb._4_2_ + sel.iwpAct * 0x12 + 8)),0,
                          10);
        if (uVar7 == 7) {
          *(undefined2 *)
           ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xe) = 0;
          *(undefined2 *)
           ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc) = 0;
        }
        else if (uVar7 == 9) {
          *(undefined2 *)
           ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc) = 0;
        }
        else if (uVar7 == 6) {
          *(undefined2 *)
           ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc) = 5;
        }
        else if ((uVar7 == 4) &&
                ((*(uint *)((int)(PLORD *)sel.fl.lpplord +
                           sel.iwpAct * 0x12 + 10) >> 8 & 0xf) != 2)) {
          _piStack_c2 = (int *)0x0;
          i = 0;
          rgb[6] = '\x01';
          rgb[7] = '\0';
          for (; (int)rgb._6_2_ < 0x10; rgb._6_2_ = rgb._6_2_ + 1) {
            if (*(int *)((int)&sel.fl + 0xc + i * 2) <
                *(int *)((int)&sel.fl + 0xc + rgb._6_2_ * 2)) {
              i._0_1_ = rgb[6];
              i._1_1_ = rgb[7];
            }
          }
          rgb[4] = '\0';
          rgb[5] = '\0';
          for (; (int)rgb._4_2_ < cFleet; rgb._4_2_ = rgb._4_2_ + 1) {
            rgb._0_2_ = *(undefined2 *)((FLEET **)rglpfl + rgb._4_2_);
            rgb._2_2_ = *(int *)((int)((FLEET **)rglpfl + rgb._4_2_) + 2);
            if (((int *)rgb._0_2_ == (int *)0x0) && (rgb._2_2_ == 0)) break;
            piVar10 = (int *)((int)(PLORD *)sel.fl.lpplord +
                             sel.iwpAct * 0x12 + 4);
            if ((*(int *)(rgb._0_2_ + 8) == *piVar10) &&
               ((((*(int *)(rgb._0_2_ + 10) == piVar10[1] &&
                  (*(int *)(rgb._0_2_ + 2) == idPlayer)) &&
                 ((*(uint *)(rgb._0_2_ + 4) >> 10 & 1) == 0)) &&
                (*(int *)CONCAT22(rgb._2_2_,rgb._0_2_) != sel.fl.id)))) {
              if (*(int *)(rgb._0_2_ + (i + 6) * 2) < 1) {
                if (((piStack_c2 == (int *)0x0) && (iInit == 0)) ||
                   ((1 < piStack_c2[0x31] && (*(int *)(rgb._0_2_ + 0x62) == 1)))) {
                  _piStack_c2 = (int *)CONCAT22(rgb._2_2_,rgb._0_2_);
                }
              }
              else {
                _piStack_c2 = (int *)CONCAT22(rgb._2_2_,rgb._0_2_);
                if (*(int *)(rgb._0_2_ + 0x62) == 1) break;
              }
            }
          }
          if ((piStack_c2 != (int *)0x0) || (iInit != 0)) {
            *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) =
                 *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10
                          ) & 0xf0ff | 0x200;
            *(int *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 8) =
                 *_piStack_c2;
            FLookupFleet(-1,(FLEET *)&sel.fl);
            FillOrdersLB();
          }
        }
        FLookupFleet(-1,(FLEET *)&sel.fl);
        UpdateOrdersDDs(1);
        DrawPlanShip(0,-0x7f00);
      }
    }
  }
  else if ((HWND)lParam == rghwndOrderDD[1]) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if ((int)uVar11 == 1) {
      LVar14 = SendMessage(rghwndOrderDD[1],0x407,0,0);
      rgb._6_2_ = (undefined2)LVar14;
      if ((*(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) &
          0xf) == 7) {
        *(undefined2 *)
         (char *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xe) =
             rgb._6_2_;
        FLookupFleet(-1,(FLEET *)&sel.fl);
        UpdateOrdersDDs(1);
      }
      else if ((*(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10)
               & 0xf) == 9) {
        *(undefined2 *)
         (char *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc) =
             rgb._6_2_;
        FLookupFleet(-1,(FLEET *)&sel.fl);
        UpdateOrdersDDs(1);
      }
      else if ((*(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10)
               & 0xf) == 1) {
        UpdateOrdersDDs(2);
        DrawPlanShip(0,0x100);
      }
      else {
        *(undefined2 *)
         (char *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc) =
             rgb._6_2_;
        *(undefined2 *)
         (char *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xe) =
             rgb._6_2_;
        FLookupFleet(-1,(FLEET *)&sel.fl);
      }
    }
  }
  else if ((HWND)lParam == rghwndOrderDD[2]) {
    uVar11 = __aFulshr(uVar19,in_stack_0000fb44);
    if ((int)uVar11 == 1) {
      LVar14 = SendMessage(rghwndOrderDD[2],0x407,0,0);
      SendMessage(rghwndOrderDD[1],0x407,0,0);
      lSel._0_2_ = (int)LVar14;
      rgb[6] = (undefined1)lSel;
      rgb[7] = lSel._1_1_;
      rgb._4_2_ = (int)lSel << 0xc;
      rgb._0_2_ = (int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc;
      rgb[2] = sel.fl.lpplord._2_1_;
      rgb[3] = sel.fl.lpplord._3_1_;
      lVar15 = __aFlshl(uVar19,in_stack_0000fb44);
      uVar5 = sel.fl.lpplord._2_2_;
      pPVar3 = (PLORD *)sel.fl.lpplord;
      uVar7 = *(uint *)(rgb._0_2_ + (int)lVar15) & 0xfff | rgb._4_2_;
      iVar9 = sel.iwpAct * 0x12;
      lVar15 = __aFlshl(uVar19,in_stack_0000fb44);
      *(uint *)((int)pPVar3 + (int)lVar15 + iVar9 + 0xc) = uVar7;
      FLookupFleet(-1,(FLEET *)&sel.fl);
      UpdateOrdersDDs(3);
      DrawPlanShip(0,0x100);
    }
  }
  else if (((HWND)lParam == hwndOrderED) &&
          (uVar11 = __aFulshr(uVar19,in_stack_0000fb44), (int)uVar11 == 0x300)) {
    LVar14 = SendMessage(rghwndOrderDD[2],0x407,0,0);
    if ((LVar14 == 5) || (LVar14 == 6)) {
      bVar2 = true;
    }
    GetWindowText(hwndOrderED,(LPSTR)CONCAT22(unaff_SS,rgb),8);
    pcVar8 = rgb;
    puVar17 = (undefined1 *)0x14f8;
    pcVar16 = (char *)0x3b75;
    uVar7 = _atoi(pcVar8);
    i = uVar7;
    if (0x7fff < uVar7) {
      i = 0;
    }
    if (bVar2) {
      if (100 < i) {
        i = 100;
      }
    }
    else if (4000 < i) {
      i = 4000;
    }
    if (uVar7 != i) {
      sVar18 = 0x10;
      pcVar8 = PszFormatIds(idsAmountCargoMaySpecifyHereMustBetween,(short *)0x0);
      AlertSz(pcVar8,sVar18);
      _WSPRINTF((LPSTR)CONCAT22(i,(char *)&DAT_1120_1120),
                (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
      puVar17 = (undefined1 *)&DAT_1120_1120;
      pcVar16 = (char *)szWork;
      pcVar8 = (char *)hwndOrderED;
      SetWindowText(hwndOrderED,szWork);
    }
    SendMessage(rghwndOrderDD[1],0x407,0,0);
    uVar5 = sel.fl.lpplord._2_2_;
    pPVar3 = (PLORD *)sel.fl.lpplord;
    iVar9 = sel.iwpAct * 0x12;
    lVar15 = __aFlshl((long)CONCAT22(puVar17,pcVar16),(ushort)pcVar8);
    uVar6 = sel.fl.lpplord._2_2_;
    pPVar4 = (PLORD *)sel.fl.lpplord;
    uVar7 = *(uint *)((int)pPVar3 + (int)lVar15 + iVar9 + 0xc);
    iVar9 = sel.iwpAct * 0x12;
    lVar15 = __aFlshl((long)CONCAT22(puVar17,pcVar16),(ushort)pcVar8);
    *(uint *)((int)pPVar4 + (int)lVar15 + iVar9 + 0xc) = uVar7 & 0xf000 | i & 0xfffU;
    FLookupFleet(-1,(FLEET *)&sel.fl);
  }
  return;
}



// ======================================================================
// Function: SelectAdjFleet
// Address: 1050:3d32
// Segment: MEMORY_SHIP
// ======================================================================


void SelectAdjFleet(short dInc,short idFleet)

{
  int iVar1;
  short iObjSel;
  FLEET *pFVar2;
  undefined2 uVar3;
  POINT pt_00;
  SCAN scan;
  FLEET *lpflT;
  short idNew;
  FLEET *lpfl;
  short i;
  short idOld;
  POINT pt;
  
  idOld = -1;
  if (0 < cFleet) {
    if (dInc != 0) {
      idFleet = sel.fl.id;
    }
    if (vrptFleet.fCached == 0) {
      InvalidateReport(1,1);
    }
    for (i = 0; i < cFleet; i = i + 1) {
                    /* WARNING: Load size is inaccurate */
      pFVar2 = ((FLEET **)rglpfl)[i];
      iVar1 = *(int *)((int)((FLEET **)rglpfl + i) + 2);
      lpfl = (FLEET *)CONCAT22(iVar1,pFVar2);
      if (((pFVar2 == (FLEET *)0x0) && (iVar1 == 0)) || (lpfl->id == idFleet)) break;
    }
    pFVar2 = (FLEET *)lpfl;
    uVar3 = (undefined2)((ulong)lpfl >> 0x10);
    if ((i == cFleet) || (pFVar2->iPlayer != idPlayer)) {
      if (i == cFleet) {
        return;
      }
      pt.x = (&pFVar2->pt)->x;
      pt.y = (pFVar2->pt).y;
      scan.grobj = 0x83;
      scan.pt.x = pt.x;
      scan.pt.y = pt.y;
      ChangeScanSel(&scan,0);
    }
    else {
      if (dInc == 0) {
        if (((sel.grobj == grobjFleet) && (sel.fl.pt.x == (&pFVar2->pt)->x)) &&
           (sel.fl.pt.y == (pFVar2->pt).y)) {
          idOld = sel.fl.id;
        }
      }
      else {
        i = 0;
        while ((i < (int)(*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) &
                         0xfff) &&
               (((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[i]]->id != idFleet))) {
          i = i + 1;
        }
        i = i + dInc;
        if (i < (int)(*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) & 0xfff))
        {
          if (i < 0) {
            i = (*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) & 0xfff) - 1;
          }
        }
        else {
          i = 0;
        }
        i = ((ushort *)vlprgidFleet)[i];
      }
                    /* WARNING: Load size is inaccurate */
      pFVar2 = ((FLEET **)rglpfl)[i];
      iVar1 = *(int *)((int)((FLEET **)rglpfl + i) + 2);
      lpflT = (FLEET *)CONCAT22(iVar1,pFVar2);
      iObjSel = lpflT->id;
      pt.x = (&pFVar2->pt)->x;
      pt.y = (pFVar2->pt).y;
      scan.grobj = 0x82;
      scan.pt.x = pt.x;
      scan.pt.y = pt.y;
      ChangeScanSel(&scan,0);
      RedrawScanSel(0,0);
      ChangeMainObjSel(2,iObjSel);
      RedrawScanSel(0,1);
    }
    pt_00.y = pt.y;
    pt_00.x = pt.x;
    CtrPointScan(pt_00,1);
    DrawScannerSBar(0,(RECT *)0x0,(SBAR *)0x0,0);
    InvalidateRect(hwndMine,(undefined2 *)0x0,1);
    SetMineralTitleBar(hwndMine);
    if (idOld != -1) {
      SetFleetDropDownSel(idOld);
    }
  }
  return;
}



// ======================================================================
// Function: SetFleetDropDownSel
// Address: 1050:400e
// Segment: MEMORY_SHIP
// ======================================================================


void SetFleetDropDownSel(short id)

{
  FLEET *pFVar1;
  int iVar2;
  int iVar3;
  short iOffset;
  FLEET *lpfl;
  short i;
  short idSkip;
  
  iOffset = 0;
  iVar3 = sel.fl.id;
  if (sel.grobj != grobjFleet) {
    iVar3 = -1;
  }
  i = 0;
  while ((i < cFleet && (((FLEET **)rglpfl)[i]->id != id))) {
                    /* WARNING: Load size is inaccurate */
    pFVar1 = ((FLEET **)rglpfl)[i];
    iVar2 = *(int *)((int)((FLEET **)rglpfl + i) + 2);
    lpfl = (FLEET *)CONCAT22(iVar2,pFVar1);
    if (((sel.pt.x == (&pFVar1->pt)->x) && (sel.pt.y == (pFVar1->pt).y)) &&
       (lpfl->id != iVar3)) {
      iOffset = iOffset + 1;
    }
    i = i + 1;
  }
  SendMessage(hwndShipDD,0x40e,iOffset,0);
  DrawPlanShip(0,0x4004);
  return;
}



// ======================================================================
// Function: LGetFleetStat
// Address: 1050:40f2
// Segment: MEMORY_SHIP
// ======================================================================


long LGetFleetStat(FLEET *lpfl,short grStat)

{
  long lVar1;
  short sVar2;
  FLEET *pFVar3;
  int iVar4;
  undefined2 uVar5;
  ulong uVar6;
  long l;
  short i;
  
  lVar1 = 0;
  uVar5 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar3 = (FLEET *)lpfl;
  if ((pFVar3->wFlags & 0xffU) == 7) {
    for (i = 0; i < 0x10; i = i + 1) {
      if (pFVar3->rgcsh[i] != 0) {
        iVar4 = pFVar3->iPlayer * 4;
        sVar2 = WtMaxShdefStat((SHDEF *)CONCAT22(*(undefined2 *)(iVar4 + 0x100),
                                                 (SHDEF *)(*(int *)(iVar4 + 0xfe) + i * 0x93)),
                               grStat);
        uVar6 = __aFulmul((long)pFVar3->rgcsh[i],(long)sVar2);
        lVar1 = uVar6 + lVar1;
      }
    }
  }
  else {
    lVar1 = 32000;
  }
  return lVar1;
}



// ======================================================================
// Function: WtMaxShdefStat
// Address: 1050:41b2
// Segment: MEMORY_SHIP
// ======================================================================


short WtMaxShdefStat(SHDEF *lpshdef,short grStat)

{
  SHDEF *pSVar1;
  HULDEF *pHVar2;
  HUL *lphul;
  short j;
  short wt;
  
  pSVar1 = (SHDEF *)lpshdef;
  if (grStat == 1) {
    pHVar2 = LphuldefFromId((lpshdef->hul).ihuldef);
    wt = (((HULDEF *)pHVar2)->hul).wtFuelMax;
    for (j = 0; j < (int)(uint)(pSVar1->hul).chs; j = j + 1) {
      if (((pSVar1->hul).rghs + j)->grhst == hstSpecialM) {
        if (((pSVar1->hul).rghs[j].wFlags & 0xffU) == 5) {
          wt = wt + ((uint)(pSVar1->hul).rghs[j].wFlags >> 8) * 0xfa;
        }
        else if (((pSVar1->hul).rghs[j].wFlags & 0xffU) == 6) {
          wt = wt + ((uint)(pSVar1->hul).rghs[j].wFlags >> 8) * 500;
        }
      }
      else if ((((pSVar1->hul).rghs + j)->grhst == hstSpecialE) &&
              (((pSVar1->hul).rghs[j].wFlags & 0xffU) == 0x10)) {
        wt = wt + ((uint)(pSVar1->hul).rghs[j].wFlags >> 8) * 200;
      }
    }
  }
  else if (grStat == 2) {
    pHVar2 = LphuldefFromId((lpshdef->hul).ihuldef);
    wt = (((HULDEF *)pHVar2)->hul).wtCargoMax;
    for (j = 0; j < (int)(uint)(pSVar1->hul).chs; j = j + 1) {
      if (((pSVar1->hul).rghs + j)->grhst == hstSpecialM) {
        if (((pSVar1->hul).rghs[j].wFlags & 0xffU) == 2) {
          wt = wt + ((uint)(pSVar1->hul).rghs[j].wFlags >> 8) * 0x32;
        }
        else if (((pSVar1->hul).rghs[j].wFlags & 0xffU) == 3) {
          wt = wt + ((uint)(pSVar1->hul).rghs[j].wFlags >> 8) * 100;
        }
        else if (((pSVar1->hul).rghs[j].wFlags & 0xffU) == 4) {
          wt = wt + ((uint)(pSVar1->hul).rghs[j].wFlags >> 8) * 0xfa;
        }
      }
    }
  }
  else {
    wt = 0;
  }
  return wt;
}



// ======================================================================
// Function: DrawFleetGauge
// Address: 1050:44b6
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x105046af) */
/* WARNING: Removing unreachable block (ram,0x1050463c) */
/* WARNING: Removing unreachable block (ram,0x10504621) */
/* WARNING: Removing unreachable block (ram,0x105046aa) */
/* WARNING: Removing unreachable block (ram,0x1050461c) */
/* WARNING: Removing unreachable block (ram,0x105046ca) */
/* WARNING: Removing unreachable block (ram,0x10504754) */

void DrawFleetGauge(HDC hdc,RECT *prc,FLEET *lpfl,short grbit)

{
  undefined2 uVar1;
  short sVar2;
  char *pcVar3;
  long lVar4;
  DWORD DVar5;
  long l;
  short cSections;
  short iMode;
  long rgSize [5];
  short i;
  short c;
  long lMax;
  ushort rghbr [5];
  
  if (((FLEET *)lpfl == (FLEET *)0x0) && (lpfl._2_2_ == 0)) {
    lpfl = &sel.fl;
  }
  SelectObject(hdc,rghfontArial8[1]);
  cSections = 1;
  lVar4 = LGetFleetStat(lpfl,2);
  if ((grbit < 0) || (4 < grbit)) {
    if (grbit == 5) {
      for (i = 0; i < 4; i = i + 1) {
        rghbr[i] = ((ushort *)rghbrMineral)[i];
        uVar1 = *(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2);
        *(int *)(rgSize + i) = (int)((FLEET *)lpfl)->rgwtMin[i];
        *(undefined2 *)((int)rgSize + i * 4 + 2) = uVar1;
      }
      cSections = 4;
    }
    else if (grbit == 6) {
      rgSize[0]._0_2_ =
           *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) >> 4
           & 0xf;
      rgSize[0]._2_2_ = 0;
      if (((uint)rgSize[0] < 0xb) &&
         (((uint)rgSize[0] != 10 || (sVar2 = IFindIdealWarp(&sel.fl,0), 9 < sVar2)))) {
        rghbr[0] = rghbrMineral[4];
      }
      else {
        rghbr[0] = rghbrMineral[2];
      }
      lVar4 = 0xb;
    }
    else if (grbit == 7) {
      rgSize[0]._0_2_ =
           *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc);
      rgSize[0]._2_2_ = 0;
      if (((uint)rgSize[0] < 0xb) &&
         (((uint)rgSize[0] != 10 || (sVar2 = IFindIdealWarp(&sel.fl,0), 9 < sVar2)))) {
        lVar4 = 10;
        rghbr[0] = rghbrMineral[4];
      }
      else {
        lVar4 = 10;
        rghbr[0] = rghbrMineral[2];
      }
    }
  }
  else {
    rghbr[0] = ((ushort *)rghbrMineral)[grbit];
    rgSize[0]._0_2_ = *(uint *)(((FLEET *)lpfl)->rgwtMin + grbit);
    rgSize[0]._2_2_ = *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + grbit) + 2);
    if (grbit == 4) {
      lVar4 = LGetFleetStat(lpfl,1);
    }
  }
  lVar4 = LDrawGauge(hdc,prc,cSections,rgSize,rghbr,lVar4);
  sVar2 = SetBkMode(hdc,1);
  l._0_2_ = (undefined2)lVar4;
  if (grbit == 6) {
    if (lVar4 == 0) {
      c = CchGetString(idsStopped,(char *)szWork);
    }
    else if (lVar4 < 0xb) {
      pcVar3 = PszGetCompressedString(idsWarpLd);
      c = _WSPRINTF((LPSTR)CONCAT22((undefined2)l,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
    }
    else {
      c = CchGetString(idsUseStargate,(char *)szWork);
    }
  }
  else if (grbit == 7) {
    if (lVar4 == 0) {
      c = CchGetString(idsAutomatic,(char *)szWork);
    }
    else {
      pcVar3 = PszGetCompressedString(idsWarpLd);
      c = _WSPRINTF((LPSTR)CONCAT22((undefined2)l,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
    }
  }
  else if ((cSections == 1) && (grbit != 4)) {
    pcVar3 = PszGetCompressedString(idsLdkt);
    c = _WSPRINTF((LPSTR)CONCAT22((undefined2)l,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
  }
  else if (grbit == 4) {
    pcVar3 = PszGetCompressedString(idsLdLdmg);
    c = _WSPRINTF((LPSTR)CONCAT22((undefined2)l,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
  }
  else {
    pcVar3 = PszGetCompressedString(idsLdLdkt);
    c = _WSPRINTF((LPSTR)CONCAT22((undefined2)l,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar3,(char *)&DAT_1120_1120),(char *)szWork);
  }
  DVar5 = GetTextExtent(hdc,szWork,c);
  if ((int)DVar5 < (prc->right - prc->left) + -3) {
    RcCtrTextOut(hdc,prc,(char *)szWork,c);
  }
  SetBkMode(hdc,sVar2);
  return;
}



// ======================================================================
// Function: DrawFleetBitmap
// Address: 1050:490e
// Segment: MEMORY_SHIP
// ======================================================================


void DrawFleetBitmap
          (FLEET *lpfl,HDC hdc,short x,short y,short fFrame,short ibmp,short cDiff,short fShrink,
          short ibmpRace,short csh)

{
  HGDIOBJ HVar1;
  int iVar2;
  int iVar3;
  short sVar4;
  uint uVar5;
  DWORD DVar6;
  HBRUSH hbrSav;
  short dxyPlusWidth;
  short xCur;
  short dx;
  short dxy;
  short i;
  short c;
  short yCur;
  short dxyPlus;
  
  if (fFrame != 0) {
    HVar1 = SelectObject(hdc,hbrButtonShadow);
    PatBlt(hdc,x,y,0x44,2,0xf00021);
    PatBlt(hdc,x,y,2,0x44,0xf00021);
    SelectObject(hdc,hbrButtonHilite);
    PatBlt(hdc,x + 2,y + 0x42,0x42,1,0xf00021);
    PatBlt(hdc,x + 3,y + 0x42,0x41,1,0xf00021);
    PatBlt(hdc,x + 0x42,y + 2,1,0x40,0xf00021);
    PatBlt(hdc,x + 0x43,y + 1,1,0x41,0xf00021);
    SelectObject(hdc,HVar1);
    x = x + 2;
    y = y + 2;
  }
  if (ibmp < 0) {
    sVar4 = IshdefPrimaryFromLpfl(lpfl,&cDiff);
    iVar2 = ((FLEET *)lpfl)->iPlayer * 4;
    ibmp = *(short *)(*(int *)(iVar2 + 0xfe) + sVar4 * 0x93 + 0x32);
  }
  uVar5 = ibmp % 0x94;
  SelectPalette(hdc,vhpal,0);
  RealizePalette(hdc);
  if (fShrink == 0) {
    DibBlt(hdc,x,y,0x40,0x40,((ushort *)rghdibShips)[(int)uVar5 >> 5],
                    ((int)(uVar5 & 0x1f) >> 2) << 6,(3 - (uVar5 & 3)) * 0x40,0x40,0x40,0xcc0020);
    dxy = 0x40;
    dxyPlus = 8;
    dxyPlusWidth = 2;
    if (-1 < ibmpRace) {
      DibBlt(hdc,x,y + 0x30,0x10,0x10,hdibRacesT,(ibmpRace & 7U) << 4,
                      (3 - ((int)(ibmpRace & 0x1fU) >> 3)) * 0x10,0x10,0x10,0xcc0020);
    }
  }
  else {
    DibBlt(hdc,x,y,0x20,0x20,((ushort *)rghdibShipsT)[(int)uVar5 >> 5],
                    ((int)(uVar5 & 0x1f) >> 2) << 5,(3 - (uVar5 & 3)) * 0x20,0x20,0x20,0xcc0020);
    dxy = 0x20;
    dxyPlus = 5;
    dxyPlusWidth = 1;
    if (-1 < ibmpRace) {
      DibBlt(hdc,x,y + 0x18,8,8,hdibRacesX,(ibmpRace & 7U) << 3,
                      (3 - ((int)(ibmpRace & 0x1fU) >> 3)) * 8,8,8,0xcc0020);
    }
  }
  if ((csh == 0) || (fShrink != 0)) {
    if (4 < cDiff) {
      cDiff = 4;
    }
    cDiff = cDiff + -1;
    for (i = 0; i < cDiff; i = i + 1) {
      if ((i & 1U) == (uint)((i & 2U) == 2)) {
        iVar2 = x + 2;
      }
      else {
        iVar2 = (x + dxy + -2) - dxyPlus;
      }
      if ((i & 2U) == 0) {
        iVar3 = y + 2;
      }
      else {
        iVar3 = (y + dxy + -2) - dxyPlus;
      }
      PatBlt(hdc,iVar2,(dxyPlus + -1) / 2 + iVar3,dxyPlus,dxyPlusWidth,0xff0062);
      PatBlt(hdc,(dxyPlus + -1) / 2 + iVar2,iVar3,dxyPlusWidth,dxyPlus,0xff0062);
    }
  }
  else {
    SelectObject(hdc,rghfontArial7[0]);
    SetTextColor(hdc,0xffffff);
    if (1 < cDiff) {
      sVar4 = _WSPRINTF((LPSTR)CONCAT22(cDiff,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                        (char *)szWork);
      TextOut(hdc,x + 1,y + 1,szWork,sVar4);
    }
    if (1 < csh) {
      sVar4 = _WSPRINTF((LPSTR)CONCAT22(csh,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                        (char *)szWork);
      DVar6 = GetTextExtent(hdc,szWork,sVar4);
      TextOut(hdc,(x + dxy + -1) - (int)DVar6,y + 1,szWork,sVar4);
    }
  }
  return;
}



// ======================================================================
// Function: FEnumCalcJettison
// Address: 1050:4df4
// Segment: MEMORY_SHIP
// ======================================================================


short FEnumCalcJettison(void *lprt,short rt,short cb,PLANET *lppl,short iFleet)

{
  uint *puVar1;
  uint uVar2;
  void *pvVar3;
  RTXFERX *pRVar4;
  short sVar5;
  short sVar6;
  short sVar7;
  uint uVar8;
  RTXFER *prtxfer;
  RTXFERX *prtxferx;
  short j;
  FLEET fl;
  short grbit;
  short i;
  POINT pt;
  
  if ((rt == 1) || (rt == 2)) {
    pvVar3 = (void *)lprt;
    if ((((*(byte *)((int)pvVar3 + 4) & 0xf) == 2) &&
        ((((int)(uint)*(byte *)((int)pvVar3 + 4) >> 4 == 4 &&
          (sVar7 = FLookupFleet(iFleet,&fl), sVar6 = fl.pt.y, sVar5 = fl.pt.x, sVar7 != 0)) &&
         (sVar7 = FLookupFleet(*(short *)lprt,&fl), sVar7 != 0)))) &&
       ((fl.pt.x == sVar5 && (fl.pt.y == sVar6)))) {
      grbit = (short)*(byte *)((int)pvVar3 + 5);
      pRVar4 = lprt;
      if (rt != 2) {
        pRVar4 = (RTXFERX *)CONCAT22(prtxferx._2_2_,(RTXFERX *)prtxferx);
      }
      prtxferx._2_2_ = (undefined2)((ulong)pRVar4 >> 0x10);
      prtxferx._0_2_ = (RTXFERX *)pRVar4;
      j = 0;
      for (i = 0; i < 5; i = i + 1) {
        if ((grbit & 1U) != 0) {
          if (rt == 1) {
            uVar8 = (uint)*(char *)((int)pvVar3 + j + 6);
            puVar1 = (uint *)(((PLANET *)lppl)->rgwtMin + i);
            uVar2 = *puVar1;
            *puVar1 = *puVar1 - uVar8;
            puVar1 = (uint *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2);
            *puVar1 = (*puVar1 - ((int)uVar8 >> 0xf)) - (uint)(uVar2 < uVar8);
          }
          else {
            uVar8 = ((RTXFERX *)prtxferx)->rgcQuan[j];
            puVar1 = (uint *)(((PLANET *)lppl)->rgwtMin + i);
            uVar2 = *puVar1;
            *puVar1 = *puVar1 - uVar8;
            puVar1 = (uint *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2);
            *puVar1 = (*puVar1 - ((int)uVar8 >> 0xf)) - (uint)(uVar2 < uVar8);
          }
          j = j + 1;
        }
        grbit = grbit >> 1;
      }
    }
  }
  return 1;
}



// ======================================================================
// Function: TransferStuff
// Address: 1050:4faa
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Type propagation algorithm not settling */

short TransferStuff(short id1,short grobj1,short id2,short grobj2,short mdXfer)

{
  FLEET *pFVar1;
  FLEET *pFVar2;
  short sVar3;
  int iVar4;
  short *psVar5;
  FLEET *pFVar6;
  FLEET *pFVar7;
  undefined2 unaff_SS;
  FLEET *pFVar8;
  FARPROC pvVar9;
  RECT rc;
  POINT pt;
  BTN rgbtn [32];
  short j;
  short grbit;
  short fSuccess;
  FLEET *lpfl;
  short i;
  short iDelFleet;
  long lPopPrev;
  short rgValidHull [16];
  void *lpProcXfer;
  XFER xfer [2];
  
  lPopPrev._0_2_ = -1;
  lPopPrev._2_2_ = -1;
  xfer[0].id = id1;
  xfer[0].grobj = grobj1;
  xfer[1].id = id2;
  xfer[1].grobj = grobj2;
  pxfer = xfer;
  mdXferDlg = mdXfer;
  for (i = 0; i < 2; i = i + 1) {
    if (xfer[i].grobj == grobjOther) {
      if (mdXfer == 1) {
        pFVar8 = LpflNewSplit(&xfer[0].fl);
        pFVar6 = (FLEET *)pFVar8;
        pFVar7 = &xfer[1].fl;
        for (iVar4 = 0x3e; iVar4 != 0; iVar4 = iVar4 + -1) {
          pFVar2 = pFVar7;
          pFVar7 = (FLEET *)&pFVar7->iPlayer;
          pFVar1 = pFVar6;
          pFVar6 = (FLEET *)&pFVar6->iPlayer;
          pFVar2->id = pFVar1->id;
        }
        xfer[1].id = pFVar8->id;
        xfer[1].grobj = grobjFleet;
      }
      else {
        (&xfer[i].fl)->id = -1;
        for (j = 0; j < 4; j = j + 1) {
          psVar5 = xfer[i].fl.rgcsh + j * 2 + 8;
          *psVar5 = 0;
          psVar5[1] = 0;
        }
        EnumLogRts(FEnumCalcJettison,(FLEET *)CONCAT22(unaff_SS,&xfer[i].fl),id1);
      }
    }
    else {
      sVar3 = FLookupObject(xfer[i].grobj,(xfer + i)->id,&xfer[i].fl);
      if (sVar3 == 0) {
        return 0;
      }
      if (xfer[i].grobj == grobjPlanet) {
        lPopPrev._0_2_ = xfer[i].fl.rgcsh[0xe];
        lPopPrev._2_2_ = xfer[i].fl.rgcsh[0xf];
      }
    }
  }
  if (mdXfer == 1) {
    cXferValidHulls = 0;
    for (i = 0; i < 0x10; i = i + 1) {
      if ((xfer[0].fl.rgcsh[i] != 0) ||
         ((xfer[1].grobj == grobjFleet && (xfer[1].fl.rgcsh[i] != 0)))) {
        rgValidHull[cXferValidHulls] = i;
        cXferValidHulls = cXferValidHulls + 1;
      }
    }
    rgXferValidHulls = rgValidHull;
  }
  rgbtnXfer = rgbtn;
  crgbtnXfer = 0x20;
  if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
    AdvanceTutor();
  }
  pvVar9 = MakeProcInstance(TransferDlg,hInst);
  sVar3 = DialogBox(0,(LPCSTR)CONCAT22(0x5b,hwndFrame),(HWND)((ulong)pvVar9 >> 0x10),
                    (void *)pvVar9);
  FreeProcInstance(pvVar9);
  if (sVar3 == 0) {
    if (mdXfer != 1) {
      mdXferDlg = -1;
      return 0;
    }
    if (grobj2 != 4) {
      mdXferDlg = -1;
      return 0;
    }
SHIP_CancelSplit:
    FDeleteFleet(xfer[1].fl.id,0,0);
    CancelMemRt(0x18);
  }
  else {
    iDelFleet = -1;
    if (mdXfer == 1) {
      for (i = 0; (i < 0x10 && (xfer[1].fl.rgcsh[i] < 1)); i = i + 1) {
      }
      if ((i == 0x10) && (grobj2 == 4)) goto SHIP_CancelSplit;
      FleetTransferCargoBalance(&xfer[0].fl,&xfer[1].fl);
    }
    for (i = 0; i < 2; i = i + 1) {
      if ((xfer[i].grobj == grobjPlanet) || (xfer[i].grobj == grobjOther)) {
        FLookupPlanet(-1,(PLANET *)&xfer[i].fl);
        if ((xfer[i].grobj == grobjPlanet) &&
           (((short)lPopPrev == xfer[i].fl.rgcsh[0xe] && (lPopPrev._2_2_ == xfer[i].fl.rgcsh[0xf])))
           ) {
          lPopPrev._0_2_ = -1;
          lPopPrev._2_2_ = -1;
        }
      }
      else if (xfer[i].grobj == grobjFleet) {
        FLookupFleet(-1,&xfer[i].fl);
        if (mdXfer == 1) {
          for (j = 0; (j < 0x10 && (xfer[i].fl.rgcsh[j] == 0)); j = j + 1) {
          }
          if (j == 0x10) {
            iDelFleet = i;
          }
        }
      }
      else if (xfer[i].grobj == grobjThing) {
        FLookupThing(-1,(THING *)&xfer[i].fl);
      }
    }
    if (iDelFleet != -1) {
      FDeleteFleet((&xfer[iDelFleet].fl)->id,2,(&xfer[iDelFleet == 0].fl)->id);
    }
    if ((mdXfer == 1) && (FillShipDD(sel.fl.id), (grbitScan & 0x80) != 0))
    {
      InvalidateRect(hwndScanner,(undefined2 *)0x0,1);
    }
    if (sel.grobj == grobjPlanet) {
      grbit = -0x7fb3;
      FLookupPlanet(sel.pl.id,(PLANET *)&sel.pl);
      FillPlanetProdLB(0,(PLPROD *)0x0,(PLANET *)0x0);
    }
    else {
      grbit = -0x7c4b;
      FLookupFleet(sel.fl.id,(FLEET *)&sel.fl);
      FillFleetCompLB();
    }
    DrawPlanShip(0,grbit);
    if (sel.scan.grobj == grobjFleet) {
      InvalidateRect(hwndMine,(undefined2 *)0x0,1);
    }
    else {
      InvalidateMineralBars();
    }
    if (((((short)lPopPrev == -1) && (lPopPrev._2_2_ == -1)) ||
        (sVar3 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv),
        sVar3 != 8)) || ((grbitScan & 0x20) == 0)) {
      if (((((short)lPopPrev != -1) || (lPopPrev._2_2_ != -1)) && ((grbitScan & 0xf) == 4))
         || ((grbitScan & 0xf) == 1)) {
        pt.x = sel.pt.x;
        pt.y = sel.pt.y;
        LogicalToScan(&pt);
        rc.right = pt.x;
        rc.bottom = pt.y;
        rc.left = pt.x;
        rc.top = pt.y;
        InflateRect((undefined2 *)CONCAT22(unaff_SS,&rc),0x14,0x14);
        rc.top = rc.top + -0x14;
        InvalidateRect(hwndScanner,(undefined2 *)CONCAT22(unaff_SS,&rc),0);
      }
    }
    else {
      InvalidateRect(hwndScanner,(undefined2 *)0x0,0);
    }
  }
  mdXferDlg = -1;
  return 0;
}



// ======================================================================
// Function: TransferDlg
// Address: 1050:5686
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short TransferDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  char *pcVar1;
  int iVar2;
  int iVar3;
  HWND HVar4;
  HDC hdc_00;
  short sVar5;
  uint uVar6;
  ushort unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar7;
  RECT rc;
  short dx;
  RECT rcBtn;
  HWND hwndBtn;
  POINT pt;
  PAINTSTRUCT ps;
  short dyMore;
  HDC hdc;
  
  if (message == WM_PAINT) {
    hdc_00 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    DrawXferDlg(hwnd,hdc_00,&rc,-1);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    sVar5 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    sVar5 = 1;
  }
  else if (message == WM_INITDIALOG) {
    StickyDlgPos(hwnd,(POINT *)&ptStickyTransferDlg,1);
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    if (mdXferDlg == 1) {
      HVar4 = hwnd;
      pcVar1 = PszGetCompressedString(idsShipTransfer);
      SetWindowText(HVar4,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar1));
      if (10 < cXferValidHulls) {
        iVar2 = rc.bottom / 2;
        rc.bottom = rc.bottom + iVar2;
        SetWindowPos(hwnd,0,0,0,rc.right,rc.bottom,6);
        GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
        sVar5 = GetSystemMetrics(4);
        iVar2 = iVar2 - (sVar5 + 2);
        sVar5 = GetSystemMetrics(7);
        iVar3 = sVar5 + 4;
        HVar4 = GetDlgItem(hwnd,1);
        GetWindowRect(HVar4,(undefined2 *)CONCAT22(unaff_SS,&rcBtn));
        pt.x = rcBtn.left;
        pt.y = rcBtn.top;
        ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&pt));
        pt.y = pt.y + iVar2;
        pt.x = pt.x - iVar3;
        SetWindowPos(HVar4,0,pt.x,pt.y,0,0,1);
        HVar4 = GetDlgItem(hwnd,0x76);
        GetWindowRect(HVar4,(undefined2 *)CONCAT22(unaff_SS,&rcBtn));
        pt.x = rcBtn.left;
        pt.y = rcBtn.top;
        ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&pt));
        pt.y = pt.y + iVar2;
        pt.x = pt.x - iVar3;
        SetWindowPos(HVar4,0,pt.x,pt.y,0,0,1);
        HVar4 = GetDlgItem(hwnd,2);
        GetWindowRect(HVar4,(undefined2 *)CONCAT22(unaff_SS,&rcBtn));
        pt.x = rcBtn.left;
        pt.y = rcBtn.top;
        ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&pt));
        pt.y = pt.y + iVar2;
        pt.x = pt.x - iVar3;
        SetWindowPos(HVar4,0,pt.x,pt.y,0,0,1);
      }
    }
    FSetupXferBtns(&rc);
    if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
      AdvanceTutor();
    }
    sVar5 = 1;
  }
  else {
    if (message == WM_COMMAND) {
      if ((wParam == 1) || (wParam == 2)) {
        StickyDlgPos(hwnd,(POINT *)&ptStickyTransferDlg,0);
        EndDialog(hwnd,(uint)(wParam == 1));
        if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        return 1;
      }
      if (wParam == 0x76) {
        if (mdXferDlg == 1) {
          uVar6 = 0x438;
        }
        else {
          uVar6 = 0x433;
        }
        WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,(ulong)uVar6);
        return 1;
      }
    }
    else if ((message == WM_LBUTTONDOWN) || (message == WM_LBUTTONDBLCLK)) {
      uVar7 = __aFulshr(CONCAT22(unaff_DI,wParam),unaff_SI);
      sVar5 = FTrackXfer(hwnd,(short)lParam,(short)uVar7,wParam);
      return sVar5;
    }
    sVar5 = 0;
  }
  return sVar5;
}



// ======================================================================
// Function: FTrackXfer
// Address: 1050:5a16
// Segment: MEMORY_SHIP
// ======================================================================


short FTrackXfer(HWND hwnd,short x,short y,short fkb)

{
  int *piVar1;
  BTN *pBVar2;
  BTN *pBVar3;
  BOOL BVar4;
  int iVar5;
  uint iSupply;
  short sVar6;
  int iVar7;
  BTN *pBVar8;
  BTN *pBVar9;
  undefined2 unaff_SS;
  ulong uVar10;
  long lVar11;
  long lVar12;
  RECT rc;
  long cNew;
  BTN btn;
  short iVal;
  short iBtn;
  short i;
  long cCur;
  BTNT btnt;
  long dChg;
  POINT pt;
  POINT ptOld;
  
  GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
  pt.x = x;
  pt.y = y;
  i = 0;
  while ((i < crgbtnXfer &&
         (((rgbtnXfer[i].bt & 4U) != 0 ||
          (BVar4 = PtInRect((undefined2 *)CONCAT22(rgbtnXfer + i,pt.y),pt.x), BVar4 == 0))
         ))) {
    i = i + 1;
  }
  if (i == crgbtnXfer) {
    return 0;
  }
  iVar5 = i >> 1;
  pBVar8 = rgbtnXfer + i;
  pBVar9 = &btn;
  for (iVar7 = 7; iVar7 != 0; iVar7 = iVar7 + -1) {
    pBVar3 = pBVar9;
    pBVar9 = (BTN *)&(pBVar9->rc).top;
    pBVar2 = pBVar8;
    pBVar8 = (BTN *)&(pBVar8->rc).top;
    (pBVar3->rc).left = (pBVar2->rc).left;
  }
  iSupply = btn.iVal & 0x7f;
  if ((btn.wFlags & 1U) == 0) {
    if (iSupply < 5) {
      if (pxfer[1].grobj == grobjThing) {
        if ((iSupply == 4) || (iSupply == 3)) goto SHIP_FinishUp_4;
      }
      else if (pxfer[(uint)btn.wFlags >> 2 & 3].fl.iPlayer != idPlayer)
      goto SHIP_FinishUp_4;
      SetCapture(hwnd);
      ptOld.y = -1;
      ptOld.x = -1;
      while (sVar6 = FGetMouseMove(&pt), sVar6 != 0) {
        if ((pt.x != ptOld.x) || (pt.y != ptOld.y)) {
          ptOld.x = pt.x;
          ptOld.y = pt.y;
          if ((((uint)btn.wFlags >> 2 & 3) == 1) && (pxfer[1].grobj == grobjThing)) {
            uVar10 = __aFulmul((ulong)(pxfer[1].fl.rgcsh[1] & 0x3fff),10);
          }
          else if (iSupply == 4) {
            uVar10 = LGetFleetStat((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                                     &pxfer[(uint)btn.wFlags >> 2 & 3].fl)
                                   ,1);
          }
          else {
            uVar10 = LGetFleetStat((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                                     &pxfer[(uint)btn.wFlags >> 2 & 3].fl)
                                   ,2);
          }
          iVar5 = (btn.rc.right - btn.rc.left) + -2;
          iVar7 = iVar5 >> 0xf;
          uVar10 = __aFulmul((long)(pt.x - btn.rc.left),uVar10);
          lVar12 = __aFldiv(uVar10,CONCAT22(iVar7,iVar5));
          lVar11 = ChgCargo(pxfer[(uint)btn.wFlags >> 2 & 3].grobj,
                            (pxfer + ((uint)btn.wFlags >> 2 & 3))->id,iSupply,0,
                            &pxfer[(uint)btn.wFlags >> 2 & 3].fl);
          lVar12 = lVar12 - lVar11;
          if (((uint)btn.wFlags >> 2 & 3) != 0) {
            lVar12 = CONCAT22(-((int)((ulong)lVar12 >> 0x10) + (uint)((int)lVar12 != 0)),
                              -(int)lVar12);
          }
          lVar12 = XferSupply(iSupply,lVar12);
          if (lVar12 != 0) {
            DrawXferDlg(hwnd,0,&rc,iSupply);
          }
        }
      }
      ReleaseCapture();
    }
  }
  else {
    InitBtnTrack(&btnt,hwnd,0,&btn.rc,btn.bt,0x50,0,0,(char *)0x0);
    if ((fkb & 8U) == 0) {
      if ((fkb & 4U) == 0) {
        dChg._0_2_ = 1;
      }
      else {
        dChg._0_2_ = 10;
      }
    }
    else if ((fkb & 4U) == 0) {
      dChg._0_2_ = 100;
    }
    else {
      dChg._0_2_ = 1000;
    }
    while( true ) {
      dChg._2_2_ = 0;
      sVar6 = FTrackBtn(&btnt);
      if (sVar6 == 0) break;
      if (mdXferDlg == 1) {
        i = (int)dChg;
        if (pxfer[((uint)btn.wFlags >> 2 & 3) == 0].fl.rgcsh[iSupply] <= (int)dChg) {
          i = pxfer[((uint)btn.wFlags >> 2 & 3) == 0].fl.rgcsh[iSupply];
        }
        if (i != 0) {
          if (0x7ffe - i <= pxfer[(uint)btn.wFlags >> 2 & 3].fl.rgcsh[iSupply]) {
            i = 1;
          }
          piVar1 = pxfer[(uint)btn.wFlags >> 2 & 3].fl.rgcsh + iSupply;
          *piVar1 = *piVar1 + i;
          piVar1 = pxfer[((uint)btn.wFlags >> 2 & 3) == 0].fl.rgcsh + iSupply;
          *piVar1 = *piVar1 - i;
          DrawXferDlg(hwnd,btnt.hdc,&rc,iVar5);
        }
      }
      else if ((-1 < (int)iSupply) && (iSupply < 5)) {
        iVar7 = (int)dChg;
        if (((uint)btn.wFlags >> 2 & 3) != 0) {
          dChg._2_2_ = -(uint)((int)dChg != 0);
          iVar7 = -(int)dChg;
        }
        lVar12 = XferSupply(iSupply,CONCAT22(dChg._2_2_,iVar7));
        if (lVar12 != 0) {
          DrawXferDlg(hwnd,btnt.hdc,&rc,iSupply);
        }
      }
    }
  }
SHIP_FinishUp_4:
  UpdateXferBtns();
  DrawXferDlg(hwnd,0,&rc,-2);
  return 1;
}



// ======================================================================
// Function: GetCargoFree
// Address: 1050:5f98
// Segment: MEMORY_SHIP
// ======================================================================


long GetCargoFree(FLEET *lpfl)

{
  uint uVar1;
  bool bVar2;
  long lVar3;
  short i;
  long cHave;
  
  cHave._0_2_ = 0;
  cHave._2_2_ = 0;
  for (i = 0; i < 4; i = i + 1) {
    uVar1 = *(uint *)(((FLEET *)lpfl)->rgwtMin + i);
    bVar2 = CARRY2((uint)cHave,uVar1);
    cHave._0_2_ = (uint)cHave + uVar1;
    cHave._2_2_ = cHave._2_2_ + *(uint *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2) + (uint)bVar2;
  }
  lVar3 = LGetFleetStat(lpfl,2);
  return lVar3 - CONCAT22(cHave._2_2_,(uint)cHave);
}



// ======================================================================
// Function: GetFuelFree
// Address: 1050:6004
// Segment: MEMORY_SHIP
// ======================================================================


long GetFuelFree(FLEET *lpfl)

{
  long lVar1;
  
  lVar1 = LGetFleetStat(lpfl,1);
  return CONCAT22(((int)((ulong)lVar1 >> 0x10) - *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12)) -
                  (uint)((uint)lVar1 < *(uint *)(((FLEET *)lpfl)->rgwtMin + 4)),
                  (uint)lVar1 - *(uint *)(((FLEET *)lpfl)->rgwtMin + 4));
}



// ======================================================================
// Function: ChgCargo
// Address: 1050:6034
// Segment: MEMORY_SHIP
// ======================================================================


long ChgCargo(GrobjClass grobj,short id,short iSupply,long dChg,void *pobj)

{
  uint *puVar1;
  uint uVar2;
  int iVar3;
  ulong uVar4;
  long lVar5;
  long wtFree;
  PLANET *ppl;
  FLEET *pfl;
  short i;
  XFER xfer;
  THING *pth;
  
  if ((grobj == grobjPlanet) || (grobj == grobjOther)) {
    if (pobj == (void *)0x0) {
      if (grobj == grobjPlanet) {
        FLookupPlanet(id,(PLANET *)&xfer.fl);
        ppl = (PLANET *)&xfer.fl;
      }
      else {
        _memset(&xfer.fl,0,0x38);
        ppl = (PLANET *)&xfer.fl;
      }
    }
    else {
      ppl = pobj;
    }
    if (iSupply < 5) {
      if (iSupply == 4) {
        dChg._0_2_ = 0;
        dChg._2_2_ = 0;
        goto LAB_1050_64c6;
      }
      if (dChg == 0) {
        dChg._0_2_ = (uint)ppl->rgwtMin[iSupply];
        dChg._2_2_ = *(int *)((int)(ppl->rgwtMin + iSupply) + 2);
        goto LAB_1050_64c6;
      }
      iVar3 = *(uint *)((int)(ppl->rgwtMin + iSupply) + 2) + dChg._2_2_ +
              (uint)CARRY2(*(uint *)(ppl->rgwtMin + iSupply),(uint)dChg);
      if ((iVar3 < 1) && (iVar3 < 0)) {
        iVar3 = (int)ppl->rgwtMin[iSupply];
        dChg = CONCAT22(-(*(int *)((int)(ppl->rgwtMin + iSupply) + 2) + (uint)(iVar3 != 0)),-iVar3);
      }
      puVar1 = (uint *)(ppl->rgwtMin + iSupply);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + (uint)dChg;
      puVar1 = (uint *)((int)(ppl->rgwtMin + iSupply) + 2);
      *puVar1 = *puVar1 + dChg._2_2_ + (uint)CARRY2(uVar2,(uint)dChg);
    }
    if (((((uint)dChg != 0) || (dChg._2_2_ != 0)) && (pobj == (void *)0x0)) && (grobj != grobjOther)
       ) {
      FLookupPlanet(-1,(PLANET *)&xfer.fl);
    }
  }
  else if (grobj == grobjThing) {
    if (pobj == (void *)0x0) {
      FLookupThing(id,(THING *)&xfer.fl);
      pth = (THING *)&xfer.fl;
    }
    else {
      pth = pobj;
    }
    if (2 < iSupply) {
      dChg._0_2_ = 0;
      dChg._2_2_ = 0;
      goto LAB_1050_64c6;
    }
    if (iSupply < 5) {
      if (dChg == 0) {
        dChg._0_2_ = *(uint *)(pth->rgb + iSupply * 2 + 2);
        dChg._2_2_ = (int)(uint)dChg >> 0xf;
        goto LAB_1050_64c6;
      }
      iVar3 = ((int)*(uint *)(pth->rgb + iSupply * 2 + 2) >> 0xf) + dChg._2_2_ +
              (uint)CARRY2(*(uint *)(pth->rgb + iSupply * 2 + 2),(uint)dChg);
      if ((iVar3 < 1) && (iVar3 < 0)) {
        dChg = (long)-*(int *)(pth->rgb + iSupply * 2 + 2);
      }
      uVar4 = __aFulmul((ulong)*(uint *)(pth->rgb + 8) & 0xffff3fff,10);
      i = 0;
      while( true ) {
        wtFree._2_2_ = (int)(uVar4 >> 0x10);
        wtFree._0_2_ = (uint)uVar4;
        if (2 < i) break;
        uVar4 = uVar4 - (long)*(int *)(pth->rgb + i * 2 + 2);
        i = i + 1;
      }
      if ((wtFree._2_2_ <= dChg._2_2_) &&
         ((wtFree._2_2_ < dChg._2_2_ || ((uint)wtFree < (uint)dChg)))) {
        dChg = uVar4;
      }
      *(uint *)(pth->rgb + iSupply * 2 + 2) = *(int *)(pth->rgb + iSupply * 2 + 2) + (uint)dChg;
    }
    if ((((uint)dChg != 0) || (dChg._2_2_ != 0)) && (pobj == (void *)0x0)) {
      FLookupThing(-1,pth);
    }
  }
  else {
    if (pobj == (void *)0x0) {
      FLookupFleet(id,&xfer.fl);
      pfl = &xfer.fl;
    }
    else {
      pfl = pobj;
    }
    if (iSupply < 5) {
      if (dChg == 0) {
        dChg._0_2_ = (uint)pfl->rgwtMin[iSupply];
        dChg._2_2_ = *(int *)((int)(pfl->rgwtMin + iSupply) + 2);
        goto LAB_1050_64c6;
      }
      iVar3 = *(uint *)((int)(pfl->rgwtMin + iSupply) + 2) + dChg._2_2_ +
              (uint)CARRY2(*(uint *)(pfl->rgwtMin + iSupply),(uint)dChg);
      if ((iVar3 < 1) && (iVar3 < 0)) {
        iVar3 = (int)pfl->rgwtMin[iSupply];
        dChg = CONCAT22(-(*(int *)((int)(pfl->rgwtMin + iSupply) + 2) + (uint)(iVar3 != 0)),-iVar3);
      }
      if ((iSupply == 3) && ((pfl->wFlags & 0xffU) != 7)) {
        dChg = 0;
      }
      if (iSupply == 4) {
        lVar5 = GetFuelFree((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,pfl));
      }
      else {
        lVar5 = GetCargoFree((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,pfl));
      }
      iVar3 = (int)((ulong)lVar5 >> 0x10);
      if ((iVar3 < dChg._2_2_) || ((iVar3 <= dChg._2_2_ && ((uint)lVar5 <= (uint)dChg)))) {
        if (iSupply == 4) {
          dChg = GetFuelFree((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,pfl));
        }
        else {
          dChg = GetCargoFree((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,pfl));
        }
      }
      puVar1 = (uint *)(pfl->rgwtMin + iSupply);
      uVar2 = *puVar1;
      *puVar1 = *puVar1 + (uint)dChg;
      puVar1 = (uint *)((int)(pfl->rgwtMin + iSupply) + 2);
      *puVar1 = *puVar1 + (int)((ulong)dChg >> 0x10) + (uint)CARRY2(uVar2,(uint)dChg);
    }
    if ((((uint)dChg != 0) || (dChg._2_2_ != 0)) && (pobj == (void *)0x0)) {
      FLookupFleet(-1,pfl);
    }
  }
LAB_1050_64c6:
  return CONCAT22(dChg._2_2_,(uint)dChg);
}



// ======================================================================
// Function: XferSupply
// Address: 1050:64cc
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x105064fe) */

long XferSupply(short iSupply,long cQuan)

{
  uint uVar1;
  int iVar2;
  long lVar3;
  long cAvailable;
  long dChg;
  short iSrc;
  
  if (cQuan == 0) {
    lVar3 = 0;
  }
  else {
    uVar1 = (uint)(0 < cQuan);
    if (uVar1 == 0) {
      cQuan = CONCAT22(-(cQuan._2_2_ + (uint)((uint)cQuan != 0)),-(uint)cQuan);
    }
    lVar3 = ChgCargo(pxfer[uVar1].grobj,(pxfer + uVar1)->id,iSupply,0,
                     &pxfer[uVar1].fl);
    iVar2 = (int)((ulong)lVar3 >> 0x10);
    if ((iVar2 <= cQuan._2_2_) && ((iVar2 < cQuan._2_2_ || ((uint)lVar3 < (uint)cQuan)))) {
      cQuan = lVar3;
    }
    if (((uint)cQuan == 0) && (cQuan._2_2_ == 0)) {
      lVar3 = 0;
    }
    else {
      lVar3 = ChgCargo(pxfer[uVar1 == 0].grobj,(pxfer + (uVar1 == 0))->id,
                       iSupply,cQuan,&pxfer[uVar1 == 0].fl);
      if (lVar3 != 0) {
        ChgCargo(pxfer[uVar1].grobj,(pxfer + uVar1)->id,iSupply,
                 CONCAT22(-((int)((ulong)lVar3 >> 0x10) + (uint)((int)lVar3 != 0)),-(int)lVar3),
                 &pxfer[uVar1].fl);
      }
    }
  }
  return lVar3;
}



// ======================================================================
// Function: UpdateXferBtns
// Address: 1050:66a8
// Segment: MEMORY_SHIP
// ======================================================================


void UpdateXferBtns(void)

{
  int iSupply;
  int iVar1;
  uint uVar2;
  long lVar3;
  long lLeft;
  short iVal;
  short iLastButton;
  short i;
  short iSide;
  
  if (mdXferDlg == 1) {
    iVar1 = cXferValidHulls << 1;
  }
  else {
    iVar1 = 4;
  }
  for (i = 0; i < crgbtnXfer; i = i + 1) {
    iSupply = rgbtnXfer[i].iVal;
    if (((rgbtnXfer[i].wFlags & 1U) != 0) &&
       ((iSupply <= iVar1 || (mdXferDlg == 1)))) {
      uVar2 = (uint)rgbtnXfer[i].wFlags >> 2 & 3;
      if (mdXferDlg == 1) {
        if (pxfer[uVar2].fl.rgcsh[iSupply] == 0x7ffe) {
          lLeft._0_2_ = 0;
          lLeft._2_2_ = 0;
        }
        else {
          lLeft._0_2_ = pxfer[uVar2 == 0].fl.rgcsh[iSupply];
          lLeft._2_2_ = (int)lLeft >> 0xf;
        }
        lVar3 = CONCAT22(lLeft._2_2_,(int)lLeft);
      }
      else {
        lVar3 = ChgCargo(pxfer[uVar2 == 0].grobj,(pxfer + (uVar2 == 0))->id,
                         iSupply,0,&pxfer[uVar2 == 0].fl);
        if ((lVar3 == 0) || (pxfer[uVar2].grobj != grobjFleet)) {
          if ((pxfer[uVar2].grobj == grobjPlanet) && (iSupply == 4)) {
            lVar3 = 0;
          }
        }
        else if (iSupply == 4) {
          lVar3 = GetFuelFree((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                                &pxfer[uVar2].fl));
        }
        else {
          lVar3 = GetCargoFree((FLEET *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                                 &pxfer[uVar2].fl));
        }
      }
      if (lVar3 == 0) {
        rgbtnXfer[i].bt = rgbtnXfer[i].bt | 4;
      }
      else {
        rgbtnXfer[i].bt = rgbtnXfer[i].bt & 0xfffb;
      }
    }
  }
  return;
}



// ======================================================================
// Function: DrawXferDlg
// Address: 1050:6908
// Segment: MEMORY_SHIP
// ======================================================================


void DrawXferDlg(HWND hwnd,HDC hdc,RECT *prc,short iSupply)

{
  bool bVar1;
  short dxCtr;
  short i;
  short fCreatedDC;
  RECT rgrc [2];
  
  bVar1 = hdc == 0;
  if (bVar1) {
    hdc = GetDC(hwnd);
  }
  if (iSupply < 0) {
    PatBlt(hdc,prc->right >> 1,0,1,prc->bottom,0x42);
    for (i = 0; i < crgbtnXfer; i = i + 1) {
      if ((rgbtnXfer[i].wFlags & 1U) != 0) {
        DrawBtn(hdc,&rgbtnXfer[i].rc,rgbtnXfer[i].bt,0,(char *)0x0);
      }
    }
    if (iSupply == -2) goto SHIP_RelDC;
  }
  GetXferLeftRightRcs(prc,rgrc,rgrc + 1);
  for (i = 0; i < 2; i = i + 1) {
    if (mdXferDlg == 1) {
      DrawFleetShipsXferSide(hdc,rgrc + i,&pxfer[i].fl,iSupply);
    }
    else if (pxfer[i].grobj == grobjFleet) {
      DrawFleetCargoXferSide(hdc,rgrc + i,&pxfer[i].fl,iSupply);
    }
    else if ((pxfer[i].grobj == grobjPlanet) || (pxfer[i].grobj == grobjOther))
    {
      DrawPlanetXferSide(hdc,rgrc + i,(PLANET *)&pxfer[i].fl,iSupply);
    }
    else if (pxfer[i].grobj == grobjThing) {
      DrawThingXferSide(hdc,rgrc + i,(THING *)&pxfer[i].fl,iSupply);
    }
  }
SHIP_RelDC:
  if (bVar1) {
    ReleaseDC(hwnd,hdc);
  }
  return;
}



// ======================================================================
// Function: GetXferLeftRightRcs
// Address: 1050:6b46
// Segment: MEMORY_SHIP
// ======================================================================


void GetXferLeftRightRcs(RECT *prcWhole,RECT *prcLeft,RECT *prcRight)

{
  SetRect((undefined2 *)CONCAT22((undefined1 *)&DAT_1120_1120,prcLeft),0,0,prcWhole->right >> 1,
          prcWhole->bottom);
  ExpandRc(prcLeft,-4 - (dyArial8 + 3),-4);
  prcLeft->left = prcLeft->left - (dyArial8 + 1);
  SetRect((undefined2 *)CONCAT22((undefined1 *)&DAT_1120_1120,prcRight),prcWhole->right >> 1,0,
          prcWhole->right,prcWhole->bottom);
  ExpandRc(prcRight,-4 - (dyArial8 + 3),-4);
  prcRight->right = prcRight->right + dyArial8 + 1;
  return;
}



// ======================================================================
// Function: FSetupXferBtns
// Address: 1050:6bea
// Segment: MEMORY_SHIP
// ======================================================================


short FSetupXferBtns(RECT *prc)

{
  GrobjClass GVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  short sVar5;
  BTN *pBVar6;
  undefined2 unaff_SS;
  RECT rc;
  RECT rcLeft;
  RECT rcBtn;
  short dxLabels;
  RECT rcRight;
  short dxCtr;
  short j;
  short fThingXfer;
  short i;
  short iMin;
  short dy;
  short iMax;
  short cBtn;
  
  cBtn = 0;
  if (mdXferDlg == 1) {
    iVar3 = 0x8c;
  }
  else {
    iVar3 = 0x4b;
  }
  GVar1 = pxfer[1].grobj;
  iVar4 = prc->right >> 1;
  dy = dyArial8 + 10;
  iVar2 = cXferValidHulls;
  if (mdXferDlg != 1) {
    dy = dy + (dyArial8 + 6) * 2;
    iVar2 = 5;
  }
  for (i = 0; i < iVar2; i = i + 1) {
    if ((i == 4) && (mdXferDlg != 1)) {
      dy = dy + (dyArial8 + 6) * -6;
    }
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rcBtn),(iVar4 - (dyArial8 + 3)) + 1,dy,
            iVar4 + 1,dyArial8 + 3 + dy);
    for (j = 0; j < 2; j = j + 1) {
      pBVar6 = rgbtnXfer + cBtn;
      (pBVar6->rc).left = rcBtn.left;
      (pBVar6->rc).top = rcBtn.top;
      (pBVar6->rc).right = rcBtn.right;
      (pBVar6->rc).bottom = rcBtn.bottom;
      if (j == 0) {
        sVar5 = 2;
      }
      else {
        sVar5 = 3;
      }
      rgbtnXfer[cBtn].bt = sVar5;
      if ((GVar1 == grobjThing) && (3 < i)) {
        rgbtnXfer[cBtn].wFlags = rgbtnXfer[cBtn].wFlags & 0xfffe;
        rgbtnXfer[cBtn].rc.bottom = -100;
      }
      else {
        rgbtnXfer[cBtn].wFlags = rgbtnXfer[cBtn].wFlags & 0xfffeU | 1;
      }
      rgbtnXfer[cBtn].wFlags = rgbtnXfer[cBtn].wFlags & 0xfff3U | (j & 3U) << 2;
      sVar5 = i;
      if (mdXferDlg == 1) {
        sVar5 = rgXferValidHulls[i];
      }
      rgbtnXfer[cBtn].iVal = sVar5;
      cBtn = cBtn + 1;
      OffsetRc(&rcBtn,dyArial8 + 2,0);
    }
    dy = dy + dyArial8 + 6;
  }
  GetXferLeftRightRcs(prc,&rcLeft,&rcRight);
  if (mdXferDlg != 1) {
    if (pxfer->grobj == grobjPlanet) {
      if (pxfer[1].grobj == grobjPlanet) goto SHIP_NoGauges;
      rc.left = rcRight.left;
      rc.top = rcRight.top;
      rc.right = rcRight.right;
      i = 1;
    }
    else {
      rc.left = rcLeft.left;
      rc.top = rcLeft.top;
      rc.right = rcLeft.right;
      i = 0;
    }
    for (; i < 2; i = i + 1) {
      SetRect((undefined2 *)CONCAT22(unaff_SS,&rcBtn),rc.left + iVar3 + 10,
              rc.top + dyArial8 + 6,rc.right + -4,dyArial8 * 2 + rc.top + 6);
      if (mdXferDlg == 1) {
        iMax = cXferValidHulls;
      }
      else {
        iMax = 5;
      }
      for (j = 0; j < iMax; j = j + 1) {
        if (mdXferDlg != 1) {
          if (j == 0) {
            OffsetRc(&rcBtn,0,(dyArial8 + 6) * 2);
          }
          else if (j == 4) {
            OffsetRc(&rcBtn,0,(dyArial8 + 6) * -6);
          }
        }
        pBVar6 = rgbtnXfer + cBtn;
        (pBVar6->rc).left = rcBtn.left;
        (pBVar6->rc).top = rcBtn.top;
        (pBVar6->rc).right = rcBtn.right;
        (pBVar6->rc).bottom = rcBtn.bottom;
        rgbtnXfer[cBtn].bt = 0;
        rgbtnXfer[cBtn].wFlags = rgbtnXfer[cBtn].wFlags & 0xfffe;
        rgbtnXfer[cBtn].wFlags =
             rgbtnXfer[cBtn].wFlags & 0xfff3U | (i & 3U) << 2;
        rgbtnXfer[cBtn].iVal = j + 0x80;
        cBtn = cBtn + 1;
        OffsetRc(&rcBtn,0,dyArial8 + 6);
      }
      if (pxfer[1].grobj == grobjPlanet) break;
      rc.left = rcRight.left;
      rc.top = rcRight.top;
      rc.right = rcRight.right;
    }
  }
SHIP_NoGauges:
  crgbtnXfer = cBtn;
  UpdateXferBtns();
  return 1;
}



// ======================================================================
// Function: DrawThingXferSide
// Address: 1050:7088
// Segment: MEMORY_SHIP
// ======================================================================


void DrawThingXferSide(HDC hdc,RECT *prc,THING *pth,short iSupply)

{
  int iVar1;
  int iVar2;
  StringId ids;
  char *pcVar3;
  int iVar4;
  undefined2 unaff_SS;
  short sVar5;
  short dxErase;
  RECT rc;
  short xLeft;
  RECT rcGauge;
  short dxLabels;
  short xRight;
  short i;
  short yTop;
  
  rc.left = prc->left;
  rc.top = prc->top;
  rc.right = prc->right;
  rc.bottom = (rc.top + rc.right) - rc.left;
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
  SelectObject(hdc,rghfontArial8[1]);
  if (iSupply == -1) {
    _Draw3dFrame();
  }
  ExpandRc(&rc,-1,-1);
  rc.bottom = rc.top + dyArial8 + 2;
  if (iSupply == -1) {
    _Draw3dFrame();
    sVar5 = 0;
    pcVar3 = PszGetThingName(pth->idFull);
    RcCtrTextOut(hdc,&rc,pcVar3,sVar5);
  }
  iVar1 = prc->left;
  iVar2 = prc->right;
  yTop = rc.bottom + dyArial8 + 9;
  if (iSupply == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    for (i = -1; i < 3; i = i + 1) {
      if ((i != 4) && (i != 4)) {
        dxErase = 0;
        sVar5 = 0;
        if (i == -1) {
          ids = idsPacketShell;
        }
        else {
          ids = i + idsIronium;
        }
        pcVar3 = PszGetCompressedString(ids);
        RightTextOut(hdc,iVar1 + 0x4f,yTop,pcVar3,sVar5,dxErase);
      }
      yTop = yTop + dyArial8 + 6;
    }
  }
  if ((iSupply != 4) && (iSupply != 3)) {
    iVar4 = rc.bottom + dyArial8 + 9;
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rcGauge),iVar1 + 0x55,iVar4,iVar2 + -4,
            iVar4 + dyArial8);
    DrawThingGauge(hdc,&rcGauge,(THING *)CONCAT22((undefined1 *)&DAT_1120_1120,pth),5);
    for (i = 0; (i < 3 && (((OffsetRc(&rcGauge,0,dyArial8 + 6), iSupply != -1 &&
                            (iSupply != i)) ||
                           (DrawThingGauge
                                      (hdc,&rcGauge,
                                       (THING *)CONCAT22((undefined1 *)&DAT_1120_1120,pth),i),
                           iSupply != i)))); i = i + 1) {
    }
  }
  return;
}



// ======================================================================
// Function: DrawFleetCargoXferSide
// Address: 1050:72de
// Segment: MEMORY_SHIP
// ======================================================================


void DrawFleetCargoXferSide(HDC hdc,RECT *prc,FLEET *pfl,short iSupply)

{
  int iVar1;
  FLEET *pFVar2;
  FLEET *pFVar3;
  int iVar4;
  char *pcVar5;
  short sVar6;
  int iVar7;
  FLEET *pFVar8;
  undefined2 unaff_SS;
  bool bVar9;
  undefined2 uVar10;
  short dxErase;
  short iMap;
  RECT rc;
  short xLeft;
  RECT rcGauge;
  short dxLabels;
  FLEET fl;
  short xRight;
  short i;
  short c;
  short fOtherPlr;
  short yTop;
  
  bVar9 = pfl->iPlayer != idPlayer;
  pFVar8 = &fl;
  for (iVar7 = 0x3e; iVar7 != 0; iVar7 = iVar7 + -1) {
    pFVar3 = pFVar8;
    pFVar8 = (FLEET *)&pFVar8->iPlayer;
    pFVar2 = pfl;
    pfl = (FLEET *)&pfl->iPlayer;
    pFVar3->id = pFVar2->id;
  }
  rc.left = prc->left;
  rc.top = prc->top;
  rc.right = prc->right;
  rc.bottom = (rc.top + rc.right) - rc.left;
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
  SelectObject(hdc,rghfontArial8[1]);
  if (iSupply == -1) {
    _Draw3dFrame();
  }
  ExpandRc(&rc,-1,-1);
  rc.bottom = rc.top + dyArial8 + 2;
  if (iSupply == -1) {
    _Draw3dFrame();
    sVar6 = 0;
    pcVar5 = PszGetFleetName(fl.id);
    RcCtrTextOut(hdc,&rc,pcVar5,sVar6);
  }
  iVar7 = prc->left;
  iVar4 = prc->right;
  yTop = rc.bottom + 3;
  if (iSupply == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    for (i = 0; i < 6; i = i + 1) {
      if ((i != 6) || (!bVar9)) {
        dxErase = 0;
        sVar6 = 0;
        pcVar5 = PszGetCompressedString(i + idsFuel);
        RightTextOut(hdc,iVar7 + 0x4f,yTop,pcVar5,sVar6,dxErase);
      }
      yTop = yTop + dyArial8 + 6;
    }
  }
  yTop = rc.bottom + 3;
  iVar1 = iVar7 + 0x55;
  if (bVar9) {
    iVar4 = iVar1 + dxMaxMineralQuan;
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),iVar7 + 0x53,rc.bottom + 2,
            iVar1 + dxMaxMineralQuan + 2,yTop + dyArial8 + 1);
    for (i = 0; i < 6; i = i + 1) {
      if (i == 1) {
        OffsetRc(&rc,0,dyArial8 + 6);
      }
      else {
        if (i == 0) {
          iMap = 4;
        }
        else {
          iMap = i + -2;
        }
        if ((iSupply == -1) || (iSupply == iMap)) {
          _Draw3dFrame();
          uVar10 = (undefined2)fl.rgwtMin[iMap];
          pcVar5 = PszGetCompressedString((iMap == 4) + idsLdkt);
          sVar6 = _WSPRINTF((LPSTR)CONCAT22(uVar10,(char *)&DAT_1120_1120),
                            (LPCSTR)CONCAT22(pcVar5,(char *)&DAT_1120_1120),(char *)szWork
                           );
          RightTextOut(hdc,iVar4,yTop,(char *)szWork,sVar6,0);
          if (iSupply == i) {
            return;
          }
        }
        OffsetRc(&rc,0,dyArial8 + 6);
      }
      yTop = yTop + dyArial8 + 6;
    }
  }
  else {
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rcGauge),iVar1,yTop,iVar4 + -4,
            yTop + dyArial8);
    if ((iSupply == -1) || (iSupply == 4)) {
      DrawFleetGauge(hdc,&rcGauge,(FLEET *)CONCAT22(unaff_SS,&fl),4);
    }
    if (iSupply != 4) {
      OffsetRc(&rcGauge,0,dyArial8 + 6);
      DrawFleetGauge(hdc,&rcGauge,(FLEET *)CONCAT22(unaff_SS,&fl),5);
      for (i = 0; (i < 4 && (((OffsetRc(&rcGauge,0,dyArial8 + 6), iSupply != -1
                              && (iSupply != i)) ||
                             (DrawFleetGauge(hdc,&rcGauge,(FLEET *)CONCAT22(unaff_SS,&fl),i),
                             iSupply != i)))); i = i + 1) {
      }
    }
  }
  return;
}



// ======================================================================
// Function: DrawFleetShipsXferSide
// Address: 1050:7726
// Segment: MEMORY_SHIP
// ======================================================================


void DrawFleetShipsXferSide(HDC hdc,RECT *prc,FLEET *pfl,short iSupply)

{
  FLEET *pFVar1;
  FLEET *pFVar2;
  char *psz;
  int x;
  short sVar3;
  int iVar4;
  FLEET *pFVar5;
  FLEET *pFVar6;
  undefined2 unaff_SS;
  RECT rc;
  short xLeft;
  FLEET fl;
  short xRight;
  short i;
  short c;
  short fOtherPlr;
  short yTop;
  
  pFVar6 = &fl;
  pFVar5 = pfl;
  for (iVar4 = 0x3e; iVar4 != 0; iVar4 = iVar4 + -1) {
    pFVar2 = pFVar6;
    pFVar6 = (FLEET *)&pFVar6->iPlayer;
    pFVar1 = pFVar5;
    pFVar5 = (FLEET *)&pFVar5->iPlayer;
    pFVar2->id = pFVar1->id;
  }
  rc.left = prc->left;
  rc.top = prc->top;
  rc.right = prc->right;
  rc.bottom = prc->bottom;
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
  SelectObject(hdc,rghfontArial8[1]);
  if (iSupply == -1) {
    _Draw3dFrame();
  }
  ExpandRc(&rc,-1,-1);
  rc.bottom = rc.top + dyArial8 + 2;
  if (iSupply == -1) {
    _Draw3dFrame();
    sVar3 = 0;
    psz = PszGetFleetName(fl.id);
    RcCtrTextOut(hdc,&rc,psz,sVar3);
  }
  iVar4 = prc->right - dxMaxMineralQuan;
  x = iVar4 + -6 + dxMaxMineralQuan;
  yTop = rc.bottom + 3;
  if (iSupply == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    for (i = 0; i < cXferValidHulls; i = i + 1) {
      RightTextOut
                (hdc,iVar4 + -0xe,yTop,
                 (char *)((int)&rgshdef[0].hul + 8 + rgXferValidHulls[i] * 0x93)
                 ,0,0);
      yTop = yTop + dyArial8 + 6;
    }
  }
  yTop = rc.bottom + 3;
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),iVar4 + -8,rc.bottom + 2,
          iVar4 + -6 + dxMaxMineralQuan + 2,yTop + dyArial8 + 1);
  i = 0;
  do {
    if (cXferValidHulls <= i) {
      return;
    }
    if ((iSupply == -1) || (iSupply == i)) {
      _Draw3dFrame();
      sVar3 = _WSPRINTF((LPSTR)CONCAT22(pfl->rgcsh[rgXferValidHulls[i]],
                                        (char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                        (char *)szWork);
      RightTextOut(hdc,x,yTop,(char *)szWork,sVar3,0);
      if (iSupply == i) {
        return;
      }
    }
    OffsetRc(&rc,0,dyArial8 + 6);
    yTop = yTop + dyArial8 + 6;
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: DrawPlanetXferSide
// Address: 1050:79ca
// Segment: MEMORY_SHIP
// ======================================================================


void DrawPlanetXferSide(HDC hdc,RECT *prc,PLANET *ppl,short iSupply)

{
  PLANET *pPVar1;
  PLANET *pPVar2;
  int iVar3;
  char *pcVar4;
  short sVar5;
  int iVar6;
  PLANET *pPVar7;
  undefined2 unaff_SS;
  undefined2 uVar8;
  short dxErase;
  RECT rc;
  short xLeft;
  char *psz;
  short xRight;
  short i;
  short c;
  short yTop;
  PLANET pl;
  
  pPVar7 = &pl;
  for (iVar6 = 0x1c; iVar6 != 0; iVar6 = iVar6 + -1) {
    pPVar2 = pPVar7;
    pPVar7 = (PLANET *)&pPVar7->iPlayer;
    pPVar1 = ppl;
    ppl = (PLANET *)&ppl->iPlayer;
    pPVar2->id = pPVar1->id;
  }
  rc.left = prc->left;
  rc.top = prc->top;
  rc.right = prc->right;
  rc.bottom = (rc.top + rc.right) - rc.left;
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
  SelectObject(hdc,rghfontArial8[1]);
  if (iSupply == -1) {
    _Draw3dFrame();
  }
  ExpandRc(&rc,-1,-1);
  rc.bottom = rc.top + dyArial8 + 2;
  if (iSupply == -1) {
    _Draw3dFrame();
    if (pl.id == -1) {
      psz = PszGetCompressedString(idsDeepSpace);
    }
    else {
      psz = PszGetPlanetName(pl.id);
    }
    RcCtrTextOut(hdc,&rc,psz,0);
  }
  iVar6 = prc->left;
  yTop = rc.bottom + 3;
  if (iSupply == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    for (i = 0; i < 6; i = i + 1) {
      if (1 < i) {
        dxErase = 0;
        sVar5 = 0;
        pcVar4 = PszGetCompressedString(i + idsFuel);
        RightTextOut(hdc,iVar6 + 0x4f,yTop,pcVar4,sVar5,dxErase);
      }
      yTop = yTop + dyArial8 + 6;
    }
  }
  yTop = rc.bottom + 3;
  iVar3 = iVar6 + 0x55 + dxMaxMineralQuan;
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),iVar6 + 0x53,rc.bottom + 2,
          iVar6 + 0x55 + dxMaxMineralQuan + 0xe,yTop + dyArial8 + 1);
  i = 0;
  do {
    if (4 < i) {
      return;
    }
    if (i == 0) {
      yTop = yTop + (dyArial8 + 6) * 2;
      OffsetRc(&rc,0,(dyArial8 + 6) * 2);
    }
    else if (i == 4) {
      yTop = yTop + (dyArial8 + 6) * -6;
      OffsetRc(&rc,0,(dyArial8 + 6) * 6);
    }
    if (((iSupply == -1) || (iSupply == i)) && (i != 4)) {
      _Draw3dFrame();
      uVar8 = (undefined2)pl.rgwtMin[i];
      pcVar4 = PszGetCompressedString(idsLdkt);
      sVar5 = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(pcVar4,(char *)&DAT_1120_1120),(char *)szWork);
      RightTextOut(hdc,iVar3 + 0xc,yTop,(char *)szWork,sVar5,0);
      if (iSupply == i) {
        return;
      }
    }
    OffsetRc(&rc,0,dyArial8 + 6);
    i = i + 1;
    yTop = yTop + dyArial8 + 6;
  } while( true );
}



// ======================================================================
// Function: ClickInShipOrders
// Address: 1050:7cda
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050860e) */
/* WARNING: Removing unreachable block (ram,0x105085b0) */
/* WARNING: Removing unreachable block (ram,0x10508c2e) */
/* WARNING: Removing unreachable block (ram,0x10508d23) */
/* WARNING: Removing unreachable block (ram,0x10508d4d) */
/* WARNING: Removing unreachable block (ram,0x10508d77) */

ushort ClickInShipOrders(POINT pt,short sks,short fCursor,short fRightBtn)

{
  ZIPORDER *pZVar1;
  short *psVar2;
  FLEET *pFVar3;
  POINT pt_00;
  undefined4 uVar4;
  long lVar5;
  long lVar6;
  undefined2 uVar7;
  BOOL BVar8;
  char *pcVar9;
  short sVar10;
  HDC hdc_00;
  short sVar11;
  uint uVar12;
  uint uVar13;
  GrobjClass GVar14;
  HCURSOR HVar15;
  int iVar16;
  short *psVar17;
  undefined2 unaff_SI;
  ZIPORDER *pZVar18;
  undefined2 unaff_DI;
  undefined2 uVar19;
  undefined2 unaff_SS;
  LRESULT LVar20;
  ulong uVar21;
  long lVar22;
  long lVar23;
  ulong uVar24;
  long lVar25;
  int iVar26;
  THING *in_stack_0000fd54;
  SCAN scan;
  THING *lpthMac;
  short iChecked;
  long rgid [100];
  FLEET *lpfl;
  THING *lpth;
  undefined1 auStack_fa [2];
  THING *lpthMac_2;
  long lSel_2;
  long lTempMax;
  short fTwoMAs;
  short fFirst;
  long lTempMin;
  long dx;
  short irc;
  long lNew;
  XFER xf;
  short grbit;
  long xRnd;
  short iSkip;
  long lSel;
  long lMax;
  short idPlan;
  POINT ptOld;
  short iWarp;
  PLANET pl;
  HDC hdc;
  long lCur;
  
  uVar21 = CONCAT22(lMax._2_2_,(undefined2)lMax);
  lVar23 = CONCAT22(unaff_SI,unaff_DI);
  lTempMin._0_2_ = 0;
  lTempMin._2_2_ = 0;
  irc = -1;
  if (sel.grobj == grobjNone) {
    HVar15 = 0;
    lVar22 = sel.fl.rgwtMin[4];
    goto LAB_1050_915f;
  }
  BVar8 = PtInRect((undefined2 *)CONCAT22(0x48d8,pt.y),pt.x);
  if (BVar8 == 0) {
    BVar8 = PtInRect((undefined2 *)CONCAT22(0x4910,pt.y),pt.x);
    uVar7 = sel.fl.lpplord._2_2_;
    lVar22 = sel.fl.rgwtMin[4];
    if (BVar8 == 0) {
      if (fRightBtn != 0) {
        HVar15 = 0;
        goto LAB_1050_915f;
      }
      BVar8 = PtInRect((undefined2 *)CONCAT22((RECT *)rgrcRef,pt.y),pt.x);
      if (BVar8 == 0) {
        BVar8 = PtInRect((undefined2 *)CONCAT22(0x4928,pt.y),pt.x);
        if (BVar8 == 0) {
          BVar8 = PtInRect((undefined2 *)CONCAT22(0x48b8,pt.y),pt.x);
          if (BVar8 == 0) {
            BVar8 = PtInRect((undefined2 *)CONCAT22(0x48c8,pt.y),pt.x);
            if (BVar8 != 0) {
              HVar15 = hcurHand;
              lVar22 = sel.fl.rgwtMin[4];
              if (fCursor == 0) {
                if (sel.fl.idPlanet == -1) {
                  lSel_2 = CONCAT22(lpThings._2_2_,(THING *)lpThings);
                  while( true ) {
                    if (((THING *)lpThings + cThing <= (THING *)lSel_2) ||
                       (((*(uint *)lSel_2 >> 0xd == 1 &&
                         (sel.fl.pt.x == (&((THING *)lSel_2)->pt)->x)) &&
                        (sel.fl.pt.y == (((THING *)lSel_2)->pt).y)))) break;
                    lSel_2 = CONCAT22(lSel_2._2_2_,(THING *)lSel_2 + 1);
                  }
                  if (((THING *)lSel_2 == (THING *)lpThings + cThing) &&
                     (lSel_2._2_2_ == lpThings._2_2_)) {
                    TransferStuff(sel.fl.id,2,-1,4,0);
                  }
                  else {
                    MessageBeep(0);
                  }
                }
                else {
                  TransferStuff(sel.fl.id,2,sel.fl.idPlanet,1,0);
                }
                HVar15 = 0;
                lVar22 = sel.fl.rgwtMin[4];
              }
              goto LAB_1050_915f;
            }
            BVar8 = PtInRect((undefined2 *)CONCAT22(0x48d0,pt.y),pt.x);
            if (BVar8 != 0) {
              HVar15 = hcurHand;
              lVar22 = sel.fl.rgwtMin[4];
              if (fCursor == 0) {
                lSel_2 = SendMessage(hwndShipDD,0x407,0,0);
                if (((int)lSel_2 == -1) && ((int)((ulong)lSel_2 >> 0x10) == -1)) {
                  HVar15 = 0;
                  lVar22 = sel.fl.rgwtMin[4];
                }
                else {
                  sVar11 = sel.fl.id;
                  if (sel.grobj != grobjFleet) {
                    sVar11 = -1;
                  }
                  sVar11 = FLookupOrbitingXfer(sel.pl.id,(int)lSel_2,&xf,sVar11);
                  if (sVar11 != 0) {
                    TransferStuff(sel.id,sel.grobj,xf.id,xf.grobj,0);
                  }
                  HVar15 = 0;
                  lVar22 = sel.fl.rgwtMin[4];
                }
              }
              goto LAB_1050_915f;
            }
            BVar8 = PtInRect((undefined2 *)CONCAT22(0x4940,pt.y),pt.x);
            uVar21 = CONCAT22(lMax._2_2_,(undefined2)lMax);
            uVar4._2_2_ = (undefined2)rgid[0x49];
            uVar4._0_2_ = rgid[0x48]._2_2_;
            lVar22 = sel.fl.rgwtMin[4];
            if (BVar8 != 0) {
              if (((sel.grobj != grobjFleet) && (fCursor != 0)) ||
                 ((*(uint *)((int)(PLORD *)sel.fl.lpplord +
                            sel.iwpAct * 0x12 + 10) & 0xf) != 7)) {
                HVar15 = 0;
                goto LAB_1050_915f;
              }
              irc = 0x12;
              lTempMax = 10;
              lCur._0_2_ = *(uint *)((int)(PLORD *)sel.fl.lpplord +
                                    sel.iwpAct * 0x12 + 0xc);
              lCur._2_2_ = 0;
              grbit = 7;
              rgid._290_4_ = uVar4;
              uVar21 = 10;
            }
          }
          else {
            if (sel.grobj == grobjFleet) {
              idPlan = sel.fl.idPlanet;
              iSkip = sel.fl.id;
            }
            else {
              iSkip = -1;
              idPlan = sel.pl.id;
            }
            LVar20 = SendMessage(hwndShipDD,0x407,0,0);
            FLookupOrbitingXfer(idPlan,(short)LVar20,&xf,iSkip);
            if ((xf.grobj != grobjFleet) || (xf.fl.iPlayer != idPlayer)) {
              HVar15 = 0;
              lVar22 = sel.fl.rgwtMin[4];
              goto LAB_1050_915f;
            }
            irc = 1;
            uVar21 = LGetFleetStat((FLEET *)CONCAT22(unaff_SS,&xf.fl),1);
            iVar16 = xf.fl.rgwtMin[4]._2_2_;
            uVar12 = (uint)xf.fl.rgwtMin[4];
            lCur._0_2_ = (uint)xf.fl.rgwtMin[4];
            lCur._2_2_ = xf.fl.rgwtMin[4]._2_2_;
            grbit = 4;
            if (sel.grobj == grobjFleet) {
              lTempMax = sel.fl.rgwtMin[4] +
                         CONCAT22(xf.fl.rgwtMin[4]._2_2_,(uint)xf.fl.rgwtMin[4]);
              lVar22 = LGetFleetStat(&sel.fl,1);
              uVar13 = (uint)(lVar22 - sel.fl.rgwtMin[4]);
              lTempMin._0_2_ = uVar12 - uVar13;
              lTempMin._2_2_ =
                   (iVar16 - (int)((ulong)(lVar22 - sel.fl.rgwtMin[4]) >> 0x10)) -
                   (uint)(uVar12 < uVar13);
            }
            else {
              lTempMax = CONCAT22(xf.fl.rgwtMin[4]._2_2_,(uint)xf.fl.rgwtMin[4]);
            }
            lVar22 = sel.fl.rgwtMin[4];
          }
        }
        else {
          irc = 0xf;
          iWarp = IWarpMAFromLppl(&sel.pl,&fTwoMAs);
          lTempMax = (long)(iWarp + -1);
          lTempMin._0_2_ = 1;
          lTempMin._2_2_ = 0;
          lCur._0_2_ = (uint)sel.pl.wFlags >> 10 & 0xf;
          lCur._2_2_ = 0;
          uVar21 = (long)(iWarp + -1);
          lVar22 = sel.fl.rgwtMin[4];
        }
      }
      else {
        lVar22 = sel.fl.rgwtMin[4];
        if ((sel.grobj != grobjFleet) && (fCursor != 0)) {
          HVar15 = 0;
          goto LAB_1050_915f;
        }
        irc = 0;
        lTempMax = 0xb;
        lCur._0_2_ = *(uint *)((int)(PLORD *)sel.fl.lpplord +
                              sel.iwpAct * 0x12 + 10) >> 4 & 0xf;
        lCur._2_2_ = 0;
        grbit = 6;
        uVar21 = 0xb;
      }
    }
    else {
      HVar15 = hcurArrowHelp;
      if (fCursor != 0) goto LAB_1050_915f;
      if (fRightBtn == 0) {
        GlobalPD.grPopup = 10;
        GlobalPD.field1_0x2 = 0xb4;
        GlobalPD.field2_0x3 = 0;
        GlobalPD.psz = (char *)szPopupBuffer;
        CchGetString
                  (idsRightClickBlueDiamondBringPopupMenu,(char *)szPopupBuffer);
        Popup(hwndPlanet,pt.x,pt.y);
      }
      else {
        iChecked = -1;
        psVar17 = (short *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 4
                           );
        _auStack_fa = (short *)CONCAT22(sel.fl.lpplord._2_2_,psVar17);
        pt_00.y = psVar17[1];
        pt_00.x = *_auStack_fa;
        FFindNearestObject(pt_00,0x8f,&scan);
        if (scan.idpl == -1) {
          rgid[0]._0_2_ = 0;
          rgid[0]._2_2_ = 0x1000;
        }
        else {
          rgid[0]._2_2_ = scan.idpl >> 0xf;
          rgid[0]._0_2_ = scan.idpl;
        }
        rgid[1]._0_2_ = 0xffff;
        rgid[1]._2_2_ = 0xffff;
        lpthMac_2._2_2_ = 2;
        if ((((uint)psVar17[3] >> 8 & 0xf) == 1) || (((uint)psVar17[3] >> 8 & 0xf) == 4)) {
          iChecked = 0;
        }
        lSel_2 = 0;
        while ((int)(THING *)lSel_2 < cFleet) {
                    /* WARNING: Load size is inaccurate */
          pFVar3 = ((FLEET **)rglpfl)[(int)(THING *)lSel_2];
          iVar16 = *(int *)((int)((FLEET **)rglpfl + (int)(THING *)lSel_2) + 2);
          lpfl = (FLEET *)CONCAT22(iVar16,pFVar3);
          if ((pFVar3 == (FLEET *)0x0) && (iVar16 == 0)) break;
          if ((scan.pt.x == (&pFVar3->pt)->x) &&
             ((scan.pt.y == (pFVar3->pt).y && (lpfl->id != sel.fl.id)))) {
            if ((((uint)psVar17[3] >> 8 & 0xf) == 2) && (psVar17[2] == lpfl->id)) {
              iChecked = lpthMac_2._2_2_;
            }
            iVar26 = lpfl->id;
            iVar16 = lpthMac_2._2_2_ + 1;
            *(int *)(rgid + lpthMac_2._2_2_) = iVar26;
            *(uint *)((int)rgid + lpthMac_2._2_2_ * 4 + 2) = iVar26 >> 0xf | 0x8000;
            lpthMac_2._2_2_ = iVar16;
            if (99 < iVar16) break;
          }
          lSel_2 = (long)((int)(THING *)lSel_2 + 1);
        }
        if (lpthMac_2._2_2_ == 2) {
          lpthMac_2._2_2_ = 1;
        }
        lSel_2 = (long)CONCAT12(lpthMac_2._2_2_ == 0,(THING *)lSel_2);
        lpth = (THING *)CONCAT22(lpThings._2_2_,(THING *)lpThings);
        while ((THING *)lpth < (THING *)lpThings + cThing) {
          uVar19 = (undefined2)((ulong)lpth >> 0x10);
          if ((scan.pt.x == (&((THING *)lpth)->pt)->x) && (scan.pt.y == (((THING *)lpth)->pt).y)) {
            if (lSel_2._2_2_ == 0) {
              if (99 < lpthMac_2._2_2_) break;
              *(undefined2 *)(rgid + lpthMac_2._2_2_) = 0xffff;
              *(undefined2 *)((int)rgid + lpthMac_2._2_2_ * 4 + 2) = 0xffff;
              lSel_2 = CONCAT22(1,(THING *)lSel_2);
              lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1;
            }
            if (99 < lpthMac_2._2_2_) break;
            *(short *)(rgid + lpthMac_2._2_2_) = lpth->idFull;
            *(undefined2 *)((int)rgid + lpthMac_2._2_2_ * 4 + 2) = 0x2000;
            lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1;
          }
          lpth = (THING *)CONCAT22(uVar19,(THING *)lpth + 1);
        }
        in_stack_0000fd54 = (THING *)lpThings;
        sVar11 = PopupMenu(hwndPlanet,pt.x,pt.y,lpthMac_2._2_2_,rgid,(char **)0x0,
                                  iChecked,1);
        lSel_2 = CONCAT22(lSel_2._2_2_,sVar11);
        if (-1 < sVar11) {
          if (((sVar11 == 0) && ((int)rgid[0] == 0)) && (rgid[0]._2_2_ == 0x1000)) {
            psVar17[3] = psVar17[3] & 0xf0ffU | 0x400;
            psVar17[2] = -1;
          }
          else if ((*(uint *)((int)rgid + sVar11 * 4 + 2) & 0x2000) == 0) {
            if ((*(uint *)((int)rgid + sVar11 * 4 + 2) & 0x8000) == 0) {
              psVar17[3] = psVar17[3] & 0xf0ffU | 0x100;
              psVar17[2] = (int)rgid[0];
            }
            else {
              psVar17[3] = psVar17[3] & 0xf0ffU | 0x200;
              psVar17[2] = (short)rgid[sVar11];
            }
          }
          else {
            psVar17[3] = psVar17[3] & 0xf0ffU | 0x800;
            psVar17[2] = (short)rgid[sVar11];
          }
          FLookupFleet(-1,(FLEET *)&sel.fl);
          FillOrdersLB();
          SetOrdersLbSel(sel.iwpAct);
        }
      }
      uVar21 = CONCAT22(lMax._2_2_,(undefined2)lMax);
      lVar22 = sel.fl.rgwtMin[4];
    }
  }
  else {
    HVar15 = hcurArrowHelp;
    lVar22 = sel.fl.rgwtMin[4];
    if (fCursor != 0) goto LAB_1050_915f;
    if (fRightBtn == 0) {
      GlobalPD.grPopup = 6;
      Popup(hwndPlanet,pt.x,pt.y);
    }
    else {
      lSel_2 = 0xff;
      for (lpthMac_2._2_2_ = 0; lpthMac_2._2_2_ < 4; lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1) {
        *(undefined2 *)((int)rgid + lpthMac_2._2_2_ * 2 + 0x186) =
             *(undefined2 *)(lpthMac_2._2_2_ * 2 + 0x906);
      }
      rgid[99]._2_2_ = &lSel_2;
      lSel_2 = CONCAT22(5,(THING *)lSel_2);
      lpthMac_2._2_2_ = 0;
      while( true ) {
        iVar16 = lSel_2._2_2_;
        if (3 < lpthMac_2._2_2_) break;
        if (*(char *)((int)&vrgZip[0].fValid + lpthMac_2._2_2_ * 0x18) != '\0') {
          lSel_2 = CONCAT22(lSel_2._2_2_ + 1,(THING *)lSel_2);
          *(int *)((int)rgid + iVar16 * 2 + 0x186) = lpthMac_2._2_2_ * 0x18 + 0x526e;
        }
        lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1;
      }
      if (5 < lSel_2._2_2_) {
        lSel_2 = CONCAT22(lSel_2._2_2_ + 1,(THING *)lSel_2);
        *(int *)((int)rgid + iVar16 * 2 + 0x186) = (int)&lSel_2;
      }
      pcVar9 = PszGetCompressedString(idsCustomize);
      iVar16 = lSel_2._2_2_;
      lSel_2 = CONCAT22(lSel_2._2_2_ + 1,(THING *)lSel_2);
      *(undefined2 *)((int)rgid + iVar16 * 2 + 0x186) = pcVar9;
      sVar10 = PopupMenu(hwndPlanet,pt.x,pt.y,lSel_2._2_2_,(long *)0x0,
                                (char **)((int)rgid + 0x186),-1,1);
      uVar7 = sel.fl.lpplord._2_2_;
      sVar11 = sel.iwpAct;
      if (sVar10 == lSel_2._2_2_ + -1) {
        _memcpy((void *)((int)rgid + 0x126),(ZIPORDER *)vrgZip,0x60);
        rgid._290_4_ = MakeProcInstance(ZipOrderDlg,hInst);
        rgid[0x48]._0_2_ =
             DialogBox(0,(LPCSTR)CONCAT22(0x59,hwndFrame),
                       (HWND)((ulong)rgid._290_4_ >> 0x10),(void *)rgid._290_4_);
        FreeProcInstance((FARPROC)rgid._290_4_);
        if ((short)rgid[0x48] == 0) {
          _memcpy((ZIPORDER *)vrgZip,(void *)((int)rgid + 0x126),0x60);
        }
      }
      else {
        if (sVar10 < 5) {
          if (sVar10 == -1) goto LAB_1050_8237;
          rgid[0x5f]._2_2_ = (PLORD *)sel.fl.lpplord + 1;
          rgid[0x60]._0_2_ = sel.fl.lpplord._2_2_;
          rgid[0x60]._2_2_ = (PLORD *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 8);
          rgid[0x61]._0_2_ = sel.fl.lpplord._2_2_;
          if (sVar10 == 0) {
            *(uint *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 0x10) =
                 *(uint *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 0x10) & 0xfff |
                 0x7000;
            for (lpthMac_2._2_2_ = 0; lpthMac_2._2_2_ < 3; lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1) {
              *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) =
                   *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) & 0xfff | 0x1000;
            }
            *(uint *)((int)rgid[0x5f]._2_2_ + sVar11 * 0x12 + 0xe) =
                 *(uint *)((int)rgid[0x5f]._2_2_ + sVar11 * 0x12 + 0xe) & 0xfff;
          }
          else if (sVar10 == 1) {
            *(uint *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 0x10) =
                 *(uint *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 0x10) & 0xfff |
                 0x7000;
            for (lpthMac_2._2_2_ = 0; lpthMac_2._2_2_ < 4; lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1) {
              *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) =
                   *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) & 0xfff | 0x2000;
            }
          }
          else if (sVar10 == 2) {
            *(uint *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 0x10) =
                 *(uint *)((int)rgid[0x5f]._2_2_ + sel.iwpAct * 0x12 + 0x10) & 0xfff |
                 0x7000;
            for (lpthMac_2._2_2_ = 0; lpthMac_2._2_2_ < 3; lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1) {
              *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) =
                   *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) & 0xfff | 0x6000;
              *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) =
                   *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) & 0xf000 | 100;
            }
            *(uint *)((int)rgid[0x5f]._2_2_ + sVar11 * 0x12 + 0xe) =
                 *(uint *)((int)rgid[0x5f]._2_2_ + sVar11 * 0x12 + 0xe) & 0xfff;
          }
          else if (sVar10 == 3) {
            for (lpthMac_2._2_2_ = 0; lpthMac_2._2_2_ < 5; lpthMac_2._2_2_ = lpthMac_2._2_2_ + 1) {
              *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) =
                   *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) & 0xfff;
              *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) =
                   *(uint *)((int)rgid[0x60]._2_2_ + lpthMac_2._2_2_ * 2) & 0xf000;
            }
          }
        }
        else {
          lpthMac_2._2_2_ = sVar10 + -4;
          iSkip = 0;
          while ((lpthMac_2._2_2_ != 0 &&
                 ((*(char *)((int)&vrgZip[0].fValid + iSkip * 0x18) == '\0' ||
                  (lpthMac_2._2_2_ = lpthMac_2._2_2_ + -1, lpthMac_2._2_2_ != 0))))) {
            iSkip = iSkip + 1;
          }
          pZVar18 = (ZIPORDER *)vrgZip + iSkip;
          psVar17 = (short *)((int)(PLORD *)sel.fl.lpplord +
                             sel.iwpAct * 0x12 + 0xc);
          for (iVar16 = 5; iVar16 != 0; iVar16 = iVar16 + -1) {
            psVar2 = psVar17;
            psVar17 = psVar17 + 1;
            pZVar1 = pZVar18;
            pZVar18 = (ZIPORDER *)((pZVar18->txp).rgia + 1);
            *psVar2 = (pZVar1->txp).rgia[0].wFlags;
          }
          rgid[0x61]._0_2_ = sel.fl.lpplord._2_2_;
          rgid[0x60]._2_2_ = (PLORD *)sel.fl.lpplord + 1;
        }
        FLookupFleet(-1,(FLEET *)&sel.fl);
        UpdateOrdersDDs(1);
        DrawPlanShip(0,0x100);
      }
    }
LAB_1050_8237:
    lVar22 = sel.fl.rgwtMin[4];
  }
  if (irc == -1) {
    HVar15 = 0;
  }
  else {
    HVar15 = hcurHand;
    if (fCursor == 0) {
      dx._0_2_ = (*(int *)((int)&rgrcRef[0].right + irc * 8) -
                 ((RECT *)rgrcRef + irc)->left) + -2;
      dx._2_2_ = (int)dx >> 0xf;
      sel.fl.rgwtMin[4] = lVar22;
      __aFldiv((long)(int)dx,uVar21 + 1);
      lVar23 = __aFlshr(lVar23,(ushort)in_stack_0000fd54);
      hdc_00 = GetDC(hwndPlanet);
      SetCapture(hwndPlanet);
      ptOld.y = -1;
      ptOld.x = -1;
      if ((long)uVar21 < lTempMax) {
        lTempMax = uVar21;
      }
      if ((lTempMin._2_2_ < 1) && (lTempMin._2_2_ < 0)) {
        lTempMin._0_2_ = 0;
        lTempMin._2_2_ = 0;
      }
      fFirst = 1;
      lVar22 = CONCAT22(lCur._2_2_,(uint)lCur);
LAB_1050_8c8b:
      lVar6 = lVar22;
      lCur._0_2_ = (uint)lVar6;
      if (fFirst == 0) {
        sVar11 = FGetMouseMove(&pt);
        if (sVar11 == 0) goto LAB_1050_8f9c;
      }
      fFirst = 0;
      lVar22 = lVar6;
      if ((pt.x != ptOld.x) || (pt.y != ptOld.y)) {
        ptOld.x = pt.x;
        ptOld.y = pt.y;
        iVar16 = (int)dx;
        iVar26 = dx._2_2_;
        uVar24 = __aFulmul(lVar23 + (pt.x - ((RECT *)rgrcRef + irc)->left),uVar21)
        ;
        lVar25 = __aFldiv(uVar24,CONCAT22(iVar26,iVar16));
        lNew = CONCAT22(lTempMin._2_2_,(int)lTempMin);
        lVar5 = lTempMax;
        if (lVar25 < lTempMax) {
          lVar5 = lVar25;
        }
        if ((lNew <= lVar5) && (lNew = lTempMax, lVar25 < lTempMax)) {
          lNew = lVar25;
        }
        uVar12 = (uint)lNew;
        if (lVar6 != lNew) {
          if (irc == 0) {
            uVar13 = (uVar12 & 0xf) << 4;
            lSel_2 = CONCAT22(uVar12,uVar13);
            *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10) =
                 *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 10
                          ) & 0xff0f | uVar13;
            DrawPlanShip(0,0x4020);
            lVar22 = lNew;
          }
          else if (irc == 0x12) {
            lSel_2 = CONCAT22(uVar12,(THING *)lSel_2);
            *(uint *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc) =
                 uVar12;
            DrawPlanShip(0,0x4100);
            lVar22 = lNew;
          }
          else if (irc == 0xf) {
            iVar16 = iWarp;
            if (fTwoMAs != 0) {
              iVar16 = -iWarp;
            }
            DrawMassWarpGauge(hdc_00,(RECT *)(rgrcRef + 0xf),iVar16,uVar12 + 4);
            lVar22 = lNew;
          }
          else if (irc == 2) {
            sel.fl.rgwtMin[4] = lNew;
            DrawFleetGauge(hdc_00,(RECT *)(rgrcRef + 2),(FLEET *)0x0,grbit);
            lVar22 = lNew;
          }
          else {
            lVar22 = lNew;
            if (irc == 1) {
              if (sel.grobj == grobjFleet) {
                sel.fl.rgwtMin[4] = sel.fl.rgwtMin[4] - (lNew - lVar6);
                DrawFleetGauge(hdc_00,(RECT *)(rgrcRef + 2),&sel.fl,grbit);
              }
              else {
                DrawPlanShip(0,0x4001);
              }
              xf.fl.rgwtMin[4] = lNew;
              DrawFleetGauge(hdc_00,(RECT *)rgrcRef + irc,
                             (FLEET *)CONCAT22(unaff_SS,&xf.fl),grbit);
              lVar22 = lNew;
            }
          }
        }
      }
      goto LAB_1050_8c8b;
    }
  }
LAB_1050_915f:
  sel.fl.rgwtMin[4]._2_2_ = (undefined2)((ulong)lVar22 >> 0x10);
  sel.fl.rgwtMin[4]._0_2_ = (undefined2)lVar22;
  return HVar15;
LAB_1050_8f9c:
  GVar14 = sel.scan.grobjFull;
  if (sel.scan.grobj != grobjOther) {
    GVar14 = sel.scan.grobj;
  }
  if (irc == 2) {
    FLookupFleet(-1,(FLEET *)&sel.fl);
    FLookupPlanet(-1,&pl);
    DrawPlanShip(0,0x4220);
    if (((GVar14 & grobjPlanet) == grobjNone) ||
       (sel.fl.idPlanet != sel.scan.idpl)) {
      if (((GVar14 & grobjFleet) != grobjNone) &&
         (sel.fl.id == ((FLEET **)rglpfl)[sel.scan.ifl]->id)) {
        InvalidateRect(hwndMine,(undefined2 *)0x0,1);
      }
    }
    else {
SHIP_FixMinWin:
      InvalidateMineralBars();
    }
  }
  else if (irc == 1) {
    FLookupFleet(-1,&xf.fl);
    if (sel.grobj == grobjFleet) {
      FLookupFleet(-1,(FLEET *)&sel.fl);
      DrawPlanShip(0,0x4221);
    }
    else {
      FLookupPlanet(-1,(PLANET *)&sel.pl);
      if (((GVar14 & grobjPlanet) != grobjNone) && (sel.pl.id == sel.scan.idpl))
      goto SHIP_FixMinWin;
    }
  }
  else if ((irc == 0) || (irc == 0x12)) {
    FLookupFleet(-1,(FLEET *)&sel.fl);
  }
  else if ((irc == 0xf) && ((uint)lCur != ((uint)sel.pl.wFlags >> 10 & 0xf))) {
    lSel_2 = CONCAT22((uint)lCur,(THING *)lSel_2);
    sel.pl.wFlags = sel.pl.wFlags & 0xc3ffU | ((uint)lCur & 0xf) << 10;
    FLookupPlanet(-1,(PLANET *)&sel.pl);
  }
  ReleaseCapture();
  HVar15 = ReleaseDC(hwndPlanet,hdc_00);
  lVar22 = sel.fl.rgwtMin[4];
  goto LAB_1050_915f;
}



// ======================================================================
// Function: FillFleetCompLB
// Address: 1050:9166
// Segment: MEMORY_SHIP
// ======================================================================


void FillFleetCompLB(void)

{
  undefined2 uVar1;
  ulong uVar2;
  long lVar3;
  long pctDmg;
  short i;
  
  SendMessage(hwndFleetCompLB,0x405,0,0);
  for (i = 0; i < 0x10; i = i + 1) {
    if (0 < *(int *)((int)&sel.fl + 0xc + i * 2)) {
      lVar3 = 500;
      uVar2 = __aFulmul((ulong)(*(uint *)((int)&sel.fl + 0x2c + i * 2) & 0x7f),
                                (ulong)(*(uint *)((int)&sel.fl + 0x2c + i * 2) >> 7));
      lVar3 = __aFldiv(uVar2 + 0xfa,lVar3);
      if (lVar3 == 0) {
        uVar1 = 0x51;
      }
      else {
        uVar1 = 0x50;
      }
      _WSPRINTF((LPSTR)CONCAT22(uVar1,(char *)&DAT_1120_1120),(LPCSTR)0x98a1120,
                (char *)szWork);
      SendMessage(hwndFleetCompLB,0x401,0,0x112057a4);
    }
  }
  return;
}



// ======================================================================
// Function: FillOrdersLB
// Address: 1050:928c
// Segment: MEMORY_SHIP
// ======================================================================


void FillOrdersLB(void)

{
  short *psVar1;
  ORDER *pOVar2;
  char *pcVar3;
  int iVar4;
  short *psVar5;
  ORDER *pOVar6;
  undefined2 unaff_SS;
  ORDER ord;
  char *psz;
  short i;
  
  SendMessage(hwndShipLB,0x405,0,0);
  for (i = 0; i < sel.fl.cord; i = i + 1) {
    psVar5 = (short *)((int)(PLORD *)sel.fl.lpplord + i * 0x12 + 4);
    pOVar6 = &ord;
    for (iVar4 = 9; iVar4 != 0; iVar4 = iVar4 + -1) {
      pOVar2 = pOVar6;
      pOVar6 = (ORDER *)&(pOVar6->pt).y;
      psVar1 = psVar5;
      psVar5 = psVar5 + 1;
      (pOVar2->pt).x = *psVar1;
    }
    pcVar3 = PszGetLocName((uint)ord.wFlags >> 8 &
                                 (grobjThing|grobjOther|grobjFleet|grobjPlanet),ord.id,ord.pt.x,
                                 ord.pt.y);
    SendMessage(hwndShipLB,0x401,0,(LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar3));
  }
  SetOrdersLbSel(sel.iwpAct);
  if (sel.grobj == grobjFleet) {
    DrawPlanShip(0,0x120);
  }
  return;
}



// ======================================================================
// Function: SetOrdersLbSel
// Address: 1050:9354
// Segment: MEMORY_SHIP
// ======================================================================


void SetOrdersLbSel(short iSel)

{
  int iVar1;
  
  SendMessage(hwndShipLB,0x407,iSel,0);
  if (((uint)gd.wFlags >> 3 & 1) == 0) {
    iVar1 = 2;
  }
  else {
    iVar1 = 1;
  }
  if (iVar1 < iSel) {
    if (((uint)gd.wFlags >> 3 & 1) == 0) {
      iVar1 = 2;
    }
    else {
      iVar1 = 1;
    }
    SendMessage(hwndShipLB,0x418,iSel - iVar1,0);
  }
  UpdateWindow(hwndShipLB);
  UpdateOrdersDDs(0);
  return;
}



// ======================================================================
// Function: UpdateOrdersDDs
// Address: 1050:93ee
// Segment: MEMORY_SHIP
// ======================================================================


void UpdateOrdersDDs(short iLevel)

{
  int iVar1;
  char *pcVar2;
  undefined2 unaff_SS;
  long lVar3;
  long lVar4;
  LRESULT LVar5;
  WPARAM WVar6;
  UINT UVar7;
  ushort uVar8;
  char szT [80];
  short iSel;
  char *psz;
  short i;
  short iMin;
  long rglSel [3];
  
  LVar5 = CONCAT22(rglSel[1]._2_2_,(int)rglSel[1]);
  iSel = -1;
  if (iLevel == 0) {
    lVar3 = SendMessage(rghwndOrderDD[0],0x40e,
                        *(uint *)((int)(PLORD *)sel.fl.lpplord +
                                 sel.iwpAct * 0x12 + 10) & 0xf,0);
  }
  else {
    lVar3 = SendMessage(rghwndOrderDD[0],0x407,0,0);
  }
  if (1 < iLevel) {
    LVar5 = SendMessage(rghwndOrderDD[1],0x407,0,0);
    if ((lVar3 != 1) || (3 < iLevel)) goto LAB_1050_987f;
    if ((int)LVar5 == 0) {
      iSel = 4;
    }
    else {
      iSel = (int)LVar5 + -1;
    }
  }
  SendMessage(rghwndOrderDD[1],0x40b,0,0);
  if (lVar3 == 1) {
    lVar4 = LGetFleetStat(&sel.fl,2);
    if (lVar4 == 0) {
      szT[0x4e] = '\x01';
      szT[0x4f] = '\0';
    }
    else {
      szT[0x4e] = '\x05';
      szT[0x4f] = '\0';
    }
    for (i = 0; i < (int)szT._78_2_; i = i + 1) {
      if (i == 0) {
        iMin = 4;
      }
      else {
        iMin = i + -1;
      }
      _strcpy((char *)szWork + 1,(char *)*(undefined2 *)(iMin * 2 + 0x4cc));
      if (*(uint *)((int)(PLORD *)sel.fl.lpplord +
                   iMin * 2 + sel.iwpAct * 0x12 + 0xc) >> 0xc == 0) {
        szWork[0] = ' ';
      }
      else {
        szWork[0] = '*';
        if (iSel == -1) {
          iSel = iMin;
        }
      }
      SendMessage(rghwndOrderDD[1],0x403,0,0x112057a4);
    }
    if ((iSel == -1) || (iSel == 4)) {
      iSel = 0;
    }
    else {
      iSel = iSel + 1;
    }
    LVar5 = SendMessage(rghwndOrderDD[1],0x40e,iSel,0);
  }
  else if (lVar3 == 7) {
    pcVar2 = PszGetCompressedString(idsWithinDLY);
    for (i = 0; i < 0xb; i = i + 1) {
      _WSPRINTF((LPSTR)CONCAT22(i * 0x32 + 0x32,(char *)&DAT_1120_1120),
                (LPCSTR)CONCAT22(pcVar2,(char *)&DAT_1120_1120),(char *)szWork);
      SendMessage(rghwndOrderDD[1],0x403,0,0x112057a4);
    }
    pcVar2 = PszGetCompressedString(idsAnyEnemy);
    SendMessage(rghwndOrderDD[1],0x403,0,
                (LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2));
    LVar5 = SendMessage(rghwndOrderDD[1],0x40e,
                        *(WPARAM *)
                         ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xe
                         ),0);
  }
  else if (lVar3 == 9) {
    szT[0] = ' ';
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if (i != idPlayer) {
        pcVar2 = PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
        _strcpy(szT + 1,pcVar2);
        SendMessage(rghwndOrderDD[1],0x403,0,(LPARAM)CONCAT22(unaff_SS,szT));
      }
    }
    LVar5 = SendMessage(rghwndOrderDD[1],0x40e,
                        *(WPARAM *)
                         ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc
                         ),0);
  }
  else if (lVar3 == 6) {
    for (i = 0; i < 5; i = i + 1) {
      iVar1 = i + 1;
      pcVar2 = PszGetCompressedString(idsDYearC);
      _WSPRINTF((LPSTR)CONCAT22(iVar1,(char *)&DAT_1120_1120),
                (LPCSTR)CONCAT22(pcVar2,(char *)&DAT_1120_1120),(char *)szWork);
      SendMessage(rghwndOrderDD[1],0x403,0,0x112057a4);
    }
    UVar7 = 0x403;
    WVar6 = 0;
    uVar8 = rghwndOrderDD[1];
    pcVar2 = PszGetCompressedString(idsIindefinitely);
    SendMessage(uVar8,UVar7,WVar6,(LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2));
    LVar5 = SendMessage(rghwndOrderDD[1],0x40e,
                        *(WPARAM *)
                         ((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 0xc
                         ),0);
  }
LAB_1050_987f:
  rglSel[1]._0_2_ = (int)LVar5;
  if (iLevel < 3) {
    SendMessage(rghwndOrderDD[2],0x40b,0,0);
    if (lVar3 == 1) {
      for (i = 0x6d; rglSel[1]._2_2_ = (int)((ulong)LVar5 >> 0x10), i < 0x77; i = i + 1) {
        if (((i == 0x74) && ((int)rglSel[1] == 0)) && (rglSel[1]._2_2_ == 0)) {
          psz = PszGetCompressedString(idsLoadOptimal);
        }
        else {
          psz = PszGetCompressedString(i);
        }
        SendMessage(rghwndOrderDD[2],0x403,0,
                    (LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,psz));
      }
      if ((int)rglSel[1] == 0) {
        iSel = 4;
      }
      else {
        iSel = (int)rglSel[1] + -1;
      }
      SendMessage(rghwndOrderDD[2],0x40e,
                  *(uint *)((int)(PLORD *)sel.fl.lpplord +
                           iSel * 2 + sel.iwpAct * 0x12 + 0xc) >> 0xc,0);
    }
  }
  else {
    SendMessage(rghwndOrderDD[2],0x407,0,0);
  }
  if ((iLevel < 4) && (lVar3 == 1)) {
    if ((int)rglSel[1] == 0) {
      iSel = 4;
    }
    else {
      iSel = (int)rglSel[1] + -1;
    }
    _WSPRINTF((LPSTR)((ulong)CONCAT22(*(undefined2 *)
                                       ((int)(PLORD *)sel.fl.lpplord +
                                       iSel * 2 + sel.iwpAct * 0x12 + 0xc),
                                      (undefined1 *)&DAT_1120_1120) & 0xfffffff),(LPCSTR)0x9941120,
              (char *)szWork);
    SetWindowText(hwndOrderED,szWork);
  }
  return;
}



// ======================================================================
// Function: FillBattleDD
// Address: 1050:9a36
// Segment: MEMORY_SHIP
// ======================================================================


void FillBattleDD(short iSel)

{
  short i;
  
  SendMessage(hwndBattleDD,0x40b,0,0);
  CchGetString(idsBattlePlans,(char *)szWork);
  SendMessage(hwndBattleDD,0x403,0,0x112057a4);
  for (i = 0; i < (int)(uint)((byte *)rgcbtlplan)[idPlayer]; i = i + 1) {
    __fstrcpy(szWork,
                      (char *)CONCAT22(((undefined2 *)&DAT_1120_593a)[idPlayer * 2],
                                       ((BTLPLAN **)rglpbtlplan)[idPlayer * 2][i].
                                       szName));
    SendMessage(hwndBattleDD,0x403,0,0x112057a4);
  }
  SendMessage(hwndBattleDD,0x40e,iSel,0);
  return;
}



// ======================================================================
// Function: DeleteCurWayPoint
// Address: 1050:9b08
// Segment: MEMORY_SHIP
// ======================================================================


void DeleteCurWayPoint(short fBackup)

{
  byte *pbVar1;
  int iVar2;
  POINT pt_00;
  int iVar3;
  int iVar4;
  int *piVar5;
  int *piVar6;
  short *psVar7;
  undefined2 unaff_SS;
  RECT rc;
  short ipt;
  SCAN scan;
  short cpt;
  POINT rgpt [3];
  POINT pt;
  
  if ((sel.fl.cord < 2) || (sel.iwpAct == 0)) {
    MessageBeep(0x40);
  }
  else {
    if ((grbitScan & 0x80) != 0) {
      psVar7 = (short *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 4);
      rgpt[0].x = *psVar7;
      rgpt[0].y = psVar7[1];
      psVar7 = (short *)((int)(PLORD *)sel.fl.lpplord +
                        (sel.iwpAct + -1) * 0x12 + 4);
      rgpt[1].x = *psVar7;
      rgpt[1].y = psVar7[1];
      if (sel.iwpAct < sel.fl.cord + -1) {
        cpt = 3;
        psVar7 = (short *)((int)(PLORD *)sel.fl.lpplord +
                          (sel.iwpAct + 1) * 0x12 + 4);
        rgpt[2].x = *psVar7;
        rgpt[2].y = psVar7[1];
      }
      else {
        cpt = 2;
      }
    }
    RedrawScanSel(0,0);
    rc.bottom = (short)((PLORD *)sel.fl.lpplord + 1);
    rc.top = (short)((PLORD *)sel.fl.lpplord + 1);
    rc.right = sel.fl.lpplord._2_2_;
    __fmemmove((void *)CONCAT22(sel.fl.lpplord._2_2_,
                                        (void *)(rc.top + sel.iwpAct * 0x12)),
                       (void *)CONCAT22(sel.fl.lpplord._2_2_,
                                        (void *)(rc.bottom + (sel.iwpAct + 1) * 0x12)),
                       ((sel.fl.cord - sel.iwpAct) + -1) * 0x12);
    sel.fl.cord = sel.fl.cord + -1;
    pbVar1 = &((PLORD *)sel.fl.lpplord)->iordMac;
    *pbVar1 = *pbVar1 - 1;
    iVar2 = sel.iwpAct + -1;
    if (iVar2 < sel.fl.cord + -1) {
      piVar5 = (int *)((int)(PLORD *)sel.fl.lpplord + iVar2 * 0x12 + 4);
      piVar6 = (int *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 4);
      if ((*piVar5 == *piVar6) && (piVar5[1] == piVar6[1])) {
        rc.bottom = (short)((PLORD *)sel.fl.lpplord + 1);
        iVar3 = sel.iwpAct + 1;
        rc.top = (short)((PLORD *)sel.fl.lpplord + 1);
        rc.right = sel.fl.lpplord._2_2_;
        iVar4 = sel.iwpAct * 0x12;
        sel.iwpAct = iVar2;
        __fmemmove((void *)CONCAT22(sel.fl.lpplord._2_2_,(void *)(rc.top + iVar4))
                           ,(void *)CONCAT22(sel.fl.lpplord._2_2_,
                                             (void *)(rc.bottom + iVar3 * 0x12)),
                           ((sel.fl.cord - iVar2) + -2) * 0x12);
        sel.fl.cord = sel.fl.cord + -1;
        pbVar1 = &((PLORD *)sel.fl.lpplord)->iordMac;
        *pbVar1 = *pbVar1 - 1;
        iVar2 = sel.iwpAct;
      }
    }
    sel.iwpAct = iVar2;
    if ((fBackup == 0) && (sel.iwpAct < sel.fl.cord + -1)) {
      sel.iwpAct = sel.iwpAct + 1;
    }
    RedrawScanSel(0,0);
    FLookupFleet(-1,(FLEET *)&sel.fl);
    psVar7 = (short *)((int)(PLORD *)sel.fl.lpplord + sel.iwpAct * 0x12 + 4);
    pt_00.y = psVar7[1];
    pt_00.x = *psVar7;
    FFindNearestObject(pt_00,0x8f,&scan);
    sel.iwpAct = -2;
    ChangeScanSel(&scan,1);
    if ((grbitScan & 0x80) != 0) {
      for (ipt = 0; ipt < cpt; ipt = ipt + 1) {
        LogicalToScan(rgpt + ipt);
      }
      BoundPoints(&rc,rgpt,cpt);
      InvalidateRect(hwndScanner,(undefined2 *)CONCAT22(unaff_SS,&rc),1);
    }
  }
  return;
}



// ======================================================================
// Function: DeleteWpFar
// Address: 1050:9e28
// Segment: MEMORY_SHIP
// ======================================================================


void DeleteWpFar(FLEET *lpfl,short iDel,short fRecycle)

{
  byte *pbVar1;
  ORDER *pOVar2;
  short *psVar3;
  undefined2 uVar4;
  undefined2 uVar5;
  int iVar6;
  FLEET *pFVar7;
  int *piVar8;
  int *piVar9;
  ORDER *pOVar10;
  short *psVar11;
  undefined2 uVar12;
  undefined2 unaff_SS;
  ORDER ord;
  
  pFVar7 = (FLEET *)lpfl;
  uVar12 = (undefined2)((ulong)lpfl >> 0x10);
  if (fRecycle != 0) {
    if ((iDel != 0x56) && (pFVar7->cord != 2)) {
      uVar5 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
      piVar8 = (int *)(*(int *)&pFVar7->lpplord + 4 + iDel * 0x12);
      uVar4 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
      piVar9 = (int *)(*(int *)&pFVar7->lpplord + 4 + (pFVar7->cord + -1) * 0x12);
      if ((*piVar9 != *piVar8) || (piVar9[1] != piVar8[1])) {
        uVar5 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
        psVar11 = (short *)(*(int *)&pFVar7->lpplord + 4 + iDel * 0x12);
        pOVar10 = &ord;
        for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
          pOVar2 = pOVar10;
          pOVar10 = (ORDER *)&(pOVar10->pt).y;
          psVar3 = psVar11;
          psVar11 = psVar11 + 1;
          (pOVar2->pt).x = *psVar3;
        }
        goto LAB_1050_9ef2;
      }
    }
    fRecycle = 0;
  }
LAB_1050_9ef2:
  __fmemmove((void *)CONCAT22(*(undefined2 *)((int)&pFVar7->lpplord + 2),
                                      (void *)(*(int *)&pFVar7->lpplord + 4 + iDel * 0x12)),
                     (void *)CONCAT22(*(undefined2 *)((int)&pFVar7->lpplord + 2),
                                      (void *)(*(int *)&pFVar7->lpplord + 4 + (iDel + 1) * 0x12)),
                     ((pFVar7->cord - iDel) + -1) * 0x12);
  if (fRecycle == 0) {
    pFVar7->cord = pFVar7->cord + -1;
    pbVar1 = &((PLORD *)pFVar7->lpplord)->iordMac;
    *pbVar1 = *pbVar1 - 1;
  }
  else {
    uVar5 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
    psVar11 = (short *)(*(int *)&pFVar7->lpplord + 4 + (pFVar7->cord + -1) * 0x12);
    pOVar10 = &ord;
    for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
      psVar3 = psVar11;
      psVar11 = psVar11 + 1;
      pOVar2 = pOVar10;
      pOVar10 = (ORDER *)&(pOVar10->pt).y;
      *psVar3 = (pOVar2->pt).x;
    }
  }
  return;
}



// ======================================================================
// Function: EstFuelUse
// Address: 1050:9fe4
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050a4de) */
/* WARNING: Removing unreachable block (ram,0x1050a4f6) */
/* WARNING: Removing unreachable block (ram,0x1050a3d8) */
/* WARNING: Removing unreachable block (ram,0x1050a680) */
/* WARNING: Removing unreachable block (ram,0x1050a50e) */
/* WARNING: Removing unreachable block (ram,0x1050a526) */
/* WARNING: Removing unreachable block (ram,0x1050a53e) */

long EstFuelUse(FLEET *lpfl,short iOrd,short iWarp,long dTravel,short fRangeOnly)

{
  uint *puVar1;
  int *piVar2;
  uint uVar3;
  short sVar4;
  ORDER *pOVar5;
  FLEET *pFVar6;
  int iVar7;
  SHDEF *pSVar8;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar9;
  bool bVar10;
  HULDEF *pHVar11;
  ENGINE *pEVar12;
  ulong uVar13;
  ulong uVar14;
  long lVar15;
  long lVar16;
  undefined2 uVar17;
  undefined2 uVar18;
  undefined2 uVar19;
  int in_stack_0000ff86;
  uint in_stack_0000ff88;
  long rgieff [16];
  long wtMass;
  short j;
  long wtCargo;
  SHDEF *lpshdef;
  short i;
  ORDER *lpord;
  long lFuel;
  long wtCargoT;
  long iEffCur;
  double d;
  short fEfficient;
  long lT;
  long iEffNext;
  
  iEffCur._0_2_ = 0;
  iEffCur._2_2_ = 0;
  gd._0_2_ = gd._0_2_ & 0xffbf;
  pFVar6 = (FLEET *)lpfl;
  uVar9 = (undefined2)((ulong)lpfl >> 0x10);
  if (iWarp == -1) {
    iWarp = *(uint *)(*(int *)&pFVar6->lpplord + (iOrd + 1) * 0x12 + 10) >> 4 & 0xf;
  }
  sVar4 = GetRaceGrbit((PLAYER *)rgplr + pFVar6->iPlayer,ibitRaceIFE);
  i = 0;
  iVar7 = pFVar6->iPlayer * 4;
  lpshdef = (SHDEF *)CONCAT22(*(undefined2 *)(iVar7 + 0x100),(SHDEF *)*(undefined2 *)(iVar7 + 0xfe))
  ;
  do {
    if (0xf < i) {
      wtCargo._0_2_ = 0;
      wtCargo._2_2_ = 0;
      for (i = 0; i < 4; i = i + 1) {
        uVar3 = *(uint *)(pFVar6->rgwtMin + i);
        bVar10 = CARRY2((uint)wtCargo,uVar3);
        wtCargo._0_2_ = (uint)wtCargo + uVar3;
        wtCargo._2_2_ = wtCargo._2_2_ + *(uint *)((int)(pFVar6->rgwtMin + i) + 2) + (uint)bVar10;
      }
      if (((int)dTravel == -1) && (dTravel._2_2_ == -1)) {
        if (fRangeOnly == 0) {
          in_stack_0000ff88 = *(uint *)((int)&pFVar6->lpplord + 2);
          in_stack_0000ff86 = *(int *)&pFVar6->lpplord + 4;
          pOVar5 = (ORDER *)(in_stack_0000ff86 + iOrd * 0x12);
          lpord = (ORDER *)CONCAT22(in_stack_0000ff88,pOVar5);
          DGetDistance((lpord->pt).x,(pOVar5->pt).y,((pOVar5 + 1)->pt).x,pOVar5[1].pt.y);
          lVar16 = __ftol((double)CONCAT26(in_stack_0000ff88,
                                                   CONCAT24(in_stack_0000ff86,
                                                            CONCAT22(unaff_SI,unaff_DI))));
          dTravel = (long)(int)lVar16;
        }
        else {
          dTravel = 1000;
        }
      }
      lVar16 = 0;
      while( true ) {
        iEffNext._0_2_ = 0x423f;
        iEffNext._2_2_ = 0xf;
        for (i = 0; i < 0x10; i = i + 1) {
          if (0 < pFVar6->rgcsh[i]) {
            if ((*(uint *)(rgieff + i) == (uint)iEffCur) &&
               (*(int *)((int)rgieff + i * 4 + 2) == iEffCur._2_2_)) {
              iVar7 = pFVar6->iPlayer * 4;
              sVar4 = WtMaxShdefStat((SHDEF *)CONCAT22(*(undefined2 *)(iVar7 + 0x100),
                                                       (SHDEF *)(*(int *)(iVar7 + 0xfe) + i * 0x93))
                                     ,2);
              uVar13 = __aFulmul((long)pFVar6->rgcsh[i],(long)sVar4);
              if (CONCAT22(wtCargo._2_2_,(uint)wtCargo) < (long)uVar13) {
                uVar13 = CONCAT22(wtCargo._2_2_,(uint)wtCargo);
              }
              else {
                iVar7 = pFVar6->iPlayer * 4;
                sVar4 = WtMaxShdefStat((SHDEF *)CONCAT22(*(undefined2 *)(iVar7 + 0x100),
                                                         (SHDEF *)(*(int *)(iVar7 + 0xfe) + i * 0x93
                                                                  )),2);
                uVar13 = __aFulmul((long)pFVar6->rgcsh[i],(long)sVar4);
              }
              bVar10 = (uint)wtCargo < (uint)uVar13;
              wtCargo._0_2_ = (uint)wtCargo - (uint)uVar13;
              wtCargo._2_2_ = (wtCargo._2_2_ - (int)(uVar13 >> 0x10)) - (uint)bVar10;
              iVar7 = *(int *)((int)rgieff + i * 4 + 2);
              if ((-1 < iVar7) && ((0 < iVar7 || ((int)rgieff[i] != 0)))) {
                iVar7 = pFVar6->iPlayer * 4;
                uVar14 = __aFulmul((long)pFVar6->rgcsh[i],
                                           (ulong)*(uint *)(*(int *)(iVar7 + 0xfe) + i * 0x93 + 0x28
                                                           ));
                uVar13 = uVar13 + uVar14;
                uVar14 = __aFulmul(CONCAT22(iEffCur._2_2_,(uint)iEffCur),dTravel);
                if (((long)uVar13 < 200) ||
                   ((((long)uVar14 < 500000 && ((long)uVar13 < 4000)) ||
                    (((long)uVar14 < 100000 && ((long)uVar13 < 20000)))))) {
                  uVar19 = 0;
                  uVar17 = 2000;
                  uVar13 = __aFulmul(uVar13,uVar14);
                  lVar15 = __aFldiv(uVar13,CONCAT22(uVar19,uVar17));
                  lVar16 = lVar15 + lVar16;
                }
                else {
                  lVar15 = __ftol((double)CONCAT26(in_stack_0000ff88,
                                                           CONCAT24(in_stack_0000ff86,
                                                                    CONCAT22(unaff_SI,unaff_DI))));
                  lVar16 = lVar15 + lVar16;
                }
              }
            }
            else {
              iVar7 = *(int *)((int)rgieff + i * 4 + 2);
              if ((iEffCur._2_2_ <= iVar7) &&
                 ((iEffCur._2_2_ < iVar7 || ((uint)iEffCur < *(uint *)(rgieff + i))))) {
                iVar7 = *(int *)((int)rgieff + i * 4 + 2);
                if ((iVar7 <= iEffNext._2_2_) &&
                   ((iVar7 < iEffNext._2_2_ || (*(uint *)(rgieff + i) < (uint)iEffNext)))) {
                  iEffNext._0_2_ = *(uint *)(rgieff + i);
                  iEffNext._2_2_ = *(int *)((int)rgieff + i * 4 + 2);
                }
              }
            }
          }
        }
        if (((uint)iEffNext == 0x423f) && (iEffNext._2_2_ == 0xf)) break;
        iEffCur._0_2_ = (uint)iEffNext;
        iEffCur._2_2_ = iEffNext._2_2_;
      }
      if (fRangeOnly == 0) {
        lVar16 = lVar16 + 9;
      }
      lVar16 = __aFldiv(lVar16,10);
      if (fRangeOnly != 0) {
        if (lVar16 == 0) {
          lVar16 = 1000000000;
        }
        else if (lVar16 < 0x186a1) {
          uVar13 = __aFulmul(CONCAT22(*(undefined2 *)((int)pFVar6->rgwtMin + 0x12),
                                              (int)pFVar6->rgwtMin[4]),1000);
          lVar16 = __aFldiv(uVar13,lVar16);
        }
        else {
          lVar16 = __aFldiv(lVar16,1000);
          lVar16 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar6->rgwtMin + 0x12),
                                             (int)pFVar6->rgwtMin[4]),lVar16);
        }
      }
      return lVar16;
    }
    pSVar8 = (SHDEF *)lpshdef;
    uVar17 = (undefined2)((ulong)lpshdef >> 0x10);
    if (pFVar6->rgcsh[i] != 0) {
      j = 0;
      while ((j < (int)(uint)(pSVar8->hul).chs && (((pSVar8->hul).rghs + j)->grhst != hstEngine))) {
        j = j + 1;
      }
      if (j != (uint)(pSVar8->hul).chs) {
        in_stack_0000ff88 = (uint)(pSVar8->hul).rghs[j].wFlags >> 8;
        pHVar11 = LphuldefFromId((lpshdef->hul).ihuldef);
        if ((uint)(((HULDEF *)pHVar11)->hul).rghs[j].wFlags >> 8 <= in_stack_0000ff88) {
          pEVar12 = LpengineFromId((pSVar8->hul).rghs[j].wFlags & 0xff);
          iVar7 = ((ENGINE *)pEVar12)->rgcFuelUsed[iWarp];
          *(int *)(rgieff + i) = iVar7;
          *(int *)((int)rgieff + i * 4 + 2) = iVar7 >> 0xf;
          if (sVar4 != 0) {
            uVar18 = 0;
            uVar19 = 100;
            uVar13 = __aFulmul(CONCAT22(*(undefined2 *)((int)rgieff + i * 4 + 2),
                                                (int)rgieff[i]),0xf);
            lVar16 = __aFldiv(uVar13,CONCAT22(uVar18,uVar19));
            puVar1 = (uint *)(rgieff + i);
            uVar3 = *puVar1;
            *puVar1 = *puVar1 - (uint)lVar16;
            piVar2 = (int *)((int)rgieff + i * 4 + 2);
            *piVar2 = (*piVar2 - (int)((ulong)lVar16 >> 0x10)) - (uint)(uVar3 < (uint)lVar16);
          }
          if (((pSVar8->hul).rghs[j].wFlags & 0xffU) == 10) {
            gd._0_2_ = gd._0_2_ & 0xffbf | 0x40;
          }
          goto LAB_1050_a07d;
        }
      }
      *(undefined2 *)(rgieff + i) = 0x869f;
      *(undefined2 *)((int)rgieff + i * 4 + 2) = 1;
    }
LAB_1050_a07d:
    i = i + 1;
    lpshdef = (SHDEF *)CONCAT22(uVar17,pSVar8 + 1);
  } while( true );
}



// ======================================================================
// Function: FakeEditProc
// Address: 1050:a700
// Segment: MEMORY_SHIP
// ======================================================================


long FakeEditProc(HWND hwnd,ushort msg,ushort wParam,long lParam)

{
  LRESULT LVar1;
  
  if ((msg == 0x102) && (((wParam < 0x30 || (0x39 < wParam)) && (wParam != 8)))) {
    LVar1 = 0;
  }
  else {
    LVar1 = CallWindowProc((fn_lpfnRealEditProc *)
                           CONCAT22(lpfnRealEditProc._2_2_,
                                    (fn_lpfnRealEditProc *)lpfnRealEditProc),hwnd,msg,
                           wParam,lParam);
  }
  return LVar1;
}



// ======================================================================
// Function: IFindIdealWarp
// Address: 1050:a76e
// Segment: MEMORY_SHIP
// ======================================================================


short IFindIdealWarp(FLEET *lpfl,short fIgnoreScoops)

{
  uint id;
  ENGINE *pEVar1;
  undefined2 uVar2;
  int iVar3;
  ENGINE *pEVar4;
  ENGINE *lpengine;
  short iWorst;
  short j;
  short i;
  
  iWorst = 10;
  if (((FLEET *)lpfl == (FLEET *)0x0) && (lpfl._2_2_ == 0)) {
    lpfl = &sel.fl;
  }
  i = 0;
  do {
    if (0xf < i) {
      return iWorst;
    }
    if (0 < ((FLEET *)lpfl)->rgcsh[i]) {
      j = 0;
      while ((iVar3 = ((FLEET *)lpfl)->iPlayer * 4,
             j < (int)(uint)*(byte *)(*(int *)(iVar3 + 0xfe) + i * 0x93 + 0x7a) &&
             (iVar3 = ((FLEET *)lpfl)->iPlayer * 4,
             *(int *)(*(int *)(iVar3 + 0xfe) + i * 0x93 + 0x3a + j * 4) != 1))) {
        j = j + 1;
      }
      iVar3 = ((FLEET *)lpfl)->iPlayer * 4;
      if (j == (uint)*(byte *)(*(int *)(iVar3 + 0xfe) + i * 0x93 + 0x7a)) {
        return 0;
      }
      iVar3 = ((FLEET *)lpfl)->iPlayer * 4;
      id = *(uint *)(*(int *)(iVar3 + 0xfe) + i * 0x93 + j * 4 + 0x3c) & 0xff;
      pEVar4 = LpengineFromId(id);
      uVar2 = (undefined2)((ulong)pEVar4 >> 0x10);
      pEVar1 = (ENGINE *)pEVar4;
      for (; 0 < iWorst; iWorst = iWorst + -1) {
        if (pEVar1->rgcFuelUsed[iWorst] < 0x79) {
          if ((((0 < pEVar1->rgcFuelUsed[iWorst]) && (fIgnoreScoops == 0)) && (id != 0xe)) &&
             (id != 0xf)) {
            if ((iWorst < 5) || (pEVar1->rgcFuelUsed[iWorst + -1] != 0)) {
              if ((iWorst < 6) || (pEVar1->rgcFuelUsed[iWorst + -2] != 0)) {
                if ((6 < iWorst) && (pEVar1->rgwtOreCost[iWorst + 2] == 0)) {
                  iWorst = iWorst + -3;
                }
              }
              else {
                iWorst = iWorst + -2;
              }
            }
            else {
              iWorst = iWorst + -1;
            }
          }
          if (((((iWorst == 10) && (id != 7)) && (id != 8)) && ((id != 9 && (id != 0xe)))) &&
             (id != 0xf)) {
            iWorst = 9;
          }
          break;
        }
      }
    }
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: LFuelUseToWaypoint
// Address: 1050:a9f4
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050acd4) */
/* WARNING: Removing unreachable block (ram,0x1050abf7) */
/* WARNING: Removing unreachable block (ram,0x1050ad42) */
/* WARNING: Removing unreachable block (ram,0x1050acf0) */
/* WARNING: Removing unreachable block (ram,0x1050ad75) */

long LFuelUseToWaypoint(FLEET *lpfl,short iwp,short fMaxCargo)

{
  undefined2 uVar1;
  long lVar2;
  long lVar3;
  int iVar4;
  uint uVar5;
  uint iWarp_00;
  PLANET *pPVar6;
  undefined2 uVar7;
  FLEET *pFVar8;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar9;
  ulong uVar10;
  ulong uVar11;
  ulong uVar12;
  long lVar13;
  ulong uVar14;
  PLANET *pPVar15;
  HULDEF *pHVar16;
  uint in_stack_0000ffc2;
  undefined2 in_stack_0000ffc4;
  long lFuelGain;
  long lOneYearUse;
  long l;
  double dbl;
  short j;
  SHDEF *lpshdef;
  short cYears;
  ORDER *lpord;
  long lTot;
  short i;
  PLANET *lppl;
  short dist;
  short iWarp;
  long lCur;
  
  lVar3 = 0;
  lVar2 = 0;
  uVar9 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar8 = (FLEET *)lpfl;
  uVar1 = *(undefined2 *)((int)&pFVar8->lpplord + 2);
  iVar4 = *(int *)&pFVar8->lpplord + 4;
  for (i = 0; i < iwp; i = i + 1) {
    uVar5 = *(uint *)(iVar4 + (i + 1) * 0x12 + 6) >> 4;
    iWarp_00 = uVar5 & 0xf;
    if ((iWarp_00 == 0) || (10 < iWarp_00)) {
      cYears = 1;
      uVar10 = 0;
    }
    else {
      DGetDistance(*(short *)(iVar4 + i * 0x12),*(short *)(iVar4 + i * 0x12 + 2),
                         *(short *)(iVar4 + (i + 1) * 0x12),*(short *)(iVar4 + (i + 1) * 0x12 + 2));
      lVar13 = __ftol((double)CONCAT26(in_stack_0000ffc4,
                                               CONCAT24(in_stack_0000ffc2,
                                                        CONCAT22(unaff_SI,unaff_DI))));
      dist = (short)lVar13;
      in_stack_0000ffc4 = 0;
      in_stack_0000ffc2 = iWarp_00;
      lVar13 = __ftol((double)((qword)CONCAT24(uVar5,CONCAT22(unaff_SI,unaff_DI)) &
                                      0xffff000fffffffff));
      cYears = (short)lVar13;
      uVar10 = EstFuelUse(lpfl,i,iWarp_00,-1,0);
    }
    uVar12 = uVar10;
    if (1 < cYears) {
      uVar11 = EstFuelUse(lpfl,i,iWarp_00,(long)(int)(iWarp_00 * iWarp_00),0);
      uVar12 = __aFulmul(uVar11,(long)(cYears + -1));
      lVar13 = EstFuelUse(lpfl,i,iWarp_00,(long)(int)(dist - iWarp_00 * iWarp_00 * (cYears + -1)),0)
      ;
      if ((long)uVar10 < (long)(lVar13 + uVar12)) {
        uVar10 = lVar13 + uVar12;
      }
      lFuelGain = LCalcFuelGainFromRamScoops(lpfl,iWarp_00,(long)(int)(iWarp_00 * iWarp_00));
      for (j = 0; j < 0x10; j = j + 1) {
        if ((pFVar8->rgcsh[j] != 0) &&
           ((lpshdef = (SHDEF *)CONCAT22(*(undefined2 *)(idPlayer * 4 + 0x100),
                                         (SHDEF *)(*(int *)(idPlayer * 4 + 0xfe) + j * 0x93))
            , (lpshdef->hul).ihuldef == ihuldefFuelTransport ||
            ((lpshdef->hul).ihuldef == ihuldefSuperFuelXport)))) {
          uVar12 = __aFulmul((long)pFVar8->rgcsh[j],200);
          lFuelGain = uVar12 + lFuelGain;
        }
      }
      uVar12 = uVar10;
      if ((0 < lFuelGain) && (uVar12 = uVar11, lFuelGain < (long)uVar11)) {
        uVar14 = __aFulmul(uVar11 - lFuelGain,(long)(cYears + -1));
        uVar12 = uVar10;
        if ((long)(uVar11 + uVar14) < (long)uVar10) {
          uVar12 = uVar11 + uVar14;
        }
      }
    }
    lVar2 = uVar12 + lVar2;
    if (lVar3 < lVar2) {
      lVar3 = lVar2;
    }
    if ((*(uint *)(iVar4 + (i + 1) * 0x12 + 6) >> 8 & 0xf) == 1) {
      pPVar15 = LpplFromId(*(short *)(iVar4 + (i + 1) * 0x12 + 4));
      uVar7 = (undefined2)((ulong)pPVar15 >> 0x10);
      pPVar6 = (PLANET *)pPVar15;
      if ((((pPVar15 != (PLANET *)0x0) && (pPVar6->iPlayer == idPlayer)) &&
          (((uint)pPVar6->wFlags >> 9 & 1) != 0)) &&
         (pHVar16 = LphuldefFromId
                              (*(HullDef *)
                                (*(int *)(idPlayer * 4 + 0x14c) +
                                (*(uint *)&pPVar6->field11_0x2c & 0xf) * 0x93)),
         (((HULDEF *)pHVar16)->hul).wtCargoMax != 0)) {
        lVar2 = 0;
      }
    }
  }
  return lVar3;
}



// ======================================================================
// Function: FleetTransferCargoBalance
// Address: 1050:ae74
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050b3ee) */
/* WARNING: Removing unreachable block (ram,0x1050b848) */
/* WARNING: Removing unreachable block (ram,0x1050bfc6) */
/* WARNING: Removing unreachable block (ram,0x1050c066) */
/* WARNING: Removing unreachable block (ram,0x1050c0db) */
/* WARNING: Removing unreachable block (ram,0x1050c10c) */

void FleetTransferCargoBalance(FLEET *pflNew1,FLEET *pflNew2)

{
  uint *puVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  FLEET *pFVar6;
  short sVar7;
  short sVar8;
  uint uVar9;
  SHDEF *pSVar10;
  int iVar11;
  int iVar12;
  undefined2 *puVar13;
  int iVar14;
  uint *puVar15;
  int *piVar16;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  bool bVar17;
  ulong uVar18;
  ulong uVar19;
  ulong uVar20;
  long lVar21;
  ulong uVar22;
  ulong uVar23;
  undefined2 uVar24;
  undefined2 uVar25;
  undefined2 in_stack_0000fe3c;
  uint in_stack_0000fe3e;
  long cshDmgMoved_2;
  long pctNew_3;
  short iSrc;
  long cshDmgSrc;
  long cshDmgDst;
  long l;
  short ishdef;
  long rgCargoCapacity [2];
  SHDEF *lpshdef;
  short j;
  FLEET rgflCur [2];
  long rgFuelCapLoss [2];
  long lChg;
  short i;
  short wtFuelMax;
  short wtCargoMax;
  FLEET *rgpflNew [1];
  long rgFuelCapacity [2];
  long rgrgCargoDelta [5] [2];
  short rgrgcshLoss [16] [2];
  long wtCargoTot;
  short fDeadFleet;
  long wtCargoXfer;
  long rgCargoCapLoss [2];
  short iplr;
  
  bVar17 = false;
  rgpflNew[0] = pflNew1;
  iVar12 = pflNew1->iPlayer;
  for (i = 0; i < 2; i = i + 1) {
    if (((uint)rgpflNew[i]->wFlags >> 10 & 1) == 0) {
      FLookupFleet(rgpflNew[i]->id,rgflCur + i);
    }
    else {
      bVar17 = true;
      _memset(rgflCur + i,0,0x7c);
      rgflCur[i].iPlayer = iVar12;
    }
    *(undefined2 *)(rgCargoCapLoss + i) = 0;
    *(undefined2 *)((int)rgCargoCapLoss + i * 4 + 2) = 0;
    *(undefined2 *)(rgCargoCapacity + i) = 0;
    *(undefined2 *)((int)rgCargoCapacity + i * 4 + 2) = 0;
    *(undefined2 *)(rgFuelCapLoss + i) = 0;
    *(undefined2 *)((int)rgFuelCapLoss + i * 4 + 2) = 0;
    *(undefined2 *)(rgFuelCapacity + i) = 0;
    *(undefined2 *)((int)rgFuelCapacity + i * 4 + 2) = 0;
    for (j = 0; j < 5; j = j + 1) {
      puVar13 = (undefined2 *)((int)rgrgCargoDelta + j * 4 + i * 0x14);
      *puVar13 = 0;
      puVar13[1] = 0;
    }
  }
  for (ishdef = 0; ishdef < 0x10; ishdef = ishdef + 1) {
    if ((rgflCur[0].rgcsh[ishdef] != 0) || (*(int *)((int)rgFuelCapLoss + ishdef * 2 + -0x70) != 0))
    {
      iVar14 = iVar12 * 4;
      uVar24 = *(undefined2 *)(iVar14 + 0x100);
      pSVar10 = (SHDEF *)(*(int *)(iVar14 + 0xfe) + ishdef * 0x93);
      sVar7 = WtMaxShdefStat((SHDEF *)CONCAT22(uVar24,pSVar10),1);
      sVar8 = WtMaxShdefStat((SHDEF *)CONCAT22(uVar24,pSVar10),2);
      for (i = 0; i < 2; i = i + 1) {
        rgrgcshLoss[i * 8][ishdef] = rgflCur[i].rgcsh[ishdef] - rgpflNew[i]->rgcsh[ishdef];
        if (rgflCur[i].rgcsh[ishdef] != 0) {
          uVar18 = __aFulmul((long)rgflCur[i].rgcsh[ishdef],(long)sVar7);
          puVar1 = (uint *)(rgFuelCapacity + i);
          uVar9 = *puVar1;
          *puVar1 = *puVar1 + (uint)uVar18;
          piVar2 = (int *)((int)rgFuelCapacity + i * 4 + 2);
          *piVar2 = *piVar2 + (int)(uVar18 >> 0x10) + (uint)CARRY2(uVar9,(uint)uVar18);
          uVar18 = __aFulmul((long)rgflCur[i].rgcsh[ishdef],(long)sVar8);
          puVar1 = (uint *)(rgCargoCapacity + i);
          uVar9 = *puVar1;
          *puVar1 = *puVar1 + (uint)uVar18;
          piVar2 = (int *)((int)rgCargoCapacity + i * 4 + 2);
          *piVar2 = *piVar2 + (int)(uVar18 >> 0x10) + (uint)CARRY2(uVar9,(uint)uVar18);
          if (0 < rgrgcshLoss[i * 8][ishdef]) {
            uVar18 = __aFulmul((long)rgrgcshLoss[i * 8][ishdef],(long)sVar7);
            puVar1 = (uint *)(rgFuelCapLoss + i);
            uVar9 = *puVar1;
            *puVar1 = *puVar1 + (uint)uVar18;
            piVar2 = (int *)((int)rgFuelCapLoss + i * 4 + 2);
            *piVar2 = *piVar2 + (int)(uVar18 >> 0x10) + (uint)CARRY2(uVar9,(uint)uVar18);
            uVar18 = __aFulmul((long)rgrgcshLoss[i * 8][ishdef],(long)sVar8);
            puVar1 = (uint *)(rgCargoCapLoss + i);
            uVar9 = *puVar1;
            *puVar1 = *puVar1 + (uint)uVar18;
            piVar2 = (int *)((int)rgCargoCapLoss + i * 4 + 2);
            *piVar2 = *piVar2 + (int)(uVar18 >> 0x10) + (uint)CARRY2(uVar9,(uint)uVar18);
          }
        }
      }
      if (((!bVar17) && (rgrgcshLoss[0][ishdef] == -rgrgcshLoss[8][ishdef])) &&
         (rgrgcshLoss[0][ishdef] != 0)) {
        uVar9 = (uint)(rgrgcshLoss[0][ishdef] < 0);
        if (rgflCur[uVar9].rgcsh[ishdef] < 1) {
          uVar18 = 0;
        }
        else {
          uVar25 = 0;
          uVar24 = 100;
          uVar18 = __aFulmul((ulong)(uint)(rgflCur[uVar9].rgdv + ishdef)->dp & 0xffff007f,
                                     (long)rgflCur[uVar9].rgcsh[ishdef]);
          uVar18 = __aFldiv(uVar18,CONCAT22(uVar25,uVar24));
        }
        if (rgflCur[uVar9 == 0].rgcsh[ishdef] < 1) {
          uVar22 = 0;
        }
        else {
          uVar25 = 0;
          uVar24 = 100;
          uVar22 = __aFulmul((ulong)(uint)(rgflCur[uVar9 == 0].rgdv + ishdef)->dp &
                                     0xffff007f,(long)rgflCur[uVar9 == 0].rgcsh[ishdef]);
          uVar22 = __aFldiv(uVar22,CONCAT22(uVar25,uVar24));
        }
        if ((uVar18 == 0) || (uVar22 == 0)) {
          if (uVar18 == 0) {
            if (uVar22 == 0) {
              (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp =
                   (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp & 0xff80;
            }
            else {
              iVar14 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
              iVar11 = iVar14 >> 0xf;
              iVar3 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
              uVar18 = __aFulmul(uVar22,100);
              lVar21 = __aFldiv(uVar18 + (long)iVar3 + -1,CONCAT22(iVar11,iVar14));
              (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp =
                   (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp & 0xff80U | (uint)lVar21 & 0x7f;
            }
          }
          else {
            uVar22 = uVar18;
            if ((long)rgrgcshLoss[uVar9 * 8][ishdef] < (long)uVar18) {
              uVar22 = (long)rgrgcshLoss[uVar9 * 8][ishdef];
            }
            (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp =
                 (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp & 0x7fU |
                 (rgpflNew[uVar9]->rgdv + ishdef)->dp & 0xff80U;
            iVar14 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
            iVar11 = iVar14 >> 0xf;
            iVar3 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
            uVar23 = __aFulmul(uVar22,100);
            lVar21 = __aFldiv(uVar23 + (long)iVar3 + -1,CONCAT22(iVar11,iVar14));
            in_stack_0000fe3e =
                 (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp & 0xff80U | (uint)lVar21 & 0x7f;
            (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp = in_stack_0000fe3e;
            if (uVar22 == uVar18) {
              (rgpflNew[uVar9]->rgdv + ishdef)->dp = 0;
            }
            else {
              iVar14 = rgpflNew[uVar9]->rgcsh[ishdef];
              iVar11 = iVar14 >> 0xf;
              iVar3 = rgpflNew[uVar9]->rgcsh[ishdef];
              uVar18 = __aFulmul(uVar18 - uVar22,100);
              lVar21 = __aFldiv(uVar18 + (long)iVar3 + -1,CONCAT22(iVar11,iVar14));
              (rgpflNew[uVar9]->rgdv + ishdef)->dp =
                   (rgpflNew[uVar9]->rgdv + ishdef)->dp & 0xff80U | (uint)lVar21 & 0x7f;
            }
          }
        }
        else {
          uVar23 = uVar18;
          if ((long)rgrgcshLoss[uVar9 * 8][ishdef] < (long)uVar18) {
            uVar23 = (long)rgrgcshLoss[uVar9 * 8][ishdef];
          }
          iVar14 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
          iVar11 = iVar14 >> 0xf;
          iVar3 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
          uVar19 = __aFulmul(uVar23,(ulong)((uint)(rgflCur[uVar9].rgdv + ishdef)->dp >> 7));
          uVar20 = __aFulmul(uVar22,(ulong)((uint)(rgflCur[uVar9 == 0].rgdv + ishdef)->dp >>
                                                   7));
          lVar21 = __aFldiv(uVar20 + uVar19 + (long)iVar3 + -1,CONCAT22(iVar11,iVar14));
          in_stack_0000fe3c = (undefined2)uVar19;
          (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp =
               (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp & 0x7fU | (int)lVar21 << 7;
          iVar14 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
          iVar11 = iVar14 >> 0xf;
          iVar3 = rgpflNew[uVar9 == 0]->rgcsh[ishdef];
          uVar22 = __aFulmul(uVar22 + uVar23,100);
          lVar21 = __aFldiv(uVar22 + (long)iVar3 + -1,CONCAT22(iVar11,iVar14));
          in_stack_0000fe3e =
               (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp & 0xff80U | (uint)lVar21 & 0x7f;
          (rgpflNew[uVar9 == 0]->rgdv + ishdef)->dp = in_stack_0000fe3e;
          if (uVar23 == uVar18) {
            (rgpflNew[uVar9]->rgdv + ishdef)->dp = 0;
          }
          else {
            iVar14 = rgpflNew[uVar9]->rgcsh[ishdef];
            iVar11 = iVar14 >> 0xf;
            iVar3 = rgpflNew[uVar9]->rgcsh[ishdef];
            uVar18 = __aFulmul(uVar18 - uVar23,100);
            lVar21 = __aFldiv(uVar18 + (long)iVar3 + -1,CONCAT22(iVar11,iVar14));
            (rgpflNew[uVar9]->rgdv + ishdef)->dp =
                 (rgpflNew[uVar9]->rgdv + ishdef)->dp & 0xff80U | (uint)lVar21 & 0x7f;
          }
        }
      }
    }
  }
  i = 0;
  do {
    if (1 < i) {
      for (i = 0; i < 2; i = i + 1) {
        for (j = 0; j < 5; j = j + 1) {
          puVar15 = (uint *)((int)rgrgCargoDelta + j * 4 + i * 0x14);
          uVar4 = *puVar15;
          uVar5 = puVar15[1];
          pFVar6 = rgpflNew[i];
          puVar1 = (uint *)(pFVar6->rgwtMin + j);
          uVar9 = *puVar1;
          *puVar1 = *puVar1 + uVar4;
          puVar1 = (uint *)((int)(pFVar6->rgwtMin + j) + 2);
          *puVar1 = *puVar1 + uVar5 + (uint)CARRY2(uVar9,uVar4);
          puVar15 = (uint *)((int)rgrgCargoDelta + j * 4 + i * 0x14);
          uVar4 = *puVar15;
          uVar5 = puVar15[1];
          pFVar6 = rgpflNew[i == 0];
          puVar1 = (uint *)(pFVar6->rgwtMin + j);
          uVar9 = *puVar1;
          *puVar1 = *puVar1 - uVar4;
          puVar1 = (uint *)((int)(pFVar6->rgwtMin + j) + 2);
          *puVar1 = (*puVar1 - uVar5) - (uint)(uVar9 < uVar4);
        }
      }
      return;
    }
    if (((int)rgFuelCapacity[i] != 0) || (*(int *)((int)rgFuelCapacity + i * 4 + 2) != 0)) {
      iVar12 = *(int *)(undefined1 *)((int)rgpflNew[i]->rgwtMin + 0x12);
      if ((iVar12 < 1) && ((iVar12 < 0 || (*(uint *)(rgpflNew[i]->rgwtMin + 4) < 0xafc9)))) {
        iVar12 = *(int *)((int)rgFuelCapLoss + i * 4 + 2);
        if ((-1 < iVar12) && ((0 < iVar12 || (45000 < *(uint *)(rgFuelCapLoss + i)))))
        goto LAB_1050_bd78;
        uVar24 = *(undefined2 *)((int)rgFuelCapacity + i * 4 + 2);
        uVar25 = (undefined2)rgFuelCapacity[i];
        uVar18 = __aFulmul(CONCAT22(*(undefined2 *)
                                             (undefined1 *)((int)rgpflNew[i]->rgwtMin + 0x12),
                                            (int)rgpflNew[i]->rgwtMin[4]),
                                   CONCAT22(*(undefined2 *)((int)rgFuelCapLoss + i * 4 + 2),
                                            (int)rgFuelCapLoss[i]));
        lVar21 = __aFldiv(uVar18,CONCAT22(uVar24,uVar25));
      }
      else {
LAB_1050_bd78:
        lVar21 = __ftol((double)CONCAT26(in_stack_0000fe3e,
                                                 CONCAT24(in_stack_0000fe3c,
                                                          CONCAT22(unaff_SI,unaff_DI))));
      }
      lChg._2_2_ = (int)((ulong)lVar21 >> 0x10);
      lChg._0_2_ = (uint)lVar21;
      puVar1 = (uint *)((int)rgrgCargoDelta + i * 0x14 + 0x10);
      uVar9 = *puVar1;
      *puVar1 = *puVar1 - (uint)lChg;
      piVar2 = (int *)((int)rgrgCargoDelta + i * 0x14 + 0x12);
      *piVar2 = (*piVar2 - lChg._2_2_) - (uint)(uVar9 < (uint)lChg);
    }
    if (((int)rgCargoCapacity[i] != 0) || (*(int *)((int)rgCargoCapacity + i * 4 + 2) != 0)) {
      wtCargoTot._0_2_ = 0;
      wtCargoTot._2_2_ = 0;
      for (j = 0; j < 4; j = j + 1) {
        uVar9 = *(uint *)(rgpflNew[i]->rgwtMin + j);
        bVar17 = CARRY2((uint)wtCargoTot,uVar9);
        wtCargoTot._0_2_ = (uint)wtCargoTot + uVar9;
        wtCargoTot._2_2_ =
             wtCargoTot._2_2_ + *(uint *)((int)(rgpflNew[i]->rgwtMin + j) + 2) + (uint)bVar17;
      }
      if ((wtCargoTot._2_2_ < 1) && ((wtCargoTot._2_2_ < 0 || ((uint)wtCargoTot < 0xafc9)))) {
        iVar12 = *(int *)((int)rgCargoCapLoss + i * 4 + 2);
        if ((-1 < iVar12) && ((0 < iVar12 || (45000 < *(uint *)(rgCargoCapLoss + i)))))
        goto code_r0x1050bed2;
        uVar24 = *(undefined2 *)((int)rgCargoCapacity + i * 4 + 2);
        uVar25 = (undefined2)rgCargoCapacity[i];
        uVar18 = __aFulmul(CONCAT22(wtCargoTot._2_2_,(uint)wtCargoTot),
                                   CONCAT22(*(undefined2 *)((int)rgCargoCapLoss + i * 4 + 2),
                                            (int)rgCargoCapLoss[i]));
        uVar18 = __aFldiv(uVar18,CONCAT22(uVar24,uVar25));
      }
      else {
code_r0x1050bed2:
        uVar18 = __ftol((double)CONCAT26(in_stack_0000fe3e,
                                                 CONCAT24(in_stack_0000fe3c,
                                                          CONCAT22(unaff_SI,unaff_DI))));
      }
      if ((uVar18 != 0) && (((uint)wtCargoTot != 0 || (wtCargoTot._2_2_ != 0)))) {
        uVar22 = uVar18;
        for (j = 0; j < 4; j = j + 1) {
          uVar9 = *(uint *)((int)(rgpflNew[i]->rgwtMin + j) + 2);
          if (((int)uVar9 < 1) &&
             ((((int)uVar9 < 0 || (*(uint *)(rgpflNew[i]->rgwtMin + j) < 0xafc9)) &&
              ((long)uVar18 < 0xafc9)))) {
            uVar9 = (uint)wtCargoTot;
            iVar12 = wtCargoTot._2_2_;
            uVar23 = __aFulmul(CONCAT22(*(undefined2 *)((int)(rgpflNew[i]->rgwtMin + j) + 2)
                                                ,(int)rgpflNew[i]->rgwtMin[j]),uVar18);
            uVar23 = __aFldiv(uVar23,CONCAT22(iVar12,uVar9));
          }
          else {
            uVar23 = __ftol((double)CONCAT26(in_stack_0000fe3e,
                                                     CONCAT24(in_stack_0000fe3c,
                                                              CONCAT22(unaff_SI,unaff_DI))));
          }
          uVar19 = uVar22;
          if ((long)uVar23 < (long)uVar22) {
            uVar19 = uVar23;
          }
          puVar15 = (uint *)((int)rgrgCargoDelta + j * 4 + i * 0x14);
          puVar1 = puVar15;
          uVar9 = *puVar1;
          *puVar1 = *puVar1 - (uint)uVar19;
          puVar1 = puVar15 + 1;
          *puVar1 = (*puVar1 - (int)(uVar19 >> 0x10)) - (uint)(uVar9 < (uint)uVar19);
          uVar22 = uVar22 - uVar19;
        }
        if (0 < (long)uVar22) {
          j = 0;
          while( true ) {
            lChg._2_2_ = (int)(uVar22 >> 0x10);
            lChg._0_2_ = (uint)uVar22;
            if ((3 < j) || ((long)uVar22 < 1)) break;
            uVar9 = *(uint *)(rgpflNew[i]->rgwtMin + j);
            puVar15 = (uint *)((int)rgrgCargoDelta + j * 4 + i * 0x14);
            puVar1 = puVar15;
            iVar12 = *(uint *)((int)(rgpflNew[i]->rgwtMin + j) + 2) + puVar15[1] +
                     (uint)CARRY2(uVar9,*puVar1);
            if ((-1 < iVar12) && ((0 < iVar12 || (uVar9 + *puVar1 != 0)))) {
              piVar16 = (int *)((int)rgrgCargoDelta + j * 4 + i * 0x14);
              piVar2 = piVar16;
              iVar12 = *piVar2;
              *piVar2 = *piVar2 + -1;
              piVar2 = piVar16 + 1;
              *piVar2 = *piVar2 - (uint)(iVar12 == 0);
              uVar22 = CONCAT22(lChg._2_2_ - (uint)((uint)lChg == 0),(uint)lChg + -1);
            }
            j = j + 1;
          }
        }
      }
    }
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: DestroyAllIshdefSB
// Address: 1050:c280
// Segment: MEMORY_SHIP
// ======================================================================


void DestroyAllIshdefSB(short ishdefSB,short iplr)

{
  PLANET *pPVar1;
  undefined2 uVar2;
  PLANET *lpplMac;
  PLANET *lppl;
  
  pPVar1 = (PLANET *)lpPlanets + cPlanet;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < pPVar1) {
    uVar2 = (undefined2)((ulong)lppl >> 0x10);
    if (((((PLANET *)lppl)->iPlayer == iplr) && (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0)) &&
       ((*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) == ishdefSB)) {
      ((PLANET *)lppl)->wFlags = ((PLANET *)lppl)->wFlags & 0xfdff;
      KillQueuedShips(lppl);
      KillQueuedMassPackets(lppl);
    }
    lppl = (PLANET *)CONCAT22(uVar2,(PLANET *)lppl + 1);
  }
  return;
}



// ======================================================================
// Function: DestroyAllIshdef
// Address: 1050:c336
// Segment: MEMORY_SHIP
// ======================================================================


void DestroyAllIshdef(short ishdef,short iplr)

{
  FLEET *pFVar1;
  FLEET *pFVar2;
  int iVar3;
  FLEET *pFVar4;
  FLEET *pFVar5;
  FLEET *pFVar6;
  undefined2 uVar7;
  undefined2 unaff_SS;
  FLEET flNew;
  short cDel;
  short j;
  short grbit;
  short i;
  FLEET *lpfl;
  short cKill;
  FLEET flDead;
  
  if (ishdef < 0x10) {
                    /* WARNING: Load size is inaccurate */
    lpfl = (FLEET *)CONCAT22(*(undefined2 *)((int)(FLEET **)rglpfl + 2),*rglpfl);
    i = 0;
    while (i < cFleet) {
      uVar7 = (undefined2)((ulong)lpfl >> 0x10);
      pFVar4 = (FLEET *)lpfl;
      if ((pFVar4->iPlayer == iplr) && (0 < pFVar4->rgcsh[ishdef])) {
        _memset(&flDead,0,0x7c);
        for (j = 0; (j < 0x10 && ((j == ishdef || (pFVar4->rgcsh[j] == 0)))); j = j + 1) {
        }
        if (j != 0x10) {
          flDead.id = flDead.id & 0xe1ffU | (iplr & 0xfU) << 9;
          flDead.wFlags = flDead.wFlags & 0xfbffU | 0x400;
          flDead.rgcsh[ishdef] = pFVar4->rgcsh[ishdef];
          pFVar6 = &flNew;
          pFVar5 = pFVar4;
          for (iVar3 = 0x3e; iVar3 != 0; iVar3 = iVar3 + -1) {
            pFVar2 = pFVar6;
            pFVar6 = (FLEET *)&pFVar6->iPlayer;
            pFVar1 = pFVar5;
            pFVar5 = (FLEET *)&pFVar5->iPlayer;
            pFVar2->id = pFVar1->id;
          }
          flNew.rgcsh[ishdef] = 0;
          FleetTransferCargoBalance(&flNew,&flDead);
          pFVar6 = &flNew;
          for (iVar3 = 0x3e; iVar3 != 0; iVar3 = iVar3 + -1) {
            pFVar2 = pFVar4;
            pFVar4 = (FLEET *)&pFVar4->iPlayer;
            pFVar1 = pFVar6;
            pFVar6 = (FLEET *)&pFVar6->iPlayer;
            pFVar2->id = pFVar1->id;
          }
          if ((sel.grobj == grobjFleet) && (sel.fl.id == flNew.id)) {
            FLookupFleet(flNew.id,(FLEET *)&sel.fl);
            RedrawScanSel(0,0);
            FillShipDD(sel.fl.id);
            FLookupFleet(sel.fl.id,(FLEET *)&sel.fl);
            FillFleetCompLB();
            DrawPlanShip(0,-0x7c4b);
            InvalidateRect(hwndMine,(undefined2 *)0x0,1);
          }
          goto SHIP_IncrementI;
        }
        pFVar4->rgcsh[ishdef] = 0;
        FDeleteFleet(lpfl->id,0,-1);
      }
      else {
SHIP_IncrementI:
        i = i + 1;
      }
                    /* WARNING: Load size is inaccurate */
      lpfl = (FLEET *)CONCAT22(*(undefined2 *)((int)((FLEET **)rglpfl + i) + 2),
                               ((FLEET **)rglpfl)[i]);
    }
    InvalidateReport(1,1);
  }
  else {
    DestroyAllIshdefSB(ishdef + -0x10,iplr);
    InvalidateReport(0,1);
  }
  RemoveIshdefFromAllQueues(ishdef,0);
  return;
}



// ======================================================================
// Function: RemoveIshdefFromAllQueues
// Address: 1050:c5e6
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050c716) */

void RemoveIshdefFromAllQueues(short ishdef,short fSpaceDocks)

{
  undefined2 uVar1;
  undefined2 uVar2;
  PLANET *pPVar3;
  undefined2 *puVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar5;
  undefined2 uVar6;
  ulong uVar7;
  ulong uVar8;
  PLANET *pPVar9;
  PROD *lpprod;
  PLANET *lpplMac;
  short iDst;
  PLANET *lppl;
  short iprod;
  
  uVar8 = CONCAT22(unaff_SI,unaff_DI);
  pPVar3 = (PLANET *)lpPlanets + cPlanet;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  pPVar9 = (PLANET *)lpPlanets;
  while ((PLANET *)lppl < pPVar3) {
    uVar5 = (undefined2)((ulong)lppl >> 0x10);
    if (((((*(int *)&((PLANET *)lppl)->lpplprod != 0) ||
          (*(int *)((int)&((PLANET *)lppl)->lpplprod + 2) != 0)) &&
         (((PLPROD *)((PLANET *)lppl)->lpplprod)->iprodMac != 0)) &&
        ((((PLANET *)lppl)->iPlayer == idPlayer &&
         (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0)))) &&
       ((fSpaceDocks == 0 ||
        (*(int *)(*(int *)(idPlayer * 4 + 0x14c) +
                 (*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) * 0x93) == 0x21)))) {
      iDst = 0;
      iprod = 0;
      lpprod = (PROD *)CONCAT22(*(undefined2 *)((int)&((PLANET *)lppl)->lpplprod + 2),
                                (PROD *)(*(int *)&((PLANET *)lppl)->lpplprod + 4));
      for (; iprod < (int)(uint)((PLPROD *)((PLANET *)lppl)->lpplprod)->iprodMac; iprod = iprod + 1)
      {
        uVar7 = __aFulshr(uVar8,(ushort)pPVar9);
        uVar6 = (undefined2)((ulong)lpprod >> 0x10);
        if ((((uint)uVar7 & 7) != 2) ||
           (uVar7 = __aFulshr(uVar8,(ushort)pPVar9), ((uint)uVar7 & 0x7f) != ishdef)) {
          if (iDst != iprod) {
            uVar1 = *(undefined2 *)((int)&((PROD *)lpprod)->dwFlags + 2);
            uVar2 = *(undefined2 *)((int)&((PLANET *)lppl)->lpplprod + 2);
            puVar4 = (undefined2 *)(*(int *)&((PLANET *)lppl)->lpplprod + 4 + iDst * 4);
            *puVar4 = (int)lpprod->dwFlags;
            puVar4[1] = uVar1;
          }
          iDst = iDst + 1;
        }
        lpprod = (PROD *)CONCAT22(uVar6,(PROD *)lpprod + 1);
      }
      if (iDst == 0) {
        FreePl((PL *)CONCAT22(*(undefined2 *)((int)&((PLANET *)lppl)->lpplprod + 2),
                                      *(PL **)&((PLANET *)lppl)->lpplprod));
        *(undefined2 *)&((PLANET *)lppl)->lpplprod = 0;
        *(undefined2 *)((int)&((PLANET *)lppl)->lpplprod + 2) = 0;
      }
      else if (iDst != iprod) {
        ((PLPROD *)((PLANET *)lppl)->lpplprod)->iprodMac = (byte)iDst;
      }
    }
    lppl = (PLANET *)CONCAT22(uVar5,(PLANET *)lppl + 1);
  }
  if ((sel.grobj == grobjPlanet) &&
     (((PLPROD *)sel.pl.lpplprod != (PLPROD *)0x0 ||
      (sel.pl.lpplprod._2_2_ != 0)))) {
    FLookupPlanet(sel.pl.id,(PLANET *)&sel.pl);
    FillPlanetProdLB
              (hwndPlanetProdLB,
               (PLPROD *)
               CONCAT22(sel.pl.lpplprod._2_2_,(PLPROD *)sel.pl.lpplprod),
               (PLANET *)0x0);
  }
  return;
}



// ======================================================================
// Function: CshQueued
// Address: 1050:c82c
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050c963) */
/* WARNING: Removing unreachable block (ram,0x1050c98f) */

short CshQueued(short ishdef,short *pfProgress,short fSpaceDocks)

{
  PLANET *pPVar1;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar2;
  ulong uVar3;
  ulong uVar4;
  PLANET *pPVar5;
  PROD *lpprod;
  PLANET *lpplMac;
  short csh;
  PLANET *lppl;
  short iprod;
  
  uVar4 = CONCAT22(unaff_SI,unaff_DI);
  csh = 0;
  *pfProgress = 0;
  pPVar1 = (PLANET *)lpPlanets + cPlanet;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  pPVar5 = (PLANET *)lpPlanets;
  while ((PLANET *)lppl < pPVar1) {
    uVar2 = (undefined2)((ulong)lppl >> 0x10);
    if (((((*(int *)&((PLANET *)lppl)->lpplprod != 0) ||
          (*(int *)((int)&((PLANET *)lppl)->lpplprod + 2) != 0)) &&
         (((PLPROD *)((PLANET *)lppl)->lpplprod)->iprodMac != 0)) &&
        ((((PLANET *)lppl)->iPlayer == idPlayer &&
         (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0)))) &&
       ((fSpaceDocks == 0 ||
        (*(int *)(*(int *)(idPlayer * 4 + 0x14c) +
                 (*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) * 0x93) == 0x21)))) {
      iprod = 0;
      lpprod = (PROD *)CONCAT22(*(undefined2 *)((int)&((PLANET *)lppl)->lpplprod + 2),
                                (PROD *)(*(int *)&((PLANET *)lppl)->lpplprod + 4));
      for (; iprod < (int)(uint)((PLPROD *)((PLANET *)lppl)->lpplprod)->iprodMac; iprod = iprod + 1)
      {
        uVar3 = __aFulshr(uVar4,(ushort)pPVar5);
        if ((((uint)uVar3 & 7) == 2) &&
           (uVar3 = __aFulshr(uVar4,(ushort)pPVar5), ((uint)uVar3 & 0x7f) == ishdef)) {
          csh = csh + ((uint)lpprod->dwFlags & 0x3ff);
          uVar3 = __aFulshr(uVar4,(ushort)pPVar5);
          if ((uVar3 & 0x7f) != 0) {
            *pfProgress = 1;
          }
        }
        lpprod = (PROD *)CONCAT22(lpprod._2_2_,(PROD *)lpprod + 1);
      }
    }
    lppl = (PLANET *)CONCAT22(uVar2,(PLANET *)lppl + 1);
  }
  return csh;
}



// ======================================================================
// Function: Merge2Fleets
// Address: 1050:c9f6
// Segment: MEMORY_SHIP
// ======================================================================


void Merge2Fleets(FLEET *lpflDst,FLEET *lpflDel,short fNoDelete)

{
  FLEET *pFVar1;
  FLEET *pFVar2;
  int iVar3;
  FLEET *pFVar4;
  FLEET *pFVar5;
  undefined2 unaff_SS;
  short i;
  FLEET rgfl [2];
  
  pFVar5 = rgfl;
  for (iVar3 = 0x3e; iVar3 != 0; iVar3 = iVar3 + -1) {
    pFVar2 = pFVar5;
    pFVar5 = (FLEET *)&pFVar5->iPlayer;
    pFVar1 = (FLEET *)lpflDst;
    lpflDst._0_2_ = (FLEET *)&((FLEET *)lpflDst)->iPlayer;
    pFVar2->id = pFVar1->id;
  }
  pFVar5 = rgfl + 1;
  pFVar4 = (FLEET *)lpflDel;
  for (iVar3 = 0x3e; iVar3 != 0; iVar3 = iVar3 + -1) {
    pFVar2 = pFVar5;
    pFVar5 = (FLEET *)&pFVar5->iPlayer;
    pFVar1 = pFVar4;
    pFVar4 = (FLEET *)&pFVar4->iPlayer;
    pFVar2->id = pFVar1->id;
  }
  for (i = 0; i < 0x10; i = i + 1) {
    rgfl[0].rgcsh[i] = rgfl[0].rgcsh[i] + rgfl[1].rgcsh[i];
    rgfl[1].rgcsh[i] = 0;
  }
  FleetTransferCargoBalance(rgfl,rgfl + 1);
  for (i = 0; i < 2; i = i + 1) {
    FLookupFleet(-1,rgfl + i);
  }
  if (fNoDelete == 0) {
    FDeleteFleet(rgfl[1].id,2,rgfl[0].id);
    InvalidateReport(1,2);
  }
  else {
    ((FLEET *)lpflDel)->wFlags = ((FLEET *)lpflDel)->wFlags & 0xfbffU | 0x400;
  }
  return;
}



// ======================================================================
// Function: FleetOrdersChangeTarget
// Address: 1050:cafe
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050cbe3) */

void FleetOrdersChangeTarget(FLEET *lpflOld)

{
  int iVar1;
  int iVar2;
  short sVar3;
  short sVar4;
  FLEET *pFVar5;
  undefined2 uVar6;
  POINT pt_00;
  short grobj;
  SCAN scan;
  short iflMac;
  short iord;
  FLEET *lpfl;
  short fChg;
  POINT pt;
  short id;
  
  iflMac = 0;
  while( true ) {
    if (cFleet <= iflMac) {
      return;
    }
    iVar1 = *(int *)((FLEET **)rglpfl + iflMac);
    iVar2 = *(int *)((int)((FLEET **)rglpfl + iflMac) + 2);
    if ((iVar1 == 0) && (iVar2 == 0)) break;
    if ((*(int *)(iVar1 + 100) != 0) || (*(int *)(iVar1 + 0x66) != 0)) {
      iord = *(int *)(iVar1 + 0x62);
      while (iord = iord + -1, -1 < iord) {
        if (((*(uint *)(*(int *)(iVar1 + 100) + iord * 0x12 + 10) >> 8 & 0xf) == 2) &&
           (*(int *)(*(int *)(iVar1 + 100) + iord * 0x12 + 8) == lpflOld->id)) {
          uVar6 = (undefined2)((ulong)lpflOld >> 0x10);
          pFVar5 = (FLEET *)lpflOld;
          sVar4 = (&pFVar5->pt)->x;
          sVar3 = (pFVar5->pt).y;
          (&pFVar5->pt)->x = (&pFVar5->pt)->x + 1;
          pt_00.y = sVar3;
          pt_00.x = sVar4;
          sVar4 = FFindNearestObject(pt_00,0x83,&scan);
          if (sVar4 == 0) {
            grobj = 4;
            id = iord;
          }
          else if ((scan.grobjFull & grobjFleet) == grobjNone) {
            grobj = 1;
            id = scan.idpl;
          }
          else {
            grobj = 2;
            id = ((FLEET **)rglpfl)[scan.ifl]->id;
          }
          (&pFVar5->pt)->x = (&pFVar5->pt)->x + -1;
          *(short *)(*(int *)(iVar1 + 100) + iord * 0x12 + 8) = id;
          *(uint *)(*(int *)(iVar1 + 100) + iord * 0x12 + 10) =
               *(uint *)(*(int *)(iVar1 + 100) + iord * 0x12 + 10) & 0xf0ff | grobj << 8;
        }
      }
    }
    iflMac = iflMac + 1;
  }
  return;
}



// ======================================================================
// Function: GetTruePartCost
// Address: 1050:cd00
// Segment: MEMORY_SHIP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1050cdcf) */
/* WARNING: Removing unreachable block (ram,0x1050cff3) */

void GetTruePartCost(short iPlayer,PART *ppart,ushort *rgCost)

{
  int iVar1;
  undefined2 uVar2;
  int iVar3;
  short sVar4;
  COMPART *lpcom;
  short i;
  short cCur;
  short cExcess;
  
  iVar1 = *(int *)&ppart->pcom;
  uVar2 = *(undefined2 *)((int)&ppart->pcom + 2);
  for (i = 0; i < 3; i = i + 1) {
    rgCost[i] = *(ushort *)(iVar1 + 0x2c + i * 2);
  }
  rgCost[3] = *(ushort *)(iVar1 + 0x2a);
  if (iPlayer != -1) {
    if (((((ppart->hs).grhst & hstTerra) ==
          ~(hstPlanetary|hstHull|hstTerra|hstSpecialM|hstSpecialE|hstSBHull|hstSpecialSB|hstMines|
            hstMining|hstBomb|hstTorp|hstBeam|hstArmor|hstShield|hstScanner|hstEngine)) &&
        (((((ppart->hs).grhst & hstPlanetary) ==
           ~(hstPlanetary|hstHull|hstTerra|hstSpecialM|hstSpecialE|hstSBHull|hstSpecialSB|hstMines|
             hstMining|hstBomb|hstTorp|hstBeam|hstArmor|hstShield|hstScanner|hstEngine) ||
          (((ppart->hs).wFlags & 0xffU) < 9)) || (0xd < ((ppart->hs).wFlags & 0xffU))))) &&
       ((((ppart->hs).grhst & hstPlanetary) ==
         ~(hstPlanetary|hstHull|hstTerra|hstSpecialM|hstSpecialE|hstSBHull|hstSpecialSB|hstMines|
           hstMining|hstBomb|hstTorp|hstBeam|hstArmor|hstShield|hstScanner|hstEngine) ||
        (8 < ((ppart->hs).wFlags & 0xffU))))) {
      cExcess = 100;
      for (i = 0; i < 6; i = i + 1) {
        iVar3 = (int)*(char *)(iPlayer * 0xc0 + 0x59bc + i) - (int)*(char *)(iVar1 + 2 + i);
        sVar4 = cExcess;
        if (('\0' < *(char *)(iVar1 + 2 + i)) && (sVar4 = iVar3, cExcess <= iVar3)) {
          sVar4 = cExcess;
        }
        cExcess = sVar4;
      }
      if (cExcess == 100) {
        for (i = 0; i < 6; i = i + 1) {
          if (*(char *)(iPlayer * 0xc0 + 0x59bc + i) < cExcess) {
            cExcess = (short)*(char *)(iPlayer * 0xc0 + 0x59bc + i);
          }
        }
      }
      if (0 < cExcess) {
        if (0x13 < cExcess) {
          cExcess = 0x13;
        }
        sVar4 = GetRaceGrbit((PLAYER *)rgplr + iPlayer,ibitRaceBleedingEdgeTech);
        if (sVar4 == 0) {
          cExcess = cExcess << 2;
          if (0x4b < cExcess) {
            cExcess = 0x4b;
          }
        }
        else {
          cExcess = cExcess * 5;
          if (0x50 < cExcess) {
            cExcess = 0x50;
          }
        }
        for (i = 0; i < 4; i = i + 1) {
          if (rgCost[i] != 0) {
            sVar4 = MulDiv(rgCost[i],cExcess,100);
            rgCost[i] = rgCost[i] - sVar4;
            if (rgCost[i] == 0) {
              rgCost[i] = 1;
            }
          }
        }
      }
    }
    if (((((ppart->hs).grhst == hstSpecialSB) &&
         (sVar4 = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv), sVar4 == 7)) &&
        (sVar4 = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv), sVar4 == 7)) &&
       (((ppart->hs).wFlags & 0xffU) < 7)) {
      for (i = 0; i < 4; i = i + 1) {
        rgCost[i] = rgCost[i] - (rgCost[i] >> 2);
      }
    }
    else if (((((ppart->hs).grhst == hstBeam) || ((ppart->hs).grhst == hstTorp)) ||
             ((ppart->hs).grhst == hstBomb)) &&
            (sVar4 = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv), sVar4 == 2))
    {
      for (i = 0; i < 4; i = i + 1) {
        rgCost[i] = rgCost[i] - (rgCost[i] >> 2);
      }
    }
    else if (((((ppart->hs).grhst == hstBeam) || ((ppart->hs).grhst == hstTorp)) ||
             ((ppart->hs).grhst == hstBomb)) &&
            (sVar4 = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv), sVar4 == 4))
    {
      for (i = 0; i < 4; i = i + 1) {
        rgCost[i] = rgCost[i] + (rgCost[i] >> 2);
      }
    }
    else if (((ppart->hs).grhst == hstTerra) &&
            (sVar4 = GetRaceStat((PLAYER *)rgplr + iPlayer,rsMajorAdv), sVar4 == 3))
    {
      rgCost[3] = rgCost[3] / 2;
    }
    else if (((ppart->hs).grhst == hstEngine) &&
            (sVar4 = GetRaceGrbit((PLAYER *)rgplr + iPlayer,ibitRaceCheapEngines),
            sVar4 != 0)) {
      for (i = 0; i < 4; i = i + 1) {
        rgCost[i] = rgCost[i] - (rgCost[i] >> 1);
      }
    }
    if (((cExcess < 1) &&
        (sVar4 = GetRaceGrbit((PLAYER *)rgplr + iPlayer,ibitRaceBleedingEdgeTech),
        sVar4 != 0)) && (((uint)gd._4_2_ >> 3 & 1) == 0)) {
      for (i = 0; (i < 6 && (*(char *)(iVar1 + 2 + i) < '\x01')); i = i + 1) {
      }
      if (i < 6) {
        gd.wFlags = gd.wFlags & 0xbfffU | 0x4000;
        for (i = 0; i < 4; i = i + 1) {
          rgCost[i] = rgCost[i] << 1;
        }
      }
      else {
        gd.wFlags = gd.wFlags & 0xbfff;
      }
    }
    else {
      gd.wFlags = gd.wFlags & 0xbfff;
    }
  }
  return;
}



