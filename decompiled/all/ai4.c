// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: DoCyberAiTurn
// Address: 10a8:002a
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a81610) */
/* WARNING: Removing unreachable block (ram,0x10a81952) */
/* WARNING: Removing unreachable block (ram,0x10a81697) */

void DoCyberAiTurn(PROD *rgprod)

{
  byte *pbVar1;
  undefined2 *puVar2;
  undefined2 *puVar3;
  int iVar4;
  bool bVar5;
  PLORD *pPVar6;
  POINT pt;
  POINT pt1;
  POINT pt2;
  uint uVar7;
  short sVar8;
  int iVar9;
  int iVar10;
  FLEET *pFVar11;
  PLANET *pPVar12;
  undefined2 *puVar13;
  undefined2 *puVar14;
  undefined2 uVar15;
  undefined *puVar16;
  undefined2 unaff_SS;
  ulong uVar17;
  PLANET *pPVar18;
  long lVar19;
  long *rgResAvail_00;
  long *rgResCost_00;
  undefined1 auStack_124 [132];
  short iSBDef;
  byte bStack_9e;
  undefined1 uStack_9d;
  short sStack_9c;
  uint uStack_9a;
  PLANET *lpplEnemy;
  ITEMACTION IStack_90;
  short fWrite;
  short idPlanDst;
  CYBERINFOTEMP *lpciPlanTemp;
  short iAttackStr;
  short dOffsetPlanTemp;
  short iLatestBattle;
  long lNewPop;
  CYBERINFO *lpciPlan;
  PLANET *lpplMac;
  short pctValue;
  short ishdefLatestSB;
  ushort cRecyclePeriod;
  short iLatestDestroyer;
  short iBuilt;
  short *lpiHistSize;
  short ipl;
  short pctValueIdeal;
  short iLatestCargo;
  FLEET *lpflAttack;
  short j;
  short iroCur;
  long cExistCargo;
  short iLatestSBDefender;
  short cFlArmadas;
  short cFlDestroyers;
  FLEET *lpfl;
  short i;
  short ifl;
  short cMineLayers;
  PLANET *lppl;
  byte rgRecycleShdef [16];
  short cFlMineLayers;
  long cExistColony;
  FLEET *lpflEnemy;
  long rgResAvail [4];
  short cSBDefenderFleets;
  long rgResCost [4];
  
  puVar16 = (undefined *)&DAT_1120_10a8;
  dOffsetPlanTemp = game.cPlanMax * 2 + 2;
  cSBDefenderFleets = 0;
  cFlMineLayers = 0;
  cMineLayers = 0;
  cFlArmadas = 0;
  cFlDestroyers = 0;
  lpiHistSize = (short *)CONCAT22(vlpbAiData._2_2_,(byte *)vlpbAiData);
  if (*lpiHistSize == 2) {
    puVar16 = (undefined *)0x1118;
    __fmemset((byte *)CONCAT22(vlpbAiData._2_2_,(byte *)vlpbAiData),0,0x2000);
    *lpiHistSize = game.cPlanMax * 2 + 2;
  }
  fMarkedPlanets = 0;
  iroCur = IroEnsureAi((byte *)(ZEXT24(puVar16) << 0x10),0x2a,&ishdefLatestSB,0x11);
  EnsureCyberAiShdefs(iroCur);
  MergeAllShdefs(1);
  MergeAllShdefs(0x30);
  MergeAllShdefs(-0x4000);
  MergeAllShdefs(0x3c0);
  MergeAllShdefs(0x3c00);
  iAttackStr = 1;
  if (0x32 < (uint)game.turn) {
    iAttackStr = (game.turn - 0x32U) / 10 + 1;
  }
  if (100 < (uint)game.turn) {
    IStack_90.wFlags = (game.turn - 100U) / 10;
    iAttackStr = iAttackStr + IStack_90.wFlags * ((uint)game.turn / 100);
  }
  j = 3;
  if (0x82 < (uint)game.turn) {
    j = (game.turn - 0x78U) / 0x14 + 3;
  }
  if (0x32 < (uint)j) {
    j = 0x32;
  }
  vrgAiCyberArmadaPotency[0] = (byte)j;
  vrgAiCyberArmadaPotency[1] = (byte)((ulong)(j & 0xff) / 2);
  j = 6;
  if (0x73 < (uint)game.turn) {
    j = (game.turn - 100U) / 0x16 + 6;
  }
  if (0xc < (uint)j) {
    j = 0xc;
  }
  vrgAiCyberArmadaPotency[2] = (byte)j;
  if ((int)((uint)j / 2 - 1) < 4) {
    vrgAiCyberArmadaPotency[3] = (char)((uint)j / 2) - 1;
  }
  else {
    vrgAiCyberArmadaPotency[3] = 3;
  }
  _memset(rgRecycleShdef,0,0x10);
  if ((uint)game.turn < 0x78) {
    cRecyclePeriod = 0x32;
  }
  else if ((uint)game.turn < 200) {
    cRecyclePeriod = 0x46;
  }
  else if ((uint)game.turn < 400) {
    cRecyclePeriod = 100;
  }
  else {
    cRecyclePeriod = 300;
  }
  CheckAiShdefStatus(4,5,cRecyclePeriod,&iLatestDestroyer,rgRecycleShdef);
  rgRecycleShdef[iLatestDestroyer] = 0;
  CheckAiShdefStatus(0xe,0xf,cRecyclePeriod,&iLatestSBDefender,rgRecycleShdef);
  rgRecycleShdef[iLatestDestroyer] = 0;
  cExistCargo._0_2_ = CheckAiShdefStatus(2,3,cRecyclePeriod,&iLatestCargo,rgRecycleShdef);
  cExistCargo._2_2_ = (int)(uint)cExistCargo >> 0xf;
  rgRecycleShdef[iLatestCargo] = 0;
  iLatestBattle = -1;
  for (i = 0; iVar9 = rgshdef[1].cExist._2_2_, uVar7 = (uint)rgshdef[1].cExist,
      i < 2; i = i + 1) {
    if (((*(uint *)((int)&rgshdef[0].wFlags + (i * 4 + 6) * 0x93) >> 9 & 1) == 0) &&
       (cRecyclePeriod <
        (uint)(game.turn - *(int *)((int)&rgshdef[0].turn + (i * 4 + 6) * 0x93))))
    {
      IStack_90.wFlags = 1;
      for (j = i * 4 + 9; i * 4 + 6 <= j; j = j + -1) {
        if ((*(uint *)((int)&rgshdef[0].wFlags + j * 0x93) >> 9 & 1) == 0) {
          if (((*(int *)((int)&rgshdef[0].cExist + j * 0x93) == 0) &&
              (*(int *)((int)&rgshdef[0].cExist + 2 + j * 0x93) == 0)) &&
             ((IStack_90.wFlags != 0 || (j != i * 4 + 6)))) {
            puVar13 = (undefined2 *)(j * 0x93 + 0x3f00);
            puVar14 = (undefined2 *)auStack_124;
            for (iVar9 = 0x49; iVar9 != 0; iVar9 = iVar9 + -1) {
              puVar3 = puVar14;
              puVar14 = puVar14 + 1;
              puVar2 = puVar13;
              puVar13 = puVar13 + 1;
              *puVar3 = *puVar2;
            }
            *(undefined1 *)puVar14 = *(undefined1 *)puVar13;
            auStack_124._123_2_ = auStack_124._123_2_ & 0xfdff | 0x200;
            FChangeAiShdef((SHDEF *)auStack_124,j);
          }
          else {
            rgRecycleShdef[j] = 1;
            IStack_90.wFlags = 0;
          }
        }
      }
    }
    if (((*(uint *)((int)&rgshdef[0].wFlags + (i * 4 + 6) * 0x93) >> 9 & 1) == 0) &&
       ((iLatestBattle == -1 ||
        (IStack_90.wFlags = *(uint *)((int)&rgshdef[0].turn + (i * 4 + 6) * 0x93),
        *(uint *)((int)&rgshdef[0].turn + (iLatestBattle * 4 + 6) * 0x93) <
        (uint)IStack_90.wFlags)))) {
      iLatestBattle = i;
    }
  }
  if (0x50 < (uint)game.turn) {
    SplitOutShdefs(rgRecycleShdef);
    _memset(&stack0xff62,0,0x10);
    _bStack_9e = CONCAT11(uStack_9d,2);
    SplitOutShdefs(&stack0xff62);
    _memset(&stack0xff62,0,0x10);
    _bStack_9e = CONCAT11(2,bStack_9e);
    SplitOutShdefs(&stack0xff62);
    _memset(&stack0xff62,0,0x10);
    sStack_9c = 0x202;
    SplitOutShdefs(&stack0xff62);
  }
  lpciPlanTemp = (CYBERINFOTEMP *)
                 CONCAT22(vlpbAiData._2_2_,
                          (CYBERINFOTEMP *)((byte *)vlpbAiData + dOffsetPlanTemp));
  __fmemset((CYBERINFOTEMP *)
                    CONCAT22(vlpbAiData._2_2_,
                             (CYBERINFOTEMP *)((byte *)vlpbAiData + dOffsetPlanTemp)),0,
                    game.cPlanMax << 1);
  lpplEnemy = (PLANET *)CONCAT22((PLANET *)lpPlanets,(PLANET *)lpplEnemy);
  IStack_90.wFlags = lpPlanets._2_2_;
  lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
  lpplMac._2_2_ = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < (PLANET *)lpplMac) {
    lpciPlan = (CYBERINFO *)
               CONCAT22(vlpbAiData._2_2_,
                        (CYBERINFO *)((byte *)vlpbAiData + lppl->id * 2 + 2));
    lpciPlanTemp = (CYBERINFOTEMP *)
                   CONCAT22(vlpbAiData._2_2_,
                            (CYBERINFOTEMP *)
                            ((byte *)vlpbAiData + lppl->id * 2 + dOffsetPlanTemp));
    if (((uint)lpciPlan->wInfo >> 5 & 3) != 0) {
      IStack_90.wFlags = lpciPlan->wInfo - 0x20U & 0x60;
      lpciPlan->wInfo = lpciPlan->wInfo & 0xff9f;
      lpciPlan->wInfo = lpciPlan->wInfo | IStack_90.wFlags;
    }
    uVar15 = (undefined2)((ulong)lppl >> 0x10);
    if ((((PLANET *)lppl)->iPlayer == idPlayer) || (((PLANET *)lppl)->iPlayer == -1)) {
      if ((((PLANET *)lppl)->iPlayer == idPlayer) &&
         (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0)) {
        if (((((*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) == 1) ||
             ((*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) == 3)) ||
            ((*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) == 6)) ||
           ((*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) == 8)) {
          iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 2);
          if ((iVar10 < 1) && ((iVar10 < 0 || (*(uint *)((PLANET *)lppl)->rgwtMin < 10)))) {
            lpciPlanTemp->wInfo1 = lpciPlanTemp->wInfo1 & 0xfeffU | 0x100;
          }
          iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 6);
          if ((iVar10 < 1) && ((iVar10 < 0 || (*(uint *)(((PLANET *)lppl)->rgwtMin + 1) < 10)))) {
            lpciPlanTemp->wInfo1 = lpciPlanTemp->wInfo1 & 0xfdffU | 0x200;
          }
          iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 10);
          if ((iVar10 < 1) && ((iVar10 < 0 || (*(uint *)(((PLANET *)lppl)->rgwtMin + 2) < 10)))) {
            lpciPlanTemp->wInfo1 = lpciPlanTemp->wInfo1 & 0xfbffU | 0x400;
          }
        }
        else {
          iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 2);
          if ((iVar10 < 1) && ((iVar10 < 0 || (*(uint *)((PLANET *)lppl)->rgwtMin < 1000)))) {
            lpciPlanTemp->wInfo1 = lpciPlanTemp->wInfo1 & 0xfeffU | 0x100;
          }
          iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 6);
          if ((iVar10 < 1) && ((iVar10 < 0 || (*(uint *)(((PLANET *)lppl)->rgwtMin + 1) < 1000)))) {
            lpciPlanTemp->wInfo1 = lpciPlanTemp->wInfo1 & 0xfdffU | 0x200;
          }
          iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 10);
          if ((iVar10 < 1) && ((iVar10 < 0 || (*(uint *)(((PLANET *)lppl)->rgwtMin + 2) < 1000)))) {
            lpciPlanTemp->wInfo1 = lpciPlanTemp->wInfo1 & 0xfbffU | 0x400;
          }
        }
      }
    }
    else {
      i = (((PLANET *)lppl)->uGuesses & 0xfffU) / 0xfa + 1;
      if (6 < (uint)i) {
        i = 6;
      }
      if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0) {
        i = i + 1;
      }
      ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 10] = (byte)i;
      ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 9] = 1;
    }
    lppl = (PLANET *)CONCAT22(uVar15,(PLANET *)lppl + 1);
  }
  lpflAttack._0_2_ = (FLEET *)0x0;
  lpflAttack._2_2_ = 0;
  lpflEnemy._0_2_ = (FLEET *)0x0;
  lpflEnemy._2_2_ = 0;
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar11 = ((FLEET **)rglpfl)[ifl];
    iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar10,pFVar11);
    if ((pFVar11 == (FLEET *)0x0) && (iVar10 == 0)) break;
    if (fMarkedPlanets == 0) {
      IdNearestColonizablePlanet((FLEET *)CONCAT22(iVar10,pFVar11),(THING **)0x0);
    }
    uVar15 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar11 = (FLEET *)lpfl;
    if (pFVar11->iPlayer == idPlayer) {
      if ((pFVar11->rgcsh[0xe] < 1) && (pFVar11->rgcsh[0xf] < 1)) {
        if (0 < pFVar11->rgcsh[0]) {
          cFlMineLayers = cFlMineLayers + 1;
          cMineLayers = cMineLayers + pFVar11->rgcsh[0];
        }
        for (i = 4; (i < 0xe && (pFVar11->rgcsh[i] < 1)); i = i + 1) {
        }
        if (i < 0xe) {
          *(FLEET **)&pFVar11->lpflNext = (FLEET *)lpflAttack;
          *(undefined2 *)((int)&pFVar11->lpflNext + 2) = lpflAttack._2_2_;
          lpflAttack._0_2_ = pFVar11;
          lpflAttack._2_2_ = uVar15;
          if ((j < 6) ||
             (((pFVar11->cord < 2 ||
               (((uint)((PLORD *)pFVar11->lpplord + 7)->wFlags >> 8 & 0xf) != 1)) &&
              (pFVar11->idPlanet == -1)))) {
            cFlDestroyers = cFlDestroyers + 1;
          }
          else {
            if ((pFVar11->cord < 2) ||
               (((uint)((PLORD *)pFVar11->lpplord + 7)->wFlags >> 8 & 0xf) != 1)) {
              IStack_90.wFlags = pFVar11->idPlanet;
            }
            else {
              IStack_90.wFlags = *(short *)&((PLORD *)pFVar11->lpplord)[6].iordMax;
            }
            lpplEnemy = (PLANET *)
                        CONCAT22(vlpbAiPlanet._2_2_,
                                 (PLANET *)
                                 ((byte *)vlpbAiPlanet + IStack_90.wFlags * 0x10 + 10));
            if ((char)lpplEnemy->id != '\0') {
              *(byte *)&lpplEnemy->id = (byte)lpplEnemy->id | 0x80;
            }
            cFlArmadas = cFlArmadas + 1;
          }
        }
        else if ((((0 < pFVar11->rgcsh[2]) || (0 < pFVar11->rgcsh[3])) &&
                 ((1 < pFVar11->cord &&
                  (iVar10 = *(int *)((int)pFVar11->rgwtMin + 0xe), -1 < iVar10)))) &&
                (((0 < iVar10 || ((int)pFVar11->rgwtMin[3] != 0)) &&
                 (((uint)((PLORD *)pFVar11->lpplord + 7)->wFlags >> 8 & 0xf) == 1)))) {
          if (((uint)((CYBERINFOTEMP *)lpciPlanTemp +
                     *(int *)&((PLORD *)pFVar11->lpplord)[6].iordMax)->wInfo1 >> 3 & 3) < 3) {
            IStack_90.wFlags =
                 ((CYBERINFOTEMP *)lpciPlanTemp + *(int *)&((PLORD *)pFVar11->lpplord)[6].iordMax)->
                 wInfo1 + 8U & 0x18;
            ((CYBERINFOTEMP *)lpciPlanTemp + *(int *)&((PLORD *)pFVar11->lpplord)[6].iordMax)->
            wInfo1 = ((CYBERINFOTEMP *)lpciPlanTemp +
                     *(int *)&((PLORD *)pFVar11->lpplord)[6].iordMax)->wInfo1 & 0xffe7;
            ((CYBERINFOTEMP *)lpciPlanTemp + *(int *)&((PLORD *)pFVar11->lpplord)[6].iordMax)->
            wInfo1 = ((CYBERINFOTEMP *)lpciPlanTemp +
                     *(int *)&((PLORD *)pFVar11->lpplord)[6].iordMax)->wInfo1 | IStack_90.wFlags;
          }
        }
      }
      else {
        cSBDefenderFleets = cSBDefenderFleets + 1;
      }
    }
    else {
      *(FLEET **)&pFVar11->lpflNext = (FLEET *)lpflEnemy;
      *(undefined2 *)((int)&pFVar11->lpflNext + 2) = lpflEnemy._2_2_;
      lpflEnemy._0_2_ = pFVar11;
      lpflEnemy._2_2_ = uVar15;
    }
  }
  UpdateProgressGauge(-0x39e);
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar11 = ((FLEET **)rglpfl)[ifl];
    iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar10,pFVar11);
    if ((pFVar11 == (FLEET *)0x0) && (iVar10 == 0)) break;
    if (pFVar11->iPlayer == idPlayer) {
      for (i = 0; (i < 0x10 && ((pFVar11->rgcsh[i] < 1 || (rgRecycleShdef[i] != 0)))); i = i + 1) {
      }
      if (i == 0x10) {
        if (pFVar11->idPlanet != -1) {
          lppl = LpplFromId(pFVar11->idPlanet);
          uVar15 = (undefined2)((ulong)lppl >> 0x10);
          if (((lppl != (PLANET *)0x0) && (((PLANET *)lppl)->iPlayer == idPlayer)) &&
             ((((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0 ||
              (sVar8 = Random(5), sVar8 == 0)))) {
            ChangeMainObjSel(2,lpfl->id);
            uVar15 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
            *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                 *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
            FLookupFleet(-1,(FLEET *)&sel.fl);
            goto LAB_10a8_0b45;
          }
        }
        uVar15 = (undefined2)((ulong)lpfl >> 0x10);
        if (((1 < ((FLEET *)lpfl)->cord) && (((FLEET *)lpfl)->idPlanet == -1)) ||
           (sVar8 = FMoveToNearestStarbase(lpfl,0), sVar8 != 0)) goto LAB_10a8_0b45;
      }
      uVar15 = (undefined2)((ulong)lpfl >> 0x10);
      pFVar11 = (FLEET *)lpfl;
      if (((pFVar11->rgcsh[0xe] < 1) && (pFVar11->rgcsh[0xf] < 1)) || (pFVar11->idPlanet == -1)) {
        for (i = 4; (i < 0xe && (pFVar11->rgcsh[i] < 1)); i = i + 1) {
        }
        if (i < 0xe) {
          if ((pFVar11->rgcsh[4] < 1) && (pFVar11->rgcsh[4] < 1)) {
            TargetCyberArmada(lpfl);
            if ((((FLEET *)lpfl)->cord == 1) && (sVar8 = Random(100), sVar8 < 0x4b)) {
              if (i < 10) {
                FFindBuddyAndJoinUp(lpfl,6,9,100,200);
              }
              else {
                FFindBuddyAndJoinUp(lpfl,10,0xd,100,200);
              }
            }
          }
          else {
            if ((iAttackStr <= pFVar11->rgcsh[4] + pFVar11->rgcsh[4]) || (1 < pFVar11->cord)) {
              IdTargetAttack(lpfl,(FLEET *)CONCAT22(lpflAttack._2_2_,(FLEET *)lpflAttack),
                                  (FLEET *)CONCAT22(lpflEnemy._2_2_,(FLEET *)lpflEnemy),
                                  (uint)game.wCrap >> 4 & 1);
            }
            if ((((FLEET *)lpfl)->cord == 1) && (sVar8 = Random(100), sVar8 < 0x4b)) {
              FFindBuddyAndJoinUp(lpfl,4,5,100,200);
            }
          }
        }
        else if (pFVar11->cord < 2) {
          if ((((uint)game.turn < 6) && (0 < pFVar11->rgcsh[0])) && (pFVar11->cord == 1)) {
            ChangeMainObjSel(2,lpfl->id);
            uVar15 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
            *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                 *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
            FLookupFleet(-1,(FLEET *)&sel.fl);
          }
          else if (pFVar11->rgcsh[1] < 1) {
LAB_10a8_111c:
            uVar15 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar11 = (FLEET *)lpfl;
            if ((pFVar11->rgcsh[2] < 1) && (pFVar11->rgcsh[3] < 1)) {
              if (((0 < pFVar11->rgcsh[0]) && (0x28 < (uint)game.turn)) &&
                 (pFVar11->cord == 1)) {
                if (pFVar11->cord < 2) {
                  if (((cFlMineLayers < 0x38) &&
                      ((cFlMineLayers < 0x29 || (sVar8 = Random(3), sVar8 == 0)))) ||
                     (sVar8 = FFindBuddyAndJoinUp(lpfl,0,0,0x48,0x6c), sVar8 == 0)) {
                    if (((((FLEET *)lpfl)->rgcsh[0] < 7) || (sVar8 = Random(5), sVar8 != 0)
                        ) || ((uVar15 = (undefined2)((ulong)lpfl >> 0x10),
                              pt.y = (((FLEET *)lpfl)->pt).y, pt.x = (&((FLEET *)lpfl)->pt)->x,
                              idPlanDst = IdRandomPlanetNearby(pt,0x69,1), idPlanDst == -1 ||
                              (idPlanDst == ((FLEET *)lpfl)->idPlanet)))) {
                      pPVar6 = ((FLEET *)lpfl)->lpplord;
                      if ((*(uint *)&((PLORD *)pPVar6)[2].iordMax & 0xf) != 6) {
                        ChangeMainObjSel(2,lpfl->id);
                        uVar15 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                        *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                             *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 6;
                        ((PLORD *)sel.fl.lpplord + 3)->wFlags = 5;
                        pbVar1 = &((PLORD *)sel.fl.lpplord)[3].iordMax;
                        pbVar1[0] = 5;
                        pbVar1[1] = 0;
                        FLookupFleet(-1,(FLEET *)&sel.fl);
                      }
                    }
                    else {
                      ClearAiCurrentTask(lpfl,1);
                      sStack_9c = idPlanDst;
                      iSBDef = ((POINT *)rgptPlan + idPlanDst)->x;
                      _bStack_9e = *(short *)((int)&rgptPlan[0].y + idPlanDst * 4);
                      uStack_9a = uStack_9a & 0xe000 | 0x1146;
                      FMoveAiFleet(lpfl,(ORDER *)&iSBDef,0);
                    }
                  }
                }
                else if ((*(uint *)&((PLORD *)pFVar11->lpplord)[2].iordMax & 0xf) != 0) {
                  ClearAiCurrentTask(lpfl,1);
                }
              }
            }
            else {
              if (pFVar11->iplan != 4) {
                ChangeMainObjSel(2,lpfl->id);
                sel.fl.iplan = 4;
                FLookupFleet(-1,(FLEET *)&sel.fl);
              }
              DoCyberFreighter(lpfl,lpciPlanTemp);
            }
          }
          else {
            idPlanDst = IdNearestColonizablePlanet(lpfl,(THING **)0x0);
            if (idPlanDst == -1) {
              uVar15 = (undefined2)((ulong)lpfl >> 0x10);
              pFVar11 = (FLEET *)lpfl;
              if ((*(uint *)&((PLORD *)pFVar11->lpplord)[2].iordMax >> 8 & 0xf) == 1) {
                ((CYBERINFOTEMP *)lpciPlanTemp + ((PLORD *)pFVar11->lpplord + 2)->wFlags)->wInfo1 =
                     ((CYBERINFOTEMP *)lpciPlanTemp + ((PLORD *)pFVar11->lpplord + 2)->wFlags)->
                     wInfo1 & 0xfffeU | 1;
              }
            }
            else {
              ChangeMainObjSel(2,lpfl->id);
              uVar15 = (undefined2)((ulong)lpfl >> 0x10);
              if ((((FLEET *)lpfl)->idPlanet != -1) &&
                 (FLookupPlanet(((FLEET *)lpfl)->idPlanet,(PLANET *)&sel.pl),
                 sel.pl.iPlayer == idPlayer)) {
                XferAiSupply(1,((FLEET *)lpfl)->idPlanet,2,lpfl->id,3,0xfa);
                FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
              }
              if (idPlanDst == -1) goto LAB_10a8_111c;
              sVar8 = FColonizeAiFleet(lpfl,idPlanDst);
              if (sVar8 != 0) {
                uVar15 = (undefined2)((ulong)lpfl >> 0x10);
                if (1 < ((FLEET *)lpfl)->cord) {
                  pPVar6 = ((FLEET *)lpfl)->lpplord;
                  ((byte *)vlpbAiPlanet)[*(int *)&((PLORD *)pPVar6)[6].iordMax * 0x10 + 0xf]
                       = 4;
                }
              }
            }
          }
        }
      }
      else {
        IStack_90.wFlags = 0;
        if ((uint)(game.turn - rgshdef[0xe].turn) < cRecyclePeriod - 10) {
          IStack_90.wFlags = pFVar11->rgcsh[0xe];
        }
        if ((uint)(game.turn - rgshdef[0xf].turn) < cRecyclePeriod - 10) {
          IStack_90.wFlags = IStack_90.wFlags + pFVar11->rgcsh[0xf];
        }
        if (0 < IStack_90.wFlags) {
          ((CYBERINFOTEMP *)lpciPlanTemp + pFVar11->idPlanet)->wInfo1 =
               ((CYBERINFOTEMP *)lpciPlanTemp + pFVar11->idPlanet)->wInfo1 & 0xffbfU | 0x40;
          bVar5 = IStack_90.wFlags < iAttackStr * 2;
          lpplEnemy = (PLANET *)(ulong)CONCAT12(bVar5,(PLANET *)lpplEnemy);
          pPVar18 = lpplEnemy;
          lpplEnemy._2_2_ = (uint)bVar5;
          ((CYBERINFOTEMP *)lpciPlanTemp + pFVar11->idPlanet)->wInfo1 =
               ((CYBERINFOTEMP *)lpciPlanTemp + pFVar11->idPlanet)->wInfo1 & 0xffdfU |
               lpplEnemy._2_2_ << 5;
          lpplEnemy = pPVar18;
        }
      }
    }
LAB_10a8_0b45:
  }
  UpdateProgressGauge(-0x39e);
  for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
                    /* WARNING: Load size is inaccurate */
    pPVar12 = ((PLANET **)vrglpplAi)[ipl];
    iVar10 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
    lppl = (PLANET *)CONCAT22(iVar10,pPVar12);
    if ((pPVar12 == (PLANET *)0x0) && (iVar10 == 0)) break;
    lpciPlan = (CYBERINFO *)
               CONCAT22(vlpbAiData._2_2_,
                        (CYBERINFO *)((byte *)vlpbAiData + lppl->id * 2 + 2));
    lpciPlanTemp = (CYBERINFOTEMP *)
                   CONCAT22(vlpbAiData._2_2_,
                            (CYBERINFOTEMP *)
                            ((byte *)vlpbAiData + lppl->id * 2 + dOffsetPlanTemp));
    ChangeMainObjSel(1,lppl->id);
    InitProduction(rgprod);
    fWrite = 0;
    sVar8 = PctTrueMaxGrowth(idPlayer);
    uVar15 = (undefined2)((ulong)lppl >> 0x10);
    uVar17 = __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe),
                                        (int)((PLANET *)lppl)->rgwtMin[3]),(long)sVar8);
    lNewPop = uVar17;
    GetResourcesAvailable(lppl,rgResAvail);
    GetProdQCost(lppl,rgResCost);
    for (i = 0; i < 4; i = i + 1) {
      iVar10 = *(int *)((int)rgResAvail + i * 4 + 2);
      iVar4 = *(int *)((int)rgResCost + i * 4 + 2);
      if ((iVar10 <= iVar4) &&
         ((iVar10 < iVar4 || (*(uint *)(rgResAvail + i) < *(uint *)(rgResCost + i)))))
      goto LAB_10a8_1393;
    }
    pctValue = PctPlanetDesirability(lppl,idPlayer);
    pctValueIdeal = PctPlanetOptValue(lppl,idPlayer);
    if (pctValue < 10) {
      lVar19 = __aFldiv(CONCAT22((rgResAvail[3]._2_2_ - rgResCost[3]._2_2_) -
                                         (uint)((uint)rgResAvail[3] < (uint)rgResCost[3]),
                                         (uint)rgResAvail[3] - (uint)rgResCost[3]),0x46);
      i = (int)lVar19 + 1;
      AddItemToQueue(0xc,i,grobjPlanet,1);
      fWrite = 1;
    }
    else {
      if (pctValue < pctValueIdeal) {
        iVar10 = (rgResAvail[3]._2_2_ - rgResCost[3]._2_2_) -
                 (uint)((uint)rgResAvail[3] < (uint)rgResCost[3]);
        if ((-1 < iVar10) && ((0 < iVar10 || (0x46 < (uint)rgResAvail[3] - (uint)rgResCost[3])))) {
          AddItemToQueue(0xc,1,grobjPlanet,1);
          fWrite = 1;
        }
      }
      uVar15 = (undefined2)((ulong)lppl >> 0x10);
      pPVar12 = (PLANET *)lppl;
      if ((((((uint)pPVar12->wFlags >> 9 & 1) != 0) &&
           ((*(uint *)&pPVar12->field11_0x2c & 0xf) != 1)) &&
          ((*(uint *)&pPVar12->field11_0x2c & 0xf) != 3)) &&
         (((*(uint *)&pPVar12->field11_0x2c & 0xf) != 6 &&
          ((*(uint *)&pPVar12->field11_0x2c & 0xf) != 8)))) {
        if ((((((uint)lpciPlan->wInfo >> 3 & 1) == 0) || (0x157c < lNewPop)) &&
            (((lpciPlanTemp->wInfo1 & 1U) == 0 && (iVar9 < 1)))) && ((iVar9 < 0 || (uVar7 < 0x28))))
        {
          sVar8 = FShouldPlanetBuildColonizer(lppl);
          if (sVar8 == 0) goto LAB_10a8_16c6;
          AddItemToQueue(1,1,grobjFleet,1);
          lpciPlan->wInfo = lpciPlan->wInfo & 0xfff7U | 8;
          fWrite = 1;
          if ((15000 < lNewPop) && ((uint)game.turn < 100)) {
            AddItemToQueue(1,1,grobjFleet,1);
          }
        }
        else {
LAB_10a8_16c6:
          lpciPlan->wInfo = lpciPlan->wInfo & 0xfff7;
        }
        uVar15 = (undefined2)((ulong)lppl >> 0x10);
        iVar10 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 0xe);
        if (((-1 < iVar10) &&
            (((0 < iVar10 || (2000 < *(uint *)(((PLANET *)lppl)->rgwtMin + 3))) &&
             (((uint)rgshdef[2].wFlags >> 9 & 1) == 0)))) &&
           ((cExistCargo._2_2_ < 1 &&
            (((cExistCargo._2_2_ < 0 || ((uint)cExistCargo < 0x32)) &&
             (((uint)lpciPlanTemp->wInfo1 >> 1 & 3) == 0)))))) {
          pPVar18 = LpplFindClosestEnum(lppl,FEnumDropOffStage2);
          if (pPVar18 != (PLANET *)0x0) {
            AddItemToQueue(iLatestCargo,1,grobjFleet,1);
            fWrite = 1;
          }
        }
        if (rgshdef[0].hul.ihuldef == ihuldefFrigate) {
          sVar8 = Random(4);
          pPVar18 = lpplEnemy;
          if ((sVar8 == 0) && (cMineLayers < 10000)) {
            IStack_90.wFlags = lppl->id;
            lpplEnemy = (PLANET *)((ulong)lpplEnemy & 0xffff);
            for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
              pFVar11 = ((FLEET **)rglpfl)[ifl];
              iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
              lpfl = (FLEET *)CONCAT22(iVar10,pFVar11);
              if ((pFVar11 == (FLEET *)0x0) && (iVar10 == 0)) break;
              if ((pFVar11->idPlanet == IStack_90.wFlags) &&
                 ((0 < pFVar11->rgcsh[0] && (pFVar11->iPlayer == idPlayer)))) {
                lpplEnemy._0_2_ = (PLANET *)pPVar18;
                lpplEnemy = (PLANET *)CONCAT22(pFVar11->rgcsh[0],(PLANET *)lpplEnemy);
                break;
              }
            }
            if ((int)lpplEnemy._2_2_ < 10) {
LAB_10a8_185b:
              sVar8 = Random(lpplEnemy._2_2_ * 2 + 1);
              if (sVar8 == 0) {
                AddItemToQueue(0,4,grobjFleet,1);
                fWrite = 1;
              }
            }
            else if ((int)lpplEnemy._2_2_ < 0x11) {
              sVar8 = Random(10);
              if (sVar8 == 0) goto LAB_10a8_185b;
            }
          }
        }
        IStack_90.wFlags = iLatestSBDefender;
        if (((uint)lpciPlanTemp->wInfo1 >> 5 & 1) == 0) {
          IStack_90.wFlags = 0xffff;
        }
        if (((IStack_90.wFlags == 0xffff) && (((uint)lpciPlanTemp->wInfo1 >> 6 & 1) == 0)) &&
           (cSBDefenderFleets < 0x28)) {
          lpplEnemy = LpplFindClosestEnum(lppl,FEnumCalcEnemyPlanets);
          if (((PLANET *)lpplEnemy != (PLANET *)0x0) || ((int)((ulong)lpplEnemy >> 0x10) != 0)) {
            pt1.y = *(short *)((int)&rgptPlan[0].y + lppl->id * 4);
            pt1.x = ((POINT *)rgptPlan + lppl->id)->x;
            pt2.y = *(short *)((int)&rgptPlan[0].y + lpplEnemy->id * 4);
            pt2.x = ((POINT *)rgptPlan + lpplEnemy->id)->x;
            lVar19 = LDistance2(pt1,pt2);
            if (lVar19 < 0x15f91) {
              sVar8 = Random(100);
              IStack_90.wFlags = iLatestSBDefender;
              if (0x31 < sVar8) {
                IStack_90.wFlags = 0xffff;
              }
              goto LAB_10a8_199f;
            }
          }
          sVar8 = Random(100);
          IStack_90.wFlags = iLatestSBDefender;
          if (9 < sVar8) {
            IStack_90.wFlags = 0xffff;
          }
        }
LAB_10a8_199f:
        if (0x78 < cFlDestroyers) {
          iLatestDestroyer = -1;
        }
        if (0xfa < cFlArmadas) {
          iLatestBattle = -1;
        }
        iBuilt = iAddAttackFleet(lppl,iAttackStr,iLatestDestroyer,iLatestBattle,IStack_90.wFlags);
        fWrite = fWrite | (uint)(iBuilt != 0);
        if (iBuilt == 1) {
          cFlArmadas = cFlArmadas + 1;
        }
        if (iBuilt == 2) {
          cSBDefenderFleets = cSBDefenderFleets + 1;
        }
        if (iBuilt == 3) {
          cFlDestroyers = cFlDestroyers + 1;
        }
      }
    }
LAB_10a8_1393:
    FinishProduction(fWrite);
  }
  UpdateProgressGauge(-0x39e);
  rgResCost_00 = rgResCost;
  rgResAvail_00 = rgResAvail;
  sVar8 = IshdefAiSBLatest();
  HandleBasicAiTasks(iroCur,rgprod,sVar8,rgResAvail_00,rgResCost_00);
  UpdateProgressGauge(-0x39e);
  DoCyberPackets();
  UpdateProgressGauge(-0x39e);
  FillProductionQueue();
  return;
}



// ======================================================================
// Function: DoCyberPackets
// Address: 10a8:1a78
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a820d0) */
/* WARNING: Removing unreachable block (ram,0x10a82345) */
/* WARNING: Removing unreachable block (ram,0x10a824b8) */
/* WARNING: Restarted to delay deadcode elimination for space: stack */

void DoCyberPackets(void)

{
  uint *puVar1;
  int *piVar2;
  double dVar3;
  PLANET *pPVar4;
  int iVar5;
  double dVar6;
  undefined2 uVar7;
  undefined1 auVar8 [8];
  double dVar9;
  int iVar10;
  ushort uVar11;
  int iVar12;
  undefined1 extraout_AH;
  short sVar13;
  uint uVar14;
  uint *puVar15;
  CYBERINFO *pCVar16;
  undefined2 unaff_SI;
  uint uVar17;
  undefined2 unaff_DI;
  int iVar18;
  bool bVar19;
  long lVar20;
  long lVar21;
  ulong uVar22;
  int in_stack_0000fe72;
  undefined2 in_stack_0000fe74;
  undefined1 auStack_188 [8];
  short iMin;
  double dDistanceTgt;
  CYBERINFOTEMP *lpciPlanT_2;
  long lMinNeeded;
  CYBERINFO *lpciPlanDst_2;
  short iPacketAdd_2;
  short cPacket [3];
  double dMod;
  double dDistance;
  short iWarpDst_2;
  short iWarpSrc;
  short cResLeft;
  int iStack_14e;
  long lPackets;
  CYBERINFO *lpciPlanDst_3;
  int iStack_144;
  CYBERINFOTEMP *lpciPlanTemp;
  short idPlanDst;
  short dOffsetPlanTemp;
  PROD rgprod [64];
  CYBERINFO *lpciPlan;
  short iWarpDst;
  short ipl;
  short i;
  PLANET *lppl;
  PLANET *lpplDst;
  short iWarp;
  long rgResAvail [4];
  long rgResCost [4];
  short fTwoMA;
  
  iVar10 = game.cPlanMax * 2 + 2;
  ipl = 0;
  do {
    if (vclpplAi <= ipl) {
      return;
    }
                    /* WARNING: Load size is inaccurate */
    pPVar4 = ((PLANET **)vrglpplAi)[ipl];
    iVar5 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
    lppl = (PLANET *)CONCAT22(iVar5,pPVar4);
    if ((pPVar4 == (PLANET *)0x0) && (iVar5 == 0)) {
      return;
    }
    if (((uint)pPVar4->wFlags >> 9 & 1) != 0) {
      lpciPlan = (CYBERINFO *)
                 CONCAT22(vlpbAiData._2_2_,
                          (CYBERINFO *)((byte *)vlpbAiData + lppl->id * 2 + 2));
      ChangeMainObjSel(1,lppl->id);
      InitProduction(rgprod);
      iStack_144 = 0;
      GetResourcesAvailable((PLANET *)CONCAT22(iVar5,pPVar4),rgResAvail);
      GetProdQCost((PLANET *)CONCAT22(iVar5,pPVar4),rgResCost);
      if (((((uint)lpciPlan->wInfo >> 7 & 1) == 0) &&
          (((((*(uint *)&pPVar4->field11_0x2c & 0xf) == 1 ||
             ((*(uint *)&pPVar4->field11_0x2c & 0xf) == 3)) ||
            ((*(uint *)&pPVar4->field11_0x2c & 0xf) == 6)) ||
           ((*(uint *)&pPVar4->field11_0x2c & 0xf) == 8)))) &&
         (((iVar12 = *(int *)((int)pPVar4->rgwtMin + 2), 0 < iVar12 ||
           (((-1 < iVar12 && (700 < *(uint *)pPVar4->rgwtMin)) ||
            ((iVar12 = *(int *)((int)pPVar4->rgwtMin + 6), 0 < iVar12 ||
             ((-1 < iVar12 && (700 < *(uint *)(pPVar4->rgwtMin + 1))))))))) ||
          ((iVar12 = *(int *)((int)pPVar4->rgwtMin + 10), -1 < iVar12 &&
           ((0 < iVar12 || (700 < *(uint *)(pPVar4->rgwtMin + 2))))))))) {
        lVar20 = __aFldiv(CONCAT22(rgResAvail[3]._2_2_,(undefined2)rgResAvail[3]),2);
        iVar12 = (int)lVar20 / 5;
        if (iVar12 < 7) {
          lpplDst = (PLANET *)0x0;
        }
        else {
          lpplDst = LpplFindClosestEnum((PLANET *)CONCAT22(iVar5,pPVar4),FEnumNeedMinerals);
        }
        uVar7 = vlpbAiData._2_2_;
        if (((PLANET *)lpplDst == (PLANET *)0x0) && (lpplDst._2_2_ == 0)) goto LAB_10a8_1fa3;
        puVar15 = (uint *)((byte *)vlpbAiData + lpplDst->id * 2 + iVar10);
        if (((((*(uint *)&((PLANET *)lpplDst)->field11_0x2c & 0xf) == 1) ||
             ((*(uint *)&((PLANET *)lpplDst)->field11_0x2c & 0xf) == 3)) ||
            ((*(uint *)&((PLANET *)lpplDst)->field11_0x2c & 0xf) == 6)) ||
           ((*(uint *)&((PLANET *)lpplDst)->field11_0x2c & 0xf) == 8)) {
          lpciPlanDst_3 = (CYBERINFO *)CONCAT22(iVar12,(CYBERINFO *)0xa);
        }
        else {
          lpciPlanDst_3 = (CYBERINFO *)CONCAT22(iVar12,(CYBERINFO *)0x3e8);
        }
        iVar12 = *(int *)((int)((PLANET *)lpplDst)->rgwtMin + 2);
        if ((((iVar12 < 1) &&
             ((iVar12 < 0 ||
              (*(CYBERINFO **)((PLANET *)lpplDst)->rgwtMin < (CYBERINFO *)lpciPlanDst_3)))) &&
            (iVar12 = *(int *)((int)pPVar4->rgwtMin + 2), -1 < iVar12)) &&
           ((0 < iVar12 || (700 < *(uint *)pPVar4->rgwtMin)))) {
          uVar11 = lpciPlanDst_3._2_2_;
          if (6 < (int)lpciPlanDst_3._2_2_) {
            uVar11 = 7;
          }
          AddItemToQueue(0xe,uVar11,grobjPlanet,0);
          lpciPlanDst_3 =
               (CYBERINFO *)CONCAT22(lpciPlanDst_3._2_2_ - uVar11,(CYBERINFO *)lpciPlanDst_3);
          *(uint *)CONCAT22(uVar7,puVar15) = *(uint *)CONCAT22(uVar7,puVar15) & 0xfeff;
          iStack_144 = 1;
        }
        iVar12 = *(int *)((int)((PLANET *)lpplDst)->rgwtMin + 6);
        if (((iVar12 < 1) &&
            (((iVar12 < 0 ||
              (*(CYBERINFO **)(((PLANET *)lpplDst)->rgwtMin + 1) < (CYBERINFO *)lpciPlanDst_3)) &&
             (iVar12 = *(int *)((int)pPVar4->rgwtMin + 6), -1 < iVar12)))) &&
           ((0 < iVar12 || (700 < *(uint *)(pPVar4->rgwtMin + 1))))) {
          uVar11 = lpciPlanDst_3._2_2_;
          if (6 < (int)lpciPlanDst_3._2_2_) {
            uVar11 = 7;
          }
          AddItemToQueue(0xf,uVar11,grobjPlanet,0);
          lpciPlanDst_3 =
               (CYBERINFO *)CONCAT22(lpciPlanDst_3._2_2_ - uVar11,(CYBERINFO *)lpciPlanDst_3);
          *(uint *)CONCAT22(uVar7,puVar15) = *(uint *)CONCAT22(uVar7,puVar15) & 0xfdff;
          iStack_144 = 1;
        }
        iVar12 = *(int *)((int)((PLANET *)lpplDst)->rgwtMin + 10);
        if (((iVar12 < 1) &&
            ((iVar12 < 0 ||
             (*(CYBERINFO **)(((PLANET *)lpplDst)->rgwtMin + 2) < (CYBERINFO *)lpciPlanDst_3)))) &&
           ((iVar12 = *(int *)((int)pPVar4->rgwtMin + 10), -1 < iVar12 &&
            ((0 < iVar12 || (700 < *(uint *)(pPVar4->rgwtMin + 2))))))) {
          if (6 < (int)lpciPlanDst_3._2_2_) {
            lpciPlanDst_3._2_2_ = 7;
          }
          AddItemToQueue(0x10,lpciPlanDst_3._2_2_,grobjPlanet,0);
          *(uint *)CONCAT22(uVar7,puVar15) = *(uint *)CONCAT22(uVar7,puVar15) & 0xfbff;
          iStack_144 = 1;
        }
        if (iStack_144 != 0) {
          sVar13 = IWarpMAFromLppl((PLANET *)CONCAT22(iVar5,pPVar4),&fTwoMA);
          uVar14 = sVar13 - 4;
          if (fTwoMA != 0) {
            uVar14 = sVar13 - 3;
          }
          sVar13 = IWarpMAFromLppl(lpplDst,&fTwoMA);
          uVar17 = sVar13 - 4;
          if (fTwoMA != 0) {
            uVar17 = sVar13 - 3;
          }
          if ((int)uVar17 <= (int)uVar14) {
            uVar14 = uVar17;
          }
          sel.pl.wFlags =
               sel.pl.wFlags & 0xc000U | (uVar14 & 0xf) << 10 | lpplDst->id + 1U & 0x3ff;
          FLookupPlanet(-1,(PLANET *)&sel.pl);
        }
      }
      else {
LAB_10a8_1fa3:
        if ((((uint)lpciPlan->wInfo >> 7 & 1) == 0) &&
           ((1 < (*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) ||
            (((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) == 1
             && (sVar13 = Random(3), sVar13 == 0)))))) {
          uVar7 = vlpbAiData._2_2_;
          pCVar16 = (CYBERINFO *)((byte *)vlpbAiData + game.cPlanMax * 2 + iVar10);
          lpciPlanDst_3 = (CYBERINFO *)CONCAT22(vlpbAiData._2_2_,pCVar16);
          bVar19 = (uint)rgResAvail[0] < (uint)rgResCost[0];
          rgResAvail[0]._0_2_ = (uint)rgResAvail[0] - (uint)rgResCost[0];
          rgResAvail[0]._2_2_ = (rgResAvail[0]._2_2_ - rgResCost[0]._2_2_) - (uint)bVar19;
          bVar19 = (uint)rgResAvail[1] < (uint)rgResCost[1];
          rgResAvail[1]._0_2_ = (uint)rgResAvail[1] - (uint)rgResCost[1];
          rgResAvail[1]._2_2_ = (rgResAvail[1]._2_2_ - rgResCost[1]._2_2_) - (uint)bVar19;
          bVar19 = (uint)rgResAvail[2] < (uint)rgResCost[2];
          rgResAvail[2]._0_2_ = (uint)rgResAvail[2] - (uint)rgResCost[2];
          rgResAvail[2]._2_2_ = (rgResAvail[2]._2_2_ - rgResCost[2]._2_2_) - (uint)bVar19;
          uVar14 = ((uint)rgResAvail[0] - 0x46) + ((uint)rgResAvail[1] - 0x46);
          uVar17 = uVar14 + ((uint)rgResAvail[2] - 0x46);
          iVar18 = rgResAvail[0]._2_2_ + (uint)(0x45 < (uint)rgResAvail[0]) +
                   rgResAvail[1]._2_2_ + (uint)(0x45 < (uint)rgResAvail[1]) +
                   (uint)CARRY2((uint)rgResAvail[0] - 0x46,(uint)rgResAvail[1] - 0x46) +
                   rgResAvail[2]._2_2_ + -3 + (uint)(0x45 < (uint)rgResAvail[2]) +
                   (uint)CARRY2(uVar14,(uint)rgResAvail[2] - 0x46);
          lVar20 = CONCAT22(iVar18,uVar17);
          lVar21 = __aFldiv(CONCAT22(rgResAvail[3]._2_2_,(undefined2)rgResAvail[3]),2);
          iVar12 = ((int)lVar21 + -5) / 5;
          uVar22 = __aFulmul((long)iVar12,0x46);
          if (lVar20 < (long)uVar22) {
            uVar22 = CONCAT22(iVar18,uVar17);
          }
          else {
            uVar22 = __aFulmul((long)iVar12,0x46);
          }
          lpciPlanDst_3->wInfo = (short)uVar22;
          (pCVar16 + 1)->wInfo = (short)(uVar22 >> 0x10);
          if ((iVar18 < 0) || ((iVar18 < 1 && (uVar17 < 0x97)))) {
            lpplDst = (PLANET *)0x0;
          }
          else {
            lpplDst = LpplFindClosestEnum((PLANET *)CONCAT22(iVar5,pPVar4),FEnumPktAttack);
          }
          if (((PLANET *)lpplDst != (PLANET *)0x0) || (lpplDst._2_2_ != 0)) {
            cPacket[0] = 0;
            cPacket[1] = 0;
            cPacket[2] = 0;
            lpciPlanDst_2 =
                 (CYBERINFO *)
                 CONCAT22(vlpbAiData._2_2_,
                          (CYBERINFO *)((byte *)vlpbAiData + lpplDst->id * 2 + 2));
            if (((uint)((PLANET *)lpplDst)->wFlags >> 9 & 1) != 0) {
              IWarpMAFromLppl(lpplDst,&fTwoMA);
            }
            sVar13 = IWarpMAFromLppl((PLANET *)CONCAT22(iVar5,pPVar4),&fTwoMA);
            dVar6 = (double)(long)((sVar13 + 3) * (sVar13 + 3));
            dVar9 = DGetDistance(((POINT *)rgptPlan + lppl->id)->x,
                                       *(short *)((int)&rgptPlan[0].y + lppl->id * 4),
                                       ((POINT *)rgptPlan + lpplDst->id)->x,
                                       *(short *)((int)&rgptPlan[0].y + lpplDst->id * 4));
            dVar3 = *(double *)CONCAT11(extraout_AH,dVar9);
            if (((((PLANET *)lpplDst)->uGuesses & 0xfffU) + 0x19) * 4 < 0x3e9) {
              in_stack_0000fe72 = ((((PLANET *)lpplDst)->uGuesses & 0xfffU) + 0x19) * 4;
              in_stack_0000fe74 = 0;
            }
            lVar21 = __ftol((double)CONCAT26(in_stack_0000fe74,
                                                     CONCAT24(in_stack_0000fe72,
                                                              CONCAT22(unaff_SI,unaff_DI))));
            if (lVar21 < lVar20) {
              lVar20 = lVar21;
            }
            if (fTwoMA == 0) {
              dVar3 = dVar3 / dVar6;
              _pow(SUB84(DOUBLE_0_75__1120_1e3e,0),
                           (double)CONCAT26((int)((qword)dVar3 >> 0x10),
                                            CONCAT24(SUB82(dVar3,0),
                                                     (long)((qword)DOUBLE_0_75__1120_1e3e >> 0x20)))
                           ,(double)CONCAT26(unaff_SI,CONCAT24(unaff_DI,(long)((qword)dVar3 >> 0x20)
                                                              )));
              lVar21 = __ftol((double)CONCAT26(in_stack_0000fe74,
                                                       CONCAT24(in_stack_0000fe72,
                                                                CONCAT22(unaff_SI,unaff_DI))));
            }
            else {
              dVar3 = dVar3 / dVar6;
              _pow(SUB84(DOUBLE_0_875__1120_1e36,0),
                           (double)CONCAT26((int)((qword)dVar3 >> 0x10),
                                            CONCAT24(SUB82(dVar3,0),
                                                     (long)((qword)DOUBLE_0_875__1120_1e36 >> 0x20))
                                           ),
                           (double)CONCAT26(unaff_SI,CONCAT24(unaff_DI,(long)((qword)dVar3 >> 0x20))
                                           ));
              lVar21 = __ftol((double)CONCAT26(in_stack_0000fe74,
                                                       CONCAT24(in_stack_0000fe72,
                                                                CONCAT22(unaff_SI,unaff_DI))));
            }
            _auStack_188 = (longdouble)lVar20;
            while( true ) {
              iStack_14e = (int)((ulong)lVar21 >> 0x10);
              cResLeft = (short)lVar21;
              auVar8 = auStack_188;
              if (lVar21 < 1) break;
              _auStack_188 = (longdouble)(unkuint10)(qword)auStack_188;
              if ((rgResAvail[0]._2_2_ <= rgResAvail[1]._2_2_) &&
                 ((rgResAvail[0]._2_2_ < rgResAvail[1]._2_2_ ||
                  ((uint)rgResAvail[0] < (uint)rgResAvail[1])))) {
                _auStack_188 = (longdouble)CONCAT28(1,auVar8);
              }
              iVar5 = *(int *)((int)rgResAvail + iMin * 4 + 2);
              if ((iVar5 <= rgResAvail[2]._2_2_) &&
                 ((iVar5 < rgResAvail[2]._2_2_ ||
                  (*(uint *)(rgResAvail + iMin) < (uint)rgResAvail[2])))) {
                _auStack_188 = (longdouble)CONCAT28(2,auStack_188);
              }
              cPacket[iMin] = cPacket[iMin] + 1;
              puVar1 = (uint *)(rgResAvail + iMin);
              uVar14 = *puVar1;
              *puVar1 = *puVar1 - 0x46;
              piVar2 = (int *)((int)rgResAvail + iMin * 4 + 2);
              *piVar2 = *piVar2 - (uint)(uVar14 < 0x46);
              lVar21 = CONCAT22(iStack_14e - (uint)((uint)cResLeft < 0x46),cResLeft + -0x46);
            }
            if (0 < cPacket[0]) {
              AddItemToQueue(0xe,cPacket[0],grobjPlanet,0);
            }
            if (0 < cPacket[1]) {
              AddItemToQueue(0xf,cPacket[1],grobjPlanet,0);
            }
            if (0 < cPacket[2]) {
              AddItemToQueue(0x10,cPacket[2],grobjPlanet,0);
            }
            sel.pl.wFlags =
                 sel.pl.wFlags & 0xc000U | (sVar13 - 1U & 0xf) << 10 |
                 lpplDst->id + 1U & 0x3ff;
            FLookupPlanet(-1,(PLANET *)&sel.pl);
            bVar19 = false;
            lpciPlanDst_2->wInfo = lpciPlanDst_2->wInfo & 0xff9fU | 0x60;
            __aFfcompp();
            if (bVar19) {
              lpciPlan->wInfo = lpciPlan->wInfo & 0xff7fU | 0x80;
            }
            lpciPlan->wInfo = lpciPlan->wInfo & 0xffef;
            iStack_144 = 1;
            goto AI4_LFinish;
          }
        }
        if ((((uint)lpciPlan->wInfo >> 4 & 1) == 0) || (((uint)lpciPlan->wInfo >> 7 & 1) != 0)) {
          if (((uint)lpciPlan->wInfo >> 7 & 1) == 0) {
            uVar14 = Random(7);
            if (uVar14 == (lpciPlan->wInfo & 7U)) {
              lpciPlan->wInfo = lpciPlan->wInfo & 0xfff8U | uVar14 + 1 & 7;
            }
            else {
              lpciPlan->wInfo = lpciPlan->wInfo & 0xfff8U | uVar14 & 7;
            }
            idPlanDst = IdGetBestScannerDest((PLANET *)CONCAT22(iVar5,pPVar4),lpciPlan->wInfo & 7);
          }
          if ((((uint)lpciPlan->wInfo >> 7 & 1) != 0) || (idPlanDst != -1)) {
            lpciPlanDst_3 =
                 (CYBERINFO *)
                 CONCAT22(vlpbAiData._2_2_,
                          (CYBERINFO *)((byte *)vlpbAiData + idPlanDst * 2 + 2));
            if ((((uint)lpciPlanDst_3->wInfo >> 5 & 3) == 0) &&
               (sVar13 = FAddPacketToQueue((PLANET *)CONCAT22(iVar5,pPVar4)), sVar13 != 0)) {
              lpciPlanDst_3->wInfo = lpciPlanDst_3->wInfo & 0xff9fU | 0x60;
              lpciPlan->wInfo =
                   lpciPlan->wInfo & 0xffefU | (uint)(((uint)lpciPlan->wInfo >> 7 & 1) == 0) << 4;
              iStack_144 = 1;
            }
            else {
              lpciPlan->wInfo = lpciPlan->wInfo & 0xffef;
            }
            sVar13 = IWarpMAFromLppl((PLANET *)CONCAT22(iVar5,pPVar4),&fTwoMA);
            uVar14 = (sVar13 - 1U & 0xf) << 10;
            if (((uint)lpciPlan->wInfo >> 7 & 1) == 0) {
              sel.pl.wFlags =
                   sel.pl.wFlags & 0xc000U | uVar14 | idPlanDst & 0x3ffU;
            }
            else {
              sel.pl.wFlags = sel.pl.wFlags & 0xc3ffU | uVar14;
              lpciPlan->wInfo = lpciPlan->wInfo & 0xff7f;
            }
            FLookupPlanet(-1,(PLANET *)&sel.pl);
          }
        }
        else {
          lpciPlan->wInfo = lpciPlan->wInfo & 0xffef;
        }
      }
AI4_LFinish:
      FinishProduction(iStack_144);
    }
    ipl = ipl + 1;
  } while( true );
}



// ======================================================================
// Function: IdGetBestScannerDest
// Address: 10a8:282a
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a82b98) */

short IdGetBestScannerDest(PLANET *lppl,short iDir)

{
  int iVar1;
  POINT pt;
  POINT pt1;
  POINT pt2;
  int iVar2;
  short sVar3;
  int c;
  int iVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar5;
  PLANET *pPVar6;
  SCAN scan;
  POINT ptEdge;
  short iSize;
  short dAdjust;
  PLANET *lpplDst;
  short iWarp;
  short iDistance;
  
  iVar4 = ((POINT *)rgptPlan + lppl->id)->x;
  iVar1 = *(int *)((int)&rgptPlan[0].y + lppl->id * 4);
  iVar2 = game.mdSize * 400 + 400;
  sVar3 = IWarpMAFromLppl(lppl,(short *)0x0);
  c = (sVar3 + 3) * (sVar3 + 3);
  iVar4 = iVar4 + -1000;
  iVar1 = iVar1 + -1000;
  ptEdge.x = iVar2;
  ptEdge.y = iVar2;
  switch(iDir) {
  case 0:
    ptEdge.y = iVar1;
    break;
  case 1:
    if (iVar1 < iVar2 - iVar4) {
      ptEdge.x = iVar4 + iVar1;
      ptEdge.y = 0;
    }
    else {
      ptEdge.y = iVar1 - (iVar2 - iVar4);
    }
    break;
  case 2:
    ptEdge.y = 0;
    ptEdge.x = iVar4;
    break;
  case 3:
    if (iVar1 < iVar4) {
      ptEdge.y = 0;
      ptEdge.x = iVar4 - iVar1;
    }
    else {
      ptEdge.y = iVar1 - iVar4;
      ptEdge.x = 0;
    }
    break;
  case 4:
    ptEdge.x = 0;
    ptEdge.y = iVar1;
    break;
  case 5:
    if (iVar1 < iVar2 - iVar4) {
      ptEdge.y = iVar1 + iVar4;
      ptEdge.x = 0;
    }
    else {
      ptEdge.x = iVar4 - (iVar2 - iVar1);
    }
    break;
  case 6:
    ptEdge.x = iVar4;
    break;
  case 7:
    if (iVar1 < iVar4) {
      ptEdge.y = iVar1 + (iVar2 - iVar4);
    }
    else {
      ptEdge.x = iVar4 + (iVar2 - iVar1);
    }
    break;
  default:
    return -1;
  }
  lVar5 = __ftol((double)CONCAT26(iVar2 >> 0xf,CONCAT24(iVar2,CONCAT22(unaff_SI,unaff_DI))))
  ;
  sVar3 = Random((short)lVar5);
  lVar5 = __ftol((double)CONCAT26(iVar2 >> 0xf,CONCAT24(iVar2,CONCAT22(unaff_SI,unaff_DI))))
  ;
  iVar4 = sVar3 - (int)lVar5;
  if ((ptEdge.x == 0) || (ptEdge.x == iVar2)) {
    ptEdge.y = ptEdge.y + iVar4;
    if (iVar2 < ptEdge.y) {
      dAdjust = ptEdge.y - iVar2;
      ptEdge.y = iVar2;
    }
    else if (ptEdge.y < 0) {
      dAdjust = -ptEdge.y;
      ptEdge.y = 0;
    }
    else {
      dAdjust = 0;
    }
    if (ptEdge.x != 0) {
      dAdjust = -dAdjust;
    }
    ptEdge.x = ptEdge.x + dAdjust;
  }
  else {
    ptEdge.x = ptEdge.x + iVar4;
    if (iVar2 < ptEdge.x) {
      dAdjust = ptEdge.x - iVar2;
      ptEdge.x = iVar2;
    }
    else if (ptEdge.x < 0) {
      dAdjust = -ptEdge.x;
      ptEdge.x = 0;
    }
    else {
      dAdjust = 0;
    }
    if (ptEdge.y == 0) {
      ptEdge.y = dAdjust;
    }
    else {
      ptEdge.y = ptEdge.y - dAdjust;
    }
  }
  sVar3 = Random(c);
  iVar4 = ptEdge.x;
  iVar1 = sVar3;
  if (ptEdge.y != 0) {
    if (ptEdge.y == iVar2) {
      iVar1 = ptEdge.y - sVar3;
    }
    else {
      iVar4 = sVar3;
      iVar1 = ptEdge.y;
      if ((ptEdge.x != 0) && (iVar4 = ptEdge.x, ptEdge.x == iVar2)) {
        iVar4 = ptEdge.x - sVar3;
      }
    }
  }
  ptEdge.y = iVar1;
  ptEdge.x = iVar4;
  pt.y = ptEdge.y + 1000;
  pt.x = ptEdge.x + 1000;
  sVar3 = FFindNearestObject(pt,0x21,&scan);
  if (sVar3 == 0) {
    sVar3 = -1;
  }
  else {
    pPVar6 = LpplFromId(scan.idpl);
    iVar4 = (int)((ulong)pPVar6 >> 0x10);
    if (((((PLANET *)pPVar6 == (PLANET *)0x0) && (iVar4 == 0)) ||
        (((PLANET *)pPVar6)->iPlayer != idPlayer)) &&
       (pt1.y = *(short *)((int)&rgptPlan[0].y + scan.idpl * 4),
       pt1.x = ((POINT *)rgptPlan + scan.idpl)->x,
       pt2.y = *(short *)((int)&rgptPlan[0].y + lppl->id * 4),
       pt2.x = ((POINT *)rgptPlan + lppl->id)->x, lVar5 = LDistance2(pt1,pt2),
       c * c <= lVar5)) {
      sVar3 = scan.idpl + 1;
    }
    else {
      sVar3 = -1;
    }
  }
  return sVar3;
}



// ======================================================================
// Function: FAddPacketToQueue
// Address: 10a8:2bc0
// Segment: MEMORY_AI4
// ======================================================================


short FAddPacketToQueue(PLANET *lppl)

{
  short sVar1;
  int iVar2;
  int iVar3;
  long rgResAvail [4];
  short iMineral;
  long rgResCost [4];
  
  iMineral = 0;
  GetResourcesAvailable(lppl,rgResAvail);
  GetProdQCost(lppl,rgResCost);
  iVar2 = (rgResAvail[0]._2_2_ - rgResCost[0]._2_2_) -
          (uint)((uint)rgResAvail[0] < (uint)rgResCost[0]);
  iVar3 = (rgResAvail[1]._2_2_ - rgResCost[1]._2_2_) -
          (uint)((uint)rgResAvail[1] < (uint)rgResCost[1]);
  if ((iVar2 <= iVar3) &&
     ((iVar2 < iVar3 ||
      ((uint)rgResAvail[0] - (uint)rgResCost[0] < (uint)rgResAvail[1] - (uint)rgResCost[1])))) {
    iMineral = 1;
  }
  iVar2 = (*(int *)((int)rgResAvail + iMineral * 4 + 2) -
          *(int *)((int)rgResCost + iMineral * 4 + 2)) -
          (uint)(*(uint *)(rgResAvail + iMineral) < *(uint *)(rgResCost + iMineral));
  iVar3 = (rgResAvail[2]._2_2_ - rgResCost[2]._2_2_) -
          (uint)((uint)rgResAvail[2] < (uint)rgResCost[2]);
  if ((iVar2 <= iVar3) &&
     ((iVar2 < iVar3 ||
      (*(uint *)(rgResAvail + iMineral) - *(uint *)(rgResCost + iMineral) <
       (uint)rgResAvail[2] - (uint)rgResCost[2])))) {
    iMineral = 2;
  }
  iVar2 = (*(int *)((int)rgResAvail + iMineral * 4 + 2) -
          *(int *)((int)rgResCost + iMineral * 4 + 2)) -
          (uint)(*(uint *)(rgResAvail + iMineral) < *(uint *)(rgResCost + iMineral));
  if ((iVar2 < 0) ||
     ((iVar2 < 1 && (*(uint *)(rgResAvail + iMineral) - *(uint *)(rgResCost + iMineral) < 0xaa)))) {
    sVar1 = 0;
  }
  else {
    AddItemToQueue(iMineral + 0xe,1,grobjPlanet,0);
    sVar1 = 1;
  }
  return sVar1;
}



// ======================================================================
// Function: FillProductionQueue
// Address: 10a8:2ce2
// Segment: MEMORY_AI4
// ======================================================================


void FillProductionQueue(void)

{
  PLANET *pPVar1;
  int iVar2;
  short fWrite;
  PROD rgprod [64];
  short ipl;
  PLANET *lppl;
  
  ipl = 0;
  while( true ) {
    if (vclpplAi <= ipl) {
      return;
    }
                    /* WARNING: Load size is inaccurate */
    pPVar1 = ((PLANET **)vrglpplAi)[ipl];
    iVar2 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
    lppl = (PLANET *)CONCAT22(iVar2,pPVar1);
    if ((pPVar1 == (PLANET *)0x0) && (iVar2 == 0)) break;
    ChangeMainObjSel(1,lppl->id);
    InitProduction(rgprod);
    fWrite = FFillProdMinesAndFactories((PLANET *)CONCAT22(iVar2,pPVar1));
    FinishProduction(fWrite);
    ipl = ipl + 1;
  }
  return;
}



// ======================================================================
// Function: FFillProdMinesAndFactories
// Address: 10a8:2d72
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a83333) */
/* WARNING: Removing unreachable block (ram,0x10a83088) */
/* WARNING: Removing unreachable block (ram,0x10a82fba) */
/* WARNING: Removing unreachable block (ram,0x10a82ed5) */
/* WARNING: Removing unreachable block (ram,0x10a82ead) */
/* WARNING: Removing unreachable block (ram,0x10a82f38) */
/* WARNING: Removing unreachable block (ram,0x10a82f8a) */
/* WARNING: Removing unreachable block (ram,0x10a83156) */
/* WARNING: Removing unreachable block (ram,0x10a832eb) */
/* WARNING: Removing unreachable block (ram,0x10a82f10) */
/* WARNING: Removing unreachable block (ram,0x10a831b1) */

short FFillProdMinesAndFactories(PLANET *lppl)

{
  uint uVar1;
  int iVar2;
  uint uVar3;
  short sVar4;
  short sVar5;
  int iVar6;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  bool bVar7;
  bool bVar8;
  ulong uVar9;
  ulong uVar10;
  long lVar11;
  ushort in_stack_0000ff7c;
  short cAdd;
  PROD *lpprod;
  short fInsert;
  short iMaxMines;
  short iMaxFactBuildable;
  short iMaxFactories;
  short i;
  short iMaxTerra;
  short iAddAlchemy;
  long rgResLeft [4];
  long rgFactCost [4];
  long rgMineCost [4];
  long rgAlchCost [4];
  PROD prod;
  short iAddMines;
  short iAddFactories;
  long rgResAvail [4];
  long rgResCost [4];
  
  uVar10 = CONCAT22(unaff_SI,unaff_DI);
  bVar7 = false;
  GetResourcesAvailable(lppl,rgResAvail);
  GetProdQCost(lppl,rgResCost);
  for (i = 0; i < 4; i = i + 1) {
    uVar3 = *(uint *)(rgResAvail + i);
    iVar6 = *(int *)((int)rgResAvail + i * 4 + 2);
    uVar1 = *(uint *)(rgResCost + i);
    iVar2 = *(int *)((int)rgResCost + i * 4 + 2);
    *(uint *)(rgResLeft + i) = uVar3 - *(uint *)(rgResCost + i);
    *(int *)((int)rgResLeft + i * 4 + 2) = (iVar6 - iVar2) - (uint)(uVar3 < uVar1);
  }
  if ((rgResLeft[3]._2_2_ < 1) && (rgResLeft[3]._2_2_ < 0)) {
    uVar3 = 0;
  }
  else {
    iMaxTerra = 0;
    iMaxMines = 0;
    iAddMines = 0;
    iMaxFactories = 0;
    iAddFactories = 0;
    rgMineCost[3]._0_2_ = 0;
    rgMineCost[3]._2_2_ = 0;
    rgFactCost[3]._0_2_ = 0;
    rgFactCost[3]._2_2_ = 0;
    rgAlchCost[3]._0_2_ = 0;
    rgAlchCost[3]._2_2_ = 0;
    lpprod = (PROD *)CONCAT22(lpplProdGlob._2_2_,(PLPROD *)lpplProdGlob + 1);
    for (i = 0; iVar6 = cProdGlob,
        i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac; i = i + 1) {
      uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
      if ((((uint)uVar9 & 7) == 1) &&
         (uVar9 = __aFulshr(uVar10,in_stack_0000ff7c), ((uint)uVar9 & 0x7f) == 8)) {
        iAddMines = iAddMines + ((uint)lpprod->dwFlags & 0x3ff);
      }
      uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
      if ((((uint)uVar9 & 7) == 1) &&
         (uVar9 = __aFulshr(uVar10,in_stack_0000ff7c), ((uint)uVar9 & 0x7f) == 7)) {
        iAddFactories = iAddFactories + ((uint)lpprod->dwFlags & 0x3ff);
      }
      lpprod = (PROD *)CONCAT22(lpprod._2_2_,(PROD *)lpprod + 1);
    }
    while (i = iVar6 + -1, -1 < i) {
      uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
      iVar6 = i;
      if (((uint)uVar9 & 7) == 1) {
        uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
        if (((uint)uVar9 & 0x7f) == 8) {
          sVar4 = CMaxOperableMines(lppl,idPlayer,0);
          sVar5 = CMinesOperating(lppl);
          if ((uint)((sVar4 - sVar5) - iAddMines) < 0x8000) {
            sVar4 = CMaxOperableMines(lppl,idPlayer,0);
            sVar5 = CMinesOperating(lppl);
            iMaxMines = (sVar4 - sVar5) - iAddMines;
          }
          else {
            iMaxMines = 0;
          }
          GetProductionCosts
                    (lppl,(PROD *)CONCAT22((undefined1 *)&DAT_1120_1120,pProdGlob + i),
                     (ulong *)rgMineCost,idPlayer,1);
        }
        uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
        if (((uint)uVar9 & 0x7f) == 7) {
          sVar4 = CMaxOperableFactories(lppl,idPlayer,0);
          sVar5 = CFactoriesOperating(lppl);
          if ((uint)((sVar4 - sVar5) - iAddFactories) < 0x8000) {
            sVar4 = CMaxOperableFactories(lppl,idPlayer,0);
            sVar5 = CFactoriesOperating(lppl);
            iMaxFactories = (sVar4 - sVar5) - iAddFactories;
          }
          else {
            iMaxFactories = 0;
          }
          GetProductionCosts
                    (lppl,(PROD *)CONCAT22((undefined1 *)&DAT_1120_1120,pProdGlob + i),
                     (ulong *)rgFactCost,idPlayer,1);
        }
        uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
        if (((uint)uVar9 & 0x7f) == 0xb) {
          GetProductionCosts
                    (lppl,(PROD *)CONCAT22((undefined1 *)&DAT_1120_1120,pProdGlob + i),
                     (ulong *)rgAlchCost,idPlayer,1);
        }
        uVar9 = __aFulshr(uVar10,in_stack_0000ff7c);
        if (((uint)uVar9 & 0x7f) == 0xc) {
          iMaxTerra = (uint)(pProdGlob + i)->dwFlags & 0x3ff;
        }
      }
    }
    if ((iMaxTerra != 0) &&
       (*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 0xd == 5)) {
      lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_ + (uint)(0xffba < (uint)rgResLeft[3]),
                                         (uint)rgResLeft[3] + 0x45),0x46);
      cAdd = (short)lVar11;
      if (iMaxTerra < cAdd) {
        cAdd = iMaxTerra;
      }
      if (0 < cAdd) {
        AddItemToQueue(0xc,cAdd,grobjPlanet,0);
        return 1;
      }
    }
    iAddMines = iMaxMines;
    if (((rgResLeft[0]._2_2_ < 0) ||
        ((((rgResLeft[0]._2_2_ < 1 && ((int)rgResLeft[0] == 0)) || (rgResLeft[1]._2_2_ < 0)) ||
         ((rgResLeft[1]._2_2_ < 1 && ((int)rgResLeft[1] == 0)))))) ||
       ((rgResLeft[2]._2_2_ < 1 && ((rgResLeft[2]._2_2_ < 0 || ((int)rgResLeft[2] == 0)))))) {
      if ((((*(int *)&((PLANET *)lppl)->lpplprod != 0) ||
           (*(int *)((int)&((PLANET *)lppl)->lpplprod + 2) != 0)) &&
          (uVar9 = __aFulshr(uVar10,in_stack_0000ff7c), ((uint)uVar9 & 7) == 1)) &&
         ((uVar9 = __aFulshr(uVar10,in_stack_0000ff7c), ((uint)uVar9 & 0x7f) == 3 ||
          (uVar10 = __aFulshr(uVar10,in_stack_0000ff7c), ((uint)uVar10 & 0x7f) == 0xb)))) {
        return 0;
      }
      if (iMaxMines < 1) {
        iAddMines = 0;
      }
      else {
        lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                  CONCAT22(rgMineCost[3]._2_2_,(undefined2)rgMineCost[3]));
        if ((int)lVar11 <= iMaxMines) {
          lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                    CONCAT22(rgMineCost[3]._2_2_,(undefined2)rgMineCost[3]));
          iAddMines = (short)lVar11;
        }
      }
      uVar10 = __aFulmul((long)iAddMines,
                                 CONCAT22(rgMineCost[3]._2_2_,(undefined2)rgMineCost[3]));
      bVar7 = (uint)rgResLeft[3] < (uint)uVar10;
      rgResLeft[3]._0_2_ = (uint)rgResLeft[3] - (uint)uVar10;
      rgResLeft[3]._2_2_ = (rgResLeft[3]._2_2_ - (int)(uVar10 >> 0x10)) - (uint)bVar7;
      iAddFactories = 0;
      bVar7 = true;
    }
    else {
      if (0 < iMaxFactories) {
        if (((uint)gd._0_2_ >> 0xb & 1) == 0) {
          lVar11 = __aFldiv(CONCAT22(rgResLeft[2]._2_2_,(int)rgResLeft[2]),
                                    CONCAT22(rgFactCost[2]._2_2_,(undefined2)rgFactCost[2]));
          if ((int)lVar11 <= iMaxFactories) {
            lVar11 = __aFldiv(CONCAT22(rgResLeft[2]._2_2_,(int)rgResLeft[2]),
                                      CONCAT22(rgFactCost[2]._2_2_,(undefined2)rgFactCost[2]));
            iMaxFactories = (short)lVar11;
          }
        }
        else {
          lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                    CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
          iVar6 = iMaxFactories;
          if ((int)lVar11 <= iMaxFactories) {
            lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                      CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
            iVar6 = (int)lVar11;
          }
          lVar11 = __aFldiv(CONCAT22(rgResLeft[1]._2_2_,(int)rgResLeft[1]),
                                    CONCAT22(rgFactCost[1]._2_2_,(undefined2)rgFactCost[1]));
          if (iVar6 < (int)lVar11) {
            lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                      CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
            iVar6 = iMaxFactories;
            if ((int)lVar11 <= iMaxFactories) {
              lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                        CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
              iVar6 = (int)lVar11;
            }
          }
          else {
            lVar11 = __aFldiv(CONCAT22(rgResLeft[1]._2_2_,(int)rgResLeft[1]),
                                      CONCAT22(rgFactCost[1]._2_2_,(undefined2)rgFactCost[1]));
            iVar6 = (int)lVar11;
          }
          lVar11 = __aFldiv(CONCAT22(rgResLeft[2]._2_2_,(int)rgResLeft[2]),
                                    CONCAT22(rgFactCost[2]._2_2_,(undefined2)rgFactCost[2]));
          if (iVar6 < (int)lVar11) {
            lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                      CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
            iVar6 = iMaxFactories;
            if ((int)lVar11 <= iMaxFactories) {
              lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                        CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
              iVar6 = (int)lVar11;
            }
            lVar11 = __aFldiv(CONCAT22(rgResLeft[1]._2_2_,(int)rgResLeft[1]),
                                      CONCAT22(rgFactCost[1]._2_2_,(undefined2)rgFactCost[1]));
            if (iVar6 < (int)lVar11) {
              lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                        CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
              if ((int)lVar11 <= iMaxFactories) {
                lVar11 = __aFldiv(CONCAT22(rgResLeft[0]._2_2_,(int)rgResLeft[0]),
                                          CONCAT22(rgFactCost[0]._2_2_,(undefined2)rgFactCost[0]));
                iMaxFactories = (short)lVar11;
              }
            }
            else {
              lVar11 = __aFldiv(CONCAT22(rgResLeft[1]._2_2_,(int)rgResLeft[1]),
                                        CONCAT22(rgFactCost[1]._2_2_,(undefined2)rgFactCost[1]));
              iMaxFactories = (short)lVar11;
            }
          }
          else {
            lVar11 = __aFldiv(CONCAT22(rgResLeft[2]._2_2_,(int)rgResLeft[2]),
                                      CONCAT22(rgFactCost[2]._2_2_,(undefined2)rgFactCost[2]));
            iMaxFactories = (short)lVar11;
          }
        }
      }
      if (iMaxFactories < 1) {
        iAddFactories = 0;
      }
      else {
        lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                  CONCAT22(rgFactCost[3]._2_2_,(undefined2)rgFactCost[3]));
        iAddFactories = iMaxFactories;
        if ((int)lVar11 <= iMaxFactories) {
          lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                    CONCAT22(rgFactCost[3]._2_2_,(undefined2)rgFactCost[3]));
          iAddFactories = (short)lVar11;
        }
      }
      uVar10 = __aFulmul((long)iAddFactories,
                                 CONCAT22(rgFactCost[3]._2_2_,(undefined2)rgFactCost[3]));
      bVar8 = (uint)rgResLeft[3] < (uint)uVar10;
      rgResLeft[3]._0_2_ = (uint)rgResLeft[3] - (uint)uVar10;
      rgResLeft[3]._2_2_ = (rgResLeft[3]._2_2_ - (int)(uVar10 >> 0x10)) - (uint)bVar8;
      if (iMaxMines < 1) {
        iAddMines = 0;
      }
      else {
        lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                  CONCAT22(rgMineCost[3]._2_2_,(undefined2)rgMineCost[3]));
        if ((int)lVar11 <= iMaxMines) {
          lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                    CONCAT22(rgMineCost[3]._2_2_,(undefined2)rgMineCost[3]));
          iAddMines = (short)lVar11;
        }
      }
      uVar10 = __aFulmul((long)iAddMines,
                                 CONCAT22(rgMineCost[3]._2_2_,(undefined2)rgMineCost[3]));
      bVar8 = (uint)rgResLeft[3] < (uint)uVar10;
      rgResLeft[3]._0_2_ = (uint)rgResLeft[3] - (uint)uVar10;
      rgResLeft[3]._2_2_ = (rgResLeft[3]._2_2_ - (int)(uVar10 >> 0x10)) - (uint)bVar8;
    }
    if (((rgAlchCost[3]._2_2_ < 0) ||
        (((rgAlchCost[3]._2_2_ < 1 && ((int)rgAlchCost[3] == 0)) ||
         (*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) != '\x1a')))) ||
       ((((*(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0) != '\x1a' ||
          (*(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0) != '\x1a')) ||
         (*(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0) != '\x1a')) ||
        ((*(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) != '\x1a' ||
         (*(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0) != '\x1a')))))) {
      iAddAlchemy = 0;
    }
    else {
      lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                CONCAT22(rgAlchCost[3]._2_2_,(int)rgAlchCost[3]));
      if ((int)lVar11 + 1U < 0x8000) {
        lVar11 = __aFldiv(CONCAT22(rgResLeft[3]._2_2_,(uint)rgResLeft[3]),
                                  CONCAT22(rgAlchCost[3]._2_2_,(int)rgAlchCost[3]));
        iAddAlchemy = (int)lVar11 + 1;
      }
      else {
        iAddAlchemy = 0;
      }
    }
    uVar10 = __aFulmul((long)iAddAlchemy,CONCAT22(rgAlchCost[3]._2_2_,(int)rgAlchCost[3]));
    bVar8 = (uint)rgResLeft[3] < (uint)uVar10;
    rgResLeft[3]._0_2_ = (uint)rgResLeft[3] - (uint)uVar10;
    rgResLeft[3]._2_2_ = (rgResLeft[3]._2_2_ - (int)(uVar10 >> 0x10)) - (uint)bVar8;
    if (0 < iAddFactories) {
      AddItemToQueue(7,iAddFactories,grobjPlanet,1);
    }
    if (0 < iAddMines) {
      AddItemToQueue(8,iAddMines,grobjPlanet,0);
    }
    if ((0 < iAddAlchemy) && (100 < (uint)game.turn)) {
      AddItemToQueue(0xb,iAddAlchemy,grobjPlanet,(uint)!bVar7);
    }
    uVar3 = (uint)(0 < iAddMines + iAddFactories + iAddAlchemy);
  }
  return uVar3;
}



// ======================================================================
// Function: DoCyberFreighter
// Address: 10a8:37b0
// Segment: MEMORY_AI4
// ======================================================================


void DoCyberFreighter(FLEET *lpfl,CYBERINFOTEMP *lpciPlanTemp)

{
  ORDER *pOVar1;
  PLORD *pPVar2;
  byte *pbVar3;
  POINT pt;
  PLANET *pPVar4;
  bool bVar5;
  uint uVar6;
  short sVar7;
  int iVar8;
  int iVar9;
  FLEET *pFVar10;
  PLORD *pPVar11;
  ORDER *pOVar12;
  byte *pbVar13;
  undefined2 uVar14;
  undefined2 uVar15;
  PLANET *lppl;
  SCAN scan;
  short idPlanDst;
  short fDropOff;
  PLANET *lpplCur;
  PLANET *lpplDst;
  ORDER ord;
  
  bVar5 = false;
  uVar14 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar10 = (FLEET *)lpfl;
  lppl = LpplFromId(pFVar10->idPlanet);
  iVar9 = (int)((ulong)lppl >> 0x10);
  pPVar4 = (PLANET *)lppl;
  if ((pPVar4 == (PLANET *)0x0) && (iVar9 == 0)) {
    pt.y = (pFVar10->pt).y;
    pt.x = (&pFVar10->pt)->x;
    sVar7 = FFindNearestObject(pt,0x21,&scan);
    if (sVar7 == 0) {
      lpplDst = (PLANET *)0x0;
    }
    else {
      lpplDst = LpplFromId(scan.idpl);
    }
  }
  else {
    if (pPVar4->iPlayer == idPlayer) {
      iVar8 = *(int *)((int)pPVar4->rgwtMin + 0xe);
      if ((iVar8 < 0) || ((iVar8 < 1 && (*(uint *)(pPVar4->rgwtMin + 3) < 0x7d1)))) {
        XferAiSupply(1,pFVar10->idPlanet,2,lpfl->id,3,-1000);
        FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
      }
      else {
        XferAiSupply(1,pFVar10->idPlanet,2,lpfl->id,3,1000);
        FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
        bVar5 = true;
      }
    }
    else if (((pPVar4->iPlayer == -1) ||
             (sVar7 = GetRaceStat((PLAYER *)rgplr + pPVar4->iPlayer,rsMajorAdv),
             sVar7 == raMacintosh)) || (((uint)pPVar4->wFlags >> 9 & 1) != 0)) {
      iVar8 = *(int *)((int)pFVar10->rgwtMin + 0xe);
      if ((iVar8 < 0) || ((iVar8 < 1 && ((int)pFVar10->rgwtMin[3] == 0)))) {
        bVar5 = false;
      }
      else {
        bVar5 = true;
      }
    }
    else {
      FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
      iVar8 = lppl->id;
      _memset(&ord,0,0x12);
      ord.pt.x = ((POINT *)rgptPlan + iVar8)->x;
      ord.pt.y = *(short *)((int)&rgptPlan[0].y + iVar8 * 4);
      ord.wFlags = ord.wFlags & 0xe0f0U | 0x1101;
      ord.txp.rgia[3].wFlags = ord.txp.rgia[3].wFlags & 0xfffU | 0x2000;
      ord.id = iVar8;
      ChangeMainObjSel(2,lpfl->id);
      uVar15 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
      pPVar11 = (PLORD *)sel.fl.lpplord;
      if (((pPVar11 + 2)->wFlags == iVar8) && ((*(uint *)&pPVar11[2].iordMax >> 8 & 0xf) == 1)) {
        pPVar11 = pPVar11 + 1;
        pOVar12 = &ord;
        for (iVar8 = 9; iVar8 != 0; iVar8 = iVar8 + -1) {
          pPVar2 = pPVar11;
          pPVar11 = (PLORD *)&pPVar11->iordMax;
          pOVar1 = pOVar12;
          pOVar12 = (ORDER *)&(pOVar12->pt).y;
          pPVar2->wFlags = (pOVar1->pt).x;
        }
      }
      else {
        pbVar13 = &pPVar11[5].iordMax;
        pOVar12 = &ord;
        for (iVar8 = 9; iVar8 != 0; iVar8 = iVar8 + -1) {
          pbVar3 = pbVar13;
          pbVar13 = pbVar13 + 2;
          pOVar1 = pOVar12;
          pOVar12 = (ORDER *)&(pOVar12->pt).y;
          *(short *)pbVar3 = (pOVar1->pt).x;
        }
      }
      FLookupFleet(-1,(FLEET *)&sel.fl);
      FMoveToNearestStarbase(lpfl,0);
      FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
    }
    if (bVar5) {
      lpplDst = LpplFindClosestEnum(lppl,FEnumDropOffStage1);
      if (((PLANET *)lpplDst == (PLANET *)0x0) && ((int)((ulong)lpplDst >> 0x10) == 0)) {
        lpplDst = LpplFindClosestEnum(lppl,FEnumDropOffStage2);
      }
      if (((PLANET *)lpplDst == (PLANET *)0x0) && (lpplDst._2_2_ == 0)) {
        if (pPVar4->iPlayer == idPlayer) {
          XferAiSupply(1,pFVar10->idPlanet,2,lpfl->id,3,-1000);
          FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
          if (((uint)((CYBERINFOTEMP *)lpciPlanTemp + lppl->id)->wInfo1 >> 1 & 3) < 3) {
            iVar9 = ((CYBERINFOTEMP *)lpciPlanTemp + lppl->id)->wInfo1;
            ((CYBERINFOTEMP *)lpciPlanTemp + lppl->id)->wInfo1 =
                 ((CYBERINFOTEMP *)lpciPlanTemp + lppl->id)->wInfo1 & 0xfff9;
            ((CYBERINFOTEMP *)lpciPlanTemp + lppl->id)->wInfo1 =
                 ((CYBERINFOTEMP *)lpciPlanTemp + lppl->id)->wInfo1 | iVar9 + 2U & 6;
          }
        }
      }
      else if (((uint)((CYBERINFOTEMP *)lpciPlanTemp + lpplDst->id)->wInfo1 >> 3 & 3) < 3) {
        iVar9 = ((CYBERINFOTEMP *)lpciPlanTemp + lpplDst->id)->wInfo1;
        ((CYBERINFOTEMP *)lpciPlanTemp + lpplDst->id)->wInfo1 =
             ((CYBERINFOTEMP *)lpciPlanTemp + lpplDst->id)->wInfo1 & 0xffe7;
        ((CYBERINFOTEMP *)lpciPlanTemp + lpplDst->id)->wInfo1 =
             ((CYBERINFOTEMP *)lpciPlanTemp + lpplDst->id)->wInfo1 | iVar9 + 8U & 0x18;
      }
    }
    else {
      lpplDst = LpplFindClosestEnum(lppl,FEnumPickUp);
    }
  }
  if (((PLANET *)lpplDst != (PLANET *)0x0) || (lpplDst._2_2_ != 0)) {
    _memset(&ord,0,0x12);
    ord.pt.x = ((POINT *)rgptPlan + lpplDst->id)->x;
    ord.pt.y = *(short *)((int)&rgptPlan[0].y + lpplDst->id * 4);
    ord.id = lpplDst->id;
    ord.wFlags = ord.wFlags & 0xe0f0U | 0x1100;
    uVar6 = IFindIdealWarp(lpfl,1);
    ord.wFlags = ord.wFlags & 0xff0fU | (uVar6 & 0xf) << 4;
    sVar7 = FMoveAiFleet(lpfl,&ord,0);
    if (sVar7 != 0) {
      pFVar10->wFlags = pFVar10->wFlags & 0x7fffU | 0x8000;
    }
  }
  return;
}



// ======================================================================
// Function: FEnumDropOffStage1
// Address: 10a8:3d00
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a83dde) */

short FEnumDropOffStage1(PLANET *lpplSrc,PLANET *lpplTest)

{
  int iVar1;
  int iVar2;
  short sVar3;
  PLANET *pPVar4;
  undefined2 uVar5;
  long lVar6;
  POINT pt1;
  POINT pt2;
  short dOffsetPlanTemp;
  CYBERINFOTEMP *lpciPlanTemp;
  
  iVar2 = game.cPlanMax * 2 + 2;
  if ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar2) >> 3 & 3) == 3) {
    sVar3 = 0;
  }
  else {
    uVar5 = (undefined2)((ulong)lpplTest >> 0x10);
    pPVar4 = (PLANET *)lpplTest;
    if ((((pPVar4->iPlayer == idPlayer) &&
         (iVar1 = *(int *)((int)pPVar4->rgwtMin + 0xe), iVar1 < 1)) &&
        ((iVar1 < 0 || (*(uint *)(pPVar4->rgwtMin + 3) < 200)))) &&
       ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar2) >> 3 & 3) == 0)) {
      pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
      pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
      pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
      pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
      lVar6 = LDistance2(pt1,pt2);
      if (lVar6 < 0x27101) {
        sVar3 = 1;
      }
      else {
        sVar3 = 0;
      }
    }
    else {
      sVar3 = 0;
    }
  }
  return sVar3;
}



// ======================================================================
// Function: FEnumDropOffStage2
// Address: 10a8:3dfe
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a83edf) */

short FEnumDropOffStage2(PLANET *lpplSrc,PLANET *lpplTest)

{
  int iVar1;
  uint uVar2;
  PLANET *pPVar3;
  undefined2 uVar4;
  long lVar5;
  POINT pt1;
  POINT pt2;
  short dOffsetPlanTemp;
  CYBERINFOTEMP *lpciPlanTemp;
  
  iVar1 = game.cPlanMax * 2 + 2;
  if ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar1) >> 3 & 3) != 3) {
    uVar4 = (undefined2)((ulong)lpplTest >> 0x10);
    pPVar3 = (PLANET *)lpplTest;
    if (pPVar3->iPlayer == idPlayer) {
      uVar2 = (*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar1) >> 3 & 3) * 0xd2;
      iVar1 = *(int *)((int)pPVar3->rgwtMin + 0xe) +
              (uint)CARRY2(uVar2,*(uint *)(pPVar3->rgwtMin + 3));
      if ((iVar1 < 1) && ((iVar1 < 0 || (uVar2 + *(uint *)(pPVar3->rgwtMin + 3) < 1000)))) {
        pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
        pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
        pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
        pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
        lVar5 = LDistance2(pt1,pt2);
        if (160000 < lVar5) {
          return 0;
        }
        return 1;
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: FEnumPickUp
// Address: 10a8:3f00
// Segment: MEMORY_AI4
// ======================================================================


short FEnumPickUp(PLANET *lpplSrc,PLANET *lpplTest)

{
  int iVar1;
  short sVar2;
  PLANET *pPVar3;
  undefined2 uVar4;
  
  uVar4 = (undefined2)((ulong)lpplTest >> 0x10);
  pPVar3 = (PLANET *)lpplTest;
  if ((((pPVar3->iPlayer == idPlayer) &&
       (iVar1 = *(int *)((int)pPVar3->rgwtMin + 0xe), -1 < iVar1)) &&
      ((0 < iVar1 || (0x898 < *(uint *)(pPVar3->rgwtMin + 3))))) &&
     (((uint)pPVar3->wFlags >> 9 & 1) != 0)) {
    sVar2 = 1;
  }
  else {
    sVar2 = 0;
  }
  return sVar2;
}



// ======================================================================
// Function: FEnumNeedMinerals
// Address: 10a8:3f5e
// Segment: MEMORY_AI4
// ======================================================================


short FEnumNeedMinerals(PLANET *lpplSrc,PLANET *lpplTest)

{
  int iVar1;
  POINT pt1;
  POINT pt2;
  int iVar2;
  uint uVar3;
  PLANET *pPVar4;
  undefined2 uVar5;
  bool bVar6;
  bool bVar7;
  short dOffsetPlanTemp;
  CYBERINFOTEMP *lpciPlanTemp;
  short iWarpDst;
  CYBERINFO *lpciPlan;
  short iMinLimit;
  short fTwoMA;
  short iWarpSrc;
  double dDistance;
  
  iVar2 = game.cPlanMax * 2 + 2;
  uVar5 = (undefined2)((ulong)lpplTest >> 0x10);
  if (((((PLANET *)lpplTest)->iPlayer == idPlayer) &&
      (((uint)((PLANET *)lpplTest)->wFlags >> 9 & 1) != 0)) &&
     ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + 2) >> 5 & 3) == 0)) {
    uVar5 = (undefined2)((ulong)lpplSrc >> 0x10);
    pPVar4 = (PLANET *)lpplSrc;
    iVar1 = *(int *)((int)pPVar4->rgwtMin + 2);
    if ((((iVar1 < 0) || ((iVar1 < 1 && (*(uint *)pPVar4->rgwtMin < 0x2bd)))) ||
        ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar2) >> 8 & 1) == 0)) &&
       ((((iVar1 = *(int *)((int)pPVar4->rgwtMin + 6), iVar1 < 0 ||
          ((iVar1 < 1 && (*(uint *)(pPVar4->rgwtMin + 1) < 0x2bd)))) ||
         ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar2) >> 9 & 1) == 0)) &&
        ((iVar1 = *(int *)((int)pPVar4->rgwtMin + 10), iVar1 < 0 ||
         (((iVar1 < 1 && (*(uint *)(pPVar4->rgwtMin + 2) < 0x2bd)) ||
          ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + iVar2) >> 10 & 1) == 0))))))))
    {
      uVar3 = 0;
    }
    else {
      iWarpSrc = IWarpMAFromLppl(lpplSrc,&fTwoMA);
      if (fTwoMA != 0) {
        iWarpSrc = iWarpSrc + 1;
      }
      iWarpDst = IWarpMAFromLppl(lpplTest,&fTwoMA);
      if (fTwoMA != 0) {
        iWarpDst = iWarpDst + 1;
      }
      iVar2 = iWarpSrc;
      if (iWarpDst <= iWarpSrc) {
        iVar2 = iWarpDst;
      }
      _dDistance = DOUBLE_3_5__1120_1e56 * (double)(long)iVar2 * (double)(long)iVar2;
      pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
      pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
      pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
      pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
      LDistance2(pt1,pt2);
      bVar6 = (undefined1 *)0xfff7 < &stack0xffc4;
      bVar7 = &stack0x0000 == (undefined1 *)((int)(ulong *)rgcrPlrHistory + 6);
      __aFfcompp();
      uVar3 = (uint)(bVar6 || bVar7);
    }
  }
  else {
    uVar3 = 0;
  }
  return uVar3;
}



// ======================================================================
// Function: FEnumPktAttack
// Address: 10a8:4204
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a84586) */

short FEnumPktAttack(PLANET *lpplSrc,PLANET *lpplTest)

{
  double dVar1;
  double dVar2;
  short sVar3;
  undefined1 extraout_AH;
  PLANET *pPVar4;
  int iVar5;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar6;
  bool bVar7;
  bool bVar8;
  long lVar9;
  long lVar10;
  int in_stack_0000ffbc;
  undefined2 in_stack_0000ffbe;
  double dDistanceTgt;
  short dOffsetPlanTemp;
  short iWarpDst;
  CYBERINFO *lpciPlan;
  long lMinNeeded;
  long lMineral;
  long *plMinMax;
  short iWarp;
  double dMod;
  short fTwoMA;
  double dDistance;
  
  iWarpDst = 0;
  uVar6 = (undefined2)((ulong)lpplTest >> 0x10);
  pPVar4 = (PLANET *)lpplTest;
  if ((((pPVar4->iPlayer == idPlayer) || (pPVar4->iPlayer == -1)) ||
      ((*(uint *)((byte *)vlpbAiData + lpplTest->id * 2 + 2) >> 5 & 3) != 0)) ||
     (sVar3 = GetRaceStat((PLAYER *)rgplr + pPVar4->iPlayer,rsMajorAdv),
     sVar3 == raMacintosh)) {
    sVar3 = 0;
  }
  else {
    if (((uint)pPVar4->wFlags >> 9 & 1) != 0) {
      iVar5 = pPVar4->iPlayer * 4;
      if ((*(uint *)(*(int *)(iVar5 + 0x14c) + (*(uint *)&pPVar4->field11_0x2c & 0xf) * 0x93 + 0x7b)
          & 0xff) != 7) {
        return 0;
      }
      iWarpDst = IWarpMAFromLppl(lpplTest,&fTwoMA);
      if (fTwoMA != 0) {
        iWarpDst = iWarpDst + 1;
      }
    }
    sVar3 = IWarpMAFromLppl(lpplSrc,&fTwoMA);
    _dDistance = (double)(long)(sVar3 + 3);
    if (sVar3 + 3 == iWarpDst) {
      sVar3 = 0;
    }
    else {
      _dDistance = _dDistance * _dDistance;
      dVar2 = DGetDistance(((POINT *)rgptPlan + lpplSrc->id)->x,
                                 *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4),
                                 ((POINT *)rgptPlan + lpplTest->id)->x,
                                 *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4));
      bVar7 = (undefined1 *)0xfff7 < &stack0xffb0;
      bVar8 = &stack0x0000 == (undefined1 *)((int)(ulong *)rgcrPlrHistory + 0x1a);
      dVar1 = *(double *)CONCAT11(extraout_AH,dVar2);
      __aFfcompp();
      if (bVar7 || bVar8) {
        if (fTwoMA == 0) {
          dVar1 = dVar1 / _dDistance;
          _pow(SUB84(DOUBLE_0_75__1120_1e3e,0),
                       (double)CONCAT26((int)((qword)dVar1 >> 0x10),
                                        CONCAT24(SUB82(dVar1,0),
                                                 (long)((qword)DOUBLE_0_75__1120_1e3e >> 0x20))),
                       (double)CONCAT26(unaff_SI,CONCAT24(unaff_DI,(long)((qword)dVar1 >> 0x20))));
          lVar9 = __ftol((double)CONCAT26(in_stack_0000ffbe,
                                                  CONCAT24(in_stack_0000ffbc,
                                                           CONCAT22(unaff_SI,unaff_DI))));
        }
        else {
          dVar1 = dVar1 / _dDistance;
          _pow(SUB84(DOUBLE_0_875__1120_1e36,0),
                       (double)CONCAT26((int)((qword)dVar1 >> 0x10),
                                        CONCAT24(SUB82(dVar1,0),
                                                 (long)((qword)DOUBLE_0_875__1120_1e36 >> 0x20))),
                       (double)CONCAT26(unaff_SI,CONCAT24(unaff_DI,(long)((qword)dVar1 >> 0x20))));
          lVar9 = __ftol((double)CONCAT26(in_stack_0000ffbe,
                                                  CONCAT24(in_stack_0000ffbc,
                                                           CONCAT22(unaff_SI,unaff_DI))));
        }
        if (((uint)pPVar4->uGuesses >> 0xc < 100) && ((pPVar4->uGuesses & 0xfffU) != 0)) {
          if (((pPVar4->uGuesses & 0xfffU) + 0x19) * 4 < 0x3e9) {
            in_stack_0000ffbc = ((pPVar4->uGuesses & 0xfffU) + 0x19) * 4;
            in_stack_0000ffbe = 0;
          }
          lVar10 = __ftol((double)CONCAT26(in_stack_0000ffbe,
                                                   CONCAT24(in_stack_0000ffbc,
                                                            CONCAT22(unaff_SI,unaff_DI))));
          if (lVar9 < lVar10) {
            sVar3 = 0;
          }
          else {
            sVar3 = 1;
          }
        }
        else {
          sVar3 = 0;
        }
      }
      else {
        sVar3 = 0;
      }
    }
  }
  return sVar3;
}



// ======================================================================
// Function: FEnumCalcEnemyPlanets
// Address: 10a8:45a6
// Segment: MEMORY_AI4
// ======================================================================


short FEnumCalcEnemyPlanets(PLANET *lpplSrc,PLANET *lpplTest)

{
  short sVar1;
  undefined2 uVar2;
  
  uVar2 = (undefined2)((ulong)lpplTest >> 0x10);
  if ((((PLANET *)lpplTest)->iPlayer == idPlayer) || (((PLANET *)lpplTest)->iPlayer == -1)) {
    sVar1 = 0;
  }
  else {
    sVar1 = 1;
  }
  return sVar1;
}



// ======================================================================
// Function: iBuildCyberStarbase
// Address: 10a8:45de
// Segment: MEMORY_AI4
// ======================================================================


short iBuildCyberStarbase(PLANET *lppl)

{
  int iVar1;
  short sVar2;
  PLANET *pPVar3;
  undefined2 uVar4;
  PROD rgprod [64];
  short ishdefSB;
  
  uVar4 = (undefined2)((ulong)lppl >> 0x10);
  pPVar3 = (PLANET *)lppl;
  if (((((uint)pPVar3->wFlags >> 9 & 1) == 0) &&
      (sVar2 = PctPlanetDesirability(lppl,idPlayer), 0xe < sVar2)) &&
     ((iVar1 = *(int *)((int)pPVar3->rgwtMin + 0xe), 0 < iVar1 ||
      ((-1 < iVar1 && (499 < *(uint *)(pPVar3->rgwtMin + 3))))))) {
    ChangeMainObjSel(1,lppl->id);
    InitProduction(rgprod);
    if ((pPVar3->rgMinConc[0] < 0x10) ||
       ((pPVar3->rgMinConc[1] < 0x10 || (pPVar3->rgMinConc[2] < 0x10)))) {
      sVar2 = IshdefAiSBLatestOF();
    }
    else {
      sVar2 = IshdefAiSBLatest();
    }
  }
  else {
    sVar2 = -1;
  }
  return sVar2;
}



// ======================================================================
// Function: EnsureCyberAiShdefs
// Address: 10a8:4826
// Segment: MEMORY_AI4
// ======================================================================


void EnsureCyberAiShdefs(short iroCur)

{
  SHDEF *pSVar1;
  SHDEF *pSVar2;
  short sVar3;
  int iVar4;
  SHDEF *pSVar5;
  SHDEF *pSVar6;
  undefined *puVar7;
  undefined2 unaff_SS;
  byte *pbVar8;
  SHDEF shdef;
  short high;
  short i;
  short ishCur;
  short ish;
  short low;
  
  puVar7 = (undefined *)&DAT_1120_10a8;
  if (((((((uint)rgshdef[0].wFlags >> 9 & 1) == 0) &&
        (rgshdef[0].hul.ihuldef != ihuldefFrigate)) &&
       (1 < (*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7))) &&
      (((int)rgshdef[0].cExist == 0 && (rgshdef[0].cExist._2_2_ == 0)))) &&
     (5 < (uint)game.turn)) {
    pSVar5 = (SHDEF *)rgshdef;
    pSVar6 = &shdef;
    for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
      pSVar2 = pSVar6;
      pSVar6 = (SHDEF *)(pSVar6->hul).rgTech;
      pSVar1 = pSVar5;
      pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
      (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
    }
    *(char *)&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
    shdef.wFlags = shdef.wFlags & 0xfdffU | 0x200;
    puVar7 = (undefined *)&DAT_1120_1090;
    FChangeAiShdef(&shdef,0);
  }
  if (((uint)rgshdef[0].wFlags >> 9 & 1) != 0) {
    pbVar8 = (byte *)CONCAT22(puVar7,(byte *)vrgCyberAip + vrgCyberIshAip[0xc]);
    puVar7 = (undefined *)&DAT_1120_1090;
    FCreateAiShdef(0,5,pbVar8);
  }
  if ((((uint)rgshdef[4].wFlags >> 9 & 1) != 0) && (0x1e < (uint)game.turn)) {
    if ((uint)game.turn < 0x4c) {
      pbVar8 = (byte *)CONCAT22(puVar7,(byte *)vrgCyberAip + vrgCyberIshAip[0]);
      puVar7 = (undefined *)&DAT_1120_1090;
      sVar3 = FCreateAiShdef(4,6,pbVar8);
      if (sVar3 != 0) goto LAB_10a8_497e;
    }
    for (i = 5; 0 < i; i = i + -1) {
      sVar3 = Random(i);
      puVar7 = (undefined *)&DAT_1120_1090;
      sVar3 = FCreateAiShdef(4,6,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                       (byte *)vrgCyberAip +
                                                       ((ushort *)vrgCyberIshAip)[sVar3]));
      if (sVar3 != 0) break;
    }
  }
LAB_10a8_497e:
  if (((((uint)rgshdef[5].wFlags >> 9 & 1) != 0) &&
      (((uint)rgshdef[4].wFlags >> 9 & 1) == 0)) &&
     (rgshdef[4].turn + 0x14U < (uint)game.turn)) {
    if ((uint)game.turn < 0x4c) {
      pbVar8 = (byte *)CONCAT22(puVar7,(byte *)vrgCyberAip + vrgCyberIshAip[5]);
      puVar7 = (undefined *)&DAT_1120_1090;
      sVar3 = FCreateAiShdef(5,6,pbVar8);
      if (sVar3 != 0) goto LAB_10a8_4a2f;
    }
    for (i = 5; 0 < i; i = i + -1) {
      sVar3 = Random(i);
      puVar7 = (undefined *)&DAT_1120_1090;
      sVar3 = FCreateAiShdef(5,6,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                       (byte *)vrgCyberAip +
                                                       ((ushort *)vrgCyberIshAip)[sVar3 + 5]));
      if (sVar3 != 0) break;
    }
  }
LAB_10a8_4a2f:
  if ((((uint)rgshdef[2].wFlags >> 9 & 1) != 0) && (0x14 < (uint)game.turn)) {
    pbVar8 = (byte *)CONCAT22(puVar7,(byte *)vrgCyberAip + vrgCyberIshAip[10]);
    puVar7 = (undefined *)&DAT_1120_1090;
    FCreateAiShdef(2,0xb,pbVar8);
  }
  if (((((uint)rgshdef[3].wFlags >> 9 & 1) != 0) &&
      (((uint)rgshdef[2].wFlags >> 9 & 1) == 0)) &&
     (rgshdef[2].turn + 0x14U < (uint)game.turn)) {
    pbVar8 = (byte *)CONCAT22(puVar7,(byte *)vrgCyberAip + vrgCyberIshAip[0xb]);
    puVar7 = (undefined *)&DAT_1120_1090;
    FCreateAiShdef(3,0xb,pbVar8);
  }
  for (ish = 6; ish < 0xb; ish = ish + 4) {
    if (((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) &&
       (((ish == 6 && (0x28 < (uint)game.turn)) ||
        ((((uint)rgshdef[6].wFlags >> 9 & 1) == 0 &&
         (rgshdef[6].turn + 0x1eU < (uint)game.turn)))))) {
      ishCur = ish + 2;
      for (i = 3; 0 < i; i = i + -1) {
        sVar3 = Random(i);
        puVar7 = (undefined *)&DAT_1120_1090;
        sVar3 = FCreateAiShdef(ishCur,0x1d,
                                    (byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                     (byte *)vrgCyberAip +
                                                     ((ushort *)vrgCyberIshAip)[sVar3 + 0x21]));
        if (sVar3 != 0) {
          ishCur = ish + 1;
          break;
        }
      }
      for (i = 4; 0 < i; i = i + -1) {
        sVar3 = Random(i);
        puVar7 = (undefined *)&DAT_1120_1090;
        sVar3 = FCreateAiShdef(ishCur,9,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                              (byte *)vrgCyberAip +
                                                              ((ushort *)vrgCyberIshAip)
                                                              [sVar3 + 0x1d]));
        if (sVar3 != 0) {
          ishCur = ishCur + -1;
          break;
        }
      }
      for (i = 3; 0 < i; i = i + -1) {
        sVar3 = Random(i);
        puVar7 = (undefined *)&DAT_1120_1090;
        sVar3 = FCreateAiShdef(ishCur,9,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                              (byte *)vrgCyberAip +
                                                              ((ushort *)vrgCyberIshAip)
                                                              [sVar3 + 0x1a]));
        if (sVar3 != 0) {
          ishCur = ishCur + -1;
          break;
        }
      }
      if (ish <= ishCur) {
        high = (ishCur - ish) * -3 + 9;
        low = 0x1a - high;
AI4_LCruiser:
        for (i = high; 0 < i; i = i + -1) {
          sVar3 = Random(i);
          puVar7 = (undefined *)&DAT_1120_1090;
          sVar3 = FCreateAiShdef(ishCur,7,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                                (byte *)vrgCyberAip +
                                                                ((ushort *)vrgCyberIshAip)
                                                                [sVar3 + low]));
          if (sVar3 != 0) break;
        }
        ishCur = ishCur + -1;
        if (ish <= ishCur) {
          high = 3;
          if (ishCur == ish) {
            low = 0x11;
          }
          else {
            low = 0x14;
          }
          goto AI4_LCruiser;
        }
      }
      pbVar8 = (byte *)CONCAT22(puVar7,(byte *)vrgCyberAip + vrgCyberIshAip[0x10]);
      puVar7 = (undefined *)&DAT_1120_1090;
      sVar3 = FCreateAiShdef(ish + 3,0x1d,pbVar8);
      if (sVar3 == 0) {
        puVar7 = (undefined *)&DAT_1120_1090;
        sVar3 = FCreateAiShdef(ish + 3,9,
                                    (byte *)CONCAT22((undefined *)&DAT_1120_1090,
                                                     (byte *)vrgCyberAip + vrgCyberIshAip[0xf]));
        if (sVar3 == 0) {
          puVar7 = (undefined *)&DAT_1120_1090;
          sVar3 = FCreateAiShdef(ish + 3,0x13,
                                      (byte *)CONCAT22((undefined *)&DAT_1120_1090,
                                                       (byte *)vrgCyberAip + vrgCyberIshAip[0xe]));
          if (sVar3 == 0) {
            puVar7 = (undefined *)&DAT_1120_1090;
            FCreateAiShdef(ish + 3,0x13,
                                (byte *)CONCAT22((undefined *)&DAT_1120_1090,
                                                 (byte *)vrgCyberAip + vrgCyberIshAip[0xd]));
          }
        }
      }
    }
  }
  ish = 0xe;
  do {
    if (0xf < ish) {
      return;
    }
    if (((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) &&
       (((ish == 0xe && (0x1e < (uint)game.turn)) ||
        ((((uint)rgshdef[0xe].wFlags >> 9 & 1) == 0 &&
         (rgshdef[0xe].turn + 0x14U < (uint)game.turn)))))) {
      for (i = 7; 0 < i; i = i + -1) {
        sVar3 = Random(i);
        sVar3 = FCreateAiShdef(ish,9,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                           (byte *)vrgCyberAip +
                                                           ((ushort *)vrgCyberIshAip)[sVar3 + 0x1a])
                                   );
        if (sVar3 != 0) break;
      }
      if (i == 0) {
        for (i = 9; 0 < i; i = i + -1) {
          sVar3 = Random(i);
          sVar3 = FCreateAiShdef(ish,7,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                             (byte *)vrgCyberAip +
                                                             ((ushort *)vrgCyberIshAip)
                                                             [sVar3 + 0x11]));
          if (sVar3 != 0) break;
        }
      }
      if (i == 0) {
        for (i = 10; 0 < i; i = i + -1) {
          sVar3 = Random(i);
          sVar3 = FCreateAiShdef(ish,6,(byte *)CONCAT22((undefined *)&DAT_1120_1040,
                                                             (byte *)vrgCyberAip +
                                                             ((ushort *)vrgCyberIshAip)[sVar3]));
          if (sVar3 != 0) break;
        }
      }
    }
    ish = ish + 1;
  } while( true );
}



// ======================================================================
// Function: iAddAttackFleet
// Address: 10a8:4eba
// Segment: MEMORY_AI4
// ======================================================================


short iAddAttackFleet
          (PLANET *lppl,short iAttackStr,short iBestDestroyer,short iBestBattle,
          short iBestSBDefender)

{
  short sVar1;
  short sVar2;
  short sVar3;
  int iVar4;
  int iVar5;
  short iRand;
  short iMaxMines;
  short iMaxFactories;
  short fRet;
  
  sVar1 = Random(100);
  sVar2 = CMaxOperableMines(lppl,idPlayer,0);
  sVar3 = CMinesOperating(lppl);
  if ((uint)(sVar2 - sVar3) < 0x8000) {
    sVar2 = CMaxOperableMines(lppl,idPlayer,0);
    sVar3 = CMinesOperating(lppl);
    iVar4 = sVar2 - sVar3;
  }
  else {
    iVar4 = 0;
  }
  sVar2 = CMaxOperableFactories(lppl,idPlayer,0);
  sVar3 = CFactoriesOperating(lppl);
  if ((uint)(sVar2 - sVar3) < 0x8000) {
    sVar2 = CMaxOperableFactories(lppl,idPlayer,0);
    sVar3 = CFactoriesOperating(lppl);
    iVar5 = sVar2 - sVar3;
  }
  else {
    iVar5 = 0;
  }
  sVar2 = Random(100);
  if ((iVar4 < 100) || (iVar5 < 100)) {
    iVar4 = 0x5a;
  }
  else {
    iVar4 = 0x3c;
  }
  if (sVar2 < iVar4) {
    sVar1 = 0;
  }
  else if ((iBestBattle == -1) || (sVar1 < 0x33)) {
    if ((iBestSBDefender == -1) || (sVar1 < 0x1a)) {
      if (iBestDestroyer == -1) {
        sVar1 = 0;
      }
      else {
        AddItemToQueue(iBestDestroyer,1,grobjFleet,1);
        sVar1 = 3;
      }
    }
    else {
      AddItemToQueue(iBestSBDefender,1,grobjFleet,1);
      sVar1 = 2;
    }
  }
  else {
    if ((*(uint *)((int)&rgshdef[0].wFlags + (iBestBattle * 4 + 6) * 0x93) >> 9 & 1) == 0)
    {
      AddItemToQueue(iBestBattle * 4 + 6,2,grobjFleet,1);
    }
    if ((*(uint *)((int)&rgshdef[0].wFlags + (iBestBattle * 4 + 7) * 0x93) >> 9 & 1) == 0)
    {
      AddItemToQueue(iBestBattle * 4 + 7,2,grobjFleet,1);
    }
    if (((*(uint *)((int)&rgshdef[0].wFlags + (iBestBattle * 4 + 8) * 0x93) >> 9 & 1) == 0
        ) && (sVar1 = Random(100), sVar1 < 0x4b)) {
      AddItemToQueue(iBestBattle * 4 + 8,1,grobjFleet,1);
    }
    if (((*(uint *)((int)&rgshdef[0].wFlags + (iBestBattle * 4 + 9) * 0x93) >> 9 & 1) == 0
        ) && (sVar1 = Random(100), sVar1 < 0x32)) {
      AddItemToQueue(iBestBattle * 4 + 9,1,grobjFleet,1);
    }
    sVar1 = 1;
  }
  return sVar1;
}



// ======================================================================
// Function: TargetCyberArmada
// Address: 10a8:51a4
// Segment: MEMORY_AI4
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10a85203) */

void TargetCyberArmada(FLEET *lpfl)

{
  short *psVar1;
  ORDER *pOVar2;
  undefined2 uVar3;
  POINT pt1;
  POINT pt2;
  PLANET *pPVar4;
  int iVar5;
  short sVar6;
  int iVar7;
  FLEET *pFVar8;
  short *psVar9;
  ORDER *pOVar10;
  undefined2 uVar11;
  undefined2 unaff_SS;
  long lVar12;
  PLANET *pPVar13;
  FLEET *pFVar14;
  PLANET *lpplTarget;
  short cshWar;
  short cshBomb;
  PLANET *lppl;
  ORDER ord;
  FLEET *lpflTarget;
  
  uVar11 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar8 = (FLEET *)lpfl;
  if (1 < pFVar8->cord) {
    uVar3 = *(undefined2 *)((int)&pFVar8->lpplord + 2);
    psVar9 = (short *)(*(int *)&pFVar8->lpplord + 0x16);
    pOVar10 = &ord;
    for (iVar7 = 9; iVar7 != 0; iVar7 = iVar7 + -1) {
      pOVar2 = pOVar10;
      pOVar10 = (ORDER *)&(pOVar10->pt).y;
      psVar1 = psVar9;
      psVar9 = psVar9 + 1;
      (pOVar2->pt).x = *psVar1;
    }
    pt1.y = (pFVar8->pt).y;
    pt1.x = (&pFVar8->pt)->x;
    pt2.y = ord.pt.y;
    pt2.x = ord.pt.x;
    lVar12 = LDistance2(pt1,pt2);
    if ((lVar12 < 0xf425) || (((uint)ord.wFlags >> 8 & 0xf) != 2)) {
      if (((uint)ord.wFlags >> 8 & 0xf) == 2) {
        return;
      }
      if (((uint)ord.wFlags >> 8 & 0xf) == 1) {
        pPVar13 = LpplFromId(ord.id);
        iVar7 = (int)((ulong)pPVar13 >> 0x10);
        pPVar4 = (PLANET *)pPVar13;
        if ((pPVar4 == (PLANET *)0x0) && (iVar7 == 0)) {
          return;
        }
        if (pPVar4->iPlayer != -1) {
          if (pPVar4->iPlayer != idPlayer) {
            return;
          }
          if (((uint)pPVar4->wFlags >> 9 & 1) != 0) {
            return;
          }
        }
        if (pPVar4->turn != game.turn) {
          return;
        }
      }
    }
  }
  iVar7 = pFVar8->rgcsh[6] + pFVar8->rgcsh[7] + pFVar8->rgcsh[8] * 2 + pFVar8->rgcsh[10] +
          pFVar8->rgcsh[0xb] + pFVar8->rgcsh[0xc] * 2;
  iVar5 = pFVar8->rgcsh[9] + pFVar8->rgcsh[0xd];
  pFVar8->wFlags = pFVar8->wFlags & 0x7fffU | 0x8000;
  ChangeMainObjSel(2,lpfl->id);
  if (pFVar8->idPlanet == -1) {
    MoveToNearestPlanetOrEnemy(lpfl,0x1c2);
    return;
  }
  pPVar13 = LpplFromId(pFVar8->idPlanet);
  uVar11 = (undefined2)((ulong)pPVar13 >> 0x10);
  if (((PLANET *)pPVar13)->iPlayer == idPlayer) {
    if ((iVar7 < (int)(uint)vrgAiArmadaPotency[0]) ||
       (iVar5 < (int)(uint)vrgAiArmadaPotency[2])) {
      if ((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) < 2) {
        return;
      }
      if ((iVar7 <= (int)((uint)vrgAiArmadaPotency[0] * 2)) && (iVar7 < 0x3c)) {
        return;
      }
      sVar6 = Random(10);
      if ((4 < sVar6) &&
         ((iVar7 <= (int)((uint)vrgAiArmadaPotency[0] * 3) ||
          (sVar6 = Random(10), 6 < sVar6)))) {
        if (iVar7 < 0x79) {
          return;
        }
        sVar6 = Random(10);
        if (6 < sVar6) {
          return;
        }
      }
    }
  }
  else if ((iVar7 < (int)(uint)vrgAiArmadaPotency[1]) ||
          (iVar5 < (int)(uint)vrgAiArmadaPotency[3])) {
    ClearAiCurrentTask(lpfl,0);
    if (((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) < 2) ||
       ((((iVar7 <= (int)((uint)vrgAiArmadaPotency[0] * 2) ||
          (sVar6 = Random(10), 4 < sVar6)) &&
         ((iVar7 <= (int)((uint)vrgAiArmadaPotency[0] * 4) ||
          (sVar6 = Random(10), 6 < sVar6)))) &&
        ((iVar7 < 0x79 || (sVar6 = Random(10), 6 < sVar6)))))) {
      lpplTarget = LpplFindClosestEnum(pPVar13,FEnumOurStarbase);
      goto AI4_TargetEveryArmada_2;
    }
  }
  else if (((PLANET *)pPVar13)->iPlayer != -1) {
    return;
  }
  if (((uint)game.wCrap >> 4 & 1) == 0) {
    lpplTarget = (PLANET *)0x0;
  }
  else {
    lpplTarget = LpplFindBestEnum(pPVar13,FEnumCalcArmadaHumanDest);
  }
  if (((PLANET *)lpplTarget == (PLANET *)0x0) && (lpplTarget._2_2_ == 0)) {
    lpplTarget = LpplFindBestEnum(pPVar13,FEnumCalcArmadaDest);
  }
AI4_TargetEveryArmada_2:
  if (((PLANET *)lpplTarget == (PLANET *)0x0) && (lpplTarget._2_2_ == 0)) {
    pFVar14 = LpflFindClosestEnum(lpfl,FEnumCalcEnemyFleets);
    iVar7 = (int)((ulong)pFVar14 >> 0x10);
    pFVar8 = (FLEET *)pFVar14;
    if ((pFVar8 == (FLEET *)0x0) && (iVar7 == 0)) {
      return;
    }
    ord.id = pFVar14->id;
    ord.wFlags = ord.wFlags & 0xf0ffU | 0x200;
    ord.pt.x = (&pFVar8->pt)->x;
    ord.pt.y = (pFVar8->pt).y;
  }
  else {
    ((byte *)vlpbAiPlanet)[lpplTarget->id * 0x10 + 10] =
         ((byte *)vlpbAiPlanet)[lpplTarget->id * 0x10 + 10] | 0x80;
    ord.id = lpplTarget->id;
    ord.wFlags = ord.wFlags & 0xf0ffU | 0x100;
    ord.pt.x = ((POINT *)rgptPlan + lpplTarget->id)->x;
    ord.pt.y = *(short *)((int)&rgptPlan[0].y + lpplTarget->id * 4);
  }
  ord.wFlags = ord.wFlags & 0xef00U | 0x1040;
  FMoveAiFleet(lpfl,&ord,0);
  return;
}



