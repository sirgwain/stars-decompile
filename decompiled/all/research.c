// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: ResearchDlg
// Address: 10d8:0000
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short ResearchDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  long lVar1;
  short sVar2;
  char *pcVar3;
  HWND HVar4;
  UINT UVar5;
  uint uVar6;
  HBRUSH HVar7;
  ushort unaff_SI;
  ushort unaff_DI;
  undefined2 unaff_SS;
  bool bVar8;
  DWORD DVar9;
  ulong uVar10;
  LRESULT LVar11;
  POINT *in_stack_0000ffa4;
  undefined2 in_stack_0000ffa6;
  HDC HVar12;
  ushort in_stack_0000ffac;
  RECT rcWindow;
  char *psz;
  HFONT hfontSav;
  PLANET *lpplMac;
  undefined2 local_42;
  short c;
  PLANET *lppl;
  short dxCurrent;
  HWND pt;
  HDC hdc;
  RECT rc;
  short dx;
  PAINTSTRUCT ps;
  short i;
  short y;
  HDC hdc__6;
  
  if (message == WM_PAINT) {
    hdc__6 = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
    DrawResearchDlg(hwnd,hdc__6,&rc,-1);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
    HVar7 = 1;
    lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
    goto LAB_10d8_0901;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(RECT *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    HVar7 = 1;
    lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
    goto LAB_10d8_0901;
  }
  if (message == WM_CTLCOLOR) {
    for (i = 0x431; i < 0x437; i = i + 1) {
      hdc = (HDC)lParam;
      HVar4 = GetDlgItem(hwnd,i);
      if (hdc == HVar4) break;
    }
    if ((i < 0x437) ||
       (uVar10 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffac), (int)uVar10 == 6)
       ) {
      SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
      HVar7 = hbrButtonFace;
      lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
      goto LAB_10d8_0901;
    }
  }
  else {
    if (message == WM_SETCURSOR) {
      in_stack_0000ffa4 = (POINT *)&stack0xffc8;
      in_stack_0000ffa6 = unaff_SS;
      GetCursorPos((POINT *)CONCAT22(unaff_SS,in_stack_0000ffa4));
      ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,(POINT *)&stack0xffc8));
      if ((((0xc < (int)pt) && ((int)pt < dxResLeft + -0xc)) &&
          (yTopFutureTech <= (int)hdc)) &&
         ((int)hdc < cFutureTech * dyArial8 + yTopFutureTech)) {
        setcursor(hcurArrowHelp);
        HVar7 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
      if (((yTopTechNote != -1) && (yTopTechNote <= (int)hdc)) &&
         (((int)hdc < dyArial8 * 2 + yTopTechNote &&
          (dxResLeft < (int)pt)))) {
        setcursor(hcurArrowHelp);
        HVar7 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        pctResGlob =
             (short)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0);
        iResTechNow =
             (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf;
        CheckRadioButton(hwnd,0x431,0x436,iResTechNow + 0x431);
        hdc = GetDC(hwnd);
        hfontSav = SelectObject(hdc,rghfontArial8[1]);
        c = CchGetString(idsCurrent,(char *)szWork);
        DVar9 = GetTextExtent(hdc,szWork,c);
        dxCurrent = (short)DVar9;
        dxResRadio = 0;
        for (i = 0x431; i < 0x437; i = i + 1) {
          c = CchGetString(i - idsGoose,(char *)szWork);
          DVar9 = GetTextExtent(hdc,szWork,c);
          dx = (short)DVar9;
          sVar2 = dx;
          if (dx <= dxResRadio) {
            sVar2 = dxResRadio;
          }
          dxResRadio = sVar2;
          pt = GetDlgItem(hwnd,i);
          SetWindowText(pt,szWork);
          SendMessage(pt,0x30,rghfontArial8[1],0);
        }
        dxResRadio = dxResRadio + 0x40;
        y = (dyArial8 * 4 - (dyArial8 >> 1)) + 1;
        for (i = 0x431; i < 0x437; i = i + 1) {
          pt = GetDlgItem(hwnd,i);
          SetWindowPos(pt,0,0x10,y,dxResRadio,(dyArial8 * 3) / 2,0x44);
          y = y + (dyArial8 * 3) / 2;
        }
        pt = GetDlgItem(hwnd,0x43b);
        for (i = 0; i < 8; i = i + 1) {
          psz = PszGetCompressedString(i + idsSameField);
          SendMessage(pt,0x403,0,(LPARAM)CONCAT22(0x1120,psz));
        }
        i = (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) >> 4;
        if (i == 6) {
          i = 0;
        }
        else if (i < 6) {
          i = i + 1;
        }
        SendMessage(pt,0x40e,i,0);
        dxResLeft = dxResRadio + dxCurrent + 0x28;
        dxResRight = 0;
        for (i = 0x4c; i < 0x52; i = i + 1) {
          c = CchGetString(i,(char *)szWork);
          DVar9 = GetTextExtent(hdc,szWork,c);
          dx = (short)DVar9;
          sVar2 = dx;
          if (dx <= dxResRight) {
            sVar2 = dxResRight;
          }
          dxResRight = sVar2;
        }
        dxResStrRight = dxResRight;
        HVar12 = hdc;
        pcVar3 = PszGetCompressedString(idsN9999992);
        DVar9 = GetTextExtent(HVar12,(LPCSTR)CONCAT22(0x1120,pcVar3),7);
        dx = (short)DVar9;
        dxResRight = dxResRight + dx + 0x30;
        y = y + dyArial8 * 10;
        HVar4 = GetDlgItem(hwnd,2);
        SetWindowPos(HVar4,0,dxResLeft + dxResRight + -0x98,
                     (y - (dyArial8 * 3) / 2) + -8,0x46,(dyArial8 * 3) / 2,0x44)
        ;
        HVar4 = GetDlgItem(hwnd,0x76);
        SetWindowPos(HVar4,0,dxResLeft + dxResRight + -0x4c,
                     (y - (dyArial8 * 3) / 2) + -8,0x46,(dyArial8 * 3) / 2,0x44)
        ;
        GetWindowRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rcWindow));
        GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
        SetWindowPos(hwnd,0,0,0,
                     ((dxResLeft + dxResRight + rcWindow.right) - rcWindow.left)
                     - rc.right,((y + rcWindow.bottom) - rcWindow.top) - rc.bottom,6);
        StickyDlgPos(hwnd,(POINT *)&ptStickyResDlg,1);
        SelectObject(hdc,hfontSav);
        ReleaseDC(hwnd,hdc);
        lResTotal._0_2_ = 0;
        lResTotal._2_2_ = 0;
        lpplMac = (PLANET *)lpPlanets + cPlanet;
        local_42 = lpPlanets._2_2_;
        lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
        while ((PLANET *)lppl < lpplMac) {
          if (((PLANET *)lppl)->iPlayer == idPlayer) {
            uVar6 = CResourcesAtPlanet(lppl,idPlayer);
            bVar8 = CARRY2((uint)lResTotal,uVar6);
            lResTotal._0_2_ = (uint)lResTotal + uVar6;
            lResTotal._2_2_ =
                 lResTotal._2_2_ + ((int)uVar6 >> 0xf) + (uint)bVar8;
          }
          lppl = (PLANET *)CONCAT22(lppl._2_2_,(PLANET *)lppl + 1);
        }
        lResBudget = ProjectedResearchSpending((long)pctResGlob);
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        HVar7 = 1;
        lVar1 = lResBudget;
        goto LAB_10d8_0901;
      }
      if (message != WM_COMMAND) {
        if ((message == WM_LBUTTONDOWN) || (message == WM_LBUTTONDBLCLK)) {
          uVar10 = __aFulshr(CONCAT22(unaff_DI,wParam),unaff_SI);
          HVar7 = FTrackResearchDlg(hwnd,(HDC)lParam,(short)uVar10,wParam);
          lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
          goto LAB_10d8_0901;
        }
        goto LAB_10d8_08fb;
      }
    }
    uVar10 = __aFulshr((ulong)CONCAT22(in_stack_0000ffa6,in_stack_0000ffa4),unaff_DI);
    if ((((int)uVar10 == 0) && (0x430 < wParam)) && (wParam < 0x437)) {
      UVar5 = IsDlgButtonChecked(hwnd,wParam);
      if (UVar5 != 0) {
        iResTechNow = wParam - 0x431;
        GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
        DrawResearchDlg(hwnd,0,&rc,4);
      }
    }
    else {
      if (wParam == 2) {
        pt = 0;
        HVar4 = GetDlgItem(hwnd,0x43b);
        LVar11 = SendMessage(HVar4,0x407,0,0);
        hdc = (HDC)LVar11;
        if (hdc == 0) {
          hdc = 6;
        }
        else if ((int)hdc < 7) {
          hdc = hdc - 1;
        }
        if (((iResTechNow !=
              ((int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xfU))
            || (hdc != (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) >>
                       4)) ||
           (pctResGlob !=
            *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0))) {
          *(undefined1 *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) =
               (char)pctResGlob;
          *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
               *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
               (byte)iResTechNow;
          dxCurrent = hdc << 4;
          uVar6 = (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) &
                  0xff0fU | dxCurrent;
          lppl = (PLANET *)CONCAT22(uVar6,(PLANET *)lppl);
          *(undefined1 *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) = (char)uVar6;
          i = *(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) * 0x100 +
              pctResGlob;
          WriteMemRt(0x22,2,&i);
          pt = 1;
          if ((((uint)gd.grBits >> 0xb & 1) != 0) && (idPlayer == 0)) {
            tutor.wFlags = tutor.wFlags & 0xfffbU | 4;
            AdvanceTutor();
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyResDlg,0);
        EndDialog(hwnd,pt);
        pctResGlob = -1;
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        HVar7 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
      if (wParam == 0x76) {
        WinHelp(hwnd,(LPCSTR)CONCAT22(0x1120,_szHelpFile),1,0x42e);
        HVar7 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
    }
  }
LAB_10d8_08fb:
  HVar7 = 0;
  lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
LAB_10d8_0901:
  lResBudget._2_2_ = (undefined2)((ulong)lVar1 >> 0x10);
  lResBudget._0_2_ = (undefined2)lVar1;
  return HVar7;
}



// ======================================================================
// Function: DrawResearchDlg
// Address: 10d8:090a
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: hbrSav */

void DrawResearchDlg(HWND hwnd,HDC hdc,RECT *prc,short grbitDraw)

{
  HS *pHVar1;
  int iVar2;
  ushort uVar3;
  HGDIOBJ HVar4;
  HWND HVar5;
  int iVar6;
  undefined2 *puVar7;
  uint unaff_SI;
  undefined2 unaff_SS;
  DWORD DVar8;
  long lVar9;
  long lVar10;
  char *pcVar11;
  undefined2 uVar12;
  HDC HVar13;
  short sVar14;
  short sVar15;
  ulong uVar16;
  uint uVar17;
  HBRUSH hbrSav;
  short sVar18;
  long in_stack_0000ff44;
  ushort in_stack_0000ff48;
  int local_b6;
  short iMin;
  uint l;
  int local_b0;
  PART part;
  char szTemp2 [60];
  short dx;
  short xCtr;
  short xNum;
  HFONT hfontSav;
  COLORREF crForeSav;
  COLORREF crBackSav;
  short grbitCur;
  short c;
  short i;
  short mdAvail;
  short fCreatedDC;
  short iter;
  short iTechSav;
  short iMax;
  RECT rcT;
  char szTemp [60];
  short dxCurrent;
  
  uVar16 = (ulong)unaff_SI;
  fCreatedDC = 0;
  if (hdc == 0) {
    fCreatedDC = 1;
    hdc = GetDC(hwnd);
  }
  hfontSav = SelectObject(hdc,rghfontArial8[1]);
  crForeSav = SetTextColor(hdc,0);
  crBackSav = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,
                                      (undefined2)crButtonFace));
  if ((grbitDraw & 0xffU) != 0) {
    c = CchGetString(idsCurrent,(char *)szWork);
    DVar8 = GetTextExtent(hdc,szWork,c);
    dxCurrent = (short)DVar8;
    SetRect((RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xff44),8,dyArial8,
            dxResLeft + -8,dyArial8 * 0xd);
    if ((grbitDraw & 3U) != 0) {
      _Draw3dFrame();
      c = CchGetString(idsTechnologyStatus,(char *)szWork);
      TextOut(hdc,(int)in_stack_0000ff44 + 8,
              (int)((ulong)in_stack_0000ff44 >> 0x10) - (dyArial8 >> 1),szWork,c
             );
      iVar2 = (int)((ulong)in_stack_0000ff44 >> 0x10) + (dyArial8 >> 1);
      iVar6 = (int)in_stack_0000ff44;
      c = CchGetString(idsCurrent,(char *)szWork);
      TextOut(hdc,(in_stack_0000ff48 - 8) - dxCurrent,iVar2,szWork,c);
      iVar2 = iVar2 + dyArial8;
      i = CchGetString(idsFieldStudy,(char *)szWork);
      TextOut(hdc,iVar6 + 0x1a,iVar2,szWork,i);
      xCtr = (in_stack_0000ff48 - 8) - (dxCurrent >> 1);
      i = CchGetString(idsLevel,(char *)szWork);
      CtrTextOut(hdc,xCtr,iVar2,(char *)szWork,i);
      PatBlt(hdc,iVar6 + 8,iVar2 + dyArial8,(in_stack_0000ff48 - iVar6) + -0x10,1,0x42);
      in_stack_0000ff44 = CONCAT22(iVar2 + (dyArial8 >> 2) + dyArial8 + 2,iVar6)
      ;
      for (i = 0; i < 6; i = i + 1) {
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                      (int)*(char *)(idPlayer * 0xc0 + 0x59bc + i));
        CtrTextOut(hdc,xCtr,(short)((ulong)in_stack_0000ff44 >> 0x10),
                            (char *)szWork,c);
        in_stack_0000ff44 =
             CONCAT22((int)((ulong)in_stack_0000ff44 >> 0x10) + (dyArial8 * 3) / 2,
                      (short)in_stack_0000ff44);
      }
    }
    SetRect((RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xff44),8,
            (dyArial8 * 3) / 2 + local_b6,dxResLeft + -8,prc->bottom + -8);
    if (((grbitDraw & 4U) == 0) || ((grbitDraw & 3U) != 0)) {
      _Draw3dFrame();
      c = CchGetString(idsExpectedResearchBenefits,(char *)szWork);
      TextOut(hdc,(int)in_stack_0000ff44 + 8,
              (int)((ulong)in_stack_0000ff44 >> 0x10) - (dyArial8 >> 1),szWork,c
             );
      iTechSav = (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf;
      cFutureTech = 0;
      yTopFutureTech = (int)((ulong)in_stack_0000ff44 >> 0x10) + dyArial8;
      for (iter = 1; sVar14 = iter, iter < 10; iter = iter + 1) {
        iMax = iter;
        if (iter == 1) {
          SetTextColor(hdc,0x7f00);
        }
        else if ((iter < 2) || (4 < iter)) {
          SetTextColor(hdc,0);
          if (iter == 9) {
            iMax = 0x1a;
          }
        }
        else {
          SetTextColor(hdc,0x7f0000);
        }
        grbitCur = 1;
        *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
             *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
             (byte)iResTechNow;
        for (; grbitCur != 0; grbitCur = grbitCur << 1) {
          if (grbitCur != 0) {
            i = 0;
            part.hs.grhst = grbitCur;
            while( true ) {
              part.hs.wFlags_0x2 = part.hs.wFlags_0x2 & 0xff00 | i & 0xffU;
              mdAvail = FLookupPart(&part);
              if (mdAvail == 0) break;
              if (part.hs.grhst == hstTerra) {
                sVar15 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceTT);
                if ((sVar15 != 0) &&
                   ((((part.hs.wFlags_0x2 & 0xff) == 8 || ((part.hs.wFlags_0x2 & 0xff) == 0xc)) ||
                    ((part.hs.wFlags_0x2 & 0xff) == 0x10)))) break;
              }
              if ((sVar14 <= mdAvail + -1) && (mdAvail + -1 <= iMax)) {
                iVar2 = (int)((ulong)in_stack_0000ff44 >> 0x10) + dyArial8;
                in_stack_0000ff44 = CONCAT22(iVar2,(short)in_stack_0000ff44);
                if (local_b6 < iVar2 + dyArial8) goto RESEARCH_TooManyToFinish;
                __fstrcpy(szWork,
                                  (char *)CONCAT22(part.u_PART_0x0004._2_2_,
                                                   (part.u_PART_0x0004.parmor._0_2_)->szName));
                iVar2 = (int)in_stack_0000ff44 + 8;
                sVar15 = (short)((ulong)in_stack_0000ff44 >> 0x10);
                uVar12 = 0x1120;
                pcVar11 = (char *)szWork;
                HVar13 = hdc;
                uVar3 = _strlen((char *)szWork);
                TextOut(HVar13,iVar2,sVar15,(LPCSTR)CONCAT22(uVar12,pcVar11),uVar3);
                if (cFutureTech < 8) {
                  iVar2 = cFutureTech * 4;
                  pHVar1 = (HS *)rghsFutureTech + cFutureTech;
                  cFutureTech = cFutureTech + 1;
                  pHVar1->grhst = part.hs.grhst;
                  *(uint *)((int)&rghsFutureTech[0].wFlags_0x2 + iVar2) =
                       part.hs.wFlags_0x2;
                }
              }
              i = i + 1;
            }
          }
        }
      }
RESEARCH_TooManyToFinish:
      *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
           *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
           (byte)iTechSav;
      SetTextColor(hdc,0);
    }
    else {
      ExpandRc((RECT *)&stack0xff44,-6,-(dyArial8 >> 1));
      in_stack_0000ff44 =
           CONCAT22((int)((ulong)in_stack_0000ff44 >> 0x10) + (dyArial8 >> 1),
                    (short)in_stack_0000ff44);
      InvalidateRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xff44),1);
    }
  }
  SetRect((RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xff44),dxResLeft + 8,dyArial8
          ,dxResLeft + dxResRight + -8,
          (dyArial8 * 0xe) / 2 + dyArial8);
  iVar2 = (int)in_stack_0000ff44 + 8 + dxResStrRight;
  xCtr = iVar2;
  DVar8 = GetTextExtent(hdc,(LPCSTR)0x11200d0e,6);
  uVar12 = (undefined2)uVar16;
  xNum = (int)DVar8 + iVar2;
  if (((grbitDraw & 4U) != 0) && ((grbitDraw & 3U) == 0)) {
    ExpandRc((RECT *)&stack0xff44,-6,-(dyArial8 >> 1));
    InvalidateRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xff44),1);
    goto RESEARCH_CleanUp;
  }
  if ((grbitDraw & 0x300U) != 0) {
    if (*(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) < '\x1a') {
      lVar9 = GetTechLevelCost(iResTechNow,
                               *(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) +
                               1,idPlayer);
      puVar7 = (undefined2 *)(idPlayer * 0xc0 + 0x59c2 + iResTechNow * 4);
      hbrSav = puVar7[1];
      uVar16 = CONCAT22(*puVar7,uVar12);
      if ((game.wCrap >> 1 & 1) != 0) {
        lVar10 = __aFlshl(in_stack_0000ff44,in_stack_0000ff48);
        hbrSav = (HBRUSH)((ulong)lVar10 >> 0x10);
        uVar16 = CONCAT22((int)lVar10,uVar12);
      }
      local_b0 = (int)((ulong)lVar9 >> 0x10);
      l = (uint)lVar9;
      uVar17 = (uint)(uVar16 >> 0x10);
      iVar2 = (local_b0 - hbrSav) - (uint)(l < uVar17);
      if ((iVar2 < 1) && (iVar2 < 0)) {
        lVar9 = 0;
      }
      else {
        lVar9 = lVar9 - CONCAT22(hbrSav,uVar17);
      }
    }
    else {
      lVar9 = -1;
    }
    uVar12 = (undefined2)uVar16;
    local_b0 = (int)((ulong)lVar9 >> 0x10);
    l = (uint)lVar9;
    if (((grbitDraw & 0x200U) == 0) || ((grbitDraw & 0xfU) != 0)) {
      _Draw3dFrame();
      c = CchGetString(idsCurrentlyResearching,(char *)szWork);
      TextOut(hdc,(int)in_stack_0000ff44 + 8,
              (int)((ulong)in_stack_0000ff44 >> 0x10) - (dyArial8 >> 1),szWork,c
             );
      iVar2 = (int)((ulong)in_stack_0000ff44 >> 0x10) + dyArial8;
      sVar18 = (short)in_stack_0000ff44;
      CchGetString(iResTechNow + idsEnergy,szTemp);
      CchGetString(idsSTechLevelD,szTemp2);
      c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szTemp2),szTemp);
      RightTextOut(hdc,xCtr,iVar2,(char *)szWork,c,0);
      iVar2 = iVar2 + (dyArial8 * 3) / 2;
      sVar15 = 0;
      sVar14 = 0;
      pcVar11 = PszGetCompressedString(idsResourcesNeededComplete);
      RightTextOut(hdc,xCtr,iVar2,pcVar11,sVar14,sVar15);
      if (lVar9 == -1) {
        c = CchGetString(idsMaxed,(char *)szWork);
      }
      else {
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD),l,local_b0);
      }
      TextOut(hdc,xCtr,iVar2,szWork,c);
      in_stack_0000ff44 = CONCAT22(iVar2 + (dyArial8 * 3) / 2,sVar18);
      sVar15 = 0;
      sVar14 = 0;
      pcVar11 = PszGetCompressedString(idsEstimatedTimeCompletion);
      RightTextOut
                (hdc,xCtr,(short)((ulong)in_stack_0000ff44 >> 0x10),pcVar11,sVar14,sVar15);
    }
    else {
      in_stack_0000ff44 =
           CONCAT22((int)((ulong)in_stack_0000ff44 >> 0x10) +
                    ((dyArial8 * 3) / 2) * 2 + dyArial8,(short)in_stack_0000ff44
                   );
      HVar4 = SelectObject(hdc,hbrButtonFace);
      PatBlt(hdc,xCtr,(short)((ulong)in_stack_0000ff44 >> 0x10),xNum - xCtr,dyArial8,
             0xf00021);
      SelectObject(hdc,HVar4);
    }
    uVar3 = lResBudget._2_2_;
    if (lVar9 == -1) {
      c = CchGetString(idsMaxed,(char *)szWork);
      TextOut(hdc,xCtr,(short)((ulong)in_stack_0000ff44 >> 0x10),szWork,c);
    }
    else {
      if (lVar9 == 0) {
        lVar9 = 1;
      }
      else {
        if (((int)lResBudget == 0) && (lResBudget._2_2_ == 0)) {
          c = CchGetString(idsNever2,(char *)szWork);
          TextOut(hdc,xCtr,(short)((ulong)in_stack_0000ff44 >> 0x10),szWork,c);
          goto LAB_10d8_144a;
        }
        lVar9 = CONCAT22((int)lResBudget,uVar12);
        hbrSav = lResBudget._2_2_;
        sVar14 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                    ibitRaceGeneralizedResearch);
        if (sVar14 != 0) {
          lVar10 = __aFlshr(lVar9,uVar3);
          uVar17 = (uint)((ulong)lVar9 >> 0x10);
          lVar9 = (ulong)(uVar17 - (uint)lVar10) << 0x10;
          hbrSav = (uVar3 - (int)((ulong)lVar10 >> 0x10)) - (uint)(uVar17 < (uint)lVar10);
        }
        uVar17 = (uint)((ulong)lVar9 >> 0x10);
        lVar9 = __aFldiv(CONCAT22(local_b0 + hbrSav + (uint)CARRY2(l,uVar17) + -1 +
                                          (uint)(l + uVar17 != 0),l + uVar17 + -1),
                                 CONCAT22(hbrSav,uVar17));
      }
      if (lVar9 == 1) {
        uVar12 = 0x20;
      }
      else {
        uVar12 = 0x73;
      }
      pcVar11 = PszGetCompressedString(idsLdYearC);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar11),(int)lVar9,
                    (int)((ulong)lVar9 >> 0x10),uVar12);
      TextOut(hdc,xCtr,(short)((ulong)in_stack_0000ff44 >> 0x10),szWork,c);
    }
LAB_10d8_144a:
    sVar15 = 0;
    sVar14 = 0;
    pcVar11 = PszGetCompressedString(idsFieldResearch);
    RightTextOut
              (hdc,xCtr + -0x3c,(int)((ulong)in_stack_0000ff44 >> 0x10) + dyArial8 + 5,
               pcVar11,sVar14,sVar15);
    HVar5 = GetDlgItem(hwnd,0x43b);
    GetClientRect(HVar5,(RECT *)CONCAT22(unaff_SS,&rcT));
    HVar5 = GetDlgItem(hwnd,0x43b);
    MapWindowPoints(HVar5,hwnd,(POINT *)CONCAT22(unaff_SS,&rcT),2);
    if (rcT.top != (int)((ulong)in_stack_0000ff44 >> 0x10) + dyArial8 + 2) {
      HVar5 = GetDlgItem(hwnd,0x43b);
      SetWindowPos(HVar5,0,xCtr + -0x3c,
                   (int)((ulong)in_stack_0000ff44 >> 0x10) + dyArial8 + 2,
                   (in_stack_0000ff48 - xCtr) + 0x32,dyArial8 * 9,0xc);
    }
  }
  iVar2 = (dyArial8 * 3) / 2 + local_b6;
  iVar6 = (int)in_stack_0000ff44;
  if ((grbitDraw & 0x400U) != 0) {
    _Draw3dFrame();
    c = CchGetString(idsResourceAllocation,(char *)szWork);
    TextOut(hdc,iVar6 + 8,iVar2 - (dyArial8 >> 1),szWork,c);
  }
  iVar2 = iVar2 + dyArial8;
  if ((grbitDraw & 0x800U) != 0) {
    sVar15 = 0;
    sVar14 = 0;
    pcVar11 = PszGetCompressedString(idsAnnualResourcesPlanets);
    RightTextOut(hdc,xCtr,iVar2,pcVar11,sVar14,sVar15);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD),
                  (undefined2)lResTotal,lResTotal._2_2_);
    RightTextOut(hdc,xNum,iVar2,(char *)szWork,c,0);
  }
  iVar2 = iVar2 + (dyArial8 * 3) / 2;
  if ((grbitDraw & 0x1000U) != 0) {
    sVar15 = 0;
    sVar14 = 0;
    pcVar11 = PszGetCompressedString(idsTotalResourcesSpentResearchLastYear);
    RightTextOut(hdc,xCtr,iVar2,pcVar11,sVar14,sVar15);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD),
                  *(undefined2 *)((int)&rgplr[0].lResLastYear + idPlayer * 0xc0),
                  *(undefined2 *)
                   ((int)&rgplr[0].lResLastYear + 2 + idPlayer * 0xc0));
    RightTextOut(hdc,xNum,iVar2,(char *)szWork,c,0);
  }
  iVar2 = iVar2 + (dyArial8 * 3) / 2;
  dx = 0;
  if ((grbitDraw & 0x2000U) == 0) {
    if (((grbitDraw & 0x4000U) != 0) && ((grbitDraw & 0xfU) == 0)) {
      DVar8 = GetTextExtent(hdc,(LPCSTR)0x11200d15,3);
      dx = (short)DVar8;
    }
  }
  else {
    sVar15 = 0;
    sVar14 = 0;
    pcVar11 = PszGetCompressedString(idsResourcesBudgetedResearch);
    RightTextOut(hdc,xCtr,iVar2,pcVar11,sVar14,sVar15);
  }
  c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),pctResGlob);
  RightTextOut(hdc,xNum,iVar2,(char *)szWork,c,dx);
  if (((grbitDraw & 0x4000U) == 0) || ((grbitDraw & 0xfU) != 0)) {
    DVar8 = GetTextExtent(hdc,(LPCSTR)0x11200d19,1);
    dx = (short)DVar8;
    TextOut(hdc,xNum,iVar2,(LPCSTR)0x11200d1b,1);
    rcSpinTop.left = xNum + dx + 4;
    rcSpinTop.top = iVar2 + -4;
    rcSpinTop.right = xNum + dx + 0x13;
    rcSpinTop.bottom = (dyArial8 >> 1) + iVar2 + 1;
    rcSpinBot.left = rcSpinTop.left;
    rcSpinBot.top = rcSpinTop.top;
    rcSpinBot.right = rcSpinTop.right;
    rcSpinBot.bottom = rcSpinTop.bottom;
    OffsetRect(&rcSpinBot,0,(rcSpinTop.bottom - rcSpinTop.top) + -1);
    DrawBtn(hdc,(RECT *)&rcSpinTop,0xa0,0,(char *)0x0);
    DrawBtn(hdc,(RECT *)&rcSpinBot,0xa1,0,(char *)0x0);
  }
  iVar2 = iVar2 + (dyArial8 * 3) / 2;
  if (((grbitDraw & 0x4000U) == 0) || ((grbitDraw & 0xfU) != 0)) {
    sVar15 = 0;
    sVar14 = 0;
    pcVar11 = PszGetCompressedString(idsYearsProjectedResearchBudget);
    RightTextOut(hdc,xCtr,iVar2,pcVar11,sVar14,sVar15);
  }
  c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD),(int)lResBudget,
                lResBudget._2_2_);
  RightTextOut(hdc,xNum,iVar2,(char *)szWork,c,xNum - xCtr);
  sVar14 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                              ibitRaceGeneralizedResearch);
  if (sVar14 == 0) {
    sVar14 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceBleedingEdgeTech
                               );
    if (sVar14 == 0) {
      yTopTechNote = -1;
      goto RESEARCH_CleanUp;
    }
  }
  sVar14 = CchGetString(idsRaceHas,szTemp);
  SelectObject(hdc,rghfontArial8[1]);
  yTopTechNote = iVar2 + dyArial8 * 3;
  iVar6 = dxResLeft + 8;
  iVar2 = yTopTechNote;
  DVar8 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szTemp),sVar14);
  dx = (short)DVar8;
  sVar15 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                              ibitRaceGeneralizedResearch);
  if (sVar15 != 0) {
    TextOut(hdc,iVar6,iVar2,(LPCSTR)CONCAT22(unaff_SS,szTemp),sVar14);
    c = CchGetString(idsGeneralizedResearch,(char *)szWork);
    TextOut(hdc,iVar6 + dx,iVar2,szWork,c);
    iVar2 = iVar2 + dyArial8 + 2;
  }
  sVar15 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceBleedingEdgeTech);
  if (sVar15 != 0) {
    TextOut(hdc,iVar6,iVar2,(LPCSTR)CONCAT22(unaff_SS,szTemp),sVar14);
    c = CchGetString(idsBleedingEdgeTechnology,(char *)szWork);
    TextOut(hdc,iVar6 + dx,iVar2,szWork,c);
  }
RESEARCH_CleanUp:
  SetBkColor(hdc,crBackSav);
  SetTextColor(hdc,crForeSav);
  SelectObject(hdc,hfontSav);
  if (fCreatedDC != 0) {
    ReleaseDC(hwnd,hdc);
  }
  return;
}



// ======================================================================
// Function: FTrackResearchDlg
// Address: 10d8:1a8c
// Segment: MEMORY_RESEARCH
// ======================================================================


short FTrackResearchDlg(HWND hwnd,short x,short y,short fkb)

{
  POINT PVar1;
  POINT PVar2;
  BOOL BVar3;
  short sVar4;
  uint uVar5;
  undefined2 unaff_SS;
  long lVar6;
  RECT rc;
  BTNT btnt;
  RECT *prc;
  short cNew;
  short i;
  short dChg;
  short pt;
  short local_8;
  short bt;
  
  pt = x;
  local_8 = y;
  PVar1.y = y;
  PVar1.x = x;
  BVar3 = PtInRect(&rcSpinTop,PVar1);
  if (BVar3 == 0) {
    PVar2.y = local_8;
    PVar2.x = pt;
    BVar3 = PtInRect(&rcSpinBot,PVar2);
    if (BVar3 == 0) {
      if ((((y < yTopFutureTech) ||
           (cFutureTech * dyArial8 + yTopFutureTech <= y)) ||
          (x < 0xd)) || (dxResLeft + -0xc <= x)) {
        if (((yTopTechNote == -1) || (y < yTopTechNote)) ||
           ((dyArial8 * 3 + yTopTechNote <= y || (x <= dxResLeft)))) {
          sVar4 = 0;
          lVar6 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        }
        else {
          sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                     ibitRaceGeneralizedResearch);
          if ((sVar4 == 0) ||
             (((dyArial8 * 3) / 2 + yTopTechNote <= y &&
              (sVar4 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                          ibitRaceBleedingEdgeTech), sVar4 != 0)))) {
            i = 0x14c;
          }
          else {
            i = 0x144;
          }
          GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 =
               (ushort)PszGetCompressedString(i);
          GlobalPD.u_POPUPDATA_0x0002.dxOut = dxResRight;
          GlobalPD.grPopup = 10;
          Popup(hwnd,x,y);
          sVar4 = 1;
          lVar6 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        }
      }
      else {
        i = (y - yTopFutureTech) / dyArial8;
        GlobalPD.u_POPUPDATA_0x0002.part.hs.grhst =
             ((HS *)rghsFutureTech + i)->grhst;
        GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 =
             *(ushort *)((int)&rghsFutureTech[0].wFlags_0x2 + i * 4);
        FLookupPart((PART *)&GlobalPD.u_POPUPDATA_0x0002.part);
        GlobalPD.grPopup = 9;
        Popup(hwnd,x,y);
        sVar4 = 1;
        lVar6 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
      }
      goto LAB_10d8_1d48;
    }
    i = -1;
    prc = (RECT *)&rcSpinBot;
    bt = 0xa1;
  }
  else {
    i = 1;
    prc = (RECT *)&rcSpinTop;
    bt = 0xa0;
  }
  GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
  InitBtnTrack(&btnt,hwnd,0,prc,bt,0x50,0,0,(char *)0x0);
  if ((fkb & 4U) == 0) {
    dChg = 1;
    lResBudget = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
  }
  else {
    dChg = 10;
  }
  while( true ) {
    sVar4 = FTrackBtn(&btnt);
    if (sVar4 == 0) break;
    cNew = dChg * i + pctResGlob;
    uVar5 = cNew;
    if (0x7fff < (uint)cNew) {
      uVar5 = 0;
    }
    if ((int)uVar5 < 0x65) {
      if (0x7fff < (uint)cNew) {
        cNew = 0;
      }
    }
    else {
      cNew = 100;
    }
    if (cNew != pctResGlob) {
      pctResGlob = cNew;
      lVar6 = ProjectedResearchSpending((long)cNew);
      lResBudget = lVar6;
      DrawResearchDlg(hwnd,btnt.hdc,&rc,0x4200);
    }
  }
  sVar4 = 1;
  lVar6 = lResBudget;
LAB_10d8_1d48:
  lResBudget._2_2_ = (undefined2)((ulong)lVar6 >> 0x10);
  lResBudget._0_2_ = (undefined2)lVar6;
  return sVar4;
}



// ======================================================================
// Function: GetTechLevelCost
// Address: 10d8:1dba
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cTech */

long GetTechLevelCost(short iTech,short iLevel,short iplr)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  short sVar4;
  int iVar5;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar6;
  long lVar7;
  short cTech;
  short i;
  
  lVar7 = CONCAT22(unaff_SI,unaff_DI);
  cTech = 0;
  for (i = 0; i < 6; i = i + 1) {
    cTech = cTech + *(char *)(iplr * 0xc0 + 0x59bc + i);
  }
  uVar2 = cTech * 10;
  puVar1 = (uint *)((int)(double *)&DOUBLE_2000_0__1120_1d4e + iLevel * 4);
  uVar3 = uVar2 + *puVar1;
  iVar5 = ((int)uVar2 >> 0xf) + *(int *)((int)(double *)&DOUBLE_2000_0__1120_1d4e + iLevel * 4 + 2)
          + (uint)CARRY2(uVar2,*puVar1);
  lVar6 = CONCAT22(iVar5,uVar3);
  sVar4 = GetRaceStat((PLAYER *)rgplr + iplr,iTech + rsTechBonus1);
  if (sVar4 != 1) {
    if (sVar4 + -1 < 0) {
      lVar6 = __aFlshr(lVar7,cTech);
      uVar2 = uVar3 - (uint)lVar6;
      lVar6 = CONCAT22(((iVar5 * 2 - (int)((ulong)lVar6 >> 0x10)) - (uint)(uVar3 < (uint)lVar6)) +
                       (uint)CARRY2(uVar3,uVar2),uVar3 + uVar2);
    }
    else {
      lVar6 = __aFldiv(CONCAT22(iVar5,uVar3),2);
    }
  }
  if ((game.wCrap >> 1 & 1) != 0) {
    lVar6 = __aFlshl(lVar7,cTech);
  }
  return lVar6;
}



// ======================================================================
// Function: BrowserDlg
// Address: 10d8:1ed8
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10d824c3) */

short BrowserDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  int iVar1;
  bool bVar2;
  short sVar3;
  int iVar4;
  short sVar5;
  char *pcVar6;
  HWND HVar7;
  uint uVar8;
  uint uVar9;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  DWORD DVar10;
  ulong uVar11;
  ulong uVar12;
  long lVar13;
  LRESULT LVar14;
  short sVar15;
  short sVar16;
  HWND HVar17;
  WPARAM WVar18;
  UINT UVar19;
  ushort in_stack_0000ffb4;
  short iOff;
  short fShowAll;
  short cIter;
  short md;
  short iStart;
  short md__62;
  HWND hwndDD;
  RECT rc;
  short dx;
  HFONT hfontSav;
  PAINTSTRUCT ps;
  short c;
  short i;
  HMENU hmenu;
  HDC hdc;
  
  uVar11 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_DESTROY) {
    StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,0);
    hwndBrowser = 0;
    fBrowserValid = 0;
    hmenu = GetASubMenu(hwndFrame,5);
    CheckMenuItem(hmenu,0x100,0);
  }
  else {
    if (message == WM_PAINT) {
      hdc = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
      EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
      return 1;
    }
    if (message == WM_ERASEBKGND) {
      GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
      FillRect(wParam,(RECT *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
      return 1;
    }
    if (message == WM_CTLCOLOR) {
      for (i = 0x10a; i < 0x10c; i = i + 1) {
        HVar7 = GetDlgItem(hwnd,i);
        if ((HWND)lParam == HVar7) break;
      }
      if ((i < 0x10c) || (uVar11 = __aFulshr(uVar11,in_stack_0000ffb4), (int)uVar11 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        hwndBrowser = hwnd;
        HVar17 = 0;
        HVar7 = 7;
        sVar3 = GetSystemMetrics(7);
        if (dyArial8 < 0xf) {
          iVar4 = 0;
        }
        else {
          iVar4 = 0x28;
        }
        iVar4 = iVar4 + 0x166 + sVar3 * 2;
        sVar16 = 4;
        sVar3 = GetSystemMetrics(4);
        sVar15 = 8;
        sVar5 = GetSystemMetrics(8);
        SetWindowPos(HVar17,HVar7,iVar4,sVar16,sVar15,
                     dyArial10 + dyArial8 * 0xf + 0x67 + sVar5 * 2 + sVar3,6);
        StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,1);
        hdc = GetDC(hwnd);
        hfontSav = SelectObject(hdc,rghfontArial8[1]);
        HVar7 = GetDlgItem(hwnd,0x10b);
        c = GetDlgItemText(hwnd,0x42e,szWork,0x50);
        DVar10 = GetTextExtent(hdc,szWork,c);
        dx = (int)DVar10 + 0xe;
        HVar17 = GetDlgItem(hwnd,0x42e);
        SetWindowPos(HVar17,0,6,6,dx,(dyArial8 * 3) / 2,4);
        HVar17 = GetDlgItem(hwnd,0x42f);
        if (dyArial8 < 0xf) {
          iVar4 = 0;
        }
        else {
          iVar4 = 0x28;
        }
        SetWindowPos(HVar17,0,(iVar4 + 0x15e) - dx,6,dx,(dyArial8 * 3) / 2,4);
        if (dyArial8 < 0xf) {
          iVar4 = 0;
        }
        else {
          iVar4 = 0x28;
        }
        SetWindowPos(HVar7,0,dx + 0xc,6,iVar4 + dx * -2 + 0x14c,dyArial8 * 0x12,4);
        HVar17 = GetDlgItem(hwnd,2);
        if (dyArial8 < 0xf) {
          iVar4 = 0;
        }
        else {
          iVar4 = 0x28;
        }
        SetWindowPos(HVar17,0,(iVar4 + 0x15e) - dx,
                     dyArial10 + dyArial8 * 0xc + (dyArial8 * 3) / 2 +
                     0x60,dx,(dyArial8 * 3) / 2,4);
        HVar17 = GetDlgItem(hwnd,0x10a);
        if (dyArial8 < 0xf) {
          iVar4 = 0;
        }
        else {
          iVar4 = 0x28;
        }
        SetWindowPos(HVar17,0,6,
                     dyArial10 + dyArial8 * 0xc + (dyArial8 * 3) / 2 +
                     0x60,(iVar4 + 0x158) - dx,(dyArial8 * 3) / 2,4);
        SelectObject(hdc,hfontSav);
        ReleaseDC(hwnd,hdc);
        if (fBrowserValid == 0) {
          vpartBrowser.hs.grhst = hstArmor;
          vpartBrowser.hs.wFlags_0x2 = vpartBrowser.hs.wFlags_0x2 & 0xff00;
        }
        FLookupPart((PART *)&vpartBrowser);
        if (dyArial8 < 0xf) {
          iVar4 = 0;
        }
        else {
          iVar4 = 0x28;
        }
        hwndBrowserChild =
             CreateWindow(szBrowser,(LPCSTR)0x0,0x50000000,6,
                          (dyArial8 * 3) / 2 + 0xc,iVar4 + 0x158,
                          dyArial10 + dyArial8 * 0xc + 0x4e,hwnd,0,
                          hInst,(void *)0x0);
        for (i = 0x43f; i < 0x450; i = i + 1) {
          UVar19 = 0x403;
          WVar18 = 0;
          HVar17 = HVar7;
          pcVar6 = PszGetCompressedString(i);
          SendMessage(HVar17,UVar19,WVar18,(LPARAM)CONCAT22(0x1120,pcVar6));
        }
        SendMessage(HVar7,0x40e,0,0);
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 2) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,0);
          hwndBrowser = 0;
          fBrowserValid = 0;
          hmenu = GetASubMenu(hwndFrame,5);
          CheckMenuItem(hmenu,0x100,0);
          EndDialog(hwnd,1);
          if (((uint)gd.grBits >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
          return 1;
        }
        if (wParam == 0x10b) {
          uVar12 = __aFulshr(uVar11,in_stack_0000ffb4);
          if ((int)uVar12 == 1) {
            UVar19 = IsDlgButtonChecked(hwnd,0x10a);
            HVar7 = GetDlgItem(hwnd,0x10b);
            LVar14 = SendMessage(HVar7,0x407,0,0);
            if ((0xffff < LVar14) || (-1 < LVar14)) {
              lVar13 = __aFlshl(uVar11,in_stack_0000ffb4);
              vpartBrowser.hs.grhst =
                   *(HullSlotType *)
                    ((char *)s_R6009___not_enough_space_for_env_1120_1eb5 + 1 + (int)lVar13);
              vpartBrowser.hs.wFlags_0x2 = vpartBrowser.hs.wFlags_0x2 & 0xff00;
              while (sVar3 = FLookupPart((PART *)&vpartBrowser), sVar3 != 0) {
                if ((sVar3 == 1) || (UVar19 == 0)) goto LAB_10d8_2557;
                vpartBrowser.hs.wFlags_0x2 =
                     vpartBrowser.hs.wFlags_0x2 & 0xff00 |
                     vpartBrowser.hs.wFlags_0x2 + 1 & 0xff;
              }
              vpartBrowser.u_PART_0x0004.parmor._0_2_ = (ARMOR *)0x0;
              vpartBrowser.u_PART_0x0004._2_2_ = 0;
LAB_10d8_2557:
              InvalidateRect(hwndBrowserChild,(RECT *)0x0,1);
            }
          }
        }
        else if ((wParam == 0x42f) || (wParam == 0x42e)) {
          uVar8 = vpartBrowser.hs.wFlags_0x2 & 0xff;
          cIter = 0;
          HVar7 = GetDlgItem(hwnd,0x10b);
          LVar14 = SendMessage(HVar7,0x407,0,0);
          bVar2 = LVar14 == 0;
          i = 0;
          while ((sVar3 = i, i < 0x11 &&
                 (vpartBrowser.hs.grhst !=
                  *(HullSlotType *)
                   ((char *)s_R6009___not_enough_space_for_env_1120_1eb5 + 1 + i * 2)))) {
            i = i + 1;
          }
          UVar19 = IsDlgButtonChecked(hwnd,0x10a);
          if (wParam == 0x42f) {
            iVar4 = 1;
          }
          else {
            iVar4 = -1;
          }
          while ((uVar9 = iVar4 + vpartBrowser.hs.wFlags_0x2 & 0xff,
                 vpartBrowser.hs.wFlags_0x2 =
                      vpartBrowser.hs.wFlags_0x2 & 0xff00 | uVar9, uVar9 != uVar8 ||
                 (bVar2))) {
            while( true ) {
              iVar1 = cIter + 1;
              if (0x15e < cIter) goto RESEARCH_NullItem;
              md = FLookupPart((PART *)&vpartBrowser);
              cIter = iVar1;
              if (md != 0) break;
              if ((wParam == 0x42f) && (bVar2)) {
                i = i + 1;
                if (0x10 < i) {
                  i = 1;
                }
                vpartBrowser.hs.grhst =
                     *(HullSlotType *)
                      ((char *)s_R6009___not_enough_space_for_env_1120_1eb5 + 1 + i * 2);
                vpartBrowser.hs.wFlags_0x2 = vpartBrowser.hs.wFlags_0x2 & 0xff00
                ;
              }
              else {
                if (((vpartBrowser.hs.wFlags_0x2 & 0xff) == 0) && (!bVar2)) {
                  vpartBrowser.u_PART_0x0004.parmor._0_2_ = (ARMOR *)0x0;
                  vpartBrowser.u_PART_0x0004._2_2_ = 0;
                  goto LAB_10d8_27b3;
                }
                if ((wParam == 0x42e) && (bVar2)) {
                  if ((vpartBrowser.hs.wFlags_0x2 & 0xff) < 0x65) break;
                  i = i + -1;
                  if (i < 1) {
                    i = 0x10;
                  }
                  vpartBrowser.hs.grhst =
                       *(HullSlotType *)
                        ((char *)s_R6009___not_enough_space_for_env_1120_1eb5 + 1 + i * 2);
                  vpartBrowser.hs.wFlags_0x2 =
                       vpartBrowser.hs.wFlags_0x2 & 0xff00 | 100;
                }
                else {
                  if (wParam != 0x42f) break;
                  vpartBrowser.hs.wFlags_0x2 =
                       vpartBrowser.hs.wFlags_0x2 & 0xff00;
                }
              }
            }
            if ((md == 1) ||
               (((md != 0 && (UVar19 == 0)) &&
                ((md != -1 ||
                 (sVar5 = FShouldPartBeHidden((PART *)&vpartBrowser), sVar5 == 0))))))
            break;
          }
LAB_10d8_27b3:
          if ((((vpartBrowser.hs.wFlags_0x2 & 0xff) != uVar8) || (sVar3 != i)) ||
             ((md != 1 && (UVar19 != 0)))) {
            if (((vpartBrowser.hs.wFlags_0x2 & 0xff) == uVar8) && (sVar3 == i)) {
              sVar3 = FLookupPart((PART *)&vpartBrowser);
              if (sVar3 == 1) {
                return 0;
              }
RESEARCH_NullItem:
              vpartBrowser.u_PART_0x0004.parmor._0_2_ = (ARMOR *)0x0;
              vpartBrowser.u_PART_0x0004._2_2_ = 0;
            }
            InvalidateRect(hwndBrowserChild,(RECT *)0x0,1);
          }
        }
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: BrowserWndProc
// Address: 10d8:2876
// Segment: MEMORY_RESEARCH
// ======================================================================


long BrowserWndProc(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  SHDEF *pSVar1;
  HULDEF *pHVar2;
  int iVar3;
  undefined2 uVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  SHDEF *pSVar5;
  undefined2 unaff_SS;
  ulong uVar6;
  HULDEF *pHVar7;
  LRESULT LVar8;
  ushort in_stack_0000ffcc;
  short local_30;
  short local_2e;
  PAINTSTRUCT ps;
  short i;
  POINT pt;
  HDC hdc;
  
  if (message == WM_CREATE) {
    return 0;
  }
  if (message == WM_PAINT) {
    hdc = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffcc));
    DisplayComponentInfo(hdc,local_30,local_2e,(PART *)&vpartBrowser);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
    return 0;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffcc));
    FillRect(wParam,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffcc),hbrButtonFace);
    return 1;
  }
  if (message == WM_SETCURSOR) {
    GetCursorPos((POINT *)CONCAT22(unaff_SS,&pt));
    ScreenToClient(hwnd,(POINT *)CONCAT22(unaff_SS,&pt));
  }
  else {
    if (message != WM_LBUTTONDOWN) goto RESEARCH_Default_8;
    pt.x = (int)lParam;
    uVar6 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffcc);
    pt.y = (short)uVar6;
  }
  if ((((vpartBrowser.hs.grhst == hstHull) ||
       (vpartBrowser.hs.grhst == hstSBHull)) && (hwndSlotDlg == 0)) &&
     (((4 < pt.x && (pt.x < 0x45)) &&
      ((dyArial10 + 5 <= pt.y && (pt.y < dyArial10 + 0x45)))))) {
    if (message == WM_LBUTTONDOWN) {
      GlobalPD.grPopup = 0xe;
      if (vpartBrowser.hs.grhst == hstSBHull) {
        pHVar7 = LphuldefSBFromId(vpartBrowser.hs.wFlags_0x2 & 0xff);
        uVar4 = (undefined2)((ulong)pHVar7 >> 0x10);
        pHVar2 = (HULDEF *)pHVar7;
        pSVar5 = (SHDEF *)&shdefBuild;
        for (iVar3 = 0x3d; iVar3 != 0; iVar3 = iVar3 + -1) {
          pSVar1 = pSVar5;
          pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
          pHVar7 = pHVar2;
          pHVar2 = (HULDEF *)(pHVar2->hul).rgTech;
          (pSVar1->hul).ihuldef = (pHVar7->hul).ihuldef;
        }
        *(char *)&(pSVar5->hul).ihuldef = (char)(pHVar2->hul).ihuldef;
      }
      else {
        pHVar7 = LphuldefFromId(vpartBrowser.hs.wFlags_0x2 & 0xff);
        uVar4 = (undefined2)((ulong)pHVar7 >> 0x10);
        pHVar2 = (HULDEF *)pHVar7;
        pSVar5 = (SHDEF *)&shdefBuild;
        for (iVar3 = 0x3d; iVar3 != 0; iVar3 = iVar3 + -1) {
          pSVar1 = pSVar5;
          pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
          pHVar7 = pHVar2;
          pHVar2 = (HULDEF *)(pHVar2->hul).rgTech;
          (pSVar1->hul).ihuldef = (pHVar7->hul).ihuldef;
        }
        *(char *)&(pSVar5->hul).ihuldef = (char)(pHVar2->hul).ihuldef;
      }
      for (i = 0; i < (int)(uint)shdefBuild.hul.chs; i = i + 1) {
        *(uint *)((int)&shdefBuild.hul + 0x3c + i * 4) =
             *(uint *)((int)&shdefBuild.hul + 0x3c + i * 4) & 0xff;
      }
      GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_ = (FLEET *)&shdefBuild;
      GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 = 0x1120;
      GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = 0;
      Popup(hwnd,pt.x,pt.y);
    }
    else {
      setcursor(hcurArrowHelp);
    }
    return 1;
  }
RESEARCH_Default_8:
  LVar8 = DefWindowProc(hwnd,message,wParam,lParam);
  return LVar8;
}



// ======================================================================
// Function: DisplayComponentInfo
// Address: 10d8:2ac6
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10d84da9) */
/* WARNING: Removing unreachable block (ram,0x10d862f3) */
/* WARNING: Variable defined which should be unmapped: hpenSav */
/* WARNING: Removing unreachable block (ram,0x10d82fa1) */
/* WARNING: Removing unreachable block (ram,0x10d8301c) */

void DisplayComponentInfo(HDC hdc,short dx,short dy,PART *ppart)

{
  HullSlotType HVar1;
  uint uVar2;
  short sVar3;
  char *pcVar4;
  int iVar5;
  StringId ids_00;
  char *pcVar6;
  int iVar7;
  ushort cLen;
  int iVar8;
  HGDIOBJ HVar9;
  int iVar10;
  int iVar11;
  undefined2 unaff_SS;
  DWORD DVar12;
  long lVar13;
  COLORREF CVar14;
  HULDEF *pHVar15;
  ulong uVar16;
  long lVar17;
  ulong uVar18;
  undefined2 uVar19;
  char acVar20 [2];
  HDC HVar21;
  short sVar22;
  undefined2 uVar23;
  HPEN hpenSav;
  short x;
  int ldelta;
  char ch;
  char cch;
  short dxQuan;
  short pct;
  short xBase;
  short y;
  short yBase;
  short dxDigit;
  uint lpct;
  int local_138;
  short xText;
  short dmgFloor;
  short dyText;
  char szT [222];
  HBRUSH hbrSav;
  undefined2 crBack;
  short pctT;
  HPEN hpenSav__76;
  short x__74;
  short cch__72;
  undefined4 crFore;
  short iEff;
  short fWarp10;
  short pct__62;
  short dxWarp;
  short y__58;
  char *rcT;
  short dxDigit__54;
  short dyPct;
  char rgch [2];
  short dxT;
  RECT rcData;
  short xText__34;
  short xNum;
  short yStart;
  short fReq;
  short yCur;
  short i;
  short yText;
  short c;
  short dxStr;
  short ids;
  short idsT;
  ushort rgCosts [5];
  
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,0,dy + -1,dx,1,0xf00021);
  PatBlt(hdc,dx + -1,0,1,dy,0xf00021);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,0,0,dx,1,0xf00021);
  PatBlt(hdc,0,0,1,dy,0xf00021);
  PatBlt(hdc,4,dy + dyArial8 * -2 + -2,dx + -8,1,0xf00021);
  SetBkMode(hdc,1);
  if ((*(int *)&(&ppart->u_PART_0x0004)->parmor == 0) &&
     (*(int *)((int)&ppart->u_PART_0x0004 + 2) == 0)) {
    SetRect((RECT *)CONCAT22(unaff_SS,&rcData),5,5,dx + -5,dy + -5);
    c = CchGetString(idsNoneAvailable,(char *)szWork);
    DiaganolTextOut(hdc,&rcData,(char *)szWork,c);
    return;
  }
  SelectObject(hdc,rghfontArial10[1]);
  __fstrcpy(szWork,
                    (char *)CONCAT22(*(undefined2 *)((int)&ppart->u_PART_0x0004 + 2),
                                     (char *)(*(int *)&(&ppart->u_PART_0x0004)->parmor + 8)));
  CtrTextOut(hdc,dx >> 1,3,(char *)szWork,0);
  if (((ppart->hs).grhst == hstHull) || ((ppart->hs).grhst == hstSBHull)) {
    DrawFleetBitmap
              ((FLEET *)0x0,hdc,5,dyArial10 + 5,0,
               ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp,0,0,-1,0);
  }
  else {
    SelectPalette(hdc,vhpal,0);
    RealizePalette(hdc);
    DibBlt(hdc,5,dyArial10 + 5,0x40,0x40,
                    ((ushort *)rghdibInventory)
                    [((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp >> 5],
                    (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp & 7U) << 6,
                    (3U - (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp >> 3) & 3) << 6,0x40,
                    0x40,0xcc0020);
  }
  SelectObject(hdc,rghfontArial8[1]);
  yCur = dyArial10 + 0x47;
  c = CchGetString(idsTechReq,(char *)szWork);
  TextOut(hdc,5,yCur,szWork,c);
  dxStr = 0;
  for (i = 0; i < 6; i = i + 1) {
    c = CchGetString(i + idsEner,(char *)szWork);
    DVar12 = GetTextExtent(hdc,szWork,c);
    sVar3 = (int)DVar12;
    if ((int)DVar12 <= dxStr) {
      sVar3 = dxStr;
    }
    dxStr = sVar3;
  }
  dxStr = dxStr + 5;
  DVar12 = GetTextExtent(hdc,(LPCSTR)0x11200d24,2);
  xNum = dxStr + (int)DVar12;
  fReq = 0;
  for (i = 0; i < 6; i = i + 1) {
    if ('\0' < *(char *)(*(int *)&(&ppart->u_PART_0x0004)->parmor + 2 + i)) {
      yCur = yCur + dyArial8;
      rgch = (char  [2])(int)*(char *)(*(int *)&(&ppart->u_PART_0x0004)->parmor + 2 + i);
      if ((int)*(char *)(idPlayer * 0xc0 + 0x59bc + i) < (int)rgch) {
        uVar2 = 0x7f;
      }
      else {
        uVar2 = 0;
      }
      SetTextColor(hdc,(ulong)uVar2);
      c = CchGetString(i + idsEner,(char *)szWork);
      RightTextOut(hdc,dxStr,yCur,(char *)szWork,c,0);
      SetTextColor(hdc,0);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                    (int)*(char *)(*(int *)&(&ppart->u_PART_0x0004)->parmor + 2 + i));
      RightTextOut(hdc,xNum,yCur,(char *)szWork,c,0);
      fReq = 1;
    }
  }
  if (fReq == 0) {
    yCur = yCur + dyArial8;
    c = CchGetString(idsNone3,(char *)szWork);
    CtrTextOut(hdc,0x25,yCur,(char *)szWork,c);
  }
  sVar3 = FLookupPart(ppart);
  if (sVar3 < 1) {
    lVar13 = -1;
  }
  else {
    lVar13 = CostOfDevelopingItem
                       ((char *)CONCAT22(*(undefined2 *)((int)&ppart->u_PART_0x0004 + 2),
                                         (char *)(*(int *)&(&ppart->u_PART_0x0004)->parmor + 2)));
  }
  if (lVar13 < 100000) {
    if (lVar13 < 1) {
      if (lVar13 == -1) {
        SetTextColor(hdc,0x7f);
        sVar3 = 0;
        pcVar4 = PszGetCompressedString(idsUnavail);
        CtrTextOut(hdc,0x25,yCur + dyArial8 + 4,pcVar4,sVar3);
        SetTextColor(hdc,0);
      }
      else {
        sVar3 = 0;
        pcVar4 = PszGetCompressedString(idsAvailable);
        CtrTextOut(hdc,0x25,yCur + dyArial8 + 4,pcVar4,sVar3);
      }
    }
    else {
      lVar17 = lVar13;
      pcVar4 = PszGetCompressedString(idsCostLd);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),(int)lVar17,
                    (int)((ulong)lVar17 >> 0x10));
      TextOut(hdc,5,yCur + dyArial8 + 4,szWork,c);
    }
  }
  else {
    lVar17 = __aFldiv(lVar13 + 500,1000);
    pcVar4 = PszGetCompressedString(idsCostLdk);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),(int)lVar17,
                  (int)((ulong)lVar17 >> 0x10));
    TextOut(hdc,5,yCur + dyArial8 + 4,szWork,c);
  }
  yStart = dyArial10 + 5;
  if (dyArial8 * 4 < 0x40) {
    yStart = yStart + (dyArial8 * -4 + 0x40 >> 1);
  }
  yCur = yStart;
  dxStr = 0;
  for (i = 0; i < 6; i = i + 1) {
    pcVar4 = (char *)*(undefined2 *)(i * 2 + 0x4cc);
    uVar19 = 0x1120;
    HVar21 = hdc;
    sVar3 = lstrlen((LPCSTR)CONCAT22(0x1120,(char *)*(undefined2 *)(i * 2 + 0x4cc)));
    DVar12 = GetTextExtent(HVar21,(LPCSTR)CONCAT22(uVar19,pcVar4),sVar3);
    sVar3 = (int)DVar12;
    if ((int)DVar12 <= dxStr) {
      sVar3 = dxStr;
    }
    dxStr = sVar3;
  }
  dxStr = dxStr + 0x4d;
  GetTruePartCost(idPlayer,ppart,rgCosts);
  for (i = 0; i < 6; i = i + 1) {
    if ((i != 4) && (i != 3)) {
      SelectObject(hdc,rghfontArial8[1]);
      SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + 0x44a),*(undefined2 *)(i * 4 + 0x448)));
      RightTextOut(hdc,dxStr,yCur,(char *)*(undefined2 *)(i * 2 + 0x4cc),0,0);
      SelectObject(hdc,rghfontArial8[0]);
      SetTextColor(hdc,CONCAT22(crWindowText._2_2_,(undefined2)crWindowText));
      if (i == 5) {
        c = rgCosts[3];
      }
      else {
        c = rgCosts[i];
      }
      if (((ppart->hs).grhst == hstSBHull) || ((ppart->hs).grhst == hstSpecialSB)) {
        c = c - c / 2;
      }
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),c);
      RightTextOut
                (hdc,dxStr + dxMaxMineralQuan,yCur,(char *)szWork,c,0);
      if (i < 5) {
        TextOut(hdc,dxStr + dxMaxMineralQuan,yCur,(LPCSTR)0x11200d27,2);
      }
      yCur = yCur + dyArial8;
    }
  }
  SelectObject(hdc,rghfontArial8[1]);
  if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->cMass != 0) {
    sVar3 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->cMass;
    pcVar4 = PszGetCompressedString(idsMassDkt);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),sVar3);
    TextOut(hdc,dxStr + dxMaxMineralQuan + 0x20,yStart,szWork,c);
  }
  if (xNum + 4 < 0x49) {
    sVar3 = 0x49;
  }
  else {
    sVar3 = xNum + 4;
  }
  SetRect((RECT *)CONCAT22(unaff_SS,&rcData),sVar3,dyArial10 + 0x47,dx + -5,
          dy + dyArial8 * -2 + -9);
  if (0xe < dyArial8) {
    rcData.left = rcData.left + 4;
  }
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,rcData.left,rcData.top,rcData.right - rcData.left,1,0xf00021);
  PatBlt(hdc,rcData.left,rcData.top,1,rcData.bottom - rcData.top,0xf00021);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,rcData.left,rcData.bottom + -1,rcData.right - rcData.left,1,0xf00021);
  PatBlt(hdc,rcData.right + -1,rcData.top,1,rcData.bottom - rcData.top,0xf00021);
  ExpandRc(&rcData,-3,-3);
  if (((gd.grBits._2_2_ >> 0xe & 1) != 0) && (lVar13 == 0)) {
    SetTextColor(hdc,CONCAT22(crButtonHilite._2_2_,(undefined2)crButtonHilite));
    c = CchGetString(idsBleedingEdge,(char *)szWork);
    DiaganolTextOut(hdc,&rcData,(char *)szWork,c);
    SetTextColor(hdc,CONCAT22(crWindowText._2_2_,(undefined2)crWindowText));
  }
  ids = -1;
  HVar1 = (ppart->hs).grhst;
  if (HVar1 == hstEngine) {
    SelectObject(hdc,rghfontArial8[1]);
    rcData.right = rcData.right + -2;
    c = CchGetString(idsFuelUsageVsWarpSpeed,(char *)szWork);
    CtrTextOut(hdc,(rcData.right - rcData.left >> 1) + rcData.left,rcData.top,
                        (char *)szWork,c);
    rcData.top = rcData.top + dyArial8;
    c = CchGetString(idsWarp,(char *)szWork);
    DVar12 = GetTextExtent(hdc,szWork,c);
    dxStr = (short)DVar12;
    dxWarp = (((rcData.right - rcData.left) - dxStr) + -8) / 10;
    dyPct = (((rcData.bottom - rcData.top) - dyArial8) + -8) / 6;
    PatBlt(hdc,rcData.left + dxStr + 6,rcData.top,1,
           ((rcData.bottom - rcData.top) - dyArial8) + -4,0x42);
    PatBlt(hdc,rcData.left + dxStr + 6,(rcData.bottom - dyArial8) + -4,
           ((rcData.right - rcData.left) - dxStr) + -6,1,0x42);
    x__74 = rcData.left + dxStr;
    y__58 = (rcData.bottom - dyArial8) + -4 + dyPct * -6;
    pct__62 = 800;
    SetTextColor(hdc,0x7f);
    for (; 0x18 < pct__62; pct__62 = pct__62 >> 1) {
      if (pct__62 == 100) {
        SetTextColor(hdc,0);
        SelectObject(hdc,hbrGray);
        PatBlt(hdc,x__74 + 4,y__58,((rcData.right - rcData.left) - dxStr) + -4,1,0xf00021);
      }
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTDPCTPCT),pct__62);
      RightTextOut
                (hdc,x__74,y__58 - (dyArial8 >> 1),(char *)szWork,c,0);
      PatBlt(hdc,x__74 + 4,y__58,5,1,0x42);
      y__58 = y__58 + dyPct;
    }
    y__58 = rcData.bottom - dyArial8;
    sVar22 = 0;
    sVar3 = 0;
    pcVar4 = PszGetCompressedString(idsWarp);
    RightTextOut(hdc,x__74,y__58,pcVar4,sVar3,sVar22);
    x__74 = x__74 + 6;
    rcT = (char *)((rcData.bottom - dyArial8) + -4);
    DVar12 = GetTextExtent(hdc,(LPCSTR)0x11200d2a,1);
    dxDigit__54 = (uint)DVar12 >> 1;
    rgch[0] = '0';
    cch__72 = 1;
    crFore = SetTextColor(hdc,CONCAT22(crButtonText._2_2_,
                                       (undefined2)crButtonText));
    if ((((((ppart->hs).wFlags_0x2 & 0xff) == 7) || (((ppart->hs).wFlags_0x2 & 0xff) == 9)) ||
        (((ppart->hs).wFlags_0x2 & 0xff) == 0xe)) ||
       ((((ppart->hs).wFlags_0x2 & 0xff) == 0xf || (((ppart->hs).wFlags_0x2 & 0xff) == 8)))) {
      fWarp10 = 1;
    }
    else {
      fWarp10 = 0;
    }
    for (i = 0; i < 0xb; i = i + 1) {
      if (i == 10) {
        cch__72 = 2;
        rgch[0] = '1';
        rgch[1] = '0';
        if (fWarp10 == 0) {
          hbrSav = SelectObject(hdc,rghbrPat[0]);
          SetTextColor(hdc,0xffff);
          CVar14 = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,
                                           (undefined2)crButtonFace));
          pctT = (short)(CVar14 >> 0x10);
          crBack = (undefined2)CVar14;
          PatBlt(hdc,(x__74 - dxWarp) + 1,rcData.top,dxWarp,(int)rcT - rcData.top,0xf00021);
          SetBkColor(hdc,CONCAT22(pctT,crBack));
          SelectObject(hdc,hbrSav);
        }
      }
      if ((*(int *)(*(int *)&(&ppart->u_PART_0x0004)->pbeam + 0x36 + i * 2) < 0x79) &&
         (((i == 10 && (fWarp10 != 0)) ||
          ((0x78 < *(int *)(*(int *)&(&ppart->u_PART_0x0004)->pbeam + 0x36 + (i + 1) * 2) ||
           ((i == 9 && (fWarp10 == 0)))))))) {
        SetTextColor(hdc,0x7f0000);
      }
      else {
        SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
      }
      TextOut(hdc,x__74 - dxDigit__54 * cch__72,y__58,(LPCSTR)CONCAT22(unaff_SS,rgch),cch__72);
      if (0 < i) {
        PatBlt(hdc,x__74,y__58 + -6,1,5,0x42);
      }
      rgch[0] = rgch[0] + '\x01';
      x__74 = x__74 + dxWarp;
    }
    SetTextColor(hdc,crFore);
    hpenSav__76 = SelectObject(hdc,hpenDkBlue);
    x__74 = rcData.left + dxStr + 6;
    for (i = 0; i < 0xb; i = i + 1) {
      y__58 = (short)rcT;
      pct__62 = 0x19;
      iEff = *(int *)(*(int *)&(&ppart->u_PART_0x0004)->pbeam + 0x36 + i * 2);
      for (; pct__62 <= iEff; pct__62 = pct__62 << 1) {
        y__58 = y__58 - dyPct;
      }
      if (pct__62 == 0x19) {
        if (iEff == 0) {
          y__58 = y__58 + -1;
        }
        else {
          if ((iEff * 4 * dyPct) / 100 < 1) {
            iVar5 = 1;
          }
          else {
            iVar5 = (iEff * 4 * dyPct) / 100;
          }
          y__58 = y__58 - iVar5;
        }
      }
      else {
        pctT = MulDiv(iEff - (pct__62 >> 1),100,pct__62 >> 1);
        y__58 = y__58 - (pctT * dyPct) / 100;
      }
      if (i == 0) {
        MoveTo(hdc,x__74,y__58);
      }
      else {
        LineTo(hdc,x__74,y__58);
      }
      x__74 = x__74 + dxWarp;
    }
    SelectObject(hdc,hpenSav__76);
    switch(((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp) {
    default:
      if ((10 < ((ppart->hs).wFlags_0x2 & 0xff)) && (((ppart->hs).wFlags_0x2 & 0xff) < 0xf)) {
        ids = 0x18c;
      }
      break;
    case 1:
      ids = 0x29;
      break;
    case 2:
      ids = 0x2a;
      break;
    case 3:
      ids = 0x2b;
      break;
    case 4:
      ids = 0x2c;
      break;
    case 5:
      ids = 0x2d;
      break;
    case 6:
      ids = 0x3a5;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstScanner) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[0]);
    i = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
    if (i == 0) {
      c = CchGetString
                    (idsEnemyFleetsCannotDetectedScannerUnlessSame,(char *)szWork);
    }
    else {
      c = CchGetString(idsEnemyFleetsOrbitingPlanetCanDetectedD,szT);
      c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),i);
    }
    dyText = DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
    rcData.top = rcData.top + (dyArial8 >> 1) + dyText;
    i = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp;
    if (i == 0) {
      c = CchGetString
                    (idsScannerCapableDeterminingPlanetsEnvironmentCompo,(char *)szWork);
    }
    else if (i == 4) {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 5) {
        ids = 0x36;
      }
      else if (((ppart->hs).wFlags_0x2 & 0xff) == 0xe) {
        ids = 0x37;
      }
      else {
        ids = 0x35;
      }
      c = CchGetString(ids,(char *)szWork);
      ids = 0x38;
    }
    else {
      c = CchGetString(idsScannerCanDeterminePlanetsBasicStatsDistance,szT);
      if (i == 1) {
        uVar19 = 0x32;
      }
      else if (i == 2) {
        uVar19 = 100;
      }
      else {
        uVar19 = 200;
      }
      c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),uVar19);
      ids = 0x164;
    }
    dyText = DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstShield) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    dyPct = rcData.left;
    sVar22 = 1;
    sVar3 = 0;
    pcVar4 = PszGetCompressedString(idsShieldStrength);
    DxStreamTextOut(hdc,&dyPct,rcData.top,pcVar4,sVar3,sVar22);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    DxStreamTextOut(hdc,&dyPct,rcData.top,(char *)szWork,c,1);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 4) {
      ids = 0x3a;
      rgch[0] = '<';
      rgch[1] = '\0';
RESEARCH_LShieldDisp:
      c = CchGetString((StringId)rgch,(char *)szWork);
      rcData.top = rcData.top + dyArial8 + 4;
      DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
    }
    else {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 3) {
        ids = 0x3b;
        rgch[0] = '?';
        rgch[1] = '\0';
        goto RESEARCH_LShieldDisp;
      }
      if (((ppart->hs).wFlags_0x2 & 0xff) == 6) {
        ids = 0x3a2;
        rgch[0] = '@';
        rgch[1] = '\0';
        goto RESEARCH_LShieldDisp;
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstArmor) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    rgch[0] = (undefined1)rcData.left;
    rgch[1] = rcData.left._1_1_;
    sVar22 = 1;
    sVar3 = 0;
    pcVar4 = PszGetCompressedString(idsArmorStrength2);
    DxStreamTextOut(hdc,(short *)rgch,rcData.top,pcVar4,sVar3,sVar22);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    DxStreamTextOut(hdc,(short *)rgch,rcData.top,(char *)szWork,c,1);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
      ids = 0x3a;
      idsT = 0x3d;
RESEARCH_LArmDisp:
      c = CchGetString(idsT,(char *)szWork);
      rcData.top = rcData.top + dyArial8 + 4;
      DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
    }
    else {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 6) {
        ids = 0x4d4;
        idsT = 0x3e;
        goto RESEARCH_LArmDisp;
      }
      if (((ppart->hs).wFlags_0x2 & 0xff) == 9) {
        ids = 0x3a2;
        c = CchGetString(idsPartAlsoActs100dpShield20Cloak,(char *)szWork);
        rcData.top = rcData.top + dyArial8 + 4;
        SelectObject(hdc,rghfontArial8[0]);
        DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstBeam) {
    ExpandRc(&rcData,-4,-4);
    rgch = (char  [2])((rcData.right - rcData.left) / 3 + rcData.left);
    yText = rcData.top;
    c = CchGetString(idsPower,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsRange,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsInitiative,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    rcData.top = yText + (dyArial8 * 3) / 2;
    yText = rcData.top;
    if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities == 0) {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 0x12) {
        ids = 0x3a2;
        c = CchGetString(idsPartAlsoActs10CloakIncreasesTorpedo,(char *)szWork);
        SelectObject(hdc,rghfontArial7[0]);
        sVar3 = DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
        rcData.top = rcData.top + sVar3;
        c = CchGetString(idsWeaponCanAlsoBombPlanets2Colonists,(char *)szWork);
        DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
      }
    }
    else {
      SelectObject(hdc,rghfontArial7[0]);
      if ((((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities & 1U) != 0) {
        c = CchGetString(idsWeaponWillDamageShieldsHasEffectArmor,(char *)szWork)
        ;
        sVar3 = DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
        rcData.top = rcData.top + sVar3;
      }
      if ((((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities & 2U) != 0) {
        c = CchGetString(idsWeaponHitsTargetsRangeEachTimeFired,(char *)szWork);
        sVar3 = DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
        rcData.top = rcData.top + sVar3;
        iVar5 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp << 4;
        pcVar4 = PszGetCompressedString(idsWeaponAlsoMakesExcellentMineSweeperCapable);
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),iVar5);
        DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
      }
      SelectObject(hdc,rghfontArial8[0]);
    }
    if (((ppart->hs).wFlags_0x2 & 0xff) == 2) {
      ids = 0x155;
    }
    else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0xe) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x10))
    {
      ids = 0x156;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstTorp) {
    ExpandRc(&rcData,-4,-4);
    rgch = (char  [2])((rcData.right - rcData.left) / 3 + rcData.left);
    yText = rcData.top;
    c = CchGetString(idsPower,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsRange,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsInitiative,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsAccuracy,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,(short)rgch,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities);
    TextOut(hdc,(short)rgch,yText,szWork,c);
    yText = yText + (dyArial8 * 3) / 2;
    if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
      ids = 0x3a2;
    }
    else if ((7 < ((ppart->hs).wFlags_0x2 & 0xff)) && (((ppart->hs).wFlags_0x2 & 0xff) < 0xc)) {
      ids = 0x529;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstBomb) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    dyText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 9) {
      c = CchGetString
                    (idsBombDoesKillColonistsDestroyInstallationsBomb,(char *)szWork);
    }
    else if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == 0) {
      c = CchGetString(idsBombWillKillAnyPlanetsPopulation,(char *)szWork);
    }
    else {
      CchGetString(idsBombWillKillApproximatelyDDPlanets,(char *)szWork);
      c = _WSPRINTF((char *)CONCAT22(unaff_SS,szT),szWork,
                    ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp / 10,
                    ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp % 10);
      if (((ppart->hs).wFlags_0x2 & 0xff) < 5) {
        dmgFloor = 3;
      }
      else if ((((ppart->hs).wFlags_0x2 & 0xff) < 10) || (0xe < ((ppart->hs).wFlags_0x2 & 0xff))) {
        dmgFloor = 0;
      }
      else {
        dmgFloor = 999;
      }
      if (dmgFloor != 0) {
        if (dmgFloor == 999) {
          ids_00 = idsSmartBombsStrictlyAdditiveHaveMinimumKill;
        }
        else {
          ids_00 = idsIfPlanetHasDefensesBombGuaranteedKill;
        }
        CchGetString(ids_00,(char *)szWork);
        sVar3 = _WSPRINTF((char *)CONCAT22(unaff_SS,szT + c),szWork,dmgFloor * 100);
        c = c + sVar3;
      }
      _strcpy((char *)szWork,szT);
    }
    WrapTextOut
              (hdc,&xText,&dyText,(char *)szWork,c,rcData.left,rcData.right - rcData.left,
               (short *)0x0,0,1);
    xText = rcData.left;
    dyText = dyText + (dyArial8 >> 1);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 9) {
      ids = 0x15f;
    }
    else {
      if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init == 0) {
        c = CchGetString(idsBombWillDamagePlanetsMinesFactories,(char *)szWork);
      }
      else {
        CchGetString(idsBombWillDestroyApproximatelyDPlanetsMines,szT);
        c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),
                      ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
      }
      WrapTextOut
                (hdc,&xText,&dyText,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,1,1);
      if ((((ppart->hs).wFlags_0x2 & 0xff) < 10) || (0xe < ((ppart->hs).wFlags_0x2 & 0xff))) {
        if (((ppart->hs).wFlags_0x2 & 0xff) == 8) {
          ids = 0x3a2;
        }
      }
      else {
        ids = 0x41;
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstMining) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText__34 = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
    case 5:
      ids = 0x14e;
    case 2:
    case 3:
    case 4:
      if (ids == -1) {
        ids = 0x150;
      }
    case 1:
    case 6:
      c = CchGetString(idsModuleContainsRobotsCapableMining,(char *)szWork);
      sVar3 = _WSPRINTF((char *)CONCAT22(0x1120,(char *)szWork + c),
                        (char *)CONCAT22(0x1120,PCTD),
                        ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
      c = c + sVar3;
      sVar3 = CchGetString
                        (idsKtEachMineralDependingConcentrationUninhabitedPl,
                         (char *)szWork + c);
      c = c + sVar3;
      if (((ppart->hs).wFlags_0x2 & 0xff) == 6) {
        ids = 0x3a2;
        sVar3 = CchGetString(idsModuleAlsoActs30Cloak30Jammer,(char *)szWork + c)
        ;
        c = c + sVar3;
      }
      break;
    case 7:
      ids = 0x15f;
      c = CchGetString
                    (idsModifiedMiningRobotTerraformsInhabitedPlanets1,(char *)szWork);
      break;
    default:
      goto switchD_10d8_5c55_default;
    }
    goto RESEARCH_PrintSpecial;
  }
  if (HVar1 == hstMines) {
    dxWarp = -1;
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText__34 = rcData.left;
    yText = rcData.top;
    rcData.top = rcData.top + dyArial8 * 5;
    for (i = 4; -1 < i; i = i + -1) {
      rcData.top = rcData.top - dyArial8;
      c = CchGetString(i + idsMinesLaidPerYear,(char *)szWork);
      if (dxWarp == -1) {
        DVar12 = GetTextExtent(hdc,szWork,c);
        dxWarp = (short)DVar12;
      }
      RightTextOut(hdc,rcData.left + dxWarp,rcData.top,(char *)szWork,c,0);
    }
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
    case 1:
    case 2:
    case 3:
      dxDigit__54 = 4;
      y__58 = 3;
      rcT = (char *)((int)(ulong *)rgcrPlrHistory + 0x36);
      dyPct = 0x7d;
      rgch[0] = -0xc;
      rgch[1] = '\x01';
      pct__62 = 600;
      if (((ppart->hs).wFlags_0x2 & 0xff) == 1) {
        ids = 0x514;
      }
      else {
        ids = 0x151;
      }
      break;
    case 4:
    case 5:
    case 6:
      dxDigit__54 = 6;
      y__58 = 10;
      rcT = (char *)szMine + 8;
      dyPct = 600;
      rgch[0] = -0x30;
      rgch[1] = '\a';
      pct__62 = 0x9c4;
      ids = 0x151;
      break;
    case 7:
    case 8:
    case 9:
      dxDigit__54 = 5;
      y__58 = 0x23;
      rcT = (char *)0x0;
      dyPct = 0;
      rgch[0] = '\0';
      rgch[1] = '\0';
      pct__62 = 0;
      if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
        ids = 0x152;
      }
      else {
        ids = 0x151;
      }
    }
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp * 10);
    TextOut(hdc,rcData.left + dxWarp + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    sVar3 = dxDigit__54;
    pcVar4 = PszGetCompressedString(idsWarpD2);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),sVar3);
    TextOut(hdc,rcData.left + dxWarp + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    iVar11 = y__58 % 10;
    iVar5 = y__58 / 10;
    pcVar4 = PszGetCompressedString(idsDD2);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),iVar5,iVar11);
    TextOut(hdc,rcData.left + dxWarp + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    pcVar4 = rcT;
    sVar3 = dyPct;
    pcVar6 = PszGetCompressedString(idsDDEngine);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar6),pcVar4,sVar3);
    TextOut(hdc,rcData.left + dxWarp + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    acVar20 = rgch;
    sVar3 = pct__62;
    pcVar4 = PszGetCompressedString(idsDD3);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),acVar20,sVar3);
    TextOut(hdc,rcData.left + dxWarp + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    SelectObject(hdc,rghfontArial7[0]);
    c = CchGetString
                  (idsNumbersParenthesisFleetsContainingShipRamScoop,(char *)szWork);
    DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,&rcData),0x810);
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstSpecialSB) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText__34 = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
    case 2:
    case 3:
      ids = 0x42;
      idsT = 0x2e0;
      break;
    case 1:
    case 4:
    case 5:
    case 6:
      ids = 0x2e;
      idsT = 0x2e0;
      break;
    case 7:
    case 8:
    case 10:
    case 0xb:
    case 0xd:
    case 0xe:
    case 0xf:
      ids = 0x2f;
    case 9:
    case 0xc:
      idsT = 0x2e1;
      break;
    default:
      idsT = -1;
    }
    c = CchGetString(idsT,(char *)szWork);
    WrapTextOut
              (hdc,&xText__34,&yText,(char *)szWork,c,rcData.left,
               rcData.right - rcData.left,(short *)0x0,0,1);
    xText__34 = rcData.left;
    yText = yText + (dyArial8 * 3) / 2;
    if (idsT == 0x2e0) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar22 = 1;
      sVar3 = 0;
      pcVar4 = PszGetCompressedString(idsSafeHullMass);
      DxStreamTextOut(hdc,&xText__34,yText,pcVar4,sVar3,sVar22);
      SelectObject(hdc,rghfontArial8[0]);
      if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTDKT),
                      ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
      }
      DxStreamTextOut(hdc,&xText__34,yText,(char *)szWork,c,1);
      xText__34 = rcData.left;
      yText = yText + dyArial8;
      SelectObject(hdc,rghfontArial8[1]);
      sVar22 = 1;
      sVar3 = 0;
      pcVar4 = PszGetCompressedString(idsSafeRange);
      DxStreamTextOut(hdc,&xText__34,yText,pcVar4,sVar3,sVar22);
      SelectObject(hdc,rghfontArial8[0]);
      if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        sVar3 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp;
        pcVar4 = PszGetCompressedString(idsDLightYears);
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),sVar3);
      }
      DxStreamTextOut(hdc,&xText__34,yText,(char *)szWork,c,1);
      if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == -1) {
        if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == -1) {
          idsT = -1;
        }
        else {
          iVar5 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp * 5;
          pcVar4 = PszGetCompressedString(idsWarningShipsCanSuccessfullyGatedDL);
          c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),iVar5);
        }
      }
      else if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == -1) {
        iVar5 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp * 5;
        pcVar4 = PszGetCompressedString(idsWarningShipsDktCanSuccessfullyGatedExceeding);
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),iVar5);
      }
      else {
        iVar5 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp * 5;
        iVar11 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp * 5;
        pcVar4 = PszGetCompressedString(idsWarningShipsDktMightSuccessfullyGatedD);
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),iVar11,iVar5);
      }
    }
    else if (idsT == 0x2e1) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar22 = 1;
      sVar3 = 0;
      pcVar4 = PszGetCompressedString(idsWarp);
      DxStreamTextOut(hdc,&xText__34,yText,pcVar4,sVar3,sVar22);
      SelectObject(hdc,rghfontArial8[0]);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                    ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
      DxStreamTextOut(hdc,&xText__34,yText,(char *)szWork,c,1);
      xText__34 = rcData.left;
      yText = yText + dyArial8;
      idsT = 0x457;
      if (7 < ((ppart->hs).wFlags_0x2 & 0xff)) {
        idsT = 0x458;
      }
      c = CchGetString(idsT,(char *)szWork);
    }
    if (idsT != -1) {
      xText__34 = rcData.left;
      if (dyArial8 < 0xf) {
        iVar5 = 4;
      }
      else {
        iVar5 = 0;
      }
      yText = yText + iVar5 + dyArial8;
      SelectObject(hdc,rghfontArial7[0]);
      SetTextColor(hdc,0x7f);
      WrapTextOut
                (hdc,&xText__34,&yText,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,0,1);
      SelectObject(hdc,rghfontArial8[0]);
      SetTextColor(hdc,0);
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstSBHull) {
    ExpandRc(&rcData,-4,-4);
    idsT = 0x4a;
    dyPct = rcData.left;
    rgch[0] = (undefined1)rcData.top;
    rgch[1] = rcData.top._1_1_;
    if ((((ppart->hs).wFlags_0x2 & 0xff) == 1) || (((ppart->hs).wFlags_0x2 & 0xff) == 3)) {
      ids = 0x2dd;
    }
    else if (((ppart->hs).wFlags_0x2 & 0xff) == 4) {
      ids = 0x15a;
    }
    SelectObject(hdc,rghfontArial8[0]);
    if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == 0) {
      c = CchGetString(idsStarbaseHullDoesHaveSpaceDockCan,(char *)szWork);
      WrapTextOut
                (hdc,&dyPct,(short *)rgch,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,0,1);
      rgch = (char  [2])(dyArial8 * 3 + rcData.top);
    }
    else {
      c = CchGetString(idsStarbaseHullHasSpaceDockCanBuild,(char *)szWork);
      WrapTextOut
                (hdc,&dyPct,(short *)rgch,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,0,1);
      SelectObject(hdc,rghfontArial8[1]);
      rgch = (char  [2])(dyArial8 * 3 + rcData.top);
      dyPct = (rcData.right - rcData.left) / 2 + rcData.left;
      c = CchGetString(idsDockCapacity2,(char *)szWork);
      RightTextOut(hdc,dyPct,(short)rgch,(char *)szWork,c,0);
      SelectObject(hdc,rghfontArial8[0]);
      if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTDKT),
                      ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
      }
      TextOut(hdc,dyPct,(short)rgch,szWork,c);
    }
    rgch = (char  [2])((int)rgch + (dyArial8 * 3) / 2);
    dyPct = (rcData.right - rcData.left) / 2 + rcData.left;
    for (i = 0; i < 2; i = i + 1) {
      c = CchGetString(idsT,(char *)szWork);
      SelectObject(hdc,rghfontArial8[1]);
      RightTextOut(hdc,dyPct,(short)rgch,(char *)szWork,c,0);
      SelectObject(hdc,rghfontArial8[0]);
      if (i == 0) {
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                      ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
      }
      else if (i == 1) {
        pHVar15 = LphuldefFromId((&ppart->u_PART_0x0004)->phul->ihuldef);
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                      ((HULDEF *)pHVar15)->wFlags_0x7b & 0x3f);
      }
      TextOut(hdc,dyPct,(short)rgch,szWork,c);
      idsT = idsT + 1;
      rgch = (char  [2])((int)rgch + (dyArial8 * 3) / 2);
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 != hstSpecialE) {
    if (HVar1 != hstSpecialM) {
      if (HVar1 == hstTerra) {
        ExpandRc(&rcData,-4,-4);
        SelectObject(hdc,rghfontArial8[1]);
        dmgFloor = rcData.left;
        dyText = rcData.top;
        SelectObject(hdc,rghfontArial8[0]);
        c = 0;
        if (((ppart->hs).wFlags_0x2 & 0xff) < 8) {
          ids = 0x15c;
          c = CchGetString(idsAllowsModifyAnyPlanetsThreeEnvironmentVariables,szT);
          c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),
                        ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
        }
        else {
          c = CchGetString(idsAllowsModifyPlanetsSDOriginalValue,szT);
          c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),
                        *(undefined2 *)
                         (((int)(((ppart->hs).wFlags_0x2 & 0xff) - 8) / 4) * 2 + 0x47e),0x1120,
                        ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
        }
        if (0 < c) {
          WrapTextOut
                    (hdc,&dmgFloor,&dyText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
      }
      else if (HVar1 == hstHull) {
        ExpandRc(&rcData,-4,-4);
        dyPct = (rcData.right - rcData.left) / 2 + rcData.left;
        rgch[0] = 'H';
        rgch[1] = '\0';
        if ((((ppart->hs).wFlags_0x2 & 0xff) == 0xe) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x1f)) {
          ids = 0x153;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 3) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x19)
                ) {
          ids = 0x159;
        }
        else if (((ppart->hs).wFlags_0x2 & 0xff) == 0x17) {
          ids = 0x154;
        }
        else if (((((ppart->hs).wFlags_0x2 & 0xff) == 0x14) ||
                 (((ppart->hs).wFlags_0x2 & 0xff) == 0x16)) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x18)) {
          ids = 0x14f;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 10) || (((ppart->hs).wFlags_0x2 & 0xff) == 8))
        {
          ids = 0x157;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0xc) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x12)) {
          ids = 0x158;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0x1b) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x1c)) {
          ids = 0x165;
        }
        else if (((((ppart->hs).wFlags_0x2 & 0xff) == 4) || (((ppart->hs).wFlags_0x2 & 0xff) == 5))
                || (((ppart->hs).wFlags_0x2 & 0xff) == 6)) {
          ids = 0x30;
        }
        else if (((ppart->hs).wFlags_0x2 & 0xff) == 0x1e) {
          ids = 0x3a3;
        }
        for (i = 0; i < 4; i = i + 1) {
          c = CchGetString((StringId)rgch,(char *)szWork);
          SelectObject(hdc,rghfontArial8[1]);
          RightTextOut(hdc,dyPct,rcData.top,(char *)szWork,c,0);
          SelectObject(hdc,rghfontArial8[0]);
          if (i == 0) {
            c = _WSPRINTF(szWork,(char *)0x11200d2c,
                          ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp);
          }
          else if (i == 1) {
            c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTDKT),
                          ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
          }
          else if (i == 2) {
            c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                          ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
          }
          else if (i == 3) {
            pHVar15 = LphuldefFromId((&ppart->u_PART_0x0004)->phul->ihuldef);
            c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                          ((HULDEF *)pHVar15)->wFlags_0x7b & 0x3f);
          }
          TextOut(hdc,dyPct,rcData.top,szWork,c);
          rgch = (char  [2])((int)rgch + 1);
          rcData.top = rcData.top + (dyArial8 * 3) / 2;
        }
        if ((((ppart->hs).wFlags_0x2 & 0xff) == 0x19) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x1a))
        {
          rcT = PszGetCompressedString(idsHullWillManufacture200UnitsFuelEach);
          if (((ppart->hs).wFlags_0x2 & 0xff) == 0x19) {
            dxDigit__54 = 5;
          }
          else {
            dxDigit__54 = 10;
          }
          c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,rcT),dxDigit__54);
          SelectObject(hdc,rghfontArial8[0]);
          dyPct = rcData.left;
          yText = rcData.top;
          WrapTextOut
                    (hdc,&dyPct,&yText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0x1b) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x1c)) {
          c = CchGetString
                        (idsHullWillDoubleEfficiencyMineLayingPods,(char *)szWork);
          SelectObject(hdc,rghfontArial8[0]);
          dyPct = rcData.left;
          yText = rcData.top;
          WrapTextOut
                    (hdc,&dyPct,&yText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
      }
      else if (HVar1 == hstPlanetary) {
        ExpandRc(&rcData,-4,-4);
        SelectObject(hdc,rghfontArial8[1]);
        dmgFloor = rcData.left;
        dyText = rcData.top;
        SelectObject(hdc,rghfontArial8[0]);
        c = 0;
        if ((((ppart->hs).wFlags_0x2 & 0xff) < 9) || (0xd < ((ppart->hs).wFlags_0x2 & 0xff))) {
          if (((ppart->hs).wFlags_0x2 & 0xff) < 9) {
            i = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
            c = CchGetString(idsEnemyFleetsOrbitingPlanetCanDetectedD,szT);
            sVar3 = _abs(i);
            c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),sVar3);
            if (i < 0) {
              WrapTextOut
                        (hdc,&dmgFloor,&dyText,(char *)szWork,c,rcData.left,
                         rcData.right - rcData.left,(short *)0x0,0,1);
              dmgFloor = rcData.left;
              dyText = dyText + (dyArial8 * 3) / 2;
              c = CchGetString(idsScannerCanDeterminePlanetsBasicStatsDistance,szT);
              c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),-i >> 1);
              ids = 0x164;
            }
            else {
              ids = 0x4ef;
            }
          }
          else if (((ppart->hs).wFlags_0x2 & 0xff) == 0xe) {
            ids = 0x3a4;
            c = CchGetString
                          (idsProcessGivesPlanetNewBirthTracesCivilization,(char *)szWork)
            ;
          }
        }
        else {
          SelectObject(hdc,rghfontArial8[1]);
          rcData.right = rcData.right + -2;
          c = CchGetString(idsShieldCoverageVsDefenseQuan,(char *)szWork);
          CtrTextOut(hdc,(rcData.right - rcData.left >> 1) + rcData.left,rcData.top,
                              (char *)szWork,c);
          rcData.top = rcData.top + dyArial8;
          sVar3 = CchGetString(idsNum,szT);
          DVar12 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),(int)(char)sVar3);
          dxStr = (short)DVar12;
          iVar5 = (((rcData.right - rcData.left) - dxStr) + -10) / 5;
          xText = (((rcData.bottom - rcData.top) - dyArial8) + -8) / 5;
          PatBlt(hdc,rcData.left + dxStr + 6,rcData.top,1,
                 ((rcData.bottom - rcData.top) - dyArial8) + -4,0x42);
          PatBlt(hdc,rcData.left + dxStr + 6,(rcData.bottom - dyArial8) + -4,
                 ((rcData.right - rcData.left) - dxStr) + -6,1,0x42);
          iVar11 = rcData.left + dxStr;
          y = (rcData.bottom - dyArial8) + -4 + xText * -5;
          SetTextColor(hdc,0x7f0000);
          sVar3 = CchGetString(idsStandard,(char *)szWork);
          RightTextOut
                    (hdc,rcData.right,rcData.bottom + -3 + dyArial8 * -3,
                     (char *)szWork,(int)(char)sVar3,0);
          SetTextColor(hdc,0x7f);
          sVar3 = CchGetString(idsSmart,(char *)szWork);
          RightTextOut
                    (hdc,rcData.right,rcData.bottom + -4 + dyArial8 * -2,
                     (char *)szWork,(int)(char)sVar3,0);
          pct = 100;
          SetTextColor(hdc,0);
          for (; 0 < pct; pct = pct + -0x14) {
            c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTDPCTPCT),pct);
            RightTextOut
                      (hdc,iVar11,y - (dyArial8 >> 1),(char *)szWork,c,0);
            PatBlt(hdc,iVar11 + 4,y,5,1,0x42);
            y = y + xText;
          }
          iVar7 = rcData.bottom - dyArial8;
          sVar3 = 0;
          cLen = _strlen(szT);
          RightTextOut(hdc,iVar11,iVar7,szT,cLen,sVar3);
          x = iVar11 + 6;
          DVar12 = GetTextExtent(hdc,(LPCSTR)0x11200d31,1);
          iVar11 = (int)DVar12;
          for (i = 0; i < 6; i = i + 1) {
            sVar3 = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),i * 0x14);
            if (i == 0) {
              iVar8 = iVar11 >> 1;
            }
            else {
              iVar8 = iVar11;
              if (i == 5) {
                iVar8 = (iVar11 * 3) / 2;
              }
            }
            TextOut(hdc,x - iVar8,iVar7,szWork,(int)(char)sVar3);
            if (0 < i) {
              PatBlt(hdc,x,iVar7 + -6,1,5,0x42);
            }
            x = x + iVar5;
          }
          HVar9 = SelectObject(hdc,hpenDkBlue);
          iVar11 = rcData.left + dxStr;
          iVar7 = rcData.bottom - dyArial8;
          ldelta = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
          for (c = 0; ldelta = 1000 - ldelta, c < 2; c = c + 1) {
            uVar18 = 1000000;
            i = 0;
            while( true ) {
              local_138 = (int)(uVar18 >> 0x10);
              lpct = (uint)uVar18;
              if (100 < i) break;
              sVar3 = MulDiv(i,iVar5,0x14);
              iVar10 = sVar3 + iVar11 + 6;
              uVar23 = 3;
              uVar19 = 0xd40;
              uVar16 = __aFulmul(CONCAT22((0xf - local_138) - (uint)(0x4240 < lpct),
                                                  0x4240 - lpct),(long)xText);
              lVar17 = __aFldiv(uVar16,CONCAT22(uVar23,uVar19));
              iVar8 = (iVar7 + -4) - (int)lVar17;
              uVar23 = 0;
              uVar19 = 1000;
              uVar18 = __aFulmul(uVar18,(long)ldelta);
              uVar18 = __aFldiv(uVar18,CONCAT22(uVar23,uVar19));
              if (i == 0) {
                MoveTo(hdc,iVar10,iVar8);
              }
              else {
                LineTo(hdc,iVar10,iVar8);
              }
              i = i + 1;
            }
            ldelta = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp / 2;
            SelectObject(hdc,hpenRadar);
          }
          SelectObject(hdc,HVar9);
          c = 0;
          if (((ppart->hs).wFlags_0x2 & 0xff) < 0xb) {
            ids = 0x4ef;
          }
          else {
            ids = 0x15b;
          }
        }
        if (0 < c) {
          WrapTextOut
                    (hdc,&dmgFloor,&dyText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
      }
      goto switchD_10d8_5c55_default;
    }
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText__34 = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
      idsT = 0xd7;
      ids = 0x15d;
      break;
    case 1:
      idsT = 0xd8;
      ids = 0x15e;
      break;
    case 2:
    case 3:
      if (((ppart->hs).wFlags_0x2 & 0xff) == 2) {
        uVar19 = 0x32;
      }
      else {
        uVar19 = 100;
      }
      pcVar4 = PszGetCompressedString(idsPodIncreasesCargoCapacityShipDkt);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),uVar19);
      goto RESEARCH_PrintSpecial;
    case 4:
      idsT = 0xd6;
      ids = 0x3a2;
      break;
    case 5:
    case 6:
      if (((ppart->hs).wFlags_0x2 & 0xff) == 5) {
        uVar19 = 0xfa;
      }
      else {
        uVar19 = 500;
      }
      pcVar4 = PszGetCompressedString(idsPodIncreasesFuelCapacityShipDmg);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),uVar19);
      goto RESEARCH_PrintSpecial;
    case 7:
    case 8:
      if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
        uVar19 = 4;
      }
      else {
        uVar19 = 2;
      }
      pcVar4 = PszGetCompressedString(idsIncreasesSpeedBattle1DSquareMovement);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),uVar19);
      goto RESEARCH_PrintSpecial;
    case 9:
      idsT = 0xd9;
      ids = 0x3a2;
      break;
    case 10:
      idsT = 0xda;
      break;
    default:
      idsT = -1;
    }
    if (idsT == -1) goto switchD_10d8_5c55_default;
    c = CchGetString(idsT,(char *)szWork);
    goto RESEARCH_PrintSpecial;
  }
  ExpandRc(&rcData,-4,-4);
  SelectObject(hdc,rghfontArial8[1]);
  xText__34 = rcData.left;
  yText = rcData.top;
  SelectObject(hdc,rghfontArial8[0]);
  switch((ppart->hs).wFlags_0x2 & 0xff) {
  case 0:
    idsT = 0xdb;
    ids = 0x39;
    break;
  case 1:
  case 2:
  case 3:
    if (((ppart->hs).wFlags_0x2 & 0xff) == 3) {
      ids = 0x39;
      idsT = 0x55;
    }
    else if (((ppart->hs).wFlags_0x2 & 0xff) == 1) {
      idsT = 0x23;
    }
    else {
      idsT = 0x37;
    }
    sVar3 = idsT;
    pcVar4 = PszGetCompressedString(idsCloaksAnyShipReducingRangeWhichScanners);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),sVar3);
    goto RESEARCH_PrintSpecial;
  case 4:
    idsT = 0xdd;
    ids = 0x3a2;
    break;
  case 5:
  case 6:
  case 7:
    idsT = 0x3a1;
    iVar5 = ((ppart->hs).wFlags_0x2 & 0xff) - 4;
    sVar3 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
    pcVar4 = PszGetCompressedString(idsModuleIncreasesAccuracyTorpedoesDIncreasesInitia);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),sVar3,iVar5);
    goto RESEARCH_PrintSpecial;
  case 8:
  case 0xb:
    ids = 0x39f;
  case 9:
  case 10:
    idsT = 0x3a0;
    sVar3 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
    pcVar4 = PszGetCompressedString(idsHasDChanceDeflectingIncomingTorpedoesDeflected);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),sVar3);
    goto RESEARCH_PrintSpecial;
  case 0xd:
    ids = 0x39a;
  case 0xc:
    if (((ppart->hs).wFlags_0x2 & 0xff) == 0xc) {
      uVar19 = 10;
    }
    else {
      uVar19 = 0x14;
    }
    pcVar4 = PszGetCompressedString(idsIncreasesDamageDoneBeamWeaponsShipD);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar4),uVar19);
    goto RESEARCH_PrintSpecial;
  case 0xe:
    ids = 0x398;
    idsT = 0x39b;
    break;
  case 0xf:
    ids = 0x397;
    idsT = 0x39c;
    break;
  case 0x10:
    ids = 0x399;
    idsT = 0x39d;
    break;
  default:
    idsT = -1;
  }
  if (idsT != -1) {
    c = CchGetString(idsT,(char *)szWork);
RESEARCH_PrintSpecial:
    WrapTextOut
              (hdc,&xText__34,&yText,(char *)szWork,c,rcData.left,
               rcData.right - rcData.left,(short *)0x0,0,1);
    xText__34 = rcData.left;
    yText = yText + dyArial8 * 2;
  }
switchD_10d8_5c55_default:
  if (ids != -1) {
    c = CchGetString(ids,(char *)szWork);
    SetRect((RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffc8),4,dy + dyArial8 * -2,dx + -4,
            dy + -5);
    if (dyArial8 < 0xf) {
      SelectObject(hdc,rghfontArial7[0]);
    }
    else {
      SelectObject(hdc,rghfontArial6[0]);
    }
    if (lVar13 == -1) {
      uVar2 = 0x7f;
    }
    else {
      uVar2 = 0;
    }
    SetTextColor(hdc,(ulong)uVar2);
    DRAWTEXT(hdc,szWork,c,(RECT *)CONCAT22(unaff_SS,(RECT *)&stack0xffc8),0x810);
    if (lVar13 == -1) {
      SetTextColor(hdc,0);
    }
  }
  return;
}



// ======================================================================
// Function: ProjectedResearchSpending
// Address: 10d8:65ae
// Segment: MEMORY_RESEARCH
// ======================================================================


long ProjectedResearchSpending(long pct)

{
  PLANET *pPVar1;
  undefined2 uVar2;
  bool bVar3;
  short cBogus;
  char pctSav;
  PLANET *lpplMac;
  undefined2 local_14;
  uint lSpend;
  int local_10;
  short cRes;
  PLANET *lppl;
  uint lRes;
  int local_6;
  
  lSpend = 0;
  local_10 = 0;
  pctSav = *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0);
  *(undefined1 *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) = (char)pct;
  lpplMac = (PLANET *)lpPlanets + cPlanet;
  local_14 = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < lpplMac) {
    if (((PLANET *)lppl)->iPlayer == idPlayer) {
      lRes = CResourcesAtPlanet(lppl,idPlayer);
      local_6 = (int)lRes >> 0xf;
      uVar2 = (undefined2)((ulong)lppl >> 0x10);
      pPVar1 = (PLANET *)lppl;
      if (((*(int *)&pPVar1->lpplprod == 0) && (*(int *)((int)&pPVar1->lpplprod + 2) == 0)) ||
         (((PLPROD *)pPVar1->lpplprod)->iprodMac == 0)) {
        bVar3 = CARRY2(lSpend,lRes);
        lSpend = lSpend + lRes;
        local_10 = local_10 + local_6 + (uint)bVar3;
      }
      else {
        EstimateItemProdSched(lppl,(PLPROD *)0x0,-1,&cRes,&cBogus);
        bVar3 = CARRY2(lSpend,cRes);
        lSpend = lSpend + cRes;
        local_10 = local_10 + (cRes >> 0xf) + (uint)bVar3;
      }
    }
    lppl = (PLANET *)CONCAT22(lppl._2_2_,(PLANET *)lppl + 1);
  }
  *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) = pctSav;
  return CONCAT22(local_10,lSpend);
}



// ======================================================================
// Function: CostOfDevelopingItem
// Address: 10d8:66e0
// Segment: MEMORY_RESEARCH
// ======================================================================


long CostOfDevelopingItem(char *rgTech)

{
  long lVar1;
  long lVar2;
  undefined2 *puVar3;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar4;
  long lVar5;
  short i;
  short fUnreachable;
  char rgTechSav [6];
  char *pTech;
  undefined4 lSpent;
  
  lVar5 = CONCAT22(unaff_SI,unaff_DI);
  lVar2 = 0;
  pTech = (char *)((int)rgplr[0].rgTech + idPlayer * 0xc0);
  i = 0;
  while( true ) {
    if ((5 < i) || ('\x1a' < ((char *)rgTech)[i])) break;
    i = i + 1;
  }
  if (i < 6) {
    lVar2 = -1;
  }
  else {
    for (i = 0; i < 6; i = i + 1) {
      rgTechSav[i] = pTech[i];
      if ((int)pTech[i] < (int)((char *)rgTech)[i]) {
        puVar3 = (undefined2 *)(idPlayer * 0xc0 + 0x59c2 + i * 4);
        lSpent._0_2_ = *puVar3;
        lSpent._2_2_ = puVar3[1];
        lVar4 = CONCAT22(lSpent._2_2_,(int)lSpent);
        if ((game.wCrap >> 1 & 1) != 0) {
          lVar4 = __aFlshl(lVar5,(int)((char *)rgTech)[i]);
          lSpent = lVar4;
        }
        lSpent._2_2_ = (int)((ulong)lVar4 >> 0x10);
        lSpent._0_2_ = (int)lVar4;
        lVar1 = CONCAT22(-(lSpent._2_2_ + (uint)((int)lSpent != 0)),-(int)lSpent);
        lSpent = lVar4;
        while (pTech[i] < ((char *)rgTech)[i]) {
          lVar4 = GetTechLevelCost(i,pTech[i] + 1,idPlayer);
          lVar1 = lVar4 + lVar1;
          pTech[i] = pTech[i] + '\x01';
        }
        if ((lVar1 < 0x10000) && (lVar1 < 0)) {
          lVar1 = 0;
        }
        lVar2 = lVar1 + lVar2;
      }
    }
    for (i = 0; i < 6; i = i + 1) {
      pTech[i] = rgTechSav[i];
    }
  }
  return lVar2;
}



// ======================================================================
// Function: FShouldPartBeHidden
// Address: 10d8:68c4
// Segment: MEMORY_RESEARCH
// ======================================================================


short FShouldPartBeHidden(PART *ppart)

{
  HullSlotType HVar1;
  uint uVar2;
  short sVar3;
  ushort grbitTrader;
  short iItem;
  
  if (idPlayer == -1) {
    sVar3 = 0;
  }
  else {
    grbitTrader = 0;
    uVar2 = (ppart->hs).wFlags_0x2 & 0xff;
    HVar1 = (ppart->hs).grhst;
    if (HVar1 == hstEngine) {
      if (uVar2 == 8) {
        grbitTrader = 0x200;
      }
    }
    else if (HVar1 == hstShield) {
      if (uVar2 == 6) {
        grbitTrader = 4;
      }
    }
    else if (HVar1 == hstArmor) {
      if (uVar2 == 9) {
        grbitTrader = 8;
      }
    }
    else if (HVar1 == hstBeam) {
      if (uVar2 == 0x12) {
        grbitTrader = 0x80;
      }
    }
    else if (HVar1 == hstTorp) {
      if (uVar2 == 7) {
        grbitTrader = 0x40;
      }
    }
    else if (HVar1 == hstBomb) {
      if (uVar2 == 8) {
        grbitTrader = 0x20;
      }
    }
    else if (HVar1 == hstMining) {
      if (uVar2 == 6) {
        grbitTrader = 0x10;
      }
    }
    else if (HVar1 == hstSpecialE) {
      if (uVar2 == 4) {
        grbitTrader = 2;
      }
    }
    else if (HVar1 == hstSpecialM) {
      if (uVar2 == 4) {
        grbitTrader = 1;
      }
      else if (uVar2 == 9) {
        grbitTrader = 0x800;
      }
    }
    else if (HVar1 == hstHull) {
      if (uVar2 == 0x1e) {
        grbitTrader = 0x100;
      }
    }
    else if ((HVar1 == hstPlanetary) && (uVar2 == 0xe)) {
      grbitTrader = 0x400;
    }
    if ((grbitTrader == 0) ||
       ((*(uint *)((int)&rgplr[0].grbitTrader + idPlayer * 0xc0) & grbitTrader) !=
        0)) {
      sVar3 = 0;
    }
    else {
      sVar3 = 1;
    }
  }
  return sVar3;
}



