// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: ResearchDlg
// Address: 10d8:0000
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short ResearchDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  long lVar1;
  HGDIOBJ HVar2;
  short sVar3;
  char *pcVar4;
  uint uVar5;
  HWND HVar6;
  UINT UVar7;
  HBRUSH HVar8;
  PLANET *pPVar9;
  ushort unaff_SI;
  ushort unaff_DI;
  undefined2 uVar10;
  undefined2 unaff_SS;
  bool bVar11;
  DWORD DVar12;
  DWORD DVar13;
  ulong uVar14;
  LRESULT LVar15;
  HWND *in_stack_0000ffa4;
  undefined2 in_stack_0000ffa6;
  HDC HVar16;
  ushort in_stack_0000ffac;
  RECT rcWindow;
  char *psz;
  HFONT hfontSav;
  PLANET *lpplMac;
  short c;
  PLANET *lppl;
  short dxCurrent;
  HWND HStack_38;
  short fChg;
  RECT rc;
  short dx;
  PAINTSTRUCT ps;
  short i;
  short y;
  HDC hdc;
  
  if (message == WM_PAINT) {
    hdc = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    DrawResearchDlg(hwnd,hdc,&rc,-1);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    HVar8 = 1;
    lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
    goto LAB_10d8_0901;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    HVar8 = 1;
    lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
    goto LAB_10d8_0901;
  }
  if (message == WM_CTLCOLOR) {
    for (i = 0x431; i < 0x437; i = i + 1) {
      fChg = (short)lParam;
      HVar6 = GetDlgItem(hwnd,i);
      if (fChg == HVar6) break;
    }
    if ((i < 0x437) ||
       (uVar14 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffac), (int)uVar14 == 6)
       ) {
      SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
      HVar8 = hbrButtonFace;
      lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
      goto LAB_10d8_0901;
    }
  }
  else {
    if (message == WM_SETCURSOR) {
      in_stack_0000ffa4 = &HStack_38;
      in_stack_0000ffa6 = unaff_SS;
      GetCursorPos((HWND *)CONCAT22(unaff_SS,in_stack_0000ffa4));
      ScreenToClient(hwnd,(HWND *)CONCAT22(unaff_SS,&HStack_38));
      if ((((0xc < (int)HStack_38) && ((int)HStack_38 < dxResLeft + -0xc)) &&
          (yTopFutureTech <= fChg)) &&
         (fChg < cFutureTech * dyArial8 + yTopFutureTech)) {
        setcursor(hcurArrowHelp);
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
      if (((yTopTechNote != -1) && (yTopTechNote <= fChg)) &&
         ((fChg < dyArial8 * 2 + yTopTechNote &&
          (dxResLeft < (int)HStack_38)))) {
        setcursor(hcurArrowHelp);
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        pctResGlob =
             (short)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0);
        iResTechNow =
             (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf;
        CheckRadioButton(hwnd,0x431,0x436,iResTechNow + 0x431);
        fChg = GetDC(hwnd);
        HVar2 = SelectObject(fChg,rghfontArial8[1]);
        sVar3 = CchGetString(idsCurrent,(char *)szWork);
        DVar12 = GetTextExtent(fChg,szWork,sVar3);
        dxResRadio = 0;
        for (i = 0x431; i < 0x437; i = i + 1) {
          sVar3 = CchGetString(i - idsGoose,(char *)szWork);
          DVar13 = GetTextExtent(fChg,szWork,sVar3);
          sVar3 = (int)DVar13;
          if ((int)DVar13 <= dxResRadio) {
            sVar3 = dxResRadio;
          }
          dxResRadio = sVar3;
          HStack_38 = GetDlgItem(hwnd,i);
          SetWindowText(HStack_38,szWork);
          SendMessage(HStack_38,0x30,rghfontArial8[1],0);
        }
        dxResRadio = dxResRadio + 0x40;
        y = (dyArial8 * 4 - (dyArial8 >> 1)) + 1;
        for (i = 0x431; i < 0x437; i = i + 1) {
          HStack_38 = GetDlgItem(hwnd,i);
          SetWindowPos(HStack_38,0,0x10,y,dxResRadio,(dyArial8 * 3) / 2,0x44);
          y = y + (dyArial8 * 3) / 2;
        }
        HStack_38 = GetDlgItem(hwnd,0x43b);
        for (i = 0; i < 8; i = i + 1) {
          pcVar4 = PszGetCompressedString(i + idsSameField);
          SendMessage(HStack_38,0x403,0,(LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar4));
        }
        i = (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) >> 4;
        if (i == 6) {
          i = 0;
        }
        else if (i < 6) {
          i = i + 1;
        }
        SendMessage(HStack_38,0x40e,i,0);
        dxResLeft = dxResRadio + (int)DVar12 + 0x28;
        dxResRight = 0;
        for (i = 0x4c; i < 0x52; i = i + 1) {
          sVar3 = CchGetString(i,(char *)szWork);
          DVar12 = GetTextExtent(fChg,szWork,sVar3);
          sVar3 = (int)DVar12;
          if ((int)DVar12 <= dxResRight) {
            sVar3 = dxResRight;
          }
          dxResRight = sVar3;
        }
        dxResStrRight = dxResRight;
        HVar16 = fChg;
        pcVar4 = PszGetCompressedString(idsN9999992);
        DVar12 = GetTextExtent(HVar16,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar4),7);
        dxResRight = dxResRight + (int)DVar12 + 0x30;
        y = y + dyArial8 * 10;
        HVar6 = GetDlgItem(hwnd,2);
        SetWindowPos(HVar6,0,dxResLeft + dxResRight + -0x98,
                     (y - (dyArial8 * 3) / 2) + -8,0x46,(dyArial8 * 3) / 2,0x44)
        ;
        HVar6 = GetDlgItem(hwnd,0x76);
        SetWindowPos(HVar6,0,dxResLeft + dxResRight + -0x4c,
                     (y - (dyArial8 * 3) / 2) + -8,0x46,(dyArial8 * 3) / 2,0x44)
        ;
        GetWindowRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcWindow));
        GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
        SetWindowPos(hwnd,0,0,0,
                     ((dxResLeft + dxResRight + rcWindow.right) - rcWindow.left)
                     - rc.right,((y + rcWindow.bottom) - rcWindow.top) - rc.bottom,6);
        StickyDlgPos(hwnd,(POINT *)&ptStickyResDlg,1);
        SelectObject(fChg,HVar2);
        ReleaseDC(hwnd,fChg);
        lResTotal._0_2_ = 0;
        lResTotal._2_2_ = 0;
        pPVar9 = (PLANET *)lpPlanets + cPlanet;
        lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
        while ((PLANET *)lppl < pPVar9) {
          uVar10 = (undefined2)((ulong)lppl >> 0x10);
          if (((PLANET *)lppl)->iPlayer == idPlayer) {
            uVar5 = CResourcesAtPlanet(lppl,idPlayer);
            bVar11 = CARRY2((uint)lResTotal,uVar5);
            lResTotal._0_2_ = (uint)lResTotal + uVar5;
            lResTotal._2_2_ =
                 lResTotal._2_2_ + ((int)uVar5 >> 0xf) + (uint)bVar11;
          }
          lppl = (PLANET *)CONCAT22(uVar10,(PLANET *)lppl + 1);
        }
        lResBudget = ProjectedResearchSpending((long)pctResGlob);
        if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        HVar8 = 1;
        lVar1 = lResBudget;
        goto LAB_10d8_0901;
      }
      if (message != WM_COMMAND) {
        if ((message == WM_LBUTTONDOWN) || (message == WM_LBUTTONDBLCLK)) {
          uVar14 = __aFulshr(CONCAT22(unaff_DI,wParam),unaff_SI);
          HVar8 = FTrackResearchDlg(hwnd,(short)lParam,(short)uVar14,wParam);
          lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
          goto LAB_10d8_0901;
        }
        goto LAB_10d8_08fb;
      }
    }
    uVar14 = __aFulshr((ulong)CONCAT22(in_stack_0000ffa6,in_stack_0000ffa4),unaff_DI);
    if ((((int)uVar14 == 0) && (0x430 < wParam)) && (wParam < 0x437)) {
      UVar7 = IsDlgButtonChecked(hwnd,wParam);
      if (UVar7 != 0) {
        iResTechNow = wParam - 0x431;
        GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
        DrawResearchDlg(hwnd,0,&rc,4);
      }
    }
    else {
      if (wParam == 2) {
        HStack_38 = 0;
        HVar6 = GetDlgItem(hwnd,0x43b);
        LVar15 = SendMessage(HVar6,0x407,0,0);
        fChg = (short)LVar15;
        if (fChg == 0) {
          fChg = 6;
        }
        else if (fChg < 7) {
          fChg = fChg + -1;
        }
        if (((iResTechNow !=
              ((int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xfU))
            || (fChg != (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0)
                        >> 4)) ||
           (pctResGlob !=
            *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0))) {
          *(undefined1 *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) =
               (char)pctResGlob;
          *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
               *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
               (byte)iResTechNow;
          *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
               *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf |
               (byte)(fChg << 4);
          i = *(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) * 0x100 +
              pctResGlob;
          WriteMemRt(0x22,2,&i);
          HStack_38 = 1;
          if ((((uint)gd._0_2_ >> 0xb & 1) != 0) && (idPlayer == 0)) {
            tutor.wFlags = tutor.wFlags & 0xfffbU | 4;
            AdvanceTutor();
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyResDlg,0);
        EndDialog(hwnd,HStack_38);
        pctResGlob = -1;
        if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
      if (wParam == 0x76) {
        WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0x42e);
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
    }
  }
LAB_10d8_08fb:
  HVar8 = 0;
  lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
LAB_10d8_0901:
  lResBudget._2_2_ = (undefined2)((ulong)lVar1 >> 0x10);
  lResBudget._0_2_ = (undefined2)lVar1;
  return HVar8;
}



// ======================================================================
// Function: DrawResearchDlg
// Address: 10d8:090a
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cch */

void DrawResearchDlg(HWND hwnd,HDC hdc,RECT *prc,short grbitDraw)

{
  HS *pHVar1;
  byte bVar2;
  uint uVar3;
  HGDIOBJ HVar4;
  short sVar5;
  ushort uVar6;
  int x;
  HGDIOBJ HVar7;
  HWND HVar8;
  int iVar9;
  undefined2 *puVar10;
  int iVar11;
  uint unaff_SI;
  char *unaff_SS;
  bool bVar12;
  COLORREF CVar13;
  COLORREF CVar14;
  DWORD DVar15;
  long lVar16;
  long lVar17;
  char *pcVar18;
  undefined1 *puVar19;
  HDC HVar20;
  short sVar21;
  undefined2 uVar22;
  ulong uStack_c2;
  short cch;
  RECT rc;
  short iMin;
  long l;
  PART part;
  char szTemp2 [60];
  short dx;
  short xCtr;
  short xNum;
  HFONT hfontSav;
  COLORREF crForeSav;
  COLORREF crBackSav;
  short grbitCur;
  short c;
  short i;
  short mdAvail;
  short fCreatedDC;
  short iter;
  short iTechSav;
  short iMax;
  RECT rcT;
  char szTemp [60];
  short dxCurrent;
  
  uStack_c2 = (ulong)unaff_SI;
  bVar12 = hdc == 0;
  if (bVar12) {
    hdc = GetDC(hwnd);
  }
  HVar4 = SelectObject(hdc,rghfontArial8[1]);
  CVar13 = SetTextColor(hdc,0);
  CVar14 = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
  ;
  if ((grbitDraw & 0xffU) != 0) {
    sVar5 = CchGetString(idsCurrent,(char *)szWork);
    DVar15 = GetTextExtent(hdc,szWork,sVar5);
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),8,dyArial8,dxResLeft + -8,
            dyArial8 * 0xd);
    if ((grbitDraw & 3U) != 0) {
      _Draw3dFrame(hdc,&rc,-1);
      sVar5 = CchGetString(idsTechnologyStatus,(char *)szWork);
      TextOut(hdc,rc.left + 8,rc.top - (dyArial8 >> 1),szWork,sVar5);
      rc.top = rc.top + (dyArial8 >> 1);
      sVar5 = CchGetString(idsCurrent,(char *)szWork);
      TextOut(hdc,(rc.right + -8) - (int)DVar15,rc.top,szWork,sVar5);
      rc.top = rc.top + dyArial8;
      sVar5 = CchGetString(idsFieldStudy,(char *)szWork);
      TextOut(hdc,rc.left + 0x1a,rc.top,szWork,sVar5);
      iVar9 = (rc.right + -8) - ((int)DVar15 >> 1);
      sVar5 = CchGetString(idsLevel,(char *)szWork);
      CtrTextOut(hdc,iVar9,rc.top,(char *)szWork,sVar5);
      PatBlt(hdc,rc.left + 8,rc.top + dyArial8,(rc.right - rc.left) + -0x10,1,0x42);
      rc.top = rc.top + (dyArial8 >> 2) + dyArial8 + 2;
      for (i = 0; i < 6; i = i + 1) {
        sVar5 = _WSPRINTF((LPSTR)CONCAT22((int)*(char *)(idPlayer * 0xc0 + 0x59bc + i),
                                          (char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                          (char *)szWork);
        CtrTextOut(hdc,iVar9,rc.top,(char *)szWork,sVar5);
        rc.top = rc.top + (dyArial8 * 3) / 2;
      }
    }
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),8,(dyArial8 * 3) / 2 + rc.bottom,
            dxResLeft + -8,prc->bottom + -8);
    if (((grbitDraw & 4U) == 0) || ((grbitDraw & 3U) != 0)) {
      _Draw3dFrame(hdc,&rc,-1);
      sVar5 = CchGetString(idsExpectedResearchBenefits,(char *)szWork);
      TextOut(hdc,rc.left + 8,rc.top - (dyArial8 >> 1),szWork,sVar5);
      bVar2 = *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0);
      cFutureTech = 0;
      yTopFutureTech = rc.top + dyArial8;
      for (iter = 1; iter < 10; iter = iter + 1) {
        iMax = iter;
        if (iter == 1) {
          SetTextColor(hdc,0x7f00);
        }
        else if ((iter < 2) || (4 < iter)) {
          SetTextColor(hdc,0);
          if (iter == 9) {
            iMax = 0x1a;
          }
        }
        else {
          SetTextColor(hdc,0x7f0000);
        }
        grbitCur = 1;
        *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
             *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
             (byte)iResTechNow;
        for (; grbitCur != 0; grbitCur = grbitCur << 1) {
          if (grbitCur != 0) {
            i = 0;
            part.hs.grhst = grbitCur;
            while( true ) {
              part.hs.wFlags = part.hs.wFlags & 0xff00U | i & 0xffU;
              sVar5 = FLookupPart(&part);
              if ((sVar5 == 0) ||
                 (((part.hs.grhst == hstTerra &&
                   (sVar21 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                                ibitRaceTT), sVar21 != 0)) &&
                  (((part.hs.wFlags & 0xffU) == 8 ||
                   (((part.hs.wFlags & 0xffU) == 0xc || ((part.hs.wFlags & 0xffU) == 0x10))))))))
              break;
              if ((iter <= sVar5 + -1) && (sVar5 + -1 <= iMax)) {
                rc.top = rc.top + dyArial8;
                if (rc.bottom < rc.top + dyArial8) goto RESEARCH_TooManyToFinish;
                __fstrcpy(szWork,
                                  (char *)CONCAT22(part.pcom._2_2_,((COMPART *)part.pcom)->szName));
                iVar9 = rc.left + 8;
                puVar19 = (undefined1 *)&DAT_1120_1120;
                pcVar18 = (char *)szWork;
                sVar5 = rc.top;
                HVar20 = hdc;
                uVar6 = _strlen((char *)szWork);
                TextOut(HVar20,iVar9,sVar5,(LPCSTR)CONCAT22(puVar19,pcVar18),uVar6);
                if (cFutureTech < 8) {
                  iVar9 = cFutureTech * 4;
                  pHVar1 = (HS *)rghsFutureTech + cFutureTech;
                  cFutureTech = cFutureTech + 1;
                  pHVar1->grhst = part.hs.grhst;
                  *(short *)((int)&rghsFutureTech[0].wFlags + iVar9) = part.hs.wFlags;
                }
              }
              i = i + 1;
            }
          }
        }
      }
RESEARCH_TooManyToFinish:
      *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
           *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
           bVar2 & 0xf;
      SetTextColor(hdc,0);
    }
    else {
      ExpandRc(&rc,-6,-(dyArial8 >> 1));
      rc.top = rc.top + (dyArial8 >> 1);
      InvalidateRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc),1);
    }
  }
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),dxResLeft + 8,dyArial8,
          dxResLeft + dxResRight + -8,
          (dyArial8 * 0xe) / 2 + dyArial8);
  x = rc.left + 8 + dxResStrRight;
  iVar9 = x;
  DVar15 = GetTextExtent(hdc,(LPCSTR)0x11200d0e,6);
  iVar9 = (int)DVar15 + iVar9;
  if (((grbitDraw & 4U) != 0) && ((grbitDraw & 3U) == 0)) {
    ExpandRc(&rc,-6,-(dyArial8 >> 1));
    rc.top = rc.top + (dyArial8 >> 1);
    InvalidateRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc),1);
    goto RESEARCH_CleanUp;
  }
  if ((grbitDraw & 0x300U) != 0) {
    if (*(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) < '\x1a') {
      lVar16 = GetTechLevelCost(iResTechNow,
                                *(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) +
                                1,idPlayer);
      puVar10 = (undefined2 *)(idPlayer * 0xc0 + 0x59c2 + iResTechNow * 4);
      uVar6 = puVar10[1];
      uStack_c2 = CONCAT22(*puVar10,unaff_SI);
      if (((uint)game.wCrap >> 1 & 1) != 0) {
        lVar17 = __aFlshl(uStack_c2,uVar6);
        uVar6 = (ushort)((ulong)lVar17 >> 0x10);
        uStack_c2 = CONCAT22((int)lVar17,unaff_SI);
      }
      iVar11 = ((int)((ulong)lVar16 >> 0x10) - uVar6) - (uint)((uint)lVar16 < (uint)cch);
      if ((iVar11 < 1) && (iVar11 < 0)) {
        lVar16 = 0;
      }
      else {
        lVar16 = lVar16 - CONCAT22(uVar6,cch);
      }
    }
    else {
      lVar16 = -1;
    }
    l._2_2_ = (int)((ulong)lVar16 >> 0x10);
    l._0_2_ = (uint)lVar16;
    if (((grbitDraw & 0x200U) == 0) || ((grbitDraw & 0xfU) != 0)) {
      _Draw3dFrame(hdc,&rc,-1);
      sVar5 = CchGetString(idsCurrentlyResearching,(char *)szWork);
      TextOut(hdc,rc.left + 8,rc.top - (dyArial8 >> 1),szWork,sVar5);
      rc.top = rc.top + dyArial8;
      CchGetString(iResTechNow + idsEnergy,szTemp);
      CchGetString(idsSTechLevelD,szTemp2);
      sVar5 = _WSPRINTF((LPSTR)CONCAT22(szTemp,unaff_SS),
                        (LPCSTR)CONCAT22(szTemp2,(char *)&DAT_1120_1120),(char *)szWork);
      RightTextOut(hdc,x,rc.top,(char *)szWork,sVar5,0);
      rc.top = rc.top + (dyArial8 * 3) / 2;
      sVar21 = 0;
      sVar5 = 0;
      pcVar18 = PszGetCompressedString(idsResourcesNeededComplete);
      RightTextOut(hdc,x,rc.top,pcVar18,sVar5,sVar21);
      if (lVar16 == -1) {
        c = CchGetString(idsMaxed,(char *)szWork);
      }
      else {
        c = _WSPRINTF((LPSTR)CONCAT22((uint)l,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),(char *)szWork
                     );
      }
      TextOut(hdc,x,rc.top,szWork,c);
      rc.top = rc.top + (dyArial8 * 3) / 2;
      sVar21 = 0;
      sVar5 = 0;
      pcVar18 = PszGetCompressedString(idsEstimatedTimeCompletion);
      RightTextOut(hdc,x,rc.top,pcVar18,sVar5,sVar21);
    }
    else {
      rc.top = rc.top + ((dyArial8 * 3) / 2) * 2 + dyArial8;
      HVar7 = SelectObject(hdc,hbrButtonFace);
      PatBlt(hdc,x,rc.top,iVar9 - x,dyArial8,0xf00021);
      SelectObject(hdc,HVar7);
    }
    uVar3 = (uint)lResBudget;
    if (lVar16 == -1) {
      sVar5 = CchGetString(idsMaxed,(char *)szWork);
      TextOut(hdc,x,rc.top,szWork,sVar5);
    }
    else {
      if (lVar16 == 0) {
        lVar16 = 1;
      }
      else {
        if (((uint)lResBudget == 0) && (lResBudget._2_2_ == 0)) {
          sVar5 = CchGetString(idsNever2,(char *)szWork);
          TextOut(hdc,x,rc.top,szWork,sVar5);
          goto LAB_10d8_144a;
        }
        uStack_c2 = CONCAT22((uint)lResBudget,uVar22);
        uVar6 = lResBudget._2_2_;
        sVar5 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                   ibitRaceGeneralizedResearch);
        if (sVar5 != 0) {
          lVar16 = __aFlshr(uStack_c2,uVar6);
          uStack_c2 = CONCAT22(uVar3 - (uint)lVar16,uVar22);
          uVar6 = (uVar6 - (int)((ulong)lVar16 >> 0x10)) - (uint)(uVar3 < (uint)lVar16);
        }
        lVar16 = __aFldiv(CONCAT22(l._2_2_ + uVar6 + (uint)CARRY2((uint)l,cch) + -1 +
                                           (uint)((uint)l + cch != 0),(uint)l + cch + -1),
                                  CONCAT22(uVar6,cch));
      }
      l._0_2_ = (uint)lVar16;
      pcVar18 = PszGetCompressedString(idsLdYearC);
      sVar5 = _WSPRINTF((LPSTR)CONCAT22((uint)l,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(pcVar18,(char *)&DAT_1120_1120),(char *)szWork);
      TextOut(hdc,x,rc.top,szWork,sVar5);
    }
LAB_10d8_144a:
    sVar21 = 0;
    sVar5 = 0;
    pcVar18 = PszGetCompressedString(idsFieldResearch);
    RightTextOut(hdc,x + -0x3c,rc.top + dyArial8 + 5,pcVar18,sVar5,sVar21);
    HVar8 = GetDlgItem(hwnd,0x43b);
    GetClientRect(HVar8,(undefined2 *)CONCAT22(unaff_SS,&rcT));
    HVar8 = GetDlgItem(hwnd,0x43b);
    MapWindowPoints(HVar8,hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcT),2);
    if (rcT.top != rc.top + dyArial8 + 2) {
      HVar8 = GetDlgItem(hwnd,0x43b);
      SetWindowPos(HVar8,0,x + -0x3c,rc.top + dyArial8 + 2,(rc.right - x) + 0x32,
                   dyArial8 * 9,0xc);
    }
  }
  rc.top = (dyArial8 * 3) / 2 + rc.bottom;
  rc.bottom = dyArial8 * 8 + rc.top;
  if ((grbitDraw & 0x400U) != 0) {
    _Draw3dFrame(hdc,&rc,-1);
    sVar5 = CchGetString(idsResourceAllocation,(char *)szWork);
    TextOut(hdc,rc.left + 8,rc.top - (dyArial8 >> 1),szWork,sVar5);
  }
  rc.top = rc.top + dyArial8;
  if ((grbitDraw & 0x800U) != 0) {
    sVar21 = 0;
    sVar5 = 0;
    pcVar18 = PszGetCompressedString(idsAnnualResourcesPlanets);
    RightTextOut(hdc,x,rc.top,pcVar18,sVar5,sVar21);
    sVar5 = _WSPRINTF((LPSTR)CONCAT22((undefined2)lResTotal,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),(char *)szWork
                     );
    RightTextOut(hdc,iVar9,rc.top,(char *)szWork,sVar5,0);
  }
  rc.top = rc.top + (dyArial8 * 3) / 2;
  if ((grbitDraw & 0x1000U) != 0) {
    sVar21 = 0;
    sVar5 = 0;
    pcVar18 = PszGetCompressedString(idsTotalResourcesSpentResearchLastYear);
    RightTextOut(hdc,x,rc.top,pcVar18,sVar5,sVar21);
    sVar5 = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)
                                       ((int)&rgplr[0].lResLastYear +
                                       idPlayer * 0xc0),(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),(char *)szWork
                     );
    RightTextOut(hdc,iVar9,rc.top,(char *)szWork,sVar5,0);
  }
  rc.top = rc.top + (dyArial8 * 3) / 2;
  dx = 0;
  if ((grbitDraw & 0x2000U) == 0) {
    if (((grbitDraw & 0x4000U) != 0) && ((grbitDraw & 0xfU) == 0)) {
      DVar15 = GetTextExtent(hdc,(LPCSTR)0x11200d15,3);
      dx = (short)DVar15;
    }
  }
  else {
    sVar21 = 0;
    sVar5 = 0;
    pcVar18 = PszGetCompressedString(idsResourcesBudgetedResearch);
    RightTextOut(hdc,x,rc.top,pcVar18,sVar5,sVar21);
  }
  sVar5 = _WSPRINTF((LPSTR)CONCAT22(pctResGlob,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
  RightTextOut(hdc,iVar9,rc.top,(char *)szWork,sVar5,dx);
  if (((grbitDraw & 0x4000U) == 0) || ((grbitDraw & 0xfU) != 0)) {
    DVar15 = GetTextExtent(hdc,(LPCSTR)0x11200d19,1);
    TextOut(hdc,iVar9,rc.top,(LPCSTR)0x11200d1b,1);
    iVar11 = iVar9 + (int)DVar15;
    rcSpinTop.left = iVar11 + 4;
    rcSpinTop.top = rc.top + -4;
    rcSpinTop.right = iVar11 + 0x13;
    rcSpinTop.bottom = (dyArial8 >> 1) + rc.top + 1;
    rcSpinBot.left = rcSpinTop.left;
    rcSpinBot.top = rcSpinTop.top;
    rcSpinBot.right = rcSpinTop.right;
    rcSpinBot.bottom = rcSpinTop.bottom;
    OffsetRect(&rcSpinBot.left,0,
               (rcSpinTop.bottom - rcSpinTop.top) + -1);
    DrawBtn(hdc,(RECT *)&rcSpinTop,0xa0,0,(char *)0x0);
    DrawBtn(hdc,(RECT *)&rcSpinBot,0xa1,0,(char *)0x0);
  }
  rc.top = rc.top + (dyArial8 * 3) / 2;
  if (((grbitDraw & 0x4000U) == 0) || ((grbitDraw & 0xfU) != 0)) {
    sVar21 = 0;
    sVar5 = 0;
    pcVar18 = PszGetCompressedString(idsYearsProjectedResearchBudget);
    RightTextOut(hdc,x,rc.top,pcVar18,sVar5,sVar21);
  }
  sVar5 = _WSPRINTF((LPSTR)CONCAT22((uint)lResBudget,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),(char *)szWork);
  RightTextOut(hdc,iVar9,rc.top,(char *)szWork,sVar5,iVar9 - x);
  sVar5 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceGeneralizedResearch
                            );
  if ((sVar5 == 0) &&
     (sVar5 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                 ibitRaceBleedingEdgeTech), sVar5 == 0)) {
    yTopTechNote = -1;
  }
  else {
    sVar5 = CchGetString(idsRaceHas,szTemp);
    SelectObject(hdc,rghfontArial8[1]);
    yTopTechNote = rc.top + dyArial8 * 3;
    rc.left = dxResLeft + 8;
    rc.top = yTopTechNote;
    DVar15 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szTemp),sVar5);
    sVar21 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                ibitRaceGeneralizedResearch);
    if (sVar21 != 0) {
      TextOut(hdc,rc.left,rc.top,(LPCSTR)CONCAT22(unaff_SS,szTemp),sVar5);
      sVar21 = CchGetString(idsGeneralizedResearch,(char *)szWork);
      TextOut(hdc,rc.left + (int)DVar15,rc.top,szWork,sVar21);
      rc.top = rc.top + dyArial8 + 2;
    }
    sVar21 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,ibitRaceBleedingEdgeTech
                               );
    if (sVar21 != 0) {
      TextOut(hdc,rc.left,rc.top,(LPCSTR)CONCAT22(unaff_SS,szTemp),sVar5);
      sVar5 = CchGetString(idsBleedingEdgeTechnology,(char *)szWork);
      TextOut(hdc,rc.left + (int)DVar15,rc.top,szWork,sVar5);
    }
  }
RESEARCH_CleanUp:
  SetBkColor(hdc,CVar14);
  SetTextColor(hdc,CVar13);
  SelectObject(hdc,HVar4);
  if (bVar12) {
    ReleaseDC(hwnd,hdc);
  }
  return;
}



// ======================================================================
// Function: FTrackResearchDlg
// Address: 10d8:1a8c
// Segment: MEMORY_RESEARCH
// ======================================================================


short FTrackResearchDlg(HWND hwnd,short x,short y,short fkb)

{
  BOOL BVar1;
  int iVar2;
  short sVar3;
  uint uVar4;
  uint uVar5;
  undefined2 unaff_SS;
  long lVar6;
  RECT rc;
  BTNT btnt;
  RECT *prc;
  short cNew;
  short i;
  short dChg;
  POINT pt;
  short bt;
  
  BVar1 = PtInRect((undefined2 *)CONCAT22((RECT *)&rcSpinTop,y),x);
  if (BVar1 == 0) {
    BVar1 = PtInRect((undefined2 *)CONCAT22((RECT *)&rcSpinBot,y),x);
    if (BVar1 == 0) {
      if ((((y < yTopFutureTech) ||
           (cFutureTech * dyArial8 + yTopFutureTech <= y)) ||
          (x < 0xd)) || (dxResLeft + -0xc <= x)) {
        if (((yTopTechNote == -1) || (y < yTopTechNote)) ||
           ((dyArial8 * 3 + yTopTechNote <= y || (x <= dxResLeft)))) {
          sVar3 = 0;
          lVar6 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        }
        else {
          sVar3 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                     ibitRaceGeneralizedResearch);
          if ((sVar3 == 0) ||
             (((dyArial8 * 3) / 2 + yTopTechNote <= y &&
              (sVar3 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                          ibitRaceBleedingEdgeTech), sVar3 != 0)))) {
            i = 0x14c;
          }
          else {
            i = 0x144;
          }
          GlobalPD.psz = PszGetCompressedString(i);
          GlobalPD.field1_0x2 = (undefined1)dxResRight;
          GlobalPD.field2_0x3 = dxResRight._1_1_;
          GlobalPD.grPopup = 10;
          Popup(hwnd,x,y);
          sVar3 = 1;
          lVar6 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        }
      }
      else {
        iVar2 = (y - yTopFutureTech) / dyArial8;
        GlobalPD._2_2_ = ((HS *)rghsFutureTech + iVar2)->grhst;
        GlobalPD.psz =
             (char *)*(undefined2 *)((int)&rghsFutureTech[0].wFlags + iVar2 * 4);
        FLookupPart((PART *)&GlobalPD.field1_0x2);
        GlobalPD.grPopup = 9;
        Popup(hwnd,x,y);
        sVar3 = 1;
        lVar6 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
      }
      goto LAB_10d8_1d48;
    }
    i = -1;
    prc = (RECT *)&rcSpinBot;
    bt = 0xa1;
  }
  else {
    i = 1;
    prc = (RECT *)&rcSpinTop;
    bt = 0xa0;
  }
  GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
  InitBtnTrack(&btnt,hwnd,0,prc,bt,0x50,0,0,(char *)0x0);
  if ((fkb & 4U) == 0) {
    dChg = 1;
    lResBudget = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
  }
  else {
    dChg = 10;
  }
  while( true ) {
    sVar3 = FTrackBtn(&btnt);
    if (sVar3 == 0) break;
    uVar4 = dChg * i + pctResGlob;
    uVar5 = uVar4;
    if (0x7fff < uVar4) {
      uVar5 = 0;
    }
    if ((int)uVar5 < 0x65) {
      if (0x7fff < uVar4) {
        uVar4 = 0;
      }
    }
    else {
      uVar4 = 100;
    }
    if (uVar4 != pctResGlob) {
      pctResGlob = uVar4;
      lVar6 = ProjectedResearchSpending((long)(int)uVar4);
      lResBudget = lVar6;
      DrawResearchDlg(hwnd,btnt.hdc,&rc,0x4200);
    }
  }
  sVar3 = 1;
  lVar6 = lResBudget;
LAB_10d8_1d48:
  lResBudget._2_2_ = (undefined2)((ulong)lVar6 >> 0x10);
  lResBudget._0_2_ = (undefined2)lVar6;
  return sVar3;
}



// ======================================================================
// Function: GetTechLevelCost
// Address: 10d8:1dba
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cTech */

long GetTechLevelCost(short iTech,short iLevel,short iplr)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  short sVar4;
  int iVar5;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar6;
  long lVar7;
  short cTech;
  short i;
  long lCost;
  
  lVar7 = CONCAT22(unaff_SI,unaff_DI);
  cTech = 0;
  for (i = 0; i < 6; i = i + 1) {
    cTech = cTech + *(char *)(iplr * 0xc0 + 0x59bc + i);
  }
  uVar2 = cTech * 10;
  puVar1 = (uint *)((int)(double *)&DOUBLE_2000_0__1120_1d4e + iLevel * 4);
  uVar3 = uVar2 + *puVar1;
  iVar5 = ((int)uVar2 >> 0xf) + *(int *)((int)(double *)&DOUBLE_2000_0__1120_1d4e + iLevel * 4 + 2)
          + (uint)CARRY2(uVar2,*puVar1);
  lVar6 = CONCAT22(iVar5,uVar3);
  sVar4 = GetRaceStat((PLAYER *)rgplr + iplr,iTech + rsTechBonus1);
  if (sVar4 != 1) {
    if (sVar4 + -1 < 0) {
      lVar6 = __aFlshr(lVar7,cTech);
      uVar2 = uVar3 - (uint)lVar6;
      lVar6 = CONCAT22(((iVar5 * 2 - (int)((ulong)lVar6 >> 0x10)) - (uint)(uVar3 < (uint)lVar6)) +
                       (uint)CARRY2(uVar3,uVar2),uVar3 + uVar2);
    }
    else {
      lVar6 = __aFldiv(CONCAT22(iVar5,uVar3),2);
    }
  }
  if (((uint)game.wCrap >> 1 & 1) != 0) {
    lVar6 = __aFlshl(lVar7,cTech);
  }
  return lVar6;
}



// ======================================================================
// Function: BrowserDlg
// Address: 10d8:1ed8
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10d824c3) */

short BrowserDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  bool bVar1;
  short sVar2;
  int iVar3;
  short sVar4;
  HDC HVar5;
  HGDIOBJ HVar6;
  int iVar7;
  char *pcVar8;
  HWND HVar9;
  ushort uVar10;
  uint uVar11;
  uint uVar12;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  DWORD DVar13;
  ulong uVar14;
  ulong uVar15;
  long lVar16;
  LRESULT LVar17;
  short sVar18;
  short sVar19;
  HWND HVar20;
  WPARAM WVar21;
  UINT UVar22;
  ushort in_stack_0000ffb4;
  short iOff;
  short fShowAll_2;
  short cIter;
  short md_2;
  short iStart;
  long lSel_2;
  RECT rc;
  short dx;
  HFONT hfontSav;
  PAINTSTRUCT ps;
  short c;
  short i;
  HMENU hmenu;
  HDC hdc;
  
  uVar14 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_DESTROY) {
    StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,0);
    hwndBrowser = 0;
    fBrowserValid = 0;
    uVar10 = GetASubMenu(hwndFrame,5);
    CheckMenuItem(uVar10,0x100,0);
  }
  else {
    if (message == WM_PAINT) {
      BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
      EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
      return 1;
    }
    if (message == WM_ERASEBKGND) {
      GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
      FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
      return 1;
    }
    if (message == WM_CTLCOLOR) {
      for (i = 0x10a; i < 0x10c; i = i + 1) {
        HVar9 = GetDlgItem(hwnd,i);
        if ((HWND)lParam == HVar9) break;
      }
      if ((i < 0x10c) || (uVar14 = __aFulshr(uVar14,in_stack_0000ffb4), (int)uVar14 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        hwndBrowser = hwnd;
        HVar20 = 0;
        HVar9 = 7;
        sVar2 = GetSystemMetrics(7);
        if (dyArial8 < 0xf) {
          iVar3 = 0;
        }
        else {
          iVar3 = 0x28;
        }
        iVar3 = iVar3 + 0x166 + sVar2 * 2;
        sVar19 = 4;
        sVar2 = GetSystemMetrics(4);
        sVar18 = 8;
        sVar4 = GetSystemMetrics(8);
        SetWindowPos(HVar20,HVar9,iVar3,sVar19,sVar18,
                     dyArial10 + dyArial8 * 0xf + 0x67 + sVar4 * 2 + sVar2,6);
        StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,1);
        HVar5 = GetDC(hwnd);
        HVar6 = SelectObject(HVar5,rghfontArial8[1]);
        HVar9 = GetDlgItem(hwnd,0x10b);
        sVar2 = GetDlgItemText(hwnd,0x42e,szWork,0x50);
        DVar13 = GetTextExtent(HVar5,szWork,sVar2);
        iVar3 = (int)DVar13 + 0xe;
        HVar20 = GetDlgItem(hwnd,0x42e);
        SetWindowPos(HVar20,0,6,6,iVar3,(dyArial8 * 3) / 2,4);
        HVar20 = GetDlgItem(hwnd,0x42f);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar20,0,(iVar7 + 0x15e) - iVar3,6,iVar3,(dyArial8 * 3) / 2,4);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar9,0,(int)DVar13 + 0x1a,6,iVar7 + iVar3 * -2 + 0x14c,
                     dyArial8 * 0x12,4);
        HVar20 = GetDlgItem(hwnd,2);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar20,0,(iVar7 + 0x15e) - iVar3,
                     dyArial10 + dyArial8 * 0xc + (dyArial8 * 3) / 2 +
                     0x60,iVar3,(dyArial8 * 3) / 2,4);
        HVar20 = GetDlgItem(hwnd,0x10a);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar20,0,6,
                     dyArial10 + dyArial8 * 0xc + (dyArial8 * 3) / 2 +
                     0x60,(iVar7 + 0x158) - iVar3,(dyArial8 * 3) / 2,4);
        SelectObject(HVar5,HVar6);
        ReleaseDC(hwnd,HVar5);
        if (fBrowserValid == 0) {
          vpartBrowser.hs.grhst = hstArmor;
          vpartBrowser.hs.wFlags = vpartBrowser.hs.wFlags & 0xff00;
        }
        FLookupPart((PART *)&vpartBrowser);
        if (dyArial8 < 0xf) {
          iVar3 = 0;
        }
        else {
          iVar3 = 0x28;
        }
        hwndBrowserChild =
             CreateWindow(szBrowser,(LPCSTR)0x0,0x50000000,6,
                          (dyArial8 * 3) / 2 + 0xc,iVar3 + 0x158,
                          dyArial10 + dyArial8 * 0xc + 0x4e,hwnd,0,
                          hInst,(void *)0x0);
        for (i = 0x43f; i < 0x450; i = i + 1) {
          UVar22 = 0x403;
          WVar21 = 0;
          HVar20 = HVar9;
          pcVar8 = PszGetCompressedString(i);
          SendMessage(HVar20,UVar22,WVar21,(LPARAM)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar8));
        }
        SendMessage(HVar9,0x40e,0,0);
        if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 2) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,0);
          hwndBrowser = 0;
          fBrowserValid = 0;
          uVar10 = GetASubMenu(hwndFrame,5);
          CheckMenuItem(uVar10,0x100,0);
          EndDialog(hwnd,1);
          if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
          return 1;
        }
        if (wParam == 0x10b) {
          uVar15 = __aFulshr(uVar14,in_stack_0000ffb4);
          if ((int)uVar15 == 1) {
            UVar22 = IsDlgButtonChecked(hwnd,0x10a);
            HVar9 = GetDlgItem(hwnd,0x10b);
            LVar17 = SendMessage(HVar9,0x407,0,0);
            if ((0xffff < LVar17) || (-1 < LVar17)) {
              lVar16 = __aFlshl(uVar14,in_stack_0000ffb4);
              vpartBrowser.hs.grhst =
                   *(HullSlotType *)((int)(ushort *)rggrbitBrParts + (int)lVar16);
              vpartBrowser.hs.wFlags = vpartBrowser.hs.wFlags & 0xff00;
              while (sVar2 = FLookupPart((PART *)&vpartBrowser), sVar2 != 0) {
                if ((sVar2 == 1) || (UVar22 == 0)) goto LAB_10d8_2557;
                vpartBrowser.hs.wFlags =
                     vpartBrowser.hs.wFlags & 0xff00U |
                     vpartBrowser.hs.wFlags + 1U & 0xff;
              }
              vpartBrowser.pcom._0_2_ = (COMPART *)0x0;
              vpartBrowser.pcom._2_2_ = 0;
LAB_10d8_2557:
              InvalidateRect(hwndBrowserChild,(undefined2 *)0x0,1);
            }
          }
        }
        else if ((wParam == 0x42f) || (wParam == 0x42e)) {
          uVar11 = vpartBrowser.hs.wFlags & 0xff;
          cIter = 0;
          HVar9 = GetDlgItem(hwnd,0x10b);
          LVar17 = SendMessage(HVar9,0x407,0,0);
          bVar1 = LVar17 == 0;
          for (i = 0; (sVar2 = i, i < 0x11 &&
                      (vpartBrowser.hs.grhst != ((ushort *)rggrbitBrParts)[i])); i = i + 1
              ) {
          }
          UVar22 = IsDlgButtonChecked(hwnd,0x10a);
          if (wParam == 0x42f) {
            iVar3 = 1;
          }
          else {
            iVar3 = -1;
          }
          while ((uVar12 = iVar3 + vpartBrowser.hs.wFlags & 0xff,
                 vpartBrowser.hs.wFlags =
                      vpartBrowser.hs.wFlags & 0xff00U | uVar12, uVar12 != uVar11 ||
                 (bVar1))) {
            while( true ) {
              iVar7 = cIter + 1;
              if (0x15e < cIter) goto RESEARCH_NullItem;
              md_2 = FLookupPart((PART *)&vpartBrowser);
              cIter = iVar7;
              if (md_2 != 0) break;
              if ((wParam == 0x42f) && (bVar1)) {
                i = i + 1;
                if (0x10 < i) {
                  i = 1;
                }
                vpartBrowser.hs.grhst = ((ushort *)rggrbitBrParts)[i];
                vpartBrowser.hs.wFlags = vpartBrowser.hs.wFlags & 0xff00;
              }
              else {
                if (((vpartBrowser.hs.wFlags & 0xffU) == 0) && (!bVar1)) {
                  vpartBrowser.pcom._0_2_ = (COMPART *)0x0;
                  vpartBrowser.pcom._2_2_ = 0;
                  goto LAB_10d8_27b3;
                }
                if ((wParam == 0x42e) && (bVar1)) {
                  if ((vpartBrowser.hs.wFlags & 0xffU) < 0x65) break;
                  i = i + -1;
                  if (i < 1) {
                    i = 0x10;
                  }
                  vpartBrowser.hs.grhst = ((ushort *)rggrbitBrParts)[i];
                  vpartBrowser.hs.wFlags =
                       vpartBrowser.hs.wFlags & 0xff00U | 100;
                }
                else {
                  if (wParam != 0x42f) break;
                  vpartBrowser.hs.wFlags = vpartBrowser.hs.wFlags & 0xff00;
                }
              }
            }
            if ((md_2 == 1) ||
               (((md_2 != 0 && (UVar22 == 0)) &&
                ((md_2 != -1 ||
                 (sVar4 = FShouldPartBeHidden((PART *)&vpartBrowser), sVar4 == 0))))))
            break;
          }
LAB_10d8_27b3:
          if ((((vpartBrowser.hs.wFlags & 0xffU) != uVar11) || (sVar2 != i)) ||
             ((md_2 != 1 && (UVar22 != 0)))) {
            if (((vpartBrowser.hs.wFlags & 0xffU) == uVar11) && (sVar2 == i)) {
              sVar2 = FLookupPart((PART *)&vpartBrowser);
              if (sVar2 == 1) {
                return 0;
              }
RESEARCH_NullItem:
              vpartBrowser.pcom._0_2_ = (COMPART *)0x0;
              vpartBrowser.pcom._2_2_ = 0;
            }
            InvalidateRect(hwndBrowserChild,(undefined2 *)0x0,1);
          }
        }
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: BrowserWndProc
// Address: 10d8:2876
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: rc */

long BrowserWndProc(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  SHDEF *pSVar1;
  HDC hdc_00;
  HULDEF *pHVar2;
  int iVar3;
  undefined2 uVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  SHDEF *pSVar5;
  undefined2 unaff_SS;
  ulong uVar6;
  HULDEF *pHVar7;
  LRESULT LVar8;
  RECT rc;
  PAINTSTRUCT ps;
  short i;
  POINT pt;
  HDC hdc;
  
  if (message == WM_CREATE) {
    return 0;
  }
  if (message == WM_PAINT) {
    hdc_00 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    DisplayComponentInfo(hdc_00,rc.right,rc.bottom,(PART *)&vpartBrowser);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    return 0;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    return 1;
  }
  if (message == WM_SETCURSOR) {
    GetCursorPos((undefined2 *)CONCAT22(unaff_SS,&pt));
    ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&pt));
  }
  else {
    if (message != WM_LBUTTONDOWN) goto RESEARCH_Default_8;
    pt.x = (short)lParam;
    uVar6 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),rc.left);
    pt.y = (short)uVar6;
  }
  if ((((vpartBrowser.hs.grhst == hstHull) ||
       (vpartBrowser.hs.grhst == hstSBHull)) && (hwndSlotDlg == 0)) &&
     (((4 < pt.x && (pt.x < 0x45)) &&
      ((dyArial10 + 5 <= pt.y && (pt.y < dyArial10 + 0x45)))))) {
    if (message == WM_LBUTTONDOWN) {
      GlobalPD.grPopup = 0xe;
      if (vpartBrowser.hs.grhst == hstSBHull) {
        pHVar7 = LphuldefSBFromId(vpartBrowser.hs.wFlags & 0xff);
        uVar4 = (undefined2)((ulong)pHVar7 >> 0x10);
        pHVar2 = (HULDEF *)pHVar7;
        pSVar5 = (SHDEF *)&shdefBuild;
        for (iVar3 = 0x3d; iVar3 != 0; iVar3 = iVar3 + -1) {
          pSVar1 = pSVar5;
          pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
          pHVar7 = pHVar2;
          pHVar2 = (HULDEF *)(pHVar2->hul).rgTech;
          (pSVar1->hul).ihuldef = (pHVar7->hul).ihuldef;
        }
        *(char *)&(pSVar5->hul).ihuldef = (char)(pHVar2->hul).ihuldef;
      }
      else {
        pHVar7 = LphuldefFromId(vpartBrowser.hs.wFlags & 0xff);
        uVar4 = (undefined2)((ulong)pHVar7 >> 0x10);
        pHVar2 = (HULDEF *)pHVar7;
        pSVar5 = (SHDEF *)&shdefBuild;
        for (iVar3 = 0x3d; iVar3 != 0; iVar3 = iVar3 + -1) {
          pSVar1 = pSVar5;
          pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
          pHVar7 = pHVar2;
          pHVar2 = (HULDEF *)(pHVar2->hul).rgTech;
          (pSVar1->hul).ihuldef = (pHVar7->hul).ihuldef;
        }
        *(char *)&(pSVar5->hul).ihuldef = (char)(pHVar2->hul).ihuldef;
      }
      for (i = 0; i < (int)(uint)shdefBuild.hul.chs; i = i + 1) {
        *(uint *)((int)&shdefBuild.hul + 0x3c + i * 4) =
             *(uint *)((int)&shdefBuild.hul + 0x3c + i * 4) & 0xff;
      }
      GlobalPD._2_2_ = SUB42(&shdefBuild,0);
      GlobalPD.psz = (char *)&DAT_1120_1120;
      GlobalPD.iPlanVal = 0;
      Popup(hwnd,pt.x,pt.y);
    }
    else {
      setcursor(hcurArrowHelp);
    }
    return 1;
  }
RESEARCH_Default_8:
  LVar8 = DefWindowProc(hwnd,message,wParam,lParam);
  return LVar8;
}



// ======================================================================
// Function: DisplayComponentInfo
// Address: 10d8:2ac6
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10d84da9) */
/* WARNING: Removing unreachable block (ram,0x10d862f3) */
/* WARNING: Removing unreachable block (ram,0x10d82fa1) */
/* WARNING: Removing unreachable block (ram,0x10d8301c) */

void DisplayComponentInfo(HDC hdc,short dx,short dy,PART *ppart)

{
  HullSlotType HVar1;
  undefined4 uVar2;
  undefined4 uVar3;
  uint uVar4;
  short sVar5;
  char *pcVar6;
  int iVar7;
  undefined2 uVar8;
  StringId ids_00;
  int iVar9;
  int iVar10;
  ushort cLen;
  HGDIOBJ HVar11;
  int iVar12;
  int iVar13;
  char *unaff_SS;
  DWORD DVar14;
  long lVar15;
  COLORREF CVar16;
  HULDEF *pHVar17;
  ulong num;
  long lVar18;
  ulong uVar19;
  undefined1 *puVar20;
  HDC HVar21;
  short sVar22;
  undefined2 uVar23;
  HPEN hpenSav_2;
  short x_2;
  long ldelta;
  char ch;
  char cch_2;
  short dxQuan;
  short pct_3;
  short xBase;
  short y_2;
  short yBase_2;
  short dxDigit_2;
  long lpct;
  short dyPct_2;
  short xText_10;
  short yText_5;
  char szT_4 [256];
  short dxT;
  long l;
  RECT rcData;
  short xText;
  short xNum;
  short yStart;
  short fReq;
  short yCur;
  short i;
  short yText;
  short c;
  short dxStr;
  short ids;
  short idsT;
  ushort rgCosts [4];
  
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,0,dy + -1,dx,1,0xf00021);
  PatBlt(hdc,dx + -1,0,1,dy,0xf00021);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,0,0,dx,1,0xf00021);
  PatBlt(hdc,0,0,1,dy,0xf00021);
  PatBlt(hdc,4,dy + dyArial8 * -2 + -2,dx + -8,1,0xf00021);
  SetBkMode(hdc,1);
  if ((*(int *)&ppart->pcom == 0) && (*(int *)((int)&ppart->pcom + 2) == 0)) {
    SetRect((undefined2 *)CONCAT22(unaff_SS,&rcData),5,5,dx + -5,dy + -5);
    c = CchGetString(idsNoneAvailable,(char *)szWork);
    DiaganolTextOut(hdc,&rcData,(char *)szWork,c);
    return;
  }
  SelectObject(hdc,rghfontArial10[1]);
  __fstrcpy(szWork,
                    (char *)CONCAT22(*(undefined2 *)((int)&ppart->pcom + 2),
                                     (char *)(*(int *)&ppart->pcom + 8)));
  CtrTextOut(hdc,dx >> 1,3,(char *)szWork,0);
  if (((ppart->hs).grhst == hstHull) || ((ppart->hs).grhst == hstSBHull)) {
    DrawFleetBitmap
              ((FLEET *)0x0,hdc,5,dyArial10 + 5,0,((COMPART *)ppart->pcom)->ibmp,0,0,-1,0)
    ;
  }
  else {
    SelectPalette(hdc,vhpal,0);
    RealizePalette(hdc);
    DibBlt(hdc,5,dyArial10 + 5,0x40,0x40,
                    ((ushort *)rghdibInventory)[((COMPART *)ppart->pcom)->ibmp >> 5],
                    (((COMPART *)ppart->pcom)->ibmp & 7U) << 6,
                    (3U - (((COMPART *)ppart->pcom)->ibmp >> 3) & 3) << 6,0x40,0x40,0xcc0020);
  }
  SelectObject(hdc,rghfontArial8[1]);
  yCur = dyArial10 + 0x47;
  c = CchGetString(idsTechReq,(char *)szWork);
  TextOut(hdc,5,yCur,szWork,c);
  dxStr = 0;
  for (i = 0; i < 6; i = i + 1) {
    c = CchGetString(i + idsEner,(char *)szWork);
    DVar14 = GetTextExtent(hdc,szWork,c);
    sVar5 = (int)DVar14;
    if ((int)DVar14 <= dxStr) {
      sVar5 = dxStr;
    }
    dxStr = sVar5;
  }
  dxStr = dxStr + 5;
  DVar14 = GetTextExtent(hdc,(LPCSTR)0x11200d24,2);
  xNum = dxStr + (int)DVar14;
  fReq = 0;
  for (i = 0; i < 6; i = i + 1) {
    if ('\0' < *(char *)(*(int *)&ppart->pcom + 2 + i)) {
      yCur = yCur + dyArial8;
      szT_4._254_2_ = SEXT12(*(char *)(*(int *)&ppart->pcom + 2 + i));
      if ((int)*(char *)(idPlayer * 0xc0 + 0x59bc + i) < (int)szT_4._254_2_) {
        uVar4 = 0x7f;
      }
      else {
        uVar4 = 0;
      }
      SetTextColor(hdc,(ulong)uVar4);
      c = CchGetString(i + idsEner,(char *)szWork);
      RightTextOut(hdc,dxStr,yCur,(char *)szWork,c,0);
      SetTextColor(hdc,0);
      c = _WSPRINTF((LPSTR)CONCAT22((int)*(char *)(*(int *)&ppart->pcom + 2 + i),
                                    (char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
      RightTextOut(hdc,xNum,yCur,(char *)szWork,c,0);
      fReq = 1;
    }
  }
  if (fReq == 0) {
    yCur = yCur + dyArial8;
    c = CchGetString(idsNone3,(char *)szWork);
    CtrTextOut(hdc,0x25,yCur,(char *)szWork,c);
  }
  sVar5 = FLookupPart(ppart);
  if (sVar5 < 1) {
    lVar15 = -1;
  }
  else {
    lVar15 = CostOfDevelopingItem
                       ((char *)CONCAT22(*(undefined2 *)((int)&ppart->pcom + 2),
                                         (char *)(*(int *)&ppart->pcom + 2)));
  }
  l._0_2_ = (undefined2)lVar15;
  if (lVar15 < 100000) {
    if (lVar15 < 1) {
      if (lVar15 == -1) {
        SetTextColor(hdc,0x7f);
        sVar5 = 0;
        pcVar6 = PszGetCompressedString(idsUnavail);
        CtrTextOut(hdc,0x25,yCur + dyArial8 + 4,pcVar6,sVar5);
        SetTextColor(hdc,0);
      }
      else {
        sVar5 = 0;
        pcVar6 = PszGetCompressedString(idsAvailable);
        CtrTextOut(hdc,0x25,yCur + dyArial8 + 4,pcVar6,sVar5);
      }
    }
    else {
      pcVar6 = PszGetCompressedString(idsCostLd);
      c = _WSPRINTF((LPSTR)CONCAT22((undefined2)l,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      TextOut(hdc,5,yCur + dyArial8 + 4,szWork,c);
    }
  }
  else {
    lVar18 = __aFldiv(lVar15 + 500,1000);
    pcVar6 = PszGetCompressedString(idsCostLdk);
    c = _WSPRINTF((LPSTR)CONCAT22((int)lVar18,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,5,yCur + dyArial8 + 4,szWork,c);
  }
  yStart = dyArial10 + 5;
  if (dyArial8 * 4 < 0x40) {
    yStart = yStart + (dyArial8 * -4 + 0x40 >> 1);
  }
  yCur = yStart;
  dxStr = 0;
  for (i = 0; i < 6; i = i + 1) {
    pcVar6 = (char *)*(undefined2 *)(i * 2 + 0x4cc);
    puVar20 = (undefined1 *)&DAT_1120_1120;
    HVar21 = hdc;
    sVar5 = lstrlen((LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,
                                     (char *)*(undefined2 *)(i * 2 + 0x4cc)));
    DVar14 = GetTextExtent(HVar21,(LPCSTR)CONCAT22(puVar20,pcVar6),sVar5);
    sVar5 = (int)DVar14;
    if ((int)DVar14 <= dxStr) {
      sVar5 = dxStr;
    }
    dxStr = sVar5;
  }
  dxStr = dxStr + 0x4d;
  GetTruePartCost(idPlayer,ppart,rgCosts);
  for (i = 0; i < 6; i = i + 1) {
    if ((i != 4) && (i != 3)) {
      SelectObject(hdc,rghfontArial8[1]);
      SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + 0x44a),*(undefined2 *)(i * 4 + 0x448)));
      RightTextOut(hdc,dxStr,yCur,(char *)*(undefined2 *)(i * 2 + 0x4cc),0,0);
      SelectObject(hdc,rghfontArial8[0]);
      SetTextColor(hdc,CONCAT22(crWindowText._2_2_,(undefined2)crWindowText));
      if (i == 5) {
        c = rgCosts[3];
      }
      else {
        c = rgCosts[i];
      }
      if (((ppart->hs).grhst == hstSBHull) || ((ppart->hs).grhst == hstSpecialSB)) {
        c = c - c / 2;
      }
      c = _WSPRINTF((LPSTR)CONCAT22(c,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
      RightTextOut
                (hdc,dxStr + dxMaxMineralQuan,yCur,(char *)szWork,c,0);
      if (i < 5) {
        TextOut(hdc,dxStr + dxMaxMineralQuan,yCur,(LPCSTR)0x11200d27,2);
      }
      yCur = yCur + dyArial8;
    }
  }
  SelectObject(hdc,rghfontArial8[1]);
  if (((COMPART *)ppart->pcom)->cMass != 0) {
    sVar5 = ((COMPART *)ppart->pcom)->cMass;
    pcVar6 = PszGetCompressedString(idsMassDkt);
    c = _WSPRINTF((LPSTR)CONCAT22(sVar5,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,dxStr + dxMaxMineralQuan + 0x20,yStart,szWork,c);
  }
  if (xNum + 4 < 0x49) {
    sVar5 = 0x49;
  }
  else {
    sVar5 = xNum + 4;
  }
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rcData),sVar5,dyArial10 + 0x47,dx + -5,
          dy + dyArial8 * -2 + -9);
  if (0xe < dyArial8) {
    rcData.left = rcData.left + 4;
  }
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,rcData.left,rcData.top,rcData.right - rcData.left,1,0xf00021);
  PatBlt(hdc,rcData.left,rcData.top,1,rcData.bottom - rcData.top,0xf00021);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,rcData.left,rcData.bottom + -1,rcData.right - rcData.left,1,0xf00021);
  PatBlt(hdc,rcData.right + -1,rcData.top,1,rcData.bottom - rcData.top,0xf00021);
  ExpandRc(&rcData,-3,-3);
  if ((((uint)gd.wFlags >> 0xe & 1) != 0) && (lVar15 == 0)) {
    SetTextColor(hdc,CONCAT22(crButtonHilite._2_2_,(undefined2)crButtonHilite));
    c = CchGetString(idsBleedingEdge,(char *)szWork);
    DiaganolTextOut(hdc,&rcData,(char *)szWork,c);
    SetTextColor(hdc,CONCAT22(crWindowText._2_2_,(undefined2)crWindowText));
  }
  uVar3._2_1_ = szT_4[0xec];
  uVar3._3_1_ = szT_4[0xed];
  uVar3._0_1_ = szT_4[0xea];
  uVar3._1_1_ = szT_4[0xeb];
  uVar2._2_1_ = szT_4[0xe2];
  uVar2._3_1_ = szT_4[0xe3];
  uVar2._0_1_ = szT_4[0xe0];
  uVar2._1_1_ = szT_4[0xe1];
  ids = -1;
  HVar1 = (ppart->hs).grhst;
  if (HVar1 == hstEngine) {
    SelectObject(hdc,rghfontArial8[1]);
    rcData.right = rcData.right + -2;
    c = CchGetString(idsFuelUsageVsWarpSpeed,(char *)szWork);
    CtrTextOut(hdc,(rcData.right - rcData.left >> 1) + rcData.left,rcData.top,
                        (char *)szWork,c);
    rcData.top = rcData.top + dyArial8;
    c = CchGetString(idsWarp,(char *)szWork);
    DVar14 = GetTextExtent(hdc,szWork,c);
    dxStr = (short)DVar14;
    szT_4._244_2_ = (((rcData.right - rcData.left) - dxStr) + -8) / 10;
    szT_4._252_2_ = (((rcData.bottom - rcData.top) - dyArial8) + -8) / 6;
    PatBlt(hdc,rcData.left + dxStr + 6,rcData.top,1,
           ((rcData.bottom - rcData.top) - dyArial8) + -4,0x42);
    PatBlt(hdc,rcData.left + dxStr + 6,(rcData.bottom - dyArial8) + -4,
           ((rcData.right - rcData.left) - dxStr) + -6,1,0x42);
    szT_4._230_2_ = rcData.left + dxStr;
    szT_4._246_2_ = (rcData.bottom - dyArial8) + -4 + szT_4._252_2_ * -6;
    szT_4[0xf2] = ' ';
    szT_4[0xf3] = '\x03';
    SetTextColor(hdc,0x7f);
    for (; 0x18 < (int)szT_4._242_2_; szT_4._242_2_ = (int)szT_4._242_2_ >> 1) {
      if (szT_4._242_2_ == 100) {
        SetTextColor(hdc,0);
        SelectObject(hdc,hbrGray);
        PatBlt(hdc,szT_4._230_2_ + 4,szT_4._246_2_,((rcData.right - rcData.left) - dxStr) + -4,1,
               0xf00021);
      }
      c = _WSPRINTF((LPSTR)CONCAT22(szT_4._242_2_,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTDPCTPCT,(char *)&DAT_1120_1120),
                    (char *)szWork);
      RightTextOut
                (hdc,szT_4._230_2_,szT_4._246_2_ - (dyArial8 >> 1),
                 (char *)szWork,c,0);
      PatBlt(hdc,szT_4._230_2_ + 4,szT_4._246_2_,5,1,0x42);
      szT_4._246_2_ = szT_4._246_2_ + szT_4._252_2_;
    }
    szT_4._246_2_ = rcData.bottom - dyArial8;
    sVar22 = 0;
    sVar5 = 0;
    pcVar6 = PszGetCompressedString(idsWarp);
    RightTextOut(hdc,szT_4._230_2_,szT_4._246_2_,pcVar6,sVar5,sVar22);
    szT_4._230_2_ = szT_4._230_2_ + 6;
    szT_4._248_2_ = (rcData.bottom - dyArial8) + -4;
    DVar14 = GetTextExtent(hdc,(LPCSTR)0x11200d2a,1);
    szT_4._250_2_ = (uint)DVar14 >> 1;
    szT_4[0xfe] = '0';
    szT_4[0xe8] = '\x01';
    szT_4[0xe9] = '\0';
    szT_4._234_4_ =
         SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText))
    ;
    if ((((((ppart->hs).wFlags & 0xffU) == 7) || (((ppart->hs).wFlags & 0xffU) == 9)) ||
        (((ppart->hs).wFlags & 0xffU) == 0xe)) ||
       ((((ppart->hs).wFlags & 0xffU) == 0xf || (((ppart->hs).wFlags & 0xffU) == 8)))) {
      szT_4[0xf0] = '\x01';
      szT_4[0xf1] = '\0';
    }
    else {
      szT_4[0xf0] = '\0';
      szT_4[0xf1] = '\0';
    }
    for (i = 0; i < 0xb; i = i + 1) {
      if (i == 10) {
        szT_4[0xe8] = '\x02';
        szT_4[0xe9] = '\0';
        szT_4[0xfe] = '1';
        szT_4[0xff] = '0';
        if (szT_4._240_2_ == 0) {
          szT_4._222_2_ = SelectObject(hdc,rghbrPat[0]);
          SetTextColor(hdc,0xffff);
          CVar16 = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,
                                           (undefined2)crButtonFace));
          szT_4._224_4_ = CVar16;
          PatBlt(hdc,(szT_4._230_2_ - szT_4._244_2_) + 1,rcData.top,szT_4._244_2_,
                 szT_4._248_2_ - rcData.top,0xf00021);
          SetBkColor(hdc,szT_4._224_4_);
          SelectObject(hdc,szT_4._222_2_);
        }
      }
      if ((*(int *)(*(int *)&ppart->pcom + 0x36 + i * 2) < 0x79) &&
         (((i == 10 && (szT_4._240_2_ != 0)) ||
          ((0x78 < *(int *)(*(int *)&ppart->pcom + 0x36 + (i + 1) * 2) ||
           ((i == 9 && (szT_4._240_2_ == 0)))))))) {
        SetTextColor(hdc,0x7f0000);
      }
      else {
        SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
      }
      TextOut(hdc,szT_4._230_2_ - szT_4._250_2_ * szT_4._232_2_,szT_4._246_2_,
              (LPCSTR)CONCAT22(unaff_SS,szT_4 + 0xfe),szT_4._232_2_);
      if (0 < i) {
        PatBlt(hdc,szT_4._230_2_,szT_4._246_2_ + -6,1,5,0x42);
      }
      szT_4[0xfe] = szT_4[0xfe] + '\x01';
      szT_4._230_2_ = szT_4._230_2_ + szT_4._244_2_;
    }
    SetTextColor(hdc,szT_4._234_4_);
    szT_4._228_2_ = SelectObject(hdc,hpenDkBlue);
    szT_4._230_2_ = rcData.left + dxStr + 6;
    for (i = 0; i < 0xb; i = i + 1) {
      szT_4[0xf6] = szT_4[0xf8];
      szT_4[0xf7] = szT_4[0xf9];
      szT_4[0xf2] = '\x19';
      szT_4[0xf3] = '\0';
      szT_4._238_2_ = *(int *)(*(int *)&ppart->pcom + 0x36 + i * 2);
      for (; (int)szT_4._242_2_ <= (int)szT_4._238_2_; szT_4._242_2_ = szT_4._242_2_ << 1) {
        szT_4._246_2_ = szT_4._246_2_ - szT_4._252_2_;
      }
      if (szT_4._242_2_ == 0x19) {
        if (szT_4._238_2_ == 0) {
          szT_4._246_2_ = szT_4._246_2_ + -1;
        }
        else {
          if ((szT_4._238_2_ * 4 * szT_4._252_2_) / 100 < 1) {
            iVar7 = 1;
          }
          else {
            iVar7 = (szT_4._238_2_ * 4 * szT_4._252_2_) / 100;
          }
          szT_4._246_2_ = szT_4._246_2_ - iVar7;
        }
      }
      else {
        sVar5 = MulDiv(szT_4._238_2_ - ((int)szT_4._242_2_ >> 1),100,(int)szT_4._242_2_ >> 1);
        szT_4._226_2_ = sVar5;
        szT_4._246_2_ = szT_4._246_2_ - (sVar5 * szT_4._252_2_) / 100;
      }
      if (i == 0) {
        MoveTo(hdc,szT_4._230_2_,szT_4._246_2_);
      }
      else {
        LineTo(hdc,szT_4._230_2_,szT_4._246_2_);
      }
      szT_4._230_2_ = szT_4._230_2_ + szT_4._244_2_;
    }
    SelectObject(hdc,szT_4._228_2_);
    uVar2 = szT_4._224_4_;
    uVar3 = szT_4._234_4_;
    switch(((COMPART *)ppart->pcom + 1)->id) {
    default:
      if ((10 < ((ppart->hs).wFlags & 0xffU)) && (((ppart->hs).wFlags & 0xffU) < 0xf)) {
        ids = 0x18c;
      }
      break;
    case 1:
      ids = 0x29;
      break;
    case 2:
      ids = 0x2a;
      break;
    case 3:
      ids = 0x2b;
      break;
    case 4:
      ids = 0x2c;
      break;
    case 5:
      ids = 0x2d;
      break;
    case 6:
      ids = 0x3a5;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstScanner) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[0]);
    i = ((COMPART *)ppart->pcom + 1)->id;
    if (i == 0) {
      c = CchGetString
                    (idsEnemyFleetsCannotDetectedScannerUnlessSame,(char *)szWork);
    }
    else {
      c = CchGetString(idsEnemyFleetsOrbitingPlanetCanDetectedD,szT_4);
      c = _WSPRINTF((LPSTR)CONCAT22(i,unaff_SS),(LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),
                    (char *)szWork);
    }
    yText_5 = DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
    rcData.top = rcData.top + (dyArial8 >> 1) + yText_5;
    i = *(short *)((COMPART *)ppart->pcom)[1].rgTech;
    if (i == 0) {
      c = CchGetString
                    (idsScannerCapableDeterminingPlanetsEnvironmentCompo,(char *)szWork);
    }
    else if (i == 4) {
      if (((ppart->hs).wFlags & 0xffU) == 5) {
        ids = 0x36;
      }
      else if (((ppart->hs).wFlags & 0xffU) == 0xe) {
        ids = 0x37;
      }
      else {
        ids = 0x35;
      }
      c = CchGetString(ids,(char *)szWork);
      ids = 0x38;
    }
    else {
      c = CchGetString(idsScannerCanDeterminePlanetsBasicStatsDistance,szT_4);
      if (i == 1) {
        uVar8 = 0x32;
      }
      else if (i == 2) {
        uVar8 = 100;
      }
      else {
        uVar8 = 200;
      }
      c = _WSPRINTF((LPSTR)CONCAT22(uVar8,unaff_SS),(LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),
                    (char *)szWork);
      ids = 0x164;
    }
    yText_5 = DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstShield) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    szT_4[0xfc] = (undefined1)rcData.left;
    szT_4[0xfd] = rcData.left._1_1_;
    sVar22 = 1;
    sVar5 = 0;
    pcVar6 = PszGetCompressedString(idsShieldStrength);
    DxStreamTextOut(hdc,(short *)(szT_4 + 0xfc),rcData.top,pcVar6,sVar5,sVar22);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    DxStreamTextOut(hdc,(short *)(szT_4 + 0xfc),rcData.top,(char *)szWork,c,1);
    if (((ppart->hs).wFlags & 0xffU) == 4) {
      ids = 0x3a;
      szT_4[0xfe] = '<';
      szT_4[0xff] = '\0';
RESEARCH_LShieldDisp:
      c = CchGetString(szT_4._254_2_,(char *)szWork);
      rcData.top = rcData.top + dyArial8 + 4;
      DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
    }
    else {
      if (((ppart->hs).wFlags & 0xffU) == 3) {
        ids = 0x3b;
        szT_4[0xfe] = '?';
        szT_4[0xff] = '\0';
        goto RESEARCH_LShieldDisp;
      }
      if (((ppart->hs).wFlags & 0xffU) == 6) {
        ids = 0x3a2;
        szT_4[0xfe] = '@';
        szT_4[0xff] = '\0';
        goto RESEARCH_LShieldDisp;
      }
    }
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstArmor) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    szT_4[0xfe] = (undefined1)rcData.left;
    szT_4[0xff] = rcData.left._1_1_;
    sVar22 = 1;
    sVar5 = 0;
    pcVar6 = PszGetCompressedString(idsArmorStrength2);
    DxStreamTextOut(hdc,(short *)(szT_4 + 0xfe),rcData.top,pcVar6,sVar5,sVar22);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    DxStreamTextOut(hdc,(short *)(szT_4 + 0xfe),rcData.top,(char *)szWork,c,1);
    if (((ppart->hs).wFlags & 0xffU) == 7) {
      ids = 0x3a;
      idsT = 0x3d;
RESEARCH_LArmDisp:
      c = CchGetString(idsT,(char *)szWork);
      rcData.top = rcData.top + dyArial8 + 4;
      DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
    }
    else {
      if (((ppart->hs).wFlags & 0xffU) == 6) {
        ids = 0x4d4;
        idsT = 0x3e;
        goto RESEARCH_LArmDisp;
      }
      if (((ppart->hs).wFlags & 0xffU) == 9) {
        ids = 0x3a2;
        c = CchGetString(idsPartAlsoActs100dpShield20Cloak,(char *)szWork);
        rcData.top = rcData.top + dyArial8 + 4;
        SelectObject(hdc,rghfontArial8[0]);
        DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
      }
    }
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstBeam) {
    ExpandRc(&rcData,-4,-4);
    szT_4._254_2_ = (rcData.right - rcData.left) / 3 + rcData.left;
    yText = rcData.top;
    c = CchGetString(idsPower,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)((COMPART *)ppart->pcom)[1].rgTech,
                                  (char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsRange,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsInitiative,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(((COMPART *)ppart->pcom)[1].rgTech + 2),
                                  (char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    rcData.top = yText + (dyArial8 * 3) / 2;
    yText = rcData.top;
    if (*(int *)(((COMPART *)ppart->pcom)[1].rgTech + 4) == 0) {
      if (((ppart->hs).wFlags & 0xffU) == 0x12) {
        ids = 0x3a2;
        c = CchGetString(idsPartAlsoActs10CloakIncreasesTorpedo,(char *)szWork);
        SelectObject(hdc,rghfontArial7[0]);
        sVar5 = DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
        rcData.top = rcData.top + sVar5;
        c = CchGetString(idsWeaponCanAlsoBombPlanets2Colonists,(char *)szWork);
        DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
      }
    }
    else {
      SelectObject(hdc,rghfontArial7[0]);
      if ((*(uint *)(((COMPART *)ppart->pcom)[1].rgTech + 4) & 1) != 0) {
        c = CchGetString(idsWeaponWillDamageShieldsHasEffectArmor,(char *)szWork)
        ;
        sVar5 = DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
        rcData.top = rcData.top + sVar5;
      }
      if ((*(uint *)(((COMPART *)ppart->pcom)[1].rgTech + 4) & 2) != 0) {
        c = CchGetString(idsWeaponHitsTargetsRangeEachTimeFired,(char *)szWork);
        sVar5 = DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
        rcData.top = rcData.top + sVar5;
        iVar7 = *(int *)((COMPART *)ppart->pcom)[1].rgTech << 4;
        pcVar6 = PszGetCompressedString(idsWeaponAlsoMakesExcellentMineSweeperCapable);
        c = _WSPRINTF((LPSTR)CONCAT22(iVar7,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
        DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
      }
      SelectObject(hdc,rghfontArial8[0]);
    }
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    if (((ppart->hs).wFlags & 0xffU) == 2) {
      ids = 0x155;
    }
    else if ((((ppart->hs).wFlags & 0xffU) == 0xe) || (((ppart->hs).wFlags & 0xffU) == 0x10)) {
      ids = 0x156;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstTorp) {
    ExpandRc(&rcData,-4,-4);
    szT_4._254_2_ = (rcData.right - rcData.left) / 3 + rcData.left;
    yText = rcData.top;
    c = CchGetString(idsPower,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)((COMPART *)ppart->pcom)[1].rgTech,
                                  (char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsRange,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsInitiative,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(((COMPART *)ppart->pcom)[1].rgTech + 2),
                                  (char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsAccuracy,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,szT_4._254_2_,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(((COMPART *)ppart->pcom)[1].rgTech + 4),
                                  (char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,szT_4._254_2_,yText,szWork,c);
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    yText = yText + (dyArial8 * 3) / 2;
    if (((ppart->hs).wFlags & 0xffU) == 7) {
      ids = 0x3a2;
    }
    else if ((7 < ((ppart->hs).wFlags & 0xffU)) && (((ppart->hs).wFlags & 0xffU) < 0xc)) {
      ids = 0x529;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstBomb) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    dyPct_2 = rcData.left;
    yText_5 = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    if (((ppart->hs).wFlags & 0xffU) == 9) {
      c = CchGetString
                    (idsBombDoesKillColonistsDestroyInstallationsBomb,(char *)szWork);
    }
    else if (*(int *)((COMPART *)ppart->pcom)[1].rgTech == 0) {
      c = CchGetString(idsBombWillKillAnyPlanetsPopulation,(char *)szWork);
    }
    else {
      CchGetString(idsBombWillKillApproximatelyDDPlanets,(char *)szWork);
      c = _WSPRINTF((LPSTR)CONCAT22(*(int *)((COMPART *)ppart->pcom)[1].rgTech / 10,
                                    (char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22((char *)szWork,unaff_SS),szT_4);
      if (((ppart->hs).wFlags & 0xffU) < 5) {
        xText_10 = 3;
      }
      else if ((((ppart->hs).wFlags & 0xffU) < 10) || (0xe < ((ppart->hs).wFlags & 0xffU))) {
        xText_10 = 0;
      }
      else {
        xText_10 = 999;
      }
      if (xText_10 != 0) {
        if (xText_10 == 999) {
          ids_00 = idsSmartBombsStrictlyAdditiveHaveMinimumKill;
        }
        else {
          ids_00 = idsIfPlanetHasDefensesBombGuaranteedKill;
        }
        CchGetString(ids_00,(char *)szWork);
        iVar7 = _WSPRINTF((LPSTR)CONCAT22(xText_10 * 100,(char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22((char *)szWork,unaff_SS),szT_4 + c);
        c = c + iVar7;
      }
      _strcpy((char *)szWork,szT_4);
    }
    WrapTextOut
              (hdc,&dyPct_2,&yText_5,(char *)szWork,c,rcData.left,
               rcData.right - rcData.left,(short *)0x0,0,1);
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    dyPct_2 = rcData.left;
    yText_5 = yText_5 + (dyArial8 >> 1);
    if (((ppart->hs).wFlags & 0xffU) == 9) {
      ids = 0x15f;
    }
    else {
      if (*(int *)(((COMPART *)ppart->pcom)[1].rgTech + 2) == 0) {
        c = CchGetString(idsBombWillDamagePlanetsMinesFactories,(char *)szWork);
      }
      else {
        CchGetString(idsBombWillDestroyApproximatelyDPlanetsMines,szT_4);
        c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(((COMPART *)ppart->pcom)[1].rgTech + 2),
                                      unaff_SS),(LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),
                      (char *)szWork);
      }
      WrapTextOut
                (hdc,&dyPct_2,&yText_5,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,1,1);
      uVar3._2_1_ = szT_4[0xec];
      uVar3._3_1_ = szT_4[0xed];
      uVar3._0_1_ = szT_4[0xea];
      uVar3._1_1_ = szT_4[0xeb];
      uVar2._2_1_ = szT_4[0xe2];
      uVar2._3_1_ = szT_4[0xe3];
      uVar2._0_1_ = szT_4[0xe0];
      uVar2._1_1_ = szT_4[0xe1];
      if ((((ppart->hs).wFlags & 0xffU) < 10) || (0xe < ((ppart->hs).wFlags & 0xffU))) {
        if (((ppart->hs).wFlags & 0xffU) == 8) {
          ids = 0x3a2;
        }
      }
      else {
        ids = 0x41;
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstMining) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    switch((ppart->hs).wFlags & 0xff) {
    case 0:
    case 5:
      ids = 0x14e;
    case 2:
    case 3:
    case 4:
      if (ids == -1) {
        ids = 0x150;
      }
    case 1:
    case 6:
      c = CchGetString(idsModuleContainsRobotsCapableMining,(char *)szWork);
      iVar7 = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                        (char *)szWork + c);
      c = c + iVar7;
      sVar5 = CchGetString
                        (idsKtEachMineralDependingConcentrationUninhabitedPl,
                         (char *)szWork + c);
      c = c + sVar5;
      if (((ppart->hs).wFlags & 0xffU) == 6) {
        ids = 0x3a2;
        sVar5 = CchGetString(idsModuleAlsoActs30Cloak30Jammer,(char *)szWork + c)
        ;
        c = c + sVar5;
      }
      break;
    case 7:
      ids = 0x15f;
      c = CchGetString
                    (idsModifiedMiningRobotTerraformsInhabitedPlanets1,(char *)szWork);
      break;
    default:
      goto switchD_10d8_5c55_default;
    }
    goto RESEARCH_PrintSpecial;
  }
  if (HVar1 == hstMines) {
    szT_4[0xf4] = -1;
    szT_4[0xf5] = -1;
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    rcData.top = rcData.top + dyArial8 * 5;
    for (i = 4; -1 < i; i = i + -1) {
      rcData.top = rcData.top - dyArial8;
      c = CchGetString(i + idsMinesLaidPerYear,(char *)szWork);
      if (szT_4._244_2_ == -1) {
        DVar14 = GetTextExtent(hdc,szWork,c);
        szT_4._244_2_ = (undefined2)DVar14;
      }
      RightTextOut(hdc,rcData.left + szT_4._244_2_,rcData.top,(char *)szWork,c,0)
      ;
    }
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags & 0xff) {
    case 0:
    case 1:
    case 2:
    case 3:
      szT_4[0xfa] = '\x04';
      szT_4[0xfb] = '\0';
      szT_4[0xf6] = '\x03';
      szT_4[0xf7] = '\0';
      szT_4[0xf8] = 'd';
      szT_4[0xf9] = '\0';
      szT_4[0xfc] = '}';
      szT_4[0xfd] = '\0';
      szT_4[0xfe] = -0xc;
      szT_4[0xff] = '\x01';
      szT_4[0xf2] = 'X';
      szT_4[0xf3] = '\x02';
      if (((ppart->hs).wFlags & 0xffU) == 1) {
        ids = 0x514;
      }
      else {
        ids = 0x151;
      }
      break;
    case 4:
    case 5:
    case 6:
      szT_4[0xfa] = '\x06';
      szT_4[0xfb] = '\0';
      szT_4[0xf6] = '\n';
      szT_4[0xf7] = '\0';
      szT_4[0xf8] = -0xc;
      szT_4[0xf9] = '\x01';
      szT_4[0xfc] = 'X';
      szT_4[0xfd] = '\x02';
      szT_4[0xfe] = -0x30;
      szT_4[0xff] = '\a';
      szT_4[0xf2] = -0x3c;
      szT_4[0xf3] = '\t';
      ids = 0x151;
      break;
    case 7:
    case 8:
    case 9:
      szT_4[0xfa] = '\x05';
      szT_4[0xfb] = '\0';
      szT_4[0xf6] = '#';
      szT_4[0xf7] = '\0';
      szT_4[0xf8] = '\0';
      szT_4[0xf9] = '\0';
      szT_4[0xfc] = '\0';
      szT_4[0xfd] = '\0';
      szT_4[0xfe] = '\0';
      szT_4[0xff] = '\0';
      szT_4[0xf2] = '\0';
      szT_4[0xf3] = '\0';
      if (((ppart->hs).wFlags & 0xffU) == 7) {
        ids = 0x152;
      }
      else {
        ids = 0x151;
      }
    }
    c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id * 10,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,rcData.left + szT_4._244_2_ + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    uVar8 = szT_4._250_2_;
    pcVar6 = PszGetCompressedString(idsWarpD2);
    c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,rcData.left + szT_4._244_2_ + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    iVar7 = (int)szT_4._246_2_ / 10;
    pcVar6 = PszGetCompressedString(idsDD2);
    c = _WSPRINTF((LPSTR)CONCAT22(iVar7,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,rcData.left + szT_4._244_2_ + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    uVar8 = szT_4._248_2_;
    pcVar6 = PszGetCompressedString(idsDDEngine);
    c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,rcData.left + szT_4._244_2_ + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    uVar8 = szT_4._254_2_;
    pcVar6 = PszGetCompressedString(idsDD3);
    c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    TextOut(hdc,rcData.left + szT_4._244_2_ + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    SelectObject(hdc,rghfontArial7[0]);
    c = CchGetString
                  (idsNumbersParenthesisFleetsContainingShipRamScoop,(char *)szWork);
    DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,&rcData),0x810);
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstSpecialSB) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags & 0xff) {
    case 0:
    case 2:
    case 3:
      ids = 0x42;
      idsT = 0x2e0;
      break;
    case 1:
    case 4:
    case 5:
    case 6:
      ids = 0x2e;
      idsT = 0x2e0;
      break;
    case 7:
    case 8:
    case 10:
    case 0xb:
    case 0xd:
    case 0xe:
    case 0xf:
      ids = 0x2f;
    case 9:
    case 0xc:
      idsT = 0x2e1;
      break;
    default:
      idsT = -1;
    }
    c = CchGetString(idsT,(char *)szWork);
    WrapTextOut
              (hdc,&xText,&yText,(char *)szWork,c,rcData.left,rcData.right - rcData.left,
               (short *)0x0,0,1);
    xText = rcData.left;
    yText = yText + (dyArial8 * 3) / 2;
    if (idsT == 0x2e0) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar22 = 1;
      sVar5 = 0;
      pcVar6 = PszGetCompressedString(idsSafeHullMass);
      DxStreamTextOut(hdc,&xText,yText,pcVar6,sVar5,sVar22);
      SelectObject(hdc,rghfontArial8[0]);
      if (((COMPART *)ppart->pcom + 1)->id == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTDKT,(char *)&DAT_1120_1120),
                      (char *)szWork);
      }
      DxStreamTextOut(hdc,&xText,yText,(char *)szWork,c,1);
      xText = rcData.left;
      yText = yText + dyArial8;
      SelectObject(hdc,rghfontArial8[1]);
      sVar22 = 1;
      sVar5 = 0;
      pcVar6 = PszGetCompressedString(idsSafeRange);
      DxStreamTextOut(hdc,&xText,yText,pcVar6,sVar5,sVar22);
      SelectObject(hdc,rghfontArial8[0]);
      if (*(int *)((COMPART *)ppart->pcom)[1].rgTech == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        uVar8 = *(undefined2 *)((COMPART *)ppart->pcom)[1].rgTech;
        pcVar6 = PszGetCompressedString(idsDLightYears);
        c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      }
      DxStreamTextOut(hdc,&xText,yText,(char *)szWork,c,1);
      if (((COMPART *)ppart->pcom + 1)->id == -1) {
        if (*(int *)((COMPART *)ppart->pcom)[1].rgTech == -1) {
          idsT = -1;
        }
        else {
          iVar7 = *(int *)((COMPART *)ppart->pcom)[1].rgTech * 5;
          pcVar6 = PszGetCompressedString(idsWarningShipsCanSuccessfullyGatedDL);
          c = _WSPRINTF((LPSTR)CONCAT22(iVar7,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
        }
      }
      else if (*(int *)((COMPART *)ppart->pcom)[1].rgTech == -1) {
        iVar7 = ((COMPART *)ppart->pcom + 1)->id * 5;
        pcVar6 = PszGetCompressedString(idsWarningShipsDktCanSuccessfullyGatedExceeding);
        c = _WSPRINTF((LPSTR)CONCAT22(iVar7,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      }
      else {
        iVar7 = ((COMPART *)ppart->pcom + 1)->id * 5;
        pcVar6 = PszGetCompressedString(idsWarningShipsDktMightSuccessfullyGatedD);
        c = _WSPRINTF((LPSTR)CONCAT22(iVar7,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      }
    }
    else if (idsT == 0x2e1) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar22 = 1;
      sVar5 = 0;
      pcVar6 = PszGetCompressedString(idsWarp);
      DxStreamTextOut(hdc,&xText,yText,pcVar6,sVar5,sVar22);
      SelectObject(hdc,rghfontArial8[0]);
      c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
      DxStreamTextOut(hdc,&xText,yText,(char *)szWork,c,1);
      xText = rcData.left;
      yText = yText + dyArial8;
      idsT = 0x457;
      if (7 < ((ppart->hs).wFlags & 0xffU)) {
        idsT = 0x458;
      }
      c = CchGetString(idsT,(char *)szWork);
    }
    if (idsT != -1) {
      xText = rcData.left;
      if (dyArial8 < 0xf) {
        iVar7 = 4;
      }
      else {
        iVar7 = 0;
      }
      yText = yText + iVar7 + dyArial8;
      SelectObject(hdc,rghfontArial7[0]);
      SetTextColor(hdc,0x7f);
      WrapTextOut
                (hdc,&xText,&yText,(char *)szWork,c,rcData.left,rcData.right - rcData.left
                 ,(short *)0x0,0,1);
      SelectObject(hdc,rghfontArial8[0]);
      SetTextColor(hdc,0);
    }
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstSBHull) {
    ExpandRc(&rcData,-4,-4);
    idsT = 0x4a;
    szT_4[0xfc] = (undefined1)rcData.left;
    szT_4[0xfd] = rcData.left._1_1_;
    szT_4[0xfe] = (undefined1)rcData.top;
    szT_4[0xff] = rcData.top._1_1_;
    if ((((ppart->hs).wFlags & 0xffU) == 1) || (((ppart->hs).wFlags & 0xffU) == 3)) {
      ids = 0x2dd;
    }
    else if (((ppart->hs).wFlags & 0xffU) == 4) {
      ids = 0x15a;
    }
    SelectObject(hdc,rghfontArial8[0]);
    if (((COMPART *)ppart->pcom + 1)->id == 0) {
      c = CchGetString(idsStarbaseHullDoesHaveSpaceDockCan,(char *)szWork);
      WrapTextOut
                (hdc,(short *)(szT_4 + 0xfc),(short *)(szT_4 + 0xfe),(char *)szWork,c,
                 rcData.left,rcData.right - rcData.left,(short *)0x0,0,1);
      szT_4._254_2_ = dyArial8 * 3 + rcData.top;
    }
    else {
      c = CchGetString(idsStarbaseHullHasSpaceDockCanBuild,(char *)szWork);
      WrapTextOut
                (hdc,(short *)(szT_4 + 0xfc),(short *)(szT_4 + 0xfe),(char *)szWork,c,
                 rcData.left,rcData.right - rcData.left,(short *)0x0,0,1);
      SelectObject(hdc,rghfontArial8[1]);
      szT_4._254_2_ = dyArial8 * 3 + rcData.top;
      szT_4._252_2_ = (rcData.right - rcData.left) / 2 + rcData.left;
      c = CchGetString(idsDockCapacity2,(char *)szWork);
      RightTextOut(hdc,szT_4._252_2_,szT_4._254_2_,(char *)szWork,c,0);
      SelectObject(hdc,rghfontArial8[0]);
      if (((COMPART *)ppart->pcom + 1)->id == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTDKT,(char *)&DAT_1120_1120),
                      (char *)szWork);
      }
      TextOut(hdc,szT_4._252_2_,szT_4._254_2_,szWork,c);
    }
    szT_4._254_2_ = szT_4._254_2_ + (dyArial8 * 3) / 2;
    szT_4._252_2_ = (rcData.right - rcData.left) / 2 + rcData.left;
    i = 0;
    while( true ) {
      uVar3._2_1_ = szT_4[0xec];
      uVar3._3_1_ = szT_4[0xed];
      uVar3._0_1_ = szT_4[0xea];
      uVar3._1_1_ = szT_4[0xeb];
      uVar2._2_1_ = szT_4[0xe2];
      uVar2._3_1_ = szT_4[0xe3];
      uVar2._0_1_ = szT_4[0xe0];
      uVar2._1_1_ = szT_4[0xe1];
      if (1 < i) break;
      c = CchGetString(idsT,(char *)szWork);
      SelectObject(hdc,rghfontArial8[1]);
      RightTextOut(hdc,szT_4._252_2_,szT_4._254_2_,(char *)szWork,c,0);
      SelectObject(hdc,rghfontArial8[0]);
      if (i == 0) {
        c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(((COMPART *)ppart->pcom)[1].rgTech + 2),
                                      (char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork)
        ;
      }
      else if (i == 1) {
        pHVar17 = LphuldefFromId(ppart->pcom->id);
        c = _WSPRINTF((LPSTR)((ulong)CONCAT22(((HULDEF *)pHVar17)->wFlags,
                                              (undefined1 *)&DAT_1120_1120) & 0x3fffff),
                      (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork)
        ;
      }
      TextOut(hdc,szT_4._252_2_,szT_4._254_2_,szWork,c);
      i = i + 1;
      idsT = idsT + 1;
      szT_4._254_2_ = szT_4._254_2_ + (dyArial8 * 3) / 2;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 != hstSpecialE) {
    if (HVar1 != hstSpecialM) {
      if (HVar1 == hstTerra) {
        ExpandRc(&rcData,-4,-4);
        SelectObject(hdc,rghfontArial8[1]);
        xText_10 = rcData.left;
        yText_5 = rcData.top;
        SelectObject(hdc,rghfontArial8[0]);
        c = 0;
        if (((ppart->hs).wFlags & 0xffU) < 8) {
          ids = 0x15c;
          c = CchGetString(idsAllowsModifyAnyPlanetsThreeEnvironmentVariables,szT_4);
          c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,unaff_SS),
                        (LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),(char *)szWork);
        }
        else {
          c = CchGetString(idsAllowsModifyPlanetsSDOriginalValue,szT_4);
          c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)
                                         (((int)(((ppart->hs).wFlags & 0xffU) - 8) / 4) * 2 + 0x47e)
                                        ,unaff_SS),(LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),
                        (char *)szWork);
        }
        if (0 < c) {
          WrapTextOut
                    (hdc,&xText_10,&yText_5,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
        uVar3._2_1_ = szT_4[0xec];
        uVar3._3_1_ = szT_4[0xed];
        uVar3._0_1_ = szT_4[0xea];
        uVar3._1_1_ = szT_4[0xeb];
        uVar2._2_1_ = szT_4[0xe2];
        uVar2._3_1_ = szT_4[0xe3];
        uVar2._0_1_ = szT_4[0xe0];
        uVar2._1_1_ = szT_4[0xe1];
      }
      else if (HVar1 == hstHull) {
        ExpandRc(&rcData,-4,-4);
        szT_4._252_2_ = (rcData.right - rcData.left) / 2 + rcData.left;
        szT_4[0xfe] = 'H';
        szT_4[0xff] = '\0';
        if ((((ppart->hs).wFlags & 0xffU) == 0xe) || (((ppart->hs).wFlags & 0xffU) == 0x1f)) {
          ids = 0x153;
        }
        else if ((((ppart->hs).wFlags & 0xffU) == 3) || (((ppart->hs).wFlags & 0xffU) == 0x19)) {
          ids = 0x159;
        }
        else if (((ppart->hs).wFlags & 0xffU) == 0x17) {
          ids = 0x154;
        }
        else if (((((ppart->hs).wFlags & 0xffU) == 0x14) || (((ppart->hs).wFlags & 0xffU) == 0x16))
                || (((ppart->hs).wFlags & 0xffU) == 0x18)) {
          ids = 0x14f;
        }
        else if ((((ppart->hs).wFlags & 0xffU) == 10) || (((ppart->hs).wFlags & 0xffU) == 8)) {
          ids = 0x157;
        }
        else if ((((ppart->hs).wFlags & 0xffU) == 0xc) || (((ppart->hs).wFlags & 0xffU) == 0x12)) {
          ids = 0x158;
        }
        else if ((((ppart->hs).wFlags & 0xffU) == 0x1b) || (((ppart->hs).wFlags & 0xffU) == 0x1c)) {
          ids = 0x165;
        }
        else if (((((ppart->hs).wFlags & 0xffU) == 4) || (((ppart->hs).wFlags & 0xffU) == 5)) ||
                (((ppart->hs).wFlags & 0xffU) == 6)) {
          ids = 0x30;
        }
        else if (((ppart->hs).wFlags & 0xffU) == 0x1e) {
          ids = 0x3a3;
        }
        for (i = 0; i < 4; i = i + 1) {
          c = CchGetString(szT_4._254_2_,(char *)szWork);
          SelectObject(hdc,rghfontArial8[1]);
          RightTextOut(hdc,szT_4._252_2_,rcData.top,(char *)szWork,c,0);
          SelectObject(hdc,rghfontArial8[0]);
          if (i == 0) {
            c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)((COMPART *)ppart->pcom)[1].rgTech,
                                          (char *)&DAT_1120_1120),(LPCSTR)0xd2c1120,
                          (char *)szWork);
          }
          else if (i == 1) {
            c = _WSPRINTF((LPSTR)CONCAT22(((COMPART *)ppart->pcom + 1)->id,(char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(PCTDKT,(char *)&DAT_1120_1120),
                          (char *)szWork);
          }
          else if (i == 2) {
            c = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(((COMPART *)ppart->pcom)[1].rgTech + 2),
                                          (char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                          (char *)szWork);
          }
          else if (i == 3) {
            pHVar17 = LphuldefFromId(ppart->pcom->id);
            c = _WSPRINTF((LPSTR)((ulong)CONCAT22(((HULDEF *)pHVar17)->wFlags,
                                                  (undefined1 *)&DAT_1120_1120) & 0x3fffff),
                          (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                          (char *)szWork);
          }
          TextOut(hdc,szT_4._252_2_,rcData.top,szWork,c);
          szT_4._254_2_ = szT_4._254_2_ + 1;
          rcData.top = rcData.top + (dyArial8 * 3) / 2;
        }
        if ((((ppart->hs).wFlags & 0xffU) == 0x19) || (((ppart->hs).wFlags & 0xffU) == 0x1a)) {
          szT_4._248_2_ = PszGetCompressedString(idsHullWillManufacture200UnitsFuelEach);
          if (((ppart->hs).wFlags & 0xffU) == 0x19) {
            szT_4[0xfa] = '\x05';
            szT_4[0xfb] = '\0';
          }
          else {
            szT_4[0xfa] = '\n';
            szT_4[0xfb] = '\0';
          }
          c = _WSPRINTF((LPSTR)CONCAT22(szT_4._250_2_,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(szT_4._248_2_,(char *)&DAT_1120_1120),
                        (char *)szWork);
          SelectObject(hdc,rghfontArial8[0]);
          szT_4[0xfc] = (undefined1)rcData.left;
          szT_4[0xfd] = rcData.left._1_1_;
          yText = rcData.top;
          WrapTextOut
                    (hdc,(short *)(szT_4 + 0xfc),&yText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
        else if ((((ppart->hs).wFlags & 0xffU) == 0x1b) || (((ppart->hs).wFlags & 0xffU) == 0x1c)) {
          c = CchGetString
                        (idsHullWillDoubleEfficiencyMineLayingPods,(char *)szWork);
          SelectObject(hdc,rghfontArial8[0]);
          szT_4[0xfc] = (undefined1)rcData.left;
          szT_4[0xfd] = rcData.left._1_1_;
          yText = rcData.top;
          WrapTextOut
                    (hdc,(short *)(szT_4 + 0xfc),&yText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
        uVar3._2_1_ = szT_4[0xec];
        uVar3._3_1_ = szT_4[0xed];
        uVar3._0_1_ = szT_4[0xea];
        uVar3._1_1_ = szT_4[0xeb];
        uVar2._2_1_ = szT_4[0xe2];
        uVar2._3_1_ = szT_4[0xe3];
        uVar2._0_1_ = szT_4[0xe0];
        uVar2._1_1_ = szT_4[0xe1];
      }
      else if (HVar1 == hstPlanetary) {
        ExpandRc(&rcData,-4,-4);
        SelectObject(hdc,rghfontArial8[1]);
        xText_10 = rcData.left;
        yText_5 = rcData.top;
        SelectObject(hdc,rghfontArial8[0]);
        c = 0;
        if ((((ppart->hs).wFlags & 0xffU) < 9) || (0xd < ((ppart->hs).wFlags & 0xffU))) {
          if (((ppart->hs).wFlags & 0xffU) < 9) {
            i = ((COMPART *)ppart->pcom + 1)->id;
            c = CchGetString(idsEnemyFleetsOrbitingPlanetCanDetectedD,szT_4);
            sVar5 = _abs(i);
            c = _WSPRINTF((LPSTR)CONCAT22(sVar5,unaff_SS),
                          (LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),(char *)szWork);
            if (i < 0) {
              WrapTextOut
                        (hdc,&xText_10,&yText_5,(char *)szWork,c,rcData.left,
                         rcData.right - rcData.left,(short *)0x0,0,1);
              xText_10 = rcData.left;
              yText_5 = yText_5 + (dyArial8 * 3) / 2;
              c = CchGetString(idsScannerCanDeterminePlanetsBasicStatsDistance,szT_4);
              c = _WSPRINTF((LPSTR)CONCAT22(-i >> 1,unaff_SS),
                            (LPCSTR)CONCAT22(szT_4,(char *)&DAT_1120_1120),(char *)szWork)
              ;
              ids = 0x164;
            }
            else {
              ids = 0x4ef;
            }
          }
          else if (((ppart->hs).wFlags & 0xffU) == 0xe) {
            ids = 0x3a4;
            c = CchGetString
                          (idsProcessGivesPlanetNewBirthTracesCivilization,(char *)szWork)
            ;
          }
        }
        else {
          SelectObject(hdc,rghfontArial8[1]);
          rcData.right = rcData.right + -2;
          c = CchGetString(idsShieldCoverageVsDefenseQuan,(char *)szWork);
          CtrTextOut(hdc,(rcData.right - rcData.left >> 1) + rcData.left,rcData.top,
                              (char *)szWork,c);
          rcData.top = rcData.top + dyArial8;
          sVar5 = CchGetString(idsNum,szT_4);
          DVar14 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT_4),(int)(char)sVar5);
          dxStr = (short)DVar14;
          iVar7 = (((rcData.right - rcData.left) - dxStr) + -10) / 5;
          dyPct_2 = (((rcData.bottom - rcData.top) - dyArial8) + -8) / 5;
          PatBlt(hdc,rcData.left + dxStr + 6,rcData.top,1,
                 ((rcData.bottom - rcData.top) - dyArial8) + -4,0x42);
          PatBlt(hdc,rcData.left + dxStr + 6,(rcData.bottom - dyArial8) + -4,
                 ((rcData.right - rcData.left) - dxStr) + -6,1,0x42);
          iVar9 = rcData.left + dxStr;
          y_2 = (rcData.bottom - dyArial8) + -4 + dyPct_2 * -5;
          SetTextColor(hdc,0x7f0000);
          sVar5 = CchGetString(idsStandard,(char *)szWork);
          RightTextOut
                    (hdc,rcData.right,rcData.bottom + -3 + dyArial8 * -3,
                     (char *)szWork,(int)(char)sVar5,0);
          SetTextColor(hdc,0x7f);
          sVar5 = CchGetString(idsSmart,(char *)szWork);
          RightTextOut
                    (hdc,rcData.right,rcData.bottom + -4 + dyArial8 * -2,
                     (char *)szWork,(int)(char)sVar5,0);
          pct_3 = 100;
          SetTextColor(hdc,0);
          for (; 0 < pct_3; pct_3 = pct_3 + -0x14) {
            c = _WSPRINTF((LPSTR)CONCAT22(pct_3,(char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(PCTDPCTPCT,(char *)&DAT_1120_1120),
                          (char *)szWork);
            RightTextOut
                      (hdc,iVar9,y_2 - (dyArial8 >> 1),(char *)szWork,c,0);
            PatBlt(hdc,iVar9 + 4,y_2,5,1,0x42);
            y_2 = y_2 + dyPct_2;
          }
          iVar10 = rcData.bottom - dyArial8;
          sVar5 = 0;
          cLen = _strlen(szT_4);
          RightTextOut(hdc,iVar9,iVar10,szT_4,cLen,sVar5);
          x_2 = iVar9 + 6;
          DVar14 = GetTextExtent(hdc,(LPCSTR)0x11200d31,1);
          iVar9 = (int)DVar14;
          for (i = 0; i < 6; i = i + 1) {
            uVar8 = _WSPRINTF((LPSTR)CONCAT22(i * 0x14,(char *)&DAT_1120_1120),
                              (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                              (char *)szWork);
            if (i == 0) {
              iVar12 = iVar9 >> 1;
            }
            else {
              iVar12 = iVar9;
              if (i == 5) {
                iVar12 = (iVar9 * 3) / 2;
              }
            }
            TextOut(hdc,x_2 - iVar12,iVar10,szWork,(int)(char)uVar8);
            if (0 < i) {
              PatBlt(hdc,x_2,iVar10 + -6,1,5,0x42);
            }
            x_2 = x_2 + iVar7;
          }
          HVar11 = SelectObject(hdc,hpenDkBlue);
          iVar10 = rcData.left + dxStr;
          iVar12 = rcData.bottom - dyArial8;
          iVar9 = ((COMPART *)ppart->pcom + 1)->id;
          for (c = 0; ldelta._0_2_ = 1000 - iVar9, c < 2; c = c + 1) {
            uVar19 = 1000000;
            i = 0;
            while( true ) {
              lpct._2_2_ = (int)(uVar19 >> 0x10);
              lpct._0_2_ = (uint)uVar19;
              if (100 < i) break;
              sVar5 = MulDiv(i,iVar7,0x14);
              iVar13 = sVar5 + iVar10 + 6;
              uVar23 = 3;
              uVar8 = 0xd40;
              num = __aFulmul(CONCAT22((0xf - lpct._2_2_) - (uint)(0x4240 < (uint)lpct),
                                               0x4240 - (uint)lpct),(long)dyPct_2);
              lVar18 = __aFldiv(num,CONCAT22(uVar23,uVar8));
              iVar9 = (iVar12 + -4) - (int)lVar18;
              uVar23 = 0;
              uVar8 = 1000;
              uVar19 = __aFulmul(uVar19,(long)(int)ldelta);
              uVar19 = __aFldiv(uVar19,CONCAT22(uVar23,uVar8));
              if (i == 0) {
                MoveTo(hdc,iVar13,iVar9);
              }
              else {
                LineTo(hdc,iVar13,iVar9);
              }
              i = i + 1;
            }
            iVar9 = ((COMPART *)ppart->pcom + 1)->id / 2;
            SelectObject(hdc,hpenRadar);
          }
          SelectObject(hdc,HVar11);
          c = 0;
          if (((ppart->hs).wFlags & 0xffU) < 0xb) {
            ids = 0x4ef;
          }
          else {
            ids = 0x15b;
          }
        }
        if (0 < c) {
          WrapTextOut
                    (hdc,&xText_10,&yText_5,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
        uVar3._2_1_ = szT_4[0xec];
        uVar3._3_1_ = szT_4[0xed];
        uVar3._0_1_ = szT_4[0xea];
        uVar3._1_1_ = szT_4[0xeb];
        uVar2._2_1_ = szT_4[0xe2];
        uVar2._3_1_ = szT_4[0xe3];
        uVar2._0_1_ = szT_4[0xe0];
        uVar2._1_1_ = szT_4[0xe1];
      }
      goto switchD_10d8_5c55_default;
    }
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    uVar3._2_1_ = szT_4[0xec];
    uVar3._3_1_ = szT_4[0xed];
    uVar3._0_1_ = szT_4[0xea];
    uVar3._1_1_ = szT_4[0xeb];
    uVar2._2_1_ = szT_4[0xe2];
    uVar2._3_1_ = szT_4[0xe3];
    uVar2._0_1_ = szT_4[0xe0];
    uVar2._1_1_ = szT_4[0xe1];
    switch((ppart->hs).wFlags & 0xff) {
    case 0:
      idsT = 0xd7;
      ids = 0x15d;
      break;
    case 1:
      idsT = 0xd8;
      ids = 0x15e;
      break;
    case 2:
    case 3:
      if (((ppart->hs).wFlags & 0xffU) == 2) {
        uVar8 = 0x32;
      }
      else {
        uVar8 = 100;
      }
      pcVar6 = PszGetCompressedString(idsPodIncreasesCargoCapacityShipDkt);
      c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      goto RESEARCH_PrintSpecial;
    case 4:
      idsT = 0xd6;
      ids = 0x3a2;
      break;
    case 5:
    case 6:
      if (((ppart->hs).wFlags & 0xffU) == 5) {
        uVar8 = 0xfa;
      }
      else {
        uVar8 = 500;
      }
      pcVar6 = PszGetCompressedString(idsPodIncreasesFuelCapacityShipDmg);
      c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      goto RESEARCH_PrintSpecial;
    case 7:
    case 8:
      if (((ppart->hs).wFlags & 0xffU) == 7) {
        uVar8 = 4;
      }
      else {
        uVar8 = 2;
      }
      pcVar6 = PszGetCompressedString(idsIncreasesSpeedBattle1DSquareMovement);
      c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
      goto RESEARCH_PrintSpecial;
    case 9:
      idsT = 0xd9;
      ids = 0x3a2;
      break;
    case 10:
      idsT = 0xda;
      break;
    default:
      idsT = -1;
    }
    if (idsT == -1) goto switchD_10d8_5c55_default;
    c = CchGetString(idsT,(char *)szWork);
    goto RESEARCH_PrintSpecial;
  }
  ExpandRc(&rcData,-4,-4);
  SelectObject(hdc,rghfontArial8[1]);
  xText = rcData.left;
  yText = rcData.top;
  SelectObject(hdc,rghfontArial8[0]);
  switch((ppart->hs).wFlags & 0xff) {
  case 0:
    idsT = 0xdb;
    ids = 0x39;
    break;
  case 1:
  case 2:
  case 3:
    if (((ppart->hs).wFlags & 0xffU) == 3) {
      ids = 0x39;
      idsT = 0x55;
    }
    else if (((ppart->hs).wFlags & 0xffU) == 1) {
      idsT = 0x23;
    }
    else {
      idsT = 0x37;
    }
    sVar5 = idsT;
    pcVar6 = PszGetCompressedString(idsCloaksAnyShipReducingRangeWhichScanners);
    c = _WSPRINTF((LPSTR)CONCAT22(sVar5,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    goto RESEARCH_PrintSpecial;
  case 4:
    idsT = 0xdd;
    ids = 0x3a2;
    break;
  case 5:
  case 6:
  case 7:
    idsT = 0x3a1;
    sVar5 = ((COMPART *)ppart->pcom + 1)->id;
    pcVar6 = PszGetCompressedString(idsModuleIncreasesAccuracyTorpedoesDIncreasesInitia);
    c = _WSPRINTF((LPSTR)CONCAT22(sVar5,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    goto RESEARCH_PrintSpecial;
  case 8:
  case 0xb:
    ids = 0x39f;
  case 9:
  case 10:
    idsT = 0x3a0;
    sVar5 = ((COMPART *)ppart->pcom + 1)->id;
    pcVar6 = PszGetCompressedString(idsHasDChanceDeflectingIncomingTorpedoesDeflected);
    c = _WSPRINTF((LPSTR)CONCAT22(sVar5,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    goto RESEARCH_PrintSpecial;
  case 0xd:
    ids = 0x39a;
  case 0xc:
    if (((ppart->hs).wFlags & 0xffU) == 0xc) {
      uVar8 = 10;
    }
    else {
      uVar8 = 0x14;
    }
    pcVar6 = PszGetCompressedString(idsIncreasesDamageDoneBeamWeaponsShipD);
    c = _WSPRINTF((LPSTR)CONCAT22(uVar8,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),(char *)szWork);
    goto RESEARCH_PrintSpecial;
  case 0xe:
    ids = 0x398;
    idsT = 0x39b;
    break;
  case 0xf:
    ids = 0x397;
    idsT = 0x39c;
    break;
  case 0x10:
    ids = 0x399;
    idsT = 0x39d;
    break;
  default:
    idsT = -1;
  }
  if (idsT != -1) {
    c = CchGetString(idsT,(char *)szWork);
RESEARCH_PrintSpecial:
    WrapTextOut
              (hdc,&xText,&yText,(char *)szWork,c,rcData.left,rcData.right - rcData.left,
               (short *)0x0,0,1);
    xText = rcData.left;
    yText = yText + dyArial8 * 2;
  }
  uVar3._2_1_ = szT_4[0xec];
  uVar3._3_1_ = szT_4[0xed];
  uVar3._0_1_ = szT_4[0xea];
  uVar3._1_1_ = szT_4[0xeb];
  uVar2._2_1_ = szT_4[0xe2];
  uVar2._3_1_ = szT_4[0xe3];
  uVar2._0_1_ = szT_4[0xe0];
  uVar2._1_1_ = szT_4[0xe1];
switchD_10d8_5c55_default:
  if (ids != -1) {
    szT_4._224_4_ = uVar2;
    szT_4._234_4_ = uVar3;
    c = CchGetString(ids,(char *)szWork);
    SetRect((undefined2 *)CONCAT22(unaff_SS,szT_4 + 0xf8),4,dy + dyArial8 * -2,dx + -4,
            dy + -5);
    if (dyArial8 < 0xf) {
      SelectObject(hdc,rghfontArial7[0]);
    }
    else {
      SelectObject(hdc,rghfontArial6[0]);
    }
    if (lVar15 == -1) {
      uVar4 = 0x7f;
    }
    else {
      uVar4 = 0;
    }
    SetTextColor(hdc,(ulong)uVar4);
    DRAWTEXT(hdc,szWork,c,(undefined2 *)CONCAT22(unaff_SS,szT_4 + 0xf8),0x810);
    if (lVar15 == -1) {
      SetTextColor(hdc,0);
    }
  }
  return;
}



// ======================================================================
// Function: ProjectedResearchSpending
// Address: 10d8:65ae
// Segment: MEMORY_RESEARCH
// ======================================================================


long ProjectedResearchSpending(long pct)

{
  PLANET *pPVar1;
  undefined2 uVar2;
  bool bVar3;
  short cBogus;
  char pctSav;
  PLANET *lpplMac;
  long lSpend;
  short cRes;
  PLANET *lppl;
  long lRes;
  
  lSpend._0_2_ = 0;
  lSpend._2_2_ = 0;
  pctSav = *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0);
  *(undefined1 *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) = (char)pct;
  lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
  lpplMac._2_2_ = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < (PLANET *)lpplMac) {
    if (((PLANET *)lppl)->iPlayer == idPlayer) {
      lRes._0_2_ = CResourcesAtPlanet(lppl,idPlayer);
      lRes._2_2_ = (int)(uint)lRes >> 0xf;
      uVar2 = (undefined2)((ulong)lppl >> 0x10);
      pPVar1 = (PLANET *)lppl;
      if (((*(int *)&pPVar1->lpplprod == 0) && (*(int *)((int)&pPVar1->lpplprod + 2) == 0)) ||
         (((PLPROD *)pPVar1->lpplprod)->iprodMac == 0)) {
        bVar3 = CARRY2((uint)lSpend,(uint)lRes);
        lSpend._0_2_ = (uint)lSpend + (uint)lRes;
        lSpend._2_2_ = lSpend._2_2_ + lRes._2_2_ + (uint)bVar3;
      }
      else {
        EstimateItemProdSched(lppl,(PLPROD *)0x0,-1,&cRes,&cBogus);
        bVar3 = CARRY2((uint)lSpend,cRes);
        lSpend._0_2_ = (uint)lSpend + cRes;
        lSpend._2_2_ = lSpend._2_2_ + (cRes >> 0xf) + (uint)bVar3;
      }
    }
    lppl = (PLANET *)CONCAT22(lppl._2_2_,(PLANET *)lppl + 1);
  }
  *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) = pctSav;
  return CONCAT22(lSpend._2_2_,(uint)lSpend);
}



// ======================================================================
// Function: CostOfDevelopingItem
// Address: 10d8:66e0
// Segment: MEMORY_RESEARCH
// ======================================================================


long CostOfDevelopingItem(char *rgTech)

{
  long lVar1;
  int iVar2;
  undefined2 *puVar3;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar4;
  long lVar5;
  long lVar6;
  long lCur;
  short i;
  short fUnreachable;
  long lCost;
  char rgTechSav [6];
  char *pTech;
  long lSpent;
  
  lVar6 = CONCAT22(unaff_SI,unaff_DI);
  lVar1 = 0;
  iVar2 = idPlayer * 0xc0 + 0x59bc;
  i = 0;
  while( true ) {
    if ((5 < i) || ('\x1a' < ((char *)rgTech)[i])) break;
    i = i + 1;
  }
  if (i < 6) {
    lVar1 = -1;
  }
  else {
    for (i = 0; i < 6; i = i + 1) {
      rgTechSav[i] = *(char *)(iVar2 + i);
      if ((int)*(char *)(iVar2 + i) < (int)((char *)rgTech)[i]) {
        puVar3 = (undefined2 *)(idPlayer * 0xc0 + 0x59c2 + i * 4);
        lVar4 = CONCAT22(puVar3[1],*puVar3);
        if (((uint)game.wCrap >> 1 & 1) != 0) {
          lVar4 = __aFlshl(lVar6,(int)((char *)rgTech)[i]);
        }
        lSpent._2_2_ = (int)((ulong)lVar4 >> 0x10);
        lSpent._0_2_ = (int)lVar4;
        lVar4 = CONCAT22(-(lSpent._2_2_ + (uint)((int)lSpent != 0)),-(int)lSpent);
        while (*(char *)(iVar2 + i) < ((char *)rgTech)[i]) {
          lVar5 = GetTechLevelCost(i,*(char *)(iVar2 + i) + 1,idPlayer);
          lVar4 = lVar5 + lVar4;
          *(char *)(iVar2 + i) = *(char *)(iVar2 + i) + '\x01';
        }
        if ((lVar4 < 0x10000) && (lVar4 < 0)) {
          lVar4 = 0;
        }
        lVar1 = lVar4 + lVar1;
      }
    }
    for (i = 0; i < 6; i = i + 1) {
      *(char *)(iVar2 + i) = rgTechSav[i];
    }
  }
  return lVar1;
}



// ======================================================================
// Function: FShouldPartBeHidden
// Address: 10d8:68c4
// Segment: MEMORY_RESEARCH
// ======================================================================


short FShouldPartBeHidden(PART *ppart)

{
  HullSlotType HVar1;
  uint uVar2;
  short sVar3;
  ushort grbitTrader;
  short iItem;
  
  if (idPlayer == -1) {
    sVar3 = 0;
  }
  else {
    grbitTrader = 0;
    uVar2 = (ppart->hs).wFlags & 0xff;
    HVar1 = (ppart->hs).grhst;
    if (HVar1 == hstEngine) {
      if (uVar2 == 8) {
        grbitTrader = 0x200;
      }
    }
    else if (HVar1 == hstShield) {
      if (uVar2 == 6) {
        grbitTrader = 4;
      }
    }
    else if (HVar1 == hstArmor) {
      if (uVar2 == 9) {
        grbitTrader = 8;
      }
    }
    else if (HVar1 == hstBeam) {
      if (uVar2 == 0x12) {
        grbitTrader = 0x80;
      }
    }
    else if (HVar1 == hstTorp) {
      if (uVar2 == 7) {
        grbitTrader = 0x40;
      }
    }
    else if (HVar1 == hstBomb) {
      if (uVar2 == 8) {
        grbitTrader = 0x20;
      }
    }
    else if (HVar1 == hstMining) {
      if (uVar2 == 6) {
        grbitTrader = 0x10;
      }
    }
    else if (HVar1 == hstSpecialE) {
      if (uVar2 == 4) {
        grbitTrader = 2;
      }
    }
    else if (HVar1 == hstSpecialM) {
      if (uVar2 == 4) {
        grbitTrader = 1;
      }
      else if (uVar2 == 9) {
        grbitTrader = 0x800;
      }
    }
    else if (HVar1 == hstHull) {
      if (uVar2 == 0x1e) {
        grbitTrader = 0x100;
      }
    }
    else if ((HVar1 == hstPlanetary) && (uVar2 == 0xe)) {
      grbitTrader = 0x400;
    }
    if ((grbitTrader == 0) ||
       ((*(uint *)((int)&rgplr[0].grbitTrader + idPlayer * 0xc0) & grbitTrader) !=
        0)) {
      sVar3 = 0;
    }
    else {
      sVar3 = 1;
    }
  }
  return sVar3;
}



