// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: ResearchDlg
// Address: 10d8:0000
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short ResearchDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  long lVar1;
  HGDIOBJ HVar2;
  short sVar3;
  char *pcVar4;
  uint uVar5;
  HWND HVar6;
  UINT UVar7;
  HBRUSH HVar8;
  PLANET *pPVar9;
  undefined1 *puVar10;
  ulong *puVar11;
  ushort unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar12;
  undefined2 uVar13;
  undefined2 unaff_SS;
  bool bVar14;
  DWORD DVar15;
  DWORD DVar16;
  ulong uVar17;
  LRESULT LVar18;
  ushort in_stack_0000ffac;
  RECT rcWindow;
  char *psz;
  HFONT hfontSav;
  PLANET *lpplMac;
  short c;
  PLANET *lppl;
  short dxCurrent;
  POINT local_38;
  RECT rc;
  short dx;
  PAINTSTRUCT ps;
  short i;
  short y;
  HDC hdc;
  
                    /* Segment:    28
                       Offset:     000c22c0
                       Length:     6a55
                       Min Alloc:  6a55
                       Flags:      1d10
                           Code
                           Discardable
                           Moveable
                           LoadOnCall
                           Impure (Non-shareable)
                        */
  uVar13 = 0x10d8;
  if (message == WM_PAINT) {
    hdc = BeginPaint(hwnd,&ps);
    GetClientRect(hwnd,&rc);
    DrawResearchDlg(hwnd,hdc,&rc,-1);
    EndPaint(hwnd,&ps);
    HVar8 = 1;
    lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
    goto LAB_10d8_0901;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,&rc);
    FillRect(wParam,&rc,hbrButtonFace);
    HVar8 = 1;
    lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
    goto LAB_10d8_0901;
  }
  if (message == WM_CTLCOLOR) {
    for (i = 0x431; i < 0x437; i = i + 1) {
      local_38.y = (HWND)lParam;
      HVar6 = GetDlgItem(hwnd,i);
      if (local_38.y == HVar6) break;
    }
    if ((i < 0x437) ||
       (uVar17 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffac), (int)uVar17 == 6)
       ) {
      SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
      HVar8 = hbrButtonFace;
      lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
      goto LAB_10d8_0901;
    }
  }
  else {
    if (message == WM_SETCURSOR) {
      GetCursorPos(&local_38);
      uVar13 = 0x14f8;
      ScreenToClient(hwnd,&local_38);
      puVar11 = &stack0xffa4;
      if ((((0xc < local_38.x) && (local_38.x < dxResLeft + -0xc)) &&
          (yTopFutureTech <= local_38.y)) &&
         (local_38.y < cFutureTech * dyArial8 + yTopFutureTech)) {
        setcursor(hcurArrowHelp);
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
      if (((yTopTechNote != -1) &&
          (puVar11 = &stack0xffa4, yTopTechNote <= local_38.y)) &&
         ((puVar11 = &stack0xffa4, local_38.y < dyArial8 * 2 + yTopTechNote &&
          (puVar11 = &stack0xffa4, dxResLeft < local_38.x)))) {
        setcursor(hcurArrowHelp);
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        pctResGlob =
             (short)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0);
        iResTechNow =
             (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf;
        CheckRadioButton(hwnd,0x431,0x436,iResTechNow + 0x431);
        local_38.y = GetDC(hwnd);
        HVar2 = SelectObject(local_38.y,rghfontArial8[1]);
        sVar3 = CchGetString(idsCurrent,(char *)szWork);
        DVar15 = GetTextExtent(local_38.y,szWork,sVar3);
        puVar10 = &stack0xffa8;
        dxResRadio = 0;
        for (i = 0x431; i < 0x437; i = i + 1) {
          *(char **)(puVar10 + -2) = (char *)szWork;
          *(short *)(puVar10 + -4) = i + -0x3dd;
          *(undefined2 *)(puVar10 + -6) = 0x14f8;
          *(undefined2 *)(puVar10 + -8) = 0xaf;
          sVar3 = CchGetString(*(StringId *)(puVar10 + -4),*(char **)(puVar10 + -2));
          *(short *)(puVar10 + -2) = local_38.y;
          *(undefined2 *)(puVar10 + -4) = 0x1120;
          *(char **)(puVar10 + -6) = (char *)szWork;
          *(short *)(puVar10 + -8) = sVar3;
          *(undefined2 *)(puVar10 + -10) = 0x1040;
          *(undefined2 *)(puVar10 + -0xc) = 199;
          DVar16 = GetTextExtent(*(HDC *)(puVar10 + -2),*(LPCSTR *)(puVar10 + -6),
                                 *(short *)(puVar10 + -8));
          sVar3 = (int)DVar16;
          if ((int)DVar16 <= dxResRadio) {
            sVar3 = dxResRadio;
          }
          dxResRadio = sVar3;
          *(HWND *)(puVar10 + -2) = hwnd;
          *(short *)(puVar10 + -4) = i;
          *(undefined2 *)(puVar10 + -6) = 0x14f8;
          *(undefined2 *)(puVar10 + -8) = 0xe6;
          local_38.x = GetDlgItem(*(HWND *)(puVar10 + -2),*(ControlId *)(puVar10 + -4));
          *(short *)(puVar10 + -2) = local_38.x;
          *(undefined2 *)(puVar10 + -4) = 0x1120;
          *(char **)(puVar10 + -6) = (char *)szWork;
          *(undefined2 *)(puVar10 + -8) = 0x14f8;
          *(undefined2 *)(puVar10 + -10) = 0xf8;
          SetWindowText(*(HWND *)(puVar10 + -2),*(LPCSTR *)(puVar10 + -6));
          *(short *)(puVar10 + -8) = local_38.x;
          *(undefined2 *)(puVar10 + -10) = 0x30;
          *(ushort *)(puVar10 + -0xc) = rghfontArial8[1];
          *(undefined2 *)(puVar10 + -0xe) = 0;
          *(undefined2 *)(puVar10 + -0x10) = 0;
          *(undefined2 *)(puVar10 + -0x12) = 0x14f8;
          *(undefined2 *)(puVar10 + -0x14) = 0x110;
          SendMessage(*(HWND *)(puVar10 + -8),*(WMType *)(puVar10 + -10),*(WPARAM *)(puVar10 + -0xc)
                      ,*(LPARAM *)(puVar10 + -0x10));
          puVar10 = puVar10 + -6;
        }
        dxResRadio = dxResRadio + 0x40;
        y = (dyArial8 * 4 - (dyArial8 >> 1)) + 1;
        for (i = 0x431; i < 0x437; i = i + 1) {
          *(HWND *)(puVar10 + -2) = hwnd;
          *(short *)(puVar10 + -4) = i;
          *(undefined2 *)(puVar10 + -6) = 0x14f8;
          *(undefined2 *)(puVar10 + -8) = 0x14b;
          local_38.x = GetDlgItem(*(HWND *)(puVar10 + -2),*(ControlId *)(puVar10 + -4));
          *(short *)(puVar10 + -2) = local_38.x;
          *(undefined2 *)(puVar10 + -4) = 0;
          *(undefined2 *)(puVar10 + -6) = 0x10;
          *(short *)(puVar10 + -8) = y;
          *(short *)(puVar10 + -10) = dxResRadio;
          *(int *)(puVar10 + -0xc) = (dyArial8 * 3) / 2;
          *(undefined2 *)(puVar10 + -0xe) = 0x44;
          *(undefined2 *)(puVar10 + -0x10) = 0x14f8;
          *(undefined2 *)(puVar10 + -0x12) = 0x177;
          SetWindowPos(*(HWND *)(puVar10 + -2),*(HWND *)(puVar10 + -4),*(short *)(puVar10 + -6),
                       *(short *)(puVar10 + -8),*(short *)(puVar10 + -10),*(short *)(puVar10 + -0xc)
                       ,*(UINT *)(puVar10 + -0xe));
          y = y + (dyArial8 * 3) / 2;
        }
        *(HWND *)(puVar10 + -2) = hwnd;
        *(undefined2 *)(puVar10 + -4) = 0x43b;
        *(undefined2 *)(puVar10 + -6) = 0x14f8;
        *(undefined2 *)(puVar10 + -8) = 0x1a1;
        local_38.x = GetDlgItem(*(HWND *)(puVar10 + -2),*(ControlId *)(puVar10 + -4));
        for (i = 0; i < 8; i = i + 1) {
          *(short *)(puVar10 + -2) = i + 0x53;
          *(undefined2 *)(puVar10 + -4) = 0x14f8;
          *(undefined2 *)(puVar10 + -6) = 0x1b8;
          pcVar4 = PszGetCompressedString(*(StringId *)(puVar10 + -2));
          *(short *)(puVar10 + -2) = local_38.x;
          *(undefined2 *)(puVar10 + -4) = 0x403;
          *(undefined2 *)(puVar10 + -6) = 0;
          *(undefined2 *)(puVar10 + -8) = 0x1120;
          *(char **)(puVar10 + -10) = pcVar4;
          *(undefined2 *)(puVar10 + -0xc) = 0x1010;
          *(undefined2 *)(puVar10 + -0xe) = 0x1d5;
          SendMessage(*(HWND *)(puVar10 + -2),*(WMType *)(puVar10 + -4),*(WPARAM *)(puVar10 + -6),
                      *(LPARAM *)(puVar10 + -10));
        }
        i = (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) >> 4;
        if (i == 6) {
          i = 0;
        }
        else if (i < 6) {
          i = i + 1;
        }
        *(short *)(puVar10 + -2) = local_38.x;
        *(undefined2 *)(puVar10 + -4) = 0x40e;
        *(short *)(puVar10 + -6) = i;
        *(undefined2 *)(puVar10 + -8) = 0;
        *(undefined2 *)(puVar10 + -10) = 0;
        *(undefined2 *)(puVar10 + -0xc) = 0x14f8;
        *(undefined2 *)(puVar10 + -0xe) = 0x233;
        SendMessage(*(HWND *)(puVar10 + -2),*(WMType *)(puVar10 + -4),*(WPARAM *)(puVar10 + -6),
                    *(LPARAM *)(puVar10 + -10));
        dxResLeft = dxResRadio + (int)DVar15 + 0x28;
        dxResRight = 0;
        for (i = 0x4c; i < 0x52; i = i + 1) {
          *(char **)(puVar10 + -2) = (char *)szWork;
          *(short *)(puVar10 + -4) = i;
          *(undefined2 *)(puVar10 + -6) = 0x14f8;
          *(undefined2 *)(puVar10 + -8) = 0x259;
          sVar3 = CchGetString(*(StringId *)(puVar10 + -4),*(char **)(puVar10 + -2));
          *(short *)(puVar10 + -2) = local_38.y;
          *(undefined2 *)(puVar10 + -4) = 0x1120;
          *(char **)(puVar10 + -6) = (char *)szWork;
          *(short *)(puVar10 + -8) = sVar3;
          *(undefined2 *)(puVar10 + -10) = 0x1040;
          *(undefined2 *)(puVar10 + -0xc) = 0x271;
          DVar15 = GetTextExtent(*(HDC *)(puVar10 + -2),*(LPCSTR *)(puVar10 + -6),
                                 *(short *)(puVar10 + -8));
          sVar3 = (int)DVar15;
          if ((int)DVar15 <= dxResRight) {
            sVar3 = dxResRight;
          }
          dxResRight = sVar3;
        }
        dxResStrRight = dxResRight;
        *(short *)(puVar10 + -2) = local_38.y;
        *(undefined2 *)(puVar10 + -4) = 0x38f;
        *(undefined2 *)(puVar10 + -6) = 0x14f8;
        *(undefined2 *)(puVar10 + -8) = 0x2a4;
        pcVar4 = PszGetCompressedString(*(StringId *)(puVar10 + -4));
        *(undefined2 *)(puVar10 + -4) = 0x1120;
        *(char **)(puVar10 + -6) = pcVar4;
        *(undefined2 *)(puVar10 + -8) = 7;
        *(undefined2 *)(puVar10 + -10) = 0x1010;
        *(undefined2 *)(puVar10 + -0xc) = 0x2b4;
        DVar15 = GetTextExtent(*(HDC *)(puVar10 + -2),*(LPCSTR *)(puVar10 + -6),
                               *(short *)(puVar10 + -8));
        dxResRight = dxResRight + (int)DVar15 + 0x30;
        y = y + dyArial8 * 10;
        *(HWND *)(puVar10 + -2) = hwnd;
        *(undefined2 *)(puVar10 + -4) = 2;
        *(undefined2 *)(puVar10 + -6) = 0x14f8;
        *(undefined2 *)(puVar10 + -8) = 0x2d7;
        HVar6 = GetDlgItem(*(HWND *)(puVar10 + -2),*(ControlId *)(puVar10 + -4));
        *(HWND *)(puVar10 + -2) = HVar6;
        *(undefined2 *)(puVar10 + -4) = 0;
        *(short *)(puVar10 + -6) = dxResLeft + dxResRight + -0x98;
        *(short *)(puVar10 + -8) = (y - (dyArial8 * 3) / 2) + -8;
        *(undefined2 *)(puVar10 + -10) = 0x46;
        *(int *)(puVar10 + -0xc) = (dyArial8 * 3) / 2;
        *(undefined2 *)(puVar10 + -0xe) = 0x44;
        *(undefined2 *)(puVar10 + -0x10) = 0x14f8;
        *(undefined2 *)(puVar10 + -0x12) = 0x318;
        SetWindowPos(*(HWND *)(puVar10 + -2),*(HWND *)(puVar10 + -4),*(short *)(puVar10 + -6),
                     *(short *)(puVar10 + -8),*(short *)(puVar10 + -10),*(short *)(puVar10 + -0xc),
                     *(UINT *)(puVar10 + -0xe));
        *(HWND *)(puVar10 + -2) = hwnd;
        *(undefined2 *)(puVar10 + -4) = 0x76;
        *(undefined2 *)(puVar10 + -6) = 0x14f8;
        *(undefined2 *)(puVar10 + -8) = 0x324;
        HVar6 = GetDlgItem(*(HWND *)(puVar10 + -2),*(ControlId *)(puVar10 + -4));
        *(HWND *)(puVar10 + -2) = HVar6;
        *(undefined2 *)(puVar10 + -4) = 0;
        *(short *)(puVar10 + -6) = dxResLeft + dxResRight + -0x4c;
        *(short *)(puVar10 + -8) = (y - (dyArial8 * 3) / 2) + -8;
        *(undefined2 *)(puVar10 + -10) = 0x46;
        *(int *)(puVar10 + -0xc) = (dyArial8 * 3) / 2;
        *(undefined2 *)(puVar10 + -0xe) = 0x44;
        *(undefined2 *)(puVar10 + -0x10) = 0x14f8;
        *(undefined2 *)(puVar10 + -0x12) = 0x365;
        SetWindowPos(*(HWND *)(puVar10 + -2),*(HWND *)(puVar10 + -4),*(short *)(puVar10 + -6),
                     *(short *)(puVar10 + -8),*(short *)(puVar10 + -10),*(short *)(puVar10 + -0xc),
                     *(UINT *)(puVar10 + -0xe));
        *(HWND *)(puVar10 + -2) = hwnd;
        *(undefined2 *)(puVar10 + -4) = unaff_SS;
        *(RECT **)(puVar10 + -6) = &rcWindow;
        *(undefined2 *)(puVar10 + -8) = 0x14f8;
        *(undefined2 *)(puVar10 + -10) = 0x374;
        GetWindowRect(*(HWND *)(puVar10 + -2),*(RECT **)(puVar10 + -6));
        *(HWND *)(puVar10 + -2) = hwnd;
        *(undefined2 *)(puVar10 + -4) = unaff_SS;
        *(RECT **)(puVar10 + -6) = &rc;
        *(undefined2 *)(puVar10 + -8) = 0x14f8;
        *(undefined2 *)(puVar10 + -10) = 899;
        GetClientRect(*(HWND *)(puVar10 + -2),*(RECT **)(puVar10 + -6));
        *(HWND *)(puVar10 + -2) = hwnd;
        *(undefined2 *)(puVar10 + -4) = 0;
        *(undefined2 *)(puVar10 + -6) = 0;
        *(undefined2 *)(puVar10 + -8) = 0;
        *(short *)(puVar10 + -10) =
             ((dxResLeft + dxResRight + rcWindow.right) - rcWindow.left) -
             rc.right;
        *(short *)(puVar10 + -0xc) = ((y + rcWindow.bottom) - rcWindow.top) - rc.bottom;
        *(undefined2 *)(puVar10 + -0xe) = 6;
        *(undefined2 *)(puVar10 + -0x10) = 0x14f8;
        *(undefined2 *)(puVar10 + -0x12) = 0x3b9;
        SetWindowPos(*(HWND *)(puVar10 + -2),*(HWND *)(puVar10 + -4),*(short *)(puVar10 + -6),
                     *(short *)(puVar10 + -8),*(short *)(puVar10 + -10),*(short *)(puVar10 + -0xc),
                     *(UINT *)(puVar10 + -0xe));
        *(undefined2 *)(puVar10 + -2) = 1;
        *(undefined2 *)(puVar10 + -4) = 0xd08;
        *(HWND *)(puVar10 + -6) = hwnd;
        *(undefined2 *)(puVar10 + -8) = 0x14f8;
        *(undefined2 *)(puVar10 + -10) = 0x3c9;
        StickyDlgPos
                  (*(HWND *)(puVar10 + -6),*(POINT **)(puVar10 + -4),*(short *)(puVar10 + -2));
        *(short *)(puVar10 + -2) = local_38.y;
        *(HGDIOBJ *)(puVar10 + -4) = HVar2;
        *(undefined2 *)(puVar10 + -6) = 0x1040;
        *(undefined2 *)(puVar10 + -8) = 0x3d7;
        SelectObject(*(HDC *)(puVar10 + -2),*(HGDIOBJ *)(puVar10 + -4));
        *(HWND *)(puVar10 + -2) = hwnd;
        *(short *)(puVar10 + -4) = local_38.y;
        *(undefined2 *)(puVar10 + -6) = 0x14f8;
        uVar13 = 0x14f8;
        *(undefined2 *)(puVar10 + -8) = 0x3e2;
        ReleaseDC(*(HWND *)(puVar10 + -2),*(HDC *)(puVar10 + -4));
        lResTotal._0_2_ = 0;
        lResTotal._2_2_ = 0;
        pPVar9 = (PLANET *)lpPlanets + cPlanet;
        lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
        while ((PLANET *)lppl < pPVar9) {
          uVar12 = (undefined2)((ulong)lppl >> 0x10);
          if (((PLANET *)lppl)->iPlayer == idPlayer) {
            *(short *)(puVar10 + -2) = idPlayer;
            *(undefined2 *)(puVar10 + -4) = uVar12;
            *(PLANET **)(puVar10 + -6) = (PLANET *)lppl;
            *(undefined2 *)(puVar10 + -8) = uVar13;
            uVar13 = 0x1048;
            *(undefined2 *)(puVar10 + -10) = 0x43a;
            uVar5 = CResourcesAtPlanet(*(PLANET **)(puVar10 + -6),*(short *)(puVar10 + -2));
            bVar14 = CARRY2((uint)lResTotal,uVar5);
            lResTotal._0_2_ = (uint)lResTotal + uVar5;
            lResTotal._2_2_ =
                 lResTotal._2_2_ + ((int)uVar5 >> 0xf) + (uint)bVar14;
          }
          lppl = (PLANET *)CONCAT22(uVar12,(PLANET *)lppl + 1);
        }
        *(short *)(puVar10 + -2) = pctResGlob >> 0xf;
        *(short *)(puVar10 + -4) = pctResGlob;
        *(undefined2 *)(puVar10 + -6) = uVar13;
        *(undefined2 *)(puVar10 + -8) = 0x463;
        lResBudget = ProjectedResearchSpending(*(long *)(puVar10 + -4));
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
          *(undefined2 *)(puVar10 + -2) = 0x10d8;
          *(undefined2 *)(puVar10 + -4) = 0x485;
          AdvanceTutor();
        }
        HVar8 = 1;
        lVar1 = lResBudget;
        goto LAB_10d8_0901;
      }
      puVar11 = &stack0xffa8;
      if (message != WM_COMMAND) {
        if ((message == WM_LBUTTONDOWN) || (message == WM_LBUTTONDBLCLK)) {
          uVar17 = __aFulshr(CONCAT22(unaff_DI,wParam),unaff_SI);
          HVar8 = FTrackResearchDlg(hwnd,(HWND)lParam,(short)uVar17,wParam);
          lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
          goto LAB_10d8_0901;
        }
        goto LAB_10d8_08fb;
      }
    }
    *(undefined2 *)((int)puVar11 + -2) = uVar13;
    *(undefined2 *)(puVar11 + -1) = 0x653;
    uVar17 = __aFulshr(*puVar11,(ushort)puVar11[1]);
    if ((((int)uVar17 == 0) && (0x430 < wParam)) && (wParam < 0x437)) {
      *(HWND *)((int)puVar11 + -2) = hwnd;
      *(ushort *)(puVar11 + -1) = wParam;
      *(undefined2 *)((int)puVar11 + -6) = 0x1118;
      *(undefined2 *)(puVar11 + -2) = 0x681;
      UVar7 = IsDlgButtonChecked(*(HWND *)((int)puVar11 + -2),(short)puVar11[-1]);
      if (UVar7 != 0) {
        iResTechNow = wParam - 0x431;
        *(HWND *)((int)puVar11 + -2) = hwnd;
        *(undefined2 *)(puVar11 + -1) = unaff_SS;
        *(int *)((int)puVar11 + -6) = (int)&rc;
        *(undefined2 *)(puVar11 + -2) = 0x14f8;
        *(undefined2 *)((int)puVar11 + -10) = 0x6a1;
        GetClientRect(*(HWND *)((int)puVar11 + -2),(RECT *)*(undefined4 *)((int)puVar11 + -6));
        *(undefined2 *)((int)puVar11 + -2) = 4;
        *(RECT **)(puVar11 + -1) = &rc;
        *(undefined2 *)((int)puVar11 + -6) = 0;
        *(HWND *)(puVar11 + -2) = hwnd;
        *(undefined2 *)((int)puVar11 + -10) = 0x14f8;
        *(undefined2 *)(puVar11 + -3) = 0x6b5;
        DrawResearchDlg((HWND)puVar11[-2],*(HDC *)((int)puVar11 + -6),*(RECT **)(puVar11 + -1),
                        *(short *)((int)puVar11 + -2));
      }
    }
    else {
      if (wParam == 2) {
        local_38.x = 0;
        *(HWND *)((int)puVar11 + -2) = hwnd;
        *(undefined2 *)(puVar11 + -1) = 0x43b;
        *(undefined2 *)((int)puVar11 + -6) = 0x1118;
        *(undefined2 *)(puVar11 + -2) = 0x6d5;
        HVar6 = GetDlgItem(*(HWND *)((int)puVar11 + -2),*(ControlId *)(puVar11 + -1));
        *(HWND *)((int)puVar11 + -2) = HVar6;
        *(undefined2 *)(puVar11 + -1) = 0x407;
        *(undefined2 *)((int)puVar11 + -6) = 0;
        *(undefined2 *)(puVar11 + -2) = 0;
        *(undefined2 *)((int)puVar11 + -10) = 0;
        *(undefined2 *)(puVar11 + -3) = 0x14f8;
        uVar13 = 0x14f8;
        *(undefined2 *)((int)puVar11 + -0xe) = 0x6eb;
        LVar18 = SendMessage(*(HWND *)((int)puVar11 + -2),*(WMType *)(puVar11 + -1),
                             *(WPARAM *)((int)puVar11 + -6),*(LPARAM *)((int)puVar11 + -10));
        local_38.y = (short)LVar18;
        if (local_38.y == 0) {
          local_38.y = 6;
        }
        else if (local_38.y < 7) {
          local_38.y = local_38.y + -1;
        }
        if (((iResTechNow !=
              ((int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xfU))
            || (local_38.y !=
                (int)*(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) >> 4)) ||
           (pctResGlob !=
            *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0))) {
          *(undefined1 *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) =
               (char)pctResGlob;
          *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
               *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
               (byte)iResTechNow;
          *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
               *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf |
               (byte)(local_38.y << 4);
          i = *(char *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) * 0x100 +
              pctResGlob;
          *(int *)((int)puVar11 + -2) = (int)&i;
          *(undefined2 *)(puVar11 + -1) = 2;
          *(undefined2 *)((int)puVar11 + -6) = 0x22;
          *(undefined2 *)(puVar11 + -2) = 0x14f8;
          uVar13 = 0x1048;
          *(undefined2 *)((int)puVar11 + -10) = 0x80d;
          WriteMemRt(*(short *)((int)puVar11 + -6),(short)puVar11[-1],
                             (void *)*(undefined2 *)((int)puVar11 + -2));
          local_38.x = 1;
          if ((((uint)gd.grBits >> 0xb & 1) != 0) && (idPlayer == 0)) {
            tutor.wFlags = tutor.wFlags & 0xfffbU | 4;
            *(undefined2 *)((int)puVar11 + -2) = 0x1048;
            uVar13 = 0x10f8;
            *(undefined2 *)(puVar11 + -1) = 0x843;
            AdvanceTutor();
          }
        }
        *(undefined2 *)((int)puVar11 + -2) = 0;
        *(undefined2 *)(puVar11 + -1) = 0xd08;
        *(HWND *)((int)puVar11 + -6) = hwnd;
        *(undefined2 *)(puVar11 + -2) = uVar13;
        *(undefined2 *)((int)puVar11 + -10) = 0x853;
        StickyDlgPos
                  (*(HWND *)((int)puVar11 + -6),*(POINT **)(puVar11 + -1),
                   *(short *)((int)puVar11 + -2));
        *(HWND *)((int)puVar11 + -2) = hwnd;
        *(short *)(puVar11 + -1) = local_38.x;
        *(undefined2 *)((int)puVar11 + -6) = 0x1040;
        *(undefined2 *)(puVar11 + -2) = 0x861;
        EndDialog(*(HWND *)((int)puVar11 + -2),(short)puVar11[-1]);
        pctResGlob = -1;
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
          *(undefined2 *)((int)puVar11 + -2) = 0x14f8;
          *(undefined2 *)(puVar11 + -1) = 0x87f;
          AdvanceTutor();
        }
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
      if (wParam == 0x76) {
        *(HWND *)((int)puVar11 + -2) = hwnd;
        *(undefined2 *)(puVar11 + -1) = 0x1120;
        *(undefined2 *)((int)puVar11 + -6) = _szHelpFile;
        *(undefined2 *)(puVar11 + -2) = 1;
        *(undefined2 *)((int)puVar11 + -10) = 0;
        *(undefined2 *)(puVar11 + -3) = 0x42e;
        *(undefined2 *)((int)puVar11 + -0xe) = 0x1118;
        *(undefined2 *)(puVar11 + -4) = 0x8ac;
        WinHelp(*(HWND *)((int)puVar11 + -2),(LPCSTR)*(undefined4 *)((int)puVar11 + -6),
                (UINT)puVar11[-2],puVar11[-3]);
        HVar8 = 1;
        lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        goto LAB_10d8_0901;
      }
    }
  }
LAB_10d8_08fb:
  HVar8 = 0;
  lVar1 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
LAB_10d8_0901:
  lResBudget._2_2_ = (undefined2)((ulong)lVar1 >> 0x10);
  lResBudget._0_2_ = (undefined2)lVar1;
  return HVar8;
}



// ======================================================================
// Function: DrawResearchDlg
// Address: 10d8:090a
// Segment: MEMORY_RESEARCH
// ======================================================================


void DrawResearchDlg(HWND hwnd,HDC hdc,RECT *prc,short grbitDraw)

{
  HS *pHVar1;
  byte bVar2;
  uint uVar3;
  HGDIOBJ HVar4;
  short sVar5;
  ushort uVar6;
  int iVar7;
  HGDIOBJ HVar8;
  undefined2 uVar9;
  HWND HVar10;
  short sVar11;
  int iVar12;
  undefined2 *puVar13;
  int iVar14;
  long *plVar15;
  undefined2 unaff_SS;
  bool bVar16;
  COLORREF CVar17;
  COLORREF CVar18;
  DWORD DVar19;
  long lVar20;
  long lVar21;
  char *pcVar22;
  undefined2 uVar23;
  HDC HVar24;
  uint local_c0;
  int local_be;
  RECT rc;
  short iMin;
  long l;
  PART part;
  char szTemp2 [60];
  short dx;
  short xCtr;
  short xNum;
  HFONT hfontSav;
  COLORREF crForeSav;
  COLORREF crBackSav;
  short grbitCur;
  short c;
  short i;
  short mdAvail;
  short fCreatedDC;
  short iter;
  short iTechSav;
  short iMax;
  RECT rcT;
  char szTemp [60];
  short dxCurrent;
  
  bVar16 = hdc == 0;
  if (bVar16) {
    hdc = GetDC(hwnd);
  }
  plVar15 = &stack0xff3c;
  HVar4 = SelectObject(hdc,rghfontArial8[1]);
  CVar17 = SetTextColor(hdc,0);
  CVar18 = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
  ;
  if ((grbitDraw & 0xffU) != 0) {
    sVar5 = CchGetString(idsCurrent,(char *)szWork);
    DVar19 = GetTextExtent(hdc,szWork,sVar5);
    SetRect(&rc,8,dyArial8,dxResLeft + -8,dyArial8 * 0xd);
    if ((grbitDraw & 3U) != 0) {
      _Draw3dFrame();
      sVar5 = CchGetString(idsTechnologyStatus,(char *)szWork);
      TextOut(hdc,rc.left + 8,rc.top - (dyArial8 >> 1),szWork,sVar5);
      rc.top = rc.top + (dyArial8 >> 1);
      sVar5 = CchGetString(idsCurrent,(char *)szWork);
      TextOut(hdc,(rc.right + -8) - (int)DVar19,rc.top,szWork,sVar5);
      rc.top = rc.top + dyArial8;
      sVar5 = CchGetString(idsFieldStudy,(char *)szWork);
      TextOut(hdc,rc.left + 0x1a,rc.top,szWork,sVar5);
      iVar12 = (rc.right + -8) - ((int)DVar19 >> 1);
      sVar5 = CchGetString(idsLevel,(char *)szWork);
      CtrTextOut(hdc,iVar12,rc.top,(char *)szWork,sVar5);
      PatBlt(hdc,rc.left + 8,rc.top + dyArial8,(rc.right - rc.left) + -0x10,1,0x42);
      rc.top = rc.top + (dyArial8 >> 2) + dyArial8 + 2;
      for (i = 0; i < 6; i = i + 1) {
        sVar5 = _wsprintf(szWork,PCTD,
                          (int)*(char *)(idPlayer * 0xc0 + 0x59bc + i));
        CtrTextOut(hdc,iVar12,rc.top,(char *)szWork,sVar5);
        rc.top = rc.top + (dyArial8 * 3) / 2;
      }
    }
    SetRect(&rc,8,(dyArial8 * 3) / 2 + rc.bottom,dxResLeft + -8,prc->bottom + -8
           );
    if (((grbitDraw & 4U) == 0) || ((grbitDraw & 3U) != 0)) {
      _Draw3dFrame();
      sVar5 = CchGetString(idsExpectedResearchBenefits,(char *)szWork);
      TextOut(hdc,rc.left + 8,rc.top - (dyArial8 >> 1),szWork,sVar5);
      bVar2 = *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0);
      cFutureTech = 0;
      yTopFutureTech = rc.top + dyArial8;
      for (iter = 1; iter < 10; iter = iter + 1) {
        iMax = iter;
        if (iter == 1) {
          SetTextColor(hdc,0x7f00);
        }
        else if ((iter < 2) || (4 < iter)) {
          SetTextColor(hdc,0);
          if (iter == 9) {
            iMax = 0x1a;
          }
        }
        else {
          SetTextColor(hdc,0x7f0000);
        }
        grbitCur = 1;
        *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
             *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
             (byte)iResTechNow;
        for (; grbitCur != 0; grbitCur = grbitCur << 1) {
          if (grbitCur != 0) {
            i = 0;
            part.hs.grhst = grbitCur;
            while( true ) {
              part.hs.wFlags_0x2 = part.hs.wFlags_0x2 & 0xff00 | i & 0xffU;
              sVar5 = FLookupPart(&part);
              if ((sVar5 == 0) ||
                 (((part.hs.grhst == hstTerra &&
                   (sVar11 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                                ibitRaceTT), sVar11 != 0)) &&
                  (((part.hs.wFlags_0x2 & 0xff) == 8 ||
                   (((part.hs.wFlags_0x2 & 0xff) == 0xc || ((part.hs.wFlags_0x2 & 0xff) == 0x10)))))
                  ))) break;
              if ((iter <= sVar5 + -1) && (sVar5 + -1 <= iMax)) {
                rc.top = rc.top + dyArial8;
                if (rc.bottom < rc.top + dyArial8) goto RESEARCH_TooManyToFinish;
                __fstrcpy(szWork,
                                  (char *)CONCAT22(part.u_PART_0x0004._2_2_,
                                                   (part.u_PART_0x0004.parmor._0_2_)->szName));
                iVar12 = rc.left + 8;
                uVar23 = 0x1120;
                pcVar22 = (char *)szWork;
                sVar5 = rc.top;
                HVar24 = hdc;
                uVar6 = _strlen((char *)szWork);
                TextOut(HVar24,iVar12,sVar5,(LPCSTR)CONCAT22(uVar23,pcVar22),uVar6);
                if (cFutureTech < 8) {
                  iVar12 = cFutureTech * 4;
                  pHVar1 = (HS *)rghsFutureTech + cFutureTech;
                  cFutureTech = cFutureTech + 1;
                  pHVar1->grhst = part.hs.grhst;
                  *(ushort *)((int)&rghsFutureTech[0].wFlags_0x2 + iVar12) =
                       part.hs.wFlags_0x2;
                }
              }
              i = i + 1;
            }
          }
        }
      }
RESEARCH_TooManyToFinish:
      *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) =
           *(byte *)((int)&rgplr[0].iTechCur + idPlayer * 0xc0) & 0xf0 |
           bVar2 & 0xf;
      SetTextColor(hdc,0);
      plVar15 = &stack0xff3c;
    }
    else {
      ExpandRc(&rc,-6,-(dyArial8 >> 1));
      rc.top = rc.top + (dyArial8 >> 1);
      InvalidateRect(hwnd,&rc,1);
      plVar15 = &stack0xff3e;
    }
  }
  *(undefined2 *)((int)plVar15 + -2) = unaff_SS;
  *(RECT **)(plVar15 + -1) = &rc;
  *(int *)((int)plVar15 + -6) = dxResLeft + 8;
  *(short *)(plVar15 + -2) = dyArial8;
  *(int *)((int)plVar15 + -10) = dxResLeft + dxResRight + -8;
  *(int *)(plVar15 + -3) = (dyArial8 * 0xe) / 2 + dyArial8;
  *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
  *(undefined2 *)(plVar15 + -4) = 0xf18;
  crBackSav._2_2_ = (undefined2)(CVar18 >> 0x10);
  crBackSav._0_2_ = (undefined2)CVar18;
  crForeSav._2_2_ = (undefined2)(CVar17 >> 0x10);
  crForeSav._0_2_ = (undefined2)CVar17;
  SetRect((RECT *)plVar15[-1],*(short *)((int)plVar15 + -6),(short)plVar15[-2],
          *(short *)((int)plVar15 + -10),(short)plVar15[-3]);
  iVar12 = rc.left + 8 + dxResStrRight;
  *(HDC *)((int)plVar15 + -2) = hdc;
  *(undefined2 *)(plVar15 + -1) = 0x1120;
  *(undefined2 *)((int)plVar15 + -6) = 0xd0e;
  *(undefined2 *)(plVar15 + -2) = 6;
  *(undefined2 *)((int)plVar15 + -10) = 0x14f8;
  uVar23 = 0x14f8;
  *(undefined2 *)(plVar15 + -3) = 0xf40;
  DVar19 = GetTextExtent(*(HDC *)((int)plVar15 + -2),(LPCSTR)*(undefined4 *)((int)plVar15 + -6),
                         (short)plVar15[-2]);
  iVar7 = (int)DVar19 + iVar12;
  if (((grbitDraw & 4U) != 0) && ((grbitDraw & 3U) == 0)) {
    *(int *)((int)plVar15 + -2) = -(dyArial8 >> 1);
    *(undefined2 *)(plVar15 + -1) = 0xfffa;
    *(int *)((int)plVar15 + -6) = (int)&rc;
    *(undefined2 *)(plVar15 + -2) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -10) = 0xf7b;
    ExpandRc((RECT *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
                      *(short *)((int)plVar15 + -2));
    rc.top = rc.top + (dyArial8 >> 1);
    *(HWND *)((int)plVar15 + -2) = hwnd;
    *(undefined2 *)(plVar15 + -1) = unaff_SS;
    *(int *)((int)plVar15 + -6) = (int)&rc;
    *(undefined2 *)(plVar15 + -2) = 1;
    *(undefined2 *)((int)plVar15 + -10) = 0x1040;
    uVar23 = 0x14f8;
    *(undefined2 *)(plVar15 + -3) = 0xf9b;
    InvalidateRect(*(HWND *)((int)plVar15 + -2),(RECT *)*(undefined4 *)((int)plVar15 + -6),
                   (BOOL)plVar15[-2]);
    plVar15 = (long *)((int)plVar15 + 2);
    goto RESEARCH_CleanUp;
  }
  if ((grbitDraw & 0x300U) != 0) {
    if (*(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) < '\x1a') {
      *(short *)((int)plVar15 + -2) = idPlayer;
      *(int *)(plVar15 + -1) =
           *(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) + 1;
      *(short *)((int)plVar15 + -6) = iResTechNow;
      *(undefined2 *)(plVar15 + -2) = 0x14f8;
      uVar23 = 0x10d8;
      *(undefined2 *)((int)plVar15 + -10) = 0x1009;
      lVar20 = GetTechLevelCost(*(short *)((int)plVar15 + -6),(short)plVar15[-1],
                                *(short *)((int)plVar15 + -2));
      puVar13 = (undefined2 *)(idPlayer * 0xc0 + 0x59c2 + iResTechNow * 4);
      lVar21 = CONCAT22(puVar13[1],*puVar13);
      if ((game.wCrap >> 1 & 1) != 0) {
        *(undefined2 *)((int)plVar15 + -2) = 0x10d8;
        uVar23 = 0x1118;
        *(undefined2 *)(plVar15 + -1) = 0x105b;
        lVar21 = __aFlshl(*plVar15,*(ushort *)(plVar15 + 1));
      }
      l._2_2_ = (int)((ulong)lVar20 >> 0x10);
      l._0_2_ = (uint)lVar20;
      local_be = (int)((ulong)lVar21 >> 0x10);
      local_c0 = (uint)lVar21;
      iVar14 = (l._2_2_ - local_be) - (uint)((uint)l < local_c0);
      if ((iVar14 < 1) && (iVar14 < 0)) {
        lVar20 = 0;
      }
      else {
        lVar20 = lVar20 - lVar21;
      }
    }
    else {
      lVar20 = -1;
    }
    l._2_2_ = (int)((ulong)lVar20 >> 0x10);
    l._0_2_ = (uint)lVar20;
    if (((grbitDraw & 0x200U) == 0) || ((grbitDraw & 0xfU) != 0)) {
      *(undefined2 *)((int)plVar15 + -2) = 0xffff;
      *(RECT **)(plVar15 + -1) = &rc;
      *(HDC *)((int)plVar15 + -6) = hdc;
      *(undefined2 *)(plVar15 + -2) = uVar23;
      *(undefined2 *)((int)plVar15 + -10) = 0x1132;
      _Draw3dFrame();
      *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
      *(undefined2 *)(plVar15 + -1) = 0x46;
      *(undefined2 *)((int)plVar15 + -6) = 0x1040;
      *(undefined2 *)(plVar15 + -2) = 0x1142;
      sVar5 = CchGetString
                        (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(short *)(plVar15 + -1) = rc.left + 8;
      *(int *)((int)plVar15 + -6) = rc.top - (dyArial8 >> 1);
      *(undefined2 *)(plVar15 + -2) = 0x1120;
      *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
      *(short *)(plVar15 + -3) = sVar5;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
      *(undefined2 *)(plVar15 + -4) = 0x116e;
      TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
              (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
      rc.top = rc.top + dyArial8;
      *(int *)((int)plVar15 + -2) = (int)szTemp;
      *(short *)(plVar15 + -1) = iResTechNow + 0x54;
      *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
      *(undefined2 *)(plVar15 + -2) = 0x1185;
      CchGetString(*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
      *(int *)((int)plVar15 + -2) = (int)szTemp2;
      *(undefined2 *)(plVar15 + -1) = 0x53f;
      *(undefined2 *)((int)plVar15 + -6) = 0x1040;
      *(undefined2 *)(plVar15 + -2) = 0x1196;
      CchGetString(*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
      *(int *)((int)plVar15 + -2) =
           *(char *)(idPlayer * 0xc0 + 0x59bc + iResTechNow) + 1;
      *(undefined2 *)(plVar15 + -1) = unaff_SS;
      *(int *)((int)plVar15 + -6) = (int)szTemp;
      *(undefined2 *)(plVar15 + -2) = unaff_SS;
      *(int *)((int)plVar15 + -10) = (int)szTemp2;
      *(undefined2 *)(plVar15 + -3) = 0x1120;
      *(undefined2 *)((int)plVar15 + -0xe) = (char *)szWork;
      *(undefined2 *)(plVar15 + -4) = 0x1040;
      *(undefined2 *)((int)plVar15 + -0x12) = 0x11d1;
      sVar5 = _wsprintf((char *)*(undefined4 *)((int)plVar15 + -0xe),
                        (char *)*(undefined4 *)((int)plVar15 + -10));
      *(undefined2 *)((int)plVar15 + -2) = 0;
      *(short *)(plVar15 + -1) = sVar5;
      *(undefined2 *)((int)plVar15 + -6) = (char *)szWork;
      *(short *)(plVar15 + -2) = rc.top;
      *(int *)((int)plVar15 + -10) = iVar12;
      *(HDC *)(plVar15 + -3) = hdc;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
      *(undefined2 *)(plVar15 + -4) = 0x11f1;
      RightTextOut
                (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
                 (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
                 *(short *)((int)plVar15 + -2));
      rc.top = rc.top + (dyArial8 * 3) / 2;
      *(undefined2 *)((int)plVar15 + -2) = 0;
      *(undefined2 *)(plVar15 + -1) = 0;
      *(undefined2 *)((int)plVar15 + -6) = 0x4c;
      *(undefined2 *)(plVar15 + -2) = 0x1040;
      *(undefined2 *)((int)plVar15 + -10) = 0x1216;
      pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
      *(undefined2 *)((int)plVar15 + -6) = pcVar22;
      *(short *)(plVar15 + -2) = rc.top;
      *(int *)((int)plVar15 + -10) = iVar12;
      *(HDC *)(plVar15 + -3) = hdc;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
      *(undefined2 *)(plVar15 + -4) = 0x1229;
      RightTextOut
                (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
                 (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
                 *(short *)((int)plVar15 + -2));
      if (lVar20 == -1) {
        *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
        *(undefined2 *)(plVar15 + -1) = 0x34a;
        *(undefined2 *)((int)plVar15 + -6) = 0x1040;
        uVar23 = 0x1040;
        *(undefined2 *)(plVar15 + -2) = 0x124d;
        c = CchGetString
                      (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
      }
      else {
        *(undefined2 *)((int)plVar15 + -2) = l._2_2_;
        *(uint *)(plVar15 + -1) = (uint)l;
        *(undefined2 *)((int)plVar15 + -6) = 0x1120;
        *(char **)(plVar15 + -2) = PCTLD;
        *(undefined2 *)((int)plVar15 + -10) = 0x1120;
        *(char **)(plVar15 + -3) = (char *)szWork;
        *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
        uVar23 = 0x14f8;
        *(undefined2 *)(plVar15 + -4) = 0x1271;
        c = _wsprintf((char *)plVar15[-3],(char *)plVar15[-2]);
      }
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(int *)(plVar15 + -1) = iVar12;
      *(short *)((int)plVar15 + -6) = rc.top;
      *(undefined2 *)(plVar15 + -2) = 0x1120;
      *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
      *(short *)(plVar15 + -3) = c;
      *(undefined2 *)((int)plVar15 + -0xe) = uVar23;
      *(undefined2 *)(plVar15 + -4) = 0x1290;
      TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
              (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
      rc.top = rc.top + (dyArial8 * 3) / 2;
      *(undefined2 *)((int)plVar15 + -2) = 0;
      *(undefined2 *)(plVar15 + -1) = 0;
      *(undefined2 *)((int)plVar15 + -6) = 0x4d;
      *(undefined2 *)(plVar15 + -2) = 0x14f8;
      *(undefined2 *)((int)plVar15 + -10) = 0x12b2;
      pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
      *(undefined2 *)((int)plVar15 + -6) = pcVar22;
      *(short *)(plVar15 + -2) = rc.top;
      *(int *)((int)plVar15 + -10) = iVar12;
      *(HDC *)(plVar15 + -3) = hdc;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
      uVar23 = 0x1040;
      *(undefined2 *)(plVar15 + -4) = 0x12c5;
      RightTextOut
                (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
                 (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
                 *(short *)((int)plVar15 + -2));
    }
    else {
      rc.top = rc.top + ((dyArial8 * 3) / 2) * 2 + dyArial8;
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(HBRUSH *)(plVar15 + -1) = hbrButtonFace;
      *(undefined2 *)((int)plVar15 + -6) = uVar23;
      *(undefined2 *)(plVar15 + -2) = 0x10ec;
      HVar8 = SelectObject(*(HDC *)((int)plVar15 + -2),*(HGDIOBJ *)(plVar15 + -1));
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(int *)(plVar15 + -1) = iVar12;
      *(short *)((int)plVar15 + -6) = rc.top;
      *(int *)(plVar15 + -2) = iVar7 - iVar12;
      *(short *)((int)plVar15 + -10) = dyArial8;
      *(undefined2 *)(plVar15 + -3) = 0xf0;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x21;
      *(undefined2 *)(plVar15 + -4) = 0x14f8;
      *(undefined2 *)((int)plVar15 + -0x12) = 0x1112;
      PatBlt(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
             (short)plVar15[-2],*(short *)((int)plVar15 + -10),*(DWORD *)((int)plVar15 + -0xe));
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(HGDIOBJ *)(plVar15 + -1) = HVar8;
      *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
      uVar23 = 0x14f8;
      *(undefined2 *)(plVar15 + -2) = 0x111e;
      SelectObject(*(HDC *)((int)plVar15 + -2),*(HGDIOBJ *)(plVar15 + -1));
    }
    iVar14 = lResBudget._2_2_;
    uVar3 = (uint)lResBudget;
    if (lVar20 == -1) {
      *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
      *(undefined2 *)(plVar15 + -1) = 0x34a;
      *(undefined2 *)((int)plVar15 + -6) = uVar23;
      *(undefined2 *)(plVar15 + -2) = 0x12e9;
      sVar5 = CchGetString
                        (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(int *)(plVar15 + -1) = iVar12;
      *(short *)((int)plVar15 + -6) = rc.top;
      *(undefined2 *)(plVar15 + -2) = 0x1120;
      *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
      *(short *)(plVar15 + -3) = sVar5;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
      *(char_0_ **)(plVar15 + -4) = (char_0_ *)&szRacePass;
      TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
              (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
    }
    else {
      if (lVar20 == 0) {
        lVar20 = 1;
      }
      else {
        if (((uint)lResBudget == 0) && (lResBudget._2_2_ == 0)) {
          *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
          *(undefined2 *)(plVar15 + -1) = 0x34b;
          *(undefined2 *)((int)plVar15 + -6) = uVar23;
          *(char **)(plVar15 + -2) = (char *)s_15_1120_134f + 3;
          sVar5 = CchGetString
                            (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2))
          ;
          *(HDC *)((int)plVar15 + -2) = hdc;
          *(int *)(plVar15 + -1) = iVar12;
          *(short *)((int)plVar15 + -6) = rc.top;
          *(undefined2 *)(plVar15 + -2) = 0x1120;
          *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
          *(short *)(plVar15 + -3) = sVar5;
          *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
          *(undefined2 *)(plVar15 + -4) = 0x1371;
          TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
                  (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
          goto LAB_10d8_144a;
        }
        local_c0 = (uint)lResBudget;
        local_be = lResBudget._2_2_;
        *(undefined2 *)((int)plVar15 + -2) = 4;
        *(PLAYER **)(plVar15 + -1) = (PLAYER *)rgplr + idPlayer;
        *(undefined2 *)((int)plVar15 + -6) = uVar23;
        uVar23 = 0x10e0;
        *(undefined2 *)(plVar15 + -2) = 0x1399;
        sVar5 = GetRaceGrbit(*(PLAYER **)(plVar15 + -1),*(RaceGrbit *)((int)plVar15 + -2));
        if (sVar5 != 0) {
          *(undefined2 *)((int)plVar15 + -2) = 0x10e0;
          uVar23 = 0x1118;
          *(undefined2 *)(plVar15 + -1) = 0x13b4;
          lVar21 = __aFlshr(*plVar15,*(ushort *)(plVar15 + 1));
          local_c0 = uVar3 - (uint)lVar21;
          local_be = (iVar14 - (int)((ulong)lVar21 >> 0x10)) - (uint)(uVar3 < (uint)lVar21);
        }
        *(int *)((int)plVar15 + -2) = local_be;
        *(uint *)(plVar15 + -1) = local_c0;
        lVar20 = lVar20 + CONCAT22(local_be,local_c0) + -1;
        *(undefined2 *)((int)plVar15 + -6) = (int)((ulong)lVar20 >> 0x10);
        *(int *)(plVar15 + -2) = (int)lVar20;
        *(undefined2 *)((int)plVar15 + -10) = uVar23;
        uVar23 = 0x1118;
        *(undefined2 *)(plVar15 + -3) = 0x13e1;
        lVar20 = __aFldiv(plVar15[-2],plVar15[-1]);
      }
      l._2_2_ = (int)((ulong)lVar20 >> 0x10);
      l._0_2_ = (uint)lVar20;
      if (lVar20 == 1) {
        uVar9 = 0x20;
      }
      else {
        uVar9 = 0x73;
      }
      *(undefined2 *)((int)plVar15 + -2) = uVar9;
      *(int *)(plVar15 + -1) = l._2_2_;
      *(undefined2 *)((int)plVar15 + -6) = (uint)l;
      *(undefined2 *)(plVar15 + -2) = 0x34c;
      *(undefined2 *)((int)plVar15 + -10) = uVar23;
      *(short **)(plVar15 + -3) = (short *)&viSpeedVCR;
      pcVar22 = PszGetCompressedString(*(StringId *)(plVar15 + -2));
      *(undefined2 *)(plVar15 + -2) = 0x1120;
      *(undefined2 *)((int)plVar15 + -10) = pcVar22;
      *(undefined2 *)(plVar15 + -3) = 0x1120;
      *(undefined2 *)((int)plVar15 + -0xe) = (char *)szWork;
      *(undefined2 *)(plVar15 + -4) = 0x1010;
      *(undefined2 *)((int)plVar15 + -0x12) = (char *)s_d_1120_1429 + 2;
      sVar5 = _wsprintf((char *)*(undefined4 *)((int)plVar15 + -0xe),
                        (char *)*(undefined4 *)((int)plVar15 + -10));
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(int *)(plVar15 + -1) = iVar12;
      *(short *)((int)plVar15 + -6) = rc.top;
      *(undefined2 *)(plVar15 + -2) = 0x1120;
      *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
      *(short *)(plVar15 + -3) = sVar5;
      *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
      *(undefined2 *)(plVar15 + -4) = 0x144a;
      TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
              (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
    }
LAB_10d8_144a:
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0x52;
    *(undefined2 *)(plVar15 + -2) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -10) = 0x145b;
    pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
    *(undefined2 *)((int)plVar15 + -6) = pcVar22;
    *(short *)(plVar15 + -2) = rc.top + dyArial8 + 5;
    *(int *)((int)plVar15 + -10) = iVar12 + -0x3c;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
    *(undefined2 *)(plVar15 + -4) = 0x147a;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
    *(HWND *)((int)plVar15 + -2) = hwnd;
    *(undefined2 *)(plVar15 + -1) = 0x43b;
    *(undefined2 *)((int)plVar15 + -6) = 0x1040;
    *(undefined2 *)(plVar15 + -2) = 0x1489;
    HVar10 = GetDlgItem(*(HWND *)((int)plVar15 + -2),*(ControlId *)(plVar15 + -1));
    *(HWND *)((int)plVar15 + -2) = HVar10;
    *(undefined2 *)(plVar15 + -1) = unaff_SS;
    *(int *)((int)plVar15 + -6) = (int)&rcT;
    *(undefined2 *)(plVar15 + -2) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -10) = 0x1496;
    GetClientRect(*(HWND *)((int)plVar15 + -2),(RECT *)*(undefined4 *)((int)plVar15 + -6));
    *(HWND *)((int)plVar15 + -2) = hwnd;
    *(undefined2 *)(plVar15 + -1) = 0x43b;
    *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
    *(undefined2 *)(plVar15 + -2) = 0x14a2;
    HVar10 = GetDlgItem(*(HWND *)((int)plVar15 + -2),*(ControlId *)(plVar15 + -1));
    *(HWND *)((int)plVar15 + -2) = HVar10;
    *(HWND *)(plVar15 + -1) = hwnd;
    *(undefined2 *)((int)plVar15 + -6) = unaff_SS;
    *(RECT **)(plVar15 + -2) = &rcT;
    *(undefined2 *)((int)plVar15 + -10) = 2;
    *(undefined2 *)(plVar15 + -3) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x14b6;
    MapWindowPoints(*(HWND *)((int)plVar15 + -2),*(HWND *)(plVar15 + -1),(POINT *)plVar15[-2],
                    *(UINT *)((int)plVar15 + -10));
    if (rcT.top != rc.top + dyArial8 + 2) {
      *(HWND *)((int)plVar15 + -2) = hwnd;
      *(undefined2 *)(plVar15 + -1) = 0x43b;
      *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
      *(undefined2 *)(plVar15 + -2) = 0x14d5;
      HVar10 = GetDlgItem(*(HWND *)((int)plVar15 + -2),*(ControlId *)(plVar15 + -1));
      *(HWND *)((int)plVar15 + -2) = HVar10;
      *(undefined2 *)(plVar15 + -1) = 0;
      *(int *)((int)plVar15 + -6) = iVar12 + -0x3c;
      *(short *)(plVar15 + -2) = rc.top + dyArial8 + 2;
      *(int *)((int)plVar15 + -10) = (rc.right - iVar12) + 0x32;
      *(short *)(plVar15 + -3) = dyArial8 * 9;
      *(undefined2 *)((int)plVar15 + -0xe) = 0xc;
      *(undefined2 *)(plVar15 + -4) = 0x14f8;
      *(undefined2 *)((int)plVar15 + -0x12) = 0x1509;
      SetWindowPos(*(HWND *)((int)plVar15 + -2),*(HWND *)(plVar15 + -1),
                   *(short *)((int)plVar15 + -6),(short)plVar15[-2],*(short *)((int)plVar15 + -10),
                   (short)plVar15[-3],*(UINT *)((int)plVar15 + -0xe));
    }
  }
  rc.top = (dyArial8 * 3) / 2 + rc.bottom;
  rc.bottom = dyArial8 * 8 + rc.top;
  if ((grbitDraw & 0x400U) != 0) {
    *(undefined2 *)((int)plVar15 + -2) = 0xffff;
    *(RECT **)(plVar15 + -1) = &rc;
    *(HDC *)((int)plVar15 + -6) = hdc;
    *(undefined2 *)(plVar15 + -2) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -10) = 0x1551;
    _Draw3dFrame();
    *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
    *(undefined2 *)(plVar15 + -1) = 0x47;
    *(undefined2 *)((int)plVar15 + -6) = 0x1040;
    *(undefined2 *)(plVar15 + -2) = 0x1561;
    sVar5 = CchGetString
                      (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(short *)(plVar15 + -1) = rc.left + 8;
    *(int *)((int)plVar15 + -6) = rc.top - (dyArial8 >> 1);
    *(undefined2 *)(plVar15 + -2) = 0x1120;
    *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
    *(short *)(plVar15 + -3) = sVar5;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
    *(undefined2 *)(plVar15 + -4) = 0x158d;
    TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
            (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
  }
  uVar23 = 0x14f8;
  rc.top = rc.top + dyArial8;
  if ((grbitDraw & 0x800U) != 0) {
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0x4e;
    *(undefined2 *)(plVar15 + -2) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -10) = 0x15b6;
    pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
    *(undefined2 *)((int)plVar15 + -6) = pcVar22;
    *(short *)(plVar15 + -2) = rc.top;
    *(int *)((int)plVar15 + -10) = iVar12;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
    *(undefined2 *)(plVar15 + -4) = 0x15c9;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
    *(undefined2 *)((int)plVar15 + -2) = lResTotal._2_2_;
    *(undefined2 *)(plVar15 + -1) = (undefined2)lResTotal;
    *(undefined2 *)((int)plVar15 + -6) = 0x1120;
    *(char **)(plVar15 + -2) = PCTLD;
    *(undefined2 *)((int)plVar15 + -10) = 0x1120;
    *(char **)(plVar15 + -3) = (char *)szWork;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
    *(undefined2 *)(plVar15 + -4) = 0x15e7;
    sVar5 = _wsprintf((char *)plVar15[-3],(char *)plVar15[-2]);
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(short *)(plVar15 + -1) = sVar5;
    *(undefined2 *)((int)plVar15 + -6) = (char *)szWork;
    *(short *)(plVar15 + -2) = rc.top;
    *(int *)((int)plVar15 + -10) = iVar7;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
    uVar23 = 0x1040;
    *(char **)(plVar15 + -4) = (char *)s_s_d_1120_1603 + 4;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
  }
  rc.top = rc.top + (dyArial8 * 3) / 2;
  if ((grbitDraw & 0x1000U) != 0) {
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0x4f;
    *(undefined2 *)(plVar15 + -2) = uVar23;
    *(undefined2 *)((int)plVar15 + -10) = (char *)s_X_Y_Name_1120_163a + 3;
    pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
    *(undefined2 *)((int)plVar15 + -6) = pcVar22;
    *(short *)(plVar15 + -2) = rc.top;
    *(int *)((int)plVar15 + -10) = iVar12;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
    *(char **)(plVar15 + -4) = (char *)s_d_d_d_s_1120_1647 + 9;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
    *(undefined2 *)((int)plVar15 + -2) =
         *(undefined2 *)((int)&rgplr[0].lResLastYear + 2 + idPlayer * 0xc0);
    *(undefined2 *)(plVar15 + -1) =
         *(undefined2 *)((int)&rgplr[0].lResLastYear + idPlayer * 0xc0);
    *(undefined2 *)((int)plVar15 + -6) = 0x1120;
    *(char **)(plVar15 + -2) = PCTLD;
    *(undefined2 *)((int)plVar15 + -10) = 0x1120;
    *(char **)(plVar15 + -3) = (char *)szWork;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
    *(undefined2 *)(plVar15 + -4) = 0x1678;
    sVar5 = _wsprintf((char *)plVar15[-3],(char *)plVar15[-2]);
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(short *)(plVar15 + -1) = sVar5;
    *(undefined2 *)((int)plVar15 + -6) = (char *)szWork;
    *(short *)(plVar15 + -2) = rc.top;
    *(int *)((int)plVar15 + -10) = iVar7;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
    uVar23 = 0x1040;
    *(THING ***)(plVar15 + -4) = (THING **)&lpThings;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
  }
  rc.top = rc.top + (dyArial8 * 3) / 2;
  dx = 0;
  if ((grbitDraw & 0x2000U) == 0) {
    if (((grbitDraw & 0x4000U) != 0) && ((grbitDraw & 0xfU) == 0)) {
      *(HDC *)((int)plVar15 + -2) = hdc;
      *(undefined2 *)(plVar15 + -1) = 0x1120;
      *(undefined2 *)((int)plVar15 + -6) = 0xd15;
      *(undefined2 *)(plVar15 + -2) = 3;
      *(undefined2 *)((int)plVar15 + -10) = uVar23;
      uVar23 = 0x14f8;
      *(undefined2 *)(plVar15 + -3) = 0x16ee;
      DVar19 = GetTextExtent(*(HDC *)((int)plVar15 + -2),(LPCSTR)*(undefined4 *)((int)plVar15 + -6),
                             (short)plVar15[-2]);
      dx = (short)DVar19;
    }
  }
  else {
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0x50;
    *(undefined2 *)(plVar15 + -2) = uVar23;
    *(undefined2 *)((int)plVar15 + -10) = 0x1705;
    pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
    *(undefined2 *)((int)plVar15 + -6) = pcVar22;
    *(short *)(plVar15 + -2) = rc.top;
    *(int *)((int)plVar15 + -10) = iVar12;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
    uVar23 = 0x1040;
    *(undefined2 *)(plVar15 + -4) = 0x1718;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
  }
  *(short *)((int)plVar15 + -2) = pctResGlob;
  *(undefined2 *)(plVar15 + -1) = 0x1120;
  *(undefined2 *)((int)plVar15 + -6) = PCTD;
  *(undefined2 *)(plVar15 + -2) = 0x1120;
  *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
  *(undefined2 *)(plVar15 + -3) = uVar23;
  *(undefined2 *)((int)plVar15 + -0xe) = 0x1732;
  sVar5 = _wsprintf((char *)*(undefined4 *)((int)plVar15 + -10),
                    (char *)*(undefined4 *)((int)plVar15 + -6));
  *(short *)((int)plVar15 + -2) = dx;
  *(short *)(plVar15 + -1) = sVar5;
  *(undefined2 *)((int)plVar15 + -6) = (char *)szWork;
  *(short *)(plVar15 + -2) = rc.top;
  *(int *)((int)plVar15 + -10) = iVar7;
  *(HDC *)(plVar15 + -3) = hdc;
  *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
  *(undefined2 *)(plVar15 + -4) = 0x1751;
  RightTextOut
            (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
             (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
             *(short *)((int)plVar15 + -2));
  if (((grbitDraw & 0x4000U) == 0) || ((grbitDraw & 0xfU) != 0)) {
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(undefined2 *)(plVar15 + -1) = 0x1120;
    *(undefined2 *)((int)plVar15 + -6) = 0xd19;
    *(undefined2 *)(plVar15 + -2) = 1;
    *(undefined2 *)((int)plVar15 + -10) = 0x1040;
    *(undefined2 *)(plVar15 + -3) = 0x1786;
    DVar19 = GetTextExtent(*(HDC *)((int)plVar15 + -2),(LPCSTR)*(undefined4 *)((int)plVar15 + -6),
                           (short)plVar15[-2]);
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(int *)(plVar15 + -1) = iVar7;
    *(short *)((int)plVar15 + -6) = rc.top;
    *(undefined2 *)(plVar15 + -2) = 0x1120;
    *(undefined2 *)((int)plVar15 + -10) = 0xd1b;
    *(undefined2 *)(plVar15 + -3) = 1;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
    *(undefined2 *)(plVar15 + -4) = 0x17a3;
    TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
            (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
    iVar14 = iVar7 + (int)DVar19;
    rcSpinTop.left = iVar14 + 4;
    rcSpinTop.top = rc.top + -4;
    rcSpinTop.right = iVar14 + 0x13;
    rcSpinTop.bottom = (dyArial8 >> 1) + rc.top + 1;
    *(undefined2 *)((int)plVar15 + -2) = 0x1120;
    uVar23 = *(undefined2 *)((int)plVar15 + -2);
    ((RECT *)&rcSpinBot)->left = rcSpinTop.left;
    *(short *)&rcSpinBot.top = rcSpinTop.top;
    *(short *)&rcSpinBot.right = rcSpinTop.right;
    *(short *)&rcSpinBot.bottom = rcSpinTop.bottom;
    *(undefined2 *)((int)plVar15 + -2) = 0x1120;
    *(RECT **)(plVar15 + -1) = (RECT *)&rcSpinBot;
    *(undefined2 *)((int)plVar15 + -6) = 0;
    *(short *)(plVar15 + -2) = (rcSpinTop.bottom - rcSpinTop.top) + -1;
    *(undefined2 *)((int)plVar15 + -10) = 0x14f8;
    *(undefined2 *)(plVar15 + -3) = 0x17fb;
    OffsetRect((RECT *)plVar15[-1],*(short *)((int)plVar15 + -6),(short)plVar15[-2]);
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0xa0;
    *(RECT **)(plVar15 + -2) = (RECT *)&rcSpinTop;
    *(HDC *)((int)plVar15 + -10) = hdc;
    *(undefined2 *)(plVar15 + -3) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1813;
    DrawBtn(*(HDC *)((int)plVar15 + -10),*(RECT **)(plVar15 + -2),
                     *(short *)((int)plVar15 + -6),(short)plVar15[-1],
                     (char *)*(undefined2 *)((int)plVar15 + -2));
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0xa1;
    *(RECT **)(plVar15 + -2) = (RECT *)&rcSpinBot;
    *(HDC *)((int)plVar15 + -10) = hdc;
    *(undefined2 *)(plVar15 + -3) = 0x1040;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x182e;
    DrawBtn(*(HDC *)((int)plVar15 + -10),*(RECT **)(plVar15 + -2),
                     *(short *)((int)plVar15 + -6),(short)plVar15[-1],
                     (char *)*(undefined2 *)((int)plVar15 + -2));
  }
  rc.top = rc.top + (dyArial8 * 3) / 2;
  if (((grbitDraw & 0x4000U) == 0) || ((grbitDraw & 0xfU) != 0)) {
    *(undefined2 *)((int)plVar15 + -2) = 0;
    *(undefined2 *)(plVar15 + -1) = 0;
    *(undefined2 *)((int)plVar15 + -6) = 0x51;
    *(undefined2 *)(plVar15 + -2) = 0x1040;
    *(undefined2 *)((int)plVar15 + -10) = 0x1872;
    pcVar22 = PszGetCompressedString(*(StringId *)((int)plVar15 + -6));
    *(undefined2 *)((int)plVar15 + -6) = pcVar22;
    *(short *)(plVar15 + -2) = rc.top;
    *(int *)((int)plVar15 + -10) = iVar12;
    *(HDC *)(plVar15 + -3) = hdc;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1010;
    *(undefined2 *)(plVar15 + -4) = 0x1885;
    RightTextOut
              (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
               (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
               *(short *)((int)plVar15 + -2));
  }
  *(int *)((int)plVar15 + -2) = lResBudget._2_2_;
  *(uint *)(plVar15 + -1) = (uint)lResBudget;
  *(undefined2 *)((int)plVar15 + -6) = 0x1120;
  *(char **)(plVar15 + -2) = PCTLD;
  *(undefined2 *)((int)plVar15 + -10) = 0x1120;
  *(char **)(plVar15 + -3) = (char *)szWork;
  *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
  *(undefined2 *)(plVar15 + -4) = 0x18a3;
  sVar5 = _wsprintf((char *)plVar15[-3],(char *)plVar15[-2]);
  *(int *)((int)plVar15 + -2) = iVar7 - iVar12;
  *(short *)(plVar15 + -1) = sVar5;
  *(undefined2 *)((int)plVar15 + -6) = (char *)szWork;
  *(short *)(plVar15 + -2) = rc.top;
  *(int *)((int)plVar15 + -10) = iVar7;
  *(HDC *)(plVar15 + -3) = hdc;
  *(undefined2 *)((int)plVar15 + -0xe) = 0x14f8;
  *(undefined2 *)(plVar15 + -4) = 0x18c6;
  RightTextOut
            (*(HDC *)(plVar15 + -3),*(short *)((int)plVar15 + -10),(short)plVar15[-2],
             (char *)*(undefined2 *)((int)plVar15 + -6),(short)plVar15[-1],
             *(short *)((int)plVar15 + -2));
  *(undefined2 *)((int)plVar15 + -2) = 4;
  *(PLAYER **)(plVar15 + -1) = (PLAYER *)rgplr + idPlayer;
  *(undefined2 *)((int)plVar15 + -6) = 0x1040;
  *(undefined2 *)(plVar15 + -2) = 0x18df;
  sVar5 = GetRaceGrbit(*(PLAYER **)(plVar15 + -1),*(RaceGrbit *)((int)plVar15 + -2));
  if (sVar5 == 0) {
    *(undefined2 *)((int)plVar15 + -2) = 0xc;
    *(PLAYER **)(plVar15 + -1) = (PLAYER *)rgplr + idPlayer;
    *(undefined2 *)((int)plVar15 + -6) = 0x10e0;
    uVar23 = 0x10e0;
    *(undefined2 *)(plVar15 + -2) = 0x1900;
    sVar5 = GetRaceGrbit(*(PLAYER **)(plVar15 + -1),*(RaceGrbit *)((int)plVar15 + -2));
    if (sVar5 == 0) {
      yTopTechNote = -1;
      goto RESEARCH_CleanUp;
    }
  }
  *(int *)((int)plVar15 + -2) = (int)szTemp;
  *(undefined2 *)(plVar15 + -1) = 0x50a;
  *(undefined2 *)((int)plVar15 + -6) = 0x10e0;
  *(undefined2 *)(plVar15 + -2) = 0x1918;
  sVar5 = CchGetString
                    (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
  *(HDC *)((int)plVar15 + -2) = hdc;
  *(ushort *)(plVar15 + -1) = rghfontArial8[1];
  *(undefined2 *)((int)plVar15 + -6) = 0x1040;
  *(undefined2 *)(plVar15 + -2) = 0x192b;
  SelectObject(*(HDC *)((int)plVar15 + -2),*(HGDIOBJ *)(plVar15 + -1));
  yTopTechNote = rc.top + dyArial8 * 3;
  rc.top = yTopTechNote;
  rc.left = dxResLeft + 8;
  *(HDC *)((int)plVar15 + -2) = hdc;
  *(undefined2 *)(plVar15 + -1) = unaff_SS;
  *(int *)((int)plVar15 + -6) = (int)szTemp;
  *(short *)(plVar15 + -2) = sVar5;
  *(undefined2 *)((int)plVar15 + -10) = 0x14f8;
  *(undefined2 *)(plVar15 + -3) = 0x195a;
  DVar19 = GetTextExtent(*(HDC *)((int)plVar15 + -2),(LPCSTR)*(undefined4 *)((int)plVar15 + -6),
                         (short)plVar15[-2]);
  *(undefined2 *)((int)plVar15 + -2) = 4;
  *(PLAYER **)(plVar15 + -1) = (PLAYER *)rgplr + idPlayer;
  *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
  uVar23 = 0x10e0;
  *(undefined2 *)(plVar15 + -2) = 0x1973;
  sVar11 = GetRaceGrbit(*(PLAYER **)(plVar15 + -1),*(RaceGrbit *)((int)plVar15 + -2));
  if (sVar11 != 0) {
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(short *)(plVar15 + -1) = rc.left;
    *(short *)((int)plVar15 + -6) = rc.top;
    *(undefined2 *)(plVar15 + -2) = unaff_SS;
    *(int *)((int)plVar15 + -10) = (int)szTemp;
    *(short *)(plVar15 + -3) = sVar5;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x10e0;
    *(undefined2 *)(plVar15 + -4) = 0x1999;
    TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
            (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
    *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
    *(undefined2 *)(plVar15 + -1) = 0x136;
    *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
    *(undefined2 *)(plVar15 + -2) = 0x19a6;
    sVar11 = CchGetString
                       (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(short *)(plVar15 + -1) = rc.left + (int)DVar19;
    *(short *)((int)plVar15 + -6) = rc.top;
    *(undefined2 *)(plVar15 + -2) = 0x1120;
    *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
    *(short *)(plVar15 + -3) = sVar11;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
    uVar23 = 0x14f8;
    *(undefined2 *)(plVar15 + -4) = 0x19ca;
    TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
            (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
    rc.top = rc.top + dyArial8 + 2;
  }
  *(undefined2 *)((int)plVar15 + -2) = 0xc;
  *(PLAYER **)(plVar15 + -1) = (PLAYER *)rgplr + idPlayer;
  *(undefined2 *)((int)plVar15 + -6) = uVar23;
  uVar23 = 0x10e0;
  *(undefined2 *)(plVar15 + -2) = 0x19ea;
  sVar11 = GetRaceGrbit(*(PLAYER **)(plVar15 + -1),*(RaceGrbit *)((int)plVar15 + -2));
  if (sVar11 != 0) {
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(short *)(plVar15 + -1) = rc.left;
    *(short *)((int)plVar15 + -6) = rc.top;
    *(undefined2 *)(plVar15 + -2) = unaff_SS;
    *(int *)((int)plVar15 + -10) = (int)szTemp;
    *(short *)(plVar15 + -3) = sVar5;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x10e0;
    *(undefined2 *)(plVar15 + -4) = 0x1a10;
    TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
            (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
    *(undefined2 *)((int)plVar15 + -2) = (char *)szWork;
    *(undefined2 *)(plVar15 + -1) = 0x13e;
    *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
    *(undefined2 *)(plVar15 + -2) = 0x1a1d;
    sVar5 = CchGetString
                      (*(StringId *)(plVar15 + -1),(char *)*(undefined2 *)((int)plVar15 + -2));
    *(HDC *)((int)plVar15 + -2) = hdc;
    *(short *)(plVar15 + -1) = rc.left + (int)DVar19;
    *(short *)((int)plVar15 + -6) = rc.top;
    *(undefined2 *)(plVar15 + -2) = 0x1120;
    *(undefined2 *)((int)plVar15 + -10) = (char *)szWork;
    *(short *)(plVar15 + -3) = sVar5;
    *(undefined2 *)((int)plVar15 + -0xe) = 0x1040;
    uVar23 = 0x14f8;
    *(undefined2 *)(plVar15 + -4) = 0x1a41;
    TextOut(*(HDC *)((int)plVar15 + -2),(short)plVar15[-1],*(short *)((int)plVar15 + -6),
            (LPCSTR)*(undefined4 *)((int)plVar15 + -10),(short)plVar15[-3]);
  }
RESEARCH_CleanUp:
  *(HDC *)((int)plVar15 + -2) = hdc;
  *(undefined2 *)((int)plVar15 + -4) = crBackSav._2_2_;
  *(undefined2 *)((int)plVar15 + -6) = (undefined2)crBackSav;
  *(undefined2 *)((int)plVar15 + -8) = uVar23;
  *(undefined2 *)((int)plVar15 + -10) = 0x1a58;
  SetBkColor(*(HDC *)((int)plVar15 + -2),*(COLORREF *)((int)plVar15 + -6));
  *(HDC *)((int)plVar15 + -2) = hdc;
  *(undefined2 *)((int)plVar15 + -4) = crForeSav._2_2_;
  *(undefined2 *)((int)plVar15 + -6) = (undefined2)crForeSav;
  *(undefined2 *)((int)plVar15 + -8) = 0x14f8;
  *(undefined2 *)((int)plVar15 + -10) = 0x1a66;
  SetTextColor(*(HDC *)((int)plVar15 + -2),*(COLORREF *)((int)plVar15 + -6));
  *(HDC *)((int)plVar15 + -2) = hdc;
  *(HGDIOBJ *)((int)plVar15 + -4) = HVar4;
  *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
  *(undefined2 *)((int)plVar15 + -8) = 0x1a71;
  SelectObject(*(HDC *)((int)plVar15 + -2),*(HGDIOBJ *)((int)plVar15 + -4));
  if (bVar16) {
    *(HWND *)((int)plVar15 + -2) = hwnd;
    *(HDC *)((int)plVar15 + -4) = hdc;
    *(undefined2 *)((int)plVar15 + -6) = 0x14f8;
    *(undefined2 *)((int)plVar15 + -8) = 0x1a85;
    ReleaseDC(*(HWND *)((int)plVar15 + -2),*(HDC *)((int)plVar15 + -4));
  }
  return;
}



// ======================================================================
// Function: FTrackResearchDlg
// Address: 10d8:1a8c
// Segment: MEMORY_RESEARCH
// ======================================================================


short FTrackResearchDlg(HWND hwnd,short x,short y,short fkb)

{
  POINT PVar1;
  POINT PVar2;
  BOOL BVar3;
  int iVar4;
  short sVar5;
  uint uVar6;
  uint uVar7;
  undefined2 unaff_SS;
  long lVar8;
  RECT rc;
  BTNT btnt;
  RECT *prc;
  short cNew;
  short i;
  short dChg;
  POINT pt;
  short bt;
  
  PVar1.y = y;
  PVar1.x = x;
  BVar3 = PtInRect(&rcSpinTop,PVar1);
  if (BVar3 == 0) {
    PVar2.y = y;
    PVar2.x = x;
    BVar3 = PtInRect(&rcSpinBot,PVar2);
    if (BVar3 == 0) {
      if ((((y < yTopFutureTech) ||
           (cFutureTech * dyArial8 + yTopFutureTech <= y)) ||
          (x < 0xd)) || (dxResLeft + -0xc <= x)) {
        if (((yTopTechNote == -1) || (y < yTopTechNote)) ||
           ((dyArial8 * 3 + yTopTechNote <= y || (x <= dxResLeft)))) {
          sVar5 = 0;
          lVar8 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        }
        else {
          sVar5 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                     ibitRaceGeneralizedResearch);
          if ((sVar5 == 0) ||
             (((dyArial8 * 3) / 2 + yTopTechNote <= y &&
              (sVar5 = GetRaceGrbit((PLAYER *)rgplr + idPlayer,
                                          ibitRaceBleedingEdgeTech), sVar5 != 0)))) {
            i = 0x14c;
          }
          else {
            i = 0x144;
          }
          GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 =
               (ushort)PszGetCompressedString(i);
          GlobalPD.u_POPUPDATA_0x0002.dxOut = dxResRight;
          GlobalPD.grPopup = 10;
          Popup(hwnd,x,y);
          sVar5 = 1;
          lVar8 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
        }
      }
      else {
        iVar4 = (y - yTopFutureTech) / dyArial8;
        GlobalPD.u_POPUPDATA_0x0002.part.hs.grhst =
             ((HS *)rghsFutureTech + iVar4)->grhst;
        GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 =
             *(ushort *)((int)&rghsFutureTech[0].wFlags_0x2 + iVar4 * 4);
        FLookupPart((PART *)&GlobalPD.u_POPUPDATA_0x0002.part);
        GlobalPD.grPopup = 9;
        Popup(hwnd,x,y);
        sVar5 = 1;
        lVar8 = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
      }
      goto LAB_10d8_1d48;
    }
    i = -1;
    prc = (RECT *)&rcSpinBot;
    bt = 0xa1;
  }
  else {
    i = 1;
    prc = (RECT *)&rcSpinTop;
    bt = 0xa0;
  }
  GetClientRect(hwnd,&rc);
  InitBtnTrack(&btnt,hwnd,0,prc,bt,0x50,0,0,(char *)0x0);
  if ((fkb & 4U) == 0) {
    dChg = 1;
    lResBudget = CONCAT22(lResBudget._2_2_,(undefined2)lResBudget);
  }
  else {
    dChg = 10;
  }
  while( true ) {
    sVar5 = FTrackBtn(&btnt);
    if (sVar5 == 0) break;
    uVar6 = dChg * i + pctResGlob;
    uVar7 = uVar6;
    if (0x7fff < uVar6) {
      uVar7 = 0;
    }
    if ((int)uVar7 < 0x65) {
      if (0x7fff < uVar6) {
        uVar6 = 0;
      }
    }
    else {
      uVar6 = 100;
    }
    if (uVar6 != pctResGlob) {
      pctResGlob = uVar6;
      lVar8 = ProjectedResearchSpending((long)(int)uVar6);
      lResBudget = lVar8;
      DrawResearchDlg(hwnd,btnt.hdc,&rc,0x4200);
    }
  }
  sVar5 = 1;
  lVar8 = lResBudget;
LAB_10d8_1d48:
  lResBudget._2_2_ = (undefined2)((ulong)lVar8 >> 0x10);
  lResBudget._0_2_ = (undefined2)lVar8;
  return sVar5;
}



// ======================================================================
// Function: GetTechLevelCost
// Address: 10d8:1dba
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cTech */

long GetTechLevelCost(short iTech,short iLevel,short iplr)

{
  uint uVar1;
  uint uVar2;
  short sVar3;
  int iVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar5;
  long lVar6;
  short cTech;
  short i;
  long lCost;
  
  lVar6 = CONCAT22(unaff_SI,unaff_DI);
  cTech = 0;
  for (i = 0; i < 6; i = i + 1) {
    cTech = cTech + *(char *)(iplr * 0xc0 + 0x59bc + i);
  }
  uVar1 = cTech * 10;
  uVar2 = uVar1 + *(uint *)((long *)rglTechCost + iLevel);
  iVar4 = ((int)uVar1 >> 0xf) + *(int *)((int)(long *)rglTechCost + iLevel * 4 + 2) +
          (uint)CARRY2(uVar1,*(uint *)((long *)rglTechCost + iLevel));
  lVar5 = CONCAT22(iVar4,uVar2);
  sVar3 = GetRaceStat((PLAYER *)rgplr + iplr,iTech + rsTechBonus1);
  if (sVar3 != 1) {
    if (sVar3 + -1 < 0) {
      lVar5 = __aFlshr(lVar6,cTech);
      uVar1 = uVar2 - (uint)lVar5;
      lVar5 = CONCAT22(((iVar4 * 2 - (int)((ulong)lVar5 >> 0x10)) - (uint)(uVar2 < (uint)lVar5)) +
                       (uint)CARRY2(uVar2,uVar1),uVar2 + uVar1);
    }
    else {
      lVar5 = __aFldiv(CONCAT22(iVar4,uVar2),2);
    }
  }
  if ((game.wCrap >> 1 & 1) != 0) {
    lVar5 = __aFlshl(lVar6,cTech);
  }
  return lVar5;
}



// ======================================================================
// Function: BrowserDlg
// Address: 10d8:1ed8
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10d824c3) */

short BrowserDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  bool bVar1;
  short sVar2;
  int iVar3;
  short sVar4;
  HDC HVar5;
  HGDIOBJ HVar6;
  int iVar7;
  char *pcVar8;
  HWND HVar9;
  ushort uVar10;
  uint uVar11;
  UINT UVar12;
  uint uVar13;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  DWORD DVar14;
  ulong uVar15;
  ulong uVar16;
  long lVar17;
  LRESULT LVar18;
  short sVar19;
  short sVar20;
  HWND HVar21;
  WPARAM WVar22;
  WMType WVar23;
  ushort in_stack_0000ffb4;
  short iOff;
  short fShowAll;
  short cIter;
  short md;
  short iStart;
  RECT rc;
  short dx;
  HFONT hfontSav;
  PAINTSTRUCT ps;
  short c;
  short i;
  HMENU hmenu;
  HDC hdc;
  
  uVar15 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_DESTROY) {
    StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,0);
    hwndBrowser = 0;
    fBrowserValid = 0;
    uVar10 = GetASubMenu(hwndFrame,5);
    CheckMenuItem(uVar10,0x100,0);
  }
  else {
    if (message == WM_PAINT) {
      BeginPaint(hwnd,&ps);
      EndPaint(hwnd,&ps);
      return 1;
    }
    if (message == WM_ERASEBKGND) {
      GetClientRect(hwnd,&rc);
      FillRect(wParam,&rc,hbrButtonFace);
      return 1;
    }
    if (message == WM_CTLCOLOR) {
      for (i = 0x10a; i < 0x10c; i = i + 1) {
        HVar9 = GetDlgItem(hwnd,i);
        if ((HWND)lParam == HVar9) break;
      }
      if ((i < 0x10c) || (uVar15 = __aFulshr(uVar15,in_stack_0000ffb4), (int)uVar15 == 6)) {
        SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace))
        ;
        return hbrButtonFace;
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        hwndBrowser = hwnd;
        HVar21 = 0;
        HVar9 = 7;
        sVar2 = GetSystemMetrics(7);
        if (dyArial8 < 0xf) {
          iVar3 = 0;
        }
        else {
          iVar3 = 0x28;
        }
        iVar3 = iVar3 + 0x166 + sVar2 * 2;
        sVar20 = 4;
        sVar2 = GetSystemMetrics(4);
        sVar19 = 8;
        sVar4 = GetSystemMetrics(8);
        SetWindowPos(HVar21,HVar9,iVar3,sVar20,sVar19,
                     dyArial10 + dyArial8 * 0xf + 0x67 + sVar4 * 2 + sVar2,6);
        StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,1);
        HVar5 = GetDC(hwnd);
        HVar6 = SelectObject(HVar5,rghfontArial8[1]);
        HVar9 = GetDlgItem(hwnd,IDC_U16_0x010B);
        sVar2 = GetDlgItemText(hwnd,IDC_U16_0x042E,szWork,0x50);
        DVar14 = GetTextExtent(HVar5,szWork,sVar2);
        iVar3 = (int)DVar14 + 0xe;
        HVar21 = GetDlgItem(hwnd,IDC_U16_0x042E);
        SetWindowPos(HVar21,0,6,6,iVar3,(dyArial8 * 3) / 2,4);
        HVar21 = GetDlgItem(hwnd,IDC_U16_0x042E|IDOK);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar21,0,(iVar7 + 0x15e) - iVar3,6,iVar3,(dyArial8 * 3) / 2,4);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar9,0,(int)DVar14 + 0x1a,6,iVar7 + iVar3 * -2 + 0x14c,
                     dyArial8 * 0x12,4);
        HVar21 = GetDlgItem(hwnd,IDCANCEL);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar21,0,(iVar7 + 0x15e) - iVar3,
                     dyArial10 + dyArial8 * 0xc + (dyArial8 * 3) / 2 +
                     0x60,iVar3,(dyArial8 * 3) / 2,4);
        HVar21 = GetDlgItem(hwnd,0x10a);
        if (dyArial8 < 0xf) {
          iVar7 = 0;
        }
        else {
          iVar7 = 0x28;
        }
        SetWindowPos(HVar21,0,6,
                     dyArial10 + dyArial8 * 0xc + (dyArial8 * 3) / 2 +
                     0x60,(iVar7 + 0x158) - iVar3,(dyArial8 * 3) / 2,4);
        SelectObject(HVar5,HVar6);
        ReleaseDC(hwnd,HVar5);
        if (fBrowserValid == 0) {
          vpartBrowser.hs.grhst = hstArmor;
          vpartBrowser.hs.wFlags_0x2 = vpartBrowser.hs.wFlags_0x2 & 0xff00;
        }
        FLookupPart((PART *)&vpartBrowser);
        if (dyArial8 < 0xf) {
          iVar3 = 0;
        }
        else {
          iVar3 = 0x28;
        }
        hwndBrowserChild =
             CreateWindow(szBrowser,(LPCSTR)0x0,0x50000000,6,
                          (dyArial8 * 3) / 2 + 0xc,iVar3 + 0x158,
                          dyArial10 + dyArial8 * 0xc + 0x4e,hwnd,0,
                          hInst,(void *)0x0);
        for (i = 0x43f; i < 0x450; i = i + 1) {
          WVar23 = WM_USER_0x0403;
          WVar22 = 0;
          HVar21 = HVar9;
          pcVar8 = PszGetCompressedString(i);
          SendMessage(HVar21,WVar23,WVar22,(LPARAM)pcVar8);
        }
        SendMessage(HVar9,WM_USER_0x040E,0,0);
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 2) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyBrowserDlg,0);
          hwndBrowser = 0;
          fBrowserValid = 0;
          uVar10 = GetASubMenu(hwndFrame,5);
          CheckMenuItem(uVar10,0x100,0);
          EndDialog(hwnd,1);
          if (((uint)gd.grBits >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
          return 1;
        }
        if (wParam == 0x10b) {
          uVar16 = __aFulshr(uVar15,in_stack_0000ffb4);
          if ((int)uVar16 == 1) {
            UVar12 = IsDlgButtonChecked(hwnd,0x10a);
            HVar9 = GetDlgItem(hwnd,IDC_U16_0x010B);
            LVar18 = SendMessage(HVar9,WM_USER_0x0407,0,0);
            if ((0xffff < LVar18) || (-1 < LVar18)) {
              lVar17 = __aFlshl(uVar15,in_stack_0000ffb4);
              vpartBrowser.hs.grhst =
                   *(HullSlotType *)((int)(ushort *)rggrbitBrParts + (int)lVar17);
              vpartBrowser.hs.wFlags_0x2 = vpartBrowser.hs.wFlags_0x2 & 0xff00;
              while (sVar2 = FLookupPart((PART *)&vpartBrowser), sVar2 != 0) {
                if ((sVar2 == 1) || (UVar12 == 0)) goto LAB_10d8_2557;
                vpartBrowser.hs.wFlags_0x2 =
                     vpartBrowser.hs.wFlags_0x2 & 0xff00 |
                     vpartBrowser.hs.wFlags_0x2 + 1 & 0xff;
              }
              vpartBrowser.u_PART_0x0004.parmor._0_2_ = (ARMOR *)0x0;
              vpartBrowser.u_PART_0x0004._2_2_ = 0;
LAB_10d8_2557:
              InvalidateRect(hwndBrowserChild,(RECT *)0x0,1);
            }
          }
        }
        else if ((wParam == 0x42f) || (wParam == 0x42e)) {
          uVar11 = vpartBrowser.hs.wFlags_0x2 & 0xff;
          cIter = 0;
          HVar9 = GetDlgItem(hwnd,IDC_U16_0x010B);
          LVar18 = SendMessage(HVar9,WM_USER_0x0407,0,0);
          bVar1 = LVar18 == 0;
          for (i = 0; (sVar2 = i, i < 0x11 &&
                      (vpartBrowser.hs.grhst != ((ushort *)rggrbitBrParts)[i])); i = i + 1
              ) {
          }
          UVar12 = IsDlgButtonChecked(hwnd,0x10a);
          if (wParam == 0x42f) {
            iVar3 = 1;
          }
          else {
            iVar3 = -1;
          }
          while ((uVar13 = iVar3 + vpartBrowser.hs.wFlags_0x2 & 0xff,
                 vpartBrowser.hs.wFlags_0x2 =
                      vpartBrowser.hs.wFlags_0x2 & 0xff00 | uVar13, uVar13 != uVar11 ||
                 (bVar1))) {
            while( true ) {
              iVar7 = cIter + 1;
              if (0x15e < cIter) goto RESEARCH_NullItem;
              md = FLookupPart((PART *)&vpartBrowser);
              cIter = iVar7;
              if (md != 0) break;
              if ((wParam == 0x42f) && (bVar1)) {
                i = i + 1;
                if (0x10 < i) {
                  i = 1;
                }
                vpartBrowser.hs.grhst = ((ushort *)rggrbitBrParts)[i];
                vpartBrowser.hs.wFlags_0x2 = vpartBrowser.hs.wFlags_0x2 & 0xff00
                ;
              }
              else {
                if (((vpartBrowser.hs.wFlags_0x2 & 0xff) == 0) && (!bVar1)) {
                  vpartBrowser.u_PART_0x0004.parmor._0_2_ = (ARMOR *)0x0;
                  vpartBrowser.u_PART_0x0004._2_2_ = 0;
                  goto LAB_10d8_27b3;
                }
                if ((wParam == 0x42e) && (bVar1)) {
                  if ((vpartBrowser.hs.wFlags_0x2 & 0xff) < 0x65) break;
                  i = i + -1;
                  if (i < 1) {
                    i = 0x10;
                  }
                  vpartBrowser.hs.grhst = ((ushort *)rggrbitBrParts)[i];
                  vpartBrowser.hs.wFlags_0x2 =
                       vpartBrowser.hs.wFlags_0x2 & 0xff00 | 100;
                }
                else {
                  if (wParam != 0x42f) break;
                  vpartBrowser.hs.wFlags_0x2 =
                       vpartBrowser.hs.wFlags_0x2 & 0xff00;
                }
              }
            }
            if ((md == 1) ||
               (((md != 0 && (UVar12 == 0)) &&
                ((md != -1 ||
                 (sVar4 = FShouldPartBeHidden((PART *)&vpartBrowser), sVar4 == 0))))))
            break;
          }
LAB_10d8_27b3:
          if ((((vpartBrowser.hs.wFlags_0x2 & 0xff) != uVar11) || (sVar2 != i)) ||
             ((md != 1 && (UVar12 != 0)))) {
            if (((vpartBrowser.hs.wFlags_0x2 & 0xff) == uVar11) && (sVar2 == i)) {
              sVar2 = FLookupPart((PART *)&vpartBrowser);
              if (sVar2 == 1) {
                return 0;
              }
RESEARCH_NullItem:
              vpartBrowser.u_PART_0x0004.parmor._0_2_ = (ARMOR *)0x0;
              vpartBrowser.u_PART_0x0004._2_2_ = 0;
            }
            InvalidateRect(hwndBrowserChild,(RECT *)0x0,1);
          }
        }
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: BrowserWndProc
// Address: 10d8:2876
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Variable defined which should be unmapped: rc */
/* WARNING: Type propagation algorithm not settling */

long BrowserWndProc(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  SHDEF *pSVar1;
  HDC hdc_00;
  HULDEF *pHVar2;
  int iVar3;
  undefined1 *puVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  SHDEF *pSVar5;
  undefined2 uVar6;
  undefined2 uVar7;
  undefined2 unaff_SS;
  ushort uVar8;
  ulong uVar9;
  HULDEF *pHVar10;
  LRESULT LVar11;
  RECT rc;
  PAINTSTRUCT ps;
  short i;
  POINT pt;
  HDC hdc;
  
  uVar7 = 0x10d8;
  puVar4 = &stack0xffc8;
  if (message == WM_CREATE) {
    return 0;
  }
  if (message == WM_PAINT) {
    hdc_00 = BeginPaint(hwnd,&ps);
    GetClientRect(hwnd,&rc);
    DisplayComponentInfo(hdc_00,rc.right,rc.bottom,(PART *)&vpartBrowser);
    EndPaint(hwnd,&ps);
    return 0;
  }
  if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,&rc);
    FillRect(wParam,&rc,hbrButtonFace);
    return 1;
  }
  if (message == WM_SETCURSOR) {
    GetCursorPos(&pt);
    uVar7 = 0x14f8;
    ScreenToClient(hwnd,&pt);
    puVar4 = &stack0xffc4;
  }
  else {
    if (message != WM_LBUTTONDOWN) goto RESEARCH_Default_8;
    pt.x = (short)lParam;
    uVar7 = 0x1118;
    uVar9 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),rc.left);
    puVar4 = &stack0xffc8;
    pt.y = (short)uVar9;
  }
  if ((((vpartBrowser.hs.grhst == hstHull) ||
       (vpartBrowser.hs.grhst == hstSBHull)) && (hwndSlotDlg == 0)) &&
     (((4 < pt.x && (pt.x < 0x45)) &&
      ((dyArial10 + 5 <= pt.y && (pt.y < dyArial10 + 0x45)))))) {
    if (message == WM_LBUTTONDOWN) {
      GlobalPD.grPopup = 0xe;
      if (vpartBrowser.hs.grhst == hstSBHull) {
        *(ushort *)(puVar4 + -2) = vpartBrowser.hs.wFlags_0x2 & 0xff;
        *(undefined2 *)(puVar4 + -4) = uVar7;
        *(undefined2 *)(puVar4 + -6) = 0x29b1;
        pHVar10 = LphuldefSBFromId(*(short *)(puVar4 + -2));
        uVar7 = (undefined2)((ulong)pHVar10 >> 0x10);
        pHVar2 = (HULDEF *)pHVar10;
        *(HULDEF **)(puVar4 + -2) = pHVar2;
        pSVar5 = (SHDEF *)&shdefBuild;
        *(undefined2 *)(puVar4 + -4) = 0x1120;
        uVar6 = *(undefined2 *)(puVar4 + -4);
        *(undefined2 *)(puVar4 + -4) = 0x1120;
        for (iVar3 = 0x3d; iVar3 != 0; iVar3 = iVar3 + -1) {
          pSVar1 = pSVar5;
          pSVar5 = (pSVar5->hul).rgTech;
          pHVar10 = pHVar2;
          pHVar2 = (pHVar2->hul).rgTech;
          (pSVar1->hul).ihuldef = (pHVar10->hul).ihuldef;
        }
        *&(pSVar5->hul).ihuldef = (char)(pHVar2->hul).ihuldef;
        uVar8 = *(ushort *)(puVar4 + -4);
      }
      else {
        *(ushort *)(puVar4 + -2) = vpartBrowser.hs.wFlags_0x2 & 0xff;
        *(undefined2 *)(puVar4 + -4) = uVar7;
        *(undefined2 *)(puVar4 + -6) = 0x29db;
        pHVar10 = LphuldefFromId(*(HullDef *)(puVar4 + -2));
        uVar7 = (undefined2)((ulong)pHVar10 >> 0x10);
        pHVar2 = (HULDEF *)pHVar10;
        *(HULDEF **)(puVar4 + -2) = pHVar2;
        pSVar5 = (SHDEF *)&shdefBuild;
        *(undefined2 *)(puVar4 + -4) = 0x1120;
        uVar6 = *(undefined2 *)(puVar4 + -4);
        *(undefined2 *)(puVar4 + -4) = 0x1120;
        for (iVar3 = 0x3d; iVar3 != 0; iVar3 = iVar3 + -1) {
          pSVar1 = pSVar5;
          pSVar5 = (pSVar5->hul).rgTech;
          pHVar10 = pHVar2;
          pHVar2 = (pHVar2->hul).rgTech;
          (pSVar1->hul).ihuldef = (pHVar10->hul).ihuldef;
        }
        *&(pSVar5->hul).ihuldef = (char)(pHVar2->hul).ihuldef;
        uVar8 = *(ushort *)(puVar4 + -4);
      }
      for (i = 0; i < (int)(uint)*(byte *)((int)&shdefBuild.hul + 0x7a); i = i + 1) {
        *(uint *)((int)&shdefBuild.hul + 0x3c + i * 4) =
             *(uint *)((int)&shdefBuild.hul + 0x3c + i * 4) & 0xff;
      }
      *(SHDEF **)(long *)GlobalPD.u_POPUPDATA_0x0002.rgi = (SHDEF *)&shdefBuild;
      (((PART *)&GlobalPD.u_POPUPDATA_0x0002.part)->hs).wFlags_0x2 = uVar8;
      *(undefined2 *)((long *)GlobalPD.u_POPUPDATA_0x0002.rgi + 1) = 0;
      *(short *)(puVar4 + -2) = pt.y;
      *(short *)(puVar4 + -4) = pt.x;
      *(HWND *)(puVar4 + -6) = hwnd;
      *(undefined2 *)(puVar4 + -8) = 0x1008;
      *(undefined2 *)(puVar4 + -10) = 0x2a57;
      Popup(*(HWND *)(puVar4 + -6),*(short *)(puVar4 + -4),*(short *)(puVar4 + -2));
    }
    else {
      *(HCURSOR *)(puVar4 + -2) = hcurArrowHelp;
      *(undefined2 *)(puVar4 + -4) = uVar7;
      *(undefined2 *)(puVar4 + -6) = 0x2a66;
      setcursor(*(HCURSOR *)(puVar4 + -2));
    }
    return 1;
  }
RESEARCH_Default_8:
  *(HWND *)(puVar4 + -2) = hwnd;
  *(WMType *)(puVar4 + -4) = message;
  *(ushort *)(puVar4 + -6) = wParam;
  *(undefined2 *)(puVar4 + -8) = lParam._2_2_;
  *(short *)(puVar4 + -10) = (short)lParam;
  *(undefined2 *)(puVar4 + -0xc) = uVar7;
  *(undefined2 *)(puVar4 + -0xe) = 0x2a83;
  LVar11 = DefWindowProc(*(HWND *)(puVar4 + -2),*(UINT *)(puVar4 + -4),*(WPARAM *)(puVar4 + -6),
                         *(LPARAM *)(puVar4 + -10));
  return LVar11;
}



// ======================================================================
// Function: DisplayComponentInfo
// Address: 10d8:2ac6
// Segment: MEMORY_RESEARCH
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10d84da9) */
/* WARNING: Removing unreachable block (ram,0x10d862f3) */
/* WARNING: Removing unreachable block (ram,0x10d82fa1) */
/* WARNING: Removing unreachable block (ram,0x10d8301c) */

void DisplayComponentInfo(HDC hdc,short dx,short dy,PART *ppart)

{
  HullSlotType HVar1;
  uint uVar2;
  short sVar3;
  char *pcVar4;
  int iVar5;
  StringId SVar6;
  char *pcVar7;
  int iVar8;
  ushort cLen;
  HGDIOBJ HVar9;
  int iVar10;
  int iVar11;
  int iVar12;
  undefined2 unaff_SS;
  DWORD DVar13;
  COLORREF CVar14;
  HULDEF *pHVar15;
  ulong uVar16;
  long lVar17;
  ulong uVar18;
  undefined2 uVar19;
  HDC HVar20;
  short sVar21;
  undefined2 uVar22;
  HPEN hpenSav;
  short x;
  long ldelta;
  char ch;
  char cch;
  short dxQuan;
  short pct;
  short xBase;
  short y;
  short yBase;
  short dxDigit;
  long lpct;
  short local_136;
  short local_134;
  short local_132;
  char local_130 [222];
  HGDIOBJ local_52;
  undefined4 local_50;
  HGDIOBJ local_4c;
  int local_4a;
  int local_48;
  undefined4 local_46;
  int local_42;
  int local_40;
  int local_3e;
  int local_3c;
  char *local_3a;
  RECT local_38;
  short dxT;
  long l;
  RECT rcData;
  short xText;
  short xNum;
  short yStart;
  short fReq;
  short yCur;
  short i;
  short yText;
  short c;
  short dxStr;
  short ids;
  short idsT;
  ushort rgCosts [4];
  
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,0,dy + -1,dx,1,0xf00021);
  PatBlt(hdc,dx + -1,0,1,dy,0xf00021);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,0,0,dx,1,0xf00021);
  PatBlt(hdc,0,0,1,dy,0xf00021);
  PatBlt(hdc,4,dy + dyArial8 * -2 + -2,dx + -8,1,0xf00021);
  SetBkMode(hdc,1);
  if ((*&(&ppart->u_PART_0x0004)->parmor == 0) && (*(int *)((int)&ppart->u_PART_0x0004 + 2) == 0)) {
    SetRect(&rcData,5,5,dx + -5,dy + -5);
    c = CchGetString(idsNoneAvailable,(char *)szWork);
    DiaganolTextOut(hdc,&rcData,(char *)szWork,c);
    return;
  }
  SelectObject(hdc,rghfontArial10[1]);
  __fstrcpy(szWork,
                    (char *)CONCAT22(*(undefined2 *)((int)&ppart->u_PART_0x0004 + 2),
                                     (char *)(*&(&ppart->u_PART_0x0004)->parmor + 8)));
  CtrTextOut(hdc,dx >> 1,3,(char *)szWork,0);
  if (((ppart->hs).grhst == hstHull) || ((ppart->hs).grhst == hstSBHull)) {
    DrawFleetBitmap
              ((FLEET *)0x0,hdc,5,dyArial10 + 5,0,
               ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp,0,0,-1,0);
  }
  else {
    SelectPalette(hdc,vhpal,0);
    RealizePalette(hdc);
    DibBlt(hdc,5,dyArial10 + 5,0x40,0x40,
                    ((ushort *)rghdibInventory)
                    [((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp >> 5],
                    (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp & 7U) << 6,
                    (3U - (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->ibmp >> 3) & 3) << 6,0x40,
                    0x40,0xcc0020);
  }
  SelectObject(hdc,rghfontArial8[1]);
  yCur = dyArial10 + 0x47;
  c = CchGetString(idsTechReq,(char *)szWork);
  TextOut(hdc,5,yCur,szWork,c);
  dxStr = 0;
  for (i = 0; i < 6; i = i + 1) {
    c = CchGetString(i + idsEner,(char *)szWork);
    DVar13 = GetTextExtent(hdc,szWork,c);
    dxT = (short)DVar13;
    sVar3 = dxT;
    if (dxT <= dxStr) {
      sVar3 = dxStr;
    }
    dxStr = sVar3;
  }
  dxStr = dxStr + 5;
  DVar13 = GetTextExtent(hdc,s_99_1120_0d24,2);
  xNum = dxStr + (int)DVar13;
  fReq = 0;
  for (i = 0; i < 6; i = i + 1) {
    if ('\0' < *(char *)(*&(&ppart->u_PART_0x0004)->parmor + 2 + i)) {
      yCur = yCur + dyArial8;
      local_38.bottom = (short)*(char *)(*&(&ppart->u_PART_0x0004)->parmor + 2 + i);
      if (*(char *)(idPlayer * 0xc0 + 0x59bc + i) < local_38.bottom) {
        uVar2 = 0x7f;
      }
      else {
        uVar2 = 0;
      }
      SetTextColor(hdc,(ulong)uVar2);
      c = CchGetString(i + idsEner,(char *)szWork);
      RightTextOut(hdc,dxStr,yCur,(char *)szWork,c,0);
      SetTextColor(hdc,0);
      c = _wsprintf(szWork,PCTD,
                    (int)*(char *)(*&(&ppart->u_PART_0x0004)->parmor + 2 + i));
      RightTextOut(hdc,xNum,yCur,(char *)szWork,c,0);
      fReq = 1;
    }
  }
  if (fReq == 0) {
    yCur = yCur + dyArial8;
    c = CchGetString(idsNone3,(char *)szWork);
    CtrTextOut(hdc,0x25,yCur,(char *)szWork,c);
  }
  sVar3 = FLookupPart(ppart);
  if (sVar3 < 1) {
    l = -1;
  }
  else {
    l = CostOfDevelopingItem
                  ((char *)CONCAT22(*(undefined2 *)((int)&ppart->u_PART_0x0004 + 2),
                                    (char *)(*&(&ppart->u_PART_0x0004)->parmor + 2)));
  }
  if (l < 100000) {
    if (l < 1) {
      if (l == -1) {
        SetTextColor(hdc,0x7f);
        sVar3 = 0;
        pcVar4 = PszGetCompressedString(idsUnavail);
        CtrTextOut(hdc,0x25,yCur + dyArial8 + 4,pcVar4,sVar3);
        SetTextColor(hdc,0);
      }
      else {
        sVar3 = 0;
        pcVar4 = PszGetCompressedString(idsAvailable);
        CtrTextOut(hdc,0x25,yCur + dyArial8 + 4,pcVar4,sVar3);
      }
    }
    else {
      lVar17 = l;
      pcVar4 = PszGetCompressedString(idsCostLd);
      c = _wsprintf(szWork,pcVar4,(int)lVar17,(int)((ulong)lVar17 >> 0x10));
      TextOut(hdc,5,yCur + dyArial8 + 4,szWork,c);
    }
  }
  else {
    lVar17 = __aFldiv(l + 500,1000);
    pcVar4 = PszGetCompressedString(idsCostLdk);
    c = _wsprintf(szWork,pcVar4,(int)lVar17,(int)((ulong)lVar17 >> 0x10));
    TextOut(hdc,5,yCur + dyArial8 + 4,szWork,c);
  }
  yStart = dyArial10 + 5;
  if (dyArial8 * 4 < 0x40) {
    yStart = yStart + (dyArial8 * -4 + 0x40 >> 1);
  }
  yCur = yStart;
  dxStr = 0;
  for (i = 0; i < 6; i = i + 1) {
    pcVar4 = (char *)*(undefined2 *)(i * 2 + rgszMinerals);
    uVar19 = 0x1120;
    HVar20 = hdc;
    sVar3 = lstrlen((char *)*(undefined2 *)(i * 2 + rgszMinerals));
    DVar13 = GetTextExtent(HVar20,(LPCSTR)CONCAT22(uVar19,pcVar4),sVar3);
    dxT = (short)DVar13;
    sVar3 = dxT;
    if (dxT <= dxStr) {
      sVar3 = dxStr;
    }
    dxStr = sVar3;
  }
  dxStr = dxStr + 0x4d;
  GetTruePartCost(idPlayer,ppart,rgCosts);
  for (i = 0; i < 6; i = i + 1) {
    if ((i != 4) && (i != 3)) {
      SelectObject(hdc,rghfontArial8[1]);
      SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + rgcrMinerals_0x2),
                                *(undefined2 *)(i * 4 + rgcrMinerals)));
      RightTextOut(hdc,dxStr,yCur,(char *)*(undefined2 *)(i * 2 + rgszMinerals),0,0);
      SelectObject(hdc,rghfontArial8[0]);
      SetTextColor(hdc,CONCAT22(crWindowText._2_2_,(undefined2)crWindowText));
      if (i == 5) {
        c = rgCosts[3];
      }
      else {
        c = rgCosts[i];
      }
      if (((ppart->hs).grhst == hstSBHull) || ((ppart->hs).grhst == hstSpecialSB)) {
        c = c - c / 2;
      }
      c = _wsprintf(szWork,PCTD,c);
      RightTextOut
                (hdc,dxStr + dxMaxMineralQuan,yCur,(char *)szWork,c,0);
      if (i < 5) {
        TextOut(hdc,dxStr + dxMaxMineralQuan,yCur,s_kT_1120_0d27,2);
      }
      yCur = yCur + dyArial8;
    }
  }
  SelectObject(hdc,rghfontArial8[1]);
  if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->cMass != 0) {
    sVar3 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->cMass;
    pcVar4 = PszGetCompressedString(idsMassDkt);
    c = _wsprintf(szWork,pcVar4,sVar3);
    TextOut(hdc,dxStr + dxMaxMineralQuan + 0x20,yStart,szWork,c);
  }
  if (xNum + 4 < 0x49) {
    sVar3 = 0x49;
  }
  else {
    sVar3 = xNum + 4;
  }
  SetRect(&rcData,sVar3,dyArial10 + 0x47,dx + -5,dy + dyArial8 * -2 + -9);
  if (0xe < dyArial8) {
    rcData.left = rcData.left + 4;
  }
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,rcData.left,rcData.top,rcData.right - rcData.left,1,0xf00021);
  PatBlt(hdc,rcData.left,rcData.top,1,rcData.bottom - rcData.top,0xf00021);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,rcData.left,rcData.bottom + -1,rcData.right - rcData.left,1,0xf00021);
  PatBlt(hdc,rcData.right + -1,rcData.top,1,rcData.bottom - rcData.top,0xf00021);
  ExpandRc(&rcData,-3,-3);
  if (((gd.grBits._2_2_ >> 0xe & 1) != 0) && (l == 0)) {
    SetTextColor(hdc,CONCAT22(crButtonHilite._2_2_,(undefined2)crButtonHilite));
    c = CchGetString(idsBleedingEdge,(char *)szWork);
    DiaganolTextOut(hdc,&rcData,(char *)szWork,c);
    SetTextColor(hdc,CONCAT22(crWindowText._2_2_,(undefined2)crWindowText));
  }
  ids = -1;
  HVar1 = (ppart->hs).grhst;
  if (HVar1 == hstEngine) {
    SelectObject(hdc,rghfontArial8[1]);
    rcData.right = rcData.right + -2;
    c = CchGetString(idsFuelUsageVsWarpSpeed,(char *)szWork);
    CtrTextOut(hdc,(rcData.right - rcData.left >> 1) + rcData.left,rcData.top,
                        (char *)szWork,c);
    rcData.top = rcData.top + dyArial8;
    c = CchGetString(idsWarp,(char *)szWork);
    DVar13 = GetTextExtent(hdc,szWork,c);
    dxStr = (short)DVar13;
    local_3c = (((rcData.right - rcData.left) - dxStr) + -8) / 10;
    local_38.right = (((rcData.bottom - rcData.top) - dyArial8) + -8) / 6;
    PatBlt(hdc,rcData.left + dxStr + 6,rcData.top,1,
           ((rcData.bottom - rcData.top) - dyArial8) + -4,0x42);
    PatBlt(hdc,rcData.left + dxStr + 6,(rcData.bottom - dyArial8) + -4,
           ((rcData.right - rcData.left) - dxStr) + -6,1,0x42);
    local_4a = rcData.left + dxStr;
    local_3a = (char *)((rcData.bottom - dyArial8) + -4 + local_38.right * -6);
    local_3e = 800;
    SetTextColor(hdc,0x7f);
    for (; 0x18 < local_3e; local_3e = local_3e >> 1) {
      if (local_3e == 100) {
        SetTextColor(hdc,0);
        SelectObject(hdc,hbrGray);
        PatBlt(hdc,local_4a + 4,(short)local_3a,((rcData.right - rcData.left) - dxStr) + -4,1,
               0xf00021);
      }
      c = _wsprintf(szWork,PCTDPCTPCT,local_3e);
      RightTextOut
                (hdc,local_4a,(int)local_3a - (dyArial8 >> 1),(char *)szWork,c,0
                );
      PatBlt(hdc,local_4a + 4,(short)local_3a,5,1,0x42);
      local_3a = (char *)((int)local_3a + local_38.right);
    }
    local_3a = (char *)(rcData.bottom - dyArial8);
    sVar21 = 0;
    sVar3 = 0;
    pcVar4 = PszGetCompressedString(idsWarp);
    RightTextOut(hdc,local_4a,(short)local_3a,pcVar4,sVar3,sVar21);
    local_4a = local_4a + 6;
    local_38.left = (rcData.bottom - dyArial8) + -4;
    DVar13 = GetTextExtent(hdc,s_0_1120_0d2a,1);
    local_38.top = (uint)DVar13 >> 1;
    local_38.bottom = CONCAT11(local_38.bottom._1_1_,0x30);
    local_48 = 1;
    local_46 = SetTextColor(hdc,CONCAT22(crButtonText._2_2_,
                                         (undefined2)crButtonText));
    if ((((((ppart->hs).wFlags_0x2 & 0xff) == 7) || (((ppart->hs).wFlags_0x2 & 0xff) == 9)) ||
        (((ppart->hs).wFlags_0x2 & 0xff) == 0xe)) ||
       ((((ppart->hs).wFlags_0x2 & 0xff) == 0xf || (((ppart->hs).wFlags_0x2 & 0xff) == 8)))) {
      local_40 = 1;
    }
    else {
      local_40 = 0;
    }
    for (i = 0; i < 0xb; i = i + 1) {
      if (i == 10) {
        local_48 = 2;
        local_38.bottom = 0x3031;
        if (local_40 == 0) {
          local_52 = SelectObject(hdc,rghbrPat[0]);
          SetTextColor(hdc,0xffff);
          CVar14 = SetBkColor(hdc,CONCAT22(crButtonFace._2_2_,
                                           (undefined2)crButtonFace));
          local_50 = CVar14;
          PatBlt(hdc,(local_4a - local_3c) + 1,rcData.top,local_3c,local_38.left - rcData.top,
                 0xf00021);
          SetBkColor(hdc,local_50);
          SelectObject(hdc,local_52);
        }
      }
      if ((*(int *)(*&(&ppart->u_PART_0x0004)->pbeam + 0x36 + i * 2) < 0x79) &&
         (((i == 10 && (local_40 != 0)) ||
          ((0x78 < *(int *)(*&(&ppart->u_PART_0x0004)->pbeam + 0x36 + (i + 1) * 2) ||
           ((i == 9 && (local_40 == 0)))))))) {
        SetTextColor(hdc,0x7f0000);
      }
      else {
        SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
      }
      TextOut(hdc,local_4a - local_38.top * local_48,(short)local_3a,(LPCSTR)&local_38.bottom,
              local_48);
      if (0 < i) {
        PatBlt(hdc,local_4a,(short)(local_3a + -6),1,5,0x42);
      }
      local_38.bottom = CONCAT11(local_38.bottom._1_1_,(char)local_38.bottom + '\x01');
      local_4a = local_4a + local_3c;
    }
    SetTextColor(hdc,local_46);
    local_4c = SelectObject(hdc,hpenDkBlue);
    local_4a = rcData.left + dxStr + 6;
    for (i = 0; i < 0xb; i = i + 1) {
      local_3a = (char *)local_38.left;
      local_3e = 0x19;
      local_42 = *(int *)(*&(&ppart->u_PART_0x0004)->pbeam + 0x36 + i * 2);
      for (; local_3e <= local_42; local_3e = local_3e << 1) {
        local_3a = local_3a + -local_38.right;
      }
      if (local_3e == 0x19) {
        if (local_42 == 0) {
          local_3a = local_3a + -1;
        }
        else {
          if ((local_42 * 4 * local_38.right) / 100 < 1) {
            iVar5 = 1;
          }
          else {
            iVar5 = (local_42 * 4 * local_38.right) / 100;
          }
          local_3a = local_3a + -iVar5;
        }
      }
      else {
        sVar3 = MulDiv(local_42 - (local_3e >> 1),100,local_3e >> 1);
        local_50 = CONCAT22(sVar3,(undefined2)local_50);
        local_3a = local_3a + -((sVar3 * local_38.right) / 100);
      }
      if (i == 0) {
        MoveTo(hdc,local_4a,(short)local_3a);
      }
      else {
        LineTo(hdc,local_4a,(short)local_3a);
      }
      local_4a = local_4a + local_3c;
    }
    SelectObject(hdc,local_4c);
    switch(((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp) {
    default:
      if ((10 < ((ppart->hs).wFlags_0x2 & 0xff)) && (((ppart->hs).wFlags_0x2 & 0xff) < 0xf)) {
        ids = 0x18c;
      }
      break;
    case 1:
      ids = 0x29;
      break;
    case 2:
      ids = 0x2a;
      break;
    case 3:
      ids = 0x2b;
      break;
    case 4:
      ids = 0x2c;
      break;
    case 5:
      ids = 0x2d;
      break;
    case 6:
      ids = 0x3a5;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstScanner) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[0]);
    i = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
    if (i == 0) {
      c = CchGetString
                    (idsEnemyFleetsCannotDetectedScannerUnlessSame,(char *)szWork);
    }
    else {
      c = CchGetString(idsEnemyFleetsOrbitingPlanetCanDetectedD,local_130);
      c = _wsprintf(szWork,local_130,i);
    }
    local_132 = DRAWTEXT(hdc,szWork,c,&rcData,0x810);
    rcData.top = rcData.top + (dyArial8 >> 1) + local_132;
    i = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp;
    if (i == 0) {
      c = CchGetString
                    (idsScannerCapableDeterminingPlanetsEnvironmentCompo,(char *)szWork);
    }
    else if (i == 4) {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 5) {
        ids = 0x36;
      }
      else if (((ppart->hs).wFlags_0x2 & 0xff) == 0xe) {
        ids = 0x37;
      }
      else {
        ids = 0x35;
      }
      c = CchGetString(ids,(char *)szWork);
      ids = 0x38;
    }
    else {
      c = CchGetString(idsScannerCanDeterminePlanetsBasicStatsDistance,local_130);
      if (i == 1) {
        uVar19 = 0x32;
      }
      else if (i == 2) {
        uVar19 = 100;
      }
      else {
        uVar19 = 200;
      }
      c = _wsprintf(szWork,local_130,uVar19);
      ids = 0x164;
    }
    local_132 = DRAWTEXT(hdc,szWork,c,&rcData,0x810);
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstShield) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    local_38.right = rcData.left;
    sVar21 = 1;
    sVar3 = 0;
    pcVar4 = PszGetCompressedString(idsShieldStrength);
    DxStreamTextOut(hdc,&local_38.right,rcData.top,pcVar4,sVar3,sVar21);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    DxStreamTextOut(hdc,&local_38.right,rcData.top,(char *)szWork,c,1);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 4) {
      ids = 0x3a;
      local_38.bottom = idsShieldDecreasesRangeWhichEnemyShipsCan;
RESEARCH_LShieldDisp:
      c = CchGetString(local_38.bottom,(char *)szWork);
      rcData.top = rcData.top + dyArial8 + 4;
      DRAWTEXT(hdc,szWork,c,&rcData,0x810);
    }
    else {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 3) {
        ids = 0x3b;
        local_38.bottom = idsShieldAlsoContainsArmorComponentWhichWill;
        goto RESEARCH_LShieldDisp;
      }
      if (((ppart->hs).wFlags_0x2 & 0xff) == 6) {
        ids = 0x3a2;
        local_38.bottom = idsShieldAlsoProvides65dpArmor5Jamming;
        goto RESEARCH_LShieldDisp;
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstArmor) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    local_38.bottom = rcData.left;
    sVar21 = 1;
    sVar3 = 0;
    pcVar4 = PszGetCompressedString(idsArmorStrength2);
    DxStreamTextOut(hdc,&local_38.bottom,rcData.top,pcVar4,sVar3,sVar21);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    DxStreamTextOut(hdc,&local_38.bottom,rcData.top,(char *)szWork,c,1);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
      ids = 0x3a;
      idsT = 0x3d;
RESEARCH_LArmDisp:
      c = CchGetString(idsT,(char *)szWork);
      rcData.top = rcData.top + dyArial8 + 4;
      DRAWTEXT(hdc,szWork,c,&rcData,0x810);
    }
    else {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 6) {
        ids = 0x4d4;
        idsT = 0x3e;
        goto RESEARCH_LArmDisp;
      }
      if (((ppart->hs).wFlags_0x2 & 0xff) == 9) {
        ids = 0x3a2;
        c = CchGetString(idsPartAlsoActs100dpShield20Cloak,(char *)szWork);
        rcData.top = rcData.top + dyArial8 + 4;
        SelectObject(hdc,rghfontArial8[0]);
        DRAWTEXT(hdc,szWork,c,&rcData,0x810);
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstBeam) {
    ExpandRc(&rcData,-4,-4);
    local_38.bottom = (rcData.right - rcData.left) / 3 + rcData.left;
    yText = rcData.top;
    c = CchGetString(idsPower,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsRange,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsInitiative,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    rcData.top = yText + (dyArial8 * 3) / 2;
    yText = rcData.top;
    if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities == 0) {
      if (((ppart->hs).wFlags_0x2 & 0xff) == 0x12) {
        ids = 0x3a2;
        c = CchGetString(idsPartAlsoActs10CloakIncreasesTorpedo,(char *)szWork);
        SelectObject(hdc,rghfontArial7[0]);
        sVar3 = DRAWTEXT(hdc,szWork,c,&rcData,0x810);
        rcData.top = rcData.top + sVar3;
        c = CchGetString(idsWeaponCanAlsoBombPlanets2Colonists,(char *)szWork);
        DRAWTEXT(hdc,szWork,c,&rcData,0x810);
      }
    }
    else {
      SelectObject(hdc,rghfontArial7[0]);
      if ((((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities & 1U) != 0) {
        c = CchGetString(idsWeaponWillDamageShieldsHasEffectArmor,(char *)szWork)
        ;
        sVar3 = DRAWTEXT(hdc,szWork,c,&rcData,0x810);
        rcData.top = rcData.top + sVar3;
      }
      if ((((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities & 2U) != 0) {
        c = CchGetString(idsWeaponHitsTargetsRangeEachTimeFired,(char *)szWork);
        sVar3 = DRAWTEXT(hdc,szWork,c,&rcData,0x810);
        rcData.top = rcData.top + sVar3;
        iVar5 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp << 4;
        pcVar4 = PszGetCompressedString(idsWeaponAlsoMakesExcellentMineSweeperCapable);
        c = _wsprintf(szWork,pcVar4,iVar5);
        DRAWTEXT(hdc,szWork,c,&rcData,0x810);
      }
      SelectObject(hdc,rghfontArial8[0]);
    }
    if (((ppart->hs).wFlags_0x2 & 0xff) == 2) {
      ids = 0x155;
    }
    else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0xe) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x10))
    {
      ids = 0x156;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstTorp) {
    ExpandRc(&rcData,-4,-4);
    local_38.bottom = (rcData.right - rcData.left) / 3 + rcData.left;
    yText = rcData.top;
    c = CchGetString(idsPower,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsRange,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsInitiative,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    yText = yText + dyArial8;
    c = CchGetString(idsAccuracy,(char *)szWork);
    SelectObject(hdc,rghfontArial8[1]);
    RightTextOut(hdc,local_38.bottom,yText,(char *)szWork,c,0);
    SelectObject(hdc,rghfontArial8[0]);
    c = _wsprintf(szWork,PCTD,
                  ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->grfAbilities);
    TextOut(hdc,local_38.bottom,yText,szWork,c);
    yText = yText + (dyArial8 * 3) / 2;
    if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
      ids = 0x3a2;
    }
    else if ((7 < ((ppart->hs).wFlags_0x2 & 0xff)) && (((ppart->hs).wFlags_0x2 & 0xff) < 0xc)) {
      ids = 0x529;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstBomb) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    local_136 = rcData.left;
    local_132 = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 9) {
      c = CchGetString
                    (idsBombDoesKillColonistsDestroyInstallationsBomb,(char *)szWork);
    }
    else if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == 0) {
      c = CchGetString(idsBombWillKillAnyPlanetsPopulation,(char *)szWork);
    }
    else {
      CchGetString(idsBombWillKillApproximatelyDDPlanets,(char *)szWork);
      c = _wsprintf(local_130,szWork,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp / 10,
                    ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp % 10);
      if (((ppart->hs).wFlags_0x2 & 0xff) < 5) {
        local_134 = 3;
      }
      else if ((((ppart->hs).wFlags_0x2 & 0xff) < 10) || (0xe < ((ppart->hs).wFlags_0x2 & 0xff))) {
        local_134 = 0;
      }
      else {
        local_134 = 999;
      }
      if (local_134 != 0) {
        if (local_134 == 999) {
          SVar6 = idsSmartBombsStrictlyAdditiveHaveMinimumKill;
        }
        else {
          SVar6 = idsIfPlanetHasDefensesBombGuaranteedKill;
        }
        CchGetString(SVar6,(char *)szWork);
        sVar3 = _wsprintf(local_130 + c,szWork,local_134 * 100);
        c = c + sVar3;
      }
      _strcpy((char *)szWork,local_130);
    }
    WrapTextOut
              (hdc,&local_136,&local_132,(char *)szWork,c,rcData.left,
               rcData.right - rcData.left,(short *)0x0,0,1);
    local_136 = rcData.left;
    local_132 = local_132 + (dyArial8 >> 1);
    if (((ppart->hs).wFlags_0x2 & 0xff) == 9) {
      ids = 0x15f;
    }
    else {
      if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init == 0) {
        c = CchGetString(idsBombWillDamagePlanetsMinesFactories,(char *)szWork);
      }
      else {
        CchGetString(idsBombWillDestroyApproximatelyDPlanetsMines,local_130);
        c = _wsprintf(szWork,local_130,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
      }
      WrapTextOut
                (hdc,&local_136,&local_132,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,1,1);
      if ((((ppart->hs).wFlags_0x2 & 0xff) < 10) || (0xe < ((ppart->hs).wFlags_0x2 & 0xff))) {
        if (((ppart->hs).wFlags_0x2 & 0xff) == 8) {
          ids = 0x3a2;
        }
      }
      else {
        ids = 0x41;
      }
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstMining) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
    case 5:
      ids = 0x14e;
    case 2:
    case 3:
    case 4:
      if (ids == -1) {
        ids = 0x150;
      }
    case 1:
    case 6:
      c = CchGetString(idsModuleContainsRobotsCapableMining,(char *)szWork);
      sVar3 = _wsprintf((char *)szWork + c,PCTD,
                        ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
      c = c + sVar3;
      sVar3 = CchGetString
                        (idsKtEachMineralDependingConcentrationUninhabitedPl,
                         (char *)szWork + c);
      c = c + sVar3;
      if (((ppart->hs).wFlags_0x2 & 0xff) == 6) {
        ids = 0x3a2;
        sVar3 = CchGetString(idsModuleAlsoActs30Cloak30Jammer,(char *)szWork + c)
        ;
        c = c + sVar3;
      }
      break;
    case 7:
      ids = 0x15f;
      c = CchGetString
                    (idsModifiedMiningRobotTerraformsInhabitedPlanets1,(char *)szWork);
      break;
    default:
      goto switchD_10d8_5c55_default;
    }
    goto RESEARCH_PrintSpecial;
  }
  if (HVar1 == hstMines) {
    local_3c = -1;
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    rcData.top = rcData.top + dyArial8 * 5;
    for (i = 4; -1 < i; i = i + -1) {
      rcData.top = rcData.top - dyArial8;
      c = CchGetString(i + idsMinesLaidPerYear,(char *)szWork);
      if (local_3c == -1) {
        DVar13 = GetTextExtent(hdc,szWork,c);
        local_3c = (int)DVar13;
      }
      RightTextOut(hdc,rcData.left + local_3c,rcData.top,(char *)szWork,c,0);
    }
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
    case 1:
    case 2:
    case 3:
      local_38.top = 4;
      local_3a = (char *)0x3;
      local_38.left = (int)(ulong *)rgcrPlrHistory + 0x36;
      local_38.right = 0x7d;
      local_38.bottom = idsTutorialHaveTriedCopyWrongShipDesign;
      local_3e = 600;
      if (((ppart->hs).wFlags_0x2 & 0xff) == 1) {
        ids = 0x514;
      }
      else {
        ids = 0x151;
      }
      break;
    case 4:
    case 5:
    case 6:
      local_38.top = 6;
      local_3a = (char *)0xa;
      local_38.left = (short)((char *)szMine + 8);
      local_38.right = 600;
      local_38.bottom = idsGut|idsStability;
      local_3e = 0x9c4;
      ids = 0x151;
      break;
    case 7:
    case 8:
    case 9:
      local_38.top = 5;
      local_3a = (char *)((int)(HBRUSH *)&hbrGray + 1);
      local_38.left = 0;
      local_38.right = 0;
      local_38.bottom = idsUniverseDefinitionFileSeemsMissingCorrupt;
      local_3e = 0;
      if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
        ids = 0x152;
      }
      else {
        ids = 0x151;
      }
    }
    c = _wsprintf(szWork,PCTD,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp * 10);
    TextOut(hdc,rcData.left + local_3c + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    uVar2 = local_38.top;
    pcVar4 = PszGetCompressedString(idsWarpD2);
    c = _wsprintf(szWork,pcVar4,uVar2);
    TextOut(hdc,rcData.left + local_3c + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    iVar12 = (int)local_3a % 10;
    iVar5 = (int)local_3a / 10;
    pcVar4 = PszGetCompressedString(idsDD2);
    c = _wsprintf(szWork,pcVar4,iVar5,iVar12);
    TextOut(hdc,rcData.left + local_3c + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    pcVar4 = (char *)local_38.left;
    sVar3 = local_38.right;
    pcVar7 = PszGetCompressedString(idsDDEngine);
    c = _wsprintf(szWork,pcVar7,pcVar4,sVar3);
    TextOut(hdc,rcData.left + local_3c + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    SVar6 = local_38.bottom;
    iVar5 = local_3e;
    pcVar4 = PszGetCompressedString(idsDD3);
    c = _wsprintf(szWork,pcVar4,SVar6,iVar5);
    TextOut(hdc,rcData.left + local_3c + 4,rcData.top,szWork,c);
    rcData.top = rcData.top + dyArial8;
    SelectObject(hdc,rghfontArial7[0]);
    c = CchGetString
                  (idsNumbersParenthesisFleetsContainingShipRamScoop,(char *)szWork);
    DRAWTEXT(hdc,szWork,c,&rcData,0x810);
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstSpecialSB) {
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
    case 2:
    case 3:
      ids = 0x42;
      idsT = 0x2e0;
      break;
    case 1:
    case 4:
    case 5:
    case 6:
      ids = 0x2e;
      idsT = 0x2e0;
      break;
    case 7:
    case 8:
    case 10:
    case 0xb:
    case 0xd:
    case 0xe:
    case 0xf:
      ids = 0x2f;
    case 9:
    case 0xc:
      idsT = 0x2e1;
      break;
    default:
      idsT = -1;
    }
    c = CchGetString(idsT,(char *)szWork);
    WrapTextOut
              (hdc,&xText,&yText,(char *)szWork,c,rcData.left,rcData.right - rcData.left,
               (short *)0x0,0,1);
    xText = rcData.left;
    yText = yText + (dyArial8 * 3) / 2;
    if (idsT == 0x2e0) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar21 = 1;
      sVar3 = 0;
      pcVar4 = PszGetCompressedString(idsSafeHullMass);
      DxStreamTextOut(hdc,&xText,yText,pcVar4,sVar3,sVar21);
      SelectObject(hdc,rghfontArial8[0]);
      if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        c = _wsprintf(szWork,PCTDKT,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp)
        ;
      }
      DxStreamTextOut(hdc,&xText,yText,(char *)szWork,c,1);
      xText = rcData.left;
      yText = yText + dyArial8;
      SelectObject(hdc,rghfontArial8[1]);
      sVar21 = 1;
      sVar3 = 0;
      pcVar4 = PszGetCompressedString(idsSafeRange);
      DxStreamTextOut(hdc,&xText,yText,pcVar4,sVar3,sVar21);
      SelectObject(hdc,rghfontArial8[0]);
      if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        sVar3 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp;
        pcVar4 = PszGetCompressedString(idsDLightYears);
        c = _wsprintf(szWork,pcVar4,sVar3);
      }
      DxStreamTextOut(hdc,&xText,yText,(char *)szWork,c,1);
      if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == -1) {
        if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == -1) {
          idsT = -1;
        }
        else {
          iVar5 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp * 5;
          pcVar4 = PszGetCompressedString(idsWarningShipsCanSuccessfullyGatedDL);
          c = _wsprintf(szWork,pcVar4,iVar5);
        }
      }
      else if (((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp == -1) {
        iVar5 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp * 5;
        pcVar4 = PszGetCompressedString(idsWarningShipsDktCanSuccessfullyGatedExceeding);
        c = _wsprintf(szWork,pcVar4,iVar5);
      }
      else {
        iVar5 = ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp * 5;
        iVar12 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp * 5;
        pcVar4 = PszGetCompressedString(idsWarningShipsDktMightSuccessfullyGatedD);
        c = _wsprintf(szWork,pcVar4,iVar12,iVar5);
      }
    }
    else if (idsT == 0x2e1) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar21 = 1;
      sVar3 = 0;
      pcVar4 = PszGetCompressedString(idsWarp);
      DxStreamTextOut(hdc,&xText,yText,pcVar4,sVar3,sVar21);
      SelectObject(hdc,rghfontArial8[0]);
      c = _wsprintf(szWork,PCTD,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
      DxStreamTextOut(hdc,&xText,yText,(char *)szWork,c,1);
      xText = rcData.left;
      yText = yText + dyArial8;
      idsT = 0x457;
      if (7 < ((ppart->hs).wFlags_0x2 & 0xff)) {
        idsT = 0x458;
      }
      c = CchGetString(idsT,(char *)szWork);
    }
    if (idsT != -1) {
      xText = rcData.left;
      if (dyArial8 < 0xf) {
        iVar5 = 4;
      }
      else {
        iVar5 = 0;
      }
      yText = yText + iVar5 + dyArial8;
      SelectObject(hdc,rghfontArial7[0]);
      SetTextColor(hdc,0x7f);
      WrapTextOut
                (hdc,&xText,&yText,(char *)szWork,c,rcData.left,rcData.right - rcData.left
                 ,(short *)0x0,0,1);
      SelectObject(hdc,rghfontArial8[0]);
      SetTextColor(hdc,0);
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 == hstSBHull) {
    ExpandRc(&rcData,-4,-4);
    idsT = 0x4a;
    local_38.right = rcData.left;
    local_38.bottom = rcData.top;
    if ((((ppart->hs).wFlags_0x2 & 0xff) == 1) || (((ppart->hs).wFlags_0x2 & 0xff) == 3)) {
      ids = 0x2dd;
    }
    else if (((ppart->hs).wFlags_0x2 & 0xff) == 4) {
      ids = 0x15a;
    }
    SelectObject(hdc,rghfontArial8[0]);
    if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == 0) {
      c = CchGetString(idsStarbaseHullDoesHaveSpaceDockCan,(char *)szWork);
      WrapTextOut
                (hdc,&local_38.right,&local_38.bottom,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,0,1);
      local_38.bottom = dyArial8 * 3 + rcData.top;
    }
    else {
      c = CchGetString(idsStarbaseHullHasSpaceDockCanBuild,(char *)szWork);
      WrapTextOut
                (hdc,&local_38.right,&local_38.bottom,(char *)szWork,c,rcData.left,
                 rcData.right - rcData.left,(short *)0x0,0,1);
      SelectObject(hdc,rghfontArial8[1]);
      local_38.bottom = dyArial8 * 3 + rcData.top;
      local_38.right = (rcData.right - rcData.left) / 2 + rcData.left;
      c = CchGetString(idsDockCapacity2,(char *)szWork);
      RightTextOut(hdc,local_38.right,local_38.bottom,(char *)szWork,c,0);
      SelectObject(hdc,rghfontArial8[0]);
      if (((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp == -1) {
        c = CchGetString(idsUnlimited,(char *)szWork);
      }
      else {
        c = _wsprintf(szWork,PCTDKT,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp)
        ;
      }
      TextOut(hdc,local_38.right,local_38.bottom,szWork,c);
    }
    local_38.bottom = local_38.bottom + (dyArial8 * 3) / 2;
    local_38.right = (rcData.right - rcData.left) / 2 + rcData.left;
    i = 0;
    while( true ) {
      if (1 < i) break;
      c = CchGetString(idsT,(char *)szWork);
      SelectObject(hdc,rghfontArial8[1]);
      RightTextOut(hdc,local_38.right,local_38.bottom,(char *)szWork,c,0);
      SelectObject(hdc,rghfontArial8[0]);
      if (i == 0) {
        c = _wsprintf(szWork,PCTD,((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
      }
      else if (i == 1) {
        pHVar15 = LphuldefFromId((&ppart->u_PART_0x0004)->phul->ihuldef);
        c = _wsprintf(szWork,PCTD,((HULDEF *)pHVar15)->wFlags_0x7b & 0x3f);
      }
      TextOut(hdc,local_38.right,local_38.bottom,szWork,c);
      i = i + 1;
      idsT = idsT + 1;
      local_38.bottom = local_38.bottom + (dyArial8 * 3) / 2;
    }
    goto switchD_10d8_5c55_default;
  }
  if (HVar1 != hstSpecialE) {
    if (HVar1 != hstSpecialM) {
      if (HVar1 == hstTerra) {
        ExpandRc(&rcData,-4,-4);
        SelectObject(hdc,rghfontArial8[1]);
        local_134 = rcData.left;
        local_132 = rcData.top;
        SelectObject(hdc,rghfontArial8[0]);
        c = 0;
        if (((ppart->hs).wFlags_0x2 & 0xff) < 8) {
          ids = 0x15c;
          c = CchGetString(idsAllowsModifyAnyPlanetsThreeEnvironmentVariables,local_130);
          c = _wsprintf(szWork,local_130,((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
        }
        else {
          c = CchGetString(idsAllowsModifyPlanetsSDOriginalValue,local_130);
          c = _wsprintf(szWork,local_130,
                        *(undefined2 *)
                         (((int)(((ppart->hs).wFlags_0x2 & 0xff) - 8) / 4) * 2 + 0x47e),0x1120,
                        ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
        }
        if (0 < c) {
          WrapTextOut
                    (hdc,&local_134,&local_132,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
      }
      else if (HVar1 == hstHull) {
        ExpandRc(&rcData,-4,-4);
        local_38.right = (rcData.right - rcData.left) / 2 + rcData.left;
        local_38.bottom = idsFuelCapacity;
        if ((((ppart->hs).wFlags_0x2 & 0xff) == 0xe) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x1f)) {
          ids = 0x153;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 3) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x19)
                ) {
          ids = 0x159;
        }
        else if (((ppart->hs).wFlags_0x2 & 0xff) == 0x17) {
          ids = 0x154;
        }
        else if (((((ppart->hs).wFlags_0x2 & 0xff) == 0x14) ||
                 (((ppart->hs).wFlags_0x2 & 0xff) == 0x16)) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x18)) {
          ids = 0x14f;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 10) || (((ppart->hs).wFlags_0x2 & 0xff) == 8))
        {
          ids = 0x157;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0xc) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x12)) {
          ids = 0x158;
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0x1b) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x1c)) {
          ids = 0x165;
        }
        else if (((((ppart->hs).wFlags_0x2 & 0xff) == 4) || (((ppart->hs).wFlags_0x2 & 0xff) == 5))
                || (((ppart->hs).wFlags_0x2 & 0xff) == 6)) {
          ids = 0x30;
        }
        else if (((ppart->hs).wFlags_0x2 & 0xff) == 0x1e) {
          ids = 0x3a3;
        }
        for (i = 0; i < 4; i = i + 1) {
          c = CchGetString(local_38.bottom,(char *)szWork);
          SelectObject(hdc,rghfontArial8[1]);
          RightTextOut(hdc,local_38.right,rcData.top,(char *)szWork,c,0);
          SelectObject(hdc,rghfontArial8[0]);
          if (i == 0) {
            c = _wsprintf(szWork,s_dmg_1120_0d2c,
                          ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->dp);
          }
          else if (i == 1) {
            c = _wsprintf(szWork,PCTDKT,
                          ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp);
          }
          else if (i == 2) {
            c = _wsprintf(szWork,PCTD,
                          ((BEAM *)(&ppart->u_PART_0x0004)->pbeam)->init);
          }
          else if (i == 3) {
            pHVar15 = LphuldefFromId((&ppart->u_PART_0x0004)->phul->ihuldef);
            c = _wsprintf(szWork,PCTD,((HULDEF *)pHVar15)->wFlags_0x7b & 0x3f);
          }
          TextOut(hdc,local_38.right,rcData.top,szWork,c);
          local_38.bottom = local_38.bottom + idsPlayerLogFileAppearsCorruptUnableLoad;
          rcData.top = rcData.top + (dyArial8 * 3) / 2;
        }
        if ((((ppart->hs).wFlags_0x2 & 0xff) == 0x19) || (((ppart->hs).wFlags_0x2 & 0xff) == 0x1a))
        {
          local_38.left =
               (short)PszGetCompressedString(idsHullWillManufacture200UnitsFuelEach);
          if (((ppart->hs).wFlags_0x2 & 0xff) == 0x19) {
            local_38.top = 5;
          }
          else {
            local_38.top = 10;
          }
          c = _wsprintf(szWork,(char *)local_38.left,local_38.top);
          SelectObject(hdc,rghfontArial8[0]);
          local_38.right = rcData.left;
          yText = rcData.top;
          WrapTextOut
                    (hdc,&local_38.right,&yText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
        else if ((((ppart->hs).wFlags_0x2 & 0xff) == 0x1b) ||
                (((ppart->hs).wFlags_0x2 & 0xff) == 0x1c)) {
          c = CchGetString
                        (idsHullWillDoubleEfficiencyMineLayingPods,(char *)szWork);
          SelectObject(hdc,rghfontArial8[0]);
          local_38.right = rcData.left;
          yText = rcData.top;
          WrapTextOut
                    (hdc,&local_38.right,&yText,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
      }
      else if (HVar1 == hstPlanetary) {
        ExpandRc(&rcData,-4,-4);
        SelectObject(hdc,rghfontArial8[1]);
        local_134 = rcData.left;
        local_132 = rcData.top;
        SelectObject(hdc,rghfontArial8[0]);
        c = 0;
        if ((((ppart->hs).wFlags_0x2 & 0xff) < 9) || (0xd < ((ppart->hs).wFlags_0x2 & 0xff))) {
          if (((ppart->hs).wFlags_0x2 & 0xff) < 9) {
            i = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
            c = CchGetString(idsEnemyFleetsOrbitingPlanetCanDetectedD,local_130);
            sVar3 = _abs(i);
            c = _wsprintf(szWork,local_130,sVar3);
            if (i < 0) {
              WrapTextOut
                        (hdc,&local_134,&local_132,(char *)szWork,c,rcData.left,
                         rcData.right - rcData.left,(short *)0x0,0,1);
              local_134 = rcData.left;
              local_132 = local_132 + (dyArial8 * 3) / 2;
              c = CchGetString(idsScannerCanDeterminePlanetsBasicStatsDistance,local_130);
              c = _wsprintf(szWork,local_130,-i >> 1);
              ids = 0x164;
            }
            else {
              ids = 0x4ef;
            }
          }
          else if (((ppart->hs).wFlags_0x2 & 0xff) == 0xe) {
            ids = 0x3a4;
            c = CchGetString
                          (idsProcessGivesPlanetNewBirthTracesCivilization,(char *)szWork)
            ;
          }
        }
        else {
          SelectObject(hdc,rghfontArial8[1]);
          rcData.right = rcData.right + -2;
          c = CchGetString(idsShieldCoverageVsDefenseQuan,(char *)szWork);
          CtrTextOut(hdc,(rcData.right - rcData.left >> 1) + rcData.left,rcData.top,
                              (char *)szWork,c);
          rcData.top = rcData.top + dyArial8;
          sVar3 = CchGetString(idsNum,local_130);
          DVar13 = GetTextExtent(hdc,local_130,(int)(char)sVar3);
          dxStr = (short)DVar13;
          iVar5 = (((rcData.right - rcData.left) - dxStr) + -10) / 5;
          local_136 = (((rcData.bottom - rcData.top) - dyArial8) + -8) / 5;
          PatBlt(hdc,rcData.left + dxStr + 6,rcData.top,1,
                 ((rcData.bottom - rcData.top) - dyArial8) + -4,0x42);
          PatBlt(hdc,rcData.left + dxStr + 6,(rcData.bottom - dyArial8) + -4,
                 ((rcData.right - rcData.left) - dxStr) + -6,1,0x42);
          iVar12 = rcData.left + dxStr;
          y = (rcData.bottom - dyArial8) + -4 + local_136 * -5;
          SetTextColor(hdc,0x7f0000);
          sVar3 = CchGetString(idsStandard,(char *)szWork);
          RightTextOut
                    (hdc,rcData.right,rcData.bottom + -3 + dyArial8 * -3,
                     (char *)szWork,(int)(char)sVar3,0);
          SetTextColor(hdc,0x7f);
          sVar3 = CchGetString(idsSmart,(char *)szWork);
          RightTextOut
                    (hdc,rcData.right,rcData.bottom + -4 + dyArial8 * -2,
                     (char *)szWork,(int)(char)sVar3,0);
          pct = 100;
          SetTextColor(hdc,0);
          for (; 0 < pct; pct = pct + -0x14) {
            c = _wsprintf(szWork,PCTDPCTPCT,pct);
            RightTextOut
                      (hdc,iVar12,y - (dyArial8 >> 1),(char *)szWork,c,0);
            PatBlt(hdc,iVar12 + 4,y,5,1,0x42);
            y = y + local_136;
          }
          iVar8 = rcData.bottom - dyArial8;
          sVar3 = 0;
          cLen = _strlen(local_130);
          RightTextOut(hdc,iVar12,iVar8,local_130,cLen,sVar3);
          x = iVar12 + 6;
          DVar13 = GetTextExtent(hdc,s_0_1120_0d31,1);
          iVar12 = (int)DVar13;
          for (i = 0; i < 6; i = i + 1) {
            sVar3 = _wsprintf(szWork,PCTD,i * 0x14);
            if (i == 0) {
              iVar10 = iVar12 >> 1;
            }
            else {
              iVar10 = iVar12;
              if (i == 5) {
                iVar10 = (iVar12 * 3) / 2;
              }
            }
            TextOut(hdc,x - iVar10,iVar8,szWork,(int)(char)sVar3);
            if (0 < i) {
              PatBlt(hdc,x,iVar8 + -6,1,5,0x42);
            }
            x = x + iVar5;
          }
          HVar9 = SelectObject(hdc,hpenDkBlue);
          iVar8 = rcData.left + dxStr;
          iVar10 = rcData.bottom - dyArial8;
          iVar12 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
          for (c = 0; ldelta._0_2_ = 1000 - iVar12, c < 2; c = c + 1) {
            uVar18 = 1000000;
            i = 0;
            while( true ) {
              lpct._2_2_ = (int)(uVar18 >> 0x10);
              lpct._0_2_ = (uint)uVar18;
              if (100 < i) break;
              sVar3 = MulDiv(i,iVar5,0x14);
              iVar11 = sVar3 + iVar8 + 6;
              uVar22 = 3;
              uVar19 = 0xd40;
              uVar16 = __aFulmul(CONCAT22((0xf - lpct._2_2_) - (uint)(0x4240 < (uint)lpct),
                                                  0x4240 - (uint)lpct),(long)local_136);
              lVar17 = __aFldiv(uVar16,CONCAT22(uVar22,uVar19));
              iVar12 = (iVar10 + -4) - (int)lVar17;
              uVar22 = 0;
              uVar19 = 1000;
              uVar18 = __aFulmul(uVar18,(long)(int)ldelta);
              uVar18 = __aFldiv(uVar18,CONCAT22(uVar22,uVar19));
              if (i == 0) {
                MoveTo(hdc,iVar11,iVar12);
              }
              else {
                LineTo(hdc,iVar11,iVar12);
              }
              i = i + 1;
            }
            iVar12 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp / 2;
            SelectObject(hdc,hpenRadar);
          }
          SelectObject(hdc,HVar9);
          c = 0;
          if (((ppart->hs).wFlags_0x2 & 0xff) < 0xb) {
            ids = 0x4ef;
          }
          else {
            ids = 0x15b;
          }
        }
        if (0 < c) {
          WrapTextOut
                    (hdc,&local_134,&local_132,(char *)szWork,c,rcData.left,
                     rcData.right - rcData.left,(short *)0x0,0,1);
        }
      }
      goto switchD_10d8_5c55_default;
    }
    ExpandRc(&rcData,-4,-4);
    SelectObject(hdc,rghfontArial8[1]);
    xText = rcData.left;
    yText = rcData.top;
    SelectObject(hdc,rghfontArial8[0]);
    switch((ppart->hs).wFlags_0x2 & 0xff) {
    case 0:
      idsT = 0xd7;
      ids = 0x15d;
      break;
    case 1:
      idsT = 0xd8;
      ids = 0x15e;
      break;
    case 2:
    case 3:
      if (((ppart->hs).wFlags_0x2 & 0xff) == 2) {
        uVar19 = 0x32;
      }
      else {
        uVar19 = 100;
      }
      pcVar4 = PszGetCompressedString(idsPodIncreasesCargoCapacityShipDkt);
      c = _wsprintf(szWork,pcVar4,uVar19);
      goto RESEARCH_PrintSpecial;
    case 4:
      idsT = 0xd6;
      ids = 0x3a2;
      break;
    case 5:
    case 6:
      if (((ppart->hs).wFlags_0x2 & 0xff) == 5) {
        uVar19 = 0xfa;
      }
      else {
        uVar19 = 500;
      }
      pcVar4 = PszGetCompressedString(idsPodIncreasesFuelCapacityShipDmg);
      c = _wsprintf(szWork,pcVar4,uVar19);
      goto RESEARCH_PrintSpecial;
    case 7:
    case 8:
      if (((ppart->hs).wFlags_0x2 & 0xff) == 7) {
        uVar19 = 4;
      }
      else {
        uVar19 = 2;
      }
      pcVar4 = PszGetCompressedString(idsIncreasesSpeedBattle1DSquareMovement);
      c = _wsprintf(szWork,pcVar4,uVar19);
      goto RESEARCH_PrintSpecial;
    case 9:
      idsT = 0xd9;
      ids = 0x3a2;
      break;
    case 10:
      idsT = 0xda;
      break;
    default:
      idsT = -1;
    }
    if (idsT == -1) goto switchD_10d8_5c55_default;
    c = CchGetString(idsT,(char *)szWork);
    goto RESEARCH_PrintSpecial;
  }
  ExpandRc(&rcData,-4,-4);
  SelectObject(hdc,rghfontArial8[1]);
  xText = rcData.left;
  yText = rcData.top;
  SelectObject(hdc,rghfontArial8[0]);
  switch((ppart->hs).wFlags_0x2 & 0xff) {
  case 0:
    idsT = 0xdb;
    ids = 0x39;
    break;
  case 1:
  case 2:
  case 3:
    if (((ppart->hs).wFlags_0x2 & 0xff) == 3) {
      ids = 0x39;
      idsT = 0x55;
    }
    else if (((ppart->hs).wFlags_0x2 & 0xff) == 1) {
      idsT = 0x23;
    }
    else {
      idsT = 0x37;
    }
    sVar3 = idsT;
    pcVar4 = PszGetCompressedString(idsCloaksAnyShipReducingRangeWhichScanners);
    c = _wsprintf(szWork,pcVar4,sVar3);
    goto RESEARCH_PrintSpecial;
  case 4:
    idsT = 0xdd;
    ids = 0x3a2;
    break;
  case 5:
  case 6:
  case 7:
    idsT = 0x3a1;
    iVar5 = ((ppart->hs).wFlags_0x2 & 0xff) - 4;
    sVar3 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
    pcVar4 = PszGetCompressedString(idsModuleIncreasesAccuracyTorpedoesDIncreasesInitia);
    c = _wsprintf(szWork,pcVar4,sVar3,iVar5);
    goto RESEARCH_PrintSpecial;
  case 8:
  case 0xb:
    ids = 0x39f;
  case 9:
  case 10:
    idsT = 0x3a0;
    sVar3 = ((ARMOR *)(&ppart->u_PART_0x0004)->parmor)->dp;
    pcVar4 = PszGetCompressedString(idsHasDChanceDeflectingIncomingTorpedoesDeflected);
    c = _wsprintf(szWork,pcVar4,sVar3);
    goto RESEARCH_PrintSpecial;
  case 0xd:
    ids = 0x39a;
  case 0xc:
    if (((ppart->hs).wFlags_0x2 & 0xff) == 0xc) {
      uVar19 = 10;
    }
    else {
      uVar19 = 0x14;
    }
    pcVar4 = PszGetCompressedString(idsIncreasesDamageDoneBeamWeaponsShipD);
    c = _wsprintf(szWork,pcVar4,uVar19);
    goto RESEARCH_PrintSpecial;
  case 0xe:
    ids = 0x398;
    idsT = 0x39b;
    break;
  case 0xf:
    ids = 0x397;
    idsT = 0x39c;
    break;
  case 0x10:
    ids = 0x399;
    idsT = 0x39d;
    break;
  default:
    idsT = -1;
  }
  if (idsT != -1) {
    c = CchGetString(idsT,(char *)szWork);
RESEARCH_PrintSpecial:
    WrapTextOut
              (hdc,&xText,&yText,(char *)szWork,c,rcData.left,rcData.right - rcData.left,
               (short *)0x0,0,1);
    xText = rcData.left;
    yText = yText + dyArial8 * 2;
  }
switchD_10d8_5c55_default:
  if (ids != -1) {
    c = CchGetString(ids,(char *)szWork);
    SetRect(&local_38,4,dy + dyArial8 * -2,dx + -4,dy + -5);
    if (dyArial8 < 0xf) {
      SelectObject(hdc,rghfontArial7[0]);
    }
    else {
      SelectObject(hdc,rghfontArial6[0]);
    }
    if (l == -1) {
      uVar2 = 0x7f;
    }
    else {
      uVar2 = 0;
    }
    SetTextColor(hdc,(ulong)uVar2);
    DRAWTEXT(hdc,szWork,c,&local_38,0x810);
    if (l == -1) {
      SetTextColor(hdc,0);
    }
  }
  return;
}



// ======================================================================
// Function: ProjectedResearchSpending
// Address: 10d8:65ae
// Segment: MEMORY_RESEARCH
// ======================================================================


long ProjectedResearchSpending(long pct)

{
  PLANET *pPVar1;
  undefined2 uVar2;
  bool bVar3;
  short cBogus;
  char pctSav;
  PLANET *lpplMac;
  long lSpend;
  short cRes;
  PLANET *lppl;
  long lRes;
  
  lSpend._0_2_ = 0;
  lSpend._2_2_ = 0;
  pctSav = *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0);
  *(undefined1 *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) = (char)pct;
  lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
  lpplMac._2_2_ = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < (PLANET *)lpplMac) {
    if (((PLANET *)lppl)->iPlayer == idPlayer) {
      lRes._0_2_ = CResourcesAtPlanet(lppl,idPlayer);
      lRes._2_2_ = (int)(uint)lRes >> 0xf;
      uVar2 = (undefined2)((ulong)lppl >> 0x10);
      pPVar1 = (PLANET *)lppl;
      if (((*(int *)&pPVar1->lpplprod == 0) && (*(int *)((int)&pPVar1->lpplprod + 2) == 0)) ||
         (((PLPROD *)pPVar1->lpplprod)->iprodMac == 0)) {
        bVar3 = CARRY2((uint)lSpend,(uint)lRes);
        lSpend._0_2_ = (uint)lSpend + (uint)lRes;
        lSpend._2_2_ = lSpend._2_2_ + lRes._2_2_ + (uint)bVar3;
      }
      else {
        EstimateItemProdSched(lppl,(PLPROD *)0x0,-1,&cRes,&cBogus);
        bVar3 = CARRY2((uint)lSpend,cRes);
        lSpend._0_2_ = (uint)lSpend + cRes;
        lSpend._2_2_ = lSpend._2_2_ + (cRes >> 0xf) + (uint)bVar3;
      }
    }
    lppl = (PLANET *)lppl + 1;
  }
  *(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0) = pctSav;
  return CONCAT22(lSpend._2_2_,(uint)lSpend);
}



// ======================================================================
// Function: CostOfDevelopingItem
// Address: 10d8:66e0
// Segment: MEMORY_RESEARCH
// ======================================================================


long CostOfDevelopingItem(char *rgTech)

{
  long lVar1;
  int iVar2;
  undefined2 *puVar3;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  long lVar4;
  long lVar5;
  long lVar6;
  long lCur;
  short i;
  short fUnreachable;
  long lCost;
  char rgTechSav [6];
  char *pTech;
  long lSpent;
  
  lVar6 = CONCAT22(unaff_SI,unaff_DI);
  lVar1 = 0;
  iVar2 = idPlayer * 0xc0 + 0x59bc;
  i = 0;
  while( true ) {
    if ((5 < i) || ('\x1a' < ((char *)rgTech)[i])) break;
    i = i + 1;
  }
  if (i < 6) {
    lVar1 = -1;
  }
  else {
    for (i = 0; i < 6; i = i + 1) {
      rgTechSav[i] = *(char *)(iVar2 + i);
      if ((int)*(char *)(iVar2 + i) < (int)((char *)rgTech)[i]) {
        puVar3 = (undefined2 *)(idPlayer * 0xc0 + 0x59c2 + i * 4);
        lVar4 = CONCAT22(puVar3[1],*puVar3);
        if ((game.wCrap >> 1 & 1) != 0) {
          lVar4 = __aFlshl(lVar6,(int)((char *)rgTech)[i]);
        }
        lSpent._2_2_ = (int)((ulong)lVar4 >> 0x10);
        lSpent._0_2_ = (int)lVar4;
        lVar4 = CONCAT22(-(lSpent._2_2_ + (uint)((int)lSpent != 0)),-(int)lSpent);
        while (*(char *)(iVar2 + i) < ((char *)rgTech)[i]) {
          lVar5 = GetTechLevelCost(i,*(char *)(iVar2 + i) + 1,idPlayer);
          lVar4 = lVar5 + lVar4;
          *(char *)(iVar2 + i) = *(char *)(iVar2 + i) + '\x01';
        }
        if ((lVar4 < 0x10000) && (lVar4 < 0)) {
          lVar4 = 0;
        }
        lVar1 = lVar4 + lVar1;
      }
    }
    for (i = 0; i < 6; i = i + 1) {
      *(char *)(iVar2 + i) = rgTechSav[i];
    }
  }
  return lVar1;
}



// ======================================================================
// Function: FShouldPartBeHidden
// Address: 10d8:68c4
// Segment: MEMORY_RESEARCH
// ======================================================================


short FShouldPartBeHidden(PART *ppart)

{
  HullSlotType HVar1;
  uint uVar2;
  short sVar3;
  ushort grbitTrader;
  short iItem;
  
  if (idPlayer == -1) {
    sVar3 = 0;
  }
  else {
    grbitTrader = 0;
    uVar2 = (ppart->hs).wFlags_0x2 & 0xff;
    HVar1 = (ppart->hs).grhst;
    if (HVar1 == hstEngine) {
      if (uVar2 == 8) {
        grbitTrader = 0x200;
      }
    }
    else if (HVar1 == hstShield) {
      if (uVar2 == 6) {
        grbitTrader = 4;
      }
    }
    else if (HVar1 == hstArmor) {
      if (uVar2 == 9) {
        grbitTrader = 8;
      }
    }
    else if (HVar1 == hstBeam) {
      if (uVar2 == 0x12) {
        grbitTrader = 0x80;
      }
    }
    else if (HVar1 == hstTorp) {
      if (uVar2 == 7) {
        grbitTrader = 0x40;
      }
    }
    else if (HVar1 == hstBomb) {
      if (uVar2 == 8) {
        grbitTrader = 0x20;
      }
    }
    else if (HVar1 == hstMining) {
      if (uVar2 == 6) {
        grbitTrader = 0x10;
      }
    }
    else if (HVar1 == hstSpecialE) {
      if (uVar2 == 4) {
        grbitTrader = 2;
      }
    }
    else if (HVar1 == hstSpecialM) {
      if (uVar2 == 4) {
        grbitTrader = 1;
      }
      else if (uVar2 == 9) {
        grbitTrader = 0x800;
      }
    }
    else if (HVar1 == hstHull) {
      if (uVar2 == 0x1e) {
        grbitTrader = 0x100;
      }
    }
    else if ((HVar1 == hstPlanetary) && (uVar2 == 0xe)) {
      grbitTrader = 0x400;
    }
    if ((grbitTrader == 0) ||
       ((*(uint *)((int)&rgplr[0].grbitTrader + idPlayer * 0xc0) & grbitTrader) !=
        0)) {
      sVar3 = 0;
    }
    else {
      sVar3 = 1;
    }
  }
  return sVar3;
}



