// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: PopupWndProc
// Address: 10c0:0000
// Segment: MEMORY_POPUP
// ======================================================================


long PopupWndProc(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  undefined2 unaff_SS;
  LRESULT LVar1;
  RECT rc;
  PAINTSTRUCT ps;
  HDC hdc;
  
  if (message != WM_CREATE) {
    if (message != WM_PAINT) {
      if (message == WM_ERASEBKGND) {
        if (((GlobalPD.grPopup == 9) || (GlobalPD.grPopup == 0xb)) ||
           (GlobalPD.grPopup == 0xe)) {
          GetClientRect(hwnd,(RECT *)&rc);
          FillRect(wParam,(RECT *)&rc,hbrButtonFace);
          return 1;
        }
      }
      else if ((message == WM_LBUTTONUP) || (message == WM_RBUTTONUP)) {
        if (hwndPopup == 0) {
          return 0;
        }
        DestroyWindow(hwndPopup);
        hwndPopup = 0;
        GlobalPD.grPopup = 0;
        ReleaseCapture();
        if (((uint)gd._0_2_ >> 0xb & 1) == 0) {
          return 0;
        }
        tutor.wFlags = tutor.wFlags & 0xfbffU | 0x400;
        AdvanceTutor();
        return 0;
      }
      LVar1 = DefWindowProc(hwnd,message,wParam,lParam);
      return LVar1;
    }
    hdc = BeginPaint(hwnd,(PAINTSTRUCT *)&ps);
    DrawPopup(hwnd,hdc);
    EndPaint(hwnd,(PAINTSTRUCT *)&ps);
  }
  return 0;
}



// ======================================================================
// Function: FIsPopupHullType
// Address: 10c0:0148
// Segment: MEMORY_POPUP
// ======================================================================


short FIsPopupHullType(short ishdef)

{
  uint uVar1;
  int iVar2;
  HULDEF *pHVar3;
  ushort imd;
  
  if ((GlobalPD.iPlanMax == 0) || (GlobalPD.iPlanMax == 0xff)) {
    uVar1 = 1;
  }
  else {
    iVar2 = *(int *)(GlobalPD._2_2_ + 2) * 4;
    pHVar3 = LphuldefFromId(*(HullDef *)(*(int *)(iVar2 + 0xfe) + ishdef * 0x93));
    uVar1 = *(uint *)(((uint)((HULDEF *)pHVar3)->wFlags >> 10 & 0xf) * 2 + 0x138) &
            GlobalPD.iPlanMax;
  }
  return uVar1;
}



// ======================================================================
// Function: DrawPopup
// Address: 10c0:01c0
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c002d5) */
/* WARNING: Removing unreachable block (ram,0x10c00457) */

void DrawPopup(HWND hwnd,HDC hdc)

{
  StringId ids;
  int iVar1;
  char *pcVar2;
  ushort uVar3;
  ushort unaff_SI;
  uint unaff_DI;
  undefined2 unaff_SS;
  long lVar4;
  ulong uVar5;
  DWORD DVar6;
  undefined2 uVar7;
  HDC HVar8;
  short sVar9;
  short sVar10;
  undefined2 uVar11;
  short dpT;
  short csh;
  RECT rc;
  COLORREF crFore;
  short dx;
  char *psz;
  HFONT hfontSav;
  short bkMode;
  short c;
  short i;
  short yCur;
  char szT [80];
  COLORREF crBack;
  
  crBack = SetBkColor(hdc,0xffffff);
  crFore = SetTextColor(hdc,0);
  bkMode = SetBkMode(hdc,2);
  hfontSav = SelectObject(hdc,rghfontArial8[1]);
  GetClientRect(hwnd,(RECT *)&rc);
  switch(GlobalPD.grPopup) {
  case 1:
    sVar9 = 0;
    lVar4 = __aFlshl((ulong)unaff_DI << 0x10,unaff_SI);
    CtrTextOut(hdc,rc.right >> 1,4,(char *)*(undefined2 *)((int)lVar4 + 0x4cc),sVar9);
    SelectObject(hdc,rghfontArial8[0]);
    pcVar2 = PszGetCompressedString(idsMineralConcentration);
    uVar7 = 0x1120;
    HVar8 = hdc;
    psz = pcVar2;
    uVar3 = _strlen(pcVar2);
    DVar6 = GetTextExtent(HVar8,(LPCSTR)CONCAT22(uVar7,pcVar2),uVar3);
    dx = (int)DVar6 + 4;
    sVar10 = 0;
    sVar9 = 0;
    pcVar2 = PszGetCompressedString(idsSurface);
    RightTextOut(hdc,dx,dyArial8 + 4,pcVar2,sVar9,sVar10);
    if (GlobalPD.iPlrVal < 0) {
      pcVar2 = PszGetCompressedString(idsUnknown2);
      _strcpy((char *)szWork,pcVar2);
      c = _strlen((char *)szWork);
    }
    else {
      c = wsprintf(szWork,(char *)0x11200bee,GlobalPD.iPlanMax,
                   GlobalPD.iPlrVal);
    }
    TextOut(hdc,dx,dyArial8 + 4,szWork,c);
    sVar10 = 0;
    sVar9 = 0;
    pcVar2 = PszGetCompressedString(idsMineralConcentration);
    RightTextOut(hdc,dx,dyArial8 * 2 + 4,pcVar2,sVar9,sVar10);
    if ((GlobalPD.iPlrMax < 0) ||
       ((GlobalPD.iPlrMax < 1 && (GlobalPD.iPlrMin == 0)))) {
      pcVar2 = PszGetCompressedString(idsUnknown2);
      c = wsprintf(szWork,(char *)pcVar2);
    }
    else {
      c = wsprintf(szWork,(char *)PCTLD,GlobalPD.iPlrMin,
                   GlobalPD.iPlrMax);
      if ((GlobalPD.iPlanVal != 0) || (GlobalPD.iPlanMin != 0)) {
        if ((GlobalPD.iPlrMax < 0) ||
           ((GlobalPD.iPlrMax < 1 && ((uint)GlobalPD.iPlrMin < 0x1e)))) {
          ids = idsN30;
        }
        else {
          ids = idsHw;
        }
        pcVar2 = PszGetCompressedString(ids);
        sVar9 = wsprintf((char *)((char *)szWork + c),(char *)pcVar2);
        c = c + sVar9;
      }
    }
    TextOut(hdc,dx,dyArial8 * 2 + 4,szWork,c);
    if (-1 < (int)GlobalPD._20_2_) {
      sVar10 = 0;
      sVar9 = 0;
      pcVar2 = PszGetCompressedString(idsMiningRate);
      RightTextOut(hdc,dx,dyArial8 * 3 + 4,pcVar2,sVar9,sVar10);
      CchGetString(idsLdktYr,szT);
      c = wsprintf(szWork,(char *)szT,GlobalPD._18_2_,GlobalPD._20_2_);
      TextOut(hdc,dx,dyArial8 * 3 + 4,szWork,c);
    }
    break;
  case 2:
    sVar9 = 0;
    pcVar2 = PszPlayerName(GlobalPD._2_2_,1,1,1,0,(PLAYER *)0x0);
    CtrTextOut(hdc,rc.right >> 1,4,pcVar2,sVar9);
    iVar1 = GlobalPD._2_2_ + 1;
    pcVar2 = PszGetCompressedString(idsPlayerD);
    c = wsprintf(szWork,(char *)pcVar2,iVar1);
    CtrTextOut(hdc,rc.right >> 1,dyArial8 + 4,(char *)szWork,c);
    break;
  case 3:
    if (rc.bottom - rc.top < dyArial8 * 2) {
      c = CchGetString(idsNone2,(char *)szWork);
      TextOut(hdc,4,4,szWork,c);
      SelectObject(hdc,rghfontArial8[0]);
    }
    else {
      SelectObject(hdc,rghfontArial8[1]);
      c = CchGetString(idsShipName,(char *)szWork);
      TextOut(hdc,4,4,szWork,c);
      RightTextOut(hdc,(rc.right + -4) - GlobalPD.iPlanMin,4,(char *)0xbf4,1,0);
      if (GlobalPD.iPlanMin != 0) {
        c = CchGetString(idsDamage2,(char *)szWork);
        RightTextOut(hdc,rc.right + -4,4,(char *)szWork,c,0);
        PatBlt(hdc,4,dyArial8 + 2,rc.right + -8,1,0x42);
      }
      SelectObject(hdc,rghfontArial8[0]);
      yCur = dyArial8 + 4;
      for (i = 0; i < 0x10; i = i + 1) {
        if (0 < *(int *)(GlobalPD._2_2_ + 0xc + i * 2)) {
          if (GlobalPD.iPlanMax != 0) {
            sVar9 = FIsPopupHullType(i);
            if (sVar9 == 0) goto LAB_10c0_08cd;
          }
          if (GlobalPD.iPlanVal != 0) {
            if (*(int *)(GlobalPD._2_2_ + 0x2c + i * 2) == 0) {
              SetTextColor(hdc,0);
            }
            else {
              SetTextColor(hdc,0xff);
            }
          }
          DecorateHullName(*(uint *)GlobalPD._2_4_ >> 9 & 0xf,i,&stack0xff5e);
          pcVar2 = &stack0xff5e;
          sVar10 = 4;
          uVar7 = unaff_SS;
          sVar9 = yCur;
          HVar8 = hdc;
          uVar3 = __fstrlen((char *)pcVar2);
          TextOut(HVar8,sVar10,sVar9,(LPCSTR)CONCAT22(uVar7,pcVar2),uVar3);
          c = wsprintf(szWork,(char *)PCTD,
                       *(undefined2 *)(GlobalPD._2_2_ + 0xc + i * 2));
          RightTextOut
                    (hdc,(rc.right + -4) - GlobalPD.iPlanMin,yCur,(char *)szWork,c,
                     0);
          if (GlobalPD.iPlanVal != 0) {
            if (*(int *)(GlobalPD._2_2_ + 0x2c + i * 2) != 0) {
              uVar11 = 0;
              uVar7 = 100;
              uVar5 = __aFulmul((ulong)(*(uint *)(GlobalPD._2_2_ + 0x2c + i * 2) &
                                               0x7f),
                                        (long)*(int *)(GlobalPD._2_2_ + 0xc + i * 2));
              __aFldiv(uVar5,CONCAT22(uVar11,uVar7));
              c = wsprintf(szWork,(char *)0x11200bf6);
              RightTextOut(hdc,rc.right + -4,yCur,(char *)szWork,c,0);
            }
          }
          yCur = yCur + dyArial8;
        }
LAB_10c0_08cd:
      }
      if (GlobalPD.iPlanVal != 0) {
        SetTextColor(hdc,0);
      }
    }
    break;
  case 4:
    pcVar2 = PszGetCompressedString(idsPlanet);
    uVar7 = 0x1120;
    HVar8 = hdc;
    psz = pcVar2;
    uVar3 = _strlen(pcVar2);
    DVar6 = GetTextExtent(HVar8,(LPCSTR)CONCAT22(uVar7,pcVar2),uVar3);
    dx = (int)DVar6 + 4;
    SelectObject(hdc,rghfontArial8[1]);
    sVar9 = 0;
    uVar3 = _strlen(psz);
    RightTextOut(hdc,dx,4,psz,uVar3,sVar9);
    sVar10 = 0;
    sVar9 = 0;
    pcVar2 = PszGetCompressedString(idsId);
    RightTextOut(hdc,dx,dyArial8 + 4,pcVar2,sVar9,sVar10);
    sVar10 = 0;
    sVar9 = 0;
    pcVar2 = PszGetCompressedString(idsX);
    RightTextOut(hdc,dx,dyArial8 * 2 + 4,pcVar2,sVar9,sVar10);
    sVar10 = 0;
    sVar9 = 0;
    pcVar2 = PszGetCompressedString(idsY);
    RightTextOut(hdc,dx,dyArial8 * 3 + 4,pcVar2,sVar9,sVar10);
    psz = PszGetPlanetName(sel.scan.idpl);
    SelectObject(hdc,rghfontArial8[0]);
    sVar10 = 4;
    uVar7 = 0x1120;
    pcVar2 = psz;
    sVar9 = dx;
    HVar8 = hdc;
    uVar3 = _strlen(psz);
    TextOut(HVar8,sVar9,sVar10,(LPCSTR)CONCAT22(uVar7,pcVar2),uVar3);
    c = wsprintf(szWork,(char *)PCTD,sel.scan.idpl + 1);
    TextOut(hdc,dx,dyArial8 + 4,szWork,c);
    c = wsprintf(szWork,(char *)PCTD);
    TextOut(hdc,dx,dyArial8 * 2 + 4,szWork,c);
    c = wsprintf(szWork,(char *)PCTD);
    TextOut(hdc,dx,dyArial8 * 3 + 4,szWork,c);
    break;
  case 5:
    PtDisplayPlanetStateInfo(hdc,1);
    break;
  case 6:
    PtDisplayZipOrdInfo(hdc,rc.right >> 1,1);
    break;
  case 7:
    PtDisplayPlanetPopInfo(hdc,1);
    break;
  case 8:
    PtDisplayFactoryMineInfo(hdc,rc.right,1);
    break;
  case 9:
    DisplayComponentInfo(hdc,rc.right,rc.bottom,(PART *)&GlobalPD.field1_0x2);
    break;
  case 10:
    PtDisplayString(hdc,rc.right,1);
    break;
  case 0xb:
  case 0xe:
    fStarbaseMode = (short)(0x1f < *(int *)GlobalPD._2_4_);
    DrawSlotDlg(hwnd,hdc,&rc,-1);
    rc.top = dyArial8 + 0x132;
    rc.left = rc.left + 6;
    SelectObject(hdc,rghfontArial8[1]);
    SetBkMode(hdc,1);
    __fstrcpy(szWork,
                      (char *)CONCAT22(GlobalPD.psz,(char *)(GlobalPD._2_2_ + 8)));
    CtrTextOut(hdc,(rc.right + -0x4c >> 1) + 0x4c,6,(char *)szWork,0);
    DrawBuildSelHull(hwnd,hdc,-1,&rc);
    break;
  case 0xc:
    PtDisplayResourceInfo(hdc,rc.right,1);
    break;
  default:
  }
  SelectObject(hdc,hfontSav);
  SetBkMode(hdc,bkMode);
  SetTextColor(hdc,crFore);
  SetBkColor(hdc,crBack);
  return;
}



// ======================================================================
// Function: Popup
// Address: 10c0:0c7c
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c00d16) */
/* WARNING: Variable defined which should be unmapped: dxCoord */

void Popup(HWND hwnd,short x,short y)

{
  HGDIOBJ HVar1;
  char *pcVar2;
  ushort uVar3;
  int iVar4;
  short sVar5;
  uint uVar6;
  undefined2 unaff_SS;
  DWORD DVar7;
  DWORD DVar8;
  POINT PVar9;
  LPCSTR pcVar10;
  ulong uVar11;
  HDC HVar12;
  short dxR;
  short dxCoord;
  short dxL;
  short dx2;
  int ptT;
  int local_18;
  short dx;
  HFONT hfontSav;
  short c;
  short i;
  short dy;
  POINT pt;
  HDC hdc;
  
  pt.x = x;
  pt.y = y;
  ClientToScreen(hwnd,(POINT *)&pt);
  hdc = GetDC(hwnd);
  HVar1 = SelectObject(hdc,rghfontArial8[0]);
  switch(GlobalPD.grPopup) {
  case 1:
    pcVar2 = PszGetCompressedString(idsMineralConcentration0000000kt);
    pcVar10 = (LPCSTR)pcVar2;
    HVar12 = hdc;
    uVar3 = _strlen(pcVar2);
    DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
    dx = (int)DVar7 + 8;
    dy = dyArial8 * 3 + 8;
    if (-1 < (int)GlobalPD._20_2_) {
      dy = dy + dyArial8;
    }
    break;
  case 2:
    SelectObject(hdc,rghfontArial8[1]);
    pcVar2 = PszPlayerName(GlobalPD._2_2_,1,1,1,0,(PLAYER *)0x0);
    pcVar10 = (LPCSTR)pcVar2;
    HVar12 = hdc;
    uVar3 = _strlen(pcVar2);
    DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
    iVar4 = (int)DVar7 + 8;
    DVar7 = GetTextExtent(hdc,s_Player__16_1120_0bfe,10);
    dx = (int)DVar7 + 8;
    if (dx <= iVar4) {
      dx = iVar4;
    }
    dy = dyArial8 * 2 + 8;
    break;
  case 3:
    dxR = 0;
    dx2 = 0;
    dy = dyArial8 + 8;
    SelectObject(hdc,rghfontArial8[1]);
    pcVar2 = PszGetCompressedString(idsShipName);
    pcVar10 = (LPCSTR)pcVar2;
    HVar12 = hdc;
    uVar3 = _strlen(pcVar2);
    DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
    dxL = (short)DVar7;
    SelectObject(hdc,rghfontArial8[0]);
    for (i = 0; i < 0x10; i = i + 1) {
      if ((0 < *(int *)(GlobalPD._2_2_ + 0xc + i * 2)) &&
         ((GlobalPD.iPlanMax == 0 || (sVar5 = FIsPopupHullType(i), sVar5 != 0)))) {
        dy = dy + dyArial8;
        uVar11 = CONCAT22(i,*(uint *)GlobalPD._2_4_ >> 9) & 0xffff000f;
        DecorateHullName((short)uVar11,(short)(uVar11 >> 0x10),&stack0xffb2);
        pcVar10 = (LPCSTR)&stack0xffb2;
        HVar12 = hdc;
        uVar3 = __fstrlen((char *)&stack0xffb2);
        DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
        if (dxL <= (int)DVar7) {
          dxL = (int)DVar7;
        }
        sVar5 = wsprintf(szWork,(char *)PCTD,
                         *(undefined2 *)(GlobalPD._2_2_ + 0xc + i * 2));
        DVar7 = GetTextExtent(hdc,szWork,sVar5);
        if (dxR <= (int)DVar7) {
          dxR = (int)DVar7;
        }
        if (GlobalPD.iPlanVal != 0) {
          if ((*(uint *)(GlobalPD._2_2_ + 0x2c + i * 2) >> 7 != 0) && (dx2 == 0)) {
            pcVar2 = PszGetCompressedString(idsN9999999);
            pcVar10 = (LPCSTR)pcVar2;
            HVar12 = hdc;
            uVar3 = _strlen(pcVar2);
            DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
            dx2 = (int)DVar7 + 4;
          }
        }
      }
    }
    if (dy == dyArial8 + 8) {
      pcVar2 = PszGetCompressedString(idsShipName);
      pcVar10 = (LPCSTR)pcVar2;
      HVar12 = hdc;
      uVar3 = _strlen(pcVar2);
      DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
      dxL = (short)DVar7;
    }
    GlobalPD.iPlanMin = dx2;
    dx = dxL + dxR + 0x10 + dx2;
    break;
  case 4:
    SelectObject(hdc,rghfontArial8[1]);
    dy = dyArial8 * 4 + 8;
    pcVar2 = PszGetCompressedString(idsPlanet);
    pcVar10 = (LPCSTR)pcVar2;
    HVar12 = hdc;
    uVar3 = _strlen(pcVar2);
    DVar7 = GetTextExtent(HVar12,pcVar10,uVar3);
    pcVar2 = PszGetPlanetName(sel.scan.idpl);
    SelectObject(hdc,rghfontArial8[0]);
    pcVar10 = (LPCSTR)pcVar2;
    HVar12 = hdc;
    uVar3 = _strlen(pcVar2);
    DVar8 = GetTextExtent(HVar12,pcVar10,uVar3);
    iVar4 = (int)DVar8;
    HVar12 = hdc;
    pcVar2 = PszGetCompressedString(idsN9999);
    DVar8 = GetTextExtent(HVar12,(LPCSTR)pcVar2,4);
    if (iVar4 <= (int)DVar8) {
      iVar4 = (int)DVar8;
    }
    dx = (int)DVar7 + 8 + iVar4;
    break;
  case 5:
    PVar9 = PtDisplayPlanetStateInfo(hdc,0);
    goto POPUP_SetDxDy;
  case 6:
    PVar9 = PtDisplayZipOrdInfo(hdc,0,0);
    goto POPUP_SetDxDy;
  case 7:
    PVar9 = PtDisplayPlanetPopInfo(hdc,0);
    goto POPUP_SetDxDy;
  case 8:
    PVar9 = PtDisplayFactoryMineInfo(hdc,200,0);
    goto POPUP_SetDxDy;
  case 9:
    if (dyArial8 < 0xf) {
      iVar4 = 0;
    }
    else {
      iVar4 = 0x28;
    }
    dx = iVar4 + 0x158;
    dy = dyArial10 + dyArial8 * 0xc + 0x4e;
    break;
  case 10:
    PVar9 = PtDisplayString(hdc,GlobalPD._2_2_,0);
    goto POPUP_SetDxDy;
  case 0xb:
  case 0xe:
    mdBuild = (short)(GlobalPD.grPopup != 0xb);
    lpshdefBuild._0_2_ = (SHDEF *)GlobalPD._2_2_;
    lpshdefBuild._2_2_ = GlobalPD.psz;
    UpdateSlotGlobals();
    dx = 0x154;
    dy = dyArial8 * 7 + 0x13a;
    if (((uint)gd._0_2_ >> 0xe != 0) && (GlobalPD.grPopup == 0xb)) {
      dy = dy + dyArial8 * 3;
    }
    break;
  case 0xc:
    PVar9 = PtDisplayResourceInfo(hdc,200,0);
POPUP_SetDxDy:
    local_18 = PVar9.y;
    ptT = PVar9.x;
    dx = ptT + 2;
    dy = local_18 + 2;
    break;
  case 0xd:
    dx = 0x78;
    dy = 0x50;
  }
  SelectObject(hdc,HVar1);
  ReleaseDC(hwnd,hdc);
  pt.x = pt.x - dx;
  pt.y = pt.y - dy;
  sVar5 = GetSystemMetrics(0);
  uVar6 = pt.x;
  if (sVar5 - dx <= pt.x) {
    sVar5 = GetSystemMetrics(0);
    uVar6 = sVar5 - dx;
  }
  if (uVar6 < 0x8000) {
    sVar5 = GetSystemMetrics(0);
    if (sVar5 - dx <= pt.x) {
      sVar5 = GetSystemMetrics(0);
      pt.x = sVar5 - dx;
    }
  }
  else {
    pt.x = 0;
  }
  sVar5 = GetSystemMetrics(1);
  uVar6 = pt.y;
  if (sVar5 - dy <= pt.y) {
    sVar5 = GetSystemMetrics(1);
    uVar6 = sVar5 - dy;
  }
  if (uVar6 < 0x8000) {
    sVar5 = GetSystemMetrics(1);
    if (sVar5 - dy <= pt.y) {
      sVar5 = GetSystemMetrics(1);
      pt.y = sVar5 - dy;
    }
  }
  else {
    pt.y = 0;
  }
  hwndPopup =
       CreateWindow(szPopup,(LPCSTR)0x0,0x90800000,pt.x,pt.y,dx,dy,hwnd,0,hInst,
                    (void *)0x0);
  SendMessage(hwndPopup,0x30,rghfontArial8[0],0);
  SetCapture(hwndPopup);
  return;
}



// ======================================================================
// Function: PopupMenu
// Address: 10c0:136c
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c01498) */
/* WARNING: Removing unreachable block (ram,0x10c0141e) */
/* WARNING: Removing unreachable block (ram,0x10c0144f) */
/* WARNING: Removing unreachable block (ram,0x10c014e1) */

short PopupMenu(HWND hwnd,short x,short y,short cString,long *rgids,char **rgsz,short iChecked,
                short fRightBtn)

{
  char *pcVar1;
  char cVar2;
  uint uVar3;
  int iVar4;
  UINT UVar5;
  BOOL BVar6;
  int iVar7;
  undefined2 unaff_SS;
  char *psz;
  short fCheckedCur;
  short fChecked;
  undefined2 msg [2];
  uint local_a4;
  char *psz__150;
  char *pszT;
  HMENU hmenuPopup;
  HMENU hmenuSub;
  char szTemp [128];
  short i;
  POINT pt;
  short tpm;
  char *pszTitle;
  
  hmenuSub = 0;
  pt.x = x;
  pt.y = y;
  ClientToScreen(hwnd,(POINT *)&pt);
  hmenuPopup = CreatePopupMenu();
  iPopMenuSel = -1;
  for (i = 0; i < cString; i = i + 1) {
    if ((rgids == (long *)0x0) || ((iChecked == -2 && (rgsz != (char **)0x0)))) {
      if (rgsz[i] == (char *)0x0) {
        pszTitle = rgsz[i + 1];
        if (rgids == (long *)0x0) {
          fChecked = 0;
        }
        else {
          fChecked = (short)rgids[i + 1];
        }
        hmenuSub = CreatePopupMenu();
        for (i = i + 2; (i < cString && (rgsz[i] != (char *)0x0)); i = i + 1) {
          if (rgids == (long *)0x0) {
            fCheckedCur = (short)(i == iChecked);
            fChecked = fChecked | fCheckedCur;
          }
          else {
            fCheckedCur = (short)rgids[i];
          }
          if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
            AppendMenu(hmenuSub,0x800,0,(LPCSTR)0x0);
          }
          else {
            psz = rgsz[i];
            pcVar1 = szTemp;
            while (pszT = pcVar1, *psz != '\0') {
              pcVar1 = psz + 1;
              cVar2 = *psz;
              *pszT = cVar2;
              psz = pcVar1;
              pcVar1 = pszT + 1;
              if (cVar2 == '&') {
                pszT[1] = '&';
                pcVar1 = pszT + 2;
              }
            }
            *pszT = '\0';
            if (fCheckedCur == 0) {
              UVar5 = 0;
            }
            else {
              UVar5 = 8;
            }
            AppendMenu(hmenuSub,UVar5,i + 15000,(LPCSTR)szTemp);
          }
        }
        if (fChecked == 0) {
          uVar3 = 0;
        }
        else {
          uVar3 = 8;
        }
        AppendMenu(hmenuPopup,uVar3 | 0x10,hmenuSub,(LPCSTR)pszTitle);
      }
      else if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
        AppendMenu(hmenuPopup,0x800,0,(LPCSTR)0x0);
      }
      else {
        psz__150 = rgsz[i];
        pcVar1 = szTemp;
        while (pszT = pcVar1, *psz__150 != '\0') {
          pcVar1 = psz__150 + 1;
          cVar2 = *psz__150;
          *pszT = cVar2;
          psz__150 = pcVar1;
          pcVar1 = pszT + 1;
          if (cVar2 == '&') {
            pszT[1] = '&';
            pcVar1 = pszT + 2;
          }
        }
        *pszT = '\0';
        if (iChecked == -2) {
          iVar4 = (int)rgids[i];
          iVar7 = *(int *)((int)(rgids + i) + 2);
        }
        else if (i == iChecked) {
          iVar4 = 1;
          iVar7 = 0;
        }
        else {
          iVar4 = 0;
          iVar7 = 0;
        }
        if ((iVar4 == 0) && (iVar7 == 0)) {
          UVar5 = 0;
        }
        else {
          UVar5 = 8;
        }
        AppendMenu(hmenuPopup,UVar5,i + 15000,(LPCSTR)szTemp);
      }
    }
    else if (((int)rgids[i] == -1) && (*(int *)((int)(rgids + i) + 2) == -1)) {
      AppendMenu(hmenuPopup,0x800,0,(LPCSTR)0x0);
    }
    else {
      if ((*(uint *)((int)rgids + i * 4 + 2) & 0x1000) == 0) {
        if ((*(uint *)((int)rgids + i * 4 + 2) & 0x4000) == 0) {
          if ((*(uint *)((int)rgids + i * 4 + 2) & 0x2000) == 0) {
            if ((*(uint *)((int)rgids + i * 4 + 2) & 0x8000) == 0) {
              psz__150 = PszGetPlanetName((short)rgids[i]);
            }
            else {
              psz__150 = PszGetFleetName(*(uint *)(rgids + i) | 0x8000);
            }
          }
          else {
            psz__150 = PszGetThingName((short)rgids[i]);
          }
        }
        else {
          psz__150 = PszGetCompressedString(*(StringId *)(rgids + i));
        }
      }
      else {
        psz__150 = (char *)s_Deep_Space_1120_0c09;
      }
      pcVar1 = szTemp;
      while (pszT = pcVar1, *psz__150 != '\0') {
        pcVar1 = psz__150 + 1;
        cVar2 = *psz__150;
        *pszT = cVar2;
        psz__150 = pcVar1;
        pcVar1 = pszT + 1;
        if (cVar2 == '&') {
          pszT[1] = '&';
          pcVar1 = pszT + 2;
        }
      }
      *pszT = '\0';
      if (i == iChecked) {
        UVar5 = 8;
      }
      else {
        UVar5 = 0;
      }
      AppendMenu(hmenuPopup,UVar5,i + 15000,(LPCSTR)szTemp);
    }
  }
  if (fRightBtn == 0) {
    tpm = 0;
  }
  else {
    tpm = 2;
  }
  TrackPopupMenu(hmenuPopup,tpm,pt.x,pt.y,0,hwndFrame,(RECT *)0x0);
  DestroyMenu(hmenuPopup);
  if (hmenuSub != 0) {
    DestroyMenu(hmenuSub);
  }
  BVar6 = PeekMessage((undefined2 *)msg,hwndFrame,0x111,0x111,2);
  if (((BVar6 != 0) && (14999 < local_a4)) && (local_a4 < 0x3afc)) {
    iPopMenuSel = local_a4 + 0xc568;
  }
  return iPopMenuSel;
}



// ======================================================================
// Function: PtDisplayPlanetStateInfo
// Address: 10c0:1938
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayPlanetStateInfo(HDC hdc,short fPrint)

{
  char cVar1;
  char *pcVar2;
  PLANET *pPVar3;
  short sVar4;
  int iVar5;
  short sVar6;
  undefined2 uVar7;
  undefined2 unaff_SS;
  PLANET *lppl;
  POINT PVar8;
  short sVar9;
  short sVar10;
  short *psVar11;
  short iValSav;
  short pctDesire;
  short pctDesireOld;
  short dChg;
  short iNewVal;
  short x;
  short cch;
  short xMax;
  short y;
  
  y = 4;
  xMax = 4;
  x = 4;
  SelectObject(hdc,rghfontArial8[1]);
  DxStreamTextOut
            (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
  SelectObject(hdc,rghfontArial8[0]);
  sVar4 = 0;
  sVar6 = fPrint;
  pcVar2 = PszGetCompressedString(idsCurrently);
  DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
  SelectObject(hdc,rghfontArial8[1]);
  if (GlobalPD.iPlanVal < 0) {
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsUnknown2);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
  }
  else {
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlanVal);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
  }
  SelectObject(hdc,rghfontArial8[0]);
  DxStreamTextOut(hdc,&x,y,(char *)0xc14,1,fPrint);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if (GlobalPD.iPlrMin == -1) {
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsColonistsImmune);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsEffects);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
    DxStreamTextOut(hdc,&x,y,(char *)0xc16,1,fPrint);
  }
  else {
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsColonistsPreferPlanetsWhere);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsBetween);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlrMin);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsAnd);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlrMax);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc18,1,fPrint);
  }
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if ((uint)GlobalPD.iPlanMin < 0x8000) {
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsCurrentlyPossessTechnology);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsModify);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsOn2);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsWithinRange);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlanMin);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsTo);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar6 = fPrint;
    pcVar2 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlanMax);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar4,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc1a,1,fPrint);
    if (xMax < x) {
      xMax = x;
    }
    y = y + dyArial8;
  }
  x = 4;
  if ((((uint)GlobalPD.iPlanMin < 0x8000) && (GlobalPD.iPlrMin != -1)) &&
     (GlobalPD.iPlanVal != GlobalPD.iPlrVal)) {
    iNewVal = -1;
    if (GlobalPD.iPlanVal < GlobalPD.iPlrVal) {
      if ((GlobalPD.iPlanVal < GlobalPD.iPlanMax) &&
         (iNewVal = GlobalPD.iPlrVal, GlobalPD.iPlanMax <= GlobalPD.iPlrVal)) {
        iNewVal = GlobalPD.iPlanMax;
      }
    }
    else if ((GlobalPD.iPlanMin < GlobalPD.iPlanVal) &&
            (iNewVal = GlobalPD.iPlrVal, GlobalPD.iPlrVal <= GlobalPD.iPlanMin)
            ) {
      iNewVal = GlobalPD.iPlanMin;
    }
    if (iNewVal != -1) {
      lppl = LpplFromId(GlobalPD._2_2_);
      uVar7 = (undefined2)((ulong)lppl >> 0x10);
      pPVar3 = (PLANET *)lppl;
      sVar6 = PctPlanetDesirability(lppl,idPlayer);
      cVar1 = pPVar3->rgEnvVar[(int)GlobalPD.psz];
      pPVar3->rgEnvVar[(int)GlobalPD.psz] = (char)iNewVal;
      sVar4 = PctPlanetDesirability(lppl,idPlayer);
      pPVar3->rgEnvVar[(int)GlobalPD.psz] = cVar1;
      if (sVar6 < sVar4) {
        cch = CchGetString(idsIfTerraform,(char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[1]);
        WrapTextOut
                  (hdc,&x,&y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,4,
                   xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[0]);
        psVar11 = (short *)0x0;
        iVar5 = xMax + -4;
        sVar10 = 4;
        sVar9 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetCompressedString(idsTo);
        WrapTextOut
                  (hdc,&x,&y,pcVar2,sVar9,sVar10,iVar5,(short *)psVar11,
                   (short)((ulong)psVar11 >> 0x10),sVar6);
        SelectObject(hdc,rghfontArial8[1]);
        psVar11 = (short *)0x0;
        iVar5 = xMax + -4;
        sVar10 = 4;
        sVar9 = 0;
        sVar6 = fPrint;
        pcVar2 = PszCalcEnvVar((short)GlobalPD.psz,iNewVal);
        WrapTextOut
                  (hdc,&x,&y,pcVar2,sVar9,sVar10,iVar5,(short *)psVar11,
                   (short)((ulong)psVar11 >> 0x10),sVar6);
        SelectObject(hdc,rghfontArial8[0]);
        cch = CchGetString(idsPlanetsValueWouldImprove,(char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[1]);
        cch = wsprintf(szWork,(char *)0x11200c1c,sVar4);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
      }
    }
  }
  if (((GlobalPD.iPlrMin != -1) && (GlobalPD.iPlanVal != GlobalPD.iPlrVal)) &&
     (GlobalPD.iPlanVal != -1)) {
    if (GlobalPD.iPlanVal < GlobalPD.iPlrMin) {
      dChg = GlobalPD.iPlrMin - GlobalPD.iPlanVal;
    }
    else if (GlobalPD.iPlrMax < GlobalPD.iPlanVal) {
      dChg = GlobalPD.iPlanVal - GlobalPD.iPlrMax;
    }
    else {
      sVar6 = _abs(GlobalPD.iPlanVal - GlobalPD.iPlrVal);
      dChg = -sVar6;
    }
    if (dChg < 0) {
      iNewVal = 0x169;
    }
    else {
      iNewVal = 0x168;
    }
    CchGetString(iNewVal,(char *)szWork);
    cch = wsprintf((char *)&stack0xff92,szWork);
    SelectObject(hdc,rghfontArial8[0]);
    WrapTextOut(hdc,&x,&y,&stack0xff92,cch,4,xMax + -4,(short *)0x0,0,fPrint);
  }
  if (4 < x) {
    y = y + dyArial8;
  }
  PVar8.x = xMax + 4;
  PVar8.y = y + 4;
  return PVar8;
}



// ======================================================================
// Function: PtDisplayPlanetPopInfo
// Address: 10c0:228e
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Variable defined which should be unmapped: x */
/* WARNING: Variable defined which should be unmapped: pctDesire */
/* WARNING: Removing unreachable block (ram,0x10c02aa4) */
/* WARNING: Removing unreachable block (ram,0x10c027b6) */
/* WARNING: Removing unreachable block (ram,0x10c028dd) */
/* WARNING: Removing unreachable block (ram,0x10c02b7d) */

POINT PtDisplayPlanetPopInfo(HDC hdc,short fPrint)

{
  long lVar1;
  char *pcVar2;
  undefined2 unaff_SS;
  long lVar3;
  POINT PVar4;
  short sVar5;
  short sVar6;
  short x;
  short pctDesire;
  undefined4 lMax;
  char *psz;
  short c;
  short xMax;
  short y;
  char szT [150];
  PLANET pl;
  
  y = 4;
  xMax = 4;
  x = 4;
  FLookupPlanet(GlobalPD._2_2_,&pl);
  SelectObject(hdc,rghfontArial8[0]);
  if (pl.iPlayer == idPlayer) {
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsPopulation3);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsIs);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    wsprintf(szWork,(char *)PCTLD00,(int)pl.rgwtMin[3],pl.rgwtMin[3]._2_2_);
    if (((int)pl.rgwtMin[3] == 0) && (pl.rgwtMin[3]._2_2_ == 0)) {
      szWork[1] = '\0';
    }
    pctDesire = fPrint;
    x = 0;
    DxStreamTextOut(hdc,&x,y,(char *)szWork,0,fPrint);
    pctDesire = hdc;
    x = rghfontArial8[0];
    SelectObject(hdc,rghfontArial8[0]);
    pctDesire = fPrint;
    x = 1;
    DxStreamTextOut(hdc,&x,y,(char *)0xc24,1,fPrint);
  }
  else if (pl.iPlayer == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsUninhabited2);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
  }
  else {
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetCompressedString(idsEnemyPopulation);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    SelectObject(hdc,rghfontArial8[1]);
    sVar5 = 0;
    sVar6 = fPrint;
    pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    SelectObject(hdc,rghfontArial8[0]);
    if ((pl.wFlags & 0xffU) < 3) {
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsUnknown);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
    }
    else {
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsApproximately);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[1]);
      wsprintf(szWork,(char *)0x11200c26,(pl.uGuesses & 0xfffU) << 2);
      if ((pl.uGuesses & 0xfffU) == 0) {
        szWork[1] = '\0';
      }
      pctDesire = fPrint;
      x = 0;
      DxStreamTextOut(hdc,&x,y,(char *)szWork,0,fPrint);
      pctDesire = hdc;
      x = rghfontArial8[0];
      SelectObject(hdc,rghfontArial8[0]);
    }
    DxStreamTextOut(hdc,&x,y,(char *)0xc2b,1,fPrint);
  }
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if (2 < (pl.wFlags & 0xffU)) {
    lMax = CalcPlanetMaxPop(GlobalPD._2_2_,idPlayer);
    pctDesire = PctPlanetDesirability((PLANET *)&pl,idPlayer);
    if (pctDesire < 0) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[0]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsWillKillOffApproximately);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[1]);
      x = wsprintf(szWork,(char *)PCTDXPCTDPCTPCT,-pctDesire / 10,-pctDesire % 10);
      pctDesire = fPrint;
      c = x;
      DxStreamTextOut(hdc,&x,y,(char *)szWork,x,fPrint);
      pctDesire = hdc;
      x = rghfontArial8[0];
      SelectObject(hdc,rghfontArial8[0]);
      pctDesire = fPrint;
      x = 0;
      pcVar2 = PszGetCompressedString(idsOf);
      DxStreamTextOut(hdc,&x,y,pcVar2,x,pctDesire);
      if (xMax < x) {
        xMax = x;
      }
      y = y + dyArial8;
      if (pl.iPlayer == idPlayer) {
        pctDesire = fPrint;
        x = 0;
        pcVar2 = PszGetCompressedString(idsColonistsEachTurn);
        DxStreamTextOut(hdc,&x,y,pcVar2,x,pctDesire);
      }
      else {
        pctDesire = fPrint;
        x = 0;
        pcVar2 = PszGetCompressedString(idsColonistsSettleEveryTurn);
        DxStreamTextOut(hdc,&x,y,pcVar2,x,pctDesire);
      }
    }
    else if ((pl.iPlayer == idPlayer) && (0 < lMax)) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[0]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsWillSupportPopulation);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      SelectObject(hdc,rghfontArial8[1]);
      x = wsprintf(szWork,(char *)PCTLD00,(undefined2)lMax,lMax._2_2_);
      pctDesire = fPrint;
      c = x;
      DxStreamTextOut(hdc,&x,y,(char *)szWork,x,fPrint);
      pctDesire = hdc;
      x = rghfontArial8[0];
      SelectObject(hdc,rghfontArial8[0]);
      pctDesire = fPrint;
      x = 0;
      pcVar2 = PszGetCompressedString(idsColonists3);
      DxStreamTextOut(hdc,&x,y,pcVar2,x,pctDesire);
    }
    else if (lMax < 1) {
      y = y - dyArial8;
    }
    else {
      SelectObject(hdc,rghfontArial8[0]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsIfColonize);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[1]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetPlanetName(GlobalPD._2_2_);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[0]);
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsWould);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      sVar5 = 0;
      sVar6 = fPrint;
      pcVar2 = PszGetCompressedString(idsSupport);
      DxStreamTextOut(hdc,&x,y,pcVar2,sVar5,sVar6);
      SelectObject(hdc,rghfontArial8[1]);
      x = wsprintf(szWork,(char *)PCTLD00,(undefined2)lMax,lMax._2_2_);
      pctDesire = fPrint;
      c = x;
      DxStreamTextOut(hdc,&x,y,(char *)szWork,x,fPrint);
      pctDesire = hdc;
      x = rghfontArial8[0];
      SelectObject(hdc,rghfontArial8[0]);
      pctDesire = fPrint;
      x = 0;
      pcVar2 = PszGetCompressedString(idsColonists3);
      DxStreamTextOut(hdc,&x,y,pcVar2,x,pctDesire);
    }
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    if (((pl.iPlayer == idPlayer) && (-1 < pctDesire)) &&
       (CONCAT22(pl.rgwtMin[3]._2_2_,(int)pl.rgwtMin[3]) < lMax)) {
      c = CchGetString(idsPopulation,szT);
      WrapTextOut(hdc,&x,&y,szT,c,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[1]);
      psz = PszGetPlanetName(pl.id);
      WrapTextOut(hdc,&x,&y,psz,0,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      lVar3 = ChgPopFromPlanet((PLANET *)&pl,0);
      if ((pctDesire == 0) || (lVar3 < 1)) {
        c = CchGetString(idsWillGrowYear,szT);
      }
      else {
        psz = PszGetCompressedString(idsWillGrowLd00Ld00Year);
        lVar1 = lVar3 + CONCAT22(pl.rgwtMin[3]._2_2_,(int)pl.rgwtMin[3]);
        c = wsprintf((char *)szT,(char *)psz,(int)lVar3,(int)((ulong)lVar3 >> 0x10),(int)lVar1,
                     (int)((ulong)lVar1 >> 0x10));
      }
      WrapTextOut(hdc,&x,&y,szT,c,4,xMax,(short *)0x0,0,fPrint);
      y = y + dyArial8;
    }
    else if ((pl.iPlayer != idPlayer) && (pl.iPlayer != -1)) {
      SelectObject(hdc,rghfontArial8[1]);
      psz = PszGetPlanetName(pl.id);
      WrapTextOut(hdc,&x,&y,psz,0,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      if ((uint)pl.uGuesses >> 0xc == 0) {
        c = CchGetString(idsAppearsHavePlanetaryDefenses,(char *)szWork);
      }
      else {
        psz = PszGetCompressedString(idsHasPlanetaryDefensesApproximatelyDCoverage);
        c = wsprintf((char *)szT,(char *)psz,((uint)pl.uGuesses >> 0xc) * 6 + 3);
        psz = szT;
      }
      WrapTextOut(hdc,&x,&y,psz,c,4,xMax,(short *)0x0,0,fPrint);
      y = y + dyArial8;
    }
  }
  PVar4.x = xMax + 4;
  PVar4.y = y + 4;
  return PVar4;
}



// ======================================================================
// Function: PtDisplayZipOrdInfo
// Address: 10c0:2d66
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayZipOrdInfo(HDC hdc,short xCtr,short fPrint)

{
  ushort cLen;
  char *pcVar1;
  POINT PVar2;
  short sVar3;
  short sVar4;
  short x;
  char *psz;
  short xMax;
  short y;
  
  y = 4;
  xMax = 4;
  x = 4;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    psz = PszGetCompressedString(idsZipord);
    cLen = _strlen(psz);
    CtrTextOut(hdc,xCtr,y,psz,cLen);
  }
  y = y + dyArial8;
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsZipordProvidesAbilityQuicklySetFleets);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsTransportOrdersOne3CommonSetsSelect);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsZipordClickDiamondRightMouse);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsButtonClickOrderChoice);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8 * 2;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsQuikload);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsLoadMineralsAvailable);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsQuikdrop);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsUnloadEverythingFleetCarrying);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsWaitload);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsWaitFullLoadMinerals);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsClear2);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar4 = 0;
  pcVar1 = PszGetCompressedString(idsRemoveTransportOrders);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,fPrint);
  if (xMax < x) {
    xMax = x;
  }
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 4;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayFactoryMineInfo
// Address: 10c0:3110
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Variable defined which should be unmapped: x */
/* WARNING: Variable defined which should be unmapped: cnt */
/* WARNING: Variable defined which should be unmapped: c */

POINT PtDisplayFactoryMineInfo(HDC hdc,short dx,short fPrint)

{
  char *pcVar1;
  int dxWidth;
  short sVar2;
  StringId ids_00;
  undefined2 uVar3;
  undefined2 unaff_SI;
  undefined *puVar4;
  undefined2 unaff_SS;
  POINT PVar5;
  char *pcStack_46;
  short x;
  short cnt;
  short c;
  short i;
  short xMax;
  short y;
  undefined2 pszType;
  short ids;
  char szT [40];
  undefined2 pszTypes;
  
  ids = 0xcd;
  dxWidth = dx + -8;
  xMax = 4;
  pcStack_46 = (char *)CONCAT22(4,unaff_SI);
  y = 2;
  if (GlobalPD.iPlanMax == 0) {
    pszType = 0xc3f;
    pszTypes = 0xc44;
  }
  else {
    pszType = 0xc2d;
    pszTypes = 0xc35;
  }
  puVar4 = (undefined *)0x14f8;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    CchGetString(idsSInfo,szT);
    sVar2 = wsprintf(szWork,(char *)szT,pszType,0x1120);
    _cnt = (char *)CONCAT22((char *)szWork,y);
    pcStack_46 = (char *)CONCAT22(dxWidth >> 1,hdc);
    puVar4 = (undefined *)&DAT_1120_1040;
    CtrTextOut(hdc,dxWidth >> 1,y,(char *)szWork,sVar2);
  }
  y = y + dyArial8 + 4;
  _cnt = (char *)CONCAT22((PLAYER *)rgplr + idPlayer,puVar4);
  puVar4 = (undefined *)&DAT_1120_10e0;
  pcStack_46 = (char *)CONCAT22(0x31d7,uVar3);
  sVar2 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  if (sVar2 == raMacintosh) {
    _cnt = (char *)CONCAT22(rghfontArial8[0],(undefined *)&DAT_1120_10e0);
    pcStack_46 = (char *)CONCAT22(0x31ee,uVar3);
    SelectObject(hdc,rghfontArial8[0]);
    if (GlobalPD.iPlanMax == 0) {
      ids_00 = idsRaceIncapableBuildingMinesHoweverColonistsHave;
    }
    else {
      ids_00 = idsRaceIncapableBuildingFactories;
    }
    _cnt = (char *)0x14f83207;
    PszGetCompressedString(ids_00);
    _cnt = (char *)ZEXT24(&xMax);
    pcStack_46 = (char *)CONCAT22(dxWidth,4);
    WrapTextOut(hdc,&x,&y,(char *)0x0,0,4,dxWidth,&xMax,0,fPrint);
  }
  else {
    for (i = 0; i < 9; i = i + 1) {
      _cnt = (char *)CONCAT22(rghfontArial8[1],puVar4);
      pcStack_46 = (char *)CONCAT22(0x3250,uVar3);
      SelectObject(hdc,rghfontArial8[1]);
      switch(i) {
      case 0:
      case 2:
      case 4:
      case 6:
      case 8:
        _cnt = (char *)CONCAT22(rghfontArial8[0],(undefined *)&DAT_1120_10c0);
        pcStack_46 = (char *)CONCAT22(0x3262,uVar3);
        SelectObject(hdc,rghfontArial8[0]);
        _cnt = (char *)0x14f8326a;
        PszGetCompressedString(ids);
        ids = ids + 1;
        break;
      case 1:
        pcVar1 = (char *)GlobalPD.iPlanVal;
        goto POPUP_SetQuan_2;
      case 3:
        _cnt = (char *)0x10c032bf;
        PszGetPlanetName(GlobalPD._2_2_);
        break;
      case 5:
        pcVar1 = GlobalPD.psz;
POPUP_SetQuan_2:
        uVar3 = pszType;
        if (pcVar1 != (char *)0x1) {
          uVar3 = pszTypes;
        }
        _cnt = (char *)CONCAT22(uVar3,pcVar1);
        pcStack_46 = s__d__s_1120_0c4a;
        wsprintf(szWork,s__d__s_1120_0c4a);
        break;
      case 7:
        _cnt = (char *)PCTD;
        pcStack_46 = szWork;
        wsprintf(szWork,_cnt);
      }
      _cnt = (char *)ZEXT24(&xMax);
      pcStack_46 = (char *)CONCAT22(dxWidth,4);
      puVar4 = (undefined *)&DAT_1120_1040;
      WrapTextOut(hdc,&x,&y,(char *)0x0,0,4,dxWidth,&xMax,0,fPrint);
    }
  }
  PVar5.x = xMax + 4;
  PVar5.y = y + dyArial8 + 2;
  return PVar5;
}



// ======================================================================
// Function: PtDisplayResourceInfo
// Address: 10c0:3378
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayResourceInfo(HDC hdc,short dx,short fPrint)

{
  short sVar1;
  ushort cLen;
  POINT PVar2;
  short x;
  short cnt;
  char *psz;
  short i;
  short xMax;
  short y;
  short ids;
  short iMax;
  
  sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  iMax = (sVar1 == raMacintosh) + 8;
  ids = 0xed;
  xMax = 4;
  x = 4;
  y = 2;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    psz = PszGetCompressedString(idsResourceInfo);
    cLen = _strlen(psz);
    CtrTextOut(hdc,dx + -8 >> 1,y,psz,cLen);
  }
  y = y + dyArial8 + 4;
  for (i = 0; i <= iMax; i = i + 1) {
    SelectObject(hdc,rghfontArial8[1]);
    switch(i) {
    case 0:
      psz = PszGetPlanetName(GlobalPD._2_2_);
      break;
    case 1:
    case 3:
    case 5:
    case 8:
    case 9:
      goto switchD_10c0_34e2_caseD_1;
    case 2:
      cnt = (short)GlobalPD.psz;
      goto POPUP_SetQuan;
    case 4:
      cnt = (int)GlobalPD.psz - GlobalPD.iPlanVal;
      if (0 < cnt) goto POPUP_SetQuan;
      psz = PszGetCompressedString(idsNone2);
      break;
    case 6:
      if ((char *)GlobalPD.iPlanVal == GlobalPD.psz) goto POPUP_OutOfFor;
switchD_10c0_34e2_caseD_1:
      SelectObject(hdc,rghfontArial8[0]);
      psz = PszGetCompressedString(ids);
      ids = ids + 1;
      break;
    case 7:
      cnt = GlobalPD.iPlanVal;
POPUP_SetQuan:
      wsprintf(szWork,(char *)PCTD,cnt);
      psz = (char *)szWork;
    }
    WrapTextOut(hdc,&x,&y,psz,0,4,dx + -8,&xMax,0,fPrint);
  }
POPUP_OutOfFor:
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 2;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayString
// Address: 10c0:355c
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayString(HDC hdc,short dx,short fPrint)

{
  POINT PVar1;
  short x;
  short xMax;
  short y;
  
  xMax = 4;
  x = 4;
  y = 2;
  SelectObject(hdc,rghfontArial8[0]);
  WrapTextOut(hdc,&x,&y,GlobalPD.psz,0,4,dx + -8,&xMax,0,fPrint);
  PVar1.x = xMax + 4;
  PVar1.y = y + dyArial8 + 2;
  return PVar1;
}



