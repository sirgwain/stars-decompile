// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: PopupWndProc
// Address: 10c0:0000
// Segment: MEMORY_POPUP
// ======================================================================


long PopupWndProc(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  undefined2 unaff_SS;
  LRESULT LVar1;
  RECT rc;
  PAINTSTRUCT ps;
  HDC hdc;
  
  if (message != WM_CREATE) {
    if (message != WM_PAINT) {
      if (message == WM_ERASEBKGND) {
        if (((GlobalPD.grPopup == 9) || (GlobalPD.grPopup == 0xb)) ||
           (GlobalPD.grPopup == 0xe)) {
          GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
          FillRect(wParam,(RECT *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
          return 1;
        }
      }
      else if ((message == WM_LBUTTONUP) || (message == WM_RBUTTONUP)) {
        if (hwndPopup == 0) {
          return 0;
        }
        DestroyWindow(hwndPopup);
        hwndPopup = 0;
        GlobalPD.grPopup = 0;
        ReleaseCapture();
        if (((uint)gd.grBits >> 0xb & 1) == 0) {
          return 0;
        }
        tutor.wFlags = tutor.wFlags & 0xfbffU | 0x400;
        AdvanceTutor();
        return 0;
      }
      LVar1 = DefWindowProc(hwnd,message,wParam,lParam);
      return LVar1;
    }
    hdc = BeginPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
    DrawPopup(hwnd,hdc);
    EndPaint(hwnd,(PAINTSTRUCT *)CONCAT22(unaff_SS,&ps));
  }
  return 0;
}



// ======================================================================
// Function: FIsPopupHullType
// Address: 10c0:0148
// Segment: MEMORY_POPUP
// ======================================================================


short FIsPopupHullType(short ishdef)

{
  uint uVar1;
  int iVar2;
  HULDEF *pHVar3;
  ushort imd;
  
  if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) ||
     (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0xff)) {
    uVar1 = 1;
  }
  else {
    iVar2 = ((FLEET *)GlobalPD.u_POPUPDATA_0x0002.lpfl)->iPlayer * 4;
    pHVar3 = LphuldefFromId(*(HullDef *)(*(int *)(iVar2 + 0xfe) + ishdef * 0x93));
    uVar1 = *(uint *)((((HULDEF *)pHVar3)->wFlags_0x7b >> 10 & 0xf) * 2 + 0x138) &
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory;
  }
  return uVar1;
}



// ======================================================================
// Function: DrawPopup
// Address: 10c0:01c0
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c002d5) */
/* WARNING: Removing unreachable block (ram,0x10c00457) */

void DrawPopup(HWND hwnd,HDC hdc)

{
  StringId ids;
  char *pcVar1;
  ushort uVar2;
  ushort unaff_SI;
  uint unaff_DI;
  undefined2 unaff_SS;
  ulong uVar3;
  long lVar4;
  DWORD DVar5;
  undefined2 uVar6;
  undefined1 *puVar7;
  undefined2 uVar8;
  HDC HVar9;
  short sVar10;
  short sVar11;
  char szTB [40];
  short dpT;
  short csh;
  char *lpsz;
  RECT rc;
  COLORREF crFore;
  short dx;
  char *psz;
  HFONT hfontSav;
  short bkMode;
  short c;
  short i;
  short yCur;
  char szT [80];
  COLORREF crBack;
  
  crBack = SetBkColor(hdc,0xffffff);
  crFore = SetTextColor(hdc,0);
  bkMode = SetBkMode(hdc,2);
  hfontSav = SelectObject(hdc,rghfontArial8[1]);
  GetClientRect(hwnd,(RECT *)CONCAT22(unaff_SS,&rc));
  switch(GlobalPD.grPopup) {
  case 1:
    sVar10 = 0;
    lVar4 = __aFlshl((ulong)unaff_DI << 0x10,unaff_SI);
    CtrTextOut(hdc,rc.right >> 1,4,(char *)*(undefined2 *)((int)lVar4 + 0x4cc),sVar10);
    SelectObject(hdc,rghfontArial8[0]);
    pcVar1 = PszGetCompressedString(idsMineralConcentration);
    uVar6 = 0x1120;
    HVar9 = hdc;
    psz = pcVar1;
    uVar2 = _strlen(pcVar1);
    DVar5 = GetTextExtent(HVar9,(LPCSTR)CONCAT22(uVar6,pcVar1),uVar2);
    dx = (int)DVar5 + 4;
    sVar11 = 0;
    sVar10 = 0;
    pcVar1 = PszGetCompressedString(idsSurface);
    RightTextOut(hdc,dx,dyArial8 + 4,pcVar1,sVar10,sVar11);
    if ((int)GlobalPD.u_POPUPDATA_0x0002._10_2_ < 0) {
      pcVar1 = PszGetCompressedString(idsUnknown2);
      _strcpy((char *)szWork,pcVar1);
      c = _strlen((char *)szWork);
    }
    else {
      c = _WSPRINTF(szWork,(char *)0x11200bee,
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory,
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary);
    }
    TextOut(hdc,dx,dyArial8 + 4,szWork,c);
    sVar11 = 0;
    sVar10 = 0;
    pcVar1 = PszGetCompressedString(idsMineralConcentration);
    RightTextOut(hdc,dx,dyArial8 * 2 + 4,pcVar1,sVar10,sVar11);
    if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 0) ||
       ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 1 &&
        (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin == 0)))) {
      pcVar1 = PszGetCompressedString(idsUnknown2);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar1));
    }
    else {
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD),
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin,
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax);
      if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) ||
         (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate != 0)) {
        if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 0) ||
           ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 1 &&
            ((uint)GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin < 0x1e)))) {
          ids = idsN30;
        }
        else {
          ids = idsHw;
        }
        pcVar1 = PszGetCompressedString(ids);
        sVar10 = _WSPRINTF((char *)CONCAT22(0x1120,(char *)szWork + c),
                           (char *)CONCAT22(0x1120,pcVar1));
        c = c + sVar10;
      }
    }
    TextOut(hdc,dx,dyArial8 * 2 + 4,szWork,c);
    if (-1 < (int)GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_) {
      sVar11 = 0;
      sVar10 = 0;
      pcVar1 = PszGetCompressedString(idsMiningRate);
      RightTextOut(hdc,dx,dyArial8 * 3 + 4,pcVar1,sVar10,sVar11);
      CchGetString(idsLdktYr,szT);
      c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),
                    GlobalPD.u_POPUPDATA_0x0002.rgi[4]._0_2_,
                    GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_);
      TextOut(hdc,dx,dyArial8 * 3 + 4,szWork,c);
    }
    break;
  case 2:
    sVar10 = 0;
    pcVar1 = PszPlayerName(GlobalPD.u_POPUPDATA_0x0002.dxOut,1,1,1,0,(PLAYER *)0x0);
    CtrTextOut(hdc,rc.right >> 1,4,pcVar1,sVar10);
    puVar7 = (undefined1 *)((int)&(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->id + 1);
    pcVar1 = PszGetCompressedString(idsPlayerD);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,pcVar1),puVar7);
    CtrTextOut(hdc,rc.right >> 1,dyArial8 + 4,(char *)szWork,c);
    break;
  case 3:
    if (rc.bottom - rc.top < dyArial8 * 2) {
      c = CchGetString(idsNone2,(char *)szWork);
      TextOut(hdc,4,4,szWork,c);
      SelectObject(hdc,rghfontArial8[0]);
    }
    else {
      SelectObject(hdc,rghfontArial8[1]);
      c = CchGetString(idsShipName,(char *)szWork);
      TextOut(hdc,4,4,szWork,c);
      RightTextOut
                (hdc,(rc.right + -4) - GlobalPD.u_POPUPDATA_0x0002._6_2_,4,(char *)0xbf4,1,0)
      ;
      if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate != 0) {
        c = CchGetString(idsDamage2,(char *)szWork);
        RightTextOut(hdc,rc.right + -4,4,(char *)szWork,c,0);
        PatBlt(hdc,4,dyArial8 + 2,rc.right + -8,1,0x42);
      }
      SelectObject(hdc,rghfontArial8[0]);
      yCur = dyArial8 + 4;
      for (i = 0; i < 0x10; i = i + 1) {
        if (0 < (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]) {
          if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory != 0) {
            sVar10 = FIsPopupHullType(i);
            if (sVar10 == 0) goto LAB_10c0_08cd;
          }
          if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
            if ((GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] == 0) {
              SetTextColor(hdc,0);
            }
            else {
              SetTextColor(hdc,0xff);
            }
          }
          DecorateHullName
                    (((GlobalPD.u_POPUPDATA_0x0002.lpshdef)->hul).ihuldef >> 9 & 0xf,i,szTB);
          pcVar1 = szTB;
          sVar11 = 4;
          uVar6 = unaff_SS;
          sVar10 = yCur;
          HVar9 = hdc;
          lpsz = pcVar1;
          uVar2 = __fstrlen((char *)CONCAT22(unaff_SS,pcVar1));
          TextOut(HVar9,sVar11,sVar10,(LPCSTR)CONCAT22(uVar6,pcVar1),uVar2);
          c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                        (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]);
          RightTextOut
                    (hdc,(rc.right + -4) - GlobalPD.u_POPUPDATA_0x0002._6_2_,yCur,
                     (char *)szWork,c,0);
          if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
            if ((GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] != 0) {
              csh = (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i];
              uVar8 = 0;
              uVar6 = 100;
              uVar3 = __aFulmul((ulong)((GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->
                                                rgcsh[i + 0x10] & 0x7f),(long)csh);
              lVar4 = __aFldiv(uVar3,CONCAT22(uVar8,uVar6));
              csh = (short)lVar4;
              if (csh < 1) {
                csh = 1;
              }
              dpT = (uint)(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] / 0x280;
              if (dpT == 0) {
                dpT = 1;
              }
              c = _WSPRINTF(szWork,(char *)0x11200bf6,csh,dpT);
              RightTextOut(hdc,rc.right + -4,yCur,(char *)szWork,c,0);
            }
          }
          yCur = yCur + dyArial8;
        }
LAB_10c0_08cd:
      }
      if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
        SetTextColor(hdc,0);
      }
    }
    break;
  case 4:
    pcVar1 = PszGetCompressedString(idsPlanet);
    uVar6 = 0x1120;
    HVar9 = hdc;
    psz = pcVar1;
    uVar2 = _strlen(pcVar1);
    DVar5 = GetTextExtent(HVar9,(LPCSTR)CONCAT22(uVar6,pcVar1),uVar2);
    dx = (int)DVar5 + 4;
    SelectObject(hdc,rghfontArial8[1]);
    sVar10 = 0;
    uVar2 = _strlen(psz);
    RightTextOut(hdc,dx,4,psz,uVar2,sVar10);
    sVar11 = 0;
    sVar10 = 0;
    pcVar1 = PszGetCompressedString(idsId);
    RightTextOut(hdc,dx,dyArial8 + 4,pcVar1,sVar10,sVar11);
    sVar11 = 0;
    sVar10 = 0;
    pcVar1 = PszGetCompressedString(idsX);
    RightTextOut(hdc,dx,dyArial8 * 2 + 4,pcVar1,sVar10,sVar11);
    sVar11 = 0;
    sVar10 = 0;
    pcVar1 = PszGetCompressedString(idsY);
    RightTextOut(hdc,dx,dyArial8 * 3 + 4,pcVar1,sVar10,sVar11);
    psz = PszGetPlanetName(sel.scan.idpl);
    SelectObject(hdc,rghfontArial8[0]);
    sVar11 = 4;
    uVar6 = 0x1120;
    pcVar1 = psz;
    sVar10 = dx;
    HVar9 = hdc;
    uVar2 = _strlen(psz);
    TextOut(HVar9,sVar10,sVar11,(LPCSTR)CONCAT22(uVar6,pcVar1),uVar2);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),sel.scan.idpl + 1)
    ;
    TextOut(hdc,dx,dyArial8 + 4,szWork,c);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),sel.scan.pt.x);
    TextOut(hdc,dx,dyArial8 * 2 + 4,szWork,c);
    c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),sel.scan.pt.y);
    TextOut(hdc,dx,dyArial8 * 3 + 4,szWork,c);
    break;
  case 5:
    PtDisplayPlanetStateInfo(hdc,1);
    break;
  case 6:
    PtDisplayZipOrdInfo(hdc,rc.right >> 1,1);
    break;
  case 7:
    PtDisplayPlanetPopInfo(hdc,1);
    break;
  case 8:
    PtDisplayFactoryMineInfo(hdc,rc.right,1);
    break;
  case 9:
    DisplayComponentInfo
              (hdc,rc.right,rc.bottom,(PART *)&GlobalPD.u_POPUPDATA_0x0002.part);
    break;
  case 10:
    PtDisplayString(hdc,rc.right,1);
    break;
  case 0xb:
  case 0xe:
    fStarbaseMode = (short)(0x1f < (GlobalPD.u_POPUPDATA_0x0002.lpfl)->id);
    DrawSlotDlg(hwnd,hdc,&rc,-1);
    rc.top = dyArial8 + 0x132;
    rc.left = rc.left + 6;
    SelectObject(hdc,rghfontArial8[1]);
    SetBkMode(hdc,1);
    __fstrcpy(szWork,
                      (char *)CONCAT22(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2,
                                       &(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->pt));
    CtrTextOut(hdc,(rc.right + -0x4c >> 1) + 0x4c,6,(char *)szWork,0);
    DrawBuildSelHull(hwnd,hdc,-1,&rc);
    break;
  case 0xc:
    PtDisplayResourceInfo(hdc,rc.right,1);
    break;
  default:
  }
  SelectObject(hdc,hfontSav);
  SetBkMode(hdc,bkMode);
  SetTextColor(hdc,crFore);
  SetBkColor(hdc,crBack);
  return;
}



// ======================================================================
// Function: Popup
// Address: 10c0:0c7c
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c00d16) */
/* WARNING: Variable defined which should be unmapped: dxCoord */

void Popup(HWND hwnd,short x,short y)

{
  POINT PVar1;
  POINT PVar2;
  ushort uVar3;
  char *pcVar4;
  int iVar5;
  short sVar6;
  uint uVar7;
  short unaff_SS;
  DWORD DVar8;
  LPCSTR pcVar9;
  ulong uVar10;
  HDC HVar11;
  char szTB [40];
  char *psz;
  short dxR;
  char *lpsz;
  short dxCoord;
  short dxL;
  short dx2;
  POINT ptT;
  short dx;
  char *psz__20;
  HFONT hfontSav;
  short c;
  short i;
  short dy;
  POINT pt;
  HDC hdc;
  
  pt.x = x;
  pt.y = y;
  ClientToScreen(hwnd,(POINT *)CONCAT22(unaff_SS,&pt));
  hdc = GetDC(hwnd);
  hfontSav = SelectObject(hdc,rghfontArial8[0]);
  PVar2.y = ptT.y;
  PVar2.x = ptT.x;
  PVar1.y = ptT.y;
  PVar1.x = ptT.x;
  switch(GlobalPD.grPopup) {
  case 1:
    psz__20 = PszGetCompressedString(idsMineralConcentration0000000kt);
    pcVar9 = (LPCSTR)CONCAT22(0x1120,psz__20);
    HVar11 = hdc;
    uVar3 = _strlen(psz__20);
    DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
    dx = (int)DVar8 + 8;
    dy = dyArial8 * 3 + 8;
    if (-1 < (int)GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_) {
      dy = dy + dyArial8;
    }
    break;
  case 2:
    SelectObject(hdc,rghfontArial8[1]);
    dxL = (short)PszPlayerName(GlobalPD.u_POPUPDATA_0x0002.dxOut,1,1,1,0,(PLAYER *)0x0)
    ;
    pcVar9 = (LPCSTR)CONCAT22(0x1120,dxL);
    HVar11 = hdc;
    uVar3 = _strlen((char *)dxL);
    DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
    dx = (int)DVar8 + 8;
    DVar8 = GetTextExtent(hdc,s_Player__16_1120_0bfe,10);
    dx2 = (int)DVar8 + 8;
    sVar6 = dx2;
    if (dx2 <= dx) {
      sVar6 = dx;
    }
    dx = sVar6;
    dy = dyArial8 * 2 + 8;
    break;
  case 3:
    dxR = 0;
    dx2 = 0;
    dy = dyArial8 + 8;
    SelectObject(hdc,rghfontArial8[1]);
    psz = PszGetCompressedString(idsShipName);
    pcVar9 = (LPCSTR)CONCAT22(0x1120,psz);
    HVar11 = hdc;
    uVar3 = _strlen(psz);
    DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
    dxL = (short)DVar8;
    SelectObject(hdc,rghfontArial8[0]);
    for (i = 0; i < 0x10; i = i + 1) {
      if ((0 < (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]) &&
         ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0 ||
          (sVar6 = FIsPopupHullType(i), sVar6 != 0)))) {
        dy = dy + dyArial8;
        uVar10 = CONCAT22(i,((GlobalPD.u_POPUPDATA_0x0002.lpshdef)->hul).ihuldef >> 9) &
                 0xffff000f;
        DecorateHullName((short)uVar10,(short)(uVar10 >> 0x10),szTB);
        lpsz = szTB;
        pcVar9 = (LPCSTR)CONCAT22(unaff_SS,lpsz);
        HVar11 = hdc;
        dxCoord = unaff_SS;
        uVar3 = __fstrlen((char *)CONCAT22(unaff_SS,lpsz));
        DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
        dx = (short)DVar8;
        if (dxL <= dx) {
          dxL = dx;
        }
        c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                      (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]);
        DVar8 = GetTextExtent(hdc,szWork,c);
        dx = (short)DVar8;
        if (dxR <= dx) {
          dxR = dx;
        }
        if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
          if (((uint)(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] >> 7 != 0) &&
             (dx2 == 0)) {
            psz = PszGetCompressedString(idsN9999999);
            pcVar9 = (LPCSTR)CONCAT22(0x1120,psz);
            HVar11 = hdc;
            uVar3 = _strlen(psz);
            DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
            dx2 = (int)DVar8 + 4;
          }
        }
      }
    }
    if (dy == dyArial8 + 8) {
      psz = PszGetCompressedString(idsShipName);
      pcVar9 = (LPCSTR)CONCAT22(0x1120,psz);
      HVar11 = hdc;
      uVar3 = _strlen(psz);
      DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
      dxL = (short)DVar8;
    }
    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate = dx2;
    dx = dxL + dxR + 0x10 + dx2;
    break;
  case 4:
    SelectObject(hdc,rghfontArial8[1]);
    dy = dyArial8 * 4 + 8;
    dxL = (short)PszGetCompressedString(idsPlanet);
    pcVar9 = (LPCSTR)CONCAT22(0x1120,dxL);
    HVar11 = hdc;
    uVar3 = _strlen((char *)dxL);
    DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
    dx = (int)DVar8 + 8;
    dxL = (short)PszGetPlanetName(sel.scan.idpl);
    SelectObject(hdc,rghfontArial8[0]);
    pcVar9 = (LPCSTR)CONCAT22(0x1120,dxL);
    HVar11 = hdc;
    uVar3 = _strlen((char *)dxL);
    DVar8 = GetTextExtent(HVar11,pcVar9,uVar3);
    dx2 = (short)DVar8;
    HVar11 = hdc;
    pcVar4 = PszGetCompressedString(idsN9999);
    DVar8 = GetTextExtent(HVar11,(LPCSTR)CONCAT22(0x1120,pcVar4),4);
    dxCoord = (short)DVar8;
    iVar5 = dx2;
    if (dx2 <= dxCoord) {
      iVar5 = dxCoord;
    }
    dx = dx + iVar5;
    break;
  case 5:
    ptT = PtDisplayPlanetStateInfo(hdc,0);
    goto POPUP_SetDxDy;
  case 6:
    ptT = PtDisplayZipOrdInfo(hdc,0,0);
    goto POPUP_SetDxDy;
  case 7:
    ptT = PtDisplayPlanetPopInfo(hdc,0);
    goto POPUP_SetDxDy;
  case 8:
    ptT = PtDisplayFactoryMineInfo(hdc,200,0);
    goto POPUP_SetDxDy;
  case 9:
    if (dyArial8 < 0xf) {
      iVar5 = 0;
    }
    else {
      iVar5 = 0x28;
    }
    dx = iVar5 + 0x158;
    dy = dyArial10 + dyArial8 * 0xc + 0x4e;
    ptT = PVar2;
    break;
  case 10:
    ptT = PtDisplayString(hdc,GlobalPD.u_POPUPDATA_0x0002.dxOut,0);
    goto POPUP_SetDxDy;
  case 0xb:
  case 0xe:
    mdBuild = (short)(GlobalPD.grPopup != 0xb);
    lpshdefBuild._0_2_ = GlobalPD.u_POPUPDATA_0x0002.lpshdef._0_2_;
    lpshdefBuild._2_2_ = GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2;
    UpdateSlotGlobals();
    dx = 0x154;
    dy = dyArial8 * 7 + 0x13a;
    if (((uint)gd.grBits >> 0xe != 0) && (GlobalPD.grPopup == 0xb)) {
      dy = dy + dyArial8 * 3;
    }
    break;
  case 0xc:
    ptT = PtDisplayResourceInfo(hdc,200,0);
POPUP_SetDxDy:
    dx = ptT.x + 2;
    dy = ptT.y + 2;
    break;
  case 0xd:
    dx = 0x78;
    dy = 0x50;
    ptT = PVar1;
  }
  SelectObject(hdc,hfontSav);
  ReleaseDC(hwnd,hdc);
  pt.x = pt.x - dx;
  pt.y = pt.y - dy;
  sVar6 = GetSystemMetrics(0);
  uVar7 = pt.x;
  if (sVar6 - dx <= pt.x) {
    sVar6 = GetSystemMetrics(0);
    uVar7 = sVar6 - dx;
  }
  if (uVar7 < 0x8000) {
    sVar6 = GetSystemMetrics(0);
    if (sVar6 - dx <= pt.x) {
      sVar6 = GetSystemMetrics(0);
      pt.x = sVar6 - dx;
    }
  }
  else {
    pt.x = 0;
  }
  sVar6 = GetSystemMetrics(1);
  uVar7 = pt.y;
  if (sVar6 - dy <= pt.y) {
    sVar6 = GetSystemMetrics(1);
    uVar7 = sVar6 - dy;
  }
  if (uVar7 < 0x8000) {
    sVar6 = GetSystemMetrics(1);
    if (sVar6 - dy <= pt.y) {
      sVar6 = GetSystemMetrics(1);
      pt.y = sVar6 - dy;
    }
  }
  else {
    pt.y = 0;
  }
  hwndPopup =
       CreateWindow(szPopup,(LPCSTR)0x0,0x90800000,pt.x,pt.y,dx,dy,hwnd,0,hInst,
                    (void *)0x0);
  SendMessage(hwndPopup,0x30,rghfontArial8[0],0);
  SetCapture(hwndPopup);
  return;
}



// ======================================================================
// Function: PopupMenu
// Address: 10c0:136c
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c01498) */
/* WARNING: Removing unreachable block (ram,0x10c0141e) */
/* WARNING: Removing unreachable block (ram,0x10c0144f) */
/* WARNING: Removing unreachable block (ram,0x10c014e1) */

short PopupMenu(HWND hwnd,short x,short y,short cString,long *rgids,char **rgsz,short iChecked,
                short fRightBtn)

{
  char *pcVar1;
  char cVar2;
  uint uVar3;
  int iVar4;
  UINT UVar5;
  BOOL BVar6;
  int iVar7;
  undefined2 unaff_SS;
  char *psz;
  short fCheckedCur;
  short fChecked;
  MSG msg;
  char *psz__150;
  char *pszT;
  HMENU hmenuPopup;
  HMENU hmenuSub;
  char szTemp [128];
  short i;
  POINT pt;
  short tpm;
  char *pszTitle;
  
  hmenuSub = 0;
  pt.x = x;
  pt.y = y;
  ClientToScreen(hwnd,(POINT *)CONCAT22(unaff_SS,&pt));
  hmenuPopup = CreatePopupMenu();
  iPopMenuSel = -1;
  for (i = 0; i < cString; i = i + 1) {
    if ((rgids == (long *)0x0) || ((iChecked == -2 && (rgsz != (char **)0x0)))) {
      if (rgsz[i] == (char *)0x0) {
        pszTitle = rgsz[i + 1];
        if (rgids == (long *)0x0) {
          fChecked = 0;
        }
        else {
          fChecked = (short)rgids[i + 1];
        }
        hmenuSub = CreatePopupMenu();
        for (i = i + 2; (i < cString && (rgsz[i] != (char *)0x0)); i = i + 1) {
          if (rgids == (long *)0x0) {
            fCheckedCur = (short)(i == iChecked);
            fChecked = fChecked | fCheckedCur;
          }
          else {
            fCheckedCur = (short)rgids[i];
          }
          if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
            AppendMenu(hmenuSub,0x800,0,(LPCSTR)0x0);
          }
          else {
            psz = rgsz[i];
            pcVar1 = szTemp;
            while (pszT = pcVar1, *psz != '\0') {
              pcVar1 = psz + 1;
              cVar2 = *psz;
              *pszT = cVar2;
              psz = pcVar1;
              pcVar1 = pszT + 1;
              if (cVar2 == '&') {
                pszT[1] = '&';
                pcVar1 = pszT + 2;
              }
            }
            *pszT = '\0';
            if (fCheckedCur == 0) {
              UVar5 = 0;
            }
            else {
              UVar5 = 8;
            }
            AppendMenu(hmenuSub,UVar5,i + 15000,(LPCSTR)CONCAT22(unaff_SS,szTemp));
          }
        }
        if (fChecked == 0) {
          uVar3 = 0;
        }
        else {
          uVar3 = 8;
        }
        AppendMenu(hmenuPopup,uVar3 | 0x10,hmenuSub,(LPCSTR)CONCAT22(0x1120,pszTitle));
      }
      else if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
        AppendMenu(hmenuPopup,0x800,0,(LPCSTR)0x0);
      }
      else {
        psz__150 = rgsz[i];
        pcVar1 = szTemp;
        while (pszT = pcVar1, *psz__150 != '\0') {
          pcVar1 = psz__150 + 1;
          cVar2 = *psz__150;
          *pszT = cVar2;
          psz__150 = pcVar1;
          pcVar1 = pszT + 1;
          if (cVar2 == '&') {
            pszT[1] = '&';
            pcVar1 = pszT + 2;
          }
        }
        *pszT = '\0';
        if (iChecked == -2) {
          iVar4 = (int)rgids[i];
          iVar7 = *(int *)((int)(rgids + i) + 2);
        }
        else if (i == iChecked) {
          iVar4 = 1;
          iVar7 = 0;
        }
        else {
          iVar4 = 0;
          iVar7 = 0;
        }
        if ((iVar4 == 0) && (iVar7 == 0)) {
          UVar5 = 0;
        }
        else {
          UVar5 = 8;
        }
        AppendMenu(hmenuPopup,UVar5,i + 15000,(LPCSTR)CONCAT22(unaff_SS,szTemp));
      }
    }
    else if (((int)rgids[i] == -1) && (*(int *)((int)(rgids + i) + 2) == -1)) {
      AppendMenu(hmenuPopup,0x800,0,(LPCSTR)0x0);
    }
    else {
      if ((*(uint *)((int)rgids + i * 4 + 2) & 0x1000) == 0) {
        if ((*(uint *)((int)rgids + i * 4 + 2) & 0x4000) == 0) {
          if ((*(uint *)((int)rgids + i * 4 + 2) & 0x2000) == 0) {
            if ((*(uint *)((int)rgids + i * 4 + 2) & 0x8000) == 0) {
              psz__150 = PszGetPlanetName((short)rgids[i]);
            }
            else {
              psz__150 = PszGetFleetName(*(uint *)(rgids + i) | 0x8000);
            }
          }
          else {
            psz__150 = PszGetThingName((short)rgids[i]);
          }
        }
        else {
          psz__150 = PszGetCompressedString(*(StringId *)(rgids + i));
        }
      }
      else {
        psz__150 = (char *)s_Deep_Space_1120_0c09;
      }
      pcVar1 = szTemp;
      while (pszT = pcVar1, *psz__150 != '\0') {
        pcVar1 = psz__150 + 1;
        cVar2 = *psz__150;
        *pszT = cVar2;
        psz__150 = pcVar1;
        pcVar1 = pszT + 1;
        if (cVar2 == '&') {
          pszT[1] = '&';
          pcVar1 = pszT + 2;
        }
      }
      *pszT = '\0';
      if (i == iChecked) {
        UVar5 = 8;
      }
      else {
        UVar5 = 0;
      }
      AppendMenu(hmenuPopup,UVar5,i + 15000,(LPCSTR)CONCAT22(unaff_SS,szTemp));
    }
  }
  if (fRightBtn == 0) {
    tpm = 0;
  }
  else {
    tpm = 2;
  }
  TrackPopupMenu(hmenuPopup,tpm,pt.x,pt.y,0,hwndFrame,(RECT *)0x0);
  DestroyMenu(hmenuPopup);
  if (hmenuSub != 0) {
    DestroyMenu(hmenuSub);
  }
  BVar6 = PeekMessage((MSG *)CONCAT22(unaff_SS,&msg),hwndFrame,0x111,0x111,2);
  if (((BVar6 != 0) && (14999 < msg.wParam)) && (msg.wParam < 0x3afc)) {
    iPopMenuSel = msg.wParam + 0xc568;
  }
  return iPopMenuSel;
}



// ======================================================================
// Function: PtDisplayPlanetStateInfo
// Address: 10c0:1938
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayPlanetStateInfo(HDC hdc,short fPrint)

{
  char *pcVar1;
  int iVar2;
  short sVar3;
  undefined2 unaff_SS;
  PLANET *lppl_00;
  POINT PVar4;
  short sVar5;
  short sVar6;
  long lVar7;
  short *psVar8;
  char szOut [82];
  short iValSav;
  short pctDesire;
  short pctDesireOld;
  PLANET *lppl;
  short dChg;
  short iNewVal;
  short x;
  short cch;
  short xMax;
  short y;
  
  y = 4;
  xMax = 4;
  x = 4;
  SelectObject(hdc,rghfontArial8[1]);
  DxStreamTextOut
            (hdc,&x,y,(char *)*(undefined2 *)
                               (GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + 0x47e),0
             ,fPrint);
  SelectObject(hdc,rghfontArial8[0]);
  lVar7 = (ulong)(uint)fPrint << 0x10;
  pcVar1 = PszGetCompressedString(idsCurrently);
  DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
  SelectObject(hdc,rghfontArial8[1]);
  if ((int)GlobalPD.u_POPUPDATA_0x0002._4_2_ < 0) {
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsUnknown2);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
  }
  else {
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszCalcEnvVar
                       (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax,
                        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
  }
  SelectObject(hdc,rghfontArial8[0]);
  DxStreamTextOut(hdc,&x,y,(char *)0xc14,1,fPrint);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin == -1) {
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsColonistsImmune);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsEffects);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)
                                 (GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + 0x47e)
               ,0,fPrint);
    DxStreamTextOut(hdc,&x,y,(char *)0xc16,1,fPrint);
  }
  else {
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsColonistsPreferPlanetsWhere);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)
                                 (GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + 0x47e)
               ,0,fPrint);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsBetween);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[1]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszCalcEnvVar
                       (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax,
                        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[0]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsAnd);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[1]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszCalcEnvVar
                       (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax,
                        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc18,1,fPrint);
  }
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if ((uint)GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate < 0x8000) {
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsCurrentlyPossessTechnology);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsModify);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)
                                 (GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + 0x47e)
               ,0,fPrint);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsOn2);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[1]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[0]);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsWithinRange);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[1]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszCalcEnvVar
                       (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax,
                        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[0]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszGetCompressedString(idsTo);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[1]);
    lVar7 = (ulong)(uint)fPrint << 0x10;
    pcVar1 = PszCalcEnvVar
                       (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax,
                        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory);
    DxStreamTextOut(hdc,&x,y,pcVar1,(short)lVar7,(short)((ulong)lVar7 >> 0x10));
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc1a,1,fPrint);
    if (xMax < x) {
      xMax = x;
    }
    y = y + dyArial8;
  }
  x = 4;
  if ((((uint)GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate < 0x8000) &&
      (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin != -1)) &&
     (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur !=
      GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary)) {
    iNewVal = -1;
    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur <
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary) {
      if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur <
           GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory) &&
         (iNewVal = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary,
         GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory <=
         GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary)) {
        iNewVal = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory;
      }
    }
    else if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate <
              GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur) &&
            (iNewVal = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary,
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary <=
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate)) {
      iNewVal = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate;
    }
    if (iNewVal != -1) {
      lppl_00 = LpplFromId(GlobalPD.u_POPUPDATA_0x0002.dxOut);
      dChg = (short)((ulong)lppl_00 >> 0x10);
      lppl = (PLANET *)lppl_00;
      pctDesireOld = PctPlanetDesirability(lppl_00,idPlayer);
      iValSav = (short)lppl->rgEnvVar[GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2];
      lppl->rgEnvVar[GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2] = (char)iNewVal;
      pctDesire = PctPlanetDesirability((PLANET *)CONCAT22(dChg,lppl),idPlayer);
      lppl->rgEnvVar[GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2] = (char)iValSav;
      if (pctDesireOld < pctDesire) {
        cch = CchGetString(idsIfTerraform,(char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[1]);
        WrapTextOut
                  (hdc,&x,&y,
                   (char *)*(undefined2 *)
                            (GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + 0x47e),0,4,
                   xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[0]);
        psVar8 = (short *)0x0;
        iVar2 = xMax + -4;
        sVar6 = 4;
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsTo);
        WrapTextOut
                  (hdc,&x,&y,pcVar1,sVar5,sVar6,iVar2,(short *)psVar8,(short)((ulong)psVar8 >> 0x10)
                   ,sVar3);
        SelectObject(hdc,rghfontArial8[1]);
        psVar8 = (short *)0x0;
        iVar2 = xMax + -4;
        sVar6 = 4;
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar
                           (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax,iNewVal);
        WrapTextOut
                  (hdc,&x,&y,pcVar1,sVar5,sVar6,iVar2,(short *)psVar8,(short)((ulong)psVar8 >> 0x10)
                   ,sVar3);
        SelectObject(hdc,rghfontArial8[0]);
        cch = CchGetString(idsPlanetsValueWouldImprove,(char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[1]);
        cch = _WSPRINTF(szWork,(char *)0x11200c1c,pctDesire);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
      }
    }
  }
  if (((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin != -1) &&
      (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur !=
       GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary)) &&
     (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != -1)) {
    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur <
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin) {
      dChg = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin -
             GlobalPD.u_POPUPDATA_0x0002._4_2_;
    }
    else if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax <
             GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur) {
      dChg = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur -
             GlobalPD.u_POPUPDATA_0x0002._14_2_;
    }
    else {
      sVar3 = _abs(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur -
                           GlobalPD.u_POPUPDATA_0x0002._10_2_);
      dChg = -sVar3;
    }
    if (dChg < 0) {
      dChg = -dChg;
      iNewVal = 0x169;
    }
    else {
      iNewVal = 0x168;
    }
    CchGetString(iNewVal,(char *)szWork);
    cch = _WSPRINTF((char *)CONCAT22(unaff_SS,szOut),szWork,dChg);
    SelectObject(hdc,rghfontArial8[0]);
    WrapTextOut(hdc,&x,&y,szOut,cch,4,xMax + -4,(short *)0x0,0,fPrint);
  }
  if (4 < x) {
    y = y + dyArial8;
  }
  PVar4.x = xMax + 4;
  PVar4.y = y + 4;
  return PVar4;
}



// ======================================================================
// Function: PtDisplayPlanetPopInfo
// Address: 10c0:228e
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Variable defined which should be unmapped: x */
/* WARNING: Removing unreachable block (ram,0x10c02aa4) */
/* WARNING: Removing unreachable block (ram,0x10c027b6) */
/* WARNING: Removing unreachable block (ram,0x10c028dd) */
/* WARNING: Removing unreachable block (ram,0x10c02b7d) */

POINT PtDisplayPlanetPopInfo(HDC hdc,short fPrint)

{
  char *pcVar1;
  undefined2 unaff_SS;
  long lVar2;
  POINT PVar3;
  short sVar4;
  short sVar5;
  uint uVar6;
  int iVar7;
  short x;
  short pctDesire;
  undefined4 lMax;
  char *psz;
  short c;
  short xMax;
  short y;
  char szT [150];
  PLANET pl;
  
  y = 4;
  xMax = 4;
  x = 4;
  FLookupPlanet(GlobalPD.u_POPUPDATA_0x0002.dxOut,&pl);
  SelectObject(hdc,rghfontArial8[0]);
  if (pl.iPlayer == idPlayer) {
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsPopulation3);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[0]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsIs);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[1]);
    _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD00),(uint)pl.rgwtMin[3],
              pl.rgwtMin[3]._2_2_);
    if (((uint)pl.rgwtMin[3] == 0) && (pl.rgwtMin[3]._2_2_ == 0)) {
      szWork[1] = '\0';
    }
    DxStreamTextOut(hdc,&x,y,(char *)szWork,0,fPrint);
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc24,1,fPrint);
  }
  else if (pl.iPlayer == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[0]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsUninhabited2);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
  }
  else {
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsEnemyPopulation);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[0]);
    if ((pl.wFlags_0x4 & 0xff) < 3) {
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsUnknown);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    }
    else {
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsApproximately);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      _WSPRINTF(szWork,(char *)0x11200c26,(pl.uGuesses & 0xfff) << 2);
      if ((pl.uGuesses & 0xfff) == 0) {
        szWork[1] = '\0';
      }
      DxStreamTextOut(hdc,&x,y,(char *)szWork,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
    }
    DxStreamTextOut(hdc,&x,y,(char *)0xc2b,1,fPrint);
  }
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if (2 < (pl.wFlags_0x4 & 0xff)) {
    lMax = CalcPlanetMaxPop(GlobalPD.u_POPUPDATA_0x0002.dxOut,idPlayer);
    pctDesire = PctPlanetDesirability((PLANET *)CONCAT22(unaff_SS,&pl),idPlayer);
    if (pctDesire < 0) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsWillKillOffApproximately);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTDXPCTDPCTPCT),-pctDesire / 10
                    ,-pctDesire % 10);
      DxStreamTextOut(hdc,&x,y,(char *)szWork,c,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsOf);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      if (pl.iPlayer == idPlayer) {
        sVar4 = 0;
        sVar5 = fPrint;
        pcVar1 = PszGetCompressedString(idsColonistsEachTurn);
        DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      }
      else {
        sVar4 = 0;
        sVar5 = fPrint;
        pcVar1 = PszGetCompressedString(idsColonistsSettleEveryTurn);
        DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      }
    }
    else if ((pl.iPlayer == idPlayer) && (0 < lMax)) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsWillSupportPopulation);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      SelectObject(hdc,rghfontArial8[1]);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD00),(undefined2)lMax,
                    lMax._2_2_);
      DxStreamTextOut(hdc,&x,y,(char *)szWork,c,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsColonists3);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    }
    else if (lMax < 1) {
      y = y - dyArial8;
    }
    else {
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsIfColonize);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsWould);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsSupport);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      c = _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTLD00),(undefined2)lMax,
                    lMax._2_2_);
      DxStreamTextOut(hdc,&x,y,(char *)szWork,c,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsColonists3);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    }
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    if (((pl.iPlayer == idPlayer) && (-1 < pctDesire)) &&
       (CONCAT22(pl.rgwtMin[3]._2_2_,(uint)pl.rgwtMin[3]) < lMax)) {
      c = CchGetString(idsPopulation,szT);
      WrapTextOut(hdc,&x,&y,szT,c,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[1]);
      psz = PszGetPlanetName(pl.id);
      WrapTextOut(hdc,&x,&y,psz,0,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      lVar2 = ChgPopFromPlanet((PLANET *)CONCAT22(unaff_SS,&pl),0);
      if ((pctDesire == 0) || (lVar2 < 1)) {
        x = (short)szT;
        c = CchGetString(idsWillGrowYear,(char *)x);
      }
      else {
        x = 0x213;
        iVar7 = 0x1038;
        uVar6 = 0x2ba8;
        psz = PszGetCompressedString(idsWillGrowLd00Ld00Year);
        x = pl.rgwtMin[3]._2_2_ + iVar7 + (uint)CARRY2((uint)pl.rgwtMin[3],uVar6);
        c = _WSPRINTF((char *)CONCAT22(unaff_SS,szT),(char *)CONCAT22(0x1120,psz),
                      (uint)pl.rgwtMin[3] + uVar6);
      }
      x = fPrint;
      WrapTextOut(hdc,&x,&y,szT,c,4,xMax,(short *)0x0,0,fPrint);
      y = y + dyArial8;
    }
    else if ((pl.iPlayer != idPlayer) && (pl.iPlayer != -1)) {
      SelectObject(hdc,rghfontArial8[1]);
      psz = PszGetPlanetName(pl.id);
      WrapTextOut(hdc,&x,&y,psz,0,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      if (pl.uGuesses >> 0xc == 0) {
        c = CchGetString(idsAppearsHavePlanetaryDefenses,(char *)szWork);
      }
      else {
        psz = PszGetCompressedString(idsHasPlanetaryDefensesApproximatelyDCoverage);
        c = _WSPRINTF((char *)CONCAT22(unaff_SS,szT),(char *)CONCAT22(0x1120,psz),
                      (pl.uGuesses >> 0xc) * 6 + 3);
        psz = szT;
      }
      WrapTextOut(hdc,&x,&y,psz,c,4,xMax,(short *)0x0,0,fPrint);
      y = y + dyArial8;
    }
  }
  PVar3.x = xMax + 4;
  PVar3.y = y + 4;
  return PVar3;
}



// ======================================================================
// Function: PtDisplayZipOrdInfo
// Address: 10c0:2d66
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayZipOrdInfo(HDC hdc,short xCtr,short fPrint)

{
  ushort cLen;
  char *pcVar1;
  POINT PVar2;
  short sVar3;
  short sVar4;
  short x;
  char *psz;
  short xMax;
  short y;
  
  y = 4;
  xMax = 4;
  x = 4;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    psz = PszGetCompressedString(idsZipord);
    cLen = _strlen(psz);
    CtrTextOut(hdc,xCtr,y,psz,cLen);
  }
  y = y + dyArial8;
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsZipordProvidesAbilityQuicklySetFleets);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsTransportOrdersOne3CommonSetsSelect);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsZipordClickDiamondRightMouse);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsButtonClickOrderChoice);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8 * 2;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsQuikload);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsLoadMineralsAvailable);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsQuikdrop);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsUnloadEverythingFleetCarrying);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsWaitload);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsWaitFullLoadMinerals);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsClear2);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar4 = 0;
  pcVar1 = PszGetCompressedString(idsRemoveTransportOrders);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,fPrint);
  if (xMax < x) {
    xMax = x;
  }
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 4;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayFactoryMineInfo
// Address: 10c0:3110
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayFactoryMineInfo(HDC hdc,short dx,short fPrint)

{
  int dxWidth;
  short sVar1;
  StringId ids_00;
  char *pcVar2;
  undefined2 unaff_SS;
  POINT PVar3;
  short x;
  short cnt;
  char *psz;
  short c;
  short i;
  short xMax;
  short y;
  char *pszType;
  short ids;
  char szT [40];
  char *pszTypes;
  
  ids = 0xcd;
  dxWidth = dx + -8;
  xMax = 4;
  x = 4;
  y = 2;
  if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) {
    pszType = (char *)0xc3f;
    pszTypes = (char *)s_Mines_1120_0c44;
  }
  else {
    pszType = (char *)s_Factory_1120_0c2d;
    pszTypes = (char *)s_Factories_1120_0c35;
  }
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    CchGetString(idsSInfo,szT);
    c = _WSPRINTF(szWork,(char *)CONCAT22(unaff_SS,szT),pszType,0x1120);
    CtrTextOut(hdc,dxWidth >> 1,y,(char *)szWork,c);
  }
  y = y + dyArial8 + 4;
  sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  if (sVar1 == raMacintosh) {
    SelectObject(hdc,rghfontArial8[0]);
    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) {
      ids_00 = idsRaceIncapableBuildingMinesHoweverColonistsHave;
    }
    else {
      ids_00 = idsRaceIncapableBuildingFactories;
    }
    psz = PszGetCompressedString(ids_00);
    WrapTextOut(hdc,&x,&y,psz,0,4,dxWidth,&xMax,0,fPrint);
  }
  else {
    for (i = 0; i < 9; i = i + 1) {
      SelectObject(hdc,rghfontArial8[1]);
      switch(i) {
      case 0:
      case 2:
      case 4:
      case 6:
      case 8:
        SelectObject(hdc,rghfontArial8[0]);
        psz = PszGetCompressedString(ids);
        ids = ids + 1;
        break;
      case 1:
        cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur;
        goto POPUP_SetQuan_2;
      case 3:
        psz = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
        break;
      case 5:
        cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax;
POPUP_SetQuan_2:
        pcVar2 = pszType;
        if (cnt != 1) {
          pcVar2 = pszTypes;
        }
        _WSPRINTF(szWork,s__d__s_1120_0c4a,cnt,pcVar2,0x1120);
        psz = (char *)szWork;
        break;
      case 7:
        _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),
                  GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate);
        psz = (char *)szWork;
      }
      WrapTextOut(hdc,&x,&y,psz,0,4,dxWidth,&xMax,0,fPrint);
    }
  }
  PVar3.x = xMax + 4;
  PVar3.y = y + dyArial8 + 2;
  return PVar3;
}



// ======================================================================
// Function: PtDisplayResourceInfo
// Address: 10c0:3378
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayResourceInfo(HDC hdc,short dx,short fPrint)

{
  short sVar1;
  ushort cLen;
  POINT PVar2;
  short x;
  short cnt;
  char *psz;
  short i;
  short xMax;
  short y;
  short ids;
  short iMax;
  
  sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  iMax = (sVar1 == raMacintosh) + 8;
  ids = 0xed;
  xMax = 4;
  x = 4;
  y = 2;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    psz = PszGetCompressedString(idsResourceInfo);
    cLen = _strlen(psz);
    CtrTextOut(hdc,dx + -8 >> 1,y,psz,cLen);
  }
  y = y + dyArial8 + 4;
  for (i = 0; i <= iMax; i = i + 1) {
    SelectObject(hdc,rghfontArial8[1]);
    switch(i) {
    case 0:
      psz = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
      break;
    case 1:
    case 3:
    case 5:
    case 8:
    case 9:
      goto switchD_10c0_34e2_caseD_1;
    case 2:
      cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax;
      goto POPUP_SetQuan;
    case 4:
      cnt = GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 -
            GlobalPD.u_POPUPDATA_0x0002._4_2_;
      if (0 < cnt) goto POPUP_SetQuan;
      psz = PszGetCompressedString(idsNone2);
      break;
    case 6:
      if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur ==
          GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2) goto POPUP_OutOfFor;
switchD_10c0_34e2_caseD_1:
      SelectObject(hdc,rghfontArial8[0]);
      psz = PszGetCompressedString(ids);
      ids = ids + 1;
      break;
    case 7:
      cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur;
POPUP_SetQuan:
      _WSPRINTF(szWork,(char *)CONCAT22(0x1120,PCTD),cnt);
      psz = (char *)szWork;
    }
    WrapTextOut(hdc,&x,&y,psz,0,4,dx + -8,&xMax,0,fPrint);
  }
POPUP_OutOfFor:
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 2;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayString
// Address: 10c0:355c
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayString(HDC hdc,short dx,short fPrint)

{
  POINT PVar1;
  short x;
  short xMax;
  short y;
  
  xMax = 4;
  x = 4;
  y = 2;
  SelectObject(hdc,rghfontArial8[0]);
  WrapTextOut
            (hdc,&x,&y,(char *)GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2,0,4,dx + -8,
             &xMax,0,fPrint);
  PVar1.x = xMax + 4;
  PVar1.y = y + dyArial8 + 2;
  return PVar1;
}



