// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: PopupWndProc
// Address: 10c0:0000
// Segment: MEMORY_POPUP
// ======================================================================


long PopupWndProc(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  HDC hdc_00;
  undefined2 unaff_SS;
  LRESULT LVar1;
  RECT rc;
  PAINTSTRUCT ps;
  HDC hdc;
  
  if (message != WM_CREATE) {
    if (message != WM_PAINT) {
      if (message == WM_ERASEBKGND) {
        if (((GlobalPD.grPopup == 9) || (GlobalPD.grPopup == 0xb)) ||
           (GlobalPD.grPopup == 0xe)) {
          GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
          FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
          return 1;
        }
      }
      else if ((message == WM_LBUTTONUP) || (message == WM_RBUTTONUP)) {
        if (hwndPopup == 0) {
          return 0;
        }
        DestroyWindow(hwndPopup);
        hwndPopup = 0;
        GlobalPD.grPopup = 0;
        ReleaseCapture();
        if (((uint)gd._0_2_ >> 0xb & 1) == 0) {
          return 0;
        }
        tutor.wFlags = tutor.wFlags & 0xfbffU | 0x400;
        AdvanceTutor();
        return 0;
      }
      LVar1 = DefWindowProc(hwnd,message,wParam,lParam);
      return LVar1;
    }
    hdc_00 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
    DrawPopup(hwnd,hdc_00);
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,&ps));
  }
  return 0;
}



// ======================================================================
// Function: FIsPopupHullType
// Address: 10c0:0148
// Segment: MEMORY_POPUP
// ======================================================================


short FIsPopupHullType(short ishdef)

{
  uint uVar1;
  int iVar2;
  HULDEF *pHVar3;
  ushort imd;
  
  if ((GlobalPD.iPlanMax == 0) || (GlobalPD.iPlanMax == 0xff)) {
    uVar1 = 1;
  }
  else {
    iVar2 = *(int *)(GlobalPD._2_2_ + 2) * 4;
    pHVar3 = LphuldefFromId(*(HullDef *)(*(int *)(iVar2 + 0xfe) + ishdef * 0x93));
    uVar1 = *(uint *)(((uint)((HULDEF *)pHVar3)->wFlags >> 10 & 0xf) * 2 + 0x138) &
            GlobalPD.iPlanMax;
  }
  return uVar1;
}



// ======================================================================
// Function: DrawPopup
// Address: 10c0:01c0
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c002d5) */
/* WARNING: Removing unreachable block (ram,0x10c00457) */
/* WARNING: Variable defined which should be unmapped: lpsz */

void DrawPopup(HWND hwnd,HDC hdc)

{
  short sVar1;
  HGDIOBJ HVar2;
  StringId ids;
  int iVar3;
  char *pcVar4;
  ushort uVar5;
  int iVar6;
  char *pcVar7;
  ushort unaff_SI;
  uint unaff_DI;
  char *unaff_SS;
  COLORREF CVar8;
  COLORREF CVar9;
  ulong num;
  long lVar10;
  DWORD DVar11;
  undefined2 uVar12;
  undefined1 *puVar13;
  undefined2 uVar14;
  HDC HVar15;
  short sVar16;
  short sVar17;
  char szTB [40];
  short dpT;
  short csh;
  char *lpsz;
  RECT rc;
  COLORREF crFore;
  short dx;
  char *psz;
  HFONT hfontSav;
  short bkMode;
  short c;
  short i;
  short yCur;
  char szT [80];
  COLORREF crBack;
  
  CVar8 = SetBkColor(hdc,0xffffff);
  CVar9 = SetTextColor(hdc,0);
  sVar1 = SetBkMode(hdc,2);
  HVar2 = SelectObject(hdc,rghfontArial8[1]);
  GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
  switch(GlobalPD.grPopup) {
  case 1:
    sVar16 = 0;
    lVar10 = __aFlshl((ulong)unaff_DI << 0x10,unaff_SI);
    CtrTextOut(hdc,rc.right >> 1,4,(char *)*(undefined2 *)((int)lVar10 + 0x4cc),sVar16);
    SelectObject(hdc,rghfontArial8[0]);
    pcVar7 = PszGetCompressedString(idsMineralConcentration);
    puVar13 = (undefined1 *)&DAT_1120_1120;
    HVar15 = hdc;
    uVar5 = _strlen(pcVar7);
    DVar11 = GetTextExtent(HVar15,(LPCSTR)CONCAT22(puVar13,pcVar7),uVar5);
    iVar3 = (int)DVar11 + 4;
    sVar17 = 0;
    sVar16 = 0;
    pcVar7 = PszGetCompressedString(idsSurface);
    RightTextOut(hdc,iVar3,dyArial8 + 4,pcVar7,sVar16,sVar17);
    if (GlobalPD.iPlrVal < 0) {
      pcVar7 = PszGetCompressedString(idsUnknown2);
      _strcpy((char *)szWork,pcVar7);
      c = _strlen((char *)szWork);
    }
    else {
      c = _WSPRINTF((LPSTR)CONCAT22(GlobalPD.iPlanMax,(char *)&DAT_1120_1120),
                    (LPCSTR)0xbee1120,(char *)szWork);
    }
    TextOut(hdc,iVar3,dyArial8 + 4,szWork,c);
    sVar17 = 0;
    sVar16 = 0;
    pcVar7 = PszGetCompressedString(idsMineralConcentration);
    RightTextOut(hdc,iVar3,dyArial8 * 2 + 4,pcVar7,sVar16,sVar17);
    if ((GlobalPD.iPlrMax < 0) ||
       ((GlobalPD.iPlrMax < 1 && (GlobalPD.iPlrMin == 0)))) {
      pcVar7 = PszGetCompressedString(idsUnknown2);
      c = _WSPRINTF((LPSTR)CONCAT22(unaff_DI,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),(char *)szWork);
    }
    else {
      c = _WSPRINTF((LPSTR)CONCAT22(GlobalPD.iPlrMin,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),(char *)szWork);
      if ((GlobalPD.iPlanVal != 0) || (GlobalPD.iPlanMin != 0)) {
        if ((GlobalPD.iPlrMax < 0) ||
           ((GlobalPD.iPlrMax < 1 && ((uint)GlobalPD.iPlrMin < 0x1e)))) {
          ids = idsN30;
        }
        else {
          ids = idsHw;
        }
        pcVar7 = PszGetCompressedString(ids);
        iVar6 = _WSPRINTF((LPSTR)CONCAT22(unaff_DI,(char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),
                          (char *)szWork + c);
        c = c + iVar6;
      }
    }
    TextOut(hdc,iVar3,dyArial8 * 2 + 4,szWork,c);
    if (-1 < (int)GlobalPD._20_2_) {
      sVar17 = 0;
      sVar16 = 0;
      pcVar7 = PszGetCompressedString(idsMiningRate);
      RightTextOut(hdc,iVar3,dyArial8 * 3 + 4,pcVar7,sVar16,sVar17);
      CchGetString(idsLdktYr,szT);
      sVar16 = _WSPRINTF((LPSTR)CONCAT22(GlobalPD._18_2_,unaff_SS),
                         (LPCSTR)CONCAT22(szT,(char *)&DAT_1120_1120),(char *)szWork);
      TextOut(hdc,iVar3,dyArial8 * 3 + 4,szWork,sVar16);
    }
    break;
  case 2:
    sVar16 = 0;
    pcVar7 = PszPlayerName(GlobalPD._2_2_,1,1,1,0,(PLAYER *)0x0);
    CtrTextOut(hdc,rc.right >> 1,4,pcVar7,sVar16);
    iVar3 = GlobalPD._2_2_ + 1;
    pcVar7 = PszGetCompressedString(idsPlayerD);
    sVar16 = _WSPRINTF((LPSTR)CONCAT22(iVar3,(char *)&DAT_1120_1120),
                       (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),(char *)szWork);
    CtrTextOut(hdc,rc.right >> 1,dyArial8 + 4,(char *)szWork,sVar16);
    break;
  case 3:
    if (rc.bottom - rc.top < dyArial8 * 2) {
      sVar16 = CchGetString(idsNone2,(char *)szWork);
      TextOut(hdc,4,4,szWork,sVar16);
      SelectObject(hdc,rghfontArial8[0]);
    }
    else {
      SelectObject(hdc,rghfontArial8[1]);
      sVar16 = CchGetString(idsShipName,(char *)szWork);
      TextOut(hdc,4,4,szWork,sVar16);
      RightTextOut(hdc,(rc.right + -4) - GlobalPD.iPlanMin,4,(char *)0xbf4,1,0);
      if (GlobalPD.iPlanMin != 0) {
        sVar16 = CchGetString(idsDamage2,(char *)szWork);
        RightTextOut(hdc,rc.right + -4,4,(char *)szWork,sVar16,0);
        PatBlt(hdc,4,dyArial8 + 2,rc.right + -8,1,0x42);
      }
      SelectObject(hdc,rghfontArial8[0]);
      yCur = dyArial8 + 4;
      for (i = 0; i < 0x10; i = i + 1) {
        if ((0 < *(int *)(GlobalPD._2_2_ + 0xc + i * 2)) &&
           ((GlobalPD.iPlanMax == 0 || (sVar16 = FIsPopupHullType(i), sVar16 != 0)))) {
          if (GlobalPD.iPlanVal != 0) {
            if (*(int *)(GlobalPD._2_2_ + 0x2c + i * 2) == 0) {
              SetTextColor(hdc,0);
            }
            else {
              SetTextColor(hdc,0xff);
            }
          }
          DecorateHullName(*(uint *)GlobalPD._2_4_ >> 9 & 0xf,i,szTB);
          pcVar7 = szTB;
          sVar17 = 4;
          pcVar4 = unaff_SS;
          sVar16 = yCur;
          HVar15 = hdc;
          uVar5 = __fstrlen((char *)CONCAT22(unaff_SS,pcVar7));
          TextOut(HVar15,sVar17,sVar16,(LPCSTR)CONCAT22(pcVar4,pcVar7),uVar5);
          sVar16 = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(GlobalPD._2_2_ + 0xc + i * 2),
                                             (char *)&DAT_1120_1120),
                             (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                             (char *)szWork);
          RightTextOut
                    (hdc,(rc.right + -4) - GlobalPD.iPlanMin,yCur,(char *)szWork,
                     sVar16,0);
          if (GlobalPD.iPlanVal != 0) {
            if (*(int *)(GlobalPD._2_2_ + 0x2c + i * 2) != 0) {
              uVar14 = 0;
              uVar12 = 100;
              num = __aFulmul((ulong)(*(uint *)(GlobalPD._2_2_ + 0x2c + i * 2) & 0x7f
                                             ),(long)*(int *)(GlobalPD._2_2_ + 0xc + i * 2));
              lVar10 = __aFldiv(num,CONCAT22(uVar14,uVar12));
              csh = (short)lVar10;
              if (csh < 1) {
                csh = 1;
              }
              sVar16 = _WSPRINTF((LPSTR)CONCAT22(csh,(char *)&DAT_1120_1120),(LPCSTR)0xbf61120,
                                 (char *)szWork);
              RightTextOut(hdc,rc.right + -4,yCur,(char *)szWork,sVar16,0);
            }
          }
          yCur = yCur + dyArial8;
        }
      }
      if (GlobalPD.iPlanVal != 0) {
        SetTextColor(hdc,0);
      }
    }
    break;
  case 4:
    pcVar4 = PszGetCompressedString(idsPlanet);
    puVar13 = (undefined1 *)&DAT_1120_1120;
    pcVar7 = pcVar4;
    HVar15 = hdc;
    uVar5 = _strlen(pcVar4);
    DVar11 = GetTextExtent(HVar15,(LPCSTR)CONCAT22(puVar13,pcVar7),uVar5);
    iVar6 = (int)DVar11 + 4;
    SelectObject(hdc,rghfontArial8[1]);
    sVar16 = 0;
    uVar5 = _strlen(pcVar4);
    RightTextOut(hdc,iVar6,4,pcVar4,uVar5,sVar16);
    sVar17 = 0;
    sVar16 = 0;
    pcVar7 = PszGetCompressedString(idsId);
    RightTextOut(hdc,iVar6,dyArial8 + 4,pcVar7,sVar16,sVar17);
    sVar17 = 0;
    sVar16 = 0;
    pcVar7 = PszGetCompressedString(idsX);
    RightTextOut(hdc,iVar6,dyArial8 * 2 + 4,pcVar7,sVar16,sVar17);
    sVar17 = 0;
    sVar16 = 0;
    pcVar7 = PszGetCompressedString(idsY);
    RightTextOut(hdc,iVar6,dyArial8 * 3 + 4,pcVar7,sVar16,sVar17);
    pcVar7 = PszGetPlanetName(sel.scan.idpl);
    SelectObject(hdc,rghfontArial8[0]);
    sVar16 = 4;
    puVar13 = (undefined1 *)&DAT_1120_1120;
    iVar3 = iVar6;
    HVar15 = hdc;
    uVar5 = _strlen(pcVar7);
    TextOut(HVar15,iVar3,sVar16,(LPCSTR)CONCAT22(puVar13,pcVar7),uVar5);
    sVar16 = _WSPRINTF((LPSTR)CONCAT22(sel.scan.idpl + 1,(char *)&DAT_1120_1120),
                       (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork
                      );
    TextOut(hdc,iVar6,dyArial8 + 4,szWork,sVar16);
    sVar16 = _WSPRINTF((LPSTR)CONCAT22(sel.scan.pt.x,(char *)&DAT_1120_1120),
                       (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork
                      );
    TextOut(hdc,iVar6,dyArial8 * 2 + 4,szWork,sVar16);
    sVar16 = _WSPRINTF((LPSTR)CONCAT22(sel.scan.pt.y,(char *)&DAT_1120_1120),
                       (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork
                      );
    TextOut(hdc,iVar6,dyArial8 * 3 + 4,szWork,sVar16);
    break;
  case 5:
    PtDisplayPlanetStateInfo(hdc,1);
    break;
  case 6:
    PtDisplayZipOrdInfo(hdc,rc.right >> 1,1);
    break;
  case 7:
    PtDisplayPlanetPopInfo(hdc,1);
    break;
  case 8:
    PtDisplayFactoryMineInfo(hdc,rc.right,1);
    break;
  case 9:
    DisplayComponentInfo(hdc,rc.right,rc.bottom,(PART *)&GlobalPD.field1_0x2);
    break;
  case 10:
    PtDisplayString(hdc,rc.right,1);
    break;
  case 0xb:
  case 0xe:
    fStarbaseMode = (short)(0x1f < *(int *)GlobalPD._2_4_);
    DrawSlotDlg(hwnd,hdc,&rc,-1);
    rc.top = dyArial8 + 0x132;
    rc.left = rc.left + 6;
    SelectObject(hdc,rghfontArial8[1]);
    SetBkMode(hdc,1);
    __fstrcpy(szWork,
                      (char *)CONCAT22(GlobalPD.psz,(char *)(GlobalPD._2_2_ + 8)));
    CtrTextOut(hdc,(rc.right + -0x4c >> 1) + 0x4c,6,(char *)szWork,0);
    DrawBuildSelHull(hwnd,hdc,-1,&rc);
    break;
  case 0xc:
    PtDisplayResourceInfo(hdc,rc.right,1);
    break;
  default:
  }
  SelectObject(hdc,HVar2);
  SetBkMode(hdc,sVar1);
  SetTextColor(hdc,CVar9);
  SetBkColor(hdc,CVar8);
  return;
}



// ======================================================================
// Function: Popup
// Address: 10c0:0c7c
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c00d16) */

void Popup(HWND hwnd,short x,short y)

{
  HDC hdc_00;
  HGDIOBJ HVar1;
  char *pcVar2;
  ushort uVar3;
  int iVar4;
  short sVar5;
  uint uVar6;
  undefined2 unaff_SS;
  char *pcVar7;
  DWORD DVar8;
  DWORD DVar9;
  POINT PVar10;
  undefined2 uVar11;
  undefined1 *puVar12;
  HDC HVar13;
  char szTB [40];
  char *psz_3;
  short dxR;
  short dxCoord;
  char *psz_4;
  short dxName;
  POINT ptT;
  short dx;
  char *psz;
  HFONT hfontSav;
  short c;
  short i;
  short dy;
  POINT pt;
  HDC hdc;
  
  pt.x = x;
  pt.y = y;
  ClientToScreen(hwnd,(undefined2 *)CONCAT22(unaff_SS,&pt));
  hdc_00 = GetDC(hwnd);
  HVar1 = SelectObject(hdc_00,rghfontArial8[0]);
  switch(GlobalPD.grPopup) {
  case 1:
    pcVar2 = PszGetCompressedString(idsMineralConcentration0000000kt);
    puVar12 = (undefined1 *)&DAT_1120_1120;
    HVar13 = hdc_00;
    uVar3 = _strlen(pcVar2);
    DVar8 = GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
    dx = (int)DVar8 + 8;
    dy = dyArial8 * 3 + 8;
    if (-1 < (int)GlobalPD._20_2_) {
      dy = dy + dyArial8;
    }
    break;
  case 2:
    SelectObject(hdc_00,rghfontArial8[1]);
    pcVar2 = PszPlayerName(GlobalPD._2_2_,1,1,1,0,(PLAYER *)0x0);
    puVar12 = (undefined1 *)&DAT_1120_1120;
    HVar13 = hdc_00;
    uVar3 = _strlen(pcVar2);
    DVar8 = GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
    iVar4 = (int)DVar8 + 8;
    DVar8 = GetTextExtent(hdc_00,s_Player__16_1120_0bfe,10);
    dx = (int)DVar8 + 8;
    if (dx <= iVar4) {
      dx = iVar4;
    }
    dy = dyArial8 * 2 + 8;
    break;
  case 3:
    dxR = 0;
    dxName = 0;
    dy = dyArial8 + 8;
    SelectObject(hdc_00,rghfontArial8[1]);
    pcVar2 = PszGetCompressedString(idsShipName);
    puVar12 = (undefined1 *)&DAT_1120_1120;
    HVar13 = hdc_00;
    uVar3 = _strlen(pcVar2);
    pcVar7 = (char *)GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
    psz_4 = (char *)pcVar7;
    SelectObject(hdc_00,rghfontArial8[0]);
    for (i = 0; i < 0x10; i = i + 1) {
      if ((0 < *(int *)(GlobalPD._2_2_ + 0xc + i * 2)) &&
         ((GlobalPD.iPlanMax == 0 || (sVar5 = FIsPopupHullType(i), sVar5 != 0)))) {
        dy = dy + dyArial8;
        DecorateHullName(*(uint *)GlobalPD._2_4_ >> 9 & 0xf,i,szTB);
        pcVar2 = szTB;
        uVar11 = unaff_SS;
        HVar13 = hdc_00;
        uVar3 = __fstrlen((char *)CONCAT22(unaff_SS,pcVar2));
        pcVar7 = (char *)GetTextExtent(HVar13,(LPCSTR)CONCAT22(uVar11,pcVar2),uVar3);
        if ((int)psz_4 <= (int)(char *)pcVar7) {
          psz_4 = (char *)pcVar7;
        }
        sVar5 = _WSPRINTF((LPSTR)CONCAT22(*(undefined2 *)(GlobalPD._2_2_ + 0xc + i * 2),
                                          (char *)&DAT_1120_1120),
                          (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                          (char *)szWork);
        DVar8 = GetTextExtent(hdc_00,szWork,sVar5);
        if (dxR <= (int)DVar8) {
          dxR = (int)DVar8;
        }
        if (GlobalPD.iPlanVal != 0) {
          if ((*(uint *)(GlobalPD._2_2_ + 0x2c + i * 2) >> 7 != 0) && (dxName == 0)) {
            pcVar2 = PszGetCompressedString(idsN9999999);
            puVar12 = (undefined1 *)&DAT_1120_1120;
            HVar13 = hdc_00;
            uVar3 = _strlen(pcVar2);
            DVar8 = GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
            dxName = (int)DVar8 + 4;
          }
        }
      }
    }
    if (dy == dyArial8 + 8) {
      pcVar2 = PszGetCompressedString(idsShipName);
      puVar12 = (undefined1 *)&DAT_1120_1120;
      HVar13 = hdc_00;
      uVar3 = _strlen(pcVar2);
      pcVar7 = (char *)GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
      psz_4 = (char *)pcVar7;
    }
    GlobalPD.iPlanMin = dxName;
    dx = (short)(psz_4 + dxName + dxR + 0x10);
    break;
  case 4:
    SelectObject(hdc_00,rghfontArial8[1]);
    dy = dyArial8 * 4 + 8;
    pcVar2 = PszGetCompressedString(idsPlanet);
    puVar12 = (undefined1 *)&DAT_1120_1120;
    HVar13 = hdc_00;
    uVar3 = _strlen(pcVar2);
    DVar8 = GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
    pcVar2 = PszGetPlanetName(sel.scan.idpl);
    SelectObject(hdc_00,rghfontArial8[0]);
    puVar12 = (undefined1 *)&DAT_1120_1120;
    HVar13 = hdc_00;
    uVar3 = _strlen(pcVar2);
    DVar9 = GetTextExtent(HVar13,(LPCSTR)CONCAT22(puVar12,pcVar2),uVar3);
    iVar4 = (int)DVar9;
    HVar13 = hdc_00;
    pcVar2 = PszGetCompressedString(idsN9999);
    DVar9 = GetTextExtent(HVar13,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2),4);
    if (iVar4 <= (int)DVar9) {
      iVar4 = (int)DVar9;
    }
    dx = (int)DVar8 + 8 + iVar4;
    break;
  case 5:
    PVar10 = PtDisplayPlanetStateInfo(hdc_00,0);
    goto POPUP_SetDxDy;
  case 6:
    PVar10 = PtDisplayZipOrdInfo(hdc_00,0,0);
    goto POPUP_SetDxDy;
  case 7:
    PVar10 = PtDisplayPlanetPopInfo(hdc_00,0);
    goto POPUP_SetDxDy;
  case 8:
    PVar10 = PtDisplayFactoryMineInfo(hdc_00,200,0);
    goto POPUP_SetDxDy;
  case 9:
    if (dyArial8 < 0xf) {
      iVar4 = 0;
    }
    else {
      iVar4 = 0x28;
    }
    dx = iVar4 + 0x158;
    dy = dyArial10 + dyArial8 * 0xc + 0x4e;
    break;
  case 10:
    PVar10 = PtDisplayString(hdc_00,GlobalPD._2_2_,0);
    goto POPUP_SetDxDy;
  case 0xb:
  case 0xe:
    mdBuild = (short)(GlobalPD.grPopup != 0xb);
    lpshdefBuild._0_2_ = (SHDEF *)GlobalPD._2_2_;
    lpshdefBuild._2_2_ = GlobalPD.psz;
    UpdateSlotGlobals();
    dx = 0x154;
    dy = dyArial8 * 7 + 0x13a;
    if (((uint)gd._0_2_ >> 0xe != 0) && (GlobalPD.grPopup == 0xb)) {
      dy = dy + dyArial8 * 3;
    }
    break;
  case 0xc:
    PVar10 = PtDisplayResourceInfo(hdc_00,200,0);
POPUP_SetDxDy:
    ptT.y = PVar10.y;
    ptT.x = PVar10.x;
    dx = ptT.x + 2;
    dy = ptT.y + 2;
    break;
  case 0xd:
    dx = 0x78;
    dy = 0x50;
  }
  SelectObject(hdc_00,HVar1);
  ReleaseDC(hwnd,hdc_00);
  pt.x = pt.x - dx;
  pt.y = pt.y - dy;
  sVar5 = GetSystemMetrics(0);
  uVar6 = pt.x;
  if (sVar5 - dx <= pt.x) {
    sVar5 = GetSystemMetrics(0);
    uVar6 = sVar5 - dx;
  }
  if (uVar6 < 0x8000) {
    sVar5 = GetSystemMetrics(0);
    if (sVar5 - dx <= pt.x) {
      sVar5 = GetSystemMetrics(0);
      pt.x = sVar5 - dx;
    }
  }
  else {
    pt.x = 0;
  }
  sVar5 = GetSystemMetrics(1);
  uVar6 = pt.y;
  if (sVar5 - dy <= pt.y) {
    sVar5 = GetSystemMetrics(1);
    uVar6 = sVar5 - dy;
  }
  if (uVar6 < 0x8000) {
    sVar5 = GetSystemMetrics(1);
    if (sVar5 - dy <= pt.y) {
      sVar5 = GetSystemMetrics(1);
      pt.y = sVar5 - dy;
    }
  }
  else {
    pt.y = 0;
  }
  hwndPopup =
       CreateWindow(szPopup,(LPCSTR)0x0,0x90800000,pt.x,pt.y,dx,dy,hwnd,0,hInst,
                    (void *)0x0);
  SendMessage(hwndPopup,0x30,rghfontArial8[0],0);
  SetCapture(hwndPopup);
  return;
}



// ======================================================================
// Function: PopupMenu
// Address: 10c0:136c
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c01498) */
/* WARNING: Removing unreachable block (ram,0x10c0141e) */
/* WARNING: Removing unreachable block (ram,0x10c0144f) */
/* WARNING: Removing unreachable block (ram,0x10c014e1) */

short PopupMenu(HWND hwnd,short x,short y,short cString,long *rgids,char **rgsz,short iChecked,
                short fRightBtn)

{
  char *pcVar1;
  char *pcVar2;
  char cVar3;
  HMENU HVar4;
  uint uVar5;
  int iVar6;
  UINT UVar7;
  BOOL BVar8;
  int iVar9;
  undefined2 unaff_SS;
  char *psz_2;
  short fCheckedCur;
  short fChecked;
  MSG msg;
  char *psz;
  char *pszT;
  HMENU hmenuPopup;
  HMENU hmenuSub;
  char szTemp [128];
  short i;
  POINT pt;
  short tpm;
  char *pszTitle;
  
  hmenuSub = 0;
  pt.x = x;
  pt.y = y;
  ClientToScreen(hwnd,(undefined2 *)CONCAT22(unaff_SS,&pt));
  HVar4 = CreatePopupMenu();
  iPopMenuSel = -1;
  for (i = 0; i < cString; i = i + 1) {
    if ((rgids == (long *)0x0) || ((iChecked == -2 && (rgsz != (char **)0x0)))) {
      if (rgsz[i] == (char *)0x0) {
        pcVar2 = rgsz[i + 1];
        if (rgids == (long *)0x0) {
          fChecked = 0;
        }
        else {
          fChecked = (short)rgids[i + 1];
        }
        hmenuSub = CreatePopupMenu();
        for (i = i + 2; (i < cString && (rgsz[i] != (char *)0x0)); i = i + 1) {
          if (rgids == (long *)0x0) {
            fCheckedCur = (short)(i == iChecked);
            fChecked = fChecked | fCheckedCur;
          }
          else {
            fCheckedCur = (short)rgids[i];
          }
          if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
            AppendMenu(hmenuSub,0x800,0,(LPCSTR)0x0);
          }
          else {
            psz_2 = rgsz[i];
            pcVar1 = szTemp;
            while (pszT = pcVar1, *psz_2 != '\0') {
              pcVar1 = psz_2 + 1;
              cVar3 = *psz_2;
              *pszT = cVar3;
              psz_2 = pcVar1;
              pcVar1 = pszT + 1;
              if (cVar3 == '&') {
                pszT[1] = '&';
                pcVar1 = pszT + 2;
              }
            }
            *pszT = '\0';
            if (fCheckedCur == 0) {
              UVar7 = 0;
            }
            else {
              UVar7 = 8;
            }
            AppendMenu(hmenuSub,UVar7,i + 15000,(LPCSTR)CONCAT22(unaff_SS,szTemp));
          }
        }
        if (fChecked == 0) {
          uVar5 = 0;
        }
        else {
          uVar5 = 8;
        }
        AppendMenu(HVar4,uVar5 | 0x10,hmenuSub,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2)
                  );
      }
      else if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
        AppendMenu(HVar4,0x800,0,(LPCSTR)0x0);
      }
      else {
        psz = rgsz[i];
        pcVar2 = szTemp;
        while (pszT = pcVar2, *psz != '\0') {
          pcVar2 = psz + 1;
          cVar3 = *psz;
          *pszT = cVar3;
          psz = pcVar2;
          pcVar2 = pszT + 1;
          if (cVar3 == '&') {
            pszT[1] = '&';
            pcVar2 = pszT + 2;
          }
        }
        *pszT = '\0';
        if (iChecked == -2) {
          iVar6 = (int)rgids[i];
          iVar9 = *(int *)((int)(rgids + i) + 2);
        }
        else if (i == iChecked) {
          iVar6 = 1;
          iVar9 = 0;
        }
        else {
          iVar6 = 0;
          iVar9 = 0;
        }
        if ((iVar6 == 0) && (iVar9 == 0)) {
          UVar7 = 0;
        }
        else {
          UVar7 = 8;
        }
        AppendMenu(HVar4,UVar7,i + 15000,(LPCSTR)CONCAT22(unaff_SS,szTemp));
      }
    }
    else if (((int)rgids[i] == -1) && (*(int *)((int)(rgids + i) + 2) == -1)) {
      AppendMenu(HVar4,0x800,0,(LPCSTR)0x0);
    }
    else {
      if ((*(uint *)((int)rgids + i * 4 + 2) & 0x1000) == 0) {
        if ((*(uint *)((int)rgids + i * 4 + 2) & 0x4000) == 0) {
          if ((*(uint *)((int)rgids + i * 4 + 2) & 0x2000) == 0) {
            if ((*(uint *)((int)rgids + i * 4 + 2) & 0x8000) == 0) {
              psz = PszGetPlanetName((short)rgids[i]);
            }
            else {
              psz = PszGetFleetName(*(uint *)(rgids + i) | 0x8000);
            }
          }
          else {
            psz = PszGetThingName((short)rgids[i]);
          }
        }
        else {
          psz = PszGetCompressedString(*(StringId *)(rgids + i));
        }
      }
      else {
        psz = (char *)s_Deep_Space_1120_0c09;
      }
      pcVar2 = szTemp;
      while (pszT = pcVar2, *psz != '\0') {
        pcVar2 = psz + 1;
        cVar3 = *psz;
        *pszT = cVar3;
        psz = pcVar2;
        pcVar2 = pszT + 1;
        if (cVar3 == '&') {
          pszT[1] = '&';
          pcVar2 = pszT + 2;
        }
      }
      *pszT = '\0';
      if (i == iChecked) {
        UVar7 = 8;
      }
      else {
        UVar7 = 0;
      }
      AppendMenu(HVar4,UVar7,i + 15000,(LPCSTR)CONCAT22(unaff_SS,szTemp));
    }
  }
  if (fRightBtn == 0) {
    tpm = 0;
  }
  else {
    tpm = 2;
  }
  TrackPopupMenu(HVar4,tpm,pt.x,pt.y,0,hwndFrame,(undefined2 *)0x0);
  DestroyMenu(HVar4);
  if (hmenuSub != 0) {
    DestroyMenu(hmenuSub);
  }
  BVar8 = PeekMessage((undefined2 *)CONCAT22(unaff_SS,&msg),hwndFrame,0x111,0x111,2);
  if (((BVar8 != 0) && (14999 < (uint)msg.wParam)) && ((uint)msg.wParam < 0x3afc)) {
    iPopMenuSel = msg.wParam + -15000;
  }
  return iPopMenuSel;
}



// ======================================================================
// Function: PtDisplayPlanetStateInfo
// Address: 10c0:1938
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayPlanetStateInfo(HDC hdc,short fPrint)

{
  char *pcVar1;
  int iVar2;
  short sVar3;
  char *unaff_SS;
  PLANET *lppl;
  POINT PVar4;
  short sVar5;
  short *psVar6;
  short sVar7;
  short sVar8;
  char acStack_6e [82];
  int iStack_1c;
  short sStack_1a;
  int iStack_18;
  short dChg;
  int iStack_14;
  short ids;
  short x;
  short cch;
  short xMax;
  short y;
  POINT pt;
  
  y = 4;
  xMax = 4;
  x = 4;
  SelectObject(hdc,rghfontArial8[1]);
  DxStreamTextOut
            (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
  SelectObject(hdc,rghfontArial8[0]);
  sVar7 = 0;
  sVar3 = fPrint;
  pcVar1 = PszGetCompressedString(idsCurrently);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
  SelectObject(hdc,rghfontArial8[1]);
  if (GlobalPD.iPlanVal < 0) {
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsUnknown2);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
  }
  else {
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlanVal);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
  }
  SelectObject(hdc,rghfontArial8[0]);
  DxStreamTextOut(hdc,&x,y,(char *)0xc14,1,fPrint);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if (GlobalPD.iPlrMin == -1) {
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsColonistsImmune);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsEffects);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
    DxStreamTextOut(hdc,&x,y,(char *)0xc16,1,fPrint);
  }
  else {
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsColonistsPreferPlanetsWhere);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsBetween);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[1]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlrMin);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[0]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsAnd);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[1]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlrMax);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc18,1,fPrint);
  }
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if ((uint)GlobalPD.iPlanMin < 0x8000) {
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsCurrentlyPossessTechnology);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsModify);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    DxStreamTextOut
              (hdc,&x,y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,fPrint);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsOn2);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[1]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[0]);
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsWithinRange);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[1]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlanMin);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[0]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsTo);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[1]);
    sVar7 = 0;
    sVar3 = fPrint;
    pcVar1 = PszCalcEnvVar((short)GlobalPD.psz,GlobalPD.iPlanMax);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar7,sVar3);
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc1a,1,fPrint);
    if (xMax < x) {
      xMax = x;
    }
    y = y + dyArial8;
  }
  x = 4;
  if ((((uint)GlobalPD.iPlanMin < 0x8000) && (GlobalPD.iPlrMin != -1)) &&
     (GlobalPD.iPlanVal != GlobalPD.iPlrVal)) {
    ids = -1;
    if (GlobalPD.iPlanVal < GlobalPD.iPlrVal) {
      if ((GlobalPD.iPlanVal < GlobalPD.iPlanMax) &&
         (ids = GlobalPD.iPlrVal, GlobalPD.iPlanMax <= GlobalPD.iPlrVal)) {
        ids = GlobalPD.iPlanMax;
      }
    }
    else if ((GlobalPD.iPlanMin < GlobalPD.iPlanVal) &&
            (ids = GlobalPD.iPlrVal, GlobalPD.iPlrVal <= GlobalPD.iPlanMin)) {
      ids = GlobalPD.iPlanMin;
    }
    if (ids != -1) {
      lppl = LpplFromId(GlobalPD._2_2_);
      iStack_14 = (int)((ulong)lppl >> 0x10);
      dChg = (short)lppl;
      iStack_18 = PctPlanetDesirability(lppl,idPlayer);
      iStack_1c = (int)GlobalPD.psz[dChg + 0xc];
      GlobalPD.psz[dChg + 0xc] = (char)ids;
      sStack_1a = PctPlanetDesirability((PLANET *)CONCAT22(iStack_14,dChg),idPlayer);
      GlobalPD.psz[dChg + 0xc] = (char)iStack_1c;
      if (iStack_18 < sStack_1a) {
        cch = CchGetString(idsIfTerraform,(char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[1]);
        WrapTextOut
                  (hdc,&x,&y,(char *)*(undefined2 *)((int)GlobalPD.psz * 2 + 0x47e),0,4,
                   xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[0]);
        sVar8 = 0;
        psVar6 = (short *)0x0;
        iVar2 = xMax + -4;
        sVar5 = 4;
        sVar7 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsTo);
        WrapTextOut(hdc,&x,&y,pcVar1,sVar7,sVar5,iVar2,psVar6,sVar8,sVar3);
        SelectObject(hdc,rghfontArial8[1]);
        sVar8 = 0;
        psVar6 = (short *)0x0;
        iVar2 = xMax + -4;
        sVar5 = 4;
        sVar7 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar((short)GlobalPD.psz,ids);
        WrapTextOut(hdc,&x,&y,pcVar1,sVar7,sVar5,iVar2,psVar6,sVar8,sVar3);
        SelectObject(hdc,rghfontArial8[0]);
        cch = CchGetString(idsPlanetsValueWouldImprove,(char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
        SelectObject(hdc,rghfontArial8[1]);
        cch = _WSPRINTF((LPSTR)CONCAT22(sStack_1a,(char *)&DAT_1120_1120),(LPCSTR)0xc1c1120,
                        (char *)szWork);
        WrapTextOut
                  (hdc,&x,&y,(char *)szWork,cch,4,xMax + -4,(short *)0x0,0,fPrint);
      }
    }
  }
  if (((GlobalPD.iPlrMin != -1) && (GlobalPD.iPlanVal != GlobalPD.iPlrVal)) &&
     (GlobalPD.iPlanVal != -1)) {
    if (GlobalPD.iPlanVal < GlobalPD.iPlrMin) {
      iStack_14 = GlobalPD.iPlrMin - GlobalPD.iPlanVal;
    }
    else if (GlobalPD.iPlrMax < GlobalPD.iPlanVal) {
      iStack_14 = GlobalPD.iPlanVal - GlobalPD.iPlrMax;
    }
    else {
      sVar3 = _abs(GlobalPD.iPlanVal - GlobalPD.iPlrVal);
      iStack_14 = -sVar3;
    }
    if (iStack_14 < 0) {
      iStack_14 = -iStack_14;
      ids = 0x169;
    }
    else {
      ids = 0x168;
    }
    CchGetString(ids,(char *)szWork);
    cch = _WSPRINTF((LPSTR)CONCAT22(iStack_14,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22((char *)szWork,unaff_SS),acStack_6e);
    SelectObject(hdc,rghfontArial8[0]);
    WrapTextOut(hdc,&x,&y,acStack_6e,cch,4,xMax + -4,(short *)0x0,0,fPrint);
  }
  if (4 < x) {
    y = y + dyArial8;
  }
  PVar4.x = xMax + 4;
  PVar4.y = y + 4;
  return PVar4;
}



// ======================================================================
// Function: PtDisplayPlanetPopInfo
// Address: 10c0:228e
// Segment: MEMORY_POPUP
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10c02aa4) */
/* WARNING: Removing unreachable block (ram,0x10c027b6) */
/* WARNING: Removing unreachable block (ram,0x10c028dd) */
/* WARNING: Removing unreachable block (ram,0x10c02b7d) */

POINT PtDisplayPlanetPopInfo(HDC hdc,short fPrint)

{
  char *pcVar1;
  char *unaff_SS;
  long lVar2;
  POINT PVar3;
  short sVar4;
  short sVar5;
  long lPopChg;
  short x;
  short pctDesire;
  long lMax;
  char *psz;
  short c;
  short xMax;
  short y;
  POINT pt;
  char szT [150];
  PLANET pl;
  
  y = 4;
  xMax = 4;
  x = 4;
  FLookupPlanet(GlobalPD._2_2_,&pl);
  SelectObject(hdc,rghfontArial8[0]);
  if (pl.iPlayer == idPlayer) {
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsPopulation3);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[0]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsIs);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[1]);
    _WSPRINTF((LPSTR)CONCAT22((int)pl.rgwtMin[3],(char *)&DAT_1120_1120),
              (LPCSTR)CONCAT22(PCTLD00,(char *)&DAT_1120_1120),(char *)szWork);
    if (((int)pl.rgwtMin[3] == 0) && (pl.rgwtMin[3]._2_2_ == 0)) {
      szWork[1] = '\0';
    }
    DxStreamTextOut(hdc,&x,y,(char *)szWork,0,fPrint);
    SelectObject(hdc,rghfontArial8[0]);
    DxStreamTextOut(hdc,&x,y,(char *)0xc24,1,fPrint);
  }
  else if (pl.iPlayer == -1) {
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[0]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsUninhabited2);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
  }
  else {
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetCompressedString(idsEnemyPopulation);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[1]);
    sVar4 = 0;
    sVar5 = fPrint;
    pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
    DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    SelectObject(hdc,rghfontArial8[0]);
    if ((pl.wFlags & 0xffU) < 3) {
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsUnknown);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    }
    else {
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsApproximately);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      _WSPRINTF((LPSTR)CONCAT22((pl.uGuesses & 0xfffU) << 2,(char *)&DAT_1120_1120),
                (LPCSTR)0xc261120,(char *)szWork);
      if ((pl.uGuesses & 0xfffU) == 0) {
        szWork[1] = '\0';
      }
      DxStreamTextOut(hdc,&x,y,(char *)szWork,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
    }
    DxStreamTextOut(hdc,&x,y,(char *)0xc2b,1,fPrint);
  }
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  if (2 < (pl.wFlags & 0xffU)) {
    lMax = CalcPlanetMaxPop(GlobalPD._2_2_,idPlayer);
    pctDesire = PctPlanetDesirability((PLANET *)CONCAT22(unaff_SS,&pl),idPlayer);
    if (pctDesire < 0) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsWillKillOffApproximately);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      c = _WSPRINTF((LPSTR)CONCAT22(-pctDesire / 10,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTDXPCTDPCTPCT,(char *)&DAT_1120_1120),
                    (char *)szWork);
      DxStreamTextOut(hdc,&x,y,(char *)szWork,c,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsOf);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      if (pl.iPlayer == idPlayer) {
        sVar4 = 0;
        sVar5 = fPrint;
        pcVar1 = PszGetCompressedString(idsColonistsEachTurn);
        DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      }
      else {
        sVar4 = 0;
        sVar5 = fPrint;
        pcVar1 = PszGetCompressedString(idsColonistsSettleEveryTurn);
        DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      }
    }
    else if ((pl.iPlayer == idPlayer) && (0 < lMax)) {
      SelectObject(hdc,rghfontArial8[1]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsWillSupportPopulation);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      SelectObject(hdc,rghfontArial8[1]);
      c = _WSPRINTF((LPSTR)CONCAT22((undefined2)lMax,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTLD00,(char *)&DAT_1120_1120),(char *)szWork
                   );
      DxStreamTextOut(hdc,&x,y,(char *)szWork,c,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsColonists3);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    }
    else if (lMax < 1) {
      y = y - dyArial8;
    }
    else {
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsIfColonize);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetPlanetName(GlobalPD._2_2_);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsWould);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      if (xMax < x) {
        xMax = x;
      }
      x = 4;
      y = y + dyArial8;
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsSupport);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
      SelectObject(hdc,rghfontArial8[1]);
      c = _WSPRINTF((LPSTR)CONCAT22((undefined2)lMax,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTLD00,(char *)&DAT_1120_1120),(char *)szWork
                   );
      DxStreamTextOut(hdc,&x,y,(char *)szWork,c,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      sVar4 = 0;
      sVar5 = fPrint;
      pcVar1 = PszGetCompressedString(idsColonists3);
      DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,sVar5);
    }
    if (xMax < x) {
      xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    if (((pl.iPlayer == idPlayer) && (-1 < pctDesire)) &&
       (CONCAT22(pl.rgwtMin[3]._2_2_,(int)pl.rgwtMin[3]) < lMax)) {
      c = CchGetString(idsPopulation,szT);
      WrapTextOut(hdc,&x,&y,szT,c,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[1]);
      psz = PszGetPlanetName(pl.id);
      WrapTextOut(hdc,&x,&y,psz,0,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      lVar2 = ChgPopFromPlanet((PLANET *)CONCAT22(unaff_SS,&pl),0);
      if ((pctDesire == 0) || (lVar2 < 1)) {
        c = CchGetString(idsWillGrowYear,szT);
      }
      else {
        psz = PszGetCompressedString(idsWillGrowLd00Ld00Year);
        c = _WSPRINTF((LPSTR)CONCAT22((int)lVar2,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(psz,unaff_SS),szT);
      }
      WrapTextOut(hdc,&x,&y,szT,c,4,xMax,(short *)0x0,0,fPrint);
      y = y + dyArial8;
    }
    else if ((pl.iPlayer != idPlayer) && (pl.iPlayer != -1)) {
      SelectObject(hdc,rghfontArial8[1]);
      psz = PszGetPlanetName(pl.id);
      WrapTextOut(hdc,&x,&y,psz,0,4,xMax,(short *)0x0,0,fPrint);
      SelectObject(hdc,rghfontArial8[0]);
      if ((uint)pl.uGuesses >> 0xc == 0) {
        c = CchGetString(idsAppearsHavePlanetaryDefenses,(char *)szWork);
      }
      else {
        psz = PszGetCompressedString(idsHasPlanetaryDefensesApproximatelyDCoverage);
        c = _WSPRINTF((LPSTR)CONCAT22(((uint)pl.uGuesses >> 0xc) * 6 + 3,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(psz,unaff_SS),szT);
        psz = szT;
      }
      WrapTextOut(hdc,&x,&y,psz,c,4,xMax,(short *)0x0,0,fPrint);
      y = y + dyArial8;
    }
  }
  PVar3.x = xMax + 4;
  PVar3.y = y + 4;
  return PVar3;
}



// ======================================================================
// Function: PtDisplayZipOrdInfo
// Address: 10c0:2d66
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayZipOrdInfo(HDC hdc,short xCtr,short fPrint)

{
  ushort cLen;
  char *pcVar1;
  POINT PVar2;
  short sVar3;
  short sVar4;
  short x;
  char *psz;
  short xMax;
  short y;
  POINT pt;
  
  y = 4;
  xMax = 4;
  x = 4;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    psz = PszGetCompressedString(idsZipord);
    cLen = _strlen(psz);
    CtrTextOut(hdc,xCtr,y,psz,cLen);
  }
  y = y + dyArial8;
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsZipordProvidesAbilityQuicklySetFleets);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsTransportOrdersOne3CommonSetsSelect);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsZipordClickDiamondRightMouse);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8;
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsButtonClickOrderChoice);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + dyArial8 * 2;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsQuikload);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsLoadMineralsAvailable);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsQuikdrop);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsUnloadEverythingFleetCarrying);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsWaitload);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsWaitFullLoadMinerals);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  if (xMax < x) {
    xMax = x;
  }
  x = 4;
  y = y + (dyArial8 >> 1) + dyArial8;
  SelectObject(hdc,rghfontArial8[1]);
  sVar3 = 0;
  sVar4 = fPrint;
  pcVar1 = PszGetCompressedString(idsClear2);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar3,sVar4);
  SelectObject(hdc,rghfontArial8[0]);
  sVar4 = 0;
  pcVar1 = PszGetCompressedString(idsRemoveTransportOrders);
  DxStreamTextOut(hdc,&x,y,pcVar1,sVar4,fPrint);
  if (xMax < x) {
    xMax = x;
  }
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 4;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayFactoryMineInfo
// Address: 10c0:3110
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayFactoryMineInfo(HDC hdc,short dx,short fPrint)

{
  int dxWidth;
  short sVar1;
  StringId ids_00;
  char *unaff_SS;
  POINT PVar2;
  short x;
  short cnt;
  char *psz;
  short c;
  short i;
  short xMax;
  short y;
  char *pszType;
  short ids;
  POINT pt;
  char szT [40];
  char *pszTypes;
  
  ids = 0xcd;
  dxWidth = dx + -8;
  xMax = 4;
  x = 4;
  y = 2;
  if (GlobalPD.iPlanMax == 0) {
    pszType = (char *)0xc3f;
  }
  else {
    pszType = (char *)s_Factory_1120_0c2d;
  }
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    CchGetString(idsSInfo,szT);
    c = _WSPRINTF((LPSTR)CONCAT22(pszType,unaff_SS),(LPCSTR)CONCAT22(szT,(char *)&DAT_1120_1120),
                  (char *)szWork);
    CtrTextOut(hdc,dxWidth >> 1,y,(char *)szWork,c);
  }
  y = y + dyArial8 + 4;
  sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  if (sVar1 == raMacintosh) {
    SelectObject(hdc,rghfontArial8[0]);
    if (GlobalPD.iPlanMax == 0) {
      ids_00 = idsRaceIncapableBuildingMinesHoweverColonistsHave;
    }
    else {
      ids_00 = idsRaceIncapableBuildingFactories;
    }
    psz = PszGetCompressedString(ids_00);
    WrapTextOut(hdc,&x,&y,psz,0,4,dxWidth,&xMax,0,fPrint);
  }
  else {
    for (i = 0; i < 9; i = i + 1) {
      SelectObject(hdc,rghfontArial8[1]);
      switch(i) {
      case 0:
      case 2:
      case 4:
      case 6:
      case 8:
        SelectObject(hdc,rghfontArial8[0]);
        psz = PszGetCompressedString(ids);
        ids = ids + 1;
        break;
      case 1:
        cnt = GlobalPD.iPlanVal;
        goto POPUP_SetQuan_2;
      case 3:
        psz = PszGetPlanetName(GlobalPD._2_2_);
        break;
      case 5:
        cnt = (short)GlobalPD.psz;
POPUP_SetQuan_2:
        _WSPRINTF((LPSTR)CONCAT22(cnt,(char *)&DAT_1120_1120),(LPCSTR)0xc4a1120,
                  (char *)szWork);
        psz = (char *)szWork;
        break;
      case 7:
        _WSPRINTF((LPSTR)CONCAT22(GlobalPD.iPlanMin,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
        psz = (char *)szWork;
      }
      WrapTextOut(hdc,&x,&y,psz,0,4,dxWidth,&xMax,0,fPrint);
    }
  }
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 2;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayResourceInfo
// Address: 10c0:3378
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayResourceInfo(HDC hdc,short dx,short fPrint)

{
  short sVar1;
  ushort cLen;
  POINT PVar2;
  short x;
  short cnt;
  char *psz;
  short i;
  short xMax;
  short y;
  short ids;
  POINT pt;
  short iMax;
  
  sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer,rsMajorAdv);
  ids = 0xed;
  xMax = 4;
  x = 4;
  y = 2;
  SelectObject(hdc,rghfontArial8[1]);
  if (fPrint != 0) {
    psz = PszGetCompressedString(idsResourceInfo);
    cLen = _strlen(psz);
    CtrTextOut(hdc,dx + -8 >> 1,y,psz,cLen);
  }
  y = y + dyArial8 + 4;
  for (i = 0; i <= (int)((sVar1 == raMacintosh) + 8); i = i + 1) {
    SelectObject(hdc,rghfontArial8[1]);
    switch(i) {
    case 0:
      psz = PszGetPlanetName(GlobalPD._2_2_);
      break;
    case 1:
    case 3:
    case 5:
    case 8:
    case 9:
      goto switchD_10c0_34e2_caseD_1;
    case 2:
      cnt = (short)GlobalPD.psz;
      goto POPUP_SetQuan;
    case 4:
      cnt = (int)GlobalPD.psz - GlobalPD.iPlanVal;
      if (0 < cnt) goto POPUP_SetQuan;
      psz = PszGetCompressedString(idsNone2);
      break;
    case 6:
      if ((char *)GlobalPD.iPlanVal == GlobalPD.psz) goto POPUP_OutOfFor;
switchD_10c0_34e2_caseD_1:
      SelectObject(hdc,rghfontArial8[0]);
      psz = PszGetCompressedString(ids);
      ids = ids + 1;
      break;
    case 7:
      cnt = GlobalPD.iPlanVal;
POPUP_SetQuan:
      _WSPRINTF((LPSTR)CONCAT22(cnt,(char *)&DAT_1120_1120),
                (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),(char *)szWork);
      psz = (char *)szWork;
    }
    WrapTextOut(hdc,&x,&y,psz,0,4,dx + -8,&xMax,0,fPrint);
  }
POPUP_OutOfFor:
  PVar2.x = xMax + 4;
  PVar2.y = y + dyArial8 + 2;
  return PVar2;
}



// ======================================================================
// Function: PtDisplayString
// Address: 10c0:355c
// Segment: MEMORY_POPUP
// ======================================================================


POINT PtDisplayString(HDC hdc,short dx,short fPrint)

{
  POINT PVar1;
  short x;
  short xMax;
  short y;
  POINT pt;
  
  xMax = 4;
  x = 4;
  y = 2;
  SelectObject(hdc,rghfontArial8[0]);
  WrapTextOut(hdc,&x,&y,GlobalPD.psz,0,4,dx + -8,&xMax,0,fPrint);
  PVar1.x = xMax + 4;
  PVar1.y = y + dyArial8 + 2;
  return PVar1;
}



