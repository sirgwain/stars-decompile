// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
//

// ======================================================================
// Function: PopupWndProc
// Address: 10c0:0000
// Segment: MEMORY_POPUP
// ======================================================================

long PopupWndProc(HWND hwnd, WMType message, ushort wParam, long lParam)

{
    HDC         hdc_00;
    undefined2  unaff_SS;
    LRESULT     LVar1;
    RECT        rc;
    PAINTSTRUCT ps;
    HDC         hdc;

    if (message != WM_CREATE) {
        if (message != WM_PAINT) {
            if (message == WM_ERASEBKGND) {
                if (((GlobalPD.grPopup == 9) || (GlobalPD.grPopup == 0xb)) || (GlobalPD.grPopup == 0xe)) {
                    GetClientRect(hwnd, &rc);
                    FillRect(wParam, &rc, hbrButtonFace);
                    return 1;
                }
            } else if ((message == WM_LBUTTONUP) || (message == WM_RBUTTONUP)) {
                if (hwndPopup == 0) {
                    return 0;
                }
                DestroyWindow(hwndPopup);
                hwndPopup = 0;
                GlobalPD.grPopup = 0;
                ReleaseCapture();
                if (((uint)gd.grBits >> 0xb & 1) == 0) {
                    return 0;
                }
                tutor.wFlags = tutor.wFlags & 0xfbffU | 0x400;
                AdvanceTutor();
                return 0;
            }
            LVar1 = DefWindowProc(hwnd, message, wParam, lParam);
            return LVar1;
        }
        hdc_00 = BeginPaint(hwnd, &ps);
        DrawPopup(hwnd, hdc_00);
        EndPaint(hwnd, &ps);
    }
    return 0;
}

// ======================================================================
// Function: FIsPopupHullType
// Address: 10c0:0148
// Segment: MEMORY_POPUP
// ======================================================================

short FIsPopupHullType(short ishdef)

{
    uint    uVar1;
    int     iVar2;
    HULDEF *pHVar3;
    ushort  imd;

    if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) || (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0xff)) {
        uVar1 = 1;
    } else {
        iVar2 = ((FLEET *)GlobalPD.u_POPUPDATA_0x0002.lpfl)->iPlayer * 4;
        pHVar3 = LphuldefFromId(*(HullDef *)(*(int *)(iVar2 + rglpshdef) + ishdef * 0x93));
        uVar1 = *(uint *)((((HULDEF *)pHVar3)->wFlags_0x7b >> 10 & 0xf) * 2 + 0x138) & GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory;
    }
    return uVar1;
}

// ======================================================================
// Function: DrawPopup
// Address: 10c0:01c0
// Segment: MEMORY_POPUP
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10c002d5) */
/* WARNING: Removing unreachable block (ram,0x10c00457) */
/* WARNING: Variable defined which should be unmapped: lpsz */

void DrawPopup(HWND hwnd, HDC hdc)

{
    short       sVar1;
    HGDIOBJ     HVar2;
    int         iVar3;
    StringId    ids;
    char       *psz_00;
    ushort      uVar4;
    int         x;
    char       *pcVar5;
    ushort      unaff_SI;
    uint        unaff_DI;
    undefined2  unaff_SS;
    COLORREF    CVar6;
    COLORREF    CVar7;
    ulong       uVar8;
    long        lVar9;
    DWORD       DVar10;
    undefined2  uVar11;
    undefined1 *puVar12;
    undefined2  uVar13;
    HDC         HVar14;
    short       sVar15;
    short       sVar16;
    char        szTB[40];
    short       dpT;
    short       csh;
    char       *lpsz;
    RECT        rc;
    COLORREF    crFore;
    short       dx;
    char       *psz;
    HFONT       hfontSav;
    short       bkMode;
    short       c;
    short       i;
    short       yCur;
    char        szT[80];
    COLORREF    crBack;

    CVar6 = SetBkColor(hdc, 0xffffff);
    CVar7 = SetTextColor(hdc, 0);
    sVar1 = SetBkMode(hdc, 2);
    HVar2 = SelectObject(hdc, rghfontArial8[1]);
    GetClientRect(hwnd, &rc);
    switch (GlobalPD.grPopup) {
    case 1:
        sVar15 = 0;
        lVar9 = __aFlshl((ulong)unaff_DI << 0x10, unaff_SI);
        CtrTextOut(hdc, rc.right >> 1, 4, (char *)*(undefined2 *)((int)lVar9 + 0x4cc), sVar15);
        SelectObject(hdc, rghfontArial8[0]);
        pcVar5 = PszGetCompressedString(idsMineralConcentration);
        uVar11 = 0x1120;
        HVar14 = hdc;
        uVar4 = _strlen(pcVar5);
        DVar10 = GetTextExtent(HVar14, (LPCSTR)CONCAT22(uVar11, pcVar5), uVar4);
        iVar3 = (int)DVar10 + 4;
        sVar16 = 0;
        sVar15 = 0;
        pcVar5 = PszGetCompressedString(idsSurface);
        RightTextOut(hdc, iVar3, dyArial8 + 4, pcVar5, sVar15, sVar16);
        if ((int)GlobalPD.u_POPUPDATA_0x0002._10_2_ < 0) {
            pcVar5 = PszGetCompressedString(idsUnknown2);
            _strcpy((char *)szWork, pcVar5);
            c = _strlen((char *)szWork);
        } else {
            c = _wsprintf(szWork, s_ldkT_1120_0bee, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory,
                          GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary);
        }
        TextOut(hdc, iVar3, dyArial8 + 4, szWork, c);
        sVar16 = 0;
        sVar15 = 0;
        pcVar5 = PszGetCompressedString(idsMineralConcentration);
        RightTextOut(hdc, iVar3, dyArial8 * 2 + 4, pcVar5, sVar15, sVar16);
        if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 0) ||
            ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 1 && (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin == 0)))) {
            pcVar5 = PszGetCompressedString(idsUnknown2);
            c = _wsprintf(szWork, pcVar5);
        } else {
            c = _wsprintf(szWork, PCTLD, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax);
            if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) || (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate != 0)) {
                if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 0) ||
                    ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < 1 && ((uint)GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin < 0x1e)))) {
                    ids = idsN30;
                } else {
                    ids = idsHw;
                }
                pcVar5 = PszGetCompressedString(ids);
                sVar15 = _wsprintf((char *)szWork + c, pcVar5);
                c = c + sVar15;
            }
        }
        TextOut(hdc, iVar3, dyArial8 * 2 + 4, szWork, c);
        if (-1 < (int)GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_) {
            sVar16 = 0;
            sVar15 = 0;
            pcVar5 = PszGetCompressedString(idsMiningRate);
            RightTextOut(hdc, iVar3, dyArial8 * 3 + 4, pcVar5, sVar15, sVar16);
            CchGetString(idsLdktYr, szT);
            sVar15 = _wsprintf(szWork, szT, GlobalPD.u_POPUPDATA_0x0002.rgi[4]._0_2_, GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_);
            TextOut(hdc, iVar3, dyArial8 * 3 + 4, szWork, sVar15);
        }
        break;
    case 2:
        sVar15 = 0;
        pcVar5 = PszPlayerName(GlobalPD.u_POPUPDATA_0x0002.dxOut, 1, 1, 1, 0, (PLAYER *)0x0);
        CtrTextOut(hdc, rc.right >> 1, 4, pcVar5, sVar15);
        puVar12 = (undefined1 *)((int)&(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->id + 1);
        pcVar5 = PszGetCompressedString(idsPlayerD);
        sVar15 = _wsprintf(szWork, pcVar5, puVar12);
        CtrTextOut(hdc, rc.right >> 1, dyArial8 + 4, (char *)szWork, sVar15);
        break;
    case 3:
        if (rc.bottom - rc.top < dyArial8 * 2) {
            sVar15 = CchGetString(idsNone2, (char *)szWork);
            TextOut(hdc, 4, 4, szWork, sVar15);
            SelectObject(hdc, rghfontArial8[0]);
        } else {
            SelectObject(hdc, rghfontArial8[1]);
            sVar15 = CchGetString(idsShipName, (char *)szWork);
            TextOut(hdc, 4, 4, szWork, sVar15);
            RightTextOut(hdc, (rc.right + -4) - GlobalPD.u_POPUPDATA_0x0002._6_2_, 4, (char *)0xbf4, 1, 0);
            if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate != 0) {
                sVar15 = CchGetString(idsDamage2, (char *)szWork);
                RightTextOut(hdc, rc.right + -4, 4, (char *)szWork, sVar15, 0);
                PatBlt(hdc, 4, dyArial8 + 2, rc.right + -8, 1, 0x42);
            }
            SelectObject(hdc, rghfontArial8[0]);
            yCur = dyArial8 + 4;
            for (i = 0; i < 0x10; i = i + 1) {
                if ((0 < (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]) &&
                    ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0 || (sVar15 = FIsPopupHullType(i), sVar15 != 0)))) {
                    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
                        if ((GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] == 0) {
                            SetTextColor(hdc, 0);
                        } else {
                            SetTextColor(hdc, 0xff);
                        }
                    }
                    DecorateHullName(((GlobalPD.u_POPUPDATA_0x0002.lpshdef)->hul).ihuldef >> 9 & 0xf, i, szTB);
                    pcVar5 = szTB;
                    sVar16 = 4;
                    uVar11 = unaff_SS;
                    sVar15 = yCur;
                    HVar14 = hdc;
                    uVar4 = __fstrlen(pcVar5);
                    TextOut(HVar14, sVar16, sVar15, (LPCSTR)CONCAT22(uVar11, pcVar5), uVar4);
                    sVar15 = _wsprintf(szWork, PCTD, (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]);
                    RightTextOut(hdc, (rc.right + -4) - GlobalPD.u_POPUPDATA_0x0002._6_2_, yCur, (char *)szWork, sVar15, 0);
                    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
                        if ((GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] != 0) {
                            uVar13 = 0;
                            uVar11 = 100;
                            uVar8 = __aFulmul((ulong)((GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] & 0x7f),
                                              (long)(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]);
                            lVar9 = __aFldiv(uVar8, CONCAT22(uVar13, uVar11));
                            csh = (short)lVar9;
                            if (csh < 1) {
                                csh = 1;
                            }
                            dpT = (uint)(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] / 0x280;
                            if (dpT == 0) {
                                dpT = 1;
                            }
                            sVar15 = _wsprintf(szWork, s_d_d_1120_0bf6, csh, dpT);
                            RightTextOut(hdc, rc.right + -4, yCur, (char *)szWork, sVar15, 0);
                        }
                    }
                    yCur = yCur + dyArial8;
                }
            }
            if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
                SetTextColor(hdc, 0);
            }
        }
        break;
    case 4:
        psz_00 = PszGetCompressedString(idsPlanet);
        uVar11 = 0x1120;
        pcVar5 = psz_00;
        HVar14 = hdc;
        uVar4 = _strlen(psz_00);
        DVar10 = GetTextExtent(HVar14, (LPCSTR)CONCAT22(uVar11, pcVar5), uVar4);
        x = (int)DVar10 + 4;
        SelectObject(hdc, rghfontArial8[1]);
        sVar15 = 0;
        uVar4 = _strlen(psz_00);
        RightTextOut(hdc, x, 4, psz_00, uVar4, sVar15);
        sVar16 = 0;
        sVar15 = 0;
        pcVar5 = PszGetCompressedString(idsId);
        RightTextOut(hdc, x, dyArial8 + 4, pcVar5, sVar15, sVar16);
        sVar16 = 0;
        sVar15 = 0;
        pcVar5 = PszGetCompressedString(idsX);
        RightTextOut(hdc, x, dyArial8 * 2 + 4, pcVar5, sVar15, sVar16);
        sVar16 = 0;
        sVar15 = 0;
        pcVar5 = PszGetCompressedString(idsY);
        RightTextOut(hdc, x, dyArial8 * 3 + 4, pcVar5, sVar15, sVar16);
        pcVar5 = PszGetPlanetName(sel.scan.idpl);
        SelectObject(hdc, rghfontArial8[0]);
        sVar15 = 4;
        uVar11 = 0x1120;
        iVar3 = x;
        HVar14 = hdc;
        uVar4 = _strlen(pcVar5);
        TextOut(HVar14, iVar3, sVar15, (LPCSTR)CONCAT22(uVar11, pcVar5), uVar4);
        sVar15 = _wsprintf(szWork, PCTD, sel.scan.idpl + 1);
        TextOut(hdc, x, dyArial8 + 4, szWork, sVar15);
        sVar15 = _wsprintf(szWork, PCTD, sel.scan.pt.x);
        TextOut(hdc, x, dyArial8 * 2 + 4, szWork, sVar15);
        sVar15 = _wsprintf(szWork, PCTD, sel.scan.pt.y);
        TextOut(hdc, x, dyArial8 * 3 + 4, szWork, sVar15);
        break;
    case 5:
        PtDisplayPlanetStateInfo(hdc, 1);
        break;
    case 6:
        PtDisplayZipOrdInfo(hdc, rc.right >> 1, 1);
        break;
    case 7:
        PtDisplayPlanetPopInfo(hdc, 1);
        break;
    case 8:
        PtDisplayFactoryMineInfo(hdc, rc.right, 1);
        break;
    case 9:
        DisplayComponentInfo(hdc, rc.right, rc.bottom, (PART *)&GlobalPD.u_POPUPDATA_0x0002.part);
        break;
    case 10:
        PtDisplayString(hdc, rc.right, 1);
        break;
    case 0xb:
    case 0xe:
        fStarbaseMode = (short)(0x1f < (GlobalPD.u_POPUPDATA_0x0002.lpfl)->id);
        DrawSlotDlg(hwnd, hdc, &rc, -1);
        rc.top = dyArial8 + 0x132;
        rc.left = rc.left + 6;
        SelectObject(hdc, rghfontArial8[1]);
        SetBkMode(hdc, 1);
        __fstrcpy(szWork, (char *)CONCAT22(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2, &(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->pt));
        CtrTextOut(hdc, (rc.right + -0x4c >> 1) + 0x4c, 6, (char *)szWork, 0);
        DrawBuildSelHull(hwnd, hdc, -1, &rc);
        break;
    case 0xc:
        PtDisplayResourceInfo(hdc, rc.right, 1);
        break;
    default:
    }
    SelectObject(hdc, HVar2);
    SetBkMode(hdc, sVar1);
    SetTextColor(hdc, CVar7);
    SetBkColor(hdc, CVar6);
    return;
}

// ======================================================================
// Function: Popup
// Address: 10c0:0c7c
// Segment: MEMORY_POPUP
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10c00d16) */

void Popup(HWND hwnd, short x, short y)

{
    HDC         hdc_00;
    HGDIOBJ     HVar1;
    char       *pcVar2;
    ushort      uVar3;
    int         iVar4;
    short       sVar5;
    uint        uVar6;
    undefined1 *puVar7;
    undefined1 *puVar8;
    undefined1 *puVar9;
    WMType     *pWVar10;
    undefined2  unaff_SS;
    DWORD       DVar11;
    DWORD       DVar12;
    POINT       PVar13;
    LPCSTR      pcVar14;
    ulong       uVar15;
    HDC         HVar16;
    char        szTB[40];
    char       *psz;
    short       dxR;
    int         local_1e;
    int         local_1c;
    POINT       ptT;
    short       dx;
    HFONT       hfontSav;
    short       c;
    short       i;
    short       dy;
    POINT       pt;
    HDC         hdc;

    pt.x = x;
    pt.y = y;
    ClientToScreen(hwnd, &pt);
    hdc_00 = GetDC(hwnd);
    HVar1 = SelectObject(hdc_00, rghfontArial8[0]);
    switch (GlobalPD.grPopup) {
    case 1:
        pcVar2 = PszGetCompressedString(idsMineralConcentration0000000kt);
        pcVar14 = pcVar2;
        HVar16 = hdc_00;
        uVar3 = _strlen(pcVar2);
        DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
        dx = (int)DVar11 + 8;
        dy = dyArial8 * 3 + 8;
        if (-1 < (int)GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_) {
            dy = dy + dyArial8;
        }
        break;
    case 2:
        SelectObject(hdc_00, rghfontArial8[1]);
        pcVar2 = PszPlayerName(GlobalPD.u_POPUPDATA_0x0002.dxOut, 1, 1, 1, 0, (PLAYER *)0x0);
        pcVar14 = pcVar2;
        HVar16 = hdc_00;
        uVar3 = _strlen(pcVar2);
        DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
        iVar4 = (int)DVar11 + 8;
        DVar11 = GetTextExtent(hdc_00, s_Player__16_1120_0bfe, 10);
        dx = (int)DVar11 + 8;
        if (dx <= iVar4) {
            dx = iVar4;
        }
        dy = dyArial8 * 2 + 8;
        break;
    case 3:
        dxR = 0;
        local_1c = 0;
        dy = dyArial8 + 8;
        SelectObject(hdc_00, rghfontArial8[1]);
        pcVar2 = PszGetCompressedString(idsShipName);
        pcVar14 = pcVar2;
        HVar16 = hdc_00;
        uVar3 = _strlen(pcVar2);
        DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
        local_1e = (int)DVar11;
        SelectObject(hdc_00, rghfontArial8[0]);
        for (i = 0; i < 0x10; i = i + 1) {
            if ((0 < (GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i]) &&
                ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0 || (sVar5 = FIsPopupHullType(i), sVar5 != 0)))) {
                dy = dy + dyArial8;
                uVar15 = CONCAT22(i, ((GlobalPD.u_POPUPDATA_0x0002.lpshdef)->hul).ihuldef >> 9) & 0xffff000f;
                DecorateHullName((short)uVar15, (short)(uVar15 >> 0x10), szTB);
                pcVar14 = szTB;
                HVar16 = hdc_00;
                uVar3 = __fstrlen(szTB);
                DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
                if (local_1e <= (int)DVar11) {
                    local_1e = (int)DVar11;
                }
                sVar5 = _wsprintf(szWork, PCTD);
                DVar11 = GetTextExtent(hdc_00, szWork, sVar5);
                if (dxR <= (int)DVar11) {
                    dxR = (int)DVar11;
                }
                if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != 0) {
                    if (((uint)(GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_)->rgcsh[i + 0x10] >> 7 != 0) && (local_1c == 0)) {
                        pcVar2 = PszGetCompressedString(idsN9999999);
                        pcVar14 = pcVar2;
                        HVar16 = hdc_00;
                        uVar3 = _strlen(pcVar2);
                        DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
                        local_1c = (int)DVar11 + 4;
                    }
                }
            }
        }
        if (dy == dyArial8 + 8) {
            pcVar2 = PszGetCompressedString(idsShipName);
            pcVar14 = pcVar2;
            HVar16 = hdc_00;
            uVar3 = _strlen(pcVar2);
            DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
            local_1e = (int)DVar11;
        }
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate = local_1c;
        dx = local_1e + dxR + 0x10 + local_1c;
        break;
    case 4:
        SelectObject(hdc_00, rghfontArial8[1]);
        dy = dyArial8 * 4 + 8;
        pcVar2 = PszGetCompressedString(idsPlanet);
        pcVar14 = pcVar2;
        HVar16 = hdc_00;
        uVar3 = _strlen(pcVar2);
        DVar11 = GetTextExtent(HVar16, pcVar14, uVar3);
        pcVar2 = PszGetPlanetName(sel.scan.idpl);
        SelectObject(hdc_00, rghfontArial8[0]);
        pcVar14 = pcVar2;
        HVar16 = hdc_00;
        uVar3 = _strlen(pcVar2);
        DVar12 = GetTextExtent(HVar16, pcVar14, uVar3);
        iVar4 = (int)DVar12;
        HVar16 = hdc_00;
        pcVar2 = PszGetCompressedString(idsN9999);
        DVar12 = GetTextExtent(HVar16, pcVar2, 4);
        if (iVar4 <= (int)DVar12) {
            iVar4 = (int)DVar12;
        }
        dx = (int)DVar11 + 8 + iVar4;
        break;
    case 5:
        PVar13 = PtDisplayPlanetStateInfo(hdc_00, 0);
        goto POPUP_SetDxDy;
    case 6:
        PVar13 = PtDisplayZipOrdInfo(hdc_00, 0, 0);
        goto POPUP_SetDxDy;
    case 7:
        PVar13 = PtDisplayPlanetPopInfo(hdc_00, 0);
        goto POPUP_SetDxDy;
    case 8:
        PVar13 = PtDisplayFactoryMineInfo(hdc_00, 200, 0);
        goto POPUP_SetDxDy;
    case 9:
        if (dyArial8 < 0xf) {
            iVar4 = 0;
        } else {
            iVar4 = 0x28;
        }
        dx = iVar4 + 0x158;
        dy = dyArial10 + dyArial8 * 0xc + 0x4e;
        break;
    case 10:
        PVar13 = PtDisplayString(hdc_00, GlobalPD.u_POPUPDATA_0x0002.dxOut, 0);
        goto POPUP_SetDxDy;
    case 0xb:
    case 0xe:
        mdBuild = (short)(GlobalPD.grPopup != 0xb);
        lpshdefBuild._0_2_ = GlobalPD.u_POPUPDATA_0x0002.lpshdef._0_2_;
        lpshdefBuild._2_2_ = GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2;
        UpdateSlotGlobals();
        dx = 0x154;
        dy = dyArial8 * 7 + 0x13a;
        if (((uint)gd.grBits >> 0xe != 0) && (GlobalPD.grPopup == 0xb)) {
            dy = dy + dyArial8 * 3;
        }
        break;
    case 0xc:
        PVar13 = PtDisplayResourceInfo(hdc_00, 200, 0);
    POPUP_SetDxDy:
        ptT.y = PVar13.y;
        ptT.x = PVar13.x;
        dx = ptT.x + 2;
        dy = ptT.y + 2;
        break;
    case 0xd:
        dx = 0x78;
        dy = 0x50;
    }
    SelectObject(hdc_00, HVar1);
    ReleaseDC(hwnd, hdc_00);
    pt.x = pt.x - dx;
    pt.y = pt.y - dy;
    sVar5 = GetSystemMetrics(0);
    puVar7 = &stack0xffac;
    uVar6 = pt.x;
    if (sVar5 - dx <= pt.x) {
        sVar5 = GetSystemMetrics(0);
        puVar7 = &stack0xffaa;
        uVar6 = sVar5 - dx;
    }
    if (uVar6 < 0x8000) {
        *(undefined2 *)(puVar7 + -2) = 0;
        *(undefined2 *)(puVar7 + -4) = 0x14f8;
        *(undefined2 *)(puVar7 + -6) = 0x1286;
        sVar5 = GetSystemMetrics(*(short *)(puVar7 + -2));
        puVar8 = puVar7 + -2;
        if (sVar5 - dx <= pt.x) {
            *(undefined2 *)(puVar7 + -4) = 0;
            *(undefined2 *)(puVar7 + -6) = 0x14f8;
            *(undefined2 *)(puVar7 + -8) = 0x12a0;
            sVar5 = GetSystemMetrics(*(short *)(puVar7 + -4));
            pt.x = sVar5 - dx;
            puVar8 = puVar7 + -4;
        }
    } else {
        pt.x = 0;
        puVar8 = puVar7;
    }
    *(undefined2 *)(puVar8 + -2) = 1;
    *(undefined2 *)(puVar8 + -4) = 0x14f8;
    *(undefined2 *)(puVar8 + -6) = 0x12af;
    sVar5 = GetSystemMetrics(*(short *)(puVar8 + -2));
    puVar9 = puVar8 + -2;
    uVar6 = pt.y;
    if (sVar5 - dy <= pt.y) {
        *(undefined2 *)(puVar8 + -4) = 1;
        *(undefined2 *)(puVar8 + -6) = 0x14f8;
        *(undefined2 *)(puVar8 + -8) = 0x12c9;
        sVar5 = GetSystemMetrics(*(short *)(puVar8 + -4));
        puVar9 = puVar8 + -4;
        uVar6 = sVar5 - dy;
    }
    if (uVar6 < 0x8000) {
        *(undefined2 *)(puVar9 + -2) = 1;
        *(undefined2 *)(puVar9 + -4) = 0x14f8;
        *(undefined2 *)(puVar9 + -6) = 0x12e5;
        sVar5 = GetSystemMetrics(*(short *)(puVar9 + -2));
        pWVar10 = puVar9 + -2;
        if (sVar5 - dy <= pt.y) {
            *(undefined2 *)(puVar9 + -4) = 1;
            *(undefined2 *)(puVar9 + -6) = 0x14f8;
            *(char **)(puVar9 + -8) = (char *)s_ >> _ << _1120_12fa + 5;
            sVar5 = GetSystemMetrics(*(short *)(puVar9 + -4));
            pt.y = sVar5 - dy;
            pWVar10 = puVar9 + -4;
        }
    } else {
        pt.y = 0;
        pWVar10 = puVar9;
    }
    pWVar10[-1] = 0x1120;
    pWVar10[-2] = 0x210;
    pWVar10[-3] = 0;
    pWVar10[-4] = 0;
    pWVar10[-5] = 0x9080;
    pWVar10[-6] = 0;
    pWVar10[-7] = pt.x;
    pWVar10[-8] = pt.y;
    pWVar10[-9] = dx;
    pWVar10[-10] = dy;
    pWVar10[-0xb] = hwnd;
    pWVar10[-0xc] = 0;
    pWVar10[-0xd] = hInst;
    pWVar10[-0xe] = 0;
    pWVar10[-0xf] = 0;
    pWVar10[-0x10] = 0x14f8;
    pWVar10[-0x11] = 0x1340;
    hwndPopup = CreateWindow(*(LPCSTR *)(pWVar10 + -2), *(LPCSTR *)(pWVar10 + -4), *(undefined4 *)(pWVar10 + -6), pWVar10[-7], pWVar10[-8], pWVar10[-9],
                             pWVar10[-10], pWVar10[-0xb], pWVar10[-0xc], pWVar10[-0xd], *(void **)(pWVar10 + -0xf));
    pWVar10[1] = hwndPopup;
    *pWVar10 = 0x30;
    pWVar10[-1] = rghfontArial8[0];
    pWVar10[-2] = 0;
    pWVar10[-3] = 0;
    pWVar10[-4] = 0x14f8;
    pWVar10[-5] = 0x135c;
    SendMessage(pWVar10[1], *pWVar10, pWVar10[-1], *(undefined4 *)(pWVar10 + -3));
    pWVar10[1] = hwndPopup;
    *pWVar10 = 0x14f8;
    pWVar10[-1] = (WMType)(char *)s_99999_1120_1365;
    SetCapture(pWVar10[1]);
    return;
}

// ======================================================================
// Function: PopupMenu
// Address: 10c0:136c
// Segment: MEMORY_POPUP
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10c01498) */
/* WARNING: Removing unreachable block (ram,0x10c0141e) */
/* WARNING: Removing unreachable block (ram,0x10c0144f) */
/* WARNING: Removing unreachable block (ram,0x10c014e1) */

short PopupMenu(HWND hwnd, short x, short y, short cString, long *rgids, char **rgsz, short iChecked, short fRightBtn)

{
    char      *pcVar1;
    char      *pcVar2;
    char       cVar3;
    HMENU      HVar4;
    uint       uVar5;
    int        iVar6;
    UINT       UVar7;
    BOOL       BVar8;
    int        iVar9;
    undefined2 unaff_SS;
    char      *psz;
    short      fCheckedCur;
    short      fChecked;
    MSG        msg;
    char      *pcStack_96;
    char      *pszT;
    HMENU      hmenuPopup;
    HMENU      hmenuSub;
    char       szTemp[128];
    short      i;
    POINT      pt;
    short      tpm;
    char      *pszTitle;

    hmenuSub = 0;
    pt.x = x;
    pt.y = y;
    ClientToScreen(hwnd, &pt);
    HVar4 = CreatePopupMenu();
    iPopMenuSel = -1;
    for (i = 0; i < cString; i = i + 1) {
        if ((rgids == (long *)0x0) || ((iChecked == -2 && (rgsz != (char **)0x0)))) {
            if (rgsz[i] == (char *)0x0) {
                pcVar2 = rgsz[i + 1];
                if (rgids == (long *)0x0) {
                    fChecked = 0;
                } else {
                    fChecked = (short)rgids[i + 1];
                }
                hmenuSub = CreatePopupMenu();
                for (i = i + 2; (i < cString && (rgsz[i] != (char *)0x0)); i = i + 1) {
                    if (rgids == (long *)0x0) {
                        fCheckedCur = (short)(i == iChecked);
                        fChecked = fChecked | fCheckedCur;
                    } else {
                        fCheckedCur = (short)rgids[i];
                    }
                    if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
                        AppendMenu(hmenuSub, 0x800, 0, (LPCSTR)0x0);
                    } else {
                        psz = rgsz[i];
                        pcVar1 = szTemp;
                        while (pszT = pcVar1, *psz != '\0') {
                            pcVar1 = psz + 1;
                            cVar3 = *psz;
                            *pszT = cVar3;
                            psz = pcVar1;
                            pcVar1 = pszT + 1;
                            if (cVar3 == '&') {
                                pszT[1] = '&';
                                pcVar1 = pszT + 2;
                            }
                        }
                        *pszT = '\0';
                        if (fCheckedCur == 0) {
                            UVar7 = 0;
                        } else {
                            UVar7 = 8;
                        }
                        AppendMenu(hmenuSub, UVar7, i + 15000, szTemp);
                    }
                }
                if (fChecked == 0) {
                    uVar5 = 0;
                } else {
                    uVar5 = 8;
                }
                AppendMenu(HVar4, uVar5 | 0x10, hmenuSub, pcVar2);
            } else if ((*rgsz[i] == -1) && (rgsz[i][1] == '\0')) {
                AppendMenu(HVar4, 0x800, 0, (LPCSTR)0x0);
            } else {
                pcStack_96 = rgsz[i];
                pcVar2 = szTemp;
                while (pszT = pcVar2, *pcStack_96 != '\0') {
                    pcVar2 = pcStack_96 + 1;
                    cVar3 = *pcStack_96;
                    *pszT = cVar3;
                    pcStack_96 = pcVar2;
                    pcVar2 = pszT + 1;
                    if (cVar3 == '&') {
                        pszT[1] = '&';
                        pcVar2 = pszT + 2;
                    }
                }
                *pszT = '\0';
                if (iChecked == -2) {
                    iVar6 = (int)rgids[i];
                    iVar9 = *(int *)((int)(rgids + i) + 2);
                } else if (i == iChecked) {
                    iVar6 = 1;
                    iVar9 = 0;
                } else {
                    iVar6 = 0;
                    iVar9 = 0;
                }
                if ((iVar6 == 0) && (iVar9 == 0)) {
                    UVar7 = 0;
                } else {
                    UVar7 = 8;
                }
                AppendMenu(HVar4, UVar7, i + 15000, szTemp);
            }
        } else if (((int)rgids[i] == -1) && (*(int *)((int)(rgids + i) + 2) == -1)) {
            AppendMenu(HVar4, 0x800, 0, (LPCSTR)0x0);
        } else {
            if ((*(uint *)((int)rgids + i * 4 + 2) & 0x1000) == 0) {
                if ((*(uint *)((int)rgids + i * 4 + 2) & 0x4000) == 0) {
                    if ((*(uint *)((int)rgids + i * 4 + 2) & 0x2000) == 0) {
                        if ((*(uint *)((int)rgids + i * 4 + 2) & 0x8000) == 0) {
                            pcStack_96 = PszGetPlanetName((short)rgids[i]);
                        } else {
                            pcStack_96 = PszGetFleetName(*(uint *)(rgids + i) | 0x8000);
                        }
                    } else {
                        pcStack_96 = PszGetThingName((short)rgids[i]);
                    }
                } else {
                    pcStack_96 = PszGetCompressedString(*(StringId *)(rgids + i));
                }
            } else {
                pcStack_96 = (char *)s_Deep_Space_1120_0c09;
            }
            pcVar2 = szTemp;
            while (pszT = pcVar2, *pcStack_96 != '\0') {
                pcVar2 = pcStack_96 + 1;
                cVar3 = *pcStack_96;
                *pszT = cVar3;
                pcStack_96 = pcVar2;
                pcVar2 = pszT + 1;
                if (cVar3 == '&') {
                    pszT[1] = '&';
                    pcVar2 = pszT + 2;
                }
            }
            *pszT = '\0';
            if (i == iChecked) {
                UVar7 = 8;
            } else {
                UVar7 = 0;
            }
            AppendMenu(HVar4, UVar7, i + 15000, szTemp);
        }
    }
    if (fRightBtn == 0) {
        tpm = 0;
    } else {
        tpm = 2;
    }
    TrackPopupMenu(HVar4, tpm, pt.x, pt.y, 0, hwndFrame, (RECT *)0x0);
    DestroyMenu(HVar4);
    if (hmenuSub != 0) {
        DestroyMenu(hmenuSub);
    }
    BVar8 = PeekMessage(&msg, hwndFrame, 0x111, 0x111, 2);
    if (((BVar8 != 0) && (14999 < msg.wParam)) && (msg.wParam < 0x3afc)) {
        iPopMenuSel = msg.wParam + 0xc568;
    }
    return iPopMenuSel;
}

// ======================================================================
// Function: PtDisplayPlanetStateInfo
// Address: 10c0:1938
// Segment: MEMORY_POPUP
// ======================================================================

POINT PtDisplayPlanetStateInfo(HDC hdc, short fPrint)

{
    char      *pcVar1;
    int        iVar2;
    short      sVar3;
    undefined2 unaff_SS;
    POINT      PVar4;
    short      sVar5;
    short      sVar6;
    short     *psVar7;
    char       local_6e[82];
    int        local_1c;
    short      local_1a;
    int        local_18;
    undefined4 local_16;
    StringId   local_12;
    short      x;
    short      cch;
    short      xMax;
    short      y;
    POINT      pt;

    y = 4;
    xMax = 4;
    x = 4;
    SelectObject(hdc, rghfontArial8[1]);
    DxStreamTextOut(hdc, &x, y, (char *)*(undefined2 *)(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + rgszPlanetAttr), 0, fPrint);
    SelectObject(hdc, rghfontArial8[0]);
    sVar5 = 0;
    sVar3 = fPrint;
    pcVar1 = PszGetCompressedString(idsCurrently);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
    SelectObject(hdc, rghfontArial8[1]);
    if ((int)GlobalPD.u_POPUPDATA_0x0002._4_2_ < 0) {
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsUnknown2);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
    } else {
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
    }
    SelectObject(hdc, rghfontArial8[0]);
    DxStreamTextOut(hdc, &x, y, (char *)0xc14, 1, fPrint);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin == -1) {
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsColonistsImmune);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        if (xMax < x) {
            xMax = x;
        }
        x = 4;
        y = y + dyArial8;
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsEffects);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        DxStreamTextOut(hdc, &x, y, (char *)*(undefined2 *)(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + rgszPlanetAttr), 0, fPrint);
        DxStreamTextOut(hdc, &x, y, (char *)0xc16, 1, fPrint);
    } else {
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsColonistsPreferPlanetsWhere);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        if (xMax < x) {
            xMax = x;
        }
        x = 4;
        y = y + dyArial8;
        DxStreamTextOut(hdc, &x, y, (char *)*(undefined2 *)(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + rgszPlanetAttr), 0, fPrint);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsBetween);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[0]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsAnd);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[0]);
        DxStreamTextOut(hdc, &x, y, (char *)0xc18, 1, fPrint);
    }
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    if ((uint)GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate < 0x8000) {
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsCurrentlyPossessTechnology);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        if (xMax < x) {
            xMax = x;
        }
        x = 4;
        y = y + dyArial8;
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsModify);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        DxStreamTextOut(hdc, &x, y, (char *)*(undefined2 *)(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + rgszPlanetAttr), 0, fPrint);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsOn2);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[0]);
        if (xMax < x) {
            xMax = x;
        }
        x = 4;
        y = y + dyArial8;
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsWithinRange);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[0]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszGetCompressedString(idsTo);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar3 = fPrint;
        pcVar1 = PszCalcEnvVar(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory);
        DxStreamTextOut(hdc, &x, y, pcVar1, sVar5, sVar3);
        SelectObject(hdc, rghfontArial8[0]);
        DxStreamTextOut(hdc, &x, y, (char *)0xc1a, 1, fPrint);
        if (xMax < x) {
            xMax = x;
        }
        y = y + dyArial8;
    }
    x = 4;
    if ((((uint)GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate < 0x8000) &&
         (local_16 = (PLANET *)CONCAT22(local_16._2_2_, (PLANET *)local_16), GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin != -1)) &&
        (local_16 = (PLANET *)CONCAT22(local_16._2_2_, (PLANET *)local_16),
         GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary)) {
        local_12 = -1;
        if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur < GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary) {
            if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur < GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory) &&
                (local_12 = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary,
                 GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory <= GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary)) {
                local_12 = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory;
            }
        } else if ((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate < GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur) &&
                   (local_12 = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary,
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary <= GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate)) {
            local_12 = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate;
        }
        local_16 = (PLANET *)CONCAT22(local_16._2_2_, (PLANET *)local_16);
        if (local_12 != -1) {
            local_16 = LpplFromId(GlobalPD.u_POPUPDATA_0x0002.dxOut);
            local_18 = PctPlanetDesirability(local_16, idPlayer);
            local_1c = (int)((PLANET *)local_16)->rgEnvVar[GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2];
            ((PLANET *)local_16)->rgEnvVar[GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2] = (char)local_12;
            local_1a = PctPlanetDesirability(local_16, idPlayer);
            ((PLANET *)local_16)->rgEnvVar[GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2] = (char)local_1c;
            if (local_18 < local_1a) {
                cch = CchGetString(idsIfTerraform, (char *)szWork);
                WrapTextOut(hdc, &x, &y, (char *)szWork, cch, 4, xMax + -4, (short *)0x0, 0, fPrint);
                SelectObject(hdc, rghfontArial8[1]);
                WrapTextOut(hdc, &x, &y, (char *)*(undefined2 *)(GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 * 2 + rgszPlanetAttr), 0, 4, xMax + -4,
                            (short *)0x0, 0, fPrint);
                SelectObject(hdc, rghfontArial8[0]);
                psVar7 = (short *)0x0;
                iVar2 = xMax + -4;
                sVar6 = 4;
                sVar5 = 0;
                sVar3 = fPrint;
                pcVar1 = PszGetCompressedString(idsTo);
                WrapTextOut(hdc, &x, &y, pcVar1, sVar5, sVar6, iVar2, (short *)psVar7, (short)((ulong)psVar7 >> 0x10), sVar3);
                SelectObject(hdc, rghfontArial8[1]);
                psVar7 = (short *)0x0;
                iVar2 = xMax + -4;
                sVar6 = 4;
                sVar5 = 0;
                sVar3 = fPrint;
                pcVar1 = PszCalcEnvVar(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, local_12);
                WrapTextOut(hdc, &x, &y, pcVar1, sVar5, sVar6, iVar2, (short *)psVar7, (short)((ulong)psVar7 >> 0x10), sVar3);
                SelectObject(hdc, rghfontArial8[0]);
                cch = CchGetString(idsPlanetsValueWouldImprove, (char *)szWork);
                WrapTextOut(hdc, &x, &y, (char *)szWork, cch, 4, xMax + -4, (short *)0x0, 0, fPrint);
                SelectObject(hdc, rghfontArial8[1]);
                cch = _wsprintf(szWork, s_d_1120_0c1c, local_1a);
                WrapTextOut(hdc, &x, &y, (char *)szWork, cch, 4, xMax + -4, (short *)0x0, 0, fPrint);
            }
        }
    }
    if (((GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin != -1) &&
         (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary)) &&
        (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur != -1)) {
        if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur < GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin) {
            local_16._2_2_ = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin - GlobalPD.u_POPUPDATA_0x0002._4_2_;
        } else if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax < GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur) {
            local_16._2_2_ = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur - GlobalPD.u_POPUPDATA_0x0002._14_2_;
        } else {
            sVar3 = _abs(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur - GlobalPD.u_POPUPDATA_0x0002._10_2_);
            local_16._2_2_ = -sVar3;
        }
        if (local_16._2_2_ < 0) {
            local_16._2_2_ = -local_16._2_2_;
            local_12 = idsValueDAwayIdealValueRace;
        } else {
            local_12 = idsValueDOutsideHabitableRangeRace;
        }
        CchGetString(local_12, (char *)szWork);
        cch = _wsprintf(local_6e, szWork, local_16._2_2_);
        SelectObject(hdc, rghfontArial8[0]);
        WrapTextOut(hdc, &x, &y, local_6e, cch, 4, xMax + -4, (short *)0x0, 0, fPrint);
    }
    if (4 < x) {
        y = y + dyArial8;
    }
    PVar4.x = xMax + 4;
    PVar4.y = y + 4;
    return PVar4;
}

// ======================================================================
// Function: PtDisplayPlanetPopInfo
// Address: 10c0:228e
// Segment: MEMORY_POPUP
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10c02aa4) */
/* WARNING: Removing unreachable block (ram,0x10c027b6) */
/* WARNING: Removing unreachable block (ram,0x10c028dd) */
/* WARNING: Removing unreachable block (ram,0x10c02b7d) */

POINT PtDisplayPlanetPopInfo(HDC hdc, short fPrint)

{
    long       lVar1;
    char      *pcVar2;
    undefined2 unaff_SS;
    long       lVar3;
    POINT      PVar4;
    short      sVar5;
    short      sVar6;
    long       lPopChg;
    short      x;
    short      pctDesire;
    long       lMax;
    char      *psz;
    short      c;
    short      xMax;
    short      y;
    POINT      pt;
    char       szT[150];
    PLANET     pl;

    y = 4;
    xMax = 4;
    x = 4;
    FLookupPlanet(GlobalPD.u_POPUPDATA_0x0002.dxOut, &pl);
    SelectObject(hdc, rghfontArial8[0]);
    if (pl.iPlayer == idPlayer) {
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetCompressedString(idsPopulation3);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        SelectObject(hdc, rghfontArial8[0]);
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetCompressedString(idsIs);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        SelectObject(hdc, rghfontArial8[1]);
        _wsprintf(szWork, PCTLD00, (int)pl.rgwtMin[3], pl.rgwtMin[3]._2_2_);
        if (((int)pl.rgwtMin[3] == 0) && (pl.rgwtMin[3]._2_2_ == 0)) {
            szWork[1] = '\0';
        }
        DxStreamTextOut(hdc, &x, y, (char *)szWork, 0, fPrint);
        SelectObject(hdc, rghfontArial8[0]);
        DxStreamTextOut(hdc, &x, y, (char *)0xc24, 1, fPrint);
    } else if (pl.iPlayer == -1) {
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        SelectObject(hdc, rghfontArial8[0]);
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetCompressedString(idsUninhabited2);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
    } else {
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetCompressedString(idsEnemyPopulation);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        SelectObject(hdc, rghfontArial8[1]);
        sVar5 = 0;
        sVar6 = fPrint;
        pcVar2 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
        DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        SelectObject(hdc, rghfontArial8[0]);
        if ((pl.wFlags_0x4 & 0xff) < 3) {
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsUnknown);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        } else {
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsApproximately);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[1]);
            _wsprintf(szWork, s_d00_1120_0c26, (pl.uGuesses & 0xfff) << 2);
            if ((pl.uGuesses & 0xfff) == 0) {
                szWork[1] = '\0';
            }
            DxStreamTextOut(hdc, &x, y, (char *)szWork, 0, fPrint);
            SelectObject(hdc, rghfontArial8[0]);
        }
        DxStreamTextOut(hdc, &x, y, (char *)0xc2b, 1, fPrint);
    }
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    if (2 < (pl.wFlags_0x4 & 0xff)) {
        lMax = CalcPlanetMaxPop(GlobalPD.u_POPUPDATA_0x0002.dxOut, idPlayer);
        pctDesire = PctPlanetDesirability(&pl, idPlayer);
        if (pctDesire < 0) {
            SelectObject(hdc, rghfontArial8[1]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsWillKillOffApproximately);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[1]);
            c = _wsprintf(szWork, PCTDXPCTDPCTPCT, -pctDesire / 10, -pctDesire % 10);
            DxStreamTextOut(hdc, &x, y, (char *)szWork, c, fPrint);
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsOf);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            if (xMax < x) {
                xMax = x;
            }
            x = 4;
            y = y + dyArial8;
            if (pl.iPlayer == idPlayer) {
                sVar5 = 0;
                sVar6 = fPrint;
                pcVar2 = PszGetCompressedString(idsColonistsEachTurn);
                DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            } else {
                sVar5 = 0;
                sVar6 = fPrint;
                pcVar2 = PszGetCompressedString(idsColonistsSettleEveryTurn);
                DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            }
        } else if ((pl.iPlayer == idPlayer) && (0 < lMax)) {
            SelectObject(hdc, rghfontArial8[1]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsWillSupportPopulation);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            if (xMax < x) {
                xMax = x;
            }
            x = 4;
            y = y + dyArial8;
            SelectObject(hdc, rghfontArial8[1]);
            c = _wsprintf(szWork, PCTLD00, (undefined2)lMax, lMax._2_2_);
            DxStreamTextOut(hdc, &x, y, (char *)szWork, c, fPrint);
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsColonists3);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        } else if (lMax < 1) {
            y = y - dyArial8;
        } else {
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsIfColonize);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[1]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsWould);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            if (xMax < x) {
                xMax = x;
            }
            x = 4;
            y = y + dyArial8;
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsSupport);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
            SelectObject(hdc, rghfontArial8[1]);
            c = _wsprintf(szWork, PCTLD00, (undefined2)lMax, lMax._2_2_);
            DxStreamTextOut(hdc, &x, y, (char *)szWork, c, fPrint);
            SelectObject(hdc, rghfontArial8[0]);
            sVar5 = 0;
            sVar6 = fPrint;
            pcVar2 = PszGetCompressedString(idsColonists3);
            DxStreamTextOut(hdc, &x, y, pcVar2, sVar5, sVar6);
        }
        if (xMax < x) {
            xMax = x;
        }
        x = 4;
        y = y + dyArial8;
        if (((pl.iPlayer == idPlayer) && (-1 < pctDesire)) && (CONCAT22(pl.rgwtMin[3]._2_2_, (int)pl.rgwtMin[3]) < lMax)) {
            c = CchGetString(idsPopulation, szT);
            WrapTextOut(hdc, &x, &y, szT, c, 4, xMax, (short *)0x0, 0, fPrint);
            SelectObject(hdc, rghfontArial8[1]);
            psz = PszGetPlanetName(pl.id);
            WrapTextOut(hdc, &x, &y, psz, 0, 4, xMax, (short *)0x0, 0, fPrint);
            SelectObject(hdc, rghfontArial8[0]);
            lVar3 = ChgPopFromPlanet(&pl, 0);
            if ((pctDesire == 0) || (lVar3 < 1)) {
                c = CchGetString(idsWillGrowYear, szT);
            } else {
                psz = PszGetCompressedString(idsWillGrowLd00Ld00Year);
                lVar1 = lVar3 + CONCAT22(pl.rgwtMin[3]._2_2_, (int)pl.rgwtMin[3]);
                c = _wsprintf(szT, psz, (int)lVar3, (int)((ulong)lVar3 >> 0x10), (int)lVar1, (int)((ulong)lVar1 >> 0x10));
            }
            WrapTextOut(hdc, &x, &y, szT, c, 4, xMax, (short *)0x0, 0, fPrint);
            y = y + dyArial8;
        } else if ((pl.iPlayer != idPlayer) && (pl.iPlayer != -1)) {
            SelectObject(hdc, rghfontArial8[1]);
            psz = PszGetPlanetName(pl.id);
            WrapTextOut(hdc, &x, &y, psz, 0, 4, xMax, (short *)0x0, 0, fPrint);
            SelectObject(hdc, rghfontArial8[0]);
            if (pl.uGuesses >> 0xc == 0) {
                c = CchGetString(idsAppearsHavePlanetaryDefenses, (char *)szWork);
            } else {
                psz = PszGetCompressedString(idsHasPlanetaryDefensesApproximatelyDCoverage);
                c = _wsprintf(szT, psz, (pl.uGuesses >> 0xc) * 6 + 3);
                psz = szT;
            }
            WrapTextOut(hdc, &x, &y, psz, c, 4, xMax, (short *)0x0, 0, fPrint);
            y = y + dyArial8;
        }
    }
    PVar4.x = xMax + 4;
    PVar4.y = y + 4;
    return PVar4;
}

// ======================================================================
// Function: PtDisplayZipOrdInfo
// Address: 10c0:2d66
// Segment: MEMORY_POPUP
// ======================================================================

POINT PtDisplayZipOrdInfo(HDC hdc, short xCtr, short fPrint)

{
    ushort cLen;
    char  *pcVar1;
    POINT  PVar2;
    short  sVar3;
    short  sVar4;
    short  x;
    char  *psz;
    short  xMax;
    short  y;
    POINT  pt;

    y = 4;
    xMax = 4;
    x = 4;
    SelectObject(hdc, rghfontArial8[1]);
    if (fPrint != 0) {
        psz = PszGetCompressedString(idsZipord);
        cLen = _strlen(psz);
        CtrTextOut(hdc, xCtr, y, psz, cLen);
    }
    y = y + dyArial8;
    SelectObject(hdc, rghfontArial8[0]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsZipordProvidesAbilityQuicklySetFleets);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsTransportOrdersOne3CommonSetsSelect);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsZipordClickDiamondRightMouse);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8;
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsButtonClickOrderChoice);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + dyArial8 * 2;
    SelectObject(hdc, rghfontArial8[1]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsQuikload);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    SelectObject(hdc, rghfontArial8[0]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsLoadMineralsAvailable);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + (dyArial8 >> 1) + dyArial8;
    SelectObject(hdc, rghfontArial8[1]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsQuikdrop);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    SelectObject(hdc, rghfontArial8[0]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsUnloadEverythingFleetCarrying);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + (dyArial8 >> 1) + dyArial8;
    SelectObject(hdc, rghfontArial8[1]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsWaitload);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    SelectObject(hdc, rghfontArial8[0]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsWaitFullLoadMinerals);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    if (xMax < x) {
        xMax = x;
    }
    x = 4;
    y = y + (dyArial8 >> 1) + dyArial8;
    SelectObject(hdc, rghfontArial8[1]);
    sVar3 = 0;
    sVar4 = fPrint;
    pcVar1 = PszGetCompressedString(idsClear2);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar3, sVar4);
    SelectObject(hdc, rghfontArial8[0]);
    sVar4 = 0;
    pcVar1 = PszGetCompressedString(idsRemoveTransportOrders);
    DxStreamTextOut(hdc, &x, y, pcVar1, sVar4, fPrint);
    if (xMax < x) {
        xMax = x;
    }
    PVar2.x = xMax + 4;
    PVar2.y = y + dyArial8 + 4;
    return PVar2;
}

// ======================================================================
// Function: PtDisplayFactoryMineInfo
// Address: 10c0:3110
// Segment: MEMORY_POPUP
// ======================================================================

POINT PtDisplayFactoryMineInfo(HDC hdc, short dx, short fPrint)

{
    int        dxWidth;
    short      sVar1;
    StringId   ids_00;
    char      *pcVar2;
    undefined2 unaff_SS;
    POINT      PVar3;
    short      x;
    short      cnt;
    char      *psz;
    short      c;
    short      i;
    short      xMax;
    short      y;
    char      *pszType;
    short      ids;
    POINT      pt;
    char       szT[40];
    char      *pszTypes;

    ids = 0xcd;
    dxWidth = dx + -8;
    xMax = 4;
    x = 4;
    y = 2;
    if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) {
        pszType = (char *)0xc3f;
        pszTypes = (char *)s_Mines_1120_0c44;
    } else {
        pszType = (char *)s_Factory_1120_0c2d;
        pszTypes = (char *)s_Factories_1120_0c35;
    }
    SelectObject(hdc, rghfontArial8[1]);
    if (fPrint != 0) {
        CchGetString(idsSInfo, szT);
        c = _wsprintf(szWork, szT, pszType, 0x1120);
        CtrTextOut(hdc, dxWidth >> 1, y, (char *)szWork, c);
    }
    y = y + dyArial8 + 4;
    sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer, rsMajorAdv);
    if (sVar1 == raMacintosh) {
        SelectObject(hdc, rghfontArial8[0]);
        if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) {
            ids_00 = idsRaceIncapableBuildingMinesHoweverColonistsHave;
        } else {
            ids_00 = idsRaceIncapableBuildingFactories;
        }
        psz = PszGetCompressedString(ids_00);
        WrapTextOut(hdc, &x, &y, psz, 0, 4, dxWidth, &xMax, 0, fPrint);
    } else {
        for (i = 0; i < 9; i = i + 1) {
            SelectObject(hdc, rghfontArial8[1]);
            switch (i) {
            case 0:
            case 2:
            case 4:
            case 6:
            case 8:
                SelectObject(hdc, rghfontArial8[0]);
                psz = PszGetCompressedString(ids);
                ids = ids + 1;
                break;
            case 1:
                cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur;
                goto POPUP_SetQuan_2;
            case 3:
                psz = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
                break;
            case 5:
                cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax;
            POPUP_SetQuan_2:
                pcVar2 = pszType;
                if (cnt != 1) {
                    pcVar2 = pszTypes;
                }
                _wsprintf(szWork, s__d__s_1120_0c4a, cnt, pcVar2, 0x1120);
                psz = (char *)szWork;
                break;
            case 7:
                _wsprintf(szWork, PCTD, GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate);
                psz = (char *)szWork;
            }
            WrapTextOut(hdc, &x, &y, psz, 0, 4, dxWidth, &xMax, 0, fPrint);
        }
    }
    PVar3.x = xMax + 4;
    PVar3.y = y + dyArial8 + 2;
    return PVar3;
}

// ======================================================================
// Function: PtDisplayResourceInfo
// Address: 10c0:3378
// Segment: MEMORY_POPUP
// ======================================================================

POINT PtDisplayResourceInfo(HDC hdc, short dx, short fPrint)

{
    short  sVar1;
    ushort cLen;
    POINT  PVar2;
    short  x;
    short  cnt;
    char  *psz;
    short  i;
    short  xMax;
    short  y;
    short  ids;
    POINT  pt;
    short  iMax;

    sVar1 = GetRaceStat((PLAYER *)rgplr + idPlayer, rsMajorAdv);
    ids = 0xed;
    xMax = 4;
    x = 4;
    y = 2;
    SelectObject(hdc, rghfontArial8[1]);
    if (fPrint != 0) {
        psz = PszGetCompressedString(idsResourceInfo);
        cLen = _strlen(psz);
        CtrTextOut(hdc, dx + -8 >> 1, y, psz, cLen);
    }
    y = y + dyArial8 + 4;
    for (i = 0; i <= (int)((sVar1 == raMacintosh) + 8); i = i + 1) {
        SelectObject(hdc, rghfontArial8[1]);
        switch (i) {
        case 0:
            psz = PszGetPlanetName(GlobalPD.u_POPUPDATA_0x0002.dxOut);
            break;
        case 1:
        case 3:
        case 5:
        case 8:
        case 9:
            goto switchD_10c0_34e2_caseD_1;
        case 2:
            cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax;
            goto POPUP_SetQuan;
        case 4:
            cnt = GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 - GlobalPD.u_POPUPDATA_0x0002._4_2_;
            if (0 < cnt)
                goto POPUP_SetQuan;
            psz = PszGetCompressedString(idsNone2);
            break;
        case 6:
            if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur == GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2)
                goto POPUP_OutOfFor;
        switchD_10c0_34e2_caseD_1:
            SelectObject(hdc, rghfontArial8[0]);
            psz = PszGetCompressedString(ids);
            ids = ids + 1;
            break;
        case 7:
            cnt = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur;
        POPUP_SetQuan:
            _wsprintf(szWork, PCTD, cnt);
            psz = (char *)szWork;
        }
        WrapTextOut(hdc, &x, &y, psz, 0, 4, dx + -8, &xMax, 0, fPrint);
    }
POPUP_OutOfFor:
    PVar2.x = xMax + 4;
    PVar2.y = y + dyArial8 + 2;
    return PVar2;
}

// ======================================================================
// Function: PtDisplayString
// Address: 10c0:355c
// Segment: MEMORY_POPUP
// ======================================================================

POINT PtDisplayString(HDC hdc, short dx, short fPrint)

{
    POINT PVar1;
    short x;
    short xMax;
    short y;
    POINT pt;

    xMax = 4;
    x = 4;
    y = 2;
    SelectObject(hdc, rghfontArial8[0]);
    WrapTextOut(hdc, &x, &y, (char *)GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2, 0, 4, dx + -8, &xMax, 0, fPrint);
    PVar1.x = xMax + 4;
    PVar1.y = y + dyArial8 + 2;
    return PVar1;
}
