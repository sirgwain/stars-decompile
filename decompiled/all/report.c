// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: ReportDlg
// Address: 1108:0018
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: idm */

long ReportDlg(HWND hwnd,ushort msg,ushort wParam,long lParam)

{
  int iVar1;
  bool bVar2;
  POINT pt;
  POINT pt_00;
  HDC HVar3;
  HWND HVar4;
  short sVar5;
  ushort uVar6;
  ushort unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar7;
  LRESULT LVar8;
  undefined2 uVar9;
  short idm;
  RECT RStack_2c;
  int iStack_20;
  int iStack_1e;
  int iStack_1c;
  int iStack_1a;
  uint uStack_18;
  int iStack_16;
  int iStack_14;
  UINT UStack_12;
  RECT rc;
  HMENU hmenu;
  HDC hdc;
  
  if (msg == 1) {
    hwndReportDlg = hwnd;
    HVar3 = GetDC(hwnd);
    SelectObject(HVar3,rghfontArial8[1]);
    for (UStack_12 = 0; (int)UStack_12 < vprptCur->cFields; UStack_12 = UStack_12 + 1) {
      iStack_14 = DxReportColHdr(vprptCur->irpt,UStack_12,(char *)szWork,HVar3);
      vprptCur->rgbdx[UStack_12] = (byte)(iStack_14 / 2);
    }
    ReleaseDC(hwnd,HVar3);
    SortReportCache(vprptCur->irpt,vprptCur->icolSort);
    SetWindowPos(hwnd,0,0,0,(&vprptCur->ptSize)->x,(vprptCur->ptSize).y,0xe);
    StickyDlgPos(hwnd,&vprptCur->ptDlg,1);
    HVar4 = CreateWindow(s_SCROLLBAR_1120_15cc,(LPCSTR)0x0,0x40000001,0,0,0x32,0x32,hwnd,0,
                         hInst,(void *)0x0);
    vprptCur->hwndVScroll = HVar4;
    HVar4 = CreateWindow(s_SCROLLBAR_1120_15d6,(LPCSTR)0x0,0x40000000,0,0,0x32,0x32,hwnd,0,
                         hInst,(void *)0x0);
    vprptCur->hwndHScroll = HVar4;
    if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
      idm = 0x19b;
      AdvanceTutor();
    }
LAB_1108_019b:
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    iStack_14 = (rc.bottom + -0x24) / (dyArial8 + 4);
    sVar5 = iStack_14;
    if (vprptCur->cRows <= iStack_14) {
      sVar5 = vprptCur->cRows;
    }
    vprptCur->cRowsVis = sVar5;
    if (vprptCur->cRowsVis < vprptCur->cRows) {
      UStack_12 = 0x44;
      if (((vprptCur->cRows < vprptCur->irowFirst + vprptCur->cRowsVis) &&
          (0 < vprptCur->irowFirst)) &&
         (vprptCur->irowFirst = vprptCur->cRows - vprptCur->cRowsVis,
         vprptCur->irowFirst < 0)) {
        vprptCur->irowFirst = 0;
      }
      idm = 2;
      SetScrollPos(vprptCur->hwndVScroll,2,vprptCur->irowFirst,0);
      idm = 2;
      SetScrollRange(vprptCur->hwndVScroll,2,0,
                     vprptCur->cRows - vprptCur->cRowsVis,1);
    }
    else {
      UStack_12 = 0x84;
      vprptCur->irowFirst = 0;
      idm = 2;
      SetScrollPos(vprptCur->hwndVScroll,2,0,0);
    }
    idm = 0x14f8;
    iStack_16 = GetSystemMetrics(2);
    idm = vprptCur->hwndVScroll;
    SetWindowPos(idm,0,rc.right - iStack_16,dyArial8 + 6,iStack_16,
                 (dyArial8 + 4) * vprptCur->cRowsVis + 1,UStack_12);
    idm = 0x14f8;
    SetHScrollBar();
    return (ulong)(msg == 1);
  }
  if (msg == 2) {
    StickyDlgPos(hwnd,&vprptCur->ptDlg,0);
    GetWindowRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    (&vprptCur->ptSize)->x = rc.right - rc.left;
    (vprptCur->ptSize).y = rc.bottom - rc.top;
    hwndReportDlg = 0;
    fBrowserValid = 0;
    uVar6 = GetASubMenu(hwndFrame,4);
    iVar1 = vprptCur->irpt;
    if (iVar1 == 0) {
      UStack_12 = 0x8fd;
    }
    else if (iVar1 == 1) {
      UStack_12 = 0x8ff;
    }
    else if (iVar1 == 2) {
      UStack_12 = 0x900;
    }
    else if (iVar1 == 3) {
      UStack_12 = 0x901;
    }
    CheckMenuItem(uVar6,UStack_12,0);
    vprptCur = (RPT *)0x0;
    if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
      AdvanceTutor();
    }
  }
  else {
    if (msg == 5) goto LAB_1108_019b;
    if (msg == 0xf) {
      HVar3 = BeginPaint(hwnd,(short *)CONCAT22(unaff_SS,&idm));
      DrawReport(hwnd,HVar3,&RStack_2c);
      EndPaint(hwnd,(short *)CONCAT22(unaff_SS,&idm));
      gd.wFlags = gd.wFlags & 0xfdff;
      return 1;
    }
    if (msg == 0x14) {
      GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
      FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
      return 1;
    }
    if (msg == 0x24) {
      *(undefined2 *)((int)lParam + 0xc) = 300;
      *(undefined2 *)((int)lParam + 0xe) = 0xdc;
      return 0;
    }
    if (msg == 0x111) {
      if (wParam == 2) {
        DestroyWindow(hwnd);
        return 1;
      }
    }
    else {
      if (msg == 0x114) {
        uVar7 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),idm);
        UStack_12 = GetScrollPos((HWND)uVar7,2);
        iStack_14 = UStack_12;
        switch(wParam) {
        case 0:
          iStack_14 = UStack_12 + -1;
          break;
        case 1:
          iStack_14 = UStack_12 + 1;
          break;
        case 2:
          iStack_14 = UStack_12 + -3;
          break;
        case 3:
          iStack_14 = UStack_12 + 3;
          break;
        case 4:
        case 5:
          iStack_14 = (int)lParam;
          break;
        case 6:
          iStack_14 = 0;
          break;
        case 7:
          iStack_14 = 2000;
        }
        if (vprptCur->cColScroll < iStack_14) {
          iStack_14 = vprptCur->cColScroll;
        }
        if (iStack_14 < 0) {
          iStack_14 = 0;
        }
        if (iStack_14 != UStack_12) {
          uVar7 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),idm);
          SetScrollPos((HWND)uVar7,2,iStack_14,1);
          uVar7 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),idm);
          iStack_14 = GetScrollPos((HWND)uVar7,2);
          if (iStack_14 != UStack_12) {
            iStack_16 = 1;
            uStack_18 = 2;
            while ((iStack_16 < vprptCur->cFields &&
                   ((((uStack_18 & (uint)vprptCur->grbitVisible) == 0 &&
                     (((int)uStack_18 >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2))
                      == 0)) ||
                    (iVar1 = iStack_14 + -1, bVar2 = 0 < iStack_14, iStack_14 = iVar1, bVar2))))) {
              iStack_16 = iStack_16 + 1;
              uStack_18 = uStack_18 << 1;
            }
            vprptCur->cFieldFirst = iStack_16;
            InvalidateRect(hwnd,(undefined2 *)0x0,1);
            UpdateWindow(hwnd);
          }
        }
        return 0;
      }
      if (msg == 0x115) {
        uVar7 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),idm);
        UStack_12 = GetScrollPos((HWND)uVar7,2);
        iStack_14 = UStack_12;
        switch(wParam) {
        case 0:
          iStack_14 = UStack_12 + -1;
          break;
        case 1:
          iStack_14 = UStack_12 + 1;
          break;
        case 2:
          iStack_14 = UStack_12 - (vprptCur->cRowsVis + -1);
          break;
        case 3:
          iStack_14 = UStack_12 + vprptCur->cRowsVis + -1;
          break;
        case 4:
        case 5:
          iStack_14 = (int)lParam;
          break;
        case 6:
          iStack_14 = 0;
          break;
        case 7:
          iStack_14 = 2000;
        }
        if (vprptCur->cRows - vprptCur->cRowsVis < iStack_14) {
          iStack_14 = vprptCur->cRows - vprptCur->cRowsVis;
        }
        if (iStack_14 < 0) {
          iStack_14 = 0;
        }
        if (iStack_14 != UStack_12) {
          vprptCur->irowFirst = iStack_14;
          GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
          rc.left = 2;
          uVar9 = 2;
          sVar5 = GetSystemMetrics(2);
          rc.right = rc.right - sVar5;
          rc.top = dyArial8 + 6;
          rc.bottom = (dyArial8 + 4) * vprptCur->cRowsVis + rc.top;
          ScrollWindow(hwnd,0,(dyArial8 + 4) * (UStack_12 - iStack_14),
                       (undefined2 *)CONCAT22(unaff_SS,&rc),(undefined2 *)CONCAT22(unaff_SS,&rc));
          uVar7 = __aFulshr(CONCAT22(unaff_DI,uVar9),unaff_SI);
          SetScrollPos((HWND)uVar7,2,iStack_14,1);
          UpdateWindow(hwnd);
        }
        return 0;
      }
      if (((msg == 0x201) || (msg == 0x203)) || (msg == 0x204)) {
        iStack_1e = 2;
        iStack_14 = (int)lParam;
        uVar7 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),idm);
        UStack_12 = (UINT)uVar7;
        if ((1 < (int)UStack_12) && (1 < iStack_14)) {
          if ((int)UStack_12 < dyArial8 + 6) {
            iStack_1c = -1;
          }
          else {
            iStack_20 = dyArial8 + 4;
            iStack_1c = (int)((UStack_12 - 2) - iStack_20) / (dyArial8 + 4);
            if (vprptCur->cRowsVis <= iStack_1c) goto LAB_1108_09c8;
            iStack_1c = iStack_1c + vprptCur->irowFirst;
          }
          iStack_1a = -1;
          uStack_18 = 1;
          for (iStack_16 = 0; iStack_16 < vprptCur->cFields; iStack_16 = iStack_16 + 1) {
            if ((((uStack_18 & (uint)vprptCur->grbitVisible) != 0) ||
                (((int)uStack_18 >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0))
               && (((iStack_16 == 0 || (vprptCur->cFieldFirst <= iStack_16)) &&
                   (iStack_1e = iStack_1e + (uint)vprptCur->rgbdx[iStack_16] * 2,
                   iStack_14 < iStack_1e)))) {
              iStack_1a = iStack_16;
              break;
            }
            uStack_18 = uStack_18 << 1;
          }
          if (iStack_1a != -1) {
            if (iStack_1c == -1) {
              pt_00.y = UStack_12;
              pt_00.x = iStack_14;
              ReportColumnPopup(pt_00,iStack_1a,(uint)(msg == 0x204));
            }
            else {
              pt.y = UStack_12;
              pt.x = iStack_14;
              ExecuteReportClick(pt,vprptCur->irpt,iStack_1a,iStack_1c);
            }
            if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
              AdvanceTutor();
            }
          }
        }
      }
    }
  }
LAB_1108_09c8:
  LVar8 = DefWindowProc(hwnd,msg,wParam,lParam);
  return LVar8;
}



// ======================================================================
// Function: SetHScrollBar
// Address: 1108:09e8
// Segment: MEMORY_REPORT
// ======================================================================


void SetHScrollBar(void)

{
  int iVar1;
  short sVar2;
  int iVar3;
  short sVar4;
  undefined2 unaff_SS;
  RECT rc;
  short xTitle;
  short dx;
  short xRight;
  short ibit;
  short i;
  short ccolHidden;
  short ccolSkipped;
  short dy;
  ushort swp;
  
  GetClientRect(hwndReportDlg,(undefined2 *)CONCAT22(unaff_SS,&rc));
  sVar2 = GetSystemMetrics(2);
  iVar3 = (uint)vprptCur->rgbdx[0] * 2 + 2;
  xRight = ((rc.right - iVar3) + -2) - sVar2;
  ccolSkipped = 0;
  ccolHidden = 0;
  ibit = 1 << ((byte)vprptCur->cFields & 0x1f);
  iVar1 = vprptCur->cFields;
  while (i = iVar1 + -1, 0 < i) {
    if (((ibit & (uint)vprptCur->grbitVisible) != 0) ||
       ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) {
      if (i < vprptCur->cFieldFirst) {
        ccolSkipped = ccolSkipped + 1;
      }
      xRight = xRight + (uint)vprptCur->rgbdx[iVar1 + -1] * -2;
      if (xRight < 0) {
        ccolHidden = ccolHidden + 1;
      }
    }
    ibit = ibit >> 1;
    iVar1 = i;
  }
  vprptCur->cColScroll = 0;
  if (ccolHidden == 0) {
    swp = 0x84;
    vprptCur->cFieldFirst = 1;
    SetScrollPos(vprptCur->hwndHScroll,2,0,0);
  }
  else {
    swp = 0x44;
    if (ccolHidden < ccolSkipped) {
      ccolSkipped = 0;
      vprptCur->cFieldFirst = 1;
    }
    SetScrollPos(vprptCur->hwndHScroll,2,ccolSkipped,0);
    SetScrollRange(vprptCur->hwndHScroll,2,0,ccolHidden,1);
    vprptCur->cColScroll = ccolHidden;
  }
  sVar4 = GetSystemMetrics(3);
  SetWindowPos(vprptCur->hwndHScroll,0,iVar3,
               dyArial8 + (dyArial8 + 4) * vprptCur->cRowsVis + 7,
               (rc.right - sVar2) - iVar3,sVar4,swp);
  return;
}



// ======================================================================
// Function: DrawReport
// Address: 1108:0bae
// Segment: MEMORY_REPORT
// ======================================================================


void DrawReport(HWND hwnd,HDC hdc,RECT *prc)

{
  byte bVar1;
  short sVar2;
  int iVar3;
  ushort uVar4;
  int iVar5;
  undefined2 unaff_SS;
  LPCSTR pcVar6;
  HDC HVar7;
  RECT rc;
  short xCol;
  short dx;
  short ibit;
  short yRow;
  short i;
  short j;
  short irowLast;
  char szTit [40];
  
  ibit = 1;
  xCol = 2;
  yRow = 2;
  SelectObject(hdc,rghfontArial8[1]);
  SetBkMode(hdc,1);
  if (prc->top <= dyArial8 + 6) {
    for (i = 0; i < vprptCur->cFields; i = i + 1) {
      if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
          ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
         ((i == 0 || (vprptCur->cFieldFirst <= i)))) {
        sVar2 = DxReportColHdr(vprptCur->irpt,i,szTit,hdc);
        vprptCur->rgbdx[i] = (byte)(sVar2 / 2);
        SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xCol,2,xCol + sVar2 + -1,dyArial8 + 6
               );
        if (((uint)gd.wFlags >> 9 & 1) != 0) {
          FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
        }
        if (i == 0) {
          iVar5 = rc.left + 3;
          iVar3 = rc.top + 2;
          pcVar6 = (LPCSTR)CONCAT22(unaff_SS,szTit);
          HVar7 = hdc;
          uVar4 = _strlen(szTit);
          TextOut(HVar7,iVar5,iVar3,pcVar6,uVar4);
        }
        else {
          CtrTextOut(hdc,(rc.right - rc.left) / 2 + rc.left,rc.top + 2,szTit,0);
        }
        _Draw3dFrame(hdc,&rc,0);
        xCol = xCol + sVar2;
      }
      ibit = ibit << 1;
    }
  }
  irowLast = vprptCur->irowFirst + vprptCur->cRowsVis;
  if (vprptCur->cRows < irowLast) {
    irowLast = vprptCur->cRows;
  }
  for (i = vprptCur->irowFirst; i < irowLast; i = i + 1) {
    yRow = yRow + dyArial8 + 4;
    xCol = 2;
    if ((prc->top <= yRow) && (yRow <= prc->bottom)) {
      SelectObject(hdc,hbrButtonShadow);
      PatBlt(hdc,2,yRow,1,dyArial8 + 4,0xf00021);
    }
    ibit = 1;
    for (j = 0; j < vprptCur->cFields; j = j + 1) {
      if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
          ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
         ((j == 0 || (vprptCur->cFieldFirst <= j)))) {
        bVar1 = vprptCur->rgbdx[j];
        iVar5 = (uint)bVar1 * 2;
        if ((prc->top - (dyArial8 + 4) <= yRow) && (yRow <= prc->bottom)) {
          SelectObject(hdc,hbrButtonShadow);
          PatBlt(hdc,xCol + iVar5 + -1,yRow,1,dyArial8 + 4,0xf00021);
          PatBlt(hdc,xCol,dyArial8 + 4 + yRow,(uint)bVar1 << 1,1,0xf00021);
          SetRect((undefined2 *)CONCAT22(unaff_SS,&rc),xCol + 2,yRow + 2,xCol + iVar5 + -3,
                  dyArial8 + yRow + 3);
          if (((uint)gd.wFlags >> 9 & 1) != 0) {
            FillRect(hdc,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
          }
          DrawReportItem(hdc,&rc,vprptCur->irpt,i,j);
        }
        xCol = xCol + iVar5;
      }
      ibit = ibit << 1;
    }
  }
  return;
}



// ======================================================================
// Function: ScoreXDlg
// Address: 1108:0f66
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cch */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short ScoreXDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  short sVar1;
  short sVar2;
  uint uVar3;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar4;
  ulong uVar5;
  long *rgids;
  char **rgsz;
  short cch;
  short iSel;
  char *psz;
  long rgid [12];
  short i_2;
  short c;
  char *rgszScan [1];
  short cchHistory;
  char acStack_36 [6];
  undefined2 auStack_30 [15];
  undefined2 uStack_12;
  HDC HStack_10;
  RECT rc;
  short i;
  
  uVar5 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    HStack_10 = BeginPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,auStack_30));
    if (((uint)gd._4_2_ >> 0xb & 3) == 2) {
      DrawHistoryReport(HStack_10);
    }
    else if (((uint)gd._4_2_ >> 0xb & 3) == 0) {
      DrawScoreReport(HStack_10);
    }
    else {
      DrawVCReport(HStack_10);
    }
    EndPaint(hwnd,(undefined2 *)CONCAT22(unaff_SS,auStack_30));
    sVar1 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    sVar1 = 1;
  }
  else {
    if (message == WM_SETCURSOR) {
      if (((uint)gd._4_2_ >> 0xb & 3) == 2) {
        GetCursorPos((undefined2 *)CONCAT22(unaff_SS,&uStack_12));
        ScreenToClient(hwnd,(undefined2 *)CONCAT22(unaff_SS,&uStack_12));
        if (((int)HStack_10 < dyArial10 + dyArial8 + -2) && (2 < (int)HStack_10)
           ) {
          setcursor(hcurHand);
          return 1;
        }
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        InitScoreDlg(hwnd,(uint)gd._4_2_ >> 0xb & 3);
        fInScoreDialog = 1;
        StickyDlgPos(hwnd,(POINT *)&ptStickyScoreXDlg,1);
        hwndScoreXDlg = hwnd;
        if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 2) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyScoreXDlg,0);
          EndDialog(hwnd,i);
          fInScoreDialog = 0;
          hwndScoreXDlg = 0;
          if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
          return 1;
        }
        if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0x455);
          return 1;
        }
        if (wParam == 0xc6) {
          HStack_10 = (((uint)gd._4_2_ >> 0xb & 3) + 1) % 3;
          gd._4_2_ = gd._4_2_ & 0xe7ff | HStack_10 << 0xb;
          InvalidateRect(hwnd,(undefined2 *)0x0,1);
          InitScoreDlg(hwnd,(uint)gd._4_2_ >> 0xb & 3);
          if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
        }
      }
      else if ((((message == WM_LBUTTONDOWN) || (message == WM_RBUTTONDOWN)) &&
               (c = 0, ((uint)gd._4_2_ >> 0xb & 3) == 2)) &&
              ((uVar4 = __aFulshr(uVar5,cch), 2 < (uint)uVar4 &&
               (uVar5 = __aFulshr(uVar5,cch),
               (uint)uVar5 < (dyArial10 + dyArial8) - 2U)))) {
        sVar1 = CchGetString(idsHistory,acStack_36);
        for (i_2 = 0; i_2 < 8; i_2 = i_2 + 1) {
          _strcpy((char *)szWork + i_2 * 0x28,acStack_36);
          sVar2 = CchGetString
                            (i_2 + idsPlanets,(char *)szWork + sVar1 + i_2 * 0x28);
          ((char *)szWork + sVar1 + i_2 * 0x28)[sVar2 + -1] = '\0';
          *(uint *)(rgid + c) = (uint)((gd.wFlags & 0xfU) == i_2);
          *(undefined2 *)((int)rgid + c * 4 + 2) = 0;
          rgszScan[c] = (char *)szWork + i_2 * 0x28;
          c = c + 1;
        }
        sVar2 = 0;
        sVar1 = -2;
        rgsz = rgszScan;
        rgids = rgid;
        uVar5 = __aFulshr(CONCAT22(rgids,c),(ushort)rgsz);
        uVar3 = PopupMenu(hwnd,(short)lParam,(short)uVar5,c,rgids,rgsz,sVar1,sVar2);
        if (uVar3 != 0xffff) {
          gd.wFlags = gd.wFlags & 0xfff0U | uVar3 & 0xf;
          gd._4_2_ = gd._4_2_ & 0xff7f | 0x80;
          InvalidateRect(hwnd,(undefined2 *)0x0,1);
        }
      }
    }
    sVar1 = 0;
  }
  return sVar1;
}



// ======================================================================
// Function: InitScoreDlg
// Address: 1108:13b6
// Segment: MEMORY_REPORT
// ======================================================================


void InitScoreDlg(HWND hwnd,short fVictory)

{
  HDC HVar1;
  char *pcVar2;
  ushort uVar3;
  HWND HVar4;
  int iVar5;
  undefined2 unaff_SS;
  DWORD DVar6;
  DWORD DVar7;
  undefined1 *puVar8;
  HDC HVar9;
  RECT rc;
  short dx;
  char *psz;
  RECT rcWindow;
  short dxFrame;
  short dyFrame;
  short dy;
  short dxDig;
  HDC hdc;
  
  HVar1 = GetDC(hwnd);
  SelectObject(HVar1,rghfontArial8[1]);
  DVar6 = GetTextExtent(HVar1,&DAT_1120_15e8,1);
  if (fVictory == 2) {
    dx = 600;
    dy = 400;
  }
  else if (fVictory == 0) {
    pcVar2 = PszGetCompressedString(idsUnarmedShips2);
    puVar8 = (undefined1 *)&DAT_1120_1120;
    HVar9 = HVar1;
    uVar3 = _strlen(pcVar2);
    DVar7 = GetTextExtent(HVar9,(LPCSTR)CONCAT22(puVar8,pcVar2),uVar3);
    vdxScoreX = (int)DVar7 + 8;
    iVar5 = game.cPlayer;
    if (game.cPlayer < 4) {
      iVar5 = 4;
    }
    dx = iVar5 * (int)DVar6 * 5 + vdxScoreX + 8;
    dy = (dyArial8 * 0x21) / 2 + 0x58;
  }
  else {
    pcVar2 = PszGetCompressedString(idsExceedsSecondPlaceScore);
    puVar8 = (undefined1 *)&DAT_1120_1120;
    HVar9 = HVar1;
    uVar3 = _strlen(pcVar2);
    DVar7 = GetTextExtent(HVar9,(LPCSTR)CONCAT22(puVar8,pcVar2),uVar3);
    vdxScoreX = (int)(((long)(int)DVar7 * 3 & 0xffffU) / 2) + (int)DVar6 * 6;
    iVar5 = game.cPlayer;
    if (game.cPlayer < 4) {
      iVar5 = 4;
    }
    dx = (iVar5 * dyArial8 * 3) / 2 + vdxScoreX + 8;
    dy = (dyArial8 * 0x21) / 2 + 0x58;
  }
  ReleaseDC(hwnd,HVar1);
  GetWindowRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rcWindow));
  GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
  SetWindowPos(hwnd,0,0,0,((rcWindow.right - rcWindow.left) - rc.right) + dx,
               ((rcWindow.bottom - rcWindow.top) - rc.bottom) + dy,6);
  HVar4 = GetDlgItem(hwnd,2);
  GetWindowRect(HVar4,(undefined2 *)CONCAT22(unaff_SS,&rc));
  MapWindowPoints(0,hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc),2);
  OffsetRect((undefined2 *)CONCAT22(unaff_SS,&rc),0,(dy + -4) - rc.bottom);
  iVar5 = (dx + (rc.right - rc.left) * -3) / 4;
  HVar4 = GetDlgItem(hwnd,0xc6);
  SetWindowPos(HVar4,0,iVar5,rc.top,0,0,5);
  HVar4 = GetDlgItem(hwnd,2);
  SetWindowPos(HVar4,0,iVar5 * 2 + (rc.right - rc.left),rc.top,0,0,5);
  HVar4 = GetDlgItem(hwnd,0x76);
  SetWindowPos(HVar4,0,iVar5 * 3 + (rc.right - rc.left) * 2,rc.top,0,0,5);
  pcVar2 = PszGetCompressedString(fVictory + idsPlayerScores);
  SetWindowText(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar2));
  return;
}



// ======================================================================
// Function: DrawVCReport
// Address: 1108:168e
// Segment: MEMORY_REPORT
// ======================================================================


void DrawVCReport(HDC hdc)

{
  char *pcVar1;
  ushort uVar2;
  HDC HVar3;
  HGDIOBJ HVar4;
  int iVar5;
  int iVar6;
  short sVar7;
  short sVar8;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  DWORD DVar9;
  ulong num;
  long lVar10;
  undefined2 uVar11;
  undefined2 uVar12;
  short vcVal;
  short idsT;
  long l;
  short xLeft;
  short cch;
  HBITMAP hbmpSav;
  char *psz;
  short iPass;
  short i;
  short j;
  HDC hdcMem;
  short cCur;
  COLORREF cr;
  short ids;
  short cCurSav;
  POINT pt;
  short yTop;
  short dxDig;
  short xStart;
  short grbitVC;
  
  yTop = 0x58;
  SetBkMode(hdc,1);
  SelectObject(hdc,rghfontArial8[4]);
  xLeft = vdxScoreX;
  for (i = 0; i < game.cPlayer; i = i + 1) {
    pcVar1 = PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
    uVar2 = _strlen(pcVar1);
    DVar9 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar1),uVar2);
    lVar10 = __ftol((double)(qword)CONCAT24((int)DVar9,CONCAT22(unaff_SI,unaff_DI)));
    if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) ||
       ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) {
      if (((uint)((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) {
        cr._0_2_ = 0;
        cr._2_2_ = 0;
      }
      else {
        cr._0_2_ = 0;
        cr._2_2_ = 0xff;
      }
    }
    else {
      cr._0_2_ = 0x7f7f;
      cr._2_2_ = 0x7f;
    }
    SetTextColor(hdc,CONCAT22(cr._2_2_,(undefined2)cr));
    TextOut(hdc,(xLeft - (int)lVar10) + (dyArial8 * 3) / 2,
            (-(dyArial8 / 2) - (int)lVar10) + 0x54,
            (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar1),uVar2);
    xLeft = xLeft + (dyArial8 * 3) / 2;
  }
  SelectObject(hdc,rghfontArial8[1]);
  SelectObject(hdc,hbrButtonShadow);
  GetTextExtent(hdc,&DAT_1120_15ea,1);
  ids = 0x3aa;
  cCur = 0;
  HVar3 = CreateCompatibleDC(hdc);
  HVar4 = SelectObject(HVar3,hbmpMono);
  SetTextColor(hdc,0);
  SetBkColor(hdc,0xffffff);
  xLeft = vdxScoreX + 4;
  iVar5 = ((dyArial8 * 3) / 2 + -0xc) / 2;
  iVar6 = ((dyArial8 * 3) / 2 + -0xb) / 2 - dyArial8 / 4;
  i = 0;
  do {
    if (game.cPlayer <= i) {
      PatBlt(hdc,xLeft,0x58 - dyArial8 / 4,1,(dyArial8 * 0x15) / 2 + 1,0xf00021)
      ;
      SelectObject(HVar3,HVar4);
      DeleteDC(HVar3);
      i = 0;
      do {
        if (8 < i) {
          return;
        }
        for (iPass = 0; iPass < 2; iPass = iPass + 1) {
          if (iPass == 0) {
            cCurSav = cCur;
            xStart = 0;
          }
          else {
            ids = ids + -3;
            if (i < 7) {
              xStart = vdxScoreX - xLeft;
            }
            else {
              xStart = 8;
            }
          }
          if (((i < 8) && (iPass == 1)) &&
             (PatBlt(hdc,vdxScoreX + 4,yTop - dyArial8 / 4,
                     (dyArial8 * game.cPlayer * 3) / 2,1,0xf00021), i == 7)) {
            yTop = yTop + dyArial8 / 2;
          }
          sVar7 = CchGetString(ids,(char *)szWork);
          if (iPass == 1) {
            HVar3 = hdc;
            if ((i < 7) && (sVar8 = GetVCCheck((GAME *)&game,cCurSav), sVar8 == 0)) {
              uVar11 = 0x7f7f;
              uVar12 = 0x7f;
            }
            else {
              uVar11 = 0;
              uVar12 = 0;
            }
            SetTextColor(HVar3,CONCAT22(uVar12,uVar11));
            TextOut(hdc,xStart,yTop,szWork,sVar7);
          }
          DVar9 = GetTextExtent(hdc,szWork,sVar7);
          xLeft = xStart + (int)DVar9;
          cCur = cCurSav;
          iVar5 = ids;
          for (j = 0; ids = iVar5 + 1, j < 2; j = j + 1) {
            if ((j == 1) && (i != 1)) {
              ids = iVar5 + 2;
              break;
            }
            vcVal = GetVCVal((GAME *)&game,cCur,0);
            if (i == 0) {
              idsT = 0x3c5;
              uVar12 = 0;
              uVar11 = 100;
              num = __aFulmul((long)vcVal,(long)game.cPlanMax);
              lVar10 = __aFldiv(num,CONCAT22(uVar12,uVar11));
              vcVal = (short)lVar10;
            }
            else {
              idsT = ids;
            }
            cch = _WSPRINTF((LPSTR)CONCAT22(vcVal,(char *)&DAT_1120_1120),
                            (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),
                            (char *)szWork);
            if (i == 3) {
              _strcat((char *)szWork,(char *)&DAT_1120_15ec);
              cch = cch + 1;
            }
            if (iPass == 1) {
              TextOut(hdc,xLeft,yTop,szWork,cch);
            }
            DVar9 = GetTextExtent(hdc,szWork,cch);
            xLeft = xLeft + (int)DVar9;
            if ((i != 2) && (i != 3)) {
              xLeft = xLeft + 4;
            }
            sVar7 = CchGetString(idsT,(char *)szWork);
            if (iPass == 1) {
              TextOut(hdc,xLeft,yTop,szWork,sVar7);
            }
            DVar9 = GetTextExtent(hdc,szWork,sVar7);
            xLeft = xLeft + (int)DVar9;
            cCur = cCur + 1;
            iVar5 = ids;
          }
          if (iPass == 1) {
            yTop = yTop + (dyArial8 * 3) / 2;
          }
        }
        i = i + 1;
      } while( true );
    }
    grbitVC = (uint)((SCOREX *)vlprgScoreX + i)->wWord >> 6 & 0xff;
    for (j = 0; j < 7; j = j + 1) {
      if ((grbitVC & 1U) != 0) {
        BitBlt(hdc,xLeft + iVar5,iVar6 + 0x58 + (j * dyArial8 * 3) / 2,0xe,0xc,HVar3,0,0,
               0x8800c6);
        if ((((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) ||
            ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) &&
           (sVar7 = GetVCCheck((GAME *)&game,(uint)(1 < j) + j), sVar7 != 0)) {
          if (((uint)((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) goto LAB_1108_1917;
          SetTextColor(hdc,0xff0000);
        }
        else {
          SetTextColor(hdc,CONCAT22(crButtonShadow._2_2_,
                                    (undefined2)crButtonShadow));
        }
        SetBkColor(hdc,0);
        BitBlt(hdc,xLeft + iVar5,iVar6 + 0x58 + (j * dyArial8 * 3) / 2,0xe,0xc,HVar3,0,0,
               0xee0086);
        SetTextColor(hdc,0);
        SetBkColor(hdc,0xffffff);
      }
LAB_1108_1917:
      grbitVC = grbitVC >> 1;
    }
    PatBlt(hdc,xLeft,0x58 - dyArial8 / 4,1,(dyArial8 * 0x15) / 2 + 1,0xf00021);
    xLeft = xLeft + (dyArial8 * 3) / 2;
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: DrawScoreReport
// Address: 1108:1e0c
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11082349) */
/* WARNING: Removing unreachable block (ram,0x1108231e) */

void DrawScoreReport(HDC hdc)

{
  short ids_00;
  int iVar1;
  uint uVar2;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  DWORD DVar3;
  long lVar4;
  ushort in_stack_0000ffcc;
  long l;
  short xLeft;
  short cch;
  long lVal;
  char *psz;
  short iPass;
  short i;
  short j;
  long lMax;
  COLORREF cr;
  short ids;
  short dx45;
  POINT pt;
  short yTop;
  short dxDig;
  
  yTop = 0x58;
  SetBkMode(hdc,1);
  SelectObject(hdc,rghfontArial8[1]);
  DVar3 = GetTextExtent(hdc,&DAT_1120_15ee,1);
  iVar1 = (int)DVar3;
  SelectObject(hdc,rghfontArial8[4]);
  xLeft = (iVar1 * 5 - (dyArial8 * 3) / 2) / 2 + vdxScoreX;
  for (i = 0; i < game.cPlayer; i = i + 1) {
    psz = PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
    cch = _strlen(psz);
    DVar3 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),cch);
    in_stack_0000ffcc = (ushort)DVar3;
    lVar4 = __ftol((double)(qword)CONCAT24(in_stack_0000ffcc,CONCAT22(unaff_SI,unaff_DI)));
    dx45 = (short)lVar4;
    if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) ||
       ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) {
      if (((uint)((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) {
        cr._0_2_ = 0;
        cr._2_2_ = 0;
      }
      else {
        cr._0_2_ = 0;
        cr._2_2_ = 0xff;
      }
    }
    else {
      cr._0_2_ = 0x7f7f;
      cr._2_2_ = 0x7f;
    }
    SetTextColor(hdc,CONCAT22(cr._2_2_,(undefined2)cr));
    TextOut(hdc,(xLeft - dx45) + (dyArial8 * 3) / 2,
            (-(dyArial8 / 2) - dx45) + 0x54,
            (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),cch);
    xLeft = xLeft + iVar1 * 5;
  }
  SelectObject(hdc,rghfontArial8[1]);
  SelectObject(hdc,hbrButtonShadow);
  ids = 0x1b3;
  xLeft = vdxScoreX + 4;
  pt.x = ((dyArial8 * 3) / 2 + -0xc) / 2;
  pt.y = ((dyArial8 * 3) / 2 + -0xb) / 2 - dyArial8 / 4;
  for (i = 0; i <= game.cPlayer; i = i + 1) {
    PatBlt(hdc,xLeft,0x58 - dyArial8 / 4,1,(dyArial8 * 0x1b) / 2 + 1,0xf00021);
    xLeft = xLeft + iVar1 * 5;
  }
  SetTextColor(hdc,0);
  lVar4 = CONCAT22(lVal._2_2_,(undefined2)lVal);
  for (i = 0; lVal = lVar4, i < 9; i = i + 1) {
    PatBlt(hdc,vdxScoreX + 4,yTop - dyArial8 / 4,game.cPlayer * iVar1 * 5
           ,1,0xf00021);
    ids_00 = ids;
    ids = ids + 1;
    cch = CchGetString(ids_00,(char *)szWork);
    SetTextColor(hdc,0);
    RightTextOut(hdc,vdxScoreX,yTop,(char *)szWork,cch,0);
    xLeft = iVar1 * 5 + vdxScoreX + 2;
    lMax = 0;
    lVar4 = lVal;
    for (iPass = 0; iPass < 2; iPass = iPass + 1) {
      for (j = 0; j < game.cPlayer; j = j + 1) {
        if (((uint)((SCOREX *)vlprgScoreX + j)->wWord >> 5 & 1) == 0) {
          lVar4 = -1;
        }
        else {
          switch(i) {
          case 0:
            lVar4 = (long)((SCOREX *)vlprgScoreX)[j].score.cPlanet;
            break;
          case 1:
            lVar4 = (long)((SCOREX *)vlprgScoreX)[j].score.cStarbase;
            break;
          case 2:
          case 3:
          case 4:
            lVal = lVar4;
            lVar4 = __aFlshl(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffcc);
            break;
          case 5:
            lVar4 = (long)((SCOREX *)vlprgScoreX)[j].score.cTechLevels;
            break;
          case 6:
            lVar4 = CONCAT22(*(undefined2 *)
                              ((int)&((SCOREX *)vlprgScoreX)[j].score.cResources + 2),
                             (int)((SCOREX *)vlprgScoreX)[j].score.cResources);
            break;
          case 7:
            lVar4 = CONCAT22(*(undefined2 *)
                              ((int)&((SCOREX *)vlprgScoreX)[j].score.lScore + 2),
                             (int)(&((SCOREX *)vlprgScoreX)[j].score)->lScore);
            break;
          case 8:
            lVar4 = (long)((SCOREX *)vlprgScoreX)[j].iRank;
          }
        }
        if (iPass == 0) {
          if (lMax < lVar4) {
            lMax = lVar4;
          }
        }
        else if ((-1 < lVar4) &&
                (((*(uint *)((int)&rgplr[0].wMdPlr + j * 0xc0) >> 8 & 1) == 0 ||
                 ((*(uint *)((int)&rgplr[0].wFlags + j * 0xc0) & 1) == 0)))) {
          lVal = lVar4;
          if (i == 8) {
            if (lVar4 == 1) {
              uVar2 = 0xff;
            }
            else {
              uVar2 = 0;
            }
            SetTextColor(hdc,(ulong)uVar2 << 0x10);
          }
          else {
            if (lMax == lVar4) {
              uVar2 = 0xff;
            }
            else {
              uVar2 = 0;
            }
            SetTextColor(hdc,(ulong)uVar2 << 0x10);
          }
          psz = PszFromLongK(lVal,&cch);
          RightTextOut(hdc,xLeft,yTop,psz,cch,0);
          lVar4 = lVal;
        }
        if (iPass == 1) {
          xLeft = xLeft + iVar1 * 5;
        }
      }
    }
    yTop = yTop + (dyArial8 * 3) / 2;
  }
  PatBlt(hdc,vdxScoreX + 4,yTop - dyArial8 / 4,game.cPlayer * iVar1 * 5,1
         ,0xf00021);
  return;
}



// ======================================================================
// Function: DrawHistoryReport
// Address: 1108:2494
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11082b7f) */
/* WARNING: Removing unreachable block (ram,0x11082b2d) */
/* WARNING: Removing unreachable block (ram,0x11082adb) */
/* WARNING: Removing unreachable block (ram,0x11082a8b) */
/* WARNING: Removing unreachable block (ram,0x11082a3b) */
/* WARNING: Removing unreachable block (ram,0x110829cf) */
/* WARNING: Removing unreachable block (ram,0x110827e6) */
/* WARNING: Removing unreachable block (ram,0x110827c2) */
/* WARNING: Removing unreachable block (ram,0x11082840) */
/* WARNING: Removing unreachable block (ram,0x11082a16) */
/* WARNING: Removing unreachable block (ram,0x11082a63) */
/* WARNING: Removing unreachable block (ram,0x11082ab3) */
/* WARNING: Removing unreachable block (ram,0x11082b04) */
/* WARNING: Removing unreachable block (ram,0x11082b56) */
/* WARNING: Removing unreachable block (ram,0x11082cc5) */

void DrawHistoryReport(HDC hdc)

{
  long num;
  short sVar1;
  short sVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  char *pcVar6;
  ushort uVar7;
  HPEN HVar8;
  HGDIOBJ HVar9;
  int iVar10;
  SCOREX *pSVar11;
  char *unaff_SS;
  ulong uVar12;
  long lVar13;
  ulong uVar14;
  ulong uVar15;
  ulong uVar16;
  undefined1 *puVar17;
  undefined2 uVar18;
  undefined2 uVar19;
  undefined2 uVar20;
  undefined2 uVar21;
  HDC HVar22;
  SCOREX *lpsx;
  HPEN hpen;
  HPEN hpenSav;
  RECT rc;
  RECT rcDiamond;
  short cch;
  long cInc;
  short xCur;
  long cScaleMax;
  short dx;
  char *psz;
  short cDrawn;
  short yCur;
  short i;
  short j;
  ushort iYearBase;
  long cCur;
  long cYears;
  short dy;
  POINT pt;
  ushort dYear;
  RECT rcChart;
  char szT [100];
  
  SetBkMode(hdc,1);
  GetClientRect(hwndScoreXDlg,(undefined2 *)CONCAT22(unaff_SS,&rcChart));
  ExpandRc(&rcChart,-0x30,0);
  rcChart.top = dyArial10 + dyArial8;
  rcChart.bottom = rcChart.bottom + dyArial8 * -4;
  rc.left = rcChart.left;
  rc.right = rcChart.right;
  rc.top = dyArial8 / 2;
  rc.bottom = rc.top + dyArial10;
  sVar1 = CchGetString(idsHistory,szT);
  sVar2 = CchGetString((gd.wFlags & 0xfU) + idsPlanets,szT + sVar1);
  (szT + sVar1)[sVar2 + -1] = '\0';
  SelectObject(hdc,rghfontArial10[1]);
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  RcCtrTextOut(hdc,&rc,szT,0);
  SetRect((undefined2 *)CONCAT22(unaff_SS,&rcDiamond),0xf,rc.top,dyArial10 + 0xf,
          rc.top + dyArial10);
  DrawDiamond(hdc,&rcDiamond,hbrBBlue);
  iVar3 = rcChart.right - rcChart.left;
  iVar4 = rcChart.bottom - rcChart.top;
  PatBlt(hdc,rcChart.left,rcChart.top,iVar3,iVar4,0x42);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,rcChart.left + -1,rcChart.bottom,iVar3 + 3,1,0xf00021);
  PatBlt(hdc,rcChart.left + -2,rcChart.bottom + 1,iVar3 + 4,1,0xf00021);
  PatBlt(hdc,rcChart.right,rcChart.top + -1,1,iVar4 + 3,0xf00021);
  PatBlt(hdc,rcChart.right + 1,rcChart.top + -2,1,iVar4 + 4,0xf00021);
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,rcChart.left + -2,rcChart.top + -2,iVar3 + 3,1,0xf00021);
  PatBlt(hdc,rcChart.left + -2,rcChart.top + -1,iVar3 + 2,1,0xf00021);
  PatBlt(hdc,rcChart.left + -2,rcChart.top + -2,1,iVar4 + 3,0xf00021);
  PatBlt(hdc,rcChart.left + -1,rcChart.top + -2,1,iVar4 + 2,0xf00021);
  ExpandRc(&rcChart,-2,-2);
  if ((uint)game.turn < 0x65) {
    iYearBase = 0;
  }
  else {
    iYearBase = game.turn - 100;
  }
  uVar20 = 0;
  uVar18 = 5;
  uVar12 = __aFldiv((ulong)(game.turn + 4),5);
  uVar12 = __aFulmul(uVar12,CONCAT22(uVar20,uVar18));
  if ((long)uVar12 < 0x65) {
    if (0x32 < (long)uVar12) {
      uVar20 = 0;
      uVar18 = 10;
      uVar12 = __aFldiv(uVar12 + 5,10);
      uVar12 = __aFulmul(uVar12,CONCAT22(uVar20,uVar18));
    }
  }
  else {
    uVar12 = 100;
  }
  SelectObject(hdc,rghfontArial8[1]);
  cYears._0_2_ = (int)uVar12;
  if ((long)uVar12 < 0x33) {
    j = 5;
  }
  else {
    j = 10;
  }
  iVar5 = (int)cYears / j;
  if (0 < iVar5) {
    for (i = 0; i <= iVar5; i = i + 1) {
      iVar10 = ((iVar3 + -4) * i) / iVar5 + rcChart.left;
      sVar1 = _WSPRINTF((LPSTR)CONCAT22(iYearBase + 0x960 + i * j,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTD,unaff_SS),szT);
      CtrTextOut(hdc,iVar10,rcChart.bottom + 6,szT,sVar1);
      if ((0 < i) && (i < iVar5)) {
        PatBlt(hdc,iVar10,rcChart.top + -2,1,iVar4,0xf00021);
      }
    }
  }
  num = -1;
  for (i = 0; i < game.cPlayer; i = i + 1) {
    if ((((SCOREX **)rgsxPlr)[i * 2] != (SCOREX *)0x0) ||
       (*(int *)((undefined *)&DAT_1120_156e + i * 4) != 0)) {
      for (j = 0; j < ((short *)rgcsxPlr)[i]; j = j + 1) {
        lVar13 = LFetchScoreXVal((SCOREX *)
                                 CONCAT22(*(undefined2 *)((undefined *)&DAT_1120_156e + i * 4),
                                          ((SCOREX **)rgsxPlr)[i * 2] + j),
                                 gd.wFlags & 0xf);
        if (num < lVar13) {
          num = lVar13;
        }
      }
    }
  }
  if ((0xffff < num) || (-1 < num)) {
    if (num < 5) {
      num = 5;
    }
    if (num < 0xd) {
      uVar14 = 1;
    }
    else if (num < 0x1a) {
      uVar14 = 2;
    }
    else if (num < 0x3d) {
      uVar14 = 5;
    }
    else if (num < 0x79) {
      uVar14 = 10;
    }
    else if (num < 0x12d) {
      uVar14 = 0x19;
    }
    else if (num < 0x259) {
      uVar14 = 0x32;
    }
    else if (num < 0x4b1) {
      uVar14 = 100;
    }
    else if (num < 0x1771) {
      uVar14 = 500;
    }
    else if (num < 0x2ee1) {
      uVar14 = 1000;
    }
    else {
      uVar21 = 0;
      uVar19 = 500;
      uVar20 = 0;
      uVar18 = 500;
      lVar13 = __aFldiv(num,0xc);
      uVar14 = __aFldiv(lVar13,CONCAT22(uVar20,uVar18));
      uVar14 = __aFulmul(uVar14,CONCAT22(uVar21,uVar19));
    }
    iVar5 = rcChart.left + -6;
    for (uVar16 = uVar14; cCur._0_2_ = (undefined2)uVar16, (long)uVar16 < num;
        uVar16 = uVar14 + uVar16) {
      lVar13 = num;
      uVar15 = __aFulmul((long)(iVar4 + -4),uVar16);
      lVar13 = __aFldiv(uVar15,lVar13);
      iVar10 = rcChart.bottom - (int)lVar13;
      if (iVar10 < dyArial8 / 2 + rcChart.top) break;
      sVar1 = _WSPRINTF((LPSTR)CONCAT22((undefined2)cCur,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTLD,(char *)&DAT_1120_1120),
                        (char *)szWork);
      RightTextOut
                (hdc,iVar5,iVar10 - dyArial8 / 2,(char *)szWork,sVar1,0);
      PatBlt(hdc,rcChart.left + -2,iVar10,iVar3,1,0xf00021);
    }
    iVar5 = rcChart.left + 6;
    yCur = rcChart.top + 6;
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if ((((SCOREX **)rgsxPlr)[i * 2] != (SCOREX *)0x0) ||
         (*(int *)((undefined *)&DAT_1120_156e + i * 4) != 0)) {
        pcVar6 = PszPlayerName(i,1,1,0,0,(PLAYER *)0x0);
        if (i == idPlayer) {
          uVar18 = 0xffff;
          uVar20 = 0xff;
        }
        else {
          uVar18 = *(undefined2 *)(i * 4 + 0x2e);
          uVar20 = *(undefined2 *)(i * 4 + 0x30);
        }
        SetTextColor(hdc,CONCAT22(uVar20,uVar18));
        puVar17 = (undefined1 *)&DAT_1120_1120;
        sVar1 = yCur;
        iVar10 = iVar5;
        HVar22 = hdc;
        uVar7 = _strlen(pcVar6);
        TextOut(HVar22,iVar10,sVar1,(LPCSTR)CONCAT22(puVar17,pcVar6),uVar7);
        yCur = yCur + dyArial8;
      }
    }
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if ((((SCOREX **)rgsxPlr)[i * 2] != (SCOREX *)0x0) ||
         (*(int *)((undefined *)&DAT_1120_156e + i * 4) != 0)) {
        cDrawn = 0;
        if (i == idPlayer) {
          uVar18 = 0xffff;
          uVar20 = 0xff;
        }
        else {
          uVar18 = *(undefined2 *)(i * 4 + 0x2e);
          uVar20 = *(undefined2 *)(i * 4 + 0x30);
        }
        HVar8 = CreatePen(0,1,CONCAT22(uVar20,uVar18));
        HVar9 = SelectObject(hdc,HVar8);
        for (j = 0; j < ((short *)rgcsxPlr)[i]; j = j + 1) {
          uVar18 = *(undefined2 *)((undefined *)&DAT_1120_156e + i * 4);
          pSVar11 = ((SCOREX **)rgsxPlr)[i * 2] + j;
          if ((iYearBase <= (uint)pSVar11->iRank) &&
             ((uint)pSVar11->iRank <= (int)cYears + iYearBase)) {
            iVar5 = pSVar11->iRank;
            uVar16 = LFetchScoreXVal((SCOREX *)CONCAT22(uVar18,pSVar11),gd.wFlags & 0xf);
            uVar14 = uVar12;
            uVar15 = __aFulmul((ulong)(iVar5 - iYearBase),(long)(iVar3 + -4));
            lVar13 = __aFldiv(uVar15,uVar14);
            pt.x = (int)lVar13 + rcChart.left;
            lVar13 = num;
            uVar14 = __aFulmul(uVar16,(long)(iVar4 + -4));
            lVar13 = __aFldiv(uVar14,lVar13);
            pt.y = rcChart.bottom - (int)lVar13;
            if (cDrawn == 0) {
              MoveTo(hdc,pt.x,pt.y);
            }
            else {
              LineTo(hdc,pt.x,pt.y);
            }
            cDrawn = cDrawn + 1;
          }
        }
        if (cDrawn == 1) {
          if (i == idPlayer) {
            uVar18 = 0xffff;
            uVar20 = 0xff;
          }
          else {
            uVar18 = *(undefined2 *)(i * 4 + 0x2e);
            uVar20 = *(undefined2 *)(i * 4 + 0x30);
          }
          SetPixel(hdc,pt.x,pt.y,CONCAT22(uVar20,uVar18));
        }
        SelectObject(hdc,HVar9);
        DeleteObject(HVar8);
      }
    }
  }
  return;
}



// ======================================================================
// Function: LFetchScoreXVal
// Address: 1108:2f94
// Segment: MEMORY_REPORT
// ======================================================================


long LFetchScoreXVal(SCOREX *lpsx,short iVal)

{
  SCOREX *pSVar1;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar2;
  long lVar3;
  ushort in_stack_0000fffc;
  
  pSVar1 = (SCOREX *)lpsx;
  uVar2 = (undefined2)((ulong)lpsx >> 0x10);
  switch(iVal) {
  case 0:
    lVar3 = (long)(pSVar1->score).cPlanet;
    break;
  case 1:
    lVar3 = (long)(pSVar1->score).cStarbase;
    break;
  case 2:
  case 3:
  case 4:
    lVar3 = __aFlshl(CONCAT22(unaff_SI,unaff_DI),in_stack_0000fffc);
    break;
  case 5:
    lVar3 = (long)(pSVar1->score).cTechLevels;
    break;
  case 6:
    lVar3 = CONCAT22(*(undefined2 *)((int)&(pSVar1->score).cResources + 2),
                     (int)(pSVar1->score).cResources);
    break;
  case 7:
    lVar3 = CONCAT22(*(undefined2 *)((int)&(pSVar1->score).lScore + 2),(int)(&pSVar1->score)->lScore
                    );
    break;
  default:
    lVar3 = 0;
  }
  return lVar3;
}



// ======================================================================
// Function: DxReportColHdr
// Address: 1108:305e
// Segment: MEMORY_REPORT
// ======================================================================


short DxReportColHdr(short irpt,short iCol,char *psz,HDC hdc)

{
  int iVar1;
  short sVar2;
  int iVar3;
  undefined2 unaff_SS;
  DWORD DVar4;
  short dx2;
  short cch;
  short dx;
  short dxDigit;
  short ids;
  char szT [40];
  
  szT[0] = '8';
  DVar4 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),1);
  iVar1 = (int)DVar4;
  if (irpt != 0) {
    if (irpt == 1) {
      sVar2 = CchGetString(iCol + idsFleetName,psz);
      DVar4 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),sVar2);
      iVar3 = (int)DVar4;
      dx = iVar3;
      switch(iCol) {
      case 0:
      case 1:
      case 3:
      case 8:
      case 10:
      case 0xb:
        dx = iVar3 << 1;
        break;
      case 2:
        dx = iVar3 * 2 + iVar3 / 2;
        break;
      case 4:
        dx = iVar3 * 2 - iVar1;
        break;
      case 5:
        dx = iVar3 * 4 + iVar3 / 2;
        break;
      case 6:
        dx = iVar1 * 5;
        if (dx <= iVar3) {
          dx = iVar3;
        }
        break;
      case 7:
        dx = iVar1 * 0x13;
        if (iVar1 * 0x13 <= iVar3) {
          dx = iVar3;
        }
      }
    }
    else if (irpt == 2) {
      sVar2 = CchGetString(iCol + idsFleetName2,psz);
      DVar4 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),sVar2);
      dx = (short)DVar4;
      if (iCol == 0) {
        dx = dx * 3;
      }
      else {
        if (iCol != 1) {
          if (iCol == 2) {
            dx = dx * 2 + dx / 2;
            goto LAB_1108_337d;
          }
          if (iCol != 5) goto LAB_1108_337d;
        }
        dx = dx << 1;
      }
    }
    else {
      if (irpt != 3) {
        *psz = '\0';
        return 0;
      }
      sVar2 = CchGetString(iCol + idsLocation4,psz);
      DVar4 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),sVar2);
      dx = (short)DVar4;
      if (iCol == 0) {
        dx = dx * 2 + dx / 2;
      }
    }
    goto LAB_1108_337d;
  }
  sVar2 = CchGetString(iCol + idsPlanetName,psz);
  DVar4 = GetTextExtent(hdc,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,psz),sVar2);
  dx = (short)DVar4;
  switch(iCol) {
  case 0:
    dx = dx << 1;
    goto switchD_1108_3174_caseD_2;
  case 1:
  case 0xd:
  case 0xe:
    dx2 = iVar1 * 0xf;
    break;
  default:
    goto switchD_1108_3174_caseD_2;
  case 3:
    dx2 = iVar1 * 4 + 2;
    break;
  case 4:
    ids = 0x468;
    goto REPORT_ChkAltString;
  case 5:
    dx = dx * 3 + 0x14;
    goto switchD_1108_3174_caseD_2;
  case 6:
  case 7:
    dx2 = iVar1 * 5;
    break;
  case 9:
    dx2 = iVar1 * 0xe;
    break;
  case 10:
  case 0xb:
    dx2 = iVar1 * 0xb;
    break;
  case 0xc:
    ids = 0x46a;
REPORT_ChkAltString:
    sVar2 = CchGetString(ids,szT);
    DVar4 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),sVar2);
    dx2 = (short)DVar4;
  }
  if (dx < dx2) {
    dx = dx2;
  }
switchD_1108_3174_caseD_2:
LAB_1108_337d:
  return (dx + 6) / 2 << 1;
}



// ======================================================================
// Function: DrawReportItem
// Address: 1108:3398
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11083d76) */
/* WARNING: Variable defined which should be unmapped: fEnough */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void DrawReportItem(HDC hdc,RECT *prc,short irpt,short irow,short icol)

{
  short *psVar1;
  PLANET *pPVar2;
  short *psVar3;
  BTLDATA *pBVar4;
  float fVar5;
  ushort uVar6;
  char *pcVar7;
  uint uVar8;
  short sVar9;
  short sVar10;
  int iVar11;
  int iVar12;
  undefined2 unaff_SI;
  short *psVar13;
  PLANET *pPVar14;
  undefined2 unaff_DI;
  short *psVar15;
  undefined2 uVar16;
  char *unaff_SS;
  bool bVar17;
  DWORD DVar18;
  HULDEF *pHVar19;
  long lVar20;
  ulong uVar21;
  BTLDATA *lpbd_00;
  undefined1 *puVar22;
  RECT *pRVar23;
  undefined1 *puVar24;
  UINT UVar25;
  short sVar26;
  HDC HVar27;
  short fEnough;
  undefined2 uStack_c0;
  undefined2 uStack_ae;
  undefined2 uStack_ac;
  undefined2 uStack_a6;
  undefined2 uStack_a4;
  int iStack_9e;
  int iStack_9c;
  undefined4 uStack_9a;
  undefined2 uStack_96;
  int iStack_94;
  int iStack_92;
  int iStack_90;
  undefined4 uStack_8e;
  long l;
  short cch;
  short xCur;
  char *psz;
  short dx;
  FLEET *lpfl;
  short i;
  short j;
  PLANET *lppl;
  char *lpsz;
  char chT;
  char szT [100];
  BTLDATA *lpbd;
  
  szT[0] = '8';
  DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),1);
  dx = (short)DVar18;
  if (irpt == 0) {
    lppl = (PLANET *)
           CONCAT22(lpPlanets._2_2_,
                    (PLANET *)lpPlanets + ((ushort *)vlprgidPlanet)[irow]);
    SelectObject(hdc,rghfontArial8[1]);
    SetTextColor(hdc,0);
    SetBkMode(hdc,1);
    switch(icol) {
    case 0:
      if ((sel.grobj == grobjPlanet) && (sel.pl.id == lppl->id)) {
        SetTextColor(hdc,0x7f);
      }
      pcVar7 = PszGetPlanetName(lppl->id);
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pRVar23 = prc;
      HVar27 = hdc;
      psz = pcVar7;
      uVar6 = _strlen(pcVar7);
      ExtTextOut(HVar27,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,pRVar23),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      uVar16 = (undefined2)((ulong)lppl >> 0x10);
      if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
        return;
      }
      iStack_92 = prc->top;
      iStack_90 = prc->right;
      uStack_8e = (float)CONCAT22(uStack_8e._2_2_,prc->bottom);
      dx = (prc->bottom - iStack_92) / 3 + -1;
      iStack_94 = iStack_90 - dx;
      pHVar19 = LphuldefFromId
                          (*(HullDef *)
                            (*(int *)(idPlayer * 4 + 0x14c) +
                            (*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) * 0x93));
      uStack_8e._2_2_ = hbrYellow;
      if ((((HULDEF *)pHVar19)->hul).wtCargoMax == 0) {
        uStack_8e._2_2_ = hbrBlue;
      }
      iStack_92 = prc->top;
      uStack_8e._0_2_ = iStack_92 + dx;
      FillRect(hdc,(int *)CONCAT22(unaff_SS,&iStack_94),uStack_8e._2_2_);
      sVar9 = IWarpMAFromLppl(lppl,(short *)0x0);
      if (0 < sVar9) {
        iStack_92 = prc->top + dx + 1;
        uStack_8e._0_2_ = iStack_92 + dx;
        FillRect(hdc,(int *)CONCAT22(unaff_SS,&iStack_94),hbrPurple);
      }
      sVar9 = IStargateFromLppl(lppl);
      if (sVar9 == -1) {
        return;
      }
      iStack_92 = (dx + 1) * 2 + prc->top;
      uStack_8e = (float)CONCAT22(uStack_8e._2_2_,iStack_92 + dx);
      FillRect(hdc,(int *)CONCAT22(unaff_SS,&iStack_94),hbrGreen);
      return;
    case 1:
      if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
        lpsz._0_2_ = _szDblDash;
        lpsz._2_2_ = (undefined1 *)&DAT_1120_1120;
      }
      else {
        lpsz._2_2_ = (undefined1 *)*(undefined2 *)(idPlayer * 4 + 0x14e);
        lpsz._0_2_ = (char *)(*(int *)(idPlayer * 4 + 0x14c) +
                              (*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) * 0x93 + 8);
      }
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      pcVar7 = (char *)lpsz;
      puVar22 = lpsz._2_2_;
      uVar6 = __fstrlen((char *)CONCAT22(lpsz._2_2_,(char *)lpsz));
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 2:
      lVar20 = CalcPlanetMaxPop(lppl->id,((PLANET *)lppl)->iPlayer);
      iVar12 = (int)((ulong)lVar20 >> 0x10);
      uVar16 = (undefined2)((ulong)lppl >> 0x10);
      iVar11 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 0xe);
      if ((iVar12 <= iVar11) &&
         ((iVar12 < iVar11 || ((uint)lVar20 < *(uint *)(((PLANET *)lppl)->rgwtMin + 3))))) {
        SetTextColor(hdc,0xff);
      }
      uVar16 = (undefined2)((ulong)lppl >> 0x10);
      uVar21 = __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe),
                                          (int)((PLANET *)lppl)->rgwtMin[3]),100);
      cch = CommaFormatLong(szT,uVar21);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 3:
      sVar9 = PctPlanetCapacity(lppl);
      cch = _WSPRINTF((LPSTR)CONCAT22(sVar9,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTDPCTPCT,unaff_SS),szT);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 4:
      cch = CchGetString(idsN100,szT);
      DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),cch);
      dx = (short)DVar18;
      i = PctPlanetDesirability(lppl,idPlayer);
      cch = _WSPRINTF((LPSTR)CONCAT22(i,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTDPCTPCT,unaff_SS),szT);
      if (i < 0xb) {
        if (i < 0) {
          uVar8 = 0xff;
        }
        else {
          uVar8 = 0x7f7f;
        }
        SetTextColor(hdc,(ulong)uVar8);
      }
      RightTextOut(hdc,prc->left + dx,prc->top,szT,cch,0);
      j = PctPlanetOptValue(lppl,idPlayer);
      if (j <= i) {
        return;
      }
      if (0 < j) {
        if (j < 0xb) {
          uVar8 = 0x7f7f;
        }
        else {
          uVar8 = 0;
        }
        SetTextColor(hdc,(ulong)uVar8);
      }
      cch = _WSPRINTF((LPSTR)CONCAT22(j,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22((char *)s___d____1120_15f0,unaff_SS),szT);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 5:
      psVar13 = (short *)&sel.pl;
      psVar15 = &fEnough;
      for (iVar11 = 0x1c; iVar11 != 0; iVar11 = iVar11 + -1) {
        psVar3 = psVar15;
        psVar15 = psVar15 + 1;
        psVar1 = psVar13;
        psVar13 = psVar13 + 1;
        *psVar3 = *psVar1;
      }
      psVar15 = (short *)&sel.pl;
      pPVar14 = (PLANET *)lppl;
      for (iVar11 = 0x1c; iVar11 != 0; iVar11 = iVar11 + -1) {
        psVar1 = psVar15;
        psVar15 = psVar15 + 1;
        pPVar2 = pPVar14;
        pPVar14 = (PLANET *)&pPVar14->iPlayer;
        *psVar1 = pPVar2->id;
      }
      FillPlanetProdLB(0,(PLPROD *)0x0,lppl);
      psVar15 = &fEnough;
      psVar13 = (short *)&sel.pl;
      for (iVar11 = 0x1c; iVar11 != 0; iVar11 = iVar11 + -1) {
        psVar3 = psVar13;
        psVar13 = psVar13 + 1;
        psVar1 = psVar15;
        psVar15 = psVar15 + 1;
        *psVar3 = *psVar1;
      }
      DrawProductionItem(hdc,prc,(char *)szWork,0,0,2);
      return;
    case 6:
      uVar21 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),fEnough);
      i = (uint)uVar21 & 0xfff;
      j = CMaxOperableMines(lppl,idPlayer,0);
      break;
    case 7:
      uVar21 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),fEnough);
      i = (uint)uVar21 & 0xfff;
      j = CMaxOperableFactories(lppl,idPlayer,0);
      break;
    case 8:
      i = *(uint *)&((PLANET *)lppl)->dwFlags & 0xfff;
      j = CMaxOperableDefenses(lppl,idPlayer,0);
      if (i < 1) {
        szT[2] = '-';
        szT[1] = '-';
        szT[0] = '-';
        cch = 3;
      }
      else {
        CalcPctSurvive(lppl,(float *)&uStack_8e,(float *)0x0);
        uStack_8e = DAT_1120_1e0a - uStack_8e;
        uStack_96 = 100;
        iStack_94 = 0;
        lVar20 = __ftol((double)CONCAT26(uStack_c0,
                                                 CONCAT24(fEnough,CONCAT22(unaff_SI,unaff_DI))));
        iStack_9e = (int)lVar20;
        iStack_9c = iStack_9e >> 0xf;
        uStack_a6 = 10000;
        uStack_a4 = 0;
        lVar20 = __ftol((double)CONCAT26(uStack_c0,
                                                 CONCAT24(fEnough,CONCAT22(unaff_SI,unaff_DI))));
        uStack_ae = 100;
        uStack_ac = 0;
        lVar20 = __ftol((double)CONCAT26(fEnough,CONCAT24(unaff_SI,CONCAT22(unaff_DI,(int)
                                                  lVar20))));
        cch = _WSPRINTF((LPSTR)CONCAT22((int)lVar20,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTDXPCTDPCTPCT,unaff_SS),szT);
      }
      goto REPORT_DrawPlusDef;
    case 9:
    case 10:
      xCur = dx * 4 + prc->left;
      if (icol == 10) {
        xCur = xCur - dx;
        EstMineralsMined(lppl,&uStack_9a,-1,0);
      }
      for (i = 0; i < 3; i = i + 1) {
        if (icol == 9) {
          l._0_2_ = (uint)((PLANET *)lppl)->rgwtMin[i];
          l._2_2_ = *(undefined2 *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2);
        }
        else {
          l._0_2_ = *(uint *)(&uStack_9a + i);
          l._2_2_ = *(undefined2 *)((int)&uStack_9a + i * 4 + 2);
        }
        DrawMineralItem(hdc,xCur,prc->top,i,CONCAT22(l._2_2_,(uint)l));
        if (icol == 10) {
          xCur = xCur + dx * 4;
        }
        else {
          xCur = xCur + dx * 5;
        }
      }
      return;
    case 0xb:
      xCur = dx * 3 + prc->left;
      for (i = 0; i < 3; i = i + 1) {
        uStack_8e = (float)(ulong)CONCAT12(((PLANET *)lppl)->rgMinConc[i],(int)uStack_8e);
        fVar5 = uStack_8e;
        uStack_8e._2_2_ = (HBRUSH)((PLANET *)lppl)->rgMinConc[i];
        lVar20 = (long)(int)uStack_8e._2_2_;
        uStack_8e = fVar5;
        DrawMineralItem(hdc,xCur,prc->top,i,lVar20);
        xCur = xCur + dx * 4;
      }
      return;
    case 0xc:
      cch = CchGetString(idsN1000,szT);
      DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,szT),cch);
      dx = (short)DVar18;
      i = CResourcesAtPlanet(lppl,idPlayer);
      j = i;
      uVar21 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),fEnough);
      if ((uVar21 & 1) == 0) {
        sVar9 = MulDiv(i,(int)*(char *)((int)&rgplr[0].pctResearch +
                                       idPlayer * 0xc0),100);
        i = i - sVar9;
      }
      CchGetString(idsD4,szT);
      cch = _WSPRINTF((LPSTR)CONCAT22(i,unaff_SS),(LPCSTR)CONCAT22(szT,(char *)&DAT_1120_1120),
                      (char *)szWork);
      RightTextOut(hdc,prc->left + dx,prc->top,(char *)szWork,cch,0);
      cch = _WSPRINTF((LPSTR)CONCAT22(j,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(PCTD,unaff_SS),szT);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 0xd:
      if ((((PLANET *)lppl)->wFlags & 0x3ffU) == 0) {
        psz = _szDblDash;
      }
      else {
        psz = PszGetPlanetName((((PLANET *)lppl)->wFlags & 0x3ffU) - 1);
      }
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pcVar7 = psz;
      uVar6 = _strlen(psz);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 0xe:
      if ((((PLANET *)lppl)->wRouting & 0x3ffU) == 0) {
        psz = _szDblDash;
      }
      else {
        psz = PszGetPlanetName((((PLANET *)lppl)->wRouting & 0x3ffU) - 1);
      }
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pcVar7 = psz;
      uVar6 = _strlen(psz);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    default:
      return;
    }
    cch = CommaFormatLong(szT,(long)i);
REPORT_DrawPlusDef:
    if (j <= i) {
      if (i == j) {
        uVar8 = 0x7f00;
      }
      else {
        uVar8 = 0xff;
      }
      SetTextColor(hdc,(ulong)uVar8);
    }
    RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
    return;
  }
  if (irpt == 1) {
                    /* WARNING: Load size is inaccurate */
    lpfl = (FLEET *)CONCAT22(*(undefined2 *)
                              ((int)((FLEET **)rglpfl + ((ushort *)vlprgidFleet)[irow]
                                    ) + 2),
                             ((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[irow]]);
    SelectObject(hdc,rghfontArial8[1]);
    SetTextColor(hdc,0);
    SetBkMode(hdc,1);
    switch(icol) {
    case 0:
      if ((sel.grobj == grobjFleet) && (sel.fl.id == lpfl->id)) {
        SetTextColor(hdc,0x7f);
      }
      pcVar7 = PszGetFleetName(lpfl->id);
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      psz = pcVar7;
      uVar6 = _strlen(pcVar7);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 1:
      psz = szT;
      cch = _WSPRINTF((LPSTR)CONCAT22((lpfl->id & 0x1ffU) + 1,(char *)&DAT_1120_1120),
                      (LPCSTR)0x15f71120,psz);
      RightTextOut(hdc,prc->right + -2,prc->top,psz,cch,0);
      return;
    case 2:
      if (((FLEET *)lpfl)->idPlanet == -1) {
        psz = szT;
        sVar9 = (&((FLEET *)lpfl)->pt)->x;
        pcVar7 = PszGetCompressedString(idsSpaceDD);
        _WSPRINTF((LPSTR)CONCAT22(sVar9,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),psz);
      }
      else {
        psz = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
      }
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pcVar7 = psz;
      uVar6 = _strlen(psz);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 3:
      pcVar7 = PszGetDestName(lpfl,hdc);
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      psz = pcVar7;
      uVar6 = _strlen(pcVar7);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 4:
      psz = PszGetETA(hdc,lpfl,(short *)0x0);
      sVar9 = 0;
      uVar6 = _strlen(psz);
      RightTextOut(hdc,prc->right,prc->top,psz,uVar6,sVar9);
      return;
    case 5:
      psz = PszGetTaskName(lpfl,&i);
      if (i != -1) {
        SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + 0x44a),*(undefined2 *)(i * 4 + 0x448)));
      }
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pcVar7 = psz;
      uVar6 = _strlen(psz);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 6:
      goto switchD_1108_44e3_caseD_6;
    case 7:
      xCur = dx * 4 + prc->left;
      for (i = 0; i < 4; i = i + 1) {
        DrawMineralItem(hdc,xCur,prc->top,i,
                        CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2),
                                 (int)((FLEET *)lpfl)->rgwtMin[i]));
        xCur = xCur + dx * 5;
      }
      return;
    case 8:
      i = IshdefPrimaryFromLpfl(lpfl,&j);
      if ((((FLEET *)lpfl)->rgdv + i)->dp != 0) {
        SetTextColor(hdc,0xff);
      }
      prc->right = prc->right + dx * -6;
      pcVar7 = (char *)((int)&rgshdef[0].hul + 8 + i * 0x93);
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pRVar23 = prc;
      HVar27 = hdc;
      psz = pcVar7;
      uVar6 = _strlen(pcVar7);
      ExtTextOut(HVar27,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,pRVar23),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      psz = szT;
      sVar10 = _WSPRINTF((LPSTR)CONCAT22(((FLEET *)lpfl)->rgcsh[i],(char *)&DAT_1120_1120),
                         (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),psz);
      chT = '+';
      sVar26 = 0;
      sVar9 = prc->top;
      pcVar7 = psz;
      cch = sVar10;
      DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,&chT),1);
      uStack_8e = (float)CONCAT22((int)DVar18,(int)uStack_8e);
      RightTextOut(hdc,(dx * 6 + prc->right) - (int)DVar18,sVar9,pcVar7,sVar10,sVar26);
      if (j < 2) {
        return;
      }
      DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,&chT),1);
      uStack_8e = (float)CONCAT22((int)DVar18,(int)uStack_8e);
      TextOut(hdc,(dx * 6 + prc->right) - (int)DVar18,prc->top,(LPCSTR)CONCAT22(unaff_SS,&chT),1);
      return;
    case 9:
      i = PctCloakFromLpfl(lpfl);
      if (i == 0) {
        cch = _strlen(_szDblDash);
        psz = _szDblDash;
      }
      else {
        psz = szT;
        cch = _WSPRINTF((LPSTR)CONCAT22(i,(char *)&DAT_1120_1120),
                        (LPCSTR)CONCAT22(PCTDPCTPCT,(char *)&DAT_1120_1120),psz);
      }
      RightTextOut(hdc,prc->right + -5,prc->top,psz,cch,0);
      return;
    case 10:
      i = (short)((FLEET *)lpfl)->iplan;
      uVar8 = (uint)lpfl->id >> 9 & 0xf;
      __fstrcpy((char *)CONCAT22(unaff_SS,szT),
                        (char *)CONCAT22(((undefined2 *)&DAT_1120_593a)[uVar8 * 2],
                                         ((BTLPLAN **)rglpbtlplan)[uVar8 * 2]
                                         [((FLEET *)lpfl)->iplan].szName));
      pcVar7 = szT;
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      psz = pcVar7;
      uVar6 = _strlen(pcVar7);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 0xb:
      lVar20 = WtFromLpfl(lpfl);
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,lVar20);
      return;
    default:
      return;
    }
  }
  if (irpt == 2) {
                    /* WARNING: Load size is inaccurate */
    lpfl = (FLEET *)CONCAT22(*(undefined2 *)
                              ((int)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow])
                              + 2),((FLEET **)rglpfl)[((ushort *)vlprgidMisc)[irow]]);
    SelectObject(hdc,rghfontArial8[1]);
    SetTextColor(hdc,0);
    SetBkMode(hdc,1);
    switch(icol) {
    case 0:
      if ((sel.scan.grobj == grobjFleet) &&
         (((FLEET **)rglpfl)[sel.scan.ifl]->id == lpfl->id)) {
        SetTextColor(hdc,0x7f);
      }
      pcVar7 = PszGetFleetName(lpfl->id);
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      psz = pcVar7;
      uVar6 = _strlen(pcVar7);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 1:
      psz = szT;
      cch = _WSPRINTF((LPSTR)CONCAT22((lpfl->id & 0x1ffU) + 1,(char *)&DAT_1120_1120),
                      (LPCSTR)0x15fa1120,psz);
      RightTextOut(hdc,prc->right + -2,prc->top,psz,cch,0);
      return;
    case 2:
      if (((FLEET *)lpfl)->idPlanet == -1) {
        psz = szT;
        sVar9 = (&((FLEET *)lpfl)->pt)->x;
        pcVar7 = PszGetCompressedString(idsSpaceDD);
        _WSPRINTF((LPSTR)CONCAT22(sVar9,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),psz);
      }
      else {
        psz = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
      }
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar24 = (undefined1 *)&DAT_1120_1120;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pcVar7 = psz;
      uVar6 = _strlen(psz);
      ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
                 (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
      return;
    case 3:
      if ((((uint)((FLEET *)lpfl)->wFlags >> 4 & 1) == 0) || ((((FLEET *)lpfl)->wFlags & 0xfU) == 0)
         ) {
        psz = (char *)&DAT_1120_15fd;
        cch = 2;
      }
      else {
        psz = szT;
        cch = _WSPRINTF((LPSTR)((ulong)CONCAT22(((FLEET *)lpfl)->wFlags,(undefined1 *)&DAT_1120_1120
                                               ) & 0xfffff),(LPCSTR)0x16001120,psz);
      }
      RightTextOut(hdc,prc->right + -2,prc->top,psz,cch,0);
      return;
    case 4:
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,
                      CONCAT22((((FLEET *)lpfl)->rgdv + 1)->dp,((FLEET *)lpfl)->rgdv->dp));
      return;
    case 5:
      i = IshdefPrimaryFromLpfl(lpfl,&j);
      prc->right = prc->right + dx * -6;
      iVar11 = ((FLEET *)lpfl)->iPlayer * 4;
      uVar16 = *(undefined2 *)(iVar11 + 0x100);
      pcVar7 = (char *)(*(int *)(iVar11 + 0xfe) + i * 0x93 + 8);
      sVar9 = prc->left;
      sVar10 = prc->top;
      UVar25 = 4;
      puVar22 = (undefined1 *)&DAT_1120_1120;
      pRVar23 = prc;
      HVar27 = hdc;
      lpsz._0_2_ = pcVar7;
      lpsz._2_2_ = (undefined1 *)uVar16;
      uVar6 = __fstrlen((char *)CONCAT22(uVar16,pcVar7));
      ExtTextOut(HVar27,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar22,pRVar23),
                 (LPCSTR)CONCAT22(uVar16,pcVar7),uVar6,(short *)0x0);
      psz = szT;
      sVar10 = _WSPRINTF((LPSTR)CONCAT22(((FLEET *)lpfl)->rgcsh[i],(char *)&DAT_1120_1120),
                         (LPCSTR)CONCAT22(PCTD,(char *)&DAT_1120_1120),psz);
      chT = '+';
      sVar26 = 0;
      sVar9 = prc->top;
      pcVar7 = psz;
      cch = sVar10;
      DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,&chT),1);
      uStack_8e = (float)CONCAT22((int)DVar18,(int)uStack_8e);
      RightTextOut(hdc,(dx * 6 + prc->right) - (int)DVar18,sVar9,pcVar7,sVar10,sVar26);
      if (j < 2) {
        return;
      }
      DVar18 = GetTextExtent(hdc,(LPCSTR)CONCAT22(unaff_SS,&chT),1);
      uStack_8e = (float)CONCAT22((int)DVar18,(int)uStack_8e);
      TextOut(hdc,(dx * 6 + prc->right) - (int)DVar18,prc->top,(LPCSTR)CONCAT22(unaff_SS,&chT),1);
      return;
    case 6:
      l._0_2_ = 0;
      l._2_2_ = 0;
      for (i = 0; i < 0x10; i = i + 1) {
        uVar8 = ((FLEET *)lpfl)->rgcsh[i];
        bVar17 = CARRY2((uint)l,uVar8);
        l._0_2_ = (uint)l + uVar8;
        l._2_2_ = l._2_2_ + ((int)uVar8 >> 0xf) + (uint)bVar17;
      }
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,CONCAT22(l._2_2_,(uint)l));
      return;
    case 7:
      l._0_2_ = 0;
      l._2_2_ = 0;
      for (i = 0; i < 0x10; i = i + 1) {
        if (((FLEET *)lpfl)->rgcsh[i] != 0) {
          iVar11 = ((FLEET *)lpfl)->iPlayer * 4;
          pHVar19 = LphuldefFromId(*(HullDef *)(*(int *)(iVar11 + 0xfe) + i * 0x93));
          j = (uint)((HULDEF *)pHVar19)->wFlags >> 10 & 0xf;
          if (((uint)j < 2) || (5 < (uint)j)) {
            uVar8 = ((FLEET *)lpfl)->rgcsh[i];
            bVar17 = CARRY2((uint)l,uVar8);
            l._0_2_ = (uint)l + uVar8;
            l._2_2_ = l._2_2_ + ((int)uVar8 >> 0xf) + (uint)bVar17;
          }
        }
      }
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,CONCAT22(l._2_2_,(uint)l));
      return;
    case 8:
      j = 2;
      break;
    case 9:
      j = 3;
      break;
    case 10:
      j = 5;
      break;
    case 0xb:
      j = 4;
      break;
    default:
      return;
    }
    l._0_2_ = 0;
    l._2_2_ = 0;
    for (i = 0; i < 0x10; i = i + 1) {
      if ((((FLEET *)lpfl)->rgcsh[i] != 0) &&
         (iVar11 = ((FLEET *)lpfl)->iPlayer * 4,
         pHVar19 = LphuldefFromId(*(HullDef *)(*(int *)(iVar11 + 0xfe) + i * 0x93)),
         ((uint)((HULDEF *)pHVar19)->wFlags >> 10 & 0xf) == j)) {
        uVar8 = ((FLEET *)lpfl)->rgcsh[i];
        bVar17 = CARRY2((uint)l,uVar8);
        l._0_2_ = (uint)l + uVar8;
        l._2_2_ = l._2_2_ + ((int)uVar8 >> 0xf) + (uint)bVar17;
      }
    }
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,CONCAT22(l._2_2_,(uint)l));
    return;
  }
  if (irpt != 3) {
    return;
  }
  lpbd_00 = BtlDataGet(((ushort *)vlprgidMisc)[irow]);
  iVar11 = (int)((ulong)lpbd_00 >> 0x10);
  pBVar4 = (BTLDATA *)lpbd_00;
  if ((pBVar4 == (BTLDATA *)0x0) && (iVar11 == 0)) {
    return;
  }
  SelectObject(hdc,rghfontArial8[1]);
  SetTextColor(hdc,0);
  SetBkMode(hdc,1);
  switch(icol) {
  case 0:
    if (pBVar4->idPlanet == -1) {
      psz = szT;
      sVar9 = (&pBVar4->pt)->x;
      pcVar7 = PszGetCompressedString(idsSpaceDD);
      _WSPRINTF((LPSTR)CONCAT22(sVar9,(char *)&DAT_1120_1120),
                (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),psz);
    }
    else {
      psz = PszGetPlanetName(pBVar4->idPlanet);
    }
    if (((&pBVar4->pt)->x == sel.scan.pt.x) && ((pBVar4->pt).y == sel.scan.pt.y)
       ) {
      SetTextColor(hdc,0x7f);
    }
    sVar9 = prc->left;
    sVar10 = prc->top;
    UVar25 = 4;
    puVar24 = (undefined1 *)&DAT_1120_1120;
    puVar22 = (undefined1 *)&DAT_1120_1120;
    pcVar7 = psz;
    uVar6 = _strlen(psz);
    ExtTextOut(hdc,sVar9,sVar10,UVar25,(undefined2 *)CONCAT22(puVar24,prc),
               (LPCSTR)CONCAT22(puVar22,pcVar7),uVar6,(short *)0x0);
    return;
  case 1:
    lVar20 = CBattleUnits(lpbd_00,5);
    if (lVar20 == 0) {
      lVar20 = CBattleUnits(lpbd_00,6);
      if (lVar20 == 0) {
        chT = ' ';
      }
      else {
        chT = 'T';
      }
    }
    else {
      chT = 'O';
    }
    CtrTextOut(hdc,(prc->right - prc->left) / 2 + prc->left,prc->top,&chT,1);
    return;
  case 2:
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,(ulong)pBVar4->cplr);
    return;
  case 3:
    i = 0xff;
    break;
  case 4:
    i = 0xfd;
    break;
  case 5:
    i = 0xfe;
    break;
  case 6:
    i = 0xb;
    break;
  case 7:
    i = 0x13;
    break;
  case 8:
    i = 0x23;
    break;
  case 9:
    i = 0x43;
    break;
  case 10:
    i = 0x83;
    break;
  case 0xb:
  case 0xc:
    l = CBattleKills(lpbd_00,(uint)(icol == 0xb));
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,l);
    return;
  case 0xd:
    i = 0xfd;
    goto REPORT_LUnitsLeft_2;
  case 0xe:
    i = 0xfe;
REPORT_LUnitsLeft_2:
    l = CBattleUnits(lpbd_00,i);
    lVar20 = CBattleKills(lpbd_00,(uint)(icol == 0xd));
    l = l - lVar20;
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,l);
  default:
    goto switchD_1108_3e3e_default;
  }
  lVar20 = CBattleUnits(lpbd_00,i);
  DrawMineralItem(hdc,prc->right + -2,prc->top,-1,lVar20);
switchD_1108_3e3e_default:
  return;
switchD_1108_44e3_caseD_6:
  if (1 < ((FLEET *)lpfl)->cord) {
    lVar20 = EstFuelUse(lpfl,0,(uint)((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 4 &
                                     0xf,-1,0);
    iVar12 = (int)((ulong)lVar20 >> 0x10);
    uVar16 = (undefined2)((ulong)lpfl >> 0x10);
    iVar11 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
    if ((iVar11 < iVar12) ||
       ((iVar11 <= iVar12 && (*(uint *)(((FLEET *)lpfl)->rgwtMin + 4) < (uint)lVar20)))) {
      iVar11 = 0;
      goto LAB_1108_422c;
    }
  }
  iVar11 = 1;
LAB_1108_422c:
  uStack_8e = (float)CONCAT22(iVar11,(int)uStack_8e);
  uVar16 = (undefined2)((ulong)lpfl >> 0x10);
  DrawMineralItem(hdc,dx * 4 + prc->left,prc->top,-iVar11,
                  CONCAT22(*(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12),
                           (int)((FLEET *)lpfl)->rgwtMin[4]));
  return;
}



// ======================================================================
// Function: DrawMineralItem
// Address: 1108:4ebe
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11084f0e) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void DrawMineralItem(HDC hdc,short x,short y,short iMineral,long l)

{
  short cch;
  char *psz;
  
  if (iMineral < 0) {
    SetTextColor(hdc,0);
  }
  else {
    SetTextColor(hdc,CONCAT22(*(undefined2 *)(iMineral * 4 + 0x44a),
                              *(undefined2 *)(iMineral * 4 + 0x448)));
  }
  if (l < 0) {
    cch = _strlen(_szDblDash);
    psz = _szDblDash;
  }
  else {
    psz = PszFromLongK(l,&cch);
  }
  RightTextOut(hdc,x,y,psz,cch,0);
  return;
}



// ======================================================================
// Function: PszGetDestName
// Address: 1108:4f60
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

char * PszGetDestName(FLEET *lpfl,HDC hdc)

{
  short *psVar1;
  ORDER *pOVar2;
  undefined2 uVar3;
  uint uVar4;
  char *pcVar5;
  int iVar6;
  FLEET *pFVar7;
  short *psVar8;
  ORDER *pOVar9;
  undefined2 uVar10;
  undefined2 unaff_SS;
  ORDER ord;
  short i;
  
  uVar10 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar7 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  psVar8 = (short *)(*(int *)&pFVar7->lpplord + 4);
  pOVar9 = &ord;
  for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
    pOVar2 = pOVar9;
    pOVar9 = (ORDER *)&(pOVar9->pt).y;
    psVar1 = psVar8;
    psVar8 = psVar8 + 1;
    (pOVar2->pt).x = *psVar1;
  }
  if (pFVar7->cord < 2) {
    return _szDblDash;
  }
  if (((uint)ord.wFlags >> 0xc & 1) != 0) {
    uVar4 = ord.wFlags & 0xf;
    if (uVar4 == 1) {
      for (i = 0; i < 5; i = i + 1) {
        if ((uint)(ord.txp.rgia + i)->wFlags >> 0xc == 6) goto REPORT_LDelayed;
      }
    }
    else if (uVar4 == 2) {
      if (((uint)ord.wFlags >> 8 & 0xf) == 1) {
        return _szDblDash;
      }
    }
    else {
      if (uVar4 == 4) {
        return _szDblDash;
      }
      if (uVar4 == 5) {
        return _szDblDash;
      }
      if (uVar4 == 6) {
REPORT_LDelayed:
        if (hdc != 0) {
          SetTextColor(hdc,0x7f);
        }
        pcVar5 = PszGetCompressedString(idsDelayed);
        return pcVar5;
      }
    }
  }
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  psVar8 = (short *)(*(int *)&pFVar7->lpplord + 0x16);
  pOVar9 = &ord;
  for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
    pOVar2 = pOVar9;
    pOVar9 = (ORDER *)&(pOVar9->pt).y;
    psVar1 = psVar8;
    psVar8 = psVar8 + 1;
    (pOVar2->pt).x = *psVar1;
  }
  pcVar5 = PszGetLocName((uint)ord.wFlags >> 8 &
                               (grobjThing|grobjOther|grobjFleet|grobjPlanet),ord.id,ord.pt.x,
                               ord.pt.y);
  return pcVar5;
}



// ======================================================================
// Function: FDestIsWP0
// Address: 1108:50b4
// Segment: MEMORY_REPORT
// ======================================================================


short FDestIsWP0(FLEET *lpfl)

{
  short *psVar1;
  ORDER *pOVar2;
  undefined2 uVar3;
  uint uVar4;
  int iVar5;
  FLEET *pFVar6;
  short *psVar7;
  ORDER *pOVar8;
  undefined2 uVar9;
  undefined2 unaff_SS;
  ORDER ord;
  short i;
  
  uVar9 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar6 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar6->lpplord + 2);
  psVar7 = (short *)(*(int *)&pFVar6->lpplord + 4);
  pOVar8 = &ord;
  for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
    pOVar2 = pOVar8;
    pOVar8 = (ORDER *)&(pOVar8->pt).y;
    psVar1 = psVar7;
    psVar7 = psVar7 + 1;
    (pOVar2->pt).x = *psVar1;
  }
  if (pFVar6->cord < 2) {
    return 1;
  }
  if (((uint)ord.wFlags >> 0xc & 1) != 0) {
    uVar4 = ord.wFlags & 0xf;
    if (uVar4 == 1) {
      for (i = 0; i < 5; i = i + 1) {
        if ((uint)(ord.txp.rgia + i)->wFlags >> 0xc == 6) {
          return 1;
        }
      }
    }
    else if (uVar4 == 2) {
      if (((uint)ord.wFlags >> 8 & 0xf) == 1) {
        return 1;
      }
    }
    else {
      if (uVar4 == 4) {
        return 1;
      }
      if (uVar4 == 5) {
        return 1;
      }
      if (uVar4 == 6) {
        return 1;
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: PszGetETA
// Address: 1108:51a8
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

char * PszGetETA(HDC hdc,FLEET *lpfl,short *pcYears)

{
  short *psVar1;
  ORDER *pOVar2;
  undefined2 uVar3;
  uint uVar4;
  int iVar5;
  int iVar6;
  FLEET *pFVar7;
  short *psVar8;
  ORDER *pOVar9;
  undefined2 uVar10;
  undefined2 unaff_SS;
  long lVar11;
  char *psz;
  ORDER ord;
  short i;
  short c;
  POINT pt;
  
  uVar10 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar7 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  psVar8 = (short *)(*(int *)&pFVar7->lpplord + 4);
  pOVar9 = &ord;
  for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
    pOVar2 = pOVar9;
    pOVar9 = (ORDER *)&(pOVar9->pt).y;
    psVar1 = psVar8;
    psVar8 = psVar8 + 1;
    (pOVar2->pt).x = *psVar1;
  }
  if (pFVar7->cord < 2) goto REPORT_LNoETA;
  if (((uint)ord.wFlags >> 0xc & 1) != 0) {
    uVar4 = ord.wFlags & 0xf;
    if (uVar4 == 1) {
      for (i = 0; i < 5; i = i + 1) {
        if ((uint)(ord.txp.rgia + i)->wFlags >> 0xc == 6) goto REPORT_LNoETA;
      }
    }
    else if (uVar4 == 2) {
      if (((uint)ord.wFlags >> 8 & 0xf) == 1) {
REPORT_LNoETA:
        if (pcYears == (short *)0x0) {
          return _szDblDash;
        }
        *pcYears = 0;
        return _szDblDash;
      }
    }
    else if (((uVar4 == 4) || (uVar4 == 5)) || (uVar4 == 6)) goto REPORT_LNoETA;
  }
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  psVar8 = (short *)(*(int *)&pFVar7->lpplord + 0x16);
  pOVar9 = &ord;
  for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
    pOVar2 = pOVar9;
    pOVar9 = (ORDER *)&(pOVar9->pt).y;
    psVar1 = psVar8;
    psVar8 = psVar8 + 1;
    (pOVar2->pt).x = *psVar1;
  }
  CchGetETA(hdc,lpfl,(char *)szWork,1,1);
  if (hdc != 0) {
    lVar11 = EstFuelUse(lpfl,0,(uint)ord.wFlags >> 4 & 0xf,-1,0);
    iVar6 = (int)((ulong)lVar11 >> 0x10);
    iVar5 = *(int *)((int)pFVar7->rgwtMin + 0x12);
    if ((iVar5 <= iVar6) && ((iVar5 < iVar6 || (*(uint *)(pFVar7->rgwtMin + 4) < (uint)lVar11)))) {
      SetTextColor(hdc,0xff);
    }
  }
  if (pcYears != (short *)0x0) {
    c = 0;
    for (psz = (char *)szWork; ('/' < *psz && (*psz < ':')); psz = psz + 1) {
      c = c * 10 + *psz + -0x30;
    }
    if (c == 0) {
      c = 32000;
    }
    *pcYears = c;
  }
  return (char *)szWork;
}



// ======================================================================
// Function: PszGetTaskName
// Address: 1108:53b8
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

char * PszGetTaskName(FLEET *lpfl,short *picr)

{
  short *psVar1;
  ORDER *pOVar2;
  undefined2 uVar3;
  bool bVar4;
  StringId ids_00;
  uint uVar5;
  short sVar6;
  char *pcVar7;
  ushort uVar8;
  char *pcVar9;
  int iVar10;
  FLEET *pFVar11;
  short *psVar12;
  ORDER *pOVar13;
  undefined2 uVar14;
  undefined2 unaff_SS;
  char *psz;
  short fPercent;
  ORDER ord;
  short i;
  short iZip;
  short opOrd;
  short ids;
  short icr;
  
  icr = -1;
  uVar14 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar11 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar11->lpplord + 2);
  psVar12 = (short *)(*(int *)&pFVar11->lpplord + 4);
  pOVar13 = &ord;
  for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
    pOVar2 = pOVar13;
    pOVar13 = (ORDER *)&(pOVar13->pt).y;
    psVar1 = psVar12;
    psVar12 = psVar12 + 1;
    (pOVar2->pt).x = *psVar1;
  }
  *picr = -1;
  if (((uint)ord.wFlags >> 0xc & 1) != 0) {
    switch(ord.wFlags & 0xf) {
    case 1:
      for (i = 0; i < 4; i = i + 1) {
        if ((uint)(ord.txp.rgia + i)->wFlags >> 0xc == 6) goto REPORT_LShowTask;
      }
      break;
    case 2:
    case 4:
    case 5:
    case 6:
    case 8:
      goto REPORT_LShowTask;
    }
  }
  if (1 < pFVar11->cord) {
    uVar3 = *(undefined2 *)((int)&pFVar11->lpplord + 2);
    psVar12 = (short *)(*(int *)&pFVar11->lpplord + 0x16);
    pOVar13 = &ord;
    for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
      pOVar2 = pOVar13;
      pOVar13 = (ORDER *)&(pOVar13->pt).y;
      psVar1 = psVar12;
      psVar12 = psVar12 + 1;
      (pOVar2->pt).x = *psVar1;
    }
  }
REPORT_LShowTask:
  pcVar7 = _szDblDash;
  if (((uint)ord.wFlags >> 0xc & 1) != 0) {
    ids_00 = (ord.wFlags & 0xfU) + idsTaskHere;
    uVar5 = ord.wFlags & 0xf;
    if (uVar5 == 1) {
      for (i = 0; i < 4; i = i + 1) {
        if ((*(char *)((int)&vrgZip[0].fValid + i * 0x18) != '\0') &&
           (sVar6 = _memcmp((ZIPORDER *)vrgZip + i,&ord.txp,10), sVar6 == 0)) {
          return (char *)((int)vrgZip[0].szName + i * 0x18);
        }
      }
      ids = 0x6d;
      iZip = -1;
      if ((((uint)ord.txp.rgia[4].wFlags >> 0xc == 7) &&
          (((uint)ord.txp.rgia[3].wFlags >> 0xc == 0 ||
           (((uint)ord.txp.rgia[3].wFlags >> 0xc == 2 && ((uint)ord.txp.rgia[0].wFlags >> 0xc == 2))
           )))) && ((uVar5 = (uint)ord.txp.rgia[0].wFlags >> 0xc, uVar5 == 1 ||
                    ((uVar5 == 2 || (uVar5 == 6)))))) {
        i = 1;
        while ((i < 3 && ((uint)(ord.txp.rgia + i)->wFlags >> 0xc == uVar5))) {
          i = i + 1;
        }
        if (i == 3) {
          if (uVar5 == 1) {
            iZip = 0;
          }
          else if (uVar5 == 2) {
            iZip = 1;
          }
          else if (uVar5 == 6) {
            iZip = 2;
          }
          return (char *)*(undefined2 *)(iZip * 2 + 0x906);
        }
      }
      for (i = 4; -1 < i; i = i + -1) {
        uVar5 = (uint)(ord.txp.rgia + i)->wFlags >> 0xc;
        if ((uint)ids < uVar5 + 0x6d) {
          ids = uVar5 + 0x6d;
          icr = i;
        }
      }
      if (ids == 0x6d) {
        pcVar7 = PszGetCompressedString(idsTransport);
      }
      else {
        uVar5 = (ord.txp.rgia + icr)->wFlags;
        *picr = icr;
        bVar4 = false;
        switch(uVar5 >> 0xc) {
        default:
          pcVar7 = _szDblDash;
          break;
        case 5:
        case 6:
          bVar4 = true;
        case 4:
        case 8:
        case 9:
          pcVar7 = PszGetCompressedString(ids);
          uVar8 = _strlen(pcVar7);
          pcVar7[uVar8 - 3] = '\0';
          if (bVar4) {
            _WSPRINTF((LPSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),(LPCSTR)0x16031120,
                      (char *)szWork);
          }
          else {
            if (icr == 4) {
              pcVar9 = (char *)s__s__dmg_1120_160b;
            }
            else {
              pcVar9 = (char *)s__s__dkT_1120_1613;
            }
            _WSPRINTF((LPSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar9,(char *)&DAT_1120_1120),(char *)szWork);
          }
          pcVar7 = (char *)szWork;
          break;
        case 7:
          if (icr == 4) {
            ids = 0x77;
          }
        case 1:
        case 2:
          pcVar7 = PszGetCompressedString(ids);
        }
      }
    }
    else if (uVar5 == 6) {
      if ((uint)ord.txp.rgia[0].wFlags < 5) {
        pcVar7 = PszGetCompressedString(ids_00);
        _WSPRINTF((LPSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),(LPCSTR)0x161b1120,
                  (char *)szWork);
      }
      else {
        CchGetString(ids_00,(char *)szWork);
      }
      pcVar7 = (char *)szWork;
    }
    else if (uVar5 == 7) {
      if ((uint)ord.txp.rgia[1].wFlags < 0xb) {
        pcVar7 = PszGetCompressedString(ids_00);
        _WSPRINTF((LPSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),(LPCSTR)0x16231120,
                  (char *)szWork);
      }
      else {
        CchGetString(ids_00,(char *)szWork);
      }
      pcVar7 = (char *)szWork;
    }
    else {
      pcVar7 = PszGetCompressedString(ids_00);
    }
  }
  return pcVar7;
}



// ======================================================================
// Function: SortReportCache
// Address: 1108:589c
// Segment: MEMORY_REPORT
// ======================================================================


void SortReportCache(short irpt,short icol)

{
  FLEET *pFVar1;
  int iVar2;
  undefined2 uVar3;
  undefined2 unaff_SS;
  short i;
  FLEET *lpfl;
  PLANET *lppl;
  ushort iItem;
  short cRows;
  PLANET *lpplMac;
  ushort rgidRep [1024];
  
  cRows = 0;
  iItem = 0;
  if (vprptCur->icolSort != icol) {
    vicolSortPrev = vprptCur->icolSort;
    viSubsortPrev = vprptCur->iSubsort;
    vfAscendingPrev = vprptCur->fAscending;
    vprptCur->icolSort = icol;
    gd._4_2_ = gd._4_2_ & 0xff7f | 0x80;
  }
  if ((hwndReportDlg != 0) || (vprptCur->fCached == 0)) {
    if (irpt == 0) {
      vlprgidRep._0_2_ = (ushort *)vlprgidPlanet;
      vlprgidRep._2_2_ = vlprgidPlanet._2_2_;
      lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
      while ((PLANET *)lppl < (PLANET *)lpPlanets + cPlanet) {
        uVar3 = (undefined2)((ulong)lppl >> 0x10);
        if ((((PLANET *)lppl)->iPlayer == idPlayer) &&
           ((((PLANET *)lppl)->wFlags & 0xffU) == 7)) {
          rgidRep[cRows] = iItem;
          cRows = cRows + 1;
        }
        iItem = iItem + 1;
        lppl = (PLANET *)CONCAT22(uVar3,(PLANET *)lppl + 1);
      }
    }
    else if (irpt == 1) {
      vlprgidRep._0_2_ = (ushort *)vlprgidFleet;
      vlprgidRep._2_2_ = vlprgidFleet._2_2_;
      for (iItem = 0; (int)iItem < cFleet; iItem = iItem + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar1 = ((FLEET **)rglpfl)[iItem];
        iVar2 = *(int *)((int)((FLEET **)rglpfl + iItem) + 2);
        lpfl = (FLEET *)CONCAT22(iVar2,pFVar1);
        if ((pFVar1 == (FLEET *)0x0) && (iVar2 == 0)) break;
        if (((uint)lpfl->id >> 9 & 0xf) == idPlayer) {
          rgidRep[cRows] = iItem;
          cRows = cRows + 1;
        }
      }
    }
    else if (irpt == 2) {
      vlprgidRep._0_2_ = (ushort *)vlprgidMisc;
      vlprgidRep._2_2_ = vlprgidMisc._2_2_;
      vrptBattle.fCached = 0;
      for (iItem = 0; (int)iItem < cFleet; iItem = iItem + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar1 = ((FLEET **)rglpfl)[iItem];
        iVar2 = *(int *)((int)((FLEET **)rglpfl + iItem) + 2);
        lpfl = (FLEET *)CONCAT22(iVar2,pFVar1);
        if ((pFVar1 == (FLEET *)0x0) && (iVar2 == 0)) break;
        if (((uint)lpfl->id >> 9 & 0xf) != idPlayer) {
          rgidRep[cRows] = iItem;
          cRows = cRows + 1;
        }
        if (0x3fb < cRows) break;
      }
    }
    else {
      if (irpt != 3) {
        return;
      }
      vlprgidRep._0_2_ = (ushort *)vlprgidMisc;
      vlprgidRep._2_2_ = vlprgidMisc._2_2_;
      vrptEFleet.fCached = 0;
      cRows = CBattles();
      for (i = 0; i < cRows; i = i + 1) {
        rgidRep[i] = i;
      }
    }
    vprptCur->cRows = cRows;
    _qsort(rgidRep,cRows,2,(code *)ICompReport);
    __fmemcpy((ushort *)CONCAT22(vlprgidRep._2_2_,(ushort *)vlprgidRep),
                      (ushort *)CONCAT22(unaff_SS,rgidRep),cRows << 1);
    vprptCur->fCached = 1;
  }
  return;
}



// ======================================================================
// Function: ICompReport
// Address: 1108:5bb8
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: iLast */
/* WARNING: Removing unreachable block (ram,0x11086012) */
/* WARNING: Removing unreachable block (ram,0x11086072) */
/* WARNING: Removing unreachable block (ram,0x1108695b) */

short ICompReport(void *arg1,void *arg2)

{
  int iVar1;
  uint uVar2;
  FLEET *pFVar3;
  FLEET *pFVar4;
  bool bVar5;
  BTLDATA *pBVar6;
  int iVar7;
  short sVar8;
  PLANET *pPVar9;
  PLANET *pPVar10;
  char *pcVar11;
  int iVar12;
  BTLDATA *pBVar13;
  int iVar14;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar15;
  char *unaff_SS;
  bool bVar16;
  undefined1 uVar17;
  ulong uVar18;
  long lVar19;
  BTLDATA *lpbd;
  HULDEF *pHVar20;
  ulong uVar21;
  short iLast;
  long rgl [4];
  BTLDATA *lpbd2;
  FLEET *lpfl1_2;
  int iStack_74;
  short irpt;
  short fTier2;
  short i2;
  short iRet;
  char *psz;
  short iSubsort;
  long l1;
  short i;
  short j;
  short i1;
  short icolSort;
  short fAscending;
  long l2;
  char szT [80];
  
  uVar18 = CONCAT22(l2._2_2_,(uint)l2);
  uVar21 = CONCAT22(unaff_SI,unaff_DI);
  iRet = 0;
  iSubsort = vprptCur->iSubsort;
  iVar1 = vprptCur->irpt;
  icolSort = vprptCur->icolSort;
  fAscending = vprptCur->fAscending;
  bVar5 = false;
  do {
    uVar15 = lpPlanets._2_2_;
    pBVar6 = stack0xff82;
    l2 = uVar18;
    if (iVar1 == 0) {
      pPVar9 = (PLANET *)lpPlanets + *(int *)arg1;
      stack0xff86 = (FLEET *)CONCAT22(lpPlanets._2_2_,pPVar9);
      pPVar10 = (PLANET *)lpPlanets + *(int *)arg2;
      stack0xff8a = (FLEET *)CONCAT22(lpPlanets._2_2_,pPVar10);
      switch(icolSort) {
      case 0:
        psz = PszGetPlanetName(((PLANET *)stack0xff86)->id);
        _strcpy(szT,psz);
        psz = PszGetPlanetName(((PLANET *)stack0xff8a)->id);
        iRet = _strcmp(szT,psz);
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 1:
        if (((uint)pPVar9->wFlags >> 9 & 1) == 0) {
          iRet = (short)(((uint)pPVar10->wFlags >> 9 & 1) != 0);
        }
        else if (((uint)pPVar10->wFlags >> 9 & 1) == 0) {
          iRet = -1;
        }
        else {
          iRet = __fstrcmp((char *)CONCAT22(*(undefined2 *)(idPlayer * 4 + 0x14e),
                                                    (char *)(*(int *)(idPlayer * 4 + 0x14c) +
                                                             (*(uint *)&pPVar9->field11_0x2c & 0xf)
                                                             * 0x93 + 8)),
                                   (char *)CONCAT22(*(undefined2 *)(idPlayer * 4 + 0x14e),
                                                    (char *)(*(int *)(idPlayer * 4 + 0x14c) +
                                                             (*(uint *)&pPVar10->field11_0x2c & 0xf)
                                                             * 0x93 + 8)));
          pBVar6 = stack0xff82;
          uVar18 = l2;
        }
        break;
      case 2:
        iRet = (int)pPVar9->rgwtMin[3] - (int)pPVar10->rgwtMin[3];
        break;
      case 3:
        sVar8 = PctPlanetCapacity((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar10));
        stack0xff82 = (BTLDATA *)CONCAT22(sVar8,rgl[3]._2_2_);
        sVar8 = PctPlanetCapacity((PLANET *)CONCAT22(uVar15,pPVar9));
        iRet = sVar8 - (int)(BTLDATA *)lpbd2;
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 4:
        sVar8 = PctPlanetDesirability
                          ((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar10),idPlayer);
        stack0xff82 = (BTLDATA *)CONCAT22(sVar8,rgl[3]._2_2_);
        sVar8 = PctPlanetDesirability((PLANET *)CONCAT22(uVar15,pPVar9),idPlayer);
        iRet = sVar8 - (int)(BTLDATA *)lpbd2;
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 5:
        FillPlanetProdLB(0,(PLPROD *)0x0,(PLANET *)CONCAT22(lpPlanets._2_2_,pPVar9));
        _strcpy(szT,(char *)szWork);
        FillPlanetProdLB(0,(PLPROD *)0x0,(PLANET *)CONCAT22(uVar15,pPVar10));
        iRet = _strcmp(szT + 6,(char *)(uint *)&UINT_1108_57aa);
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 6:
        uVar18 = __aFulshr(uVar21,iLast);
        stack0xff82 = (BTLDATA *)
                      CONCAT22(*(undefined2 *)((int)&pPVar9->dwFlags + 2),
                               *(BTLDATA **)&pPVar9->dwFlags);
        rgl[3]._0_2_ = 0;
        rgl[2]._2_2_ = (uint)uVar18 & 0xfff;
        uVar18 = __aFulshr(uVar21,iLast);
        iRet = ((uint)uVar18 & 0xfff) - rgl[2]._2_2_;
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 7:
        uVar18 = __aFulshr(uVar21,iLast);
        stack0xff82 = (BTLDATA *)
                      CONCAT22(*(undefined2 *)((int)&pPVar9->dwFlags + 2),
                               *(BTLDATA **)&pPVar9->dwFlags);
        rgl[3]._0_2_ = 0;
        rgl[2]._2_2_ = (uint)uVar18 & 0xfff;
        uVar18 = __aFulshr(uVar21,iLast);
        iRet = ((uint)uVar18 & 0xfff) - rgl[2]._2_2_;
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 8:
        if ((*(uint *)&pPVar9->dwFlags & 0xfff) == 0) {
          rgl._2_4_ = 0;
          rgl._10_4_ = 0;
        }
        else {
          CalcPctSurvive
                    ((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar9),(float *)((int)rgl + 10),
                     (float *)0x0);
          rgl._10_4_ = DAT_1120_1e0a - (float)rgl._10_4_;
          uVar18 = l2;
        }
        bVar16 = (*(uint *)&pPVar10->dwFlags & 0xfff) == 0;
        if (bVar16) {
          rgl._2_4_ = 0;
          unique0x10000858 = (BTLDATA *)0x0;
        }
        else {
          l2 = uVar18;
          CalcPctSurvive
                    ((PLANET *)CONCAT22(uVar15,pPVar10),(float *)((int)rgl + 0xe),(float *)0x0);
          unique0x1000086c = (BTLDATA *)(DAT_1120_1e0a - (float)stack0xff82);
          uVar18 = l2;
        }
        uVar17 = bVar16 || &stack0x0000 == (undefined1 *)((int)game.szName + 2);
        bVar16 = !bVar16 && (undefined1 *)0xfff7 < &stack0xff66;
        l2 = uVar18;
        __aFfcompp();
        if (bVar16) {
          iRet = -1;
          pBVar6 = stack0xff82;
          uVar18 = l2;
        }
        else {
          __aFfcompp();
          pBVar6 = stack0xff82;
          uVar18 = l2;
          if (bVar16 || (bool)uVar17) {
            iRet = 0;
          }
          else {
            iRet = 1;
          }
        }
        break;
      case 9:
        if (iSubsort == 3) {
          stack0xff82 = (BTLDATA *)0x2;
        }
        else {
          stack0xff82 = (BTLDATA *)CONCAT22(iSubsort,iSubsort);
        }
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = (short)(BTLDATA *)lpbd2;
        while( true ) {
          uVar18 = CONCAT22(l2._2_2_,(uint)l2);
          if ((int)rgl[3]._2_2_ < i) break;
          uVar2 = *(uint *)(pPVar9->rgwtMin + i);
          bVar16 = CARRY2((uint)l1,uVar2);
          l1._0_2_ = (uint)l1 + uVar2;
          l1._2_2_ = l1._2_2_ + *(uint *)((int)(pPVar9->rgwtMin + i) + 2) + (uint)bVar16;
          uVar2 = *(uint *)(pPVar10->rgwtMin + i);
          bVar16 = CARRY2((uint)l2,uVar2);
          l2._0_2_ = (uint)l2 + uVar2;
          l2._2_2_ = l2._2_2_ + *(uint *)((int)(pPVar10->rgwtMin + i) + 2) + (uint)bVar16;
          i = i + 1;
        }
        iVar7 = (uint)l1 - (uint)l2;
        iVar12 = (l1._2_2_ - l2._2_2_) - (uint)((uint)l1 < (uint)l2);
        l1 = CONCAT22(iVar12,iVar7);
        pBVar6 = stack0xff82;
        if ((iVar12 < 1) && (iVar12 < 0)) {
          iRet = -1;
        }
        else if ((iVar12 < 0) || ((iVar12 < 1 && (iVar7 == 0)))) {
          iRet = 0;
        }
        else {
          iRet = 1;
        }
        break;
      case 10:
        if (iSubsort == 3) {
          stack0xff82 = (BTLDATA *)((ulong)stack0xff82 & 0xffff);
          iLast = 2;
        }
        else {
          iLast = iSubsort;
          stack0xff82 = (BTLDATA *)CONCAT22(iSubsort,rgl[3]._2_2_);
        }
        EstMineralsMined((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar9),rgl,-1,0);
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        for (i = (short)(BTLDATA *)lpbd2; i <= iLast; i = i + 1) {
          bVar16 = CARRY2((uint)l1,*(uint *)(rgl + i));
          l1._0_2_ = (uint)l1 + *(uint *)(rgl + i);
          l1._2_2_ = l1._2_2_ + *(int *)((int)rgl + i * 4 + 2) + (uint)bVar16;
        }
        EstMineralsMined((PLANET *)CONCAT22(uVar15,pPVar10),rgl,-1,0);
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        for (i = (short)(BTLDATA *)lpbd2; i <= iLast; i = i + 1) {
          bVar16 = CARRY2((uint)l2,*(uint *)(rgl + i));
          l2._0_2_ = (uint)l2 + *(uint *)(rgl + i);
          l2._2_2_ = l2._2_2_ + *(int *)((int)rgl + i * 4 + 2) + (uint)bVar16;
        }
        iRet = (uint)l1 - (uint)l2;
        pBVar6 = stack0xff82;
        uVar18 = CONCAT22(l2._2_2_,(uint)l2);
        break;
      case 0xb:
        if (iSubsort == 3) {
          i2 = 0;
          i1 = 0;
          for (i = 0; i < 3; i = i + 1) {
            i1 = i1 + (uint)pPVar9->rgMinConc[i];
            i2 = i2 + (uint)pPVar10->rgMinConc[i];
          }
        }
        else {
          i1 = (short)pPVar9->rgMinConc[iSubsort];
          i2 = (short)pPVar10->rgMinConc[iSubsort];
        }
        iRet = i1 - i2;
        break;
      case 0xc:
        sVar8 = CResourcesAtPlanet
                          ((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar10),idPlayer);
        stack0xff82 = (BTLDATA *)CONCAT22(sVar8,rgl[3]._2_2_);
        sVar8 = CResourcesAtPlanet((PLANET *)CONCAT22(uVar15,pPVar9),idPlayer);
        iRet = sVar8 - (int)(BTLDATA *)lpbd2;
        pBVar6 = stack0xff82;
        uVar18 = l2;
        break;
      case 0xd:
        if ((pPVar9->wFlags & 0x3ffU) == 0) {
          iRet = (short)((pPVar10->wFlags & 0x3ffU) != 0);
        }
        else if ((pPVar10->wFlags & 0x3ffU) == 0) {
          iRet = -1;
        }
        else {
          psz = PszGetPlanetName((pPVar9->wFlags & 0x3ffU) - 1);
          _strcpy(szT,psz);
          psz = PszGetPlanetName((pPVar10->wFlags & 0x3ffU) - 1);
          iRet = _strcmp(szT,psz);
          pBVar6 = stack0xff82;
          uVar18 = l2;
        }
        break;
      case 0xe:
        if ((pPVar9->wRouting & 0x3ffU) == 0) {
          iRet = (short)((pPVar10->wRouting & 0x3ffU) != 0);
        }
        else if ((pPVar10->wRouting & 0x3ffU) == 0) {
          iRet = -1;
        }
        else {
          psz = PszGetPlanetName((pPVar9->wRouting & 0x3ffU) - 1);
          _strcpy(szT,psz);
          psz = PszGetPlanetName((pPVar10->wRouting & 0x3ffU) - 1);
          iRet = _strcmp(szT,psz);
          pBVar6 = stack0xff82;
          uVar18 = l2;
        }
      }
      goto switchD_1108_63af_default;
    }
    if (iVar1 != 1) {
      if (iVar1 != 2) {
        if (iVar1 != 3) goto switchD_1108_63af_default;
        sVar8 = *(short *)arg2;
        lpbd = BtlDataGet(*(short *)arg1);
        iVar7 = (int)((ulong)lpbd >> 0x10);
        pBVar13 = (BTLDATA *)lpbd;
        join_0x00000008_0x00000000_ = BtlDataGet(sVar8);
        iVar12 = (int)((ulong)join_0x00000008_0x00000000_ >> 0x10);
        pBVar6 = join_0x00000008_0x00000000_;
        uVar18 = l2;
        if (((pBVar13 == (BTLDATA *)0x0) && (iVar7 == 0)) ||
           (((BTLDATA *)join_0x00000008_0x00000000_ == (BTLDATA *)0x0 && (iVar12 == 0)))) {
          iRet = 0;
          goto switchD_1108_63af_default;
        }
        switch(icolSort) {
        case 0:
          if (pBVar13->idPlanet == -1) {
            sVar8 = (&pBVar13->pt)->x;
            pcVar11 = PszGetCompressedString(idsSpaceDD);
            _WSPRINTF((LPSTR)CONCAT22(sVar8,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar11,unaff_SS),szT);
          }
          else {
            psz = PszGetPlanetName(pBVar13->idPlanet);
            _strcpy(szT,psz);
          }
          uVar15 = (undefined2)((ulong)stack0xff82 >> 0x10);
          pBVar13 = (BTLDATA *)stack0xff82;
          if (pBVar13->idPlanet == -1) {
            sVar8 = (&pBVar13->pt)->x;
            pcVar11 = PszGetCompressedString(idsSpaceDD);
            _WSPRINTF((LPSTR)CONCAT22(sVar8,(char *)&DAT_1120_1120),
                      (LPCSTR)CONCAT22(pcVar11,(char *)&DAT_1120_1120),(char *)szWork);
            psz = (char *)szWork;
          }
          else {
            psz = PszGetPlanetName(pBVar13->idPlanet);
          }
          iRet = _strcmp(szT,psz);
          pBVar6 = stack0xff82;
          uVar18 = l2;
          goto switchD_1108_63af_default;
        case 1:
          lVar19 = CBattleUnits(lpbd,5);
          if (lVar19 == 0) {
            l1 = lVar19;
            CBattleUnits(lpbd,6);
            lVar19 = __aFlshl(uVar21,iLast);
          }
          l1 = lVar19;
          uVar18 = CBattleUnits(stack0xff82,5);
          if (uVar18 == 0) {
            l2 = uVar18;
            CBattleUnits(stack0xff82,6);
            uVar18 = __aFlshl(uVar21,iLast);
          }
          goto REPORT_LRetDiff;
        case 2:
          l1 = (long)pBVar13->cplr;
          uVar18 = (ulong)((BTLDATA *)join_0x00000008_0x00000000_)->cplr;
          goto REPORT_LRetDiff;
        case 3:
          i = 0xff;
          break;
        case 4:
          i = 0xfd;
          break;
        case 5:
          i = 0xfe;
          break;
        case 6:
          i = 0xb;
          break;
        case 7:
          i = 0x13;
          break;
        case 8:
          i = 0x23;
          break;
        case 9:
          i = 0x43;
          break;
        case 10:
          i = 0x83;
          break;
        case 0xb:
        case 0xc:
          lVar19 = CBattleKills(lpbd,(uint)(icolSort == 0xb));
          l1 = lVar19;
          uVar18 = CBattleKills(stack0xff82,(uint)(icolSort == 0xb));
          goto REPORT_LRetDiff;
        case 0xd:
          i = 0xfd;
          goto REPORT_LUnitsLeft;
        case 0xe:
          i = 0xfe;
REPORT_LUnitsLeft:
          lVar19 = CBattleUnits(lpbd,i);
          l1 = lVar19;
          lVar19 = CBattleUnits(stack0xff82,i);
          l2 = lVar19;
          lVar19 = CBattleKills(lpbd,(uint)(icolSort == 0xd));
          l1 = l1 - lVar19;
          lVar19 = CBattleKills(stack0xff82,(uint)(icolSort == 0xd));
          uVar18 = l2 - lVar19;
          goto REPORT_LRetDiff;
        default:
          goto switchD_1108_63af_default;
        }
        lVar19 = CBattleUnits(lpbd,i);
        l1 = lVar19;
        uVar18 = CBattleUnits(stack0xff82,i);
        goto REPORT_LRetDiff;
      }
                    /* WARNING: Load size is inaccurate */
      pFVar3 = ((FLEET **)rglpfl)[*(int *)arg1];
      iVar7 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg1) + 2);
      stack0xff86 = (FLEET *)CONCAT22(iVar7,pFVar3);
                    /* WARNING: Load size is inaccurate */
      pFVar4 = ((FLEET **)rglpfl)[*(int *)arg2];
      iVar12 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg2) + 2);
      stack0xff8a = (FLEET *)CONCAT22(iVar12,pFVar4);
      switch(icolSort) {
      case 0:
        psz = PszGetFleetName(stack0xff86->id);
        _strcpy(szT,psz);
        psz = PszGetFleetName(stack0xff8a->id);
        iRet = _strcmp(szT,psz);
        pBVar6 = stack0xff82;
        uVar18 = l2;
        goto switchD_1108_63af_default;
      case 1:
        l1 = (long)(stack0xff86->id & 0x1ff);
        uVar18 = (ulong)(stack0xff8a->id & 0x1ff);
        break;
      case 2:
        if (pFVar3->idPlanet == -1) {
          sVar8 = (&pFVar3->pt)->x;
          pcVar11 = PszGetCompressedString(idsSpaceDD);
          _WSPRINTF((LPSTR)CONCAT22(sVar8,(char *)&DAT_1120_1120),(LPCSTR)CONCAT22(pcVar11,unaff_SS)
                    ,szT);
        }
        else {
          psz = PszGetPlanetName(pFVar3->idPlanet);
          _strcpy(szT,psz);
        }
        if (pFVar4->idPlanet == -1) {
          sVar8 = (&pFVar4->pt)->x;
          pcVar11 = PszGetCompressedString(idsSpaceDD);
          _WSPRINTF((LPSTR)CONCAT22(sVar8,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(pcVar11,(char *)&DAT_1120_1120),(char *)szWork);
          psz = (char *)szWork;
        }
        else {
          psz = PszGetPlanetName(pFVar4->idPlanet);
        }
        iRet = _strcmp(szT,psz);
        pBVar6 = stack0xff82;
        uVar18 = l2;
        goto switchD_1108_63af_default;
      case 3:
        if (((uint)pFVar3->wFlags >> 4 & 1) == 0) {
          l1._0_2_ = 0xffff;
          l1._2_2_ = 0xffff;
        }
        else {
          l1._0_2_ = pFVar3->wFlags & 0xf;
          l1._2_2_ = 0;
        }
        if (((uint)pFVar4->wFlags >> 4 & 1) == 0) {
          l2._0_2_ = 0xffff;
          l2._2_2_ = 0xffff;
        }
        else {
          l2._0_2_ = pFVar4->wFlags & 0xf;
          l2._2_2_ = 0;
        }
        uVar18 = CONCAT22(l2._2_2_,(uint)l2);
        break;
      case 4:
        l1 = CONCAT22((pFVar3->rgdv + 1)->dp,pFVar3->rgdv->dp);
        uVar18 = CONCAT22((pFVar4->rgdv + 1)->dp,pFVar4->rgdv->dp);
        break;
      case 5:
        sVar8 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar7,pFVar3),&i1);
        l1._2_2_ = sVar8 >> 0xf;
        l1._0_2_ = sVar8;
        sVar8 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar12,pFVar4),&i2);
        l2._2_2_ = sVar8 >> 0xf;
        l2._0_2_ = sVar8;
        if (((uint)l1 == sVar8) && (l1._2_2_ == l2._2_2_)) {
          stack0xff82 = (BTLDATA *)CONCAT22(iVar7,pFVar3->rgcsh);
          lVar19 = __aFlshl(uVar21,iLast);
          rgl[2]._0_2_ = pFVar4->rgcsh;
          rgl[3]._0_2_ = *(undefined2 *)((int)&(rgl[3]._2_2_)->id + (int)lVar19);
          rgl[2]._2_2_ = iVar12;
          lVar19 = __aFlshl(uVar21,iLast);
          iRet = (int)rgl[3] - *(int *)((int)(short *)rgl[2] + (int)lVar19);
        }
        else {
          uVar18 = __aFulmul((long)sVar8,0x93);
          iVar14 = pFVar4->iPlayer * 4;
          uVar15 = *(undefined2 *)(iVar14 + 0x100);
          pcVar11 = (char *)(*(int *)(iVar14 + 0xfe) + (int)uVar18 + 8);
          uVar18 = __aFulmul(CONCAT22(l1._2_2_,(uint)l1),0x93);
          iVar14 = pFVar3->iPlayer * 4;
          iRet = __fstrcmp((char *)CONCAT22(*(undefined2 *)(iVar14 + 0x100),
                                                    (char *)(*(int *)(iVar14 + 0xfe) + (int)uVar18 +
                                                            8)),(char *)CONCAT22(uVar15,pcVar11));
          if (iRet == 0) {
            stack0xff82 = (BTLDATA *)CONCAT22(iVar7,pFVar3->rgcsh);
            lVar19 = __aFlshl(uVar21,iLast);
            rgl[2]._0_2_ = pFVar4->rgcsh;
            rgl[3]._0_2_ = *(undefined2 *)((int)&(rgl[3]._2_2_)->id + (int)lVar19);
            rgl[2]._2_2_ = iVar12;
            lVar19 = __aFlshl(uVar21,iLast);
            iRet = (int)rgl[3] - *(int *)((int)(short *)rgl[2] + (int)lVar19);
          }
          if (iRet == 0) {
            iRet = (uint)l1 - (uint)l2;
          }
        }
        pBVar6 = stack0xff82;
        uVar18 = CONCAT22(l2._2_2_,(uint)l2);
        if (iRet == 0) {
          iRet = i1 - i2;
        }
        goto switchD_1108_63af_default;
      case 6:
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar18 = CONCAT22(l2._2_2_,(uint)l2);
          if (0xf < i) break;
          uVar2 = pFVar3->rgcsh[i];
          bVar16 = CARRY2((uint)l1,uVar2);
          l1._0_2_ = (uint)l1 + uVar2;
          l1._2_2_ = l1._2_2_ + ((int)uVar2 >> 0xf) + (uint)bVar16;
          uVar2 = pFVar4->rgcsh[i];
          bVar16 = CARRY2((uint)l2,uVar2);
          l2._0_2_ = (uint)l2 + uVar2;
          l2._2_2_ = l2._2_2_ + ((int)uVar2 >> 0xf) + (uint)bVar16;
          i = i + 1;
        }
        break;
      case 7:
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar18 = CONCAT22(l2._2_2_,(uint)l2);
          if (0xf < i) break;
          if (pFVar3->rgcsh[i] != 0) {
            iVar14 = pFVar3->iPlayer * 4;
            pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar14 + 0xfe) + i * 0x93));
            j = (uint)((HULDEF *)pHVar20)->wFlags >> 10 & 0xf;
            if (((uint)j < 2) || (5 < (uint)j)) {
              uVar2 = pFVar3->rgcsh[i];
              bVar16 = CARRY2((uint)l1,uVar2);
              l1._0_2_ = (uint)l1 + uVar2;
              l1._2_2_ = l1._2_2_ + ((int)uVar2 >> 0xf) + (uint)bVar16;
            }
          }
          if (pFVar4->rgcsh[i] != 0) {
            iVar14 = pFVar4->iPlayer * 4;
            pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar14 + 0xfe) + i * 0x93));
            j = (uint)((HULDEF *)pHVar20)->wFlags >> 10 & 0xf;
            if (((uint)j < 2) || (5 < (uint)j)) {
              uVar2 = pFVar4->rgcsh[i];
              bVar16 = CARRY2((uint)l2,uVar2);
              l2._0_2_ = (uint)l2 + uVar2;
              l2._2_2_ = l2._2_2_ + ((int)uVar2 >> 0xf) + (uint)bVar16;
            }
          }
          i = i + 1;
        }
        break;
      case 8:
        j = 2;
        goto REPORT_LEFleetCount;
      case 9:
        j = 3;
        goto REPORT_LEFleetCount;
      case 10:
        j = 5;
        goto REPORT_LEFleetCount;
      case 0xb:
        j = 4;
REPORT_LEFleetCount:
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar18 = CONCAT22(l2._2_2_,(uint)l2);
          if (0xf < i) break;
          if ((pFVar3->rgcsh[i] != 0) &&
             (iVar14 = pFVar3->iPlayer * 4,
             pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar14 + 0xfe) + i * 0x93)),
             ((uint)((HULDEF *)pHVar20)->wFlags >> 10 & 0xf) == j)) {
            uVar2 = pFVar3->rgcsh[i];
            bVar16 = CARRY2((uint)l1,uVar2);
            l1._0_2_ = (uint)l1 + uVar2;
            l1._2_2_ = l1._2_2_ + ((int)uVar2 >> 0xf) + (uint)bVar16;
          }
          if ((pFVar4->rgcsh[i] != 0) &&
             (iVar14 = pFVar4->iPlayer * 4,
             pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar14 + 0xfe) + i * 0x93)),
             ((uint)((HULDEF *)pHVar20)->wFlags >> 10 & 0xf) == j)) {
            uVar2 = pFVar4->rgcsh[i];
            bVar16 = CARRY2((uint)l2,uVar2);
            l2._0_2_ = (uint)l2 + uVar2;
            l2._2_2_ = l2._2_2_ + ((int)uVar2 >> 0xf) + (uint)bVar16;
          }
          i = i + 1;
        }
        break;
      default:
        goto switchD_1108_63af_default;
      }
      goto REPORT_LRetDiff;
    }
                    /* WARNING: Load size is inaccurate */
    pFVar3 = ((FLEET **)rglpfl)[*(int *)arg1];
    iVar7 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg1) + 2);
    stack0xff86 = (FLEET *)CONCAT22(iVar7,pFVar3);
                    /* WARNING: Load size is inaccurate */
    pFVar4 = ((FLEET **)rglpfl)[*(int *)arg2];
    iVar12 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg2) + 2);
    stack0xff8a = (FLEET *)CONCAT22(iVar12,pFVar4);
    switch(icolSort) {
    case 0:
      psz = PszGetFleetName(stack0xff86->id);
      _strcpy(szT,psz);
      psz = PszGetFleetName(stack0xff8a->id);
      iRet = _strcmp(szT,psz);
      pBVar6 = stack0xff82;
      uVar18 = l2;
      break;
    case 1:
      l1 = (long)stack0xff86->id;
      uVar18 = (ulong)stack0xff8a->id;
      goto REPORT_LRetDiff;
    case 2:
      if (pFVar3->idPlanet == -1) {
        sVar8 = (&pFVar3->pt)->x;
        pcVar11 = PszGetCompressedString(idsSpaceDD);
        _WSPRINTF((LPSTR)CONCAT22(sVar8,(char *)&DAT_1120_1120),(LPCSTR)CONCAT22(pcVar11,unaff_SS),
                  szT);
      }
      else {
        psz = PszGetPlanetName(pFVar3->idPlanet);
        _strcpy(szT,psz);
      }
      if (pFVar4->idPlanet == -1) {
        sVar8 = (&pFVar4->pt)->x;
        pcVar11 = PszGetCompressedString(idsSpaceDD);
        _WSPRINTF((LPSTR)CONCAT22(sVar8,(char *)&DAT_1120_1120),
                  (LPCSTR)CONCAT22(pcVar11,(char *)&DAT_1120_1120),(char *)szWork);
        psz = (char *)szWork;
      }
      else {
        psz = PszGetPlanetName(pFVar4->idPlanet);
      }
      iRet = _strcmp(szT,psz);
      pBVar6 = stack0xff82;
      uVar18 = l2;
      break;
    case 3:
      psz = PszGetDestName((FLEET *)CONCAT22(iVar7,pFVar3),0);
      _strcpy(szT,psz);
      psz = PszGetDestName((FLEET *)CONCAT22(iVar12,pFVar4),0);
      iRet = _strcmp(szT,psz);
      pBVar6 = stack0xff82;
      uVar18 = l2;
      if (iRet < 0) {
        iRet = -1;
      }
      else if (0 < iRet) {
        iRet = 1;
      }
      break;
    case 4:
      PszGetETA(0,(FLEET *)CONCAT22(iVar7,pFVar3),&i1);
      PszGetETA(0,(FLEET *)CONCAT22(iVar12,pFVar4),&i2);
      iRet = i1 - i2;
      pBVar6 = stack0xff82;
      uVar18 = l2;
      break;
    case 5:
      psz = PszGetTaskName((FLEET *)CONCAT22(iVar7,pFVar3),&i1);
      _strcpy(szT,psz);
      psz = PszGetTaskName((FLEET *)CONCAT22(iVar12,pFVar4),&i2);
      iRet = _strcmp(szT,psz);
      pBVar6 = stack0xff82;
      uVar18 = l2;
      if (iRet < 0) {
        iRet = -1;
      }
      else if (iRet < 1) {
        if (i2 < i1) {
          iRet = 1;
        }
        else if (i1 < i2) {
          iRet = -1;
        }
      }
      else {
        iRet = 1;
      }
      break;
    case 6:
      iSubsort = -1;
    case 7:
      if (iSubsort == 4) {
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar18 = CONCAT22(l2._2_2_,(uint)l2);
          if (3 < i) break;
          uVar2 = *(uint *)(pFVar3->rgwtMin + i);
          bVar16 = CARRY2((uint)l1,uVar2);
          l1._0_2_ = (uint)l1 + uVar2;
          l1._2_2_ = l1._2_2_ + *(uint *)((int)(pFVar3->rgwtMin + i) + 2) + (uint)bVar16;
          uVar2 = *(uint *)(pFVar4->rgwtMin + i);
          bVar16 = CARRY2((uint)l2,uVar2);
          l2._0_2_ = (uint)l2 + uVar2;
          l2._2_2_ = l2._2_2_ + *(uint *)((int)(pFVar4->rgwtMin + i) + 2) + (uint)bVar16;
          i = i + 1;
        }
      }
      else {
        if (iSubsort == -1) {
          iSubsort = 4;
        }
        l1 = CONCAT22(*(undefined2 *)((int)(pFVar3->rgwtMin + iSubsort) + 2),
                      (int)pFVar3->rgwtMin[iSubsort]);
        uVar18 = CONCAT22(*(undefined2 *)((int)(pFVar4->rgwtMin + iSubsort) + 2),
                          (int)pFVar4->rgwtMin[iSubsort]);
      }
      goto REPORT_LRetDiff;
    case 8:
      sVar8 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar7,pFVar3),&i1);
      l1._2_2_ = sVar8 >> 0xf;
      l1._0_2_ = sVar8;
      sVar8 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar12,pFVar4),&i2);
      l2._2_2_ = sVar8 >> 0xf;
      l2._0_2_ = sVar8;
      if (((uint)l1 == sVar8) && (l1._2_2_ == l2._2_2_)) {
        stack0xff82 = (BTLDATA *)CONCAT22(iVar7,pFVar3->rgcsh);
        lVar19 = __aFlshl(uVar21,iLast);
        rgl[2]._0_2_ = pFVar4->rgcsh;
        rgl[3]._0_2_ = *(undefined2 *)((int)&(rgl[3]._2_2_)->id + (int)lVar19);
        rgl[2]._2_2_ = iVar12;
        lVar19 = __aFlshl(uVar21,iLast);
        iRet = (int)rgl[3] - *(int *)((int)(short *)rgl[2] + (int)lVar19);
      }
      else {
        uVar18 = __aFulmul((long)sVar8,0x93);
        pcVar11 = (char *)((int)&rgshdef[0].hul + 8 + (int)uVar18);
        uVar18 = __aFulmul(CONCAT22(l1._2_2_,(uint)l1),0x93);
        iRet = _strcmp((char *)((int)&rgshdef[0].hul + 8 + (int)uVar18),pcVar11);
        if (iRet == 0) {
          stack0xff82 = (BTLDATA *)CONCAT22(iVar7,pFVar3->rgcsh);
          lVar19 = __aFlshl(uVar21,iLast);
          rgl[2]._0_2_ = pFVar4->rgcsh;
          rgl[3]._0_2_ = *(undefined2 *)((int)&(rgl[3]._2_2_)->id + (int)lVar19);
          rgl[2]._2_2_ = iVar12;
          lVar19 = __aFlshl(uVar21,iLast);
          iRet = (int)rgl[3] - *(int *)((int)(short *)rgl[2] + (int)lVar19);
        }
        if (iRet == 0) {
          iRet = (uint)l1 - (uint)l2;
        }
      }
      pBVar6 = stack0xff82;
      uVar18 = CONCAT22(l2._2_2_,(uint)l2);
      if (iRet == 0) {
        iRet = i1 - i2;
      }
      break;
    case 9:
      sVar8 = PctCloakFromLpfl((FLEET *)CONCAT22(iVar7,pFVar3));
      l1._2_2_ = sVar8 >> 0xf;
      l1._0_2_ = sVar8;
      sVar8 = PctCloakFromLpfl((FLEET *)CONCAT22(iVar12,pFVar4));
      uVar18 = (ulong)sVar8;
      goto REPORT_LRetDiff;
    case 10:
      stack0xff82 = (BTLDATA *)(ulong)CONCAT12(pFVar4->iplan,rgl[3]._2_2_);
      pBVar6 = stack0xff82;
      lpbd2._0_2_ = (BTLDATA *)(uint)pFVar4->iplan;
      iRet = (uint)pFVar3->iplan - (int)(BTLDATA *)lpbd2;
      break;
    case 0xb:
      lVar19 = WtFromLpfl((FLEET *)CONCAT22(iVar7,pFVar3));
      l1 = lVar19;
      uVar18 = WtFromLpfl((FLEET *)CONCAT22(iVar12,pFVar4));
REPORT_LRetDiff:
      l1 = l1 - uVar18;
      pBVar6 = stack0xff82;
      if ((l1 < 0x10000) && (l1 < 0)) {
        iRet = -1;
      }
      else if (l1 < 1) {
        iRet = 0;
      }
      else {
        iRet = 1;
      }
    }
switchD_1108_63af_default:
    stack0xff82 = pBVar6;
    if (fAscending == 0) {
      iRet = -iRet;
    }
    if ((((iRet != 0) || (bVar5)) ||
        ((icolSort == vicolSortPrev && (iSubsort == viSubsortPrev)))) ||
       (vicolSortPrev < 0)) {
      return iRet;
    }
    icolSort = vicolSortPrev;
    iSubsort = viSubsortPrev;
    fAscending = vfAscendingPrev;
    bVar5 = true;
  } while( true );
}



// ======================================================================
// Function: ReportColumnPopup
// Address: 1108:74d4
// Segment: MEMORY_REPORT
// ======================================================================


void ReportColumnPopup(POINT pt,short icol,short fRightBtn)

{
  uint *puVar1;
  int iVar2;
  bool bVar3;
  RPT *pRVar4;
  int iVar5;
  HDC hdc_00;
  StringId ids;
  short sVar6;
  char *pcVar7;
  short sVar8;
  uint uVar9;
  short iSortLast;
  short iHide;
  short iRet;
  short cch;
  char *psz [1];
  short cItems;
  char szColTitle [50];
  short rgcol [32];
  short fccolChange;
  short ibit;
  short i;
  short j;
  short cSubsort;
  short iBase;
  char rgsz [50] [32];
  char szT [50];
  HDC hdc;
  
  cSubsort = 0;
  bVar3 = false;
  hdc_00 = GetDC(hwndReportDlg);
  DxReportColHdr(vprptCur->irpt,icol,szColTitle,hdc_00);
  cItems = 0;
  for (i = 0; i < 2; i = i + 1) {
    if (i == 0) {
      ids = idsSort;
    }
    else {
      ids = idsReverseSort;
    }
    sVar6 = CchGetString(ids,(char *)((int)rgsz + cItems * 0x32));
    _strcpy((char *)((int)rgsz + sVar6 + cItems * 0x32),szColTitle);
    iVar2 = cItems + 1;
    if (((vprptCur->irpt == 0) && (((icol == 0xb || (icol == 9)) || (icol == 10)))) ||
       ((vprptCur->irpt == 1 && (icol == 7)))) {
      _strcpy((char *)((int)rgsz + iVar2 * 0x32),(char *)((int)rgsz + cItems * 0x32));
      *(undefined1 *)((int)rgsz + cItems * 0x32) = 0;
      cItems = cItems + 2;
      for (j = 0; j < (int)((vprptCur->irpt == 1) + 3); j = j + 1) {
        _strcpy((char *)((int)rgsz + cItems * 0x32),(char *)*(undefined2 *)(j * 2 + 0x4cc));
        cItems = cItems + 1;
      }
      *(undefined1 *)((int)rgsz + cItems * 0x32) = 0xff;
      *(undefined1 *)((int)rgsz + cItems * 0x32 + 1) = 0;
      pcVar7 = PszGetCompressedString(idsWeightedAverage);
      _strcpy((char *)((int)rgsz + (cItems + 1) * 0x32),pcVar7);
      *(undefined1 *)((int)rgsz + (cItems + 2) * 0x32) = 0;
      cSubsort = 5;
      iVar2 = cItems + 3;
    }
    cItems = iVar2;
  }
  *(undefined1 *)((int)rgsz + cItems * 0x32) = 0xff;
  *(undefined1 *)((int)rgsz + cItems * 0x32 + 1) = 0;
  iVar2 = cItems + 1;
  sVar6 = CchGetString(idsHide,(char *)((int)rgsz + iVar2 * 0x32));
  _strcpy((char *)((int)rgsz + sVar6 + iVar2 * 0x32),szColTitle);
  CchGetString(idsColumn,szT);
  _strcat((char *)((int)rgsz + iVar2 * 0x32),szT);
  *(undefined1 *)((int)rgsz + (cItems + 2) * 0x32) = 0xff;
  *(undefined1 *)((int)rgsz + (cItems + 2) * 0x32 + 1) = 0;
  iHide = iVar2;
  iVar5 = cItems + 3;
  if (icol == 0) {
    iHide = -1;
    iVar5 = cItems + 1;
  }
  cItems = iVar5;
  sVar6 = cItems;
  ibit = 1;
  for (i = 0; i < vprptCur->cFields; i = i + 1) {
    if (((ibit & (uint)vprptCur->grbitVisible) == 0) &&
       ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) == 0)) {
      DxReportColHdr(vprptCur->irpt,i,szColTitle,hdc_00);
      sVar8 = CchGetString(idsShow,(char *)((int)rgsz + cItems * 0x32));
      _strcpy((char *)((int)rgsz + sVar8 + cItems * 0x32),szColTitle);
      CchGetString(idsColumn,szT);
      _strcat((char *)((int)rgsz + cItems * 0x32),szT);
      rgcol[cItems] = i;
      cItems = cItems + 1;
    }
    ibit = ibit << 1;
  }
  if (cItems == sVar6) {
    cItems = cItems + -1;
  }
  ReleaseDC(hwndReportDlg,hdc_00);
  for (i = 0; i < cItems; i = i + 1) {
    if (*(char *)((int)rgsz + i * 0x32) == '\0') {
      psz[i] = (char *)0x0;
    }
    else {
      psz[i] = (char *)((int)rgsz + i * 0x32);
    }
  }
  sVar8 = PopupMenu(hwndReportDlg,pt.x,pt.y,cItems,(long *)0x0,psz,-1,fRightBtn);
  pRVar4 = vprptCur;
  if (-1 < sVar8) {
    gd._4_2_ = gd._4_2_ & 0xff7f | 0x80;
    if (sVar8 < iVar2) {
      vicolSortPrev = vprptCur->icolSort;
      viSubsortPrev = vprptCur->iSubsort;
      vfAscendingPrev = vprptCur->fAscending;
      vprptCur->icolSort = icol;
      if (cSubsort == 0) {
        vprptCur->fAscending = (uint)(sVar8 == 0);
      }
      else {
        vprptCur->iSubsort =
             (sVar8 + -2) % (int)(cSubsort + 3 + (uint)(vprptCur->irpt == 1));
        if ((int)((vprptCur->irpt == 1) + 3) < vprptCur->iSubsort) {
          vprptCur->iSubsort = (vprptCur->irpt == 1) + 3;
        }
        vprptCur->fAscending = (uint)(sVar8 < cSubsort + 2);
      }
      SortReportCache(vprptCur->irpt,icol);
    }
    else if (sVar8 == iHide) {
      bVar3 = true;
      uVar9 = ~(1 << ((byte)icol & 0x1f));
      *(uint *)&vprptCur->grbitVisible = (uint)vprptCur->grbitVisible & uVar9;
      puVar1 = (uint *)((int)&pRVar4->grbitVisible + 2);
      *puVar1 = *puVar1 & (int)uVar9 >> 0xf;
    }
    else if (sVar6 <= sVar8) {
      bVar3 = true;
      uVar9 = 1 << ((byte)rgcol[sVar8] & 0x1f);
      *(uint *)&vprptCur->grbitVisible = (uint)vprptCur->grbitVisible | uVar9;
      puVar1 = (uint *)((int)&pRVar4->grbitVisible + 2);
      *puVar1 = *puVar1 | (int)uVar9 >> 0xf;
    }
    if (bVar3) {
      SetHScrollBar();
    }
    InvalidateRect(hwndReportDlg,(undefined2 *)0x0,1);
  }
  return;
}



// ======================================================================
// Function: InvalidateReport
// Address: 1108:7af6
// Segment: MEMORY_REPORT
// ======================================================================


void InvalidateReport(short irpt,short fReload)

{
  bool bVar1;
  undefined2 unaff_SS;
  RECT rc;
  ushort *lprgidSav;
  RPT *prptSav;
  short fClearRpt;
  short fResetRpt;
  
  fClearRpt = 0;
  bVar1 = false;
  if ((((uint)gd._0_2_ >> 1 & 1) == 0) && (fAi == 0)) {
    if ((hwndReportDlg == 0) || (irpt != vprptCur->irpt)) {
      if (vprptCur == (RPT *)0x0) {
        fClearRpt = fReload;
        if (irpt == 0) {
          vprptCur = (RPT *)&vrptPlanet;
        }
        else {
          vprptCur = (RPT *)&vrptFleet;
        }
      }
      else if ((fReload != 0) && (vprptCur->irpt != irpt)) {
        lprgidSav._0_2_ = (ushort *)vlprgidRep;
        lprgidSav._2_2_ = vlprgidRep._2_2_;
        prptSav = vprptCur;
        bVar1 = true;
        if (irpt == 0) {
          vprptCur = (RPT *)&vrptPlanet;
        }
        else {
          vprptCur = (RPT *)&vrptFleet;
        }
      }
    }
    else {
      GetClientRect(hwndReportDlg,(undefined2 *)CONCAT22(unaff_SS,&rc));
      if (fReload != 2) {
        rc.top = dyArial8 + 6;
        rc.bottom = (dyArial8 + 4) * vprptCur->cRowsVis + rc.top;
      }
      InvalidateRect(hwndReportDlg,(undefined2 *)CONCAT22(unaff_SS,&rc),(uint)(fReload == 2))
      ;
      gd.wFlags = gd.wFlags & 0xfdffU | 0x200;
    }
    vprptCur->fCached = 0;
    if (fReload != 0) {
      SortReportCache(vprptCur->irpt,vprptCur->icolSort);
    }
    if (fClearRpt == 0) {
      if (bVar1) {
        vprptCur = prptSav;
        vlprgidRep._0_2_ = (ushort *)lprgidSav;
        vlprgidRep._2_2_ = lprgidSav._2_2_;
      }
      else if (((fReload != 0) && (hwndReportDlg != 0)) && (irpt == vprptCur->irpt)) {
        SetScrollRange(vprptCur->hwndVScroll,2,0,
                       vprptCur->cRows - vprptCur->cRowsVis,0);
        InvalidateRect(hwndReportDlg,(undefined2 *)0x0,1);
      }
    }
    else {
      vprptCur = (RPT *)0x0;
    }
  }
  return;
}



// ======================================================================
// Function: ExecuteReportClick
// Address: 1108:7cd6
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11087ea5) */
/* WARNING: Variable defined which should be unmapped: scan_2 */

void ExecuteReportClick(POINT pt,short irpt,short icol,short irow)

{
  FLEET *pFVar1;
  char *pcVar2;
  int iVar3;
  POINT pt_00;
  POINT pt_01;
  POINT pt_02;
  BTLDATA *pBVar4;
  undefined2 uVar5;
  HDC HVar6;
  short sVar7;
  PLANET *pPVar8;
  int iVar9;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  ulong uVar10;
  BTLDATA *pBVar11;
  SCAN scan_2;
  SCAN scan;
  short dxOffset;
  short xCur;
  long rglQuan [4];
  short ibit;
  FLEET *lpfl;
  short i;
  PLANET *lppl;
  BTLDATA *lpbd;
  HDC hdc;
  
  uVar10 = CONCAT22(unaff_SI,unaff_DI);
  HVar6 = GetDC(hwndReportDlg);
  uVar5 = lpPlanets._2_2_;
  if (irpt != 0) {
    if (irpt == 1) {
                    /* WARNING: Load size is inaccurate */
      pFVar1 = ((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[irow]];
      pcVar2 = (char *)*(undefined2 *)
                        ((int)((FLEET **)rglpfl + ((ushort *)vlprgidFleet)[irow]) + 2)
      ;
      lpfl = (FLEET *)CONCAT22(pcVar2,pFVar1);
      if (mdXferDlg == -1) {
        SelectAdjFleet(0,lpfl->id);
        InvalidateReport(1,0);
        switch(icol) {
        case 3:
        case 4:
        case 5:
          sVar7 = FDestIsWP0((FLEET *)CONCAT22(pcVar2,pFVar1));
          if (sVar7 == 0) {
            SendMessage(hwndShipLB,0x407,1,0);
            SetScanWp(1);
          }
          break;
        case 6:
        case 7:
          if (mdXferDlg == -1) {
            if (sel.fl.idPlanet == -1) {
              TransferStuff(sel.fl.id,2,-1,4,0);
            }
            else {
              TransferStuff(sel.fl.id,2,sel.fl.idPlanet,1,0);
            }
          }
          break;
        case 8:
          GlobalPD.grPopup = 3;
          GlobalPD.iPlanVal = 1;
          GlobalPD.iPlanMax = 0xff;
          GlobalPD._2_2_ = pFVar1;
          GlobalPD.psz = pcVar2;
          Popup(hwndReportDlg,pt.x,pt.y);
        }
      }
      else {
        MessageBeep(0);
      }
    }
    else if (irpt == 2) {
      if ((vprptCur == (RPT *)&vrptEFleet) && (-3 < irow)) {
        if (irow < 0) {
          if (irow == -1) {
            irowEFleetCur = irowEFleetCur + 1;
          }
          else {
            irowEFleetCur = irowEFleetCur + -1;
          }
          if (irowEFleetCur < vrptEFleet.cRows) {
            if (irowEFleetCur < 0) {
              irowEFleetCur = vrptEFleet.cRows + -1;
            }
          }
          else {
            irowEFleetCur = 0;
          }
          irow = irowEFleetCur;
        }
        iVar9 = *(int *)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow]);
        iVar3 = *(int *)((int)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow]) + 2);
        if (mdXferDlg == -1) {
          pt_00.y = *(short *)(iVar9 + 10);
          pt_00.x = *(short *)(iVar9 + 8);
          FFindNearestObject(pt_00,grobjFleet,&scan);
          scan.ifl = ((ushort *)vlprgidMisc)[irow];
          ChangeScanSel(&scan,2);
          pt_02.y = *(short *)(iVar9 + 10);
          pt_02.x = *(short *)(iVar9 + 8);
          FEnsurePointOnScreen(pt_02,1);
          irowEFleetCur = irow;
          InvalidateReport(2,0);
        }
        else {
          MessageBeep(0);
        }
      }
    }
    else if (irpt == 3) {
      pBVar11 = BtlDataGet(((ushort *)vlprgidMisc)[irow]);
      iVar9 = (int)((ulong)pBVar11 >> 0x10);
      pBVar4 = (BTLDATA *)pBVar11;
      if ((pBVar4 != (BTLDATA *)0x0) || (iVar9 != 0)) {
        if (((&pBVar4->pt)->x != sel.scan.pt.x) ||
           ((pBVar4->pt).y != sel.scan.pt.y)) {
          scan_2.pt.x = (&pBVar4->pt)->x;
          scan_2.pt.y = (pBVar4->pt).y;
          scan_2.grobj = 0x8f;
          ChangeScanSel(&scan_2,0);
          pt_01.y = scan_2.pt.y;
          pt_01.x = scan_2.pt.x;
          CtrPointScan(pt_01,1);
          InvalidateReport(0,0);
          if (((&pBVar4->pt)->x == sel.scan.pt.x) &&
             ((pBVar4->pt).y == sel.scan.pt.y)) goto switchD_1108_82b9_default;
        }
        if (hwndVCRDlg == 0) {
          BattleVCR(pBVar11->id);
        }
      }
    }
    goto switchD_1108_82b9_default;
  }
  pPVar8 = (PLANET *)lpPlanets + ((ushort *)vlprgidPlanet)[irow];
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,pPVar8);
  if (hwndProdDlg != 0) {
    MessageBeep(0);
    goto switchD_1108_82b9_default;
  }
  SelectAdjPlanet(0,lppl->id);
  InvalidateReport(0,0);
  switch(icol) {
  case 0:
    if ((((uint)pPVar8->wFlags >> 9 & 1) != 0) &&
       ((int)((uint)vprptCur->rgbdx[0] * 2 + -8) < pt.x)) {
REPORT_LShowStarbase:
      GlobalPD.grPopup = 0xb;
      GlobalPD.psz = (char *)*(undefined2 *)(idPlayer * 4 + 0x14e);
      GlobalPD._2_2_ =
           *(int *)(idPlayer * 4 + 0x14c) + (sel.pl._44_2_ & 0xf) * 0x93;
      GlobalPD.iPlanMin = 0;
      GlobalPD.iPlanVal = 1;
      GlobalPD.iPlanMax = 0;
      GlobalPD.iPlrVal = 0;
      Popup(hwndReportDlg,pt.x,pt.y);
    }
    break;
  case 1:
    if (((uint)pPVar8->wFlags >> 9 & 1) != 0) goto REPORT_LShowStarbase;
    break;
  case 2:
  case 4:
    GlobalPD.grPopup = 7;
    GlobalPD.field1_0x2 = (undefined1)sel.pl.id;
    GlobalPD.field2_0x3 = sel.pl.id._1_1_;
    Popup(hwndReportDlg,pt.x,pt.y);
    break;
  case 5:
    if (hwndProdDlg == 0) {
      ChangeProduction(0);
    }
    break;
  case 6:
  case 7:
    GlobalPD.grPopup = 8;
    GlobalPD.field1_0x2 = (undefined1)sel.pl.id;
    GlobalPD.field2_0x3 = sel.pl.id._1_1_;
    GlobalPD.iPlanMax = (short)(icol == 7);
    if (GlobalPD.iPlanMax == 0) {
      GlobalPD.psz = (char *)CMaxMines(&sel.pl,idPlayer);
      uVar10 = __aFulshr(uVar10,scan_2.pt.x);
      GlobalPD.iPlanVal = (uint)uVar10 & 0xfff;
      GlobalPD.iPlanMin = CMaxOperableMines(&sel.pl,idPlayer,0);
    }
    else {
      GlobalPD.psz = (char *)CMaxFactories(&sel.pl,idPlayer);
      uVar10 = __aFulshr(uVar10,scan_2.pt.x);
      GlobalPD.iPlanVal = (uint)uVar10 & 0xfff;
      GlobalPD.iPlanMin = CMaxOperableFactories(&sel.pl,idPlayer,0);
    }
    Popup(hwndReportDlg,pt.x,pt.y);
    break;
  case 8:
    if (((uint)sel.pl.dwFlags & 0xfff) != 0) {
      FGetBestDefensePart((PART *)&GlobalPD.field1_0x2);
      GlobalPD.grPopup = 9;
      Popup(hwndReportDlg,pt.x,pt.y);
    }
    break;
  case 9:
  case 10:
  case 0xb:
    xCur = 2;
    ibit = 1;
    for (i = 0; i < icol; i = i + 1) {
      if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
          ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
         ((i == 0 || (vprptCur->cFieldFirst <= i)))) {
        xCur = xCur + (uint)vprptCur->rgbdx[i] * 2;
      }
      ibit = ibit << 1;
    }
    for (i = 1; (i < 4 && (scan_2.ith = i * 2,
                          (int)(scan_2.ith * (uint)vprptCur->rgbdx[icol]) / 3 <= pt.x - xCur)
                ); i = i + 1) {
    }
    iVar9 = i + -1;
    GlobalPD.grPopup = 1;
    GlobalPD.psz = (char *)(iVar9 >> 0xf);
    GlobalPD.iPlanMax = *(short *)((int)&sel.pl + 0x1c + iVar9 * 4);
    GlobalPD.iPlrVal = *(short *)((int)&sel.pl + 0x1e + iVar9 * 4);
    GlobalPD.iPlrMin = (short)*(byte *)((int)&sel.pl + 8 + i);
    GlobalPD.iPlrMax = 0;
    GlobalPD._2_2_ = iVar9;
    EstMineralsMined(&sel.pl,rglQuan,-1,0);
    GlobalPD._18_2_ = *(undefined2 *)(rglQuan + iVar9);
    GlobalPD._20_2_ = *(undefined2 *)((int)rglQuan + iVar9 * 4 + 2);
    GlobalPD.iPlanVal = (uint)sel.pl.wFlags >> 10 & 1;
    GlobalPD.iPlanMin = 0;
    Popup(hwndReportDlg,pt.x,pt.y);
    break;
  case 0xc:
    GlobalPD.grPopup = 0xc;
    GlobalPD.field1_0x2 = (undefined1)sel.pl.id;
    GlobalPD.field2_0x3 = sel.pl.id._1_1_;
    GlobalPD.psz = (char *)CResourcesAtPlanet(&sel.pl,idPlayer);
    GlobalPD.iPlanVal = (short)GlobalPD.psz;
    uVar10 = __aFulshr(uVar10,scan_2.pt.x);
    if ((uVar10 & 1) == 0) {
      sVar7 = MulDiv((short)GlobalPD.psz,
                     (int)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0),
                     100);
      GlobalPD.iPlanVal = GlobalPD.iPlanVal - sVar7;
    }
    Popup(hwndReportDlg,pt.x,pt.y);
  }
switchD_1108_82b9_default:
  ReleaseDC(hwndReportDlg,HVar6);
  return;
}



// ======================================================================
// Function: DumpUniverse
// Address: 1108:851e
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11088586) */

void DumpUniverse(void)

{
  bool bVar1;
  short (*pasVar2) [9];
  short sVar3;
  short sVar4;
  ushort cb;
  StringId ids_00;
  char *pcVar5;
  char *pcVar6;
  short cch;
  short (*penvMemSav) [9];
  short fSilentSav;
  short fSuccess;
  short fOpen;
  short env [9];
  short i;
  short ids;
  
  sVar3 = fFileErrSilent;
  pasVar2 = penvMem;
  bVar1 = true;
  if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
    bVar1 = false;
    penvMem = pasVar2;
    fFileErrSilent = sVar3;
  }
  else {
    penvMemSav = penvMem;
    penvMem = &env;
    sVar4 = __setjmp(env);
    if (sVar4 == 0) {
      fFileErrSilent = 1;
      _WSPRINTF((LPSTR)0x56a21120,(LPCSTR)0x16331120,(char *)szWork);
      StreamOpen((char *)szWork,0x1012);
      RgToStream(s___X_Y_Name_1120_163a,0xc);
      for (i = 0; i < game.cPlanMax; i = i + 1) {
        PszGetCompressedPlanet(((short *)rgidPlan)[i]);
        cb = _WSPRINTF((LPSTR)CONCAT22(i + 1,(char *)&DAT_1120_1120),(LPCSTR)0x16471120,
                       (char *)szWork);
        RgToStream(szWork,cb);
      }
      StreamClose();
    }
    else {
      bVar1 = false;
      penvMem = pasVar2;
      fFileErrSilent = sVar3;
    }
  }
  if (bVar1) {
    ids_00 = idsUniverseDefinitionHasSuccessfullyWrittenSMap;
  }
  else {
    ids_00 = idsUnableWriteUniverseDefinitionSMapOperation;
  }
  pcVar6 = (char *)szBase;
  pcVar5 = PszGetCompressedString(ids_00);
  _WSPRINTF((LPSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),
            (LPCSTR)CONCAT22(pcVar5,(char *)&DAT_1120_1120),(char *)szWork);
  if (bVar1) {
    AlertSz((char *)szWork,0x40);
  }
  else {
    AlertSz((char *)szWork,0x10);
  }
  fFileErrSilent = sVar3;
  penvMem = penvMemSav;
  return;
}



// ======================================================================
// Function: DumpPlanets
// Address: 1108:86e4
// Segment: MEMORY_REPORT
// ======================================================================


void DumpPlanets(void)

{
  short sVar1;
  char *pcVar2;
  ushort uVar3;
  undefined2 uVar4;
  StringId ids_00;
  char *pcVar5;
  PLANET *pPVar6;
  int iVar7;
  undefined2 unaff_SI;
  ushort unaff_DI;
  undefined2 uVar8;
  char *unaff_SS;
  long lVar9;
  ulong uVar10;
  short *psVar11;
  undefined2 in_stack_0000fdac;
  undefined2 in_stack_0000fdae;
  PART part;
  PART PStack_238;
  short cch;
  char *psz;
  short (*penvMemSav) [9];
  short fSilentSav;
  short fSuccess;
  short fOpen;
  short env [9];
  short i;
  short j;
  char szForm [256];
  char szFile [256];
  PLANET *lppl;
  short ids;
  PLANET *lpplMac;
  
  fSilentSav = fFileErrSilent;
  fSuccess = 1;
  fOpen = 0;
  if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
    fSuccess = 0;
  }
  else {
    penvMemSav = penvMem;
    penvMem = &env;
    sVar1 = __setjmp(env);
    if (sVar1 == 0) {
      fFileErrSilent = 1;
      if (((uint)gd.wFlags >> 5 & 1) == 0) {
        _WSPRINTF((LPSTR)0x56a21120,(LPCSTR)CONCAT22((char *)s__s_pla_1120_165c,unaff_SS),szFile);
      }
      else {
        _WSPRINTF((LPSTR)0x56a21120,(LPCSTR)CONCAT22((char *)s__s_p_d_1120_1655,unaff_SS),szFile);
      }
      StreamOpen(szFile,0x1012);
      fOpen = 1;
      j = ((uint)gd.wFlags >> 5 & 1) + 2;
      for (i = 0; i < j; i = i + 1) {
        cch = CchGetString(i + idsPlanetNameOwnerStarbaseTypeReportAge,szForm);
        for (psz = szForm; *psz != '\0'; psz = psz + 1) {
          if (*psz == '*') {
            *psz = '\t';
          }
        }
        RgToStream((char *)CONCAT22(unaff_SS,szForm),cch);
        if (i == j + -1) {
          RgToStream(szCRLF,2);
        }
      }
      PStack_238.pcom = (COMPART *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
      pPVar6 = (PLANET *)lpPlanets + cPlanet;
      lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
      while ((PLANET *)lppl < pPVar6) {
        pcVar2 = PszGetCompressedPlanet(((short *)rgidPlan)[lppl->id]);
        _strcpy(szForm,pcVar2);
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        szForm[0] = '\t';
        uVar8 = (undefined2)((ulong)lppl >> 0x10);
        if (((PLANET *)lppl)->iPlayer == -1) {
          RgToStream((char *)CONCAT22(unaff_SS,szForm),1);
        }
        else {
          pcVar2 = PszPlayerName(((PLANET *)lppl)->iPlayer,1,0,0,0,(PLAYER *)0x0);
          _strcpy(szForm + 1,pcVar2);
          uVar3 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        }
        if ((((PLANET *)lppl)->iPlayer == -1) || (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0)) {
          cch = 1;
        }
        else {
          iVar7 = ((PLANET *)lppl)->iPlayer * 4;
          __fstrcpy((char *)CONCAT22(unaff_SS,szForm + 1),
                            (char *)CONCAT22(*(undefined2 *)(iVar7 + 0x14e),
                                             (char *)(*(int *)(iVar7 + 0x14c) +
                                                      (*(uint *)&((PLANET *)lppl)->field11_0x2c &
                                                      0xf) * 0x93 + 8)));
          cch = _strlen(szForm);
        }
        RgToStream((char *)CONCAT22(unaff_SS,szForm),cch);
        __itoa(game.turn - ((PLANET *)lppl)->turn,szForm + 1,10);
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        szForm[1] = '\0';
        if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
          psVar11 = (short *)0x0;
          uVar10 = __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe),
                                              (int)((PLANET *)lppl)->rgwtMin[3]),100);
          pcVar2 = PszFromLong(uVar10,psVar11);
          _strcpy(szForm + 1,pcVar2);
        }
        else if ((((PLANET *)lppl)->iPlayer != -1) && (2 < (((PLANET *)lppl)->wFlags & 0xffU))) {
          PStack_238.pcom =
               (COMPART *)__aFulmul((ulong)(((PLANET *)lppl)->uGuesses & 0xfff),400);
          pcVar2 = PszFromLong((long)PStack_238.pcom,(short *)0x0);
          _strcpy(szForm + 1,pcVar2);
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        if ((((PLANET *)lppl)->wFlags & 0xffU) < 3) {
          szForm[1] = '\0';
        }
        else {
          i = PctPlanetDesirability(lppl,idPlayer);
          _WSPRINTF((LPSTR)CONCAT22(i,(char *)&DAT_1120_1120),
                    (LPCSTR)CONCAT22(PCTDPCTPCT,unaff_SS),szForm + 1);
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        szForm[1] = '\0';
        if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
          FillPlanetProdLB(0,(PLPROD *)0x0,lppl);
          _strcpy(szForm + 1,(char *)szWork);
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
          CalcPctSurvive(lppl,(float *)&PStack_238.pcom,(float *)0x0);
          PStack_238.pcom = (COMPART *)(DAT_1120_1e0a - (float)PStack_238.pcom);
          part.pcom._0_2_ = (COMPART *)((int)(ulong *)rgcrPlrHistory + 0x36);
          part.pcom._2_2_ = 0;
          __ftol((double)CONCAT26(in_stack_0000fdae,
                                          CONCAT24(in_stack_0000fdac,CONCAT22(unaff_SI,unaff_DI))));
          lVar9 = __ftol((double)CONCAT26(in_stack_0000fdae,
                                                  CONCAT24(in_stack_0000fdac,
                                                           CONCAT22(unaff_SI,unaff_DI))));
          uVar4 = (undefined2)lVar9;
          in_stack_0000fdac = 100;
          in_stack_0000fdae = 0;
          lVar9 = __ftol((double)CONCAT26(100,CONCAT24(unaff_SI,CONCAT22(unaff_DI,uVar4))));
          uVar3 = (ushort)lVar9;
          uVar10 = __aFulshr(CONCAT22(uVar4,uVar3),unaff_DI);
          uVar10 = __aFulshr((ulong)((uint)uVar10 & 0xfff),uVar3);
          _WSPRINTF((LPSTR)((ulong)CONCAT22((int)uVar10,(undefined1 *)&DAT_1120_1120) & 0xfffffff),
                    (LPCSTR)CONCAT22((char *)s__ld__ld__d__d___1120_1663,unaff_SS),szForm + 1);
        }
        else {
          szForm[2] = '\t';
          szForm[1] = '\t';
          szForm[3] = '\0';
          if ((((uint)gd.wFlags >> 5 & 1) != 0) &&
             ((uint)((PLANET *)lppl)->uGuesses >> 0xc != 0)) {
            cch = _WSPRINTF((LPSTR)CONCAT22(((uint)((PLANET *)lppl)->uGuesses >> 0xc) * 6 + 3,
                                            (char *)&DAT_1120_1120),
                            (LPCSTR)CONCAT22((undefined *)&DAT_1120_1673,unaff_SS),szForm + 3);
            szForm[cch + 3] = '\0';
          }
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        szForm[1] = '\0';
        for (i = 0; i < 3; i = i + 1) {
          if (2 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            pcVar2 = PszFromLong
                               (CONCAT22(*(undefined2 *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2),
                                         (int)((PLANET *)lppl)->rgwtMin[i]),(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
          }
          uVar3 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        }
        szForm[1] = '\0';
        for (i = 0; i < 3; i = i + 1) {
          if (3 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            EstMineralsMined(lppl,(long *)&part,-1,0);
            pcVar2 = PszFromLong
                               (CONCAT22((&part.hs)[i].wFlags,(&part.hs + i)->grhst),(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
          }
          uVar3 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        }
        szForm[1] = '\0';
        for (i = 0; i < 3; i = i + 1) {
          if (2 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            pcVar2 = PszFromInt((uint)((PLANET *)lppl)->rgMinConc[i],(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
          }
          uVar3 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        }
        if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
          psVar11 = (short *)0x0;
          sVar1 = CResourcesAtPlanet(lppl,idPlayer);
          pcVar2 = PszFromInt(sVar1,psVar11);
          _strcpy(szForm + 1,pcVar2);
        }
        else {
          szForm[1] = '\0';
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
        if (((uint)gd.wFlags >> 5 & 1) != 0) {
          if ((((PLANET *)lppl)->wFlags & 0xffU) < 3) {
            szForm[1] = '\0';
            for (i = 0; i < 7; i = i + 1) {
              RgToStream((char *)CONCAT22(unaff_SS,szForm),1);
            }
          }
          else {
            for (i = 0; i < 3; i = i + 1) {
              pcVar2 = PszCalcEnvVar(i,(int)((PLANET *)lppl)->rgEnvVar[i]);
              _strcpy(szForm + 1,pcVar2);
              uVar3 = _strlen(szForm);
              RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            }
            for (i = 0; i < 3; i = i + 1) {
              pcVar2 = PszCalcEnvVar(i,(int)((PLANET *)lppl)->rgEnvVarOrig[i]);
              _strcpy(szForm + 1,pcVar2);
              uVar3 = _strlen(szForm);
              RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            }
            psVar11 = (short *)0x0;
            sVar1 = PctPlanetOptValue(lppl,idPlayer);
            pcVar2 = PszFromInt(sVar1,psVar11);
            _strcpy(szForm + 1,pcVar2);
            _strcat(szForm + 1,(char *)&DAT_1120_1678);
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
          }
          if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
            psVar11 = (short *)0x0;
            sVar1 = PctPlanetCapacity(lppl);
            pcVar2 = PszFromInt(sVar1,psVar11);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            psVar11 = (short *)0x0;
            sVar1 = GetPlanetScannerRange(lppl,&i);
            pcVar2 = PszFromInt(sVar1,psVar11);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            pcVar2 = PszFromInt(i,(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            if ((((PLANET *)lppl)->wFlags & 0x3ffU) == 0) {
              i = 0;
              szForm[1] = '\0';
            }
            else {
              i = ((uint)((PLANET *)lppl)->wFlags >> 10 & 0xf) + 4;
              pcVar2 = PszGetPlanetName((((PLANET *)lppl)->wFlags & 0x3ffU) - 1);
              _strcpy(szForm + 1,pcVar2);
            }
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            pcVar2 = PszFromInt(i,(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            if ((((PLANET *)lppl)->wRouting & 0x3ffU) == 0) {
              szForm[1] = '\0';
            }
            else {
              pcVar2 = PszGetPlanetName((((PLANET *)lppl)->wRouting & 0x3ffU) - 1);
              _strcpy(szForm + 1,pcVar2);
            }
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
            if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
              i = -1;
            }
            else {
              i = IStargateFromLppl(lppl);
              if (i != 0xffff) {
                PStack_238.hs.grhst = hstSpecialSB;
                PStack_238.hs.wFlags = PStack_238.hs.wFlags & 0xff00U | i & 0xffU;
                FLookupPart(&PStack_238);
                pcVar2 = PszFromInt(*(short *)((int)&((PLANET *)PStack_238.pcom)->lpplprod
                                                       + 2),(short *)0x0);
                _strcpy(szForm + 1,pcVar2);
                uVar3 = _strlen(szForm);
                RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
                pcVar2 = PszFromInt(*(short *)&((PLANET *)PStack_238.pcom)->lpplprod,
                                             (short *)0x0);
                _strcpy(szForm + 1,pcVar2);
                uVar3 = _strlen(szForm);
                RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
              }
            }
            if (i == -1) {
              RgToStream(&DAT_1120_167a,4);
            }
            if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
              i = 0;
            }
            else {
              i = *(uint *)&((PLANET *)lppl)->field11_0x2c >> 4;
            }
            pcVar2 = PszFromInt(i,(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar3);
          }
        }
        RgToStream(szCRLF,2);
        lppl = (PLANET *)CONCAT22(uVar8,(PLANET *)lppl + 1);
      }
      StreamClose();
    }
    else {
      if (fOpen != 0) {
        StreamClose();
      }
      fFileErrSilent = fSilentSav;
      fSuccess = 0;
      penvMem = penvMemSav;
    }
  }
  if (fSuccess == 0) {
    ids_00 = idsUnableWritePlanetInformationSOperationTerminated;
  }
  else {
    ids_00 = idsKnownPlanetInformationHasSuccessfullyWrittenS;
  }
  pcVar2 = szFile;
  pcVar5 = PszGetCompressedString(ids_00);
  _WSPRINTF((LPSTR)CONCAT22(pcVar2,(char *)&DAT_1120_1120),
            (LPCSTR)CONCAT22(pcVar5,(char *)&DAT_1120_1120),(char *)szWork);
  if (fSuccess == 0) {
    AlertSz((char *)szWork,0x10);
  }
  else {
    AlertSz((char *)szWork,0x40);
  }
  fFileErrSilent = fSilentSav;
  penvMem = penvMemSav;
  return;
}



// ======================================================================
// Function: DumpFleets
// Address: 1108:9530
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x110895a6) */

void DumpFleets(void)

{
  bool bVar1;
  short (*pasVar2) [9];
  short sVar3;
  short sVar4;
  ushort uVar5;
  char *pcVar6;
  short i_00;
  StringId ids_00;
  char *pcVar7;
  FLEET *pFVar8;
  uint uVar9;
  int iVar10;
  undefined2 uVar11;
  char *unaff_SS;
  bool bVar12;
  long lVar13;
  HULDEF *pHVar14;
  short *psVar15;
  long l;
  short cch;
  char *psz;
  short (*penvMemSav) [9];
  short fSilentSav;
  short fSuccess;
  short fOpen;
  short env [9];
  short i;
  short j;
  FLEET *lpfl;
  short ifl;
  char szForm [256];
  char szFile [256];
  short ids;
  short iplr;
  
  sVar3 = fFileErrSilent;
  pasVar2 = penvMem;
  bVar1 = true;
  if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
    bVar1 = false;
    penvMem = pasVar2;
    fFileErrSilent = sVar3;
  }
  else {
    penvMemSav = penvMem;
    penvMem = &env;
    sVar4 = __setjmp(env);
    if (sVar4 == 0) {
      fFileErrSilent = 1;
      if (((uint)gd.wFlags >> 5 & 1) == 0) {
        _WSPRINTF((LPSTR)0x56a21120,(LPCSTR)CONCAT22((char *)s__s_fle_1120_1686,unaff_SS),szFile);
      }
      else {
        _WSPRINTF((LPSTR)0x56a21120,(LPCSTR)CONCAT22((char *)s__s_f_d_1120_167f,unaff_SS),szFile);
      }
      StreamOpen(szFile,0x1012);
      j = ((uint)gd.wFlags >> 5 & 1) + 2;
      for (i = 0; sVar4 = idPlayer, i < j; i = i + 1) {
        uVar5 = CchGetString(i + idsFleetNameXYPlanetDestinationBattle,szForm);
        for (psz = szForm; *psz != '\0'; psz = psz + 1) {
          if (*psz == '*') {
            *psz = '\t';
          }
        }
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
        if (i == j + -1) {
          RgToStream(szCRLF,2);
        }
      }
      for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar8 = ((FLEET **)rglpfl)[ifl];
        iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar10,pFVar8);
        if ((pFVar8 == (FLEET *)0x0) && (iVar10 == 0)) break;
        idPlayer = -1;
        pcVar6 = PszGetFleetName(lpfl->id);
        idPlayer = sVar4;
        uVar5 = _strlen(pcVar6);
        RgToStream((char *)CONCAT22((undefined1 *)&DAT_1120_1120,pcVar6),uVar5);
        szForm[0] = '\t';
        pcVar6 = PszFromInt((&((FLEET *)lpfl)->pt)->x,(short *)0x0);
        _strcpy(szForm + 1,pcVar6);
        uVar5 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
        pcVar6 = PszFromInt((((FLEET *)lpfl)->pt).y,(short *)0x0);
        _strcpy(szForm + 1,pcVar6);
        uVar5 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
        uVar11 = (undefined2)((ulong)lpfl >> 0x10);
        if (((FLEET *)lpfl)->idPlanet == -1) {
          cch = 1;
        }
        else {
          pcVar6 = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(pcVar6);
          cch = uVar5 + 1;
        }
        RgToStream((char *)CONCAT22(unaff_SS,szForm),cch);
        uVar11 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar8 = (FLEET *)lpfl;
        if ((pFVar8->wFlags & 0xffU) == 7) {
          pcVar6 = PszGetDestName(lpfl,0);
          _strcpy(szForm + 1,pcVar6);
        }
        else if (((((uint)gd.wFlags >> 5 & 1) == 0) || (6 < (pFVar8->wFlags & 0xffU))) ||
                (((uint)pFVar8->wFlags >> 4 & 1) == 0)) {
          szForm[1] = '\0';
        }
        else {
          pcVar6 = PszFromInt(*(uint *)&pFVar8->field17_0x74 & 0xff,(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          _strcat(szForm,(char *)&DAT_1120_168d);
          pcVar6 = PszFromInt(*(uint *)&((FLEET *)lpfl)->field17_0x74 >> 8,(short *)0x0);
          _strcat(szForm,pcVar6);
        }
        uVar5 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
        uVar9 = (uint)lpfl->id >> 9 & 0xf;
        if ((((BTLPLAN **)rglpbtlplan)[uVar9 * 2] == (BTLPLAN *)0x0) &&
           (((undefined2 *)&DAT_1120_593a)[uVar9 * 2] == 0)) {
          szForm[1] = '\0';
        }
        else {
          uVar9 = (uint)lpfl->id >> 9 & 0xf;
          __fstrcpy((char *)CONCAT22(unaff_SS,szForm + 1),
                            (char *)CONCAT22(((undefined2 *)&DAT_1120_593a)[uVar9 * 2],
                                             ((BTLPLAN **)rglpbtlplan)[uVar9 * 2]
                                             [((FLEET *)lpfl)->iplan].szName));
        }
        uVar5 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
        l._0_2_ = 0;
        l._2_2_ = 0;
        for (i = 0; i < 0x10; i = i + 1) {
          uVar9 = ((FLEET *)lpfl)->rgcsh[i];
          bVar12 = CARRY2((uint)l,uVar9);
          l._0_2_ = (uint)l + uVar9;
          l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar12;
        }
        pcVar6 = PszFromLong(CONCAT22(l._2_2_,(uint)l),(short *)0x0);
        _strcpy(szForm + 1,pcVar6);
        uVar5 = _strlen(szForm);
        RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
        i = 0;
        while( true ) {
          if (4 < i) break;
          pcVar6 = PszFromLong
                             (CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2),
                                       (int)((FLEET *)lpfl)->rgwtMin[i]),(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          i = i + 1;
        }
        if (((uint)gd.wFlags >> 5 & 1) != 0) {
          pcVar6 = PszFromInt(((FLEET *)lpfl)->iPlayer + 1,(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          if (((FLEET *)lpfl)->cord < 2) {
            szForm[1] = '0';
            szForm[2] = '\0';
          }
          else {
            pcVar6 = PszGetETA(0,lpfl,(short *)0x0);
            _strcpy(szForm + 1,pcVar6);
          }
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          uVar11 = (undefined2)((ulong)lpfl >> 0x10);
          pFVar8 = (FLEET *)lpfl;
          if (pFVar8->cord < 2) {
            if (((pFVar8->wFlags & 0xffU) < 7) && (((uint)pFVar8->wFlags >> 4 & 1) != 0)) {
              i = pFVar8->wFlags & 0xf;
            }
            else {
              i = 0;
            }
          }
          else {
            i = (uint)((PLORD *)pFVar8->lpplord + 7)->wFlags >> 4 & 0xf;
          }
          pcVar6 = PszFromInt(i,(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          psVar15 = (short *)0x0;
          lVar13 = WtFromLpfl(lpfl);
          pcVar6 = PszFromLong(lVar13,psVar15);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          psVar15 = (short *)0x0;
          i_00 = PctCloakFromLpfl(lpfl);
          pcVar6 = PszFromInt(i_00,psVar15);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          j = GetFleetScannerRange(lpfl,&i,(short *)0x0,(short *)0x0);
          if (j == -1) {
            j = 0;
          }
          pcVar6 = PszFromInt(j,(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          pcVar6 = PszFromInt(i,(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          if ((((FLEET *)lpfl)->wFlags & 0xffU) == 7) {
            pcVar6 = PszGetTaskName(lpfl,&i);
            _strcpy(szForm + 1,pcVar6);
          }
          else {
            szForm[1] = '\0';
          }
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          psVar15 = (short *)0x0;
          lVar13 = CMineFromLpfl(lpfl);
          pcVar6 = PszFromLong(lVar13,psVar15);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          psVar15 = (short *)0x0;
          lVar13 = CMineSweepFromLpfl(lpfl);
          pcVar6 = PszFromLong(lVar13,psVar15);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          psVar15 = (short *)0x0;
          lVar13 = CLayMinesFromLpfl(lpfl,-1,-1);
          pcVar6 = PszFromLong(lVar13,psVar15);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          psVar15 = (short *)0x0;
          lVar13 = PctTerraFromLpfl(lpfl);
          pcVar6 = PszFromLong(lVar13,psVar15);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          l._0_2_ = 0;
          l._2_2_ = 0;
          for (i = 0; i < 0x10; i = i + 1) {
            if (((FLEET *)lpfl)->rgcsh[i] != 0) {
              iVar10 = ((FLEET *)lpfl)->iPlayer * 4;
              pHVar14 = LphuldefFromId(*(HullDef *)(*(int *)(iVar10 + 0xfe) + i * 0x93));
              j = (uint)((HULDEF *)pHVar14)->wFlags >> 10 & 0xf;
              if (((uint)j < 2) || (5 < (uint)j)) {
                uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                bVar12 = CARRY2((uint)l,uVar9);
                l._0_2_ = (uint)l + uVar9;
                l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar12;
              }
            }
          }
          pcVar6 = PszFromLong(CONCAT22(l._2_2_,(uint)l),(short *)0x0);
          _strcpy(szForm + 1,pcVar6);
          uVar5 = _strlen(szForm);
          RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          for (j = 2; j < 6; j = j + 1) {
            l._0_2_ = 0;
            l._2_2_ = 0;
            for (i = 0; i < 0x10; i = i + 1) {
              if ((((FLEET *)lpfl)->rgcsh[i] != 0) &&
                 (iVar10 = ((FLEET *)lpfl)->iPlayer * 4,
                 pHVar14 = LphuldefFromId(*(HullDef *)(*(int *)(iVar10 + 0xfe) + i * 0x93)),
                 ((uint)((HULDEF *)pHVar14)->wFlags >> 10 & 0xf) == j)) {
                uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                bVar12 = CARRY2((uint)l,uVar9);
                l._0_2_ = (uint)l + uVar9;
                l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar12;
              }
            }
            pcVar6 = PszFromLong(CONCAT22(l._2_2_,(uint)l),(short *)0x0);
            _strcpy(szForm + 1,pcVar6);
            uVar5 = _strlen(szForm);
            RgToStream((char *)CONCAT22(unaff_SS,szForm),uVar5);
          }
        }
        RgToStream(szCRLF,2);
      }
      StreamClose();
    }
    else {
      bVar1 = false;
      penvMem = pasVar2;
      fFileErrSilent = sVar3;
    }
  }
  if (bVar1) {
    ids_00 = idsKnownFleetInformationHasSuccessfullyWrittenS;
  }
  else {
    ids_00 = idsUnableWriteFleetInformationSOperationTerminated;
  }
  pcVar6 = szFile;
  pcVar7 = PszGetCompressedString(ids_00);
  _WSPRINTF((LPSTR)CONCAT22(pcVar6,(char *)&DAT_1120_1120),
            (LPCSTR)CONCAT22(pcVar7,(char *)&DAT_1120_1120),(char *)szWork);
  if (bVar1) {
    AlertSz((char *)szWork,0x40);
  }
  else {
    AlertSz((char *)szWork,0x10);
  }
  fFileErrSilent = sVar3;
  penvMem = penvMemSav;
  return;
}



// ======================================================================
// Function: PrintMapDlg
// Address: 1108:a1c2
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: hwndEdit_2 */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short PrintMapDlg(HWND hwnd,ushort msg,ushort wParam,long lParam)

{
  HWND HVar1;
  char *sz;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar2;
  short mbType;
  HWND hwndEdit_2;
  RECT rc;
  short i;
  
  if (msg == 0x14) {
    GetClientRect(hwnd,(undefined2 *)CONCAT22(unaff_SS,&rc));
    FillRect(wParam,(undefined2 *)CONCAT22(unaff_SS,&rc),hbrButtonFace);
    return 1;
  }
  if (msg == 0x19) {
    uVar2 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),hwndEdit_2);
    if ((int)uVar2 == 6) {
      SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
      return hbrButtonFace;
    }
  }
  else {
    if (msg == 0x110) {
      for (i = 0; i < 2; i = i + 1) {
        HVar1 = GetDlgItem(hwnd,i + 0x10c);
        SendMessage(HVar1,0x415,1,0);
        SendMessage(HVar1,0x30,rghfontArial8[1],0);
        szWork[0] = (char)((short *)vrgcPrintMapPage)[i] + '0';
        szWork[1] = '\0';
        SetWindowText(HVar1,szWork);
      }
      StickyDlgPos(hwnd,(POINT *)&ptStickyPrintMapDlg,1);
      return 1;
    }
    if (msg == 0x111) {
      if ((wParam == 1) || (wParam == 2)) {
        if (wParam == 1) {
          for (i = 0; i < 2; i = i + 1) {
            HVar1 = GetDlgItem(hwnd,i + 0x10c);
            GetWindowText(HVar1,szWork,10);
            if ((((szWork[0] == '\0') || (szWork[1] != '\0')) ||
                (szWork[0] < '1')) || ('9' < szWork[0])) {
              mbType = 0x10;
              sz = PszFormatIds(idsMustSpecifyNumberBetween19,(short *)0x0);
              AlertSz(sz,mbType);
              SetFocus(HVar1);
              break;
            }
            ((short *)vrgcPrintMapPage)[i] = szWork[0] + -0x30;
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyPrintMapDlg,0);
        EndDialog(hwnd,(uint)(wParam == 1));
        return 1;
      }
      if (wParam == 0x76) {
        WinHelp(hwnd,(LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,_szHelpFile),1,0xc3c);
        return 1;
      }
      if (((wParam == 0x10c) || (wParam == 0x10d)) &&
         (uVar2 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),hwndEdit_2), (int)uVar2 == 0x400)) {
        GetWindowText((HWND)lParam,szWork,10);
        if ((szWork[0] != '\0') &&
           ((szWork[0] < '1' || ('9' < szWork[0])))) {
          MessageBeep(0);
          SetWindowText((HWND)lParam,szWork + 1);
        }
      }
    }
  }
  return 0;
}



