// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
//

// ======================================================================
// Function: ReportDlg
// Address: 1108:0018
// Segment: MEMORY_REPORT
// ======================================================================

long ReportDlg(HWND hwnd, WMType msg, ushort wParam, long lParam)

{
    int        iVar1;
    bool       bVar2;
    POINT      pt;
    POINT      pt_00;
    HDC        HVar3;
    HWND       HVar4;
    short      sVar5;
    ushort     uVar6;
    RECT      *pRVar7;
    ushort     unaff_SI;
    undefined2 unaff_DI;
    undefined2 uVar8;
    undefined2 unaff_SS;
    ulong      uVar9;
    LRESULT    LVar10;
    ushort     in_stack_0000ffd0;
    RECT       local_2c;
    int        local_20;
    int        local_1e;
    int        local_1c;
    int        local_1a;
    uint       local_18;
    int        local_16;
    int        local_14;
    UINT       local_12;
    RECT       rc;
    HMENU      hmenu;
    HDC        hdc;

    uVar8 = 0x1108;
    pRVar7 = &stack0xffcc;
    if (msg == WM_CREATE) {
        hwndReportDlg = hwnd;
        HVar3 = GetDC(hwnd);
        SelectObject(HVar3, rghfontArial8[1]);
        for (local_12 = 0; (int)local_12 < vprptCur->cFields; local_12 = local_12 + 1) {
            local_14 = DxReportColHdr(vprptCur->irpt, local_12, (char *)szWork, HVar3);
            vprptCur->rgbdx[local_12] = (byte)(local_14 / 2);
        }
        ReleaseDC(hwnd, HVar3);
        SortReportCache(vprptCur->irpt, vprptCur->icolSort);
        SetWindowPos(hwnd, 0, 0, 0, (&vprptCur->ptSize)->x, (vprptCur->ptSize).y, 0xe);
        StickyDlgPos(hwnd, &vprptCur->ptDlg, 1);
        HVar4 = CreateWindow("SCROLLBAR", 0, 0x40000001, 0, 0, 0x32, 0x32, hwnd, 0, hInst, 0);
        vprptCur->hwndVScroll = HVar4;
        uVar8 = 0x14f8;
        HVar4 = CreateWindow("SCROLLBAR", 0, 0x40000000, 0, 0, 0x32, 0x32, hwnd, 0, hInst, 0);
        pRVar7 = &local_2c;
        vprptCur->hwndHScroll = HVar4;
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
            uVar8 = 0x10f8;
            AdvanceTutor();
            pRVar7 = &local_2c;
        }
    LAB_1108_019b:
        *(HWND *)((int)pRVar7 + -2) = hwnd;
        *(undefined2 *)((int)pRVar7 + -4) = unaff_SS;
        *(int *)((int)pRVar7 + -6) = (int)&rc;
        *(undefined2 *)((int)pRVar7 + -8) = uVar8;
        *(undefined2 *)((int)pRVar7 + -10) = 0x1aa;
        GetClientRect(*(HWND *)((int)pRVar7 + -2), (RECT *)*(undefined4 *)((int)pRVar7 + -6));
        sVar5 = (rc.bottom + -0x24) / (dyArial8 + 4);
        local_14 = sVar5;
        if (vprptCur->cRows <= sVar5) {
            sVar5 = vprptCur->cRows;
        }
        vprptCur->cRowsVis = sVar5;
        if (vprptCur->cRowsVis < vprptCur->cRows) {
            local_12._0_1_ = 0x44;
            local_12._1_1_ = 0;
            if (((vprptCur->cRows < vprptCur->irowFirst + vprptCur->cRowsVis) && (0 < vprptCur->irowFirst)) &&
                (vprptCur->irowFirst = vprptCur->cRows - vprptCur->cRowsVis, vprptCur->irowFirst < 0)) {
                vprptCur->irowFirst = 0;
            }
            *(ushort *)((int)pRVar7 + -2) = vprptCur->hwndVScroll;
            *(undefined2 *)((int)pRVar7 + -4) = 2;
            *(short *)((int)pRVar7 + -6) = vprptCur->irowFirst;
            *(undefined2 *)((int)pRVar7 + -8) = 0;
            *(undefined2 *)((int)pRVar7 + -10) = 0x14f8;
            *(undefined2 *)((int)pRVar7 + -0xc) = 0x28e;
            SetScrollPos(*(HWND *)((int)pRVar7 + -2), *(short *)((int)pRVar7 + -4), *(short *)((int)pRVar7 + -6), *(BOOL *)((int)pRVar7 + -8));
            *(ushort *)((int)pRVar7 + -2) = vprptCur->hwndVScroll;
            *(undefined2 *)((int)pRVar7 + -4) = 2;
            *(undefined2 *)((int)pRVar7 + -6) = 0;
            *(int *)((int)pRVar7 + -8) = vprptCur->cRows - vprptCur->cRowsVis;
            *(undefined2 *)((int)pRVar7 + -10) = 1;
            *(undefined2 *)((int)pRVar7 + -0xc) = 0x14f8;
            *(undefined2 *)((int)pRVar7 + -0xe) = 0x2b5;
            SetScrollRange(*(HWND *)((int)pRVar7 + -2), *(short *)((int)pRVar7 + -4), *(short *)((int)pRVar7 + -6), *(short *)((int)pRVar7 + -8),
                           *(BOOL *)((int)pRVar7 + -10));
        } else {
            local_12._0_1_ = 0x84;
            local_12._1_1_ = 0;
            vprptCur->irowFirst = 0;
            *(ushort *)((int)pRVar7 + -2) = vprptCur->hwndVScroll;
            *(undefined2 *)((int)pRVar7 + -4) = 2;
            *(undefined2 *)((int)pRVar7 + -6) = 0;
            *(undefined2 *)((int)pRVar7 + -8) = 0;
            *(undefined2 *)((int)pRVar7 + -10) = 0x14f8;
            *(undefined2 *)((int)pRVar7 + -0xc) = 0x219;
            SetScrollPos(*(HWND *)((int)pRVar7 + -2), *(short *)((int)pRVar7 + -4), *(short *)((int)pRVar7 + -6), *(BOOL *)((int)pRVar7 + -8));
        }
        *(undefined2 *)((int)pRVar7 + -2) = 2;
        *(undefined2 *)((int)pRVar7 + -4) = 0x14f8;
        *(undefined2 *)((int)pRVar7 + -6) = 0x2be;
        local_16 = GetSystemMetrics(*(short *)((int)pRVar7 + -2));
        *(ushort *)((int)pRVar7 + -4) = vprptCur->hwndVScroll;
        *(undefined2 *)((int)pRVar7 + -6) = 0;
        *(int *)((int)pRVar7 + -8) = rc.right - local_16;
        *(int *)((int)pRVar7 + -10) = dyArial8 + 6;
        *(int *)((int)pRVar7 + -0xc) = local_16;
        *(int *)((int)pRVar7 + -0xe) = (dyArial8 + 4) * vprptCur->cRowsVis + 1;
        *(UINT *)(byte *)((int)pRVar7 + -0x10) = local_12;
        *(undefined2 *)((int)pRVar7 + -0x12) = 0x14f8;
        *(undefined2 *)((int)pRVar7 + -0x14) = 0x2f6;
        SetWindowPos(*(HWND *)((int)pRVar7 + -4), *(HWND *)((int)pRVar7 + -6), *(short *)((int)pRVar7 + -8), *(short *)((int)pRVar7 + -10),
                     *(short *)((int)pRVar7 + -0xc), *(short *)((int)pRVar7 + -0xe), *(UINT *)((int)pRVar7 + -0x10));
        *(undefined2 *)((int)pRVar7 + -4) = 0x14f8;
        *(undefined2 *)((int)pRVar7 + -6) = 0x2fb;
        SetHScrollBar();
        return (ulong)(msg == WM_CREATE);
    }
    if (msg == WM_DESTROY) {
        StickyDlgPos(hwnd, &vprptCur->ptDlg, 0);
        GetWindowRect(hwnd, &rc);
        (&vprptCur->ptSize)->x = rc.right - rc.left;
        (vprptCur->ptSize).y = rc.bottom - rc.top;
        hwndReportDlg = 0;
        fBrowserValid = 0;
        uVar6 = GetASubMenu(hwndFrame, 4);
        iVar1 = vprptCur->irpt;
        if (iVar1 == 0) {
            local_12 = 0x8fd;
        } else if (iVar1 == 1) {
            local_12 = 0x8ff;
        } else if (iVar1 == 2) {
            local_12 = 0x900;
        } else if (iVar1 == 3) {
            local_12 = 0x901;
        }
        CheckMenuItem(uVar6, local_12, 0);
        vprptCur = 0;
        if (((uint)gd.grBits >> 0xb & 1) != 0) {
            AdvanceTutor();
        }
    } else {
        if (msg == WM_SIZE)
            goto LAB_1108_019b;
        if (msg == WM_PAINT) {
            HVar3 = BeginPaint(hwnd, &stack0xffd0);
            DrawReport(hwnd, HVar3, &local_2c);
            EndPaint(hwnd, &stack0xffd0);
            gd.grBits._2_2_ = gd.grBits._2_2_ & 0xfdff;
            return 1;
        }
        if (msg == WM_ERASEBKGND) {
            GetClientRect(hwnd, &rc);
            FillRect(wParam, &rc, hbrButtonFace);
            return 1;
        }
        if (msg == WM_GETMINMAXINFO) {
            *(undefined2 *)((int)lParam + 0xc) = 300;
            *(undefined2 *)((int)lParam + 0xe) = 0xdc;
            return 0;
        }
        if (msg == WM_COMMAND) {
            if (wParam == 2) {
                DestroyWindow(hwnd);
                return 1;
            }
        } else {
            if (msg == WM_HSCROLL) {
                uVar9 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ffd0);
                local_12 = GetScrollPos((HWND)uVar9, 2);
                local_14 = local_12;
                switch (wParam) {
                case 0:
                    local_14 = local_12 + -1;
                    break;
                case 1:
                    local_14 = local_12 + 1;
                    break;
                case 2:
                    local_14 = local_12 + -3;
                    break;
                case 3:
                    local_14 = local_12 + 3;
                    break;
                case 4:
                case 5:
                    local_14 = (int)lParam;
                    break;
                case 6:
                    local_14 = 0;
                    break;
                case 7:
                    local_14 = 2000;
                }
                if (vprptCur->cColScroll < local_14) {
                    local_14 = vprptCur->cColScroll;
                }
                if (local_14 < 0) {
                    local_14 = 0;
                }
                if (local_14 != local_12) {
                    uVar9 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ffd0);
                    SetScrollPos((HWND)uVar9, 2, local_14, 1);
                    uVar9 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ffd0);
                    local_14 = GetScrollPos((HWND)uVar9, 2);
                    if (local_14 != local_12) {
                        local_16 = 1;
                        local_18 = 2;
                        while ((local_16 < vprptCur->cFields && ((((local_18 & (uint)vprptCur->grbitVisible) == 0 &&
                                                                   (((int)local_18 >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) == 0)) ||
                                                                  (iVar1 = local_14 + -1, bVar2 = 0 < local_14, local_14 = iVar1, bVar2))))) {
                            local_16 = local_16 + 1;
                            local_18 = local_18 << 1;
                        }
                        vprptCur->cFieldFirst = local_16;
                        InvalidateRect(hwnd, 0, 1);
                        UpdateWindow(hwnd);
                    }
                }
                return 0;
            }
            if (msg == WM_VSCROLL) {
                uVar9 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ffd0);
                local_12 = GetScrollPos((HWND)uVar9, 2);
                local_14 = local_12;
                switch (wParam) {
                case 0:
                    local_14 = local_12 + -1;
                    break;
                case 1:
                    local_14 = local_12 + 1;
                    break;
                case 2:
                    local_14 = local_12 - (vprptCur->cRowsVis + -1);
                    break;
                case 3:
                    local_14 = local_12 + vprptCur->cRowsVis + -1;
                    break;
                case 4:
                case 5:
                    local_14 = (int)lParam;
                    break;
                case 6:
                    local_14 = 0;
                    break;
                case 7:
                    local_14 = 2000;
                }
                if (vprptCur->cRows - vprptCur->cRowsVis < local_14) {
                    local_14 = vprptCur->cRows - vprptCur->cRowsVis;
                }
                if (local_14 < 0) {
                    local_14 = 0;
                }
                if (local_14 != local_12) {
                    vprptCur->irowFirst = local_14;
                    GetClientRect(hwnd, &rc);
                    rc.left = 2;
                    uVar8 = 2;
                    sVar5 = GetSystemMetrics(2);
                    rc.right = rc.right - sVar5;
                    rc.top = dyArial8 + 6;
                    rc.bottom = (dyArial8 + 4) * vprptCur->cRowsVis + rc.top;
                    ScrollWindow(hwnd, 0, (dyArial8 + 4) * (local_12 - local_14), &rc, &rc);
                    uVar9 = __aFulshr(CONCAT22(unaff_DI, uVar8), unaff_SI);
                    SetScrollPos((HWND)uVar9, 2, local_14, 1);
                    UpdateWindow(hwnd);
                }
                return 0;
            }
            if (((msg == WM_LBUTTONDOWN) || (msg == WM_LBUTTONDBLCLK)) || (msg == WM_RBUTTONDOWN)) {
                local_1e = 2;
                local_14 = (int)lParam;
                uVar9 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ffd0);
                local_12 = (UINT)uVar9;
                if ((1 < (int)local_12) && (1 < local_14)) {
                    if ((int)local_12 < dyArial8 + 6) {
                        local_1c = -1;
                    } else {
                        local_20 = dyArial8 + 4;
                        local_1c = (int)((local_12 - 2) - local_20) / (dyArial8 + 4);
                        if (vprptCur->cRowsVis <= local_1c)
                            goto LAB_1108_09c8;
                        local_1c = local_1c + vprptCur->irowFirst;
                    }
                    local_1a = -1;
                    local_18 = 1;
                    for (local_16 = 0; local_16 < vprptCur->cFields; local_16 = local_16 + 1) {
                        if ((((local_18 & (uint)vprptCur->grbitVisible) != 0) || (((int)local_18 >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
                            (((local_16 == 0 || (vprptCur->cFieldFirst <= local_16)) &&
                              (local_1e = local_1e + (uint)vprptCur->rgbdx[local_16] * 2, local_14 < local_1e)))) {
                            local_1a = local_16;
                            break;
                        }
                        local_18 = local_18 << 1;
                    }
                    if (local_1a != -1) {
                        if (local_1c == -1) {
                            pt_00.y = local_12;
                            pt_00.x = local_14;
                            ReportColumnPopup(pt_00, local_1a, (uint)(msg == WM_RBUTTONDOWN));
                        } else {
                            pt.y = local_12;
                            pt.x = local_14;
                            ExecuteReportClick(pt, vprptCur->irpt, local_1a, local_1c);
                        }
                        if (((uint)gd.grBits >> 0xb & 1) != 0) {
                            AdvanceTutor();
                        }
                    }
                }
            }
        }
    }
LAB_1108_09c8:
    LVar10 = DefWindowProc(hwnd, msg, wParam, lParam);
    return LVar10;
}

// ======================================================================
// Function: SetHScrollBar
// Address: 1108:09e8
// Segment: MEMORY_REPORT
// ======================================================================

void SetHScrollBar(void)

{
    int        iVar1;
    short      sVar2;
    int        iVar3;
    short      sVar4;
    undefined2 unaff_SS;
    RECT       rc;
    short      xTitle;
    short      dx;
    short      xRight;
    short      ibit;
    short      i;
    short      ccolHidden;
    short      ccolSkipped;
    short      dy;
    ushort     swp;

    GetClientRect(hwndReportDlg, &rc);
    sVar2 = GetSystemMetrics(2);
    iVar3 = (uint)vprptCur->rgbdx[0] * 2 + 2;
    xRight = ((rc.right - iVar3) + -2) - sVar2;
    ccolSkipped = 0;
    ccolHidden = 0;
    ibit = 1 << ((byte)vprptCur->cFields & 0x1f);
    iVar1 = vprptCur->cFields;
    while (i = iVar1 + -1, 0 < i) {
        if (((ibit & (uint)vprptCur->grbitVisible) != 0) || ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) {
            if (i < vprptCur->cFieldFirst) {
                ccolSkipped = ccolSkipped + 1;
            }
            xRight = xRight + (uint)vprptCur->rgbdx[iVar1 + -1] * -2;
            if (xRight < 0) {
                ccolHidden = ccolHidden + 1;
            }
        }
        ibit = ibit >> 1;
        iVar1 = i;
    }
    vprptCur->cColScroll = 0;
    if (ccolHidden == 0) {
        swp = 0x84;
        vprptCur->cFieldFirst = 1;
        SetScrollPos(vprptCur->hwndHScroll, 2, 0, 0);
    } else {
        swp = 0x44;
        if (ccolHidden < ccolSkipped) {
            ccolSkipped = 0;
            vprptCur->cFieldFirst = 1;
        }
        SetScrollPos(vprptCur->hwndHScroll, 2, ccolSkipped, 0);
        SetScrollRange(vprptCur->hwndHScroll, 2, 0, ccolHidden, 1);
        vprptCur->cColScroll = ccolHidden;
    }
    sVar4 = GetSystemMetrics(3);
    SetWindowPos(vprptCur->hwndHScroll, 0, iVar3, dyArial8 + (dyArial8 + 4) * vprptCur->cRowsVis + 7, (rc.right - sVar2) - iVar3, sVar4, swp);
    return;
}

// ======================================================================
// Function: DrawReport
// Address: 1108:0bae
// Segment: MEMORY_REPORT
// ======================================================================

void DrawReport(HWND hwnd, HDC hdc, RECT *prc)

{
    byte       bVar1;
    short      sVar2;
    int        iVar3;
    ushort     uVar4;
    int        iVar5;
    undefined2 unaff_SS;
    LPCSTR     pcVar6;
    HDC        HVar7;
    RECT       rc;
    short      xCol;
    short      dx;
    short      ibit;
    short      yRow;
    short      i;
    short      j;
    short      irowLast;
    char       szTit[40];

    ibit = 1;
    xCol = 2;
    yRow = 2;
    SelectObject(hdc, rghfontArial8[1]);
    SetBkMode(hdc, 1);
    if (prc->top <= dyArial8 + 6) {
        for (i = 0; i < vprptCur->cFields; i = i + 1) {
            if ((((ibit & (uint)vprptCur->grbitVisible) != 0) || ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
                ((i == 0 || (vprptCur->cFieldFirst <= i)))) {
                sVar2 = DxReportColHdr(vprptCur->irpt, i, szTit, hdc);
                vprptCur->rgbdx[i] = (byte)(sVar2 / 2);
                SetRect(&rc, xCol, 2, xCol + sVar2 + -1, dyArial8 + 6);
                if ((gd.grBits._2_2_ >> 9 & 1) != 0) {
                    FillRect(hdc, &rc, hbrButtonFace);
                }
                if (i == 0) {
                    iVar5 = rc.left + 3;
                    iVar3 = rc.top + 2;
                    pcVar6 = szTit;
                    HVar7 = hdc;
                    uVar4 = _strlen(szTit);
                    TextOut(HVar7, iVar5, iVar3, pcVar6, uVar4);
                } else {
                    CtrTextOut(hdc, (rc.right - rc.left) / 2 + rc.left, rc.top + 2, szTit, 0);
                }
                Draw3dFrame(hdc, &rc, 0);
                xCol = xCol + sVar2;
            }
            ibit = ibit << 1;
        }
    }
    irowLast = vprptCur->irowFirst + vprptCur->cRowsVis;
    if (vprptCur->cRows < irowLast) {
        irowLast = vprptCur->cRows;
    }
    for (i = vprptCur->irowFirst; i < irowLast; i = i + 1) {
        yRow = yRow + dyArial8 + 4;
        xCol = 2;
        if ((prc->top <= yRow) && (yRow <= prc->bottom)) {
            SelectObject(hdc, hbrButtonShadow);
            PatBlt(hdc, 2, yRow, 1, dyArial8 + 4, 0xf00021);
        }
        ibit = 1;
        for (j = 0; j < vprptCur->cFields; j = j + 1) {
            if ((((ibit & (uint)vprptCur->grbitVisible) != 0) || ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
                ((j == 0 || (vprptCur->cFieldFirst <= j)))) {
                bVar1 = vprptCur->rgbdx[j];
                iVar5 = (uint)bVar1 * 2;
                if ((prc->top - (dyArial8 + 4) <= yRow) && (yRow <= prc->bottom)) {
                    SelectObject(hdc, hbrButtonShadow);
                    PatBlt(hdc, xCol + iVar5 + -1, yRow, 1, dyArial8 + 4, 0xf00021);
                    PatBlt(hdc, xCol, dyArial8 + 4 + yRow, (uint)bVar1 << 1, 1, 0xf00021);
                    SetRect(&rc, xCol + 2, yRow + 2, xCol + iVar5 + -3, dyArial8 + yRow + 3);
                    if ((gd.grBits._2_2_ >> 9 & 1) != 0) {
                        FillRect(hdc, &rc, hbrButtonFace);
                    }
                    DrawReportItem(hdc, &rc, vprptCur->irpt, i, j);
                }
                xCol = xCol + iVar5;
            }
            ibit = ibit << 1;
        }
    }
    return;
}

// ======================================================================
// Function: ScoreXDlg
// Address: 1108:0f66
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Variable defined which should be unmapped: cch */

short ScoreXDlg(HWND hwnd, WMType message, ushort wParam, long lParam)

{
    short      sVar1;
    short      sVar2;
    uint       uVar3;
    undefined2 unaff_SI;
    undefined2 unaff_DI;
    undefined2 unaff_SS;
    ulong      uVar4;
    ulong      uVar5;
    long      *rgids;
    char     **rgsz;
    short      cch;
    short      iSel;
    char      *psz;
    long       rgid[12];
    short      i;
    short      c;
    char      *rgszScan[20];
    short      cchHistory;
    char       local_36[6];
    undefined1 local_30[32];
    HDC        local_10;
    RECT       rc;
    short      sStack_6;

    uVar5 = CONCAT22(unaff_SI, unaff_DI);
    if (message == WM_PAINT) {
        local_10 = BeginPaint(hwnd, local_30);
        if (((uint)gd.grBits2 >> 0xb & 3) == 2) {
            DrawHistoryReport(local_10);
        } else if (((uint)gd.grBits2 >> 0xb & 3) == 0) {
            DrawScoreReport(local_10);
        } else {
            DrawVCReport(local_10);
        }
        EndPaint(hwnd, local_30);
        sVar1 = 1;
    } else if (message == WM_ERASEBKGND) {
        GetClientRect(hwnd, &rc);
        FillRect(wParam, &rc, hbrButtonFace);
        sVar1 = 1;
    } else {
        if (message == WM_SETCURSOR) {
            if (((uint)gd.grBits2 >> 0xb & 3) == 2) {
                GetCursorPos(local_30 + 0x1e);
                ScreenToClient(hwnd, local_30 + 0x1e);
                if (((int)local_10 < dyArial10 + dyArial8 + -2) && (2 < (int)local_10)) {
                    SetCursor(hcurHand);
                    return 1;
                }
            }
        } else {
            if (message == WM_INITDIALOG) {
                InitScoreDlg(hwnd, (uint)gd.grBits2 >> 0xb & 3);
                fInScoreDialog = 1;
                StickyDlgPos(hwnd, (POINT *)&ptStickyScoreXDlg, 1);
                hwndScoreXDlg = hwnd;
                if (((uint)gd.grBits >> 0xb & 1) != 0) {
                    AdvanceTutor();
                }
                return 1;
            }
            if (message == WM_COMMAND) {
                if (wParam == 2) {
                    StickyDlgPos(hwnd, (POINT *)&ptStickyScoreXDlg, 0);
                    EndDialog(hwnd, sStack_6);
                    fInScoreDialog = 0;
                    hwndScoreXDlg = 0;
                    if (((uint)gd.grBits >> 0xb & 1) != 0) {
                        AdvanceTutor();
                    }
                    return 1;
                }
                if (wParam == 0x76) {
                    WinHelp(hwnd, szHelpFile, 1, 0x455);
                    return 1;
                }
                if (wParam == 0xc6) {
                    local_10 = (((uint)gd.grBits2 >> 0xb & 3) + 1) % 3;
                    gd.grBits2._0_2_ = (uint)gd.grBits2 & 0xe7ff | local_10 << 0xb;
                    InvalidateRect(hwnd, 0, 1);
                    InitScoreDlg(hwnd, (uint)gd.grBits2 >> 0xb & 3);
                    if (((uint)gd.grBits >> 0xb & 1) != 0) {
                        AdvanceTutor();
                    }
                }
            } else if ((((message == WM_LBUTTONDOWN) || (message == WM_RBUTTONDOWN)) && (c = 0, ((uint)gd.grBits2 >> 0xb & 3) == 2)) &&
                       ((uVar4 = __aFulshr(uVar5, cch), 2 < (uint)uVar4 && (uVar5 = __aFulshr(uVar5, cch), (uint)uVar5 < (dyArial10 + dyArial8) - 2U)))) {
                sVar1 = CchGetString(idsHistory, local_36);
                for (i = 0; i < 8; i = i + 1) {
                    _strcpy((char *)szWork + i * 0x28, local_36);
                    sVar2 = CchGetString(i + idsPlanets, (char *)szWork + sVar1 + i * 0x28);
                    ((char *)szWork + sVar1 + i * 0x28)[sVar2 + -1] = '\0';
                    *(uint *)(rgid + c) = (uint)((gd.grBits2._2_2_ & 0xf) == i);
                    *(undefined2 *)((int)rgid + c * 4 + 2) = 0;
                    rgszScan[c] = (char *)szWork + i * 0x28;
                    c = c + 1;
                }
                sVar2 = 0;
                sVar1 = -2;
                rgsz = rgszScan;
                rgids = rgid;
                uVar5 = __aFulshr(CONCAT22(rgids, c), (ushort)rgsz);
                uVar3 = PopupMenu(hwnd, (short)lParam, (short)uVar5, c, rgids, rgsz, sVar1, sVar2);
                if (uVar3 != 0xffff) {
                    gd.grBits2._2_2_ = gd.grBits2._2_2_ & 0xfff0 | uVar3 & 0xf;
                    gd.grBits2._0_2_ = (uint)gd.grBits2 & 0xff7f | 0x80;
                    InvalidateRect(hwnd, 0, 1);
                }
            }
        }
        sVar1 = 0;
    }
    return sVar1;
}

// ======================================================================
// Function: InitScoreDlg
// Address: 1108:13b6
// Segment: MEMORY_REPORT
// ======================================================================

void InitScoreDlg(HWND hwnd, short fVictory)

{
    HDC        HVar1;
    char      *pcVar2;
    ushort     uVar3;
    HWND       HVar4;
    int        iVar5;
    undefined2 unaff_SS;
    DWORD      DVar6;
    DWORD      DVar7;
    undefined2 uVar8;
    HDC        HVar9;
    RECT       rc;
    short      dx;
    char      *psz;
    RECT       rcWindow;
    short      dxFrame;
    short      dyFrame;
    short      dy;
    short      dxDig;
    HDC        hdc;

    HVar1 = GetDC(hwnd);
    SelectObject(HVar1, rghfontArial8[1]);
    DVar6 = GetTextExtent(HVar1, s_9_1120_15e8, 1);
    if (fVictory == 2) {
        dx = 600;
        dy = 400;
    } else if (fVictory == 0) {
        pcVar2 = PszGetCompressedString(idsUnarmedShips2);
        uVar8 = 0x1120;
        HVar9 = HVar1;
        uVar3 = _strlen(pcVar2);
        DVar7 = GetTextExtent(HVar9, (LPCSTR)CONCAT22(uVar8, pcVar2), uVar3);
        vdxScoreX = (int)DVar7 + 8;
        iVar5 = game.cPlayer;
        if (game.cPlayer < 4) {
            iVar5 = 4;
        }
        dx = iVar5 * (int)DVar6 * 5 + vdxScoreX + 8;
        dy = (dyArial8 * 0x21) / 2 + 0x58;
    } else {
        pcVar2 = PszGetCompressedString(idsExceedsSecondPlaceScore);
        uVar8 = 0x1120;
        HVar9 = HVar1;
        uVar3 = _strlen(pcVar2);
        DVar7 = GetTextExtent(HVar9, (LPCSTR)CONCAT22(uVar8, pcVar2), uVar3);
        vdxScoreX = (int)(((long)(int)DVar7 * 3 & 0xffffU) / 2) + (int)DVar6 * 6;
        iVar5 = game.cPlayer;
        if (game.cPlayer < 4) {
            iVar5 = 4;
        }
        dx = (iVar5 * dyArial8 * 3) / 2 + vdxScoreX + 8;
        dy = (dyArial8 * 0x21) / 2 + 0x58;
    }
    ReleaseDC(hwnd, HVar1);
    GetWindowRect(hwnd, &rcWindow);
    GetClientRect(hwnd, &rc);
    SetWindowPos(hwnd, 0, 0, 0, ((rcWindow.right - rcWindow.left) - rc.right) + dx, ((rcWindow.bottom - rcWindow.top) - rc.bottom) + dy, 6);
    HVar4 = GetDlgItem(hwnd, IDCANCEL);
    GetWindowRect(HVar4, &rc);
    MapWindowPoints(0, hwnd, (POINT *)&rc, 2);
    OffsetRect(&rc, 0, (dy + -4) - rc.bottom);
    iVar5 = (dx + (rc.right - rc.left) * -3) / 4;
    HVar4 = GetDlgItem(hwnd, IDC_U16_0x00C6);
    SetWindowPos(HVar4, 0, iVar5, rc.top, 0, 0, 5);
    HVar4 = GetDlgItem(hwnd, IDCANCEL);
    SetWindowPos(HVar4, 0, iVar5 * 2 + (rc.right - rc.left), rc.top, 0, 0, 5);
    HVar4 = GetDlgItem(hwnd, IDC_HELP);
    SetWindowPos(HVar4, 0, iVar5 * 3 + (rc.right - rc.left) * 2, rc.top, 0, 0, 5);
    pcVar2 = PszGetCompressedString(fVictory + idsPlayerScores);
    SetWindowText(hwnd, pcVar2);
    return;
}

// ======================================================================
// Function: DrawVCReport
// Address: 1108:168e
// Segment: MEMORY_REPORT
// ======================================================================

void DrawVCReport(HDC hdc)

{
    char      *pcVar1;
    ushort     uVar2;
    HDC        HVar3;
    HGDIOBJ    HVar4;
    int        iVar5;
    int        iVar6;
    short      sVar7;
    short      sVar8;
    undefined2 unaff_SI;
    undefined2 unaff_DI;
    DWORD      DVar9;
    ulong      uVar10;
    long       lVar11;
    undefined2 uVar12;
    undefined2 uVar13;
    short      vcVal;
    short      idsT;
    long       l;
    short      xLeft;
    short      cch;
    HBITMAP    hbmpSav;
    char      *psz;
    short      iPass;
    short      i;
    short      j;
    HDC        hdcMem;
    short      cCur;
    COLORREF   cr;
    short      ids;
    short      cCurSav;
    POINT      pt;
    short      yTop;
    short      dxDig;
    short      xStart;
    short      grbitVC;

    yTop = 0x58;
    SetBkMode(hdc, 1);
    SelectObject(hdc, rghfontArial8[4]);
    xLeft = vdxScoreX;
    for (i = 0; i < game.cPlayer; i = i + 1) {
        pcVar1 = PszPlayerName(i, 1, 1, 1, 0, 0);
        uVar2 = _strlen(pcVar1);
        DVar9 = GetTextExtent(hdc, pcVar1, uVar2);
        lVar11 = __ftol((double)(ulonglong)CONCAT24((int)DVar9, CONCAT22(unaff_SI, unaff_DI)));
        if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) || ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) {
            if ((((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) {
                cr._0_2_ = 0;
                cr._2_2_ = 0;
            } else {
                cr._0_2_ = 0;
                cr._2_2_ = 0xff;
            }
        } else {
            cr._0_2_ = 0x7f7f;
            cr._2_2_ = 0x7f;
        }
        SetTextColor(hdc, CONCAT22(cr._2_2_, (undefined2)cr));
        TextOut(hdc, (xLeft - (int)lVar11) + (dyArial8 * 3) / 2, (-(dyArial8 / 2) - (int)lVar11) + 0x54, pcVar1, uVar2);
        xLeft = xLeft + (dyArial8 * 3) / 2;
    }
    SelectObject(hdc, rghfontArial8[1]);
    SelectObject(hdc, hbrButtonShadow);
    GetTextExtent(hdc, s_9_1120_15ea, 1);
    ids = 0x3aa;
    cCur = 0;
    HVar3 = CreateCompatibleDC(hdc);
    HVar4 = SelectObject(HVar3, hbmpMono);
    SetTextColor(hdc, 0);
    SetBkColor(hdc, 0xffffff);
    xLeft = vdxScoreX + 4;
    iVar5 = ((dyArial8 * 3) / 2 + -0xc) / 2;
    iVar6 = ((dyArial8 * 3) / 2 + -0xb) / 2 - dyArial8 / 4;
    i = 0;
    do {
        if (game.cPlayer <= i) {
            PatBlt(hdc, xLeft, 0x58 - dyArial8 / 4, 1, (dyArial8 * 0x15) / 2 + 1, 0xf00021);
            SelectObject(HVar3, HVar4);
            DeleteDC(HVar3);
            i = 0;
            do {
                if (8 < i) {
                    return;
                }
                for (iPass = 0; iPass < 2; iPass = iPass + 1) {
                    if (iPass == 0) {
                        cCurSav = cCur;
                        xStart = 0;
                    } else {
                        ids = ids + -3;
                        if (i < 7) {
                            xStart = vdxScoreX - xLeft;
                        } else {
                            xStart = 8;
                        }
                    }
                    if (((i < 8) && (iPass == 1)) &&
                        (PatBlt(hdc, vdxScoreX + 4, yTop - dyArial8 / 4, (dyArial8 * game.cPlayer * 3) / 2, 1, 0xf00021), i == 7)) {
                        yTop = yTop + dyArial8 / 2;
                    }
                    sVar7 = CchGetString(ids, (char *)szWork);
                    if (iPass == 1) {
                        HVar3 = hdc;
                        if ((i < 7) && (sVar8 = GetVCCheck((GAME *)&game, cCurSav), sVar8 == 0)) {
                            uVar12 = 0x7f7f;
                            uVar13 = 0x7f;
                        } else {
                            uVar12 = 0;
                            uVar13 = 0;
                        }
                        SetTextColor(HVar3, CONCAT22(uVar13, uVar12));
                        TextOut(hdc, xStart, yTop, szWork, sVar7);
                    }
                    DVar9 = GetTextExtent(hdc, szWork, sVar7);
                    xLeft = xStart + (int)DVar9;
                    cCur = cCurSav;
                    iVar5 = ids;
                    for (j = 0; ids = iVar5 + 1, j < 2; j = j + 1) {
                        if ((j == 1) && (i != 1)) {
                            ids = iVar5 + 2;
                            break;
                        }
                        vcVal = GetVCVal((GAME *)&game, cCur, 0);
                        if (i == 0) {
                            idsT = 0x3c5;
                            uVar13 = 0;
                            uVar12 = 100;
                            uVar10 = __aFulmul((long)vcVal, (long)game.cPlanMax);
                            lVar11 = __aFldiv(uVar10, CONCAT22(uVar13, uVar12));
                            vcVal = (short)lVar11;
                        } else {
                            idsT = ids;
                        }
                        cch = _wsprintf(szWork, PCTD, vcVal);
                        if (i == 3) {
                            _strcat((char *)szWork, (char *)s___1120_15ec);
                            cch = cch + 1;
                        }
                        if (iPass == 1) {
                            TextOut(hdc, xLeft, yTop, szWork, cch);
                        }
                        DVar9 = GetTextExtent(hdc, szWork, cch);
                        xLeft = xLeft + (int)DVar9;
                        if ((i != 2) && (i != 3)) {
                            xLeft = xLeft + 4;
                        }
                        sVar7 = CchGetString(idsT, (char *)szWork);
                        if (iPass == 1) {
                            TextOut(hdc, xLeft, yTop, szWork, sVar7);
                        }
                        DVar9 = GetTextExtent(hdc, szWork, sVar7);
                        xLeft = xLeft + (int)DVar9;
                        cCur = cCur + 1;
                        iVar5 = ids;
                    }
                    if (iPass == 1) {
                        yTop = yTop + (dyArial8 * 3) / 2;
                    }
                }
                i = i + 1;
            } while (true);
        }
        grbitVC = ((SCOREX *)vlprgScoreX + i)->wWord >> 6 & 0xff;
        for (j = 0; j < 7; j = j + 1) {
            if ((grbitVC & 1U) != 0) {
                BitBlt(hdc, xLeft + iVar5, iVar6 + 0x58 + (j * dyArial8 * 3) / 2, 0xe, 0xc, HVar3, 0, 0, 0x8800c6);
                if ((((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) || ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) &&
                    (sVar7 = GetVCCheck((GAME *)&game, (uint)(1 < j) + j), sVar7 != 0)) {
                    if ((((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0)
                        goto LAB_1108_1917;
                    SetTextColor(hdc, 0xff0000);
                } else {
                    SetTextColor(hdc, CONCAT22(crButtonShadow._2_2_, (undefined2)crButtonShadow));
                }
                SetBkColor(hdc, 0);
                BitBlt(hdc, xLeft + iVar5, iVar6 + 0x58 + (j * dyArial8 * 3) / 2, 0xe, 0xc, HVar3, 0, 0, 0xee0086);
                SetTextColor(hdc, 0);
                SetBkColor(hdc, 0xffffff);
            }
        LAB_1108_1917:
            grbitVC = grbitVC >> 1;
        }
        PatBlt(hdc, xLeft, 0x58 - dyArial8 / 4, 1, (dyArial8 * 0x15) / 2 + 1, 0xf00021);
        xLeft = xLeft + (dyArial8 * 3) / 2;
        i = i + 1;
    } while (true);
}

// ======================================================================
// Function: DrawScoreReport
// Address: 1108:1e0c
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x11082349) */
/* WARNING: Removing unreachable block (ram,0x1108231e) */

void DrawScoreReport(HDC hdc)

{
    short      ids_00;
    int        iVar1;
    uint       uVar2;
    undefined2 unaff_SI;
    undefined2 unaff_DI;
    DWORD      DVar3;
    long       lVar4;
    ushort     in_stack_0000ffcc;
    long       l;
    short      xLeft;
    short      cch;
    long       lVal;
    char      *psz;
    short      iPass;
    short      i;
    short      j;
    long       lMax;
    COLORREF   cr;
    short      ids;
    short      dx45;
    POINT      pt;
    short      yTop;
    short      dxDig;

    yTop = 0x58;
    SetBkMode(hdc, 1);
    SelectObject(hdc, rghfontArial8[1]);
    DVar3 = GetTextExtent(hdc, s_9_1120_15ee, 1);
    iVar1 = (int)DVar3;
    SelectObject(hdc, rghfontArial8[4]);
    xLeft = (iVar1 * 5 - (dyArial8 * 3) / 2) / 2 + vdxScoreX;
    for (i = 0; i < game.cPlayer; i = i + 1) {
        psz = PszPlayerName(i, 1, 1, 1, 0, 0);
        cch = _strlen(psz);
        DVar3 = GetTextExtent(hdc, psz, cch);
        in_stack_0000ffcc = (ushort)DVar3;
        lVar4 = __ftol((double)(ulonglong)CONCAT24(in_stack_0000ffcc, CONCAT22(unaff_SI, unaff_DI)));
        dx45 = (short)lVar4;
        if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) || ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) {
            if ((((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) {
                cr._0_2_ = 0;
                cr._2_2_ = 0;
            } else {
                cr._0_2_ = 0;
                cr._2_2_ = 0xff;
            }
        } else {
            cr._0_2_ = 0x7f7f;
            cr._2_2_ = 0x7f;
        }
        SetTextColor(hdc, CONCAT22(cr._2_2_, (undefined2)cr));
        TextOut(hdc, (xLeft - dx45) + (dyArial8 * 3) / 2, (-(dyArial8 / 2) - dx45) + 0x54, psz, cch);
        xLeft = xLeft + iVar1 * 5;
    }
    SelectObject(hdc, rghfontArial8[1]);
    SelectObject(hdc, hbrButtonShadow);
    ids = 0x1b3;
    xLeft = vdxScoreX + 4;
    pt.x = ((dyArial8 * 3) / 2 + -0xc) / 2;
    pt.y = ((dyArial8 * 3) / 2 + -0xb) / 2 - dyArial8 / 4;
    for (i = 0; i <= game.cPlayer; i = i + 1) {
        PatBlt(hdc, xLeft, 0x58 - dyArial8 / 4, 1, (dyArial8 * 0x1b) / 2 + 1, 0xf00021);
        xLeft = xLeft + iVar1 * 5;
    }
    SetTextColor(hdc, 0);
    lVar4 = CONCAT22(lVal._2_2_, (undefined2)lVal);
    for (i = 0; lVal = lVar4, i < 9; i = i + 1) {
        PatBlt(hdc, vdxScoreX + 4, yTop - dyArial8 / 4, game.cPlayer * iVar1 * 5, 1, 0xf00021);
        ids_00 = ids;
        ids = ids + 1;
        cch = CchGetString(ids_00, (char *)szWork);
        SetTextColor(hdc, 0);
        RightTextOut(hdc, vdxScoreX, yTop, (char *)szWork, cch, 0);
        xLeft = iVar1 * 5 + vdxScoreX + 2;
        lMax = 0;
        lVar4 = lVal;
        for (iPass = 0; iPass < 2; iPass = iPass + 1) {
            for (j = 0; j < game.cPlayer; j = j + 1) {
                if ((((SCOREX *)vlprgScoreX + j)->wWord >> 5 & 1) == 0) {
                    lVar4 = -1;
                } else {
                    switch (i) {
                    case 0:
                        lVar4 = (long)((SCOREX *)vlprgScoreX)[j].score.cPlanet;
                        break;
                    case 1:
                        lVar4 = (long)((SCOREX *)vlprgScoreX)[j].score.cStarbase;
                        break;
                    case 2:
                    case 3:
                    case 4:
                        lVal = lVar4;
                        lVar4 = __aFlshl(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ffcc);
                        break;
                    case 5:
                        lVar4 = (long)((SCOREX *)vlprgScoreX)[j].score.cTechLevels;
                        break;
                    case 6:
                        lVar4 =
                            CONCAT22(*(undefined2 *)((int)&((SCOREX *)vlprgScoreX)[j].score.cResources + 2), (int)((SCOREX *)vlprgScoreX)[j].score.cResources);
                        break;
                    case 7:
                        lVar4 = CONCAT22(*(undefined2 *)((int)&((SCOREX *)vlprgScoreX)[j].score.lScore + 2), (int)(&((SCOREX *)vlprgScoreX)[j].score)->lScore);
                        break;
                    case 8:
                        lVar4 = (long)(&((SCOREX *)vlprgScoreX)[j].u_SCOREX_0x0002)->iRank;
                    }
                }
                if (iPass == 0) {
                    if (lMax < lVar4) {
                        lMax = lVar4;
                    }
                } else if ((-1 < lVar4) &&
                           (((*(uint *)((int)&rgplr[0].wMdPlr + j * 0xc0) >> 8 & 1) == 0 || ((*(uint *)((int)&rgplr[0].wFlags + j * 0xc0) & 1) == 0)))) {
                    lVal = lVar4;
                    if (i == 8) {
                        if (lVar4 == 1) {
                            uVar2 = 0xff;
                        } else {
                            uVar2 = 0;
                        }
                        SetTextColor(hdc, (ulong)uVar2 << 0x10);
                    } else {
                        if (lMax == lVar4) {
                            uVar2 = 0xff;
                        } else {
                            uVar2 = 0;
                        }
                        SetTextColor(hdc, (ulong)uVar2 << 0x10);
                    }
                    psz = PszFromLongK(lVal, &cch);
                    RightTextOut(hdc, xLeft, yTop, psz, cch, 0);
                    lVar4 = lVal;
                }
                if (iPass == 1) {
                    xLeft = xLeft + iVar1 * 5;
                }
            }
        }
        yTop = yTop + (dyArial8 * 3) / 2;
    }
    PatBlt(hdc, vdxScoreX + 4, yTop - dyArial8 / 4, game.cPlayer * iVar1 * 5, 1, 0xf00021);
    return;
}

// ======================================================================
// Function: DrawHistoryReport
// Address: 1108:2494
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x11082b7f) */
/* WARNING: Removing unreachable block (ram,0x11082b2d) */
/* WARNING: Removing unreachable block (ram,0x11082adb) */
/* WARNING: Removing unreachable block (ram,0x11082a8b) */
/* WARNING: Removing unreachable block (ram,0x11082a3b) */
/* WARNING: Removing unreachable block (ram,0x110829cf) */
/* WARNING: Removing unreachable block (ram,0x110827e6) */
/* WARNING: Removing unreachable block (ram,0x110827c2) */
/* WARNING: Removing unreachable block (ram,0x11082840) */
/* WARNING: Removing unreachable block (ram,0x11082a16) */
/* WARNING: Removing unreachable block (ram,0x11082a63) */
/* WARNING: Removing unreachable block (ram,0x11082ab3) */
/* WARNING: Removing unreachable block (ram,0x11082b04) */
/* WARNING: Removing unreachable block (ram,0x11082b56) */
/* WARNING: Removing unreachable block (ram,0x11082cc5) */

void DrawHistoryReport(HDC hdc)

{
    long       lVar1;
    short      sVar2;
    short      sVar3;
    int        iVar4;
    int        iVar5;
    int        iVar6;
    char      *pcVar7;
    ushort     uVar8;
    HPEN       HVar9;
    HGDIOBJ    HVar10;
    int        iVar11;
    SCOREX    *pSVar12;
    undefined2 unaff_SS;
    ulong      uVar13;
    long       lVar14;
    ulong      uVar15;
    ulong      uVar16;
    ulong      uVar17;
    undefined2 uVar18;
    undefined2 uVar19;
    undefined2 uVar20;
    undefined2 uVar21;
    HDC        HVar22;
    SCOREX    *lpsx;
    HPEN       hpen;
    HPEN       hpenSav;
    RECT       rc;
    RECT       rcDiamond;
    short      cch;
    long       cInc;
    short      xCur;
    long       cScaleMax;
    short      dx;
    char      *psz;
    short      cDrawn;
    short      yCur;
    short      i;
    short      j;
    ushort     iYearBase;
    long       cCur;
    long       cYears;
    short      dy;
    POINT      pt;
    ushort     dYear;
    RECT       rcChart;
    char       szT[100];

    SetBkMode(hdc, 1);
    GetClientRect(hwndScoreXDlg, &rcChart);
    ExpandRc(&rcChart, -0x30, 0);
    rcChart.top = dyArial10 + dyArial8;
    rcChart.bottom = rcChart.bottom + dyArial8 * -4;
    rc.left = rcChart.left;
    rc.right = rcChart.right;
    rc.top = dyArial8 / 2;
    rc.bottom = rc.top + dyArial10;
    sVar2 = CchGetString(idsHistory, szT);
    sVar3 = CchGetString((gd.grBits2._2_2_ & 0xf) + idsPlanets, szT + sVar2);
    (szT + sVar2)[sVar3 + -1] = '\0';
    SelectObject(hdc, rghfontArial10[1]);
    SetTextColor(hdc, CONCAT22(crButtonText._2_2_, (undefined2)crButtonText));
    RcCtrTextOut(hdc, &rc, szT, 0);
    SetRect(&rcDiamond, 0xf, rc.top, dyArial10 + 0xf, rc.top + dyArial10);
    DrawDiamond(hdc, &rcDiamond, hbrBBlue);
    iVar4 = rcChart.right - rcChart.left;
    iVar5 = rcChart.bottom - rcChart.top;
    PatBlt(hdc, rcChart.left, rcChart.top, iVar4, iVar5, 0x42);
    SelectObject(hdc, hbrButtonHilite);
    PatBlt(hdc, rcChart.left + -1, rcChart.bottom, iVar4 + 3, 1, 0xf00021);
    PatBlt(hdc, rcChart.left + -2, rcChart.bottom + 1, iVar4 + 4, 1, 0xf00021);
    PatBlt(hdc, rcChart.right, rcChart.top + -1, 1, iVar5 + 3, 0xf00021);
    PatBlt(hdc, rcChart.right + 1, rcChart.top + -2, 1, iVar5 + 4, 0xf00021);
    SelectObject(hdc, hbrButtonShadow);
    PatBlt(hdc, rcChart.left + -2, rcChart.top + -2, iVar4 + 3, 1, 0xf00021);
    PatBlt(hdc, rcChart.left + -2, rcChart.top + -1, iVar4 + 2, 1, 0xf00021);
    PatBlt(hdc, rcChart.left + -2, rcChart.top + -2, 1, iVar5 + 3, 0xf00021);
    PatBlt(hdc, rcChart.left + -1, rcChart.top + -2, 1, iVar5 + 2, 0xf00021);
    ExpandRc(&rcChart, -2, -2);
    if (game.turn < 0x65) {
        iYearBase = 0;
    } else {
        iYearBase = game.turn - 100;
    }
    uVar20 = 0;
    uVar18 = 5;
    uVar13 = __aFldiv((ulong)(game.turn + 4), 5);
    uVar13 = __aFulmul(uVar13, CONCAT22(uVar20, uVar18));
    if ((long)uVar13 < 0x65) {
        if (0x32 < (long)uVar13) {
            uVar20 = 0;
            uVar18 = 10;
            uVar13 = __aFldiv(uVar13 + 5, 10);
            uVar13 = __aFulmul(uVar13, CONCAT22(uVar20, uVar18));
        }
    } else {
        uVar13 = 100;
    }
    SelectObject(hdc, rghfontArial8[1]);
    cYears._0_2_ = (int)uVar13;
    if ((long)uVar13 < 0x33) {
        j = 5;
    } else {
        j = 10;
    }
    iVar6 = (int)cYears / j;
    if (0 < iVar6) {
        for (i = 0; i <= iVar6; i = i + 1) {
            iVar11 = ((iVar4 + -4) * i) / iVar6 + rcChart.left;
            sVar2 = _wsprintf(szT, PCTD, iYearBase + 0x960 + i * j);
            CtrTextOut(hdc, iVar11, rcChart.bottom + 6, szT, sVar2);
            if ((0 < i) && (i < iVar6)) {
                PatBlt(hdc, iVar11, rcChart.top + -2, 1, iVar5, 0xf00021);
            }
        }
    }
    lVar1 = -1;
    for (i = 0; i < game.cPlayer; i = i + 1) {
        if ((*(int *)((SCOREX **)rgsxPlr + i) != 0) || (*(int *)((int)(SCOREX **)rgsxPlr + i * 4 + 2) != 0)) {
            for (j = 0; j < ((short *)rgcsxPlr)[i]; j = j + 1) {
                lVar14 = LFetchScoreXVal(
                    (SCOREX *)CONCAT22(*(undefined2 *)((int)(SCOREX **)rgsxPlr + i * 4 + 2), (SCOREX *)(*(int *)((SCOREX **)rgsxPlr + i) + j * 0x18)),
                    gd.grBits2._2_2_ & 0xf);
                if (lVar1 < lVar14) {
                    lVar1 = lVar14;
                }
            }
        }
    }
    if ((0xffff < lVar1) || (-1 < lVar1)) {
        if (lVar1 < 5) {
            lVar1 = 5;
        }
        if (lVar1 < 0xd) {
            uVar15 = 1;
        } else if (lVar1 < 0x1a) {
            uVar15 = 2;
        } else if (lVar1 < 0x3d) {
            uVar15 = 5;
        } else if (lVar1 < 0x79) {
            uVar15 = 10;
        } else if (lVar1 < 0x12d) {
            uVar15 = 0x19;
        } else if (lVar1 < 0x259) {
            uVar15 = 0x32;
        } else if (lVar1 < 0x4b1) {
            uVar15 = 100;
        } else if (lVar1 < 0x1771) {
            uVar15 = 500;
        } else if (lVar1 < 0x2ee1) {
            uVar15 = 1000;
        } else {
            uVar21 = 0;
            uVar19 = 500;
            uVar20 = 0;
            uVar18 = 500;
            lVar14 = __aFldiv(lVar1, 0xc);
            uVar15 = __aFldiv(lVar14, CONCAT22(uVar20, uVar18));
            uVar15 = __aFulmul(uVar15, CONCAT22(uVar21, uVar19));
        }
        iVar6 = rcChart.left + -6;
        uVar17 = uVar15;
        while (true) {
            cCur._2_2_ = (undefined2)(uVar17 >> 0x10);
            cCur._0_2_ = (undefined2)uVar17;
            if (lVar1 <= (long)uVar17)
                break;
            lVar14 = lVar1;
            uVar16 = __aFulmul((long)(iVar5 + -4), uVar17);
            lVar14 = __aFldiv(uVar16, lVar14);
            iVar11 = rcChart.bottom - (int)lVar14;
            if (iVar11 < dyArial8 / 2 + rcChart.top)
                break;
            sVar2 = _wsprintf(szWork, PCTLD, (undefined2)cCur, cCur._2_2_);
            RightTextOut(hdc, iVar6, iVar11 - dyArial8 / 2, (char *)szWork, sVar2, 0);
            PatBlt(hdc, rcChart.left + -2, iVar11, iVar4, 1, 0xf00021);
            uVar17 = uVar15 + uVar17;
        }
        iVar6 = rcChart.left + 6;
        yCur = rcChart.top + 6;
        for (i = 0; i < game.cPlayer; i = i + 1) {
            if ((*(int *)((SCOREX **)rgsxPlr + i) != 0) || (*(int *)((int)(SCOREX **)rgsxPlr + i * 4 + 2) != 0)) {
                pcVar7 = PszPlayerName(i, 1, 1, 0, 0, 0);
                if (i == idPlayer) {
                    uVar18 = 0xffff;
                    uVar20 = 0xff;
                } else {
                    uVar18 = *(undefined2 *)(i * 4 + rgcrPlrHistory);
                    uVar20 = *(undefined2 *)(i * 4 + rgcrPlrHistory_0x2);
                }
                SetTextColor(hdc, CONCAT22(uVar20, uVar18));
                uVar18 = 0x1120;
                sVar2 = yCur;
                iVar11 = iVar6;
                HVar22 = hdc;
                uVar8 = _strlen(pcVar7);
                TextOut(HVar22, iVar11, sVar2, (LPCSTR)CONCAT22(uVar18, pcVar7), uVar8);
                yCur = yCur + dyArial8;
            }
        }
        for (i = 0; i < game.cPlayer; i = i + 1) {
            if ((*(int *)((SCOREX **)rgsxPlr + i) != 0) || (*(int *)((int)(SCOREX **)rgsxPlr + i * 4 + 2) != 0)) {
                cDrawn = 0;
                if (i == idPlayer) {
                    uVar18 = 0xffff;
                    uVar20 = 0xff;
                } else {
                    uVar18 = *(undefined2 *)(i * 4 + rgcrPlrHistory);
                    uVar20 = *(undefined2 *)(i * 4 + rgcrPlrHistory_0x2);
                }
                HVar9 = CreatePen(0, 1, CONCAT22(uVar20, uVar18));
                HVar10 = SelectObject(hdc, HVar9);
                for (j = 0; j < ((short *)rgcsxPlr)[i]; j = j + 1) {
                    uVar18 = *(undefined2 *)((int)(SCOREX **)rgsxPlr + i * 4 + 2);
                    pSVar12 = (SCOREX *)(*(int *)((SCOREX **)rgsxPlr + i) + j * 0x18);
                    if ((iYearBase <= (&pSVar12->u_SCOREX_0x0002)->turn) && ((&pSVar12->u_SCOREX_0x0002)->turn <= (int)cYears + iYearBase)) {
                        iVar6 = (&pSVar12->u_SCOREX_0x0002)->iRank;
                        uVar17 = LFetchScoreXVal((SCOREX *)CONCAT22(uVar18, pSVar12), gd.grBits2._2_2_ & 0xf);
                        uVar15 = uVar13;
                        uVar16 = __aFulmul((ulong)(iVar6 - iYearBase), (long)(iVar4 + -4));
                        lVar14 = __aFldiv(uVar16, uVar15);
                        pt.x = (int)lVar14 + rcChart.left;
                        lVar14 = lVar1;
                        uVar15 = __aFulmul(uVar17, (long)(iVar5 + -4));
                        lVar14 = __aFldiv(uVar15, lVar14);
                        pt.y = rcChart.bottom - (int)lVar14;
                        if (cDrawn == 0) {
                            MoveTo(hdc, pt.x, pt.y);
                        } else {
                            LineTo(hdc, pt.x, pt.y);
                        }
                        cDrawn = cDrawn + 1;
                    }
                }
                if (cDrawn == 1) {
                    if (i == idPlayer) {
                        uVar18 = 0xffff;
                        uVar20 = 0xff;
                    } else {
                        uVar18 = *(undefined2 *)(i * 4 + rgcrPlrHistory);
                        uVar20 = *(undefined2 *)(i * 4 + rgcrPlrHistory_0x2);
                    }
                    SetPixel(hdc, pt.x, pt.y, CONCAT22(uVar20, uVar18));
                }
                SelectObject(hdc, HVar10);
                DeleteObject(HVar9);
            }
        }
    }
    return;
}

// ======================================================================
// Function: LFetchScoreXVal
// Address: 1108:2f94
// Segment: MEMORY_REPORT
// ======================================================================

long LFetchScoreXVal(SCOREX *lpsx, short iVal)

{
    SCOREX    *pSVar1;
    undefined2 unaff_SI;
    undefined2 unaff_DI;
    undefined2 uVar2;
    long       lVar3;
    ushort     in_stack_0000fffc;

    pSVar1 = (SCOREX *)lpsx;
    uVar2 = (undefined2)((ulong)lpsx >> 0x10);
    switch (iVal) {
    case 0:
        lVar3 = (long)(pSVar1->score).cPlanet;
        break;
    case 1:
        lVar3 = (long)(pSVar1->score).cStarbase;
        break;
    case 2:
    case 3:
    case 4:
        lVar3 = __aFlshl(CONCAT22(unaff_SI, unaff_DI), in_stack_0000fffc);
        break;
    case 5:
        lVar3 = (long)(pSVar1->score).cTechLevels;
        break;
    case 6:
        lVar3 = CONCAT22(*(undefined2 *)((int)&(pSVar1->score).cResources + 2), (int)(pSVar1->score).cResources);
        break;
    case 7:
        lVar3 = CONCAT22(*(undefined2 *)((int)&(pSVar1->score).lScore + 2), (int)(&pSVar1->score)->lScore);
        break;
    default:
        lVar3 = 0;
    }
    return lVar3;
}

// ======================================================================
// Function: DxReportColHdr
// Address: 1108:305e
// Segment: MEMORY_REPORT
// ======================================================================

short DxReportColHdr(short irpt, short iCol, char *psz, HDC hdc)

{
    int        iVar1;
    short      sVar2;
    int        iVar3;
    undefined2 unaff_SS;
    DWORD      DVar4;
    short      dx2;
    short      cch;
    short      dx;
    short      dxDigit;
    short      ids;
    char       szT[40];

    szT[0] = '8';
    DVar4 = GetTextExtent(hdc, szT, 1);
    iVar1 = (int)DVar4;
    if (irpt != 0) {
        if (irpt == 1) {
            sVar2 = CchGetString(iCol + idsFleetName, psz);
            DVar4 = GetTextExtent(hdc, psz, sVar2);
            iVar3 = (int)DVar4;
            dx = iVar3;
            switch (iCol) {
            case 0:
            case 1:
            case 3:
            case 8:
            case 10:
            case 0xb:
                dx = iVar3 << 1;
                break;
            case 2:
                dx = iVar3 * 2 + iVar3 / 2;
                break;
            case 4:
                dx = iVar3 * 2 - iVar1;
                break;
            case 5:
                dx = iVar3 * 4 + iVar3 / 2;
                break;
            case 6:
                dx = iVar1 * 5;
                if (dx <= iVar3) {
                    dx = iVar3;
                }
                break;
            case 7:
                dx = iVar1 * 0x13;
                if (iVar1 * 0x13 <= iVar3) {
                    dx = iVar3;
                }
            }
        } else if (irpt == 2) {
            sVar2 = CchGetString(iCol + idsFleetName2, psz);
            DVar4 = GetTextExtent(hdc, psz, sVar2);
            dx = (short)DVar4;
            if (iCol == 0) {
                dx = dx * 3;
            } else {
                if (iCol != 1) {
                    if (iCol == 2) {
                        dx = dx * 2 + dx / 2;
                        goto LAB_1108_337d;
                    }
                    if (iCol != 5)
                        goto LAB_1108_337d;
                }
                dx = dx << 1;
            }
        } else {
            if (irpt != 3) {
                *psz = '\0';
                return 0;
            }
            sVar2 = CchGetString(iCol + idsLocation4, psz);
            DVar4 = GetTextExtent(hdc, psz, sVar2);
            dx = (short)DVar4;
            if (iCol == 0) {
                dx = dx * 2 + dx / 2;
            }
        }
        goto LAB_1108_337d;
    }
    sVar2 = CchGetString(iCol + idsPlanetName, psz);
    DVar4 = GetTextExtent(hdc, psz, sVar2);
    dx = (short)DVar4;
    switch (iCol) {
    case 0:
        dx = dx << 1;
        goto switchD_1108_3174_caseD_2;
    case 1:
    case 0xd:
    case 0xe:
        dx2 = iVar1 * 0xf;
        break;
    default:
        goto switchD_1108_3174_caseD_2;
    case 3:
        dx2 = iVar1 * 4 + 2;
        break;
    case 4:
        ids = 0x468;
        goto REPORT_ChkAltString;
    case 5:
        dx = dx * 3 + 0x14;
        goto switchD_1108_3174_caseD_2;
    case 6:
    case 7:
        dx2 = iVar1 * 5;
        break;
    case 9:
        dx2 = iVar1 * 0xe;
        break;
    case 10:
    case 0xb:
        dx2 = iVar1 * 0xb;
        break;
    case 0xc:
        ids = 0x46a;
    REPORT_ChkAltString:
        sVar2 = CchGetString(ids, szT);
        DVar4 = GetTextExtent(hdc, szT, sVar2);
        dx2 = (short)DVar4;
    }
    if (dx < dx2) {
        dx = dx2;
    }
switchD_1108_3174_caseD_2:
LAB_1108_337d:
    return (dx + 6) / 2 << 1;
}

// ======================================================================
// Function: DrawReportItem
// Address: 1108:3398
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x11083d76) */

void DrawReportItem(HDC hdc, RECT *prc, short irpt, short irow, short icol)

{
    undefined2 *puVar1;
    PLANET     *pPVar2;
    undefined2 *puVar3;
    short      *psVar4;
    BTLDATA    *pBVar5;
    float       fVar6;
    ushort      uVar7;
    char       *pcVar8;
    uint        uVar9;
    short       sVar10;
    short       sVar11;
    int         iVar12;
    int         iVar13;
    undefined2  unaff_SI;
    undefined2 *puVar14;
    PLANET     *pPVar15;
    undefined2 *puVar16;
    undefined2  unaff_DI;
    short      *psVar17;
    undefined2  unaff_SS;
    bool        bVar18;
    DWORD       DVar19;
    HULDEF     *pHVar20;
    long        lVar21;
    ulong       uVar22;
    BTLDATA    *lpbd_00;
    undefined2  uVar23;
    RECT       *pRVar24;
    undefined2  uVar25;
    UINT        UVar26;
    short       sVar27;
    HDC         HVar28;
    ushort      in_stack_0000ff3e;
    undefined2  in_stack_0000ff40;
    undefined4  local_9a;
    undefined2  local_96;
    undefined1  auStack_94[6];
    undefined4  local_8e;
    long        l;
    short       cch;
    short       xCur;
    char       *psz;
    short       dx;
    FLEET      *lpfl;
    short       i;
    short       j;
    PLANET     *lppl;
    char       *lpsz;
    char        chT;
    char        szT[100];
    BTLDATA    *lpbd;

    szT[0] = '8';
    DVar19 = GetTextExtent(hdc, szT, 1);
    dx = (short)DVar19;
    if (irpt == 0) {
        lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, (PLANET *)lpPlanets + ((ushort *)vlprgidPlanet)[irow]);
        SelectObject(hdc, rghfontArial8[1]);
        SetTextColor(hdc, 0);
        SetBkMode(hdc, 1);
        switch (icol) {
        case 0:
            if ((sel.grobj == grobjPlanet) && (sel.pl.id == lppl->id)) {
                SetTextColor(hdc, 0x7f);
            }
            pcVar8 = PszGetPlanetName(lppl->id);
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pRVar24 = prc;
            HVar28 = hdc;
            psz = pcVar8;
            uVar7 = _strlen(pcVar8);
            ExtTextOut(HVar28, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, pRVar24), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            uVar23 = (undefined2)((ulong)lppl >> 0x10);
            if ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) == 0) {
                return;
            }
            auStack_94._2_2_ = prc->top;
            auStack_94._4_2_ = prc->right;
            local_8e = (float)CONCAT22(local_8e._2_2_, prc->bottom);
            dx = (prc->bottom - auStack_94._2_2_) / 3 + -1;
            auStack_94._0_2_ = auStack_94._4_2_ - dx;
            pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(idPlayer * 4 + rglpshdefSB) + (*(uint *)&((PLANET *)lppl)->lStarbase & 0xf) * 0x93));
            local_8e._2_2_ = hbrYellow;
            if ((((HULDEF *)pHVar20)->hul).wtCargoMax == 0) {
                local_8e._2_2_ = hbrBlue;
            }
            auStack_94._2_2_ = prc->top;
            local_8e._0_2_ = auStack_94._2_2_ + dx;
            FillRect(hdc, auStack_94, local_8e._2_2_);
            sVar10 = IWarpMAFromLppl(lppl, 0);
            if (0 < sVar10) {
                auStack_94._2_2_ = prc->top + dx + 1;
                local_8e._0_2_ = auStack_94._2_2_ + dx;
                FillRect(hdc, auStack_94, hbrPurple);
            }
            sVar10 = IStargateFromLppl(lppl);
            if (sVar10 == -1) {
                return;
            }
            auStack_94._2_2_ = (dx + 1) * 2 + prc->top;
            local_8e = (float)CONCAT22(local_8e._2_2_, auStack_94._2_2_ + dx);
            FillRect(hdc, auStack_94, hbrGreen);
            return;
        case 1:
            if ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) == 0) {
                lpsz._0_2_ = szDblDash;
                lpsz._2_2_ = 0x1120;
            } else {
                lpsz._2_2_ = *(undefined2 *)(idPlayer * 4 + rglpshdefSB_0x2);
                lpsz._0_2_ = (char *)(*(int *)(idPlayer * 4 + rglpshdefSB) + (*(uint *)&((PLANET *)lppl)->lStarbase & 0xf) * 0x93 + 8);
            }
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            pcVar8 = (char *)lpsz;
            uVar23 = lpsz._2_2_;
            uVar7 = __fstrlen((char *)CONCAT22(lpsz._2_2_, (char *)lpsz));
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 2:
            lVar21 = CalcPlanetMaxPop(lppl->id, ((PLANET *)lppl)->iPlayer);
            iVar13 = (int)((ulong)lVar21 >> 0x10);
            uVar23 = (undefined2)((ulong)lppl >> 0x10);
            iVar12 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 0xe);
            if ((iVar13 <= iVar12) && ((iVar13 < iVar12 || ((uint)lVar21 < *(uint *)(((PLANET *)lppl)->rgwtMin + 3))))) {
                SetTextColor(hdc, 0xff);
            }
            uVar23 = (undefined2)((ulong)lppl >> 0x10);
            uVar22 = __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe), (int)((PLANET *)lppl)->rgwtMin[3]), 100);
            cch = CommaFormatLong(szT, uVar22);
            RightTextOut(hdc, prc->right, prc->top, szT, cch, 0);
            return;
        case 3:
            sVar10 = PctPlanetCapacity(lppl);
            cch = _wsprintf(szT, PCTDPCTPCT, sVar10);
            RightTextOut(hdc, prc->right, prc->top, szT, cch, 0);
            return;
        case 4:
            cch = CchGetString(idsN100, szT);
            DVar19 = GetTextExtent(hdc, szT, cch);
            dx = (short)DVar19;
            i = PctPlanetDesirability(lppl, idPlayer);
            cch = _wsprintf(szT, PCTDPCTPCT, i);
            if (i < 0xb) {
                if (i < 0) {
                    uVar9 = 0xff;
                } else {
                    uVar9 = 0x7f7f;
                }
                SetTextColor(hdc, (ulong)uVar9);
            }
            RightTextOut(hdc, prc->left + dx, prc->top, szT, cch, 0);
            j = PctPlanetOptValue(lppl, idPlayer);
            if (j <= i) {
                return;
            }
            if (0 < j) {
                if (j < 0xb) {
                    uVar9 = 0x7f7f;
                } else {
                    uVar9 = 0;
                }
                SetTextColor(hdc, (ulong)uVar9);
            }
            cch = _wsprintf(szT, "(%d%%)", j);
            RightTextOut(hdc, prc->right, prc->top, szT, cch, 0);
            return;
        case 5:
            puVar14 = (undefined2 *)&sel.pl;
            puVar16 = &stack0xff3e;
            for (iVar12 = 0x1c; iVar12 != 0; iVar12 = iVar12 + -1) {
                puVar3 = puVar16;
                puVar16 = puVar16 + 1;
                puVar1 = puVar14;
                puVar14 = puVar14 + 1;
                *puVar3 = *puVar1;
            }
            psVar17 = (short *)&sel.pl;
            pPVar15 = (PLANET *)lppl;
            for (iVar12 = 0x1c; iVar12 != 0; iVar12 = iVar12 + -1) {
                psVar4 = psVar17;
                psVar17 = psVar17 + 1;
                pPVar2 = pPVar15;
                pPVar15 = &pPVar15->iPlayer;
                *psVar4 = pPVar2->id;
            }
            FillPlanetProdLB(0, 0, lppl);
            puVar16 = &stack0xff3e;
            puVar14 = (undefined2 *)&sel.pl;
            for (iVar12 = 0x1c; iVar12 != 0; iVar12 = iVar12 + -1) {
                puVar3 = puVar14;
                puVar14 = puVar14 + 1;
                puVar1 = puVar16;
                puVar16 = puVar16 + 1;
                *puVar3 = *puVar1;
            }
            DrawProductionItem(hdc, prc, (char *)szWork, 0, 0, 2);
            return;
        case 6:
            uVar22 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ff3e);
            i = (uint)uVar22 & 0xfff;
            j = CMaxOperableMines(lppl, idPlayer, 0);
            break;
        case 7:
            uVar22 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ff3e);
            i = (uint)uVar22 & 0xfff;
            j = CMaxOperableFactories(lppl, idPlayer, 0);
            break;
        case 8:
            i = *(uint *)(((PLANET *)lppl)->rgbImp + 4) & 0xfff;
            j = CMaxOperableDefenses(lppl, idPlayer, 0);
            if (i < 1) {
                szT[2] = '-';
                szT[1] = '-';
                szT[0] = '-';
                cch = 3;
            } else {
                CalcPctSurvive(lppl, &local_8e, 0);
                local_8e = FLOAT_1_0_1120_1e0a - local_8e;
                local_96 = 100;
                auStack_94._0_2_ = 0;
                __ftol((double)CONCAT26(in_stack_0000ff40, CONCAT24(in_stack_0000ff3e, CONCAT22(unaff_SI, unaff_DI))));
                lVar21 = __ftol((double)CONCAT26(in_stack_0000ff40, CONCAT24(in_stack_0000ff3e, CONCAT22(unaff_SI, unaff_DI))));
                lVar21 = __ftol((double)CONCAT26(in_stack_0000ff3e, CONCAT24(unaff_SI, CONCAT22(unaff_DI, (int)lVar21))));
                cch = _wsprintf(szT, PCTDXPCTDPCTPCT, (int)lVar21);
            }
            goto REPORT_DrawPlusDef;
        case 9:
        case 10:
            xCur = dx * 4 + prc->left;
            if (icol == 10) {
                xCur = xCur - dx;
                EstMineralsMined(lppl, &local_9a, -1, 0);
            }
            for (i = 0; i < 3; i = i + 1) {
                if (icol == 9) {
                    l._0_2_ = (uint)((PLANET *)lppl)->rgwtMin[i];
                    l._2_2_ = *(undefined2 *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2);
                } else {
                    l._0_2_ = *(uint *)(&local_9a + i);
                    l._2_2_ = *(undefined2 *)((int)&local_9a + i * 4 + 2);
                }
                DrawMineralItem(hdc, xCur, prc->top, i, CONCAT22(l._2_2_, (uint)l));
                if (icol == 10) {
                    xCur = xCur + dx * 4;
                } else {
                    xCur = xCur + dx * 5;
                }
            }
            return;
        case 0xb:
            xCur = dx * 3 + prc->left;
            for (i = 0; i < 3; i = i + 1) {
                local_8e = (float)(ulong)CONCAT12(((PLANET *)lppl)->rgMinConc[i], (int)local_8e);
                fVar6 = local_8e;
                local_8e._2_2_ = (HBRUSH)((PLANET *)lppl)->rgMinConc[i];
                lVar21 = (long)(int)local_8e._2_2_;
                local_8e = fVar6;
                DrawMineralItem(hdc, xCur, prc->top, i, lVar21);
                xCur = xCur + dx * 4;
            }
            return;
        case 0xc:
            cch = CchGetString(idsN1000, szT);
            DVar19 = GetTextExtent(hdc, szT, cch);
            dx = (short)DVar19;
            i = CResourcesAtPlanet(lppl, idPlayer);
            j = i;
            uVar22 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000ff3e);
            if ((uVar22 & 1) == 0) {
                sVar10 = MulDiv(i, (int)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0), 100);
                i = i - sVar10;
            }
            CchGetString(idsD4, szT);
            cch = _wsprintf(szWork, szT, i);
            RightTextOut(hdc, prc->left + dx, prc->top, (char *)szWork, cch, 0);
            cch = _wsprintf(szT, PCTD, j);
            RightTextOut(hdc, prc->right, prc->top, szT, cch, 0);
            return;
        case 0xd:
            if ((*(uint *)((int)&((PLANET *)lppl)->lStarbase + 2) & 0x3ff) == 0) {
                psz = szDblDash;
            } else {
                psz = PszGetPlanetName((*(uint *)((int)&((PLANET *)lppl)->lStarbase + 2) & 0x3ff) - 1);
            }
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pcVar8 = psz;
            uVar7 = _strlen(psz);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 0xe:
            if ((((PLANET *)lppl)->wRouting & 0x3ff) == 0) {
                psz = szDblDash;
            } else {
                psz = PszGetPlanetName((((PLANET *)lppl)->wRouting & 0x3ff) - 1);
            }
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pcVar8 = psz;
            uVar7 = _strlen(psz);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        default:
            return;
        }
        cch = CommaFormatLong(szT, (long)i);
    REPORT_DrawPlusDef:
        if (j <= i) {
            if (i == j) {
                uVar9 = 0x7f00;
            } else {
                uVar9 = 0xff;
            }
            SetTextColor(hdc, (ulong)uVar9);
        }
        RightTextOut(hdc, prc->right, prc->top, szT, cch, 0);
        return;
    }
    if (irpt == 1) {
        /* WARNING: Load size is inaccurate */
        lpfl = (FLEET *)CONCAT22(*(undefined2 *)((int)((FLEET **)rglpfl + ((ushort *)vlprgidFleet)[irow]) + 2),
                                 ((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[irow]]);
        SelectObject(hdc, rghfontArial8[1]);
        SetTextColor(hdc, 0);
        SetBkMode(hdc, 1);
        switch (icol) {
        case 0:
            if ((sel.grobj == grobjFleet) && (sel.fl.id == lpfl->id)) {
                SetTextColor(hdc, 0x7f);
            }
            pcVar8 = PszGetFleetName(lpfl->id);
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            psz = pcVar8;
            uVar7 = _strlen(pcVar8);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 1:
            psz = szT;
            cch = _wsprintf(psz, s_d_1120_15f7, (lpfl->id & 0x1ffU) + 1);
            RightTextOut(hdc, prc->right + -2, prc->top, psz, cch, 0);
            return;
        case 2:
            if (((FLEET *)lpfl)->idPlanet == -1) {
                psz = szT;
                sVar10 = (((FLEET *)lpfl)->pt).y;
                sVar11 = (&((FLEET *)lpfl)->pt)->x;
                pcVar8 = PszGetCompressedString(idsSpaceDD);
                _wsprintf(psz, pcVar8, sVar11, sVar10);
            } else {
                psz = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
            }
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pcVar8 = psz;
            uVar7 = _strlen(psz);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 3:
            pcVar8 = PszGetDestName(lpfl, hdc);
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            psz = pcVar8;
            uVar7 = _strlen(pcVar8);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 4:
            psz = PszGetETA(hdc, lpfl, 0);
            sVar10 = 0;
            uVar7 = _strlen(psz);
            RightTextOut(hdc, prc->right, prc->top, psz, uVar7, sVar10);
            return;
        case 5:
            psz = PszGetTaskName(lpfl, &i);
            if (i != -1) {
                SetTextColor(hdc, CONCAT22(*(undefined2 *)(i * 4 + rgcrMinerals_0x2), *(undefined2 *)(i * 4 + rgcrMinerals)));
            }
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pcVar8 = psz;
            uVar7 = _strlen(psz);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 6:
            goto switchD_1108_44e3_caseD_6;
        case 7:
            xCur = dx * 4 + prc->left;
            for (i = 0; i < 4; i = i + 1) {
                DrawMineralItem(hdc, xCur, prc->top, i, CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2), (int)((FLEET *)lpfl)->rgwtMin[i]));
                xCur = xCur + dx * 5;
            }
            return;
        case 8:
            i = IshdefPrimaryFromLpfl(lpfl, &j);
            if (((FLEET *)lpfl)->rgcsh[i + 0x10] != 0) {
                SetTextColor(hdc, 0xff);
            }
            prc->right = prc->right + dx * -6;
            pcVar8 = (char *)((int)&rgshdef[0].hul + 8 + i * 0x93);
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pRVar24 = prc;
            HVar28 = hdc;
            psz = pcVar8;
            uVar7 = _strlen(pcVar8);
            ExtTextOut(HVar28, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, pRVar24), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            psz = szT;
            sVar11 = _wsprintf(psz, PCTD, ((FLEET *)lpfl)->rgcsh[i]);
            chT = '+';
            sVar27 = 0;
            sVar10 = prc->top;
            pcVar8 = psz;
            cch = sVar11;
            DVar19 = GetTextExtent(hdc, &chT, 1);
            local_8e = (float)CONCAT22((int)DVar19, (int)local_8e);
            RightTextOut(hdc, (dx * 6 + prc->right) - (int)DVar19, sVar10, pcVar8, sVar11, sVar27);
            if (j < 2) {
                return;
            }
            DVar19 = GetTextExtent(hdc, &chT, 1);
            local_8e = (float)CONCAT22((int)DVar19, (int)local_8e);
            TextOut(hdc, (dx * 6 + prc->right) - (int)DVar19, prc->top, &chT, 1);
            return;
        case 9:
            i = PctCloakFromLpfl(lpfl);
            if (i == 0) {
                cch = _strlen(szDblDash);
                psz = szDblDash;
            } else {
                psz = szT;
                cch = _wsprintf(psz, PCTDPCTPCT, i);
            }
            RightTextOut(hdc, prc->right + -5, prc->top, psz, cch, 0);
            return;
        case 10:
            i = (short)((FLEET *)lpfl)->iplan;
            uVar9 = (uint)lpfl->id >> 9 & 0xf;
            __fstrcpy(szT, (char *)CONCAT22(*(undefined2 *)((int)(BTLPLAN **)rglpbtlplan + uVar9 * 4 + 2),
                                            (char *)(*(int *)((BTLPLAN **)rglpbtlplan + uVar9) + (uint)((FLEET *)lpfl)->iplan * 0x24 + 4)));
            pcVar8 = szT;
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            psz = pcVar8;
            uVar7 = _strlen(pcVar8);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 0xb:
            lVar21 = WtFromLpfl(lpfl);
            DrawMineralItem(hdc, prc->right + -2, prc->top, -1, lVar21);
            return;
        default:
            return;
        }
    }
    if (irpt == 2) {
        /* WARNING: Load size is inaccurate */
        lpfl =
            (FLEET *)CONCAT22(*(undefined2 *)((int)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow]) + 2), ((FLEET **)rglpfl)[((ushort *)vlprgidMisc)[irow]]);
        SelectObject(hdc, rghfontArial8[1]);
        SetTextColor(hdc, 0);
        SetBkMode(hdc, 1);
        switch (icol) {
        case 0:
            if ((sel.scan.grobj == grobjFleet) && (((FLEET **)rglpfl)[sel.scan.ifl]->id == lpfl->id)) {
                SetTextColor(hdc, 0x7f);
            }
            pcVar8 = PszGetFleetName(lpfl->id);
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            psz = pcVar8;
            uVar7 = _strlen(pcVar8);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 1:
            psz = szT;
            cch = _wsprintf(psz, s_d_1120_15fa, (lpfl->id & 0x1ffU) + 1);
            RightTextOut(hdc, prc->right + -2, prc->top, psz, cch, 0);
            return;
        case 2:
            if (((FLEET *)lpfl)->idPlanet == -1) {
                psz = szT;
                sVar10 = (((FLEET *)lpfl)->pt).y;
                sVar11 = (&((FLEET *)lpfl)->pt)->x;
                pcVar8 = PszGetCompressedString(idsSpaceDD);
                _wsprintf(psz, pcVar8, sVar11, sVar10);
            } else {
                psz = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
            }
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            uVar23 = 0x1120;
            pcVar8 = psz;
            uVar7 = _strlen(psz);
            ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            return;
        case 3:
            if (((*(uint *)((int)&((FLEET *)lpfl)->dirLong + 2) >> 4 & 1) == 0) || ((*(uint *)((int)&((FLEET *)lpfl)->dirLong + 2) & 0xf) == 0)) {
                psz = (char *)s____1120_15fd;
                cch = 2;
            } else {
                psz = szT;
                cch = _wsprintf(psz, s_d_1120_1600, *(uint *)((int)&((FLEET *)lpfl)->dirLong + 2) & 0xf);
            }
            RightTextOut(hdc, prc->right + -2, prc->top, psz, cch, 0);
            return;
        case 4:
            DrawMineralItem(hdc, prc->right + -2, prc->top, -1,
                            CONCAT22(*(undefined2 *)((int)&((FLEET *)lpfl)->u_FLEET_0x002c + 2), (&((FLEET *)lpfl)->u_FLEET_0x002c)->rgdv[0].dp));
            return;
        case 5:
            i = IshdefPrimaryFromLpfl(lpfl, &j);
            prc->right = prc->right + dx * -6;
            iVar12 = ((FLEET *)lpfl)->iPlayer * 4;
            uVar23 = *(undefined2 *)(iVar12 + rglpshdef_0x2);
            pcVar8 = (char *)(*(int *)(iVar12 + rglpshdef) + i * 0x93 + 8);
            sVar10 = prc->left;
            sVar11 = prc->top;
            UVar26 = 4;
            uVar25 = 0x1120;
            pRVar24 = prc;
            HVar28 = hdc;
            lpsz._0_2_ = pcVar8;
            lpsz._2_2_ = uVar23;
            uVar7 = __fstrlen((char *)CONCAT22(uVar23, pcVar8));
            ExtTextOut(HVar28, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, pRVar24), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
            psz = szT;
            sVar11 = _wsprintf(psz, PCTD, ((FLEET *)lpfl)->rgcsh[i]);
            chT = '+';
            sVar27 = 0;
            sVar10 = prc->top;
            pcVar8 = psz;
            cch = sVar11;
            DVar19 = GetTextExtent(hdc, &chT, 1);
            local_8e = (float)CONCAT22((int)DVar19, (int)local_8e);
            RightTextOut(hdc, (dx * 6 + prc->right) - (int)DVar19, sVar10, pcVar8, sVar11, sVar27);
            if (j < 2) {
                return;
            }
            DVar19 = GetTextExtent(hdc, &chT, 1);
            local_8e = (float)CONCAT22((int)DVar19, (int)local_8e);
            TextOut(hdc, (dx * 6 + prc->right) - (int)DVar19, prc->top, &chT, 1);
            return;
        case 6:
            l._0_2_ = 0;
            l._2_2_ = 0;
            for (i = 0; i < 0x10; i = i + 1) {
                uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                bVar18 = CARRY2((uint)l, uVar9);
                l._0_2_ = (uint)l + uVar9;
                l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar18;
            }
            DrawMineralItem(hdc, prc->right + -2, prc->top, -1, CONCAT22(l._2_2_, (uint)l));
            return;
        case 7:
            l._0_2_ = 0;
            l._2_2_ = 0;
            for (i = 0; i < 0x10; i = i + 1) {
                if (((FLEET *)lpfl)->rgcsh[i] != 0) {
                    iVar12 = ((FLEET *)lpfl)->iPlayer * 4;
                    pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar12 + rglpshdef) + i * 0x93));
                    j = ((HULDEF *)pHVar20)->wFlags_0x7b >> 10 & 0xf;
                    if (((uint)j < 2) || (5 < (uint)j)) {
                        uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                        bVar18 = CARRY2((uint)l, uVar9);
                        l._0_2_ = (uint)l + uVar9;
                        l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar18;
                    }
                }
            }
            DrawMineralItem(hdc, prc->right + -2, prc->top, -1, CONCAT22(l._2_2_, (uint)l));
            return;
        case 8:
            j = 2;
            break;
        case 9:
            j = 3;
            break;
        case 10:
            j = 5;
            break;
        case 0xb:
            j = 4;
            break;
        default:
            return;
        }
        l._0_2_ = 0;
        l._2_2_ = 0;
        for (i = 0; i < 0x10; i = i + 1) {
            if ((((FLEET *)lpfl)->rgcsh[i] != 0) &&
                (iVar12 = ((FLEET *)lpfl)->iPlayer * 4, pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar12 + rglpshdef) + i * 0x93)),
                 (((HULDEF *)pHVar20)->wFlags_0x7b >> 10 & 0xf) == j)) {
                uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                bVar18 = CARRY2((uint)l, uVar9);
                l._0_2_ = (uint)l + uVar9;
                l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar18;
            }
        }
        DrawMineralItem(hdc, prc->right + -2, prc->top, -1, CONCAT22(l._2_2_, (uint)l));
        return;
    }
    if (irpt != 3) {
        return;
    }
    lpbd_00 = BtlDataGet(((ushort *)vlprgidMisc)[irow]);
    iVar12 = (int)((ulong)lpbd_00 >> 0x10);
    pBVar5 = (BTLDATA *)lpbd_00;
    if ((pBVar5 == 0) && (iVar12 == 0)) {
        return;
    }
    SelectObject(hdc, rghfontArial8[1]);
    SetTextColor(hdc, 0);
    SetBkMode(hdc, 1);
    switch (icol) {
    case 0:
        if (pBVar5->idPlanet == 0xffff) {
            psz = szT;
            sVar10 = (pBVar5->pt).y;
            sVar11 = (&pBVar5->pt)->x;
            pcVar8 = PszGetCompressedString(idsSpaceDD);
            _wsprintf(psz, pcVar8, sVar11, sVar10);
        } else {
            psz = PszGetPlanetName(pBVar5->idPlanet);
        }
        if (((&pBVar5->pt)->x == sel.scan.pt.x) && ((pBVar5->pt).y == sel.scan.pt.y)) {
            SetTextColor(hdc, 0x7f);
        }
        sVar10 = prc->left;
        sVar11 = prc->top;
        UVar26 = 4;
        uVar25 = 0x1120;
        uVar23 = 0x1120;
        pcVar8 = psz;
        uVar7 = _strlen(psz);
        ExtTextOut(hdc, sVar10, sVar11, UVar26, (RECT *)CONCAT22(uVar25, prc), (LPCSTR)CONCAT22(uVar23, pcVar8), uVar7, 0);
        return;
    case 1:
        lVar21 = CBattleUnits(lpbd_00, 5);
        if (lVar21 == 0) {
            lVar21 = CBattleUnits(lpbd_00, 6);
            if (lVar21 == 0) {
                chT = ' ';
            } else {
                chT = 'T';
            }
        } else {
            chT = 'O';
        }
        CtrTextOut(hdc, (prc->right - prc->left) / 2 + prc->left, prc->top, &chT, 1);
        return;
    case 2:
        DrawMineralItem(hdc, prc->right + -2, prc->top, -1, (ulong)pBVar5->cplr);
        return;
    case 3:
        i = 0xff;
        break;
    case 4:
        i = 0xfd;
        break;
    case 5:
        i = 0xfe;
        break;
    case 6:
        i = 0xb;
        break;
    case 7:
        i = 0x13;
        break;
    case 8:
        i = 0x23;
        break;
    case 9:
        i = 0x43;
        break;
    case 10:
        i = 0x83;
        break;
    case 0xb:
    case 0xc:
        l = CBattleKills(lpbd_00, (uint)(icol == 0xb));
        DrawMineralItem(hdc, prc->right + -2, prc->top, -1, l);
        return;
    case 0xd:
        i = 0xfd;
        goto REPORT_LUnitsLeft_2;
    case 0xe:
        i = 0xfe;
    REPORT_LUnitsLeft_2:
        l = CBattleUnits(lpbd_00, i);
        lVar21 = CBattleKills(lpbd_00, (uint)(icol == 0xd));
        l = l - lVar21;
        DrawMineralItem(hdc, prc->right + -2, prc->top, -1, l);
    default:
        goto switchD_1108_3e3e_default;
    }
    lVar21 = CBattleUnits(lpbd_00, i);
    DrawMineralItem(hdc, prc->right + -2, prc->top, -1, lVar21);
switchD_1108_3e3e_default:
    return;
switchD_1108_44e3_caseD_6:
    if (1 < ((FLEET *)lpfl)->cord) {
        lVar21 = EstFuelUse(lpfl, 0, ((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 4 & 0xf, -1, 0);
        iVar13 = (int)((ulong)lVar21 >> 0x10);
        uVar23 = (undefined2)((ulong)lpfl >> 0x10);
        iVar12 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
        if ((iVar12 < iVar13) || ((iVar12 <= iVar13 && (*(uint *)(((FLEET *)lpfl)->rgwtMin + 4) < (uint)lVar21)))) {
            iVar12 = 0;
            goto LAB_1108_422c;
        }
    }
    iVar12 = 1;
LAB_1108_422c:
    local_8e = (float)CONCAT22(iVar12, (int)local_8e);
    uVar23 = (undefined2)((ulong)lpfl >> 0x10);
    DrawMineralItem(hdc, dx * 4 + prc->left, prc->top, -iVar12,
                    CONCAT22(*(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12), (int)((FLEET *)lpfl)->rgwtMin[4]));
    return;
}

// ======================================================================
// Function: DrawMineralItem
// Address: 1108:4ebe
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x11084f0e) */

void DrawMineralItem(HDC hdc, short x, short y, short iMineral, long l)

{
    short cch;
    char *psz;

    if (iMineral < 0) {
        SetTextColor(hdc, 0);
    } else {
        SetTextColor(hdc, CONCAT22(*(undefined2 *)(iMineral * 4 + rgcrMinerals_0x2), *(undefined2 *)(iMineral * 4 + rgcrMinerals)));
    }
    if (l < 0) {
        cch = _strlen(szDblDash);
        psz = szDblDash;
    } else {
        psz = PszFromLongK(l, &cch);
    }
    RightTextOut(hdc, x, y, psz, cch, 0);
    return;
}

// ======================================================================
// Function: PszGetDestName
// Address: 1108:4f60
// Segment: MEMORY_REPORT
// ======================================================================

char *PszGetDestName(FLEET *lpfl, HDC hdc)

{
    short     *psVar1;
    ORDER     *pOVar2;
    undefined2 uVar3;
    uint       uVar4;
    char      *pcVar5;
    int        iVar6;
    FLEET     *pFVar7;
    short     *psVar8;
    ORDER     *pOVar9;
    undefined2 uVar10;
    undefined2 unaff_SS;
    ORDER      ord;
    short      i;

    uVar10 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar7 = (FLEET *)lpfl;
    uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
    psVar8 = (short *)(*(int *)&pFVar7->lpplord + 4);
    pOVar9 = &ord;
    for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
        pOVar2 = pOVar9;
        pOVar9 = &(pOVar9->pt).y;
        psVar1 = psVar8;
        psVar8 = psVar8 + 1;
        (pOVar2->pt).x = *psVar1;
    }
    if (pFVar7->cord < 2) {
        return szDblDash;
    }
    if ((ord.wFlags_0x6 >> 0xc & 1) != 0) {
        uVar4 = ord.wFlags_0x6 & 0xf;
        if (uVar4 == 1) {
            for (i = 0; i < 5; i = i + 1) {
                if (*(uint *)((int)&ord.u_ORDER_0x0008 + i * 2) >> 0xc == 6)
                    goto REPORT_LDelayed;
            }
        } else if (uVar4 == 2) {
            if ((ord.wFlags_0x6 >> 8 & 0xf) == 1) {
                return szDblDash;
            }
        } else {
            if (uVar4 == 4) {
                return szDblDash;
            }
            if (uVar4 == 5) {
                return szDblDash;
            }
            if (uVar4 == 6) {
            REPORT_LDelayed:
                if (hdc != 0) {
                    SetTextColor(hdc, 0x7f);
                }
                pcVar5 = PszGetCompressedString(idsDelayed);
                return pcVar5;
            }
        }
    }
    uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
    psVar8 = (short *)(*(int *)&pFVar7->lpplord + 0x16);
    pOVar9 = &ord;
    for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
        pOVar2 = pOVar9;
        pOVar9 = &(pOVar9->pt).y;
        psVar1 = psVar8;
        psVar8 = psVar8 + 1;
        (pOVar2->pt).x = *psVar1;
    }
    pcVar5 = PszGetLocName(ord.wFlags_0x6 >> 8 & (grobjThing | grobjOther | grobjFleet | grobjPlanet), ord.id, ord.pt.x, ord.pt.y);
    return pcVar5;
}

// ======================================================================
// Function: FDestIsWP0
// Address: 1108:50b4
// Segment: MEMORY_REPORT
// ======================================================================

short FDestIsWP0(FLEET *lpfl)

{
    short     *psVar1;
    ORDER     *pOVar2;
    undefined2 uVar3;
    uint       uVar4;
    int        iVar5;
    FLEET     *pFVar6;
    short     *psVar7;
    ORDER     *pOVar8;
    undefined2 uVar9;
    undefined2 unaff_SS;
    ORDER      ord;
    short      i;

    uVar9 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar6 = (FLEET *)lpfl;
    uVar3 = *(undefined2 *)((int)&pFVar6->lpplord + 2);
    psVar7 = (short *)(*(int *)&pFVar6->lpplord + 4);
    pOVar8 = &ord;
    for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
        pOVar2 = pOVar8;
        pOVar8 = &(pOVar8->pt).y;
        psVar1 = psVar7;
        psVar7 = psVar7 + 1;
        (pOVar2->pt).x = *psVar1;
    }
    if (pFVar6->cord < 2) {
        return 1;
    }
    if ((ord.wFlags_0x6 >> 0xc & 1) != 0) {
        uVar4 = ord.wFlags_0x6 & 0xf;
        if (uVar4 == 1) {
            for (i = 0; i < 5; i = i + 1) {
                if (*(uint *)((int)&ord.u_ORDER_0x0008 + i * 2) >> 0xc == 6) {
                    return 1;
                }
            }
        } else if (uVar4 == 2) {
            if ((ord.wFlags_0x6 >> 8 & 0xf) == 1) {
                return 1;
            }
        } else {
            if (uVar4 == 4) {
                return 1;
            }
            if (uVar4 == 5) {
                return 1;
            }
            if (uVar4 == 6) {
                return 1;
            }
        }
    }
    return 0;
}

// ======================================================================
// Function: PszGetETA
// Address: 1108:51a8
// Segment: MEMORY_REPORT
// ======================================================================

char *PszGetETA(HDC hdc, FLEET *lpfl, short *pcYears)

{
    short     *psVar1;
    ORDER     *pOVar2;
    undefined2 uVar3;
    uint       uVar4;
    int        iVar5;
    int        iVar6;
    FLEET     *pFVar7;
    short     *psVar8;
    ORDER     *pOVar9;
    undefined2 uVar10;
    undefined2 unaff_SS;
    long       lVar11;
    char      *psz;
    ORDER      ord;
    short      i;
    short      c;
    POINT      pt;

    uVar10 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar7 = (FLEET *)lpfl;
    uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
    psVar8 = (short *)(*(int *)&pFVar7->lpplord + 4);
    pOVar9 = &ord;
    for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
        pOVar2 = pOVar9;
        pOVar9 = &(pOVar9->pt).y;
        psVar1 = psVar8;
        psVar8 = psVar8 + 1;
        (pOVar2->pt).x = *psVar1;
    }
    if (pFVar7->cord < 2)
        goto REPORT_LNoETA;
    if ((ord.wFlags_0x6 >> 0xc & 1) != 0) {
        uVar4 = ord.wFlags_0x6 & 0xf;
        if (uVar4 == 1) {
            for (i = 0; i < 5; i = i + 1) {
                if (*(uint *)((int)&ord.u_ORDER_0x0008 + i * 2) >> 0xc == 6)
                    goto REPORT_LNoETA;
            }
        } else if (uVar4 == 2) {
            if ((ord.wFlags_0x6 >> 8 & 0xf) == 1) {
            REPORT_LNoETA:
                if (pcYears == 0) {
                    return szDblDash;
                }
                *pcYears = 0;
                return szDblDash;
            }
        } else if (((uVar4 == 4) || (uVar4 == 5)) || (uVar4 == 6))
            goto REPORT_LNoETA;
    }
    uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
    psVar8 = (short *)(*(int *)&pFVar7->lpplord + 0x16);
    pOVar9 = &ord;
    for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
        pOVar2 = pOVar9;
        pOVar9 = &(pOVar9->pt).y;
        psVar1 = psVar8;
        psVar8 = psVar8 + 1;
        (pOVar2->pt).x = *psVar1;
    }
    CchGetETA(hdc, lpfl, (char *)szWork, 1, 1);
    if (hdc != 0) {
        lVar11 = EstFuelUse(lpfl, 0, ord.wFlags_0x6 >> 4 & 0xf, -1, 0);
        iVar6 = (int)((ulong)lVar11 >> 0x10);
        iVar5 = *(int *)((int)pFVar7->rgwtMin + 0x12);
        if ((iVar5 <= iVar6) && ((iVar5 < iVar6 || (*(uint *)(pFVar7->rgwtMin + 4) < (uint)lVar11)))) {
            SetTextColor(hdc, 0xff);
        }
    }
    if (pcYears != 0) {
        c = 0;
        for (psz = (char *)szWork; ('/' < *psz && (*psz < ':')); psz = psz + 1) {
            c = c * 10 + *psz + -0x30;
        }
        if (c == 0) {
            c = 32000;
        }
        *pcYears = c;
    }
    return (char *)szWork;
}

// ======================================================================
// Function: PszGetTaskName
// Address: 1108:53b8
// Segment: MEMORY_REPORT
// ======================================================================

char *PszGetTaskName(FLEET *lpfl, short *picr)

{
    short     *psVar1;
    ORDER     *pOVar2;
    undefined2 uVar3;
    bool       bVar4;
    StringId   ids_00;
    uint       uVar5;
    short      sVar6;
    char      *pcVar7;
    ushort     uVar8;
    char      *pcVar9;
    int        iVar10;
    FLEET     *pFVar11;
    short     *psVar12;
    ORDER     *pOVar13;
    undefined2 uVar14;
    undefined2 unaff_SS;
    char      *psz;
    short      fPercent;
    ORDER      ord;
    short      i;
    short      iZip;
    short      opOrd;
    short      ids;
    short      icr;

    icr = -1;
    uVar14 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar11 = (FLEET *)lpfl;
    uVar3 = *(undefined2 *)((int)&pFVar11->lpplord + 2);
    psVar12 = (short *)(*(int *)&pFVar11->lpplord + 4);
    pOVar13 = &ord;
    for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
        pOVar2 = pOVar13;
        pOVar13 = &(pOVar13->pt).y;
        psVar1 = psVar12;
        psVar12 = psVar12 + 1;
        (pOVar2->pt).x = *psVar1;
    }
    *picr = -1;
    if ((ord.wFlags_0x6 >> 0xc & 1) != 0) {
        switch (ord.wFlags_0x6 & 0xf) {
        case 1:
            for (i = 0; i < 4; i = i + 1) {
                if (*(uint *)((int)&ord.u_ORDER_0x0008 + i * 2) >> 0xc == 6)
                    goto REPORT_LShowTask;
            }
            break;
        case 2:
        case 4:
        case 5:
        case 6:
        case 8:
            goto REPORT_LShowTask;
        }
    }
    if (1 < pFVar11->cord) {
        uVar3 = *(undefined2 *)((int)&pFVar11->lpplord + 2);
        psVar12 = (short *)(*(int *)&pFVar11->lpplord + 0x16);
        pOVar13 = &ord;
        for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
            pOVar2 = pOVar13;
            pOVar13 = &(pOVar13->pt).y;
            psVar1 = psVar12;
            psVar12 = psVar12 + 1;
            (pOVar2->pt).x = *psVar1;
        }
    }
REPORT_LShowTask:
    pcVar7 = szDblDash;
    if ((ord.wFlags_0x6 >> 0xc & 1) != 0) {
        ids_00 = (ord.wFlags_0x6 & 0xf) + idsTaskHere;
        uVar5 = ord.wFlags_0x6 & 0xf;
        if (uVar5 == 1) {
            for (i = 0; i < 4; i = i + 1) {
                if ((*(char *)((int)&vrgZip[0].fValid + i * 0x18) != '\0') && (sVar6 = _memcmp((ZIPORDER *)vrgZip + i, &ord.u_ORDER_0x0008, 10), sVar6 == 0)) {
                    return (char *)((int)vrgZip[0].szName + i * 0x18);
                }
            }
            ids = 0x6d;
            iZip = -1;
            if ((((uint)ord.u_ORDER_0x0008.txp.rgia[4].wFlags >> 0xc == 7) &&
                 (((uint)ord.u_ORDER_0x0008.txp.rgia[3].wFlags >> 0xc == 0 ||
                   (((uint)ord.u_ORDER_0x0008.txp.rgia[3].wFlags >> 0xc == 2 && (ord.u_ORDER_0x0008.tlm.cTime >> 0xc == 2)))))) &&
                ((uVar5 = ord.u_ORDER_0x0008.tlm.cTime >> 0xc, uVar5 == 1 || ((uVar5 == 2 || (uVar5 == 6)))))) {
                i = 1;
                while ((i < 3 && (*(uint *)((int)&ord.u_ORDER_0x0008 + i * 2) >> 0xc == uVar5))) {
                    i = i + 1;
                }
                if (i == 3) {
                    if (uVar5 == 1) {
                        iZip = 0;
                    } else if (uVar5 == 2) {
                        iZip = 1;
                    } else if (uVar5 == 6) {
                        iZip = 2;
                    }
                    return (char *)*(undefined2 *)(iZip * 2 + rgszZipOrder);
                }
            }
            for (i = 4; -1 < i; i = i + -1) {
                uVar5 = *(uint *)((int)&ord.u_ORDER_0x0008 + i * 2) >> 0xc;
                if ((uint)ids < uVar5 + 0x6d) {
                    ids = uVar5 + 0x6d;
                    icr = i;
                }
            }
            if (ids == 0x6d) {
                pcVar7 = PszGetCompressedString(idsTransport);
            } else {
                uVar5 = *(uint *)((int)&ord.u_ORDER_0x0008 + icr * 2);
                *picr = icr;
                bVar4 = false;
                switch (uVar5 >> 0xc) {
                default:
                    pcVar7 = szDblDash;
                    break;
                case 5:
                case 6:
                    bVar4 = true;
                case 4:
                case 8:
                case 9:
                    pcVar7 = PszGetCompressedString(ids);
                    uVar8 = _strlen(pcVar7);
                    pcVar7[uVar8 - 3] = '\0';
                    if (bVar4) {
                        _wsprintf(szWork, "%s %d%%", pcVar7, 0x1120, *(uint *)((int)&ord.u_ORDER_0x0008 + icr * 2) & 0xfff);
                    } else {
                        if (icr == 4) {
                            pcVar9 = (char *)"%s %dmg";
                        } else {
                            pcVar9 = (char *)"%s %dkT";
                        }
                        _wsprintf(szWork, pcVar9, pcVar7, 0x1120, *(uint *)((int)&ord.u_ORDER_0x0008 + icr * 2) & 0xfff);
                    }
                    pcVar7 = (char *)szWork;
                    break;
                case 7:
                    if (icr == 4) {
                        ids = 0x77;
                    }
                case 1:
                case 2:
                    pcVar7 = PszGetCompressedString(ids);
                }
            }
        } else if (uVar5 == 6) {
            if (ord.u_ORDER_0x0008.tlm.cTime < 5) {
                iVar10 = ord.u_ORDER_0x0008.tlm.cTime + 1;
                pcVar7 = PszGetCompressedString(ids_00);
                _wsprintf(szWork, "%s  %dy", pcVar7, 0x1120, iVar10);
            } else {
                CchGetString(ids_00, (char *)szWork);
            }
            pcVar7 = (char *)szWork;
        } else if (uVar5 == 7) {
            if (ord.u_ORDER_0x0008.tlm.cTimeOld < 0xb) {
                iVar10 = (ord.u_ORDER_0x0008.tlm.cTimeOld + 1) * 0x32;
                pcVar7 = PszGetCompressedString(ids_00);
                _wsprintf(szWork, "%s  %dly", pcVar7, 0x1120, iVar10);
            } else {
                CchGetString(ids_00, (char *)szWork);
            }
            pcVar7 = (char *)szWork;
        } else {
            pcVar7 = PszGetCompressedString(ids_00);
        }
    }
    return pcVar7;
}

// ======================================================================
// Function: SortReportCache
// Address: 1108:589c
// Segment: MEMORY_REPORT
// ======================================================================

void SortReportCache(short irpt, short icol)

{
    FLEET     *pFVar1;
    int        iVar2;
    undefined2 uVar3;
    undefined2 unaff_SS;
    short      i;
    FLEET     *lpfl;
    PLANET    *lppl;
    ushort     iItem;
    short      cRows;
    PLANET    *lpplMac;
    ushort     rgidRep[1024];

    cRows = 0;
    iItem = 0;
    if (vprptCur->icolSort != icol) {
        vicolSortPrev = vprptCur->icolSort;
        viSubsortPrev = vprptCur->iSubsort;
        vfAscendingPrev = vprptCur->fAscending;
        vprptCur->icolSort = icol;
        gd.grBits2._0_2_ = (uint)gd.grBits2 & 0xff7f | 0x80;
    }
    if ((hwndReportDlg != 0) || (vprptCur->fCached == 0)) {
        if (irpt == 0) {
            vlprgidRep._0_2_ = (ushort *)vlprgidPlanet;
            vlprgidRep._2_2_ = vlprgidPlanet._2_2_;
            lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, (PLANET *)lpPlanets);
            while ((PLANET *)lppl < (PLANET *)lpPlanets + cPlanet) {
                uVar3 = (undefined2)((ulong)lppl >> 0x10);
                if ((((PLANET *)lppl)->iPlayer == idPlayer) && ((((PLANET *)lppl)->wFlags_0x4 & 0xff) == 7)) {
                    rgidRep[cRows] = iItem;
                    cRows = cRows + 1;
                }
                iItem = iItem + 1;
                lppl = (PLANET *)CONCAT22(uVar3, (PLANET *)lppl + 1);
            }
        } else if (irpt == 1) {
            vlprgidRep._0_2_ = (ushort *)vlprgidFleet;
            vlprgidRep._2_2_ = vlprgidFleet._2_2_;
            for (iItem = 0; (int)iItem < cFleet; iItem = iItem + 1) {
                /* WARNING: Load size is inaccurate */
                pFVar1 = ((FLEET **)rglpfl)[iItem];
                iVar2 = *(int *)((int)((FLEET **)rglpfl + iItem) + 2);
                lpfl = (FLEET *)CONCAT22(iVar2, pFVar1);
                if ((pFVar1 == 0) && (iVar2 == 0))
                    break;
                if (((uint)lpfl->id >> 9 & 0xf) == idPlayer) {
                    rgidRep[cRows] = iItem;
                    cRows = cRows + 1;
                }
            }
        } else if (irpt == 2) {
            vlprgidRep._0_2_ = (ushort *)vlprgidMisc;
            vlprgidRep._2_2_ = vlprgidMisc._2_2_;
            vrptBattle.fCached = 0;
            for (iItem = 0; (int)iItem < cFleet; iItem = iItem + 1) {
                /* WARNING: Load size is inaccurate */
                pFVar1 = ((FLEET **)rglpfl)[iItem];
                iVar2 = *(int *)((int)((FLEET **)rglpfl + iItem) + 2);
                lpfl = (FLEET *)CONCAT22(iVar2, pFVar1);
                if ((pFVar1 == 0) && (iVar2 == 0))
                    break;
                if (((uint)lpfl->id >> 9 & 0xf) != idPlayer) {
                    rgidRep[cRows] = iItem;
                    cRows = cRows + 1;
                }
                if (0x3fb < cRows)
                    break;
            }
        } else {
            if (irpt != 3) {
                return;
            }
            vlprgidRep._0_2_ = (ushort *)vlprgidMisc;
            vlprgidRep._2_2_ = vlprgidMisc._2_2_;
            vrptEFleet.fCached = 0;
            cRows = CBattles();
            for (i = 0; i < cRows; i = i + 1) {
                rgidRep[i] = i;
            }
        }
        vprptCur->cRows = cRows;
        _qsort(rgidRep, cRows, 2, (void *)((int)rgplr[2].szName + 0x16));
        __fmemcpy((ushort *)CONCAT22(vlprgidRep._2_2_, (ushort *)vlprgidRep), rgidRep, cRows << 1);
        vprptCur->fCached = 1;
    }
    return;
}

// ======================================================================
// Function: ICompReport
// Address: 1108:5bb8
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Variable defined which should be unmapped: iLast */
/* WARNING: Removing unreachable block (ram,0x11086012) */
/* WARNING: Removing unreachable block (ram,0x11086072) */
/* WARNING: Removing unreachable block (ram,0x1108695b) */

short ICompReport(void *arg1, void *arg2)

{
    uint       uVar1;
    FLEET     *pFVar2;
    BTLDATA   *pBVar3;
    int        iVar4;
    short      sVar5;
    PLANET    *pPVar6;
    FLEET     *pFVar7;
    char      *pcVar8;
    int        iVar9;
    undefined2 unaff_SI;
    undefined2 unaff_DI;
    undefined2 uVar10;
    undefined2 unaff_SS;
    bool       bVar11;
    undefined1 uVar12;
    ulong      uVar13;
    long       lVar14;
    HULDEF    *pHVar15;
    ulong      uVar16;
    short      iLast;
    uint       local_8c[4];
    short     *local_84;
    undefined4 local_82;
    undefined4 local_7e;
    undefined4 local_7a;
    undefined4 local_76;
    short      irpt;
    short      fTier2;
    short      i2;
    short      iRet;
    char      *psz;
    short      iSubsort;
    long       l1;
    short      i;
    short      j;
    short      i1;
    short      icolSort;
    short      fAscending;
    long       l2;
    char       szT[80];

    uVar13 = CONCAT22(l2._2_2_, (uint)l2);
    uVar16 = CONCAT22(unaff_SI, unaff_DI);
    iRet = 0;
    iSubsort = vprptCur->iSubsort;
    irpt = vprptCur->irpt;
    icolSort = vprptCur->icolSort;
    fAscending = vprptCur->fAscending;
    fTier2 = 0;
    do {
        pBVar3 = local_7e;
        l2 = uVar13;
        if (irpt == 0) {
            pPVar6 = (PLANET *)lpPlanets + *(int *)arg1;
            local_7a = (FLEET *)CONCAT22(lpPlanets._2_2_, pPVar6);
            pFVar7 = (PLANET *)lpPlanets + *(int *)arg2;
            local_76 = (FLEET *)CONCAT22(lpPlanets._2_2_, pFVar7);
            switch (icolSort) {
            case 0:
                psz = PszGetPlanetName(local_7a->id);
                _strcpy(szT, psz);
                psz = PszGetPlanetName(local_76->id);
                iRet = _strcmp(szT, psz);
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 1:
                if ((pPVar6->wFlags_0x4 >> 9 & 1) == 0) {
                    iRet = (short)((pFVar7->wFlags_0x4 >> 9 & 1) != 0);
                } else if ((pFVar7->wFlags_0x4 >> 9 & 1) == 0) {
                    iRet = -1;
                } else {
                    iRet =
                        __fstrcmp((char *)CONCAT22(*(undefined2 *)(idPlayer * 4 + rglpshdefSB_0x2),
                                                   (char *)(*(int *)(idPlayer * 4 + rglpshdefSB) + (*(uint *)&pPVar6->lStarbase & 0xf) * 0x93 + 8)),
                                  (char *)CONCAT22(*(undefined2 *)(idPlayer * 4 + rglpshdefSB_0x2),
                                                   (char *)(*(int *)(idPlayer * 4 + rglpshdefSB) + ((&pFVar7->u_FLEET_0x002c)->rgdv[0].dp & 0xf) * 0x93 + 8)));
                    pBVar3 = local_7e;
                    uVar13 = l2;
                }
                break;
            case 2:
                iRet = (int)pPVar6->rgwtMin[3] - (int)*(long *)(pFVar7->rgcsh + 0xe);
                break;
            case 3:
                sVar5 = PctPlanetCapacity((PLANET *)CONCAT22(lpPlanets._2_2_, pFVar7));
                local_7e = (BTLDATA *)CONCAT22(sVar5, (BTLDATA *)local_7e);
                sVar5 = PctPlanetCapacity(local_7a);
                iRet = sVar5 - local_7e._2_2_;
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 4:
                sVar5 = PctPlanetDesirability((PLANET *)CONCAT22(lpPlanets._2_2_, pFVar7), idPlayer);
                local_7e = (BTLDATA *)CONCAT22(sVar5, (BTLDATA *)local_7e);
                sVar5 = PctPlanetDesirability(local_7a, idPlayer);
                iRet = sVar5 - local_7e._2_2_;
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 5:
                FillPlanetProdLB(0, 0, (PLANET *)CONCAT22(lpPlanets._2_2_, pPVar6));
                _strcpy(szT, (char *)szWork);
                FillPlanetProdLB(0, 0, local_76);
                iRet = _strcmp(szT + 6, (char *)szWork + 6);
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 6:
                uVar13 = __aFulshr(uVar16, iLast);
                uVar10 = (undefined2)((ulong)local_7a >> 0x10);
                local_7e = (BTLDATA *)CONCAT22(*(undefined2 *)(((PLANET *)local_7a)->rgbImp + 2), *(BTLDATA **)((PLANET *)local_7a)->rgbImp);
                local_82 = (float)(ulong)((uint)uVar13 & 0xfff);
                uVar13 = __aFulshr(uVar16, iLast);
                iRet = ((uint)uVar13 & 0xfff) - (int)local_82;
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 7:
                uVar13 = __aFulshr(uVar16, iLast);
                uVar10 = (undefined2)((ulong)local_7a >> 0x10);
                local_7e = (BTLDATA *)CONCAT22(*(undefined2 *)(((PLANET *)local_7a)->rgbImp + 2), *(BTLDATA **)((PLANET *)local_7a)->rgbImp);
                local_82 = (float)(ulong)((uint)uVar13 & 0xfff);
                uVar13 = __aFulshr(uVar16, iLast);
                iRet = ((uint)uVar13 & 0xfff) - (int)local_82;
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 8:
                if ((*(uint *)(pPVar6->rgbImp + 4) & 0xfff) == 0) {
                    local_8c[1] = 0;
                    local_8c[2] = 0;
                    local_82 = 0.0;
                } else {
                    CalcPctSurvive((PLANET *)CONCAT22(lpPlanets._2_2_, pPVar6), &local_82, 0);
                    local_82 = FLOAT_1_0_1120_1e0a - local_82;
                    uVar13 = l2;
                }
                bVar11 = (((FLEET *)local_76)->rgcsh[6] & 0xfffU) == 0;
                if (bVar11) {
                    local_8c[1] = 0;
                    local_8c[2] = 0;
                    local_7e = 0;
                } else {
                    l2 = uVar13;
                    CalcPctSurvive(local_76, &local_7e, 0);
                    local_7e = (BTLDATA *)(FLOAT_1_0_1120_1e0a - (float)local_7e);
                    uVar13 = l2;
                }
                uVar12 = bVar11 || &stack0x0000 == (undefined1 *)((int)game.szName + 2);
                bVar11 = !bVar11 && (undefined1 *)0xfff7 < &stack0xff66;
                l2 = uVar13;
                __aFfcompp();
                if (bVar11) {
                    iRet = -1;
                    pBVar3 = local_7e;
                    uVar13 = l2;
                } else {
                    __aFfcompp();
                    pBVar3 = local_7e;
                    uVar13 = l2;
                    if (bVar11 || (bool)uVar12) {
                        iRet = 0;
                    } else {
                        iRet = 1;
                    }
                }
                break;
            case 9:
                if (iSubsort == 3) {
                    local_7e = (BTLDATA *)0x2;
                } else {
                    local_7e = (BTLDATA *)CONCAT22(iSubsort, iSubsort);
                }
                l2._0_2_ = 0;
                l2._2_2_ = 0;
                l1._0_2_ = 0;
                l1._2_2_ = 0;
                i = local_7e._2_2_;
                while (true) {
                    uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                    if ((int)(BTLDATA *)local_7e < i)
                        break;
                    uVar1 = *(uint *)(pPVar6->rgwtMin + i);
                    bVar11 = CARRY2((uint)l1, uVar1);
                    l1._0_2_ = (uint)l1 + uVar1;
                    l1._2_2_ = l1._2_2_ + *(uint *)((int)(pPVar6->rgwtMin + i) + 2) + (uint)bVar11;
                    uVar1 = *(uint *)(pFVar7->rgwtMin + i + -0xc);
                    bVar11 = CARRY2((uint)l2, uVar1);
                    l2._0_2_ = (uint)l2 + uVar1;
                    l2._2_2_ = l2._2_2_ + *(uint *)((int)(pFVar7->rgwtMin + i + -0xc) + 2) + (uint)bVar11;
                    i = i + 1;
                }
                iVar4 = (uint)l1 - (uint)l2;
                iVar9 = (l1._2_2_ - l2._2_2_) - (uint)((uint)l1 < (uint)l2);
                l1 = CONCAT22(iVar9, iVar4);
                pBVar3 = local_7e;
                if ((iVar9 < 1) && (iVar9 < 0)) {
                    iRet = -1;
                } else if ((iVar9 < 0) || ((iVar9 < 1 && (iVar4 == 0)))) {
                    iRet = 0;
                } else {
                    iRet = 1;
                }
                break;
            case 10:
                if (iSubsort == 3) {
                    local_7e = (BTLDATA *)((ulong)local_7e & 0xffff);
                    iLast = 2;
                } else {
                    iLast = iSubsort;
                    local_7e = (BTLDATA *)CONCAT22(iSubsort, (BTLDATA *)local_7e);
                }
                EstMineralsMined((PLANET *)CONCAT22(lpPlanets._2_2_, pPVar6), local_8c, -1, 0);
                l1._0_2_ = 0;
                l1._2_2_ = 0;
                for (i = local_7e._2_2_; i <= iLast; i = i + 1) {
                    bVar11 = CARRY2((uint)l1, local_8c[i * 2]);
                    l1._0_2_ = (uint)l1 + local_8c[i * 2];
                    l1._2_2_ = l1._2_2_ + local_8c[i * 2 + 1] + (uint)bVar11;
                }
                EstMineralsMined(local_76, local_8c, -1, 0);
                l2._0_2_ = 0;
                l2._2_2_ = 0;
                for (i = local_7e._2_2_; i <= iLast; i = i + 1) {
                    bVar11 = CARRY2((uint)l2, local_8c[i * 2]);
                    l2._0_2_ = (uint)l2 + local_8c[i * 2];
                    l2._2_2_ = l2._2_2_ + local_8c[i * 2 + 1] + (uint)bVar11;
                }
                iRet = (uint)l1 - (uint)l2;
                pBVar3 = local_7e;
                uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                break;
            case 0xb:
                if (iSubsort == 3) {
                    i2 = 0;
                    i1 = 0;
                    for (i = 0; i < 3; i = i + 1) {
                        i1 = i1 + (uint)pPVar6->rgMinConc[i];
                        i2 = i2 + (uint)(byte) * (char *)((int)pFVar7->rgcsh + i + -3);
                    }
                } else {
                    i1 = (short)pPVar6->rgMinConc[iSubsort];
                    i2 = (short)(byte) * (char *)((int)pFVar7->rgcsh + iSubsort + -3);
                }
                iRet = i1 - i2;
                break;
            case 0xc:
                sVar5 = CResourcesAtPlanet((PLANET *)CONCAT22(lpPlanets._2_2_, pFVar7), idPlayer);
                local_7e = (BTLDATA *)CONCAT22(sVar5, (BTLDATA *)local_7e);
                sVar5 = CResourcesAtPlanet(local_7a, idPlayer);
                iRet = sVar5 - local_7e._2_2_;
                pBVar3 = local_7e;
                uVar13 = l2;
                break;
            case 0xd:
                if ((*(uint *)((int)&pPVar6->lStarbase + 2) & 0x3ff) == 0) {
                    iRet = (short)((*(uint *)((int)&pFVar7->u_FLEET_0x002c + 2) & 0x3ff) != 0);
                } else if ((*(uint *)((int)&pFVar7->u_FLEET_0x002c + 2) & 0x3ff) == 0) {
                    iRet = -1;
                } else {
                    psz = PszGetPlanetName((*(uint *)((int)&pPVar6->lStarbase + 2) & 0x3ff) - 1);
                    _strcpy(szT, psz);
                    psz = PszGetPlanetName((*(uint *)((int)&((FLEET *)local_76)->u_FLEET_0x002c + 2) & 0x3ff) - 1);
                    iRet = _strcmp(szT, psz);
                    pBVar3 = local_7e;
                    uVar13 = l2;
                }
                break;
            case 0xe:
                if ((pPVar6->wRouting & 0x3ff) == 0) {
                    iRet = (short)((*(ushort *)((int)&pFVar7->u_FLEET_0x002c + 4) & 0x3ff) != 0);
                } else if ((*(ushort *)((int)&pFVar7->u_FLEET_0x002c + 4) & 0x3ff) == 0) {
                    iRet = -1;
                } else {
                    psz = PszGetPlanetName((pPVar6->wRouting & 0x3ff) - 1);
                    _strcpy(szT, psz);
                    psz = PszGetPlanetName((*(ushort *)((int)&((FLEET *)local_76)->u_FLEET_0x002c + 4) & 0x3ff) - 1);
                    iRet = _strcmp(szT, psz);
                    pBVar3 = local_7e;
                    uVar13 = l2;
                }
            }
            goto switchD_1108_63af_default;
        }
        if (irpt != 1) {
            if (irpt != 2) {
                if (irpt != 3)
                    goto switchD_1108_63af_default;
                local_7a._0_2_ = *(FLEET **)arg1;
                local_7a._2_2_ = *(short *)arg2;
                local_76 = BtlDataGet((short)(FLEET *)local_7a);
                local_7e = BtlDataGet(local_7a._2_2_);
                iVar4 = (int)((ulong)local_7e >> 0x10);
                pBVar3 = local_7e;
                uVar13 = l2;
                if ((((FLEET *)local_76 == 0) && (local_76._2_2_ == 0)) || (((BTLDATA *)local_7e == 0 && (iVar4 == 0)))) {
                    iRet = 0;
                    goto switchD_1108_63af_default;
                }
                switch (icolSort) {
                case 0:
                    if ((&((FLEET *)local_76)->pt)->x == -1) {
                        pcVar8 = PszGetCompressedString(idsSpaceDD);
                        _wsprintf(szT, pcVar8);
                    } else {
                        psz = PszGetPlanetName((&((FLEET *)local_76)->pt)->x);
                        _strcpy(szT, psz);
                    }
                    uVar10 = (undefined2)((ulong)local_7e >> 0x10);
                    if (((BTLDATA *)local_7e)->idPlanet == 0xffff) {
                        pcVar8 = PszGetCompressedString(idsSpaceDD);
                        _wsprintf(szWork, pcVar8);
                        psz = (char *)szWork;
                    } else {
                        psz = PszGetPlanetName(((BTLDATA *)local_7e)->idPlanet);
                    }
                    iRet = _strcmp(szT, psz);
                    pBVar3 = local_7e;
                    uVar13 = l2;
                    goto switchD_1108_63af_default;
                case 1:
                    lVar14 = CBattleUnits(local_76, 5);
                    if (lVar14 == 0) {
                        l1 = lVar14;
                        CBattleUnits(local_76, 6);
                        lVar14 = __aFlshl(uVar16, iLast);
                    }
                    l1 = lVar14;
                    uVar13 = CBattleUnits(local_7e, 5);
                    if (uVar13 == 0) {
                        l2 = uVar13;
                        CBattleUnits(local_7e, 6);
                        uVar13 = __aFlshl(uVar16, iLast);
                    }
                    goto REPORT_LRetDiff;
                case 2:
                    l1 = (long)*(byte *)&((FLEET *)local_76)->iPlayer;
                    uVar13 = (ulong)((BTLDATA *)local_7e)->cplr;
                    goto REPORT_LRetDiff;
                case 3:
                    i = 0xff;
                    break;
                case 4:
                    i = 0xfd;
                    break;
                case 5:
                    i = 0xfe;
                    break;
                case 6:
                    i = 0xb;
                    break;
                case 7:
                    i = 0x13;
                    break;
                case 8:
                    i = 0x23;
                    break;
                case 9:
                    i = 0x43;
                    break;
                case 10:
                    i = 0x83;
                    break;
                case 0xb:
                case 0xc:
                    lVar14 = CBattleKills(local_76, (uint)(icolSort == 0xb));
                    l1 = lVar14;
                    uVar13 = CBattleKills(local_7e, (uint)(icolSort == 0xb));
                    goto REPORT_LRetDiff;
                case 0xd:
                    i = 0xfd;
                    goto REPORT_LUnitsLeft;
                case 0xe:
                    i = 0xfe;
                REPORT_LUnitsLeft:
                    lVar14 = CBattleUnits(local_76, i);
                    l1 = lVar14;
                    lVar14 = CBattleUnits(local_7e, i);
                    l2 = lVar14;
                    lVar14 = CBattleKills(local_76, (uint)(icolSort == 0xd));
                    l1 = l1 - lVar14;
                    lVar14 = CBattleKills(local_7e, (uint)(icolSort == 0xd));
                    uVar13 = l2 - lVar14;
                    goto REPORT_LRetDiff;
                default:
                    goto switchD_1108_63af_default;
                }
                lVar14 = CBattleUnits(local_76, i);
                l1 = lVar14;
                uVar13 = CBattleUnits(local_7e, i);
                goto REPORT_LRetDiff;
            }
            /* WARNING: Load size is inaccurate */
            pFVar7 = ((FLEET **)rglpfl)[*(int *)arg1];
            iVar4 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg1) + 2);
            local_7a = (FLEET *)CONCAT22(iVar4, pFVar7);
            /* WARNING: Load size is inaccurate */
            pFVar2 = ((FLEET **)rglpfl)[*(int *)arg2];
            iVar9 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg2) + 2);
            local_76 = (FLEET *)CONCAT22(iVar9, pFVar2);
            switch (icolSort) {
            case 0:
                psz = PszGetFleetName(local_7a->id);
                _strcpy(szT, psz);
                psz = PszGetFleetName(local_76->id);
                iRet = _strcmp(szT, psz);
                pBVar3 = local_7e;
                uVar13 = l2;
                goto switchD_1108_63af_default;
            case 1:
                l1 = (long)(local_7a->id & 0x1ff);
                uVar13 = (ulong)(local_76->id & 0x1ff);
                break;
            case 2:
                if (pFVar7->idPlanet == -1) {
                    pcVar8 = PszGetCompressedString(idsSpaceDD);
                    _wsprintf(szT, pcVar8);
                } else {
                    psz = PszGetPlanetName(pFVar7->idPlanet);
                    _strcpy(szT, psz);
                }
                uVar10 = (undefined2)((ulong)local_76 >> 0x10);
                if (((FLEET *)local_76)->idPlanet == -1) {
                    pcVar8 = PszGetCompressedString(idsSpaceDD);
                    _wsprintf(szWork, pcVar8);
                    psz = (char *)szWork;
                } else {
                    psz = PszGetPlanetName(((FLEET *)local_76)->idPlanet);
                }
                iRet = _strcmp(szT, psz);
                pBVar3 = local_7e;
                uVar13 = l2;
                goto switchD_1108_63af_default;
            case 3:
                if ((*(uint *)((int)&pFVar7->dirLong + 2) >> 4 & 1) == 0) {
                    l1._0_2_ = 0xffff;
                    l1._2_2_ = 0xffff;
                } else {
                    l1._0_2_ = *(uint *)((int)&pFVar7->dirLong + 2) & 0xf;
                    l1._2_2_ = 0;
                }
                if ((*(uint *)((int)&pFVar2->dirLong + 2) >> 4 & 1) == 0) {
                    l2._0_2_ = 0xffff;
                    l2._2_2_ = 0xffff;
                } else {
                    l2._0_2_ = *(uint *)((int)&pFVar2->dirLong + 2) & 0xf;
                    l2._2_2_ = 0;
                }
                uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                break;
            case 4:
                l1 = CONCAT22(*(undefined2 *)((int)&pFVar7->u_FLEET_0x002c + 2), (&pFVar7->u_FLEET_0x002c)->rgdv[0].dp);
                uVar13 = CONCAT22(*(undefined2 *)((int)&pFVar2->u_FLEET_0x002c + 2), (&pFVar2->u_FLEET_0x002c)->rgdv[0].dp);
                break;
            case 5:
                sVar5 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar4, pFVar7), &i1);
                l1._2_2_ = sVar5 >> 0xf;
                l1._0_2_ = sVar5;
                sVar5 = IshdefPrimaryFromLpfl(local_76, &i2);
                l2._2_2_ = sVar5 >> 0xf;
                l2._0_2_ = sVar5;
                if (((uint)l1 == sVar5) && (l1._2_2_ == l2._2_2_)) {
                    local_7e = (BTLDATA *)CONCAT22(local_7a._2_2_, ((FLEET *)local_7a)->rgcsh);
                    lVar14 = __aFlshl(uVar16, iLast);
                    local_84 = ((FLEET *)local_76)->rgcsh;
                    local_82 = (float)CONCAT22(*(undefined2 *)((int)&((BTLDATA *)local_7e)->id + (int)lVar14), local_76._2_2_);
                    lVar14 = __aFlshl(uVar16, iLast);
                    iRet = local_82._2_2_ - *(int *)(char *)((int)local_84 + (int)lVar14);
                } else {
                    uVar13 = __aFulmul((long)sVar5, 0x93);
                    iVar4 = ((FLEET *)local_76)->iPlayer * 4;
                    uVar10 = *(undefined2 *)(iVar4 + rglpshdef_0x2);
                    pcVar8 = (char *)(*(int *)(iVar4 + rglpshdef) + (int)uVar13 + 8);
                    uVar13 = __aFulmul(CONCAT22(l1._2_2_, (uint)l1), 0x93);
                    iVar4 = ((FLEET *)local_7a)->iPlayer * 4;
                    iRet = __fstrcmp((char *)CONCAT22(*(undefined2 *)(iVar4 + rglpshdef_0x2), (char *)(*(int *)(iVar4 + rglpshdef) + (int)uVar13 + 8)),
                                     (char *)CONCAT22(uVar10, pcVar8));
                    if (iRet == 0) {
                        local_7e = (BTLDATA *)CONCAT22(local_7a._2_2_, ((FLEET *)local_7a)->rgcsh);
                        lVar14 = __aFlshl(uVar16, iLast);
                        local_84 = ((FLEET *)local_76)->rgcsh;
                        local_82 = (float)CONCAT22(*(undefined2 *)((int)&((BTLDATA *)local_7e)->id + (int)lVar14), local_76._2_2_);
                        lVar14 = __aFlshl(uVar16, iLast);
                        iRet = local_82._2_2_ - *(int *)(char *)((int)local_84 + (int)lVar14);
                    }
                    if (iRet == 0) {
                        iRet = (uint)l1 - (uint)l2;
                    }
                }
                pBVar3 = local_7e;
                uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                if (iRet == 0) {
                    iRet = i1 - i2;
                }
                goto switchD_1108_63af_default;
            case 6:
                l2._0_2_ = 0;
                l2._2_2_ = 0;
                l1._0_2_ = 0;
                l1._2_2_ = 0;
                i = 0;
                while (true) {
                    uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                    if (0xf < i)
                        break;
                    uVar1 = pFVar7->rgcsh[i];
                    bVar11 = CARRY2((uint)l1, uVar1);
                    l1._0_2_ = (uint)l1 + uVar1;
                    l1._2_2_ = l1._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
                    uVar1 = pFVar2->rgcsh[i];
                    bVar11 = CARRY2((uint)l2, uVar1);
                    l2._0_2_ = (uint)l2 + uVar1;
                    l2._2_2_ = l2._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
                    i = i + 1;
                }
                break;
            case 7:
                l2._0_2_ = 0;
                l2._2_2_ = 0;
                l1._0_2_ = 0;
                l1._2_2_ = 0;
                i = 0;
                while (true) {
                    uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                    if (0xf < i)
                        break;
                    if (((FLEET *)local_7a)->rgcsh[i] != 0) {
                        iVar4 = ((FLEET *)local_7a)->iPlayer * 4;
                        pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + rglpshdef) + i * 0x93));
                        j = ((HULDEF *)pHVar15)->wFlags_0x7b >> 10 & 0xf;
                        if (((uint)j < 2) || (5 < (uint)j)) {
                            uVar1 = ((FLEET *)local_7a)->rgcsh[i];
                            bVar11 = CARRY2((uint)l1, uVar1);
                            l1._0_2_ = (uint)l1 + uVar1;
                            l1._2_2_ = l1._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
                        }
                    }
                    if (((FLEET *)local_76)->rgcsh[i] != 0) {
                        iVar4 = ((FLEET *)local_76)->iPlayer * 4;
                        pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + rglpshdef) + i * 0x93));
                        j = ((HULDEF *)pHVar15)->wFlags_0x7b >> 10 & 0xf;
                        if (((uint)j < 2) || (5 < (uint)j)) {
                            uVar1 = ((FLEET *)local_76)->rgcsh[i];
                            bVar11 = CARRY2((uint)l2, uVar1);
                            l2._0_2_ = (uint)l2 + uVar1;
                            l2._2_2_ = l2._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
                        }
                    }
                    i = i + 1;
                }
                break;
            case 8:
                j = 2;
                goto REPORT_LEFleetCount;
            case 9:
                j = 3;
                goto REPORT_LEFleetCount;
            case 10:
                j = 5;
                goto REPORT_LEFleetCount;
            case 0xb:
                j = 4;
            REPORT_LEFleetCount:
                l2._0_2_ = 0;
                l2._2_2_ = 0;
                l1._0_2_ = 0;
                l1._2_2_ = 0;
                i = 0;
                while (true) {
                    uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                    if (0xf < i)
                        break;
                    if ((((FLEET *)local_7a)->rgcsh[i] != 0) &&
                        (iVar4 = ((FLEET *)local_7a)->iPlayer * 4, pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + rglpshdef) + i * 0x93)),
                         (((HULDEF *)pHVar15)->wFlags_0x7b >> 10 & 0xf) == j)) {
                        uVar1 = ((FLEET *)local_7a)->rgcsh[i];
                        bVar11 = CARRY2((uint)l1, uVar1);
                        l1._0_2_ = (uint)l1 + uVar1;
                        l1._2_2_ = l1._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
                    }
                    if ((((FLEET *)local_76)->rgcsh[i] != 0) &&
                        (iVar4 = ((FLEET *)local_76)->iPlayer * 4, pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + rglpshdef) + i * 0x93)),
                         (((HULDEF *)pHVar15)->wFlags_0x7b >> 10 & 0xf) == j)) {
                        uVar1 = ((FLEET *)local_76)->rgcsh[i];
                        bVar11 = CARRY2((uint)l2, uVar1);
                        l2._0_2_ = (uint)l2 + uVar1;
                        l2._2_2_ = l2._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
                    }
                    i = i + 1;
                }
                break;
            default:
                goto switchD_1108_63af_default;
            }
            goto REPORT_LRetDiff;
        }
        /* WARNING: Load size is inaccurate */
        pFVar7 = ((FLEET **)rglpfl)[*(int *)arg1];
        iVar4 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg1) + 2);
        local_7a = (FLEET *)CONCAT22(iVar4, pFVar7);
        /* WARNING: Load size is inaccurate */
        pFVar2 = ((FLEET **)rglpfl)[*(int *)arg2];
        iVar9 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg2) + 2);
        local_76 = (FLEET *)CONCAT22(iVar9, pFVar2);
        switch (icolSort) {
        case 0:
            psz = PszGetFleetName(local_7a->id);
            _strcpy(szT, psz);
            psz = PszGetFleetName(local_76->id);
            iRet = _strcmp(szT, psz);
            pBVar3 = local_7e;
            uVar13 = l2;
            break;
        case 1:
            l1 = (long)local_7a->id;
            uVar13 = (ulong)local_76->id;
            goto REPORT_LRetDiff;
        case 2:
            if (pFVar7->idPlanet == -1) {
                pcVar8 = PszGetCompressedString(idsSpaceDD);
                _wsprintf(szT, pcVar8);
            } else {
                psz = PszGetPlanetName(pFVar7->idPlanet);
                _strcpy(szT, psz);
            }
            uVar10 = (undefined2)((ulong)local_76 >> 0x10);
            if (((FLEET *)local_76)->idPlanet == -1) {
                pcVar8 = PszGetCompressedString(idsSpaceDD);
                _wsprintf(szWork, pcVar8);
                psz = (char *)szWork;
            } else {
                psz = PszGetPlanetName(((FLEET *)local_76)->idPlanet);
            }
            iRet = _strcmp(szT, psz);
            pBVar3 = local_7e;
            uVar13 = l2;
            break;
        case 3:
            psz = PszGetDestName((FLEET *)CONCAT22(iVar4, pFVar7), 0);
            _strcpy(szT, psz);
            psz = PszGetDestName(local_76, 0);
            iRet = _strcmp(szT, psz);
            pBVar3 = local_7e;
            uVar13 = l2;
            if (iRet < 0) {
                iRet = -1;
            } else if (0 < iRet) {
                iRet = 1;
            }
            break;
        case 4:
            PszGetETA(0, (FLEET *)CONCAT22(iVar4, pFVar7), &i1);
            PszGetETA(0, local_76, &i2);
            iRet = i1 - i2;
            pBVar3 = local_7e;
            uVar13 = l2;
            break;
        case 5:
            psz = PszGetTaskName((FLEET *)CONCAT22(iVar4, pFVar7), &i1);
            _strcpy(szT, psz);
            psz = PszGetTaskName(local_76, &i2);
            iRet = _strcmp(szT, psz);
            pBVar3 = local_7e;
            uVar13 = l2;
            if (iRet < 0) {
                iRet = -1;
            } else if (iRet < 1) {
                if (i2 < i1) {
                    iRet = 1;
                } else if (i1 < i2) {
                    iRet = -1;
                }
            } else {
                iRet = 1;
            }
            break;
        case 6:
            iSubsort = -1;
        case 7:
            if (iSubsort == 4) {
                l2._0_2_ = 0;
                l2._2_2_ = 0;
                l1._0_2_ = 0;
                l1._2_2_ = 0;
                i = 0;
                while (true) {
                    uVar13 = CONCAT22(l2._2_2_, (uint)l2);
                    if (3 < i)
                        break;
                    uVar1 = *(uint *)(pFVar7->rgwtMin + i);
                    bVar11 = CARRY2((uint)l1, uVar1);
                    l1._0_2_ = (uint)l1 + uVar1;
                    l1._2_2_ = l1._2_2_ + *(uint *)((int)(pFVar7->rgwtMin + i) + 2) + (uint)bVar11;
                    uVar1 = *(uint *)(pFVar2->rgwtMin + i);
                    bVar11 = CARRY2((uint)l2, uVar1);
                    l2._0_2_ = (uint)l2 + uVar1;
                    l2._2_2_ = l2._2_2_ + *(uint *)((int)(pFVar2->rgwtMin + i) + 2) + (uint)bVar11;
                    i = i + 1;
                }
            } else {
                if (iSubsort == -1) {
                    iSubsort = 4;
                }
                l1 = CONCAT22(*(undefined2 *)((int)(pFVar7->rgwtMin + iSubsort) + 2), (int)pFVar7->rgwtMin[iSubsort]);
                uVar13 = CONCAT22(*(undefined2 *)((int)(pFVar2->rgwtMin + iSubsort) + 2), (int)pFVar2->rgwtMin[iSubsort]);
            }
            goto REPORT_LRetDiff;
        case 8:
            sVar5 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar4, pFVar7), &i1);
            l1._2_2_ = sVar5 >> 0xf;
            l1._0_2_ = sVar5;
            sVar5 = IshdefPrimaryFromLpfl(local_76, &i2);
            l2._2_2_ = sVar5 >> 0xf;
            l2._0_2_ = sVar5;
            if (((uint)l1 == sVar5) && (l1._2_2_ == l2._2_2_)) {
                local_7e = (BTLDATA *)CONCAT22(local_7a._2_2_, ((FLEET *)local_7a)->rgcsh);
                lVar14 = __aFlshl(uVar16, iLast);
                local_84 = ((FLEET *)local_76)->rgcsh;
                local_82 = (float)CONCAT22(*(undefined2 *)((int)&((BTLDATA *)local_7e)->id + (int)lVar14), local_76._2_2_);
                lVar14 = __aFlshl(uVar16, iLast);
                iRet = local_82._2_2_ - *(int *)(char *)((int)local_84 + (int)lVar14);
            } else {
                uVar13 = __aFulmul((long)sVar5, 0x93);
                pcVar8 = (char *)((int)&rgshdef[0].hul + 8 + (int)uVar13);
                uVar13 = __aFulmul(CONCAT22(l1._2_2_, (uint)l1), 0x93);
                iRet = _strcmp((char *)((int)&rgshdef[0].hul + 8 + (int)uVar13), pcVar8);
                if (iRet == 0) {
                    local_7e = (BTLDATA *)CONCAT22(local_7a._2_2_, ((FLEET *)local_7a)->rgcsh);
                    lVar14 = __aFlshl(uVar16, iLast);
                    local_84 = ((FLEET *)local_76)->rgcsh;
                    local_82 = (float)CONCAT22(*(undefined2 *)((int)&((BTLDATA *)local_7e)->id + (int)lVar14), local_76._2_2_);
                    lVar14 = __aFlshl(uVar16, iLast);
                    iRet = local_82._2_2_ - *(int *)(char *)((int)local_84 + (int)lVar14);
                }
                if (iRet == 0) {
                    iRet = (uint)l1 - (uint)l2;
                }
            }
            pBVar3 = local_7e;
            uVar13 = CONCAT22(l2._2_2_, (uint)l2);
            if (iRet == 0) {
                iRet = i1 - i2;
            }
            break;
        case 9:
            sVar5 = PctCloakFromLpfl((FLEET *)CONCAT22(iVar4, pFVar7));
            l1._2_2_ = sVar5 >> 0xf;
            l1._0_2_ = sVar5;
            sVar5 = PctCloakFromLpfl(local_76);
            uVar13 = (ulong)sVar5;
            goto REPORT_LRetDiff;
        case 10:
            local_7e = (BTLDATA *)(ulong)CONCAT12(pFVar2->iplan, (BTLDATA *)local_7e);
            pBVar3 = local_7e;
            local_7e._2_2_ = (uint)pFVar2->iplan;
            iRet = pFVar7->iplan - local_7e._2_2_;
            break;
        case 0xb:
            lVar14 = WtFromLpfl((FLEET *)CONCAT22(iVar4, pFVar7));
            l1 = lVar14;
            uVar13 = WtFromLpfl(local_76);
        REPORT_LRetDiff:
            l1 = l1 - uVar13;
            pBVar3 = local_7e;
            if ((l1 < 0x10000) && (l1 < 0)) {
                iRet = -1;
            } else if (l1 < 1) {
                iRet = 0;
            } else {
                iRet = 1;
            }
        }
    switchD_1108_63af_default:
        local_7e = pBVar3;
        if (fAscending == 0) {
            iRet = -iRet;
        }
        if ((((iRet != 0) || (fTier2 != 0)) || ((icolSort == vicolSortPrev && (iSubsort == viSubsortPrev)))) || (vicolSortPrev < 0)) {
            return iRet;
        }
        icolSort = vicolSortPrev;
        iSubsort = viSubsortPrev;
        fAscending = vfAscendingPrev;
        fTier2 = 1;
    } while (true);
}

// ======================================================================
// Function: ReportColumnPopup
// Address: 1108:74d4
// Segment: MEMORY_REPORT
// ======================================================================

void ReportColumnPopup(POINT pt, short icol, short fRightBtn)

{
    uint    *puVar1;
    int      iVar2;
    bool     bVar3;
    RPT     *pRVar4;
    int      iVar5;
    HDC      hdc_00;
    StringId ids;
    short    sVar6;
    char    *pcVar7;
    short    sVar8;
    uint     uVar9;
    short    iSortLast;
    short    iHide;
    short    iRet;
    short    cch;
    char    *psz[32];
    short    cItems;
    char     szColTitle[50];
    short    rgcol[32];
    short    fccolChange;
    short    ibit;
    short    i;
    short    j;
    short    cSubsort;
    short    iBase;
    char     rgsz[32][50];
    char     szT[50];
    HDC      hdc;

    cSubsort = 0;
    bVar3 = false;
    hdc_00 = GetDC(hwndReportDlg);
    DxReportColHdr(vprptCur->irpt, icol, szColTitle, hdc_00);
    cItems = 0;
    for (i = 0; i < 2; i = i + 1) {
        if (i == 0) {
            ids = idsSort;
        } else {
            ids = idsReverseSort;
        }
        sVar6 = CchGetString(ids, rgsz[cItems]);
        _strcpy(rgsz[cItems] + sVar6, szColTitle);
        iVar2 = cItems + 1;
        if (((vprptCur->irpt == 0) && (((icol == 0xb || (icol == 9)) || (icol == 10)))) || ((vprptCur->irpt == 1 && (icol == 7)))) {
            _strcpy(rgsz[iVar2], rgsz[cItems]);
            (*(rgsz + cItems))[0] = '\0';
            cItems = cItems + 2;
            for (j = 0; j < (int)((vprptCur->irpt == 1) + 3); j = j + 1) {
                _strcpy(rgsz[cItems], (char *)*(undefined2 *)(j * 2 + rgszMinerals));
                cItems = cItems + 1;
            }
            (*(rgsz + cItems))[0] = -1;
            rgsz[cItems][1] = '\0';
            pcVar7 = PszGetCompressedString(idsWeightedAverage);
            _strcpy(rgsz[cItems + 1], pcVar7);
            (*(rgsz + cItems + 2))[0] = '\0';
            cSubsort = 5;
            iVar2 = cItems + 3;
        }
        cItems = iVar2;
    }
    (*(rgsz + cItems))[0] = -1;
    rgsz[cItems][1] = '\0';
    iVar2 = cItems + 1;
    sVar6 = CchGetString(idsHide, rgsz[iVar2]);
    _strcpy(rgsz[iVar2] + sVar6, szColTitle);
    CchGetString(idsColumn, szT);
    _strcat(rgsz[iVar2], szT);
    (*(rgsz + cItems + 2))[0] = -1;
    rgsz[cItems + 2][1] = '\0';
    iHide = iVar2;
    iVar5 = cItems + 3;
    if (icol == 0) {
        iHide = -1;
        iVar5 = cItems + 1;
    }
    cItems = iVar5;
    sVar6 = cItems;
    ibit = 1;
    for (i = 0; i < vprptCur->cFields; i = i + 1) {
        if (((ibit & (uint)vprptCur->grbitVisible) == 0) && ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) == 0)) {
            DxReportColHdr(vprptCur->irpt, i, szColTitle, hdc_00);
            sVar8 = CchGetString(idsShow, rgsz[cItems]);
            _strcpy(rgsz[cItems] + sVar8, szColTitle);
            CchGetString(idsColumn, szT);
            _strcat(rgsz[cItems], szT);
            rgcol[cItems] = i;
            cItems = cItems + 1;
        }
        ibit = ibit << 1;
    }
    if (cItems == sVar6) {
        cItems = cItems + -1;
    }
    ReleaseDC(hwndReportDlg, hdc_00);
    for (i = 0; i < cItems; i = i + 1) {
        if ((*(rgsz + i))[0] == '\0') {
            psz[i] = 0;
        } else {
            psz[i] = rgsz[i];
        }
    }
    sVar8 = PopupMenu(hwndReportDlg, pt.x, pt.y, cItems, 0, psz, -1, fRightBtn);
    pRVar4 = vprptCur;
    if (-1 < sVar8) {
        gd.grBits2._0_2_ = (uint)gd.grBits2 & 0xff7f | 0x80;
        if (sVar8 < iVar2) {
            vicolSortPrev = vprptCur->icolSort;
            viSubsortPrev = vprptCur->iSubsort;
            vfAscendingPrev = vprptCur->fAscending;
            vprptCur->icolSort = icol;
            if (cSubsort == 0) {
                vprptCur->fAscending = (uint)(sVar8 == 0);
            } else {
                vprptCur->iSubsort = (sVar8 + -2) % (int)(cSubsort + 3 + (uint)(vprptCur->irpt == 1));
                if ((int)((vprptCur->irpt == 1) + 3) < vprptCur->iSubsort) {
                    vprptCur->iSubsort = (vprptCur->irpt == 1) + 3;
                }
                vprptCur->fAscending = (uint)(sVar8 < cSubsort + 2);
            }
            SortReportCache(vprptCur->irpt, icol);
        } else if (sVar8 == iHide) {
            bVar3 = true;
            uVar9 = ~(1 << ((byte)icol & 0x1f));
            *&vprptCur->grbitVisible = (uint)vprptCur->grbitVisible & uVar9;
            puVar1 = (uint *)((int)&pRVar4->grbitVisible + 2);
            *puVar1 = *puVar1 & (int)uVar9 >> 0xf;
        } else if (sVar6 <= sVar8) {
            bVar3 = true;
            uVar9 = 1 << ((byte)rgcol[sVar8] & 0x1f);
            *&vprptCur->grbitVisible = (uint)vprptCur->grbitVisible | uVar9;
            puVar1 = (uint *)((int)&pRVar4->grbitVisible + 2);
            *puVar1 = *puVar1 | (int)uVar9 >> 0xf;
        }
        if (bVar3) {
            SetHScrollBar();
        }
        InvalidateRect(hwndReportDlg, 0, 1);
    }
    return;
}

// ======================================================================
// Function: InvalidateReport
// Address: 1108:7af6
// Segment: MEMORY_REPORT
// ======================================================================

void InvalidateReport(short irpt, short fReload)

{
    bool        bVar1;
    undefined1 *puVar2;
    undefined2  uVar3;
    undefined2  unaff_SS;
    RECT        rc;
    ushort     *lprgidSav;
    RPT        *prptSav;
    short       fClearRpt;
    short       fResetRpt;

    uVar3 = 0x1108;
    puVar2 = &stack0xffe6;
    fClearRpt = 0;
    bVar1 = false;
    if ((((uint)gd.grBits >> 1 & 1) == 0) && (fAi == 0)) {
        if ((hwndReportDlg == 0) || (irpt != vprptCur->irpt)) {
            if (vprptCur == 0) {
                fClearRpt = fReload;
                if (irpt == 0) {
                    vprptCur = (RPT *)&vrptPlanet;
                    puVar2 = &stack0xffe6;
                } else {
                    vprptCur = (RPT *)&vrptFleet;
                    puVar2 = &stack0xffe6;
                }
            } else if ((fReload != 0) && (puVar2 = &stack0xffe6, vprptCur->irpt != irpt)) {
                lprgidSav._0_2_ = (ushort *)vlprgidRep;
                lprgidSav._2_2_ = vlprgidRep._2_2_;
                prptSav = vprptCur;
                bVar1 = true;
                if (irpt == 0) {
                    vprptCur = (RPT *)&vrptPlanet;
                    puVar2 = &stack0xffe6;
                } else {
                    vprptCur = (RPT *)&vrptFleet;
                    puVar2 = &stack0xffe6;
                }
            }
        } else {
            GetClientRect(hwndReportDlg, &rc);
            if (fReload != 2) {
                rc.top = dyArial8 + 6;
                rc.bottom = (dyArial8 + 4) * vprptCur->cRowsVis + rc.top;
            }
            uVar3 = 0x14f8;
            InvalidateRect(hwndReportDlg, &rc, (uint)(fReload == 2));
            gd.grBits._2_2_ = gd.grBits._2_2_ & 0xfdff | 0x200;
            puVar2 = &stack0xffe8;
        }
        vprptCur->fCached = 0;
        if (fReload != 0) {
            *(short *)(puVar2 + -2) = vprptCur->icolSort;
            *(short *)(puVar2 + -4) = vprptCur->irpt;
            *(undefined2 *)(puVar2 + -6) = uVar3;
            uVar3 = 0x1108;
            *(undefined2 *)(puVar2 + -8) = 0x7c3e;
            SortReportCache(*(short *)(puVar2 + -4), *(short *)(puVar2 + -2));
        }
        if (fClearRpt == 0) {
            if (bVar1) {
                vprptCur = prptSav;
                vlprgidRep._0_2_ = (ushort *)lprgidSav;
                vlprgidRep._2_2_ = lprgidSav._2_2_;
            } else if (((fReload != 0) && (hwndReportDlg != 0)) && (irpt == vprptCur->irpt)) {
                *(ushort *)(puVar2 + -2) = vprptCur->hwndVScroll;
                *(undefined2 *)(puVar2 + -4) = 2;
                *(undefined2 *)(puVar2 + -6) = 0;
                *(short *)(puVar2 + -8) = vprptCur->cRows - vprptCur->cRowsVis;
                *(undefined2 *)(puVar2 + -10) = 0;
                *(undefined2 *)(puVar2 + -0xc) = uVar3;
                *(undefined2 *)(puVar2 + -0xe) = 0x7cbb;
                SetScrollRange(*(HWND *)(puVar2 + -2), *(short *)(puVar2 + -4), *(short *)(puVar2 + -6), *(short *)(puVar2 + -8), *(BOOL *)(puVar2 + -10));
                *(HWND *)(puVar2 + -2) = hwndReportDlg;
                *(undefined2 *)(puVar2 + -4) = 0;
                *(undefined2 *)(puVar2 + -6) = 0;
                *(undefined2 *)(puVar2 + -8) = 1;
                *(undefined2 *)(puVar2 + -10) = 0x14f8;
                *(undefined2 *)(puVar2 + -0xc) = 0x7cd0;
                InvalidateRect(*(HWND *)(puVar2 + -2), *(RECT **)(puVar2 + -6), *(BOOL *)(puVar2 + -8));
            }
        } else {
            vprptCur = 0;
        }
    }
    return;
}

// ======================================================================
// Function: ExecuteReportClick
// Address: 1108:7cd6
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x11087ea5) */
/* WARNING: Variable defined which should be unmapped: scan */
/* WARNING: Enum "WParamMessageId": Some values do not have unique names */

void ExecuteReportClick(POINT pt, short irpt, short icol, short irow)

{
    FLEET     *pFVar1;
    ushort     uVar2;
    int        iVar3;
    POINT      pt_00;
    POINT      pt_01;
    POINT      pt_02;
    BTLDATA   *pBVar4;
    undefined2 uVar5;
    HDC        HVar6;
    short      sVar7;
    PLANET    *pPVar8;
    int        iVar9;
    undefined2 unaff_SI;
    undefined2 unaff_DI;
    ulong      uVar10;
    BTLDATA   *pBVar11;
    SCAN       scan;
    SCAN       SStack_3a;
    short      dxOffset;
    short      xCur;
    long       rglQuan[4];
    short      ibit;
    FLEET     *lpfl;
    short      i;
    PLANET    *lppl;
    BTLDATA   *lpbd;
    HDC        hdc;

    uVar10 = CONCAT22(unaff_SI, unaff_DI);
    HVar6 = GetDC(hwndReportDlg);
    uVar5 = lpPlanets._2_2_;
    if (irpt != 0) {
        if (irpt == 1) {
            /* WARNING: Load size is inaccurate */
            pFVar1 = ((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[irow]];
            uVar2 = *(ushort *)((int)((FLEET **)rglpfl + ((ushort *)vlprgidFleet)[irow]) + 2);
            lpfl = (FLEET *)CONCAT22(uVar2, pFVar1);
            if (mdXferDlg == -1) {
                SelectAdjFleet(0, lpfl->id);
                InvalidateReport(1, 0);
                switch (icol) {
                case 3:
                case 4:
                case 5:
                    sVar7 = FDestIsWP0((FLEET *)CONCAT22(uVar2, pFVar1));
                    if (sVar7 == 0) {
                        SendMessage(hwndShipLB, CB_GETCURSEL, 1, 0);
                        SetScanWp(1);
                    }
                    break;
                case 6:
                case 7:
                    if (mdXferDlg == -1) {
                        if (sel.fl.idPlanet == -1) {
                            TransferStuff(sel.fl.id, 2, -1, 4, 0);
                        } else {
                            TransferStuff(sel.fl.id, 2, sel.fl.idPlanet, 1, 0);
                        }
                    }
                    break;
                case 8:
                    GlobalPD.grPopup = 3;
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = 1;
                    GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory = 0xff;
                    GlobalPD.u_POPUPDATA_0x0002.part.hs.grhst = (HullSlotType)pFVar1;
                    GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 = uVar2;
                    Popup(hwndReportDlg, pt.x, pt.y);
                }
            } else {
                MessageBeep(0);
            }
        } else if (irpt == 2) {
            if ((vprptCur == (RPT *)&vrptEFleet) && (-3 < irow)) {
                if (irow < 0) {
                    if (irow == -1) {
                        irowEFleetCur = irowEFleetCur + 1;
                    } else {
                        irowEFleetCur = irowEFleetCur + -1;
                    }
                    if (irowEFleetCur < vrptEFleet.cRows) {
                        if (irowEFleetCur < 0) {
                            irowEFleetCur = vrptEFleet.cRows + -1;
                        }
                    } else {
                        irowEFleetCur = 0;
                    }
                    irow = irowEFleetCur;
                }
                iVar9 = *(int *)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow]);
                iVar3 = *(int *)((int)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow]) + 2);
                if (mdXferDlg == -1) {
                    pt_00.y = *(short *)(iVar9 + 10);
                    pt_00.x = *(short *)(iVar9 + 8);
                    FFindNearestObject(pt_00, grobjFleet, &SStack_3a);
                    SStack_3a.ifl = ((ushort *)vlprgidMisc)[irow];
                    ChangeScanSel(&SStack_3a, 2);
                    pt_02.y = *(short *)(iVar9 + 10);
                    pt_02.x = *(short *)(iVar9 + 8);
                    FEnsurePointOnScreen(pt_02, 1);
                    irowEFleetCur = irow;
                    InvalidateReport(2, 0);
                } else {
                    MessageBeep(0);
                }
            }
        } else if (irpt == 3) {
            pBVar11 = BtlDataGet(((ushort *)vlprgidMisc)[irow]);
            iVar9 = (int)((ulong)pBVar11 >> 0x10);
            pBVar4 = (BTLDATA *)pBVar11;
            if ((pBVar4 != 0) || (iVar9 != 0)) {
                if (((&pBVar4->pt)->x != sel.scan.pt.x) || ((pBVar4->pt).y != sel.scan.pt.y)) {
                    scan.pt.x = (&pBVar4->pt)->x;
                    scan.pt.y = (pBVar4->pt).y;
                    scan.grobj = 0x8f;
                    ChangeScanSel(&scan, 0);
                    pt_01.y = scan.pt.y;
                    pt_01.x = scan.pt.x;
                    CtrPointScan(pt_01, 1);
                    InvalidateReport(0, 0);
                    if (((&pBVar4->pt)->x == sel.scan.pt.x) && ((pBVar4->pt).y == sel.scan.pt.y))
                        goto switchD_1108_82b9_default;
                }
                if (hwndVCRDlg == 0) {
                    BattleVCR(pBVar11->id);
                }
            }
        }
        goto switchD_1108_82b9_default;
    }
    pPVar8 = (PLANET *)lpPlanets + ((ushort *)vlprgidPlanet)[irow];
    lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, pPVar8);
    if (hwndProdDlg != 0) {
        MessageBeep(0);
        goto switchD_1108_82b9_default;
    }
    SelectAdjPlanet(0, lppl->id);
    InvalidateReport(0, 0);
    switch (icol) {
    case 0:
        if (((pPVar8->wFlags_0x4 >> 9 & 1) != 0) && ((int)((uint)vprptCur->rgbdx[0] * 2 + -8) < pt.x)) {
        REPORT_LShowStarbase:
            GlobalPD.grPopup = 0xb;
            GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2 = *(ushort *)(idPlayer * 4 + rglpshdefSB_0x2);
            GlobalPD.u_POPUPDATA_0x0002.lpfl._0_2_ = (FLEET *)(*(int *)(idPlayer * 4 + rglpshdefSB) + ((uint)sel.pl.lStarbase & 0xf) * 0x93);
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate = 0;
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = 1;
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory = 0;
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary = 0;
            Popup(hwndReportDlg, pt.x, pt.y);
        }
        break;
    case 1:
        if ((pPVar8->wFlags_0x4 >> 9 & 1) != 0)
            goto REPORT_LShowStarbase;
        break;
    case 2:
    case 4:
        GlobalPD.grPopup = 7;
        GlobalPD.u_POPUPDATA_0x0002.dxOut = sel.pl.id;
        Popup(hwndReportDlg, pt.x, pt.y);
        break;
    case 5:
        if (hwndProdDlg == 0) {
            ChangeProduction(0);
        }
        break;
    case 6:
    case 7:
        GlobalPD.grPopup = 8;
        GlobalPD.u_POPUPDATA_0x0002.dxOut = sel.pl.id;
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory = (short)(icol == 7);
        if (GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory == 0) {
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax = CMaxMines(&sel.pl, idPlayer);
            uVar10 = __aFulshr(uVar10, scan.pt.x);
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = (uint)uVar10 & 0xfff;
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate = CMaxOperableMines(&sel.pl, idPlayer, 0);
        } else {
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax = CMaxFactories(&sel.pl, idPlayer);
            uVar10 = __aFulshr(uVar10, scan.pt.x);
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = (uint)uVar10 & 0xfff;
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate = CMaxOperableFactories(&sel.pl, idPlayer, 0);
        }
        Popup(hwndReportDlg, pt.x, pt.y);
        break;
    case 8:
        if ((sel.pl.rgbImp._4_2_ & 0xfff) != 0) {
            FGetBestDefensePart((PART *)&GlobalPD.u_POPUPDATA_0x0002.part);
            GlobalPD.grPopup = 9;
            Popup(hwndReportDlg, pt.x, pt.y);
        }
        break;
    case 9:
    case 10:
    case 0xb:
        xCur = 2;
        ibit = 1;
        for (i = 0; i < icol; i = i + 1) {
            if ((((ibit & (uint)vprptCur->grbitVisible) != 0) || ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
                ((i == 0 || (vprptCur->cFieldFirst <= i)))) {
                xCur = xCur + (uint)vprptCur->rgbdx[i] * 2;
            }
            ibit = ibit << 1;
        }
        dxOffset = pt.x - xCur;
        for (i = 1; (i < 4 && (scan.ith = i * 2, (int)(scan.ith * (uint)vprptCur->rgbdx[icol]) / 3 <= dxOffset)); i = i + 1) {
        }
        iVar9 = i + -1;
        GlobalPD.grPopup = 1;
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax = iVar9 >> 0xf;
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fFactory = *(short *)((int)&sel.pl + 0x1c + iVar9 * 4);
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.fSummary = *(short *)((int)&sel.pl + 0x1e + iVar9 * 4);
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMin = (short)*(byte *)((int)&sel.pl + 8 + i);
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.iPlrMax = 0;
        GlobalPD.u_POPUPDATA_0x0002.dxOut = iVar9;
        EstMineralsMined(&sel.pl, rglQuan, -1, 0);
        GlobalPD.u_POPUPDATA_0x0002.rgi[4]._0_2_ = (undefined2)rglQuan[iVar9];
        GlobalPD.u_POPUPDATA_0x0002.rgi[4]._2_2_ = *(undefined2 *)((int)rglQuan + iVar9 * 4 + 2);
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = sel.pl.wFlags_0x4 >> 10 & 1;
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cOperate = 0;
        Popup(hwndReportDlg, pt.x, pt.y);
        break;
    case 0xc:
        GlobalPD.grPopup = 0xc;
        GlobalPD.u_POPUPDATA_0x0002.dxOut = sel.pl.id;
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax = CResourcesAtPlanet(&sel.pl, idPlayer);
        GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = GlobalPD.u_POPUPDATA_0x0002.part.hs.wFlags_0x2;
        uVar10 = __aFulshr(uVar10, scan.pt.x);
        if ((uVar10 & 1) == 0) {
            sVar7 = MulDiv(GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cMax, (int)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0), 100);
            GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur = GlobalPD.u_POPUPDATA_0x0002.s_POPUPDATA_0x0002.cCur - sVar7;
        }
        Popup(hwndReportDlg, pt.x, pt.y);
    }
switchD_1108_82b9_default:
    ReleaseDC(hwndReportDlg, HVar6);
    return;
}

// ======================================================================
// Function: DumpUniverse
// Address: 1108:851e
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x11088586) */

void DumpUniverse(void)

{
    bool bVar1;
    short (*pasVar2)[9];
    short      sVar3;
    short      sVar4;
    ushort     cb;
    StringId   ids_00;
    char      *pcVar5;
    char      *pcVar6;
    undefined2 uVar7;
    short      cch;
    short (*penvMemSav)[9];
    short fSilentSav;
    short fSuccess;
    short fOpen;
    short env[9];
    short i;
    short ids;

    sVar3 = fFileErrSilent;
    pasVar2 = penvMem;
    bVar1 = true;
    if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
        bVar1 = false;
        penvMem = pasVar2;
        fFileErrSilent = sVar3;
    } else {
        penvMemSav = penvMem;
        penvMem = &env;
        sVar4 = __setjmp(env);
        if (sVar4 == 0) {
            fFileErrSilent = 1;
            _wsprintf(szWork, "%s.map", (char *)szBase, 0x1120);
            StreamOpen((char *)szWork, mdCreate);
            RgToStream("#\tX\tY\tName\r\n", 0xc);
            for (i = 0; i < game.cPlanMax; i = i + 1) {
                pcVar5 = PszGetCompressedPlanet(((short *)rgidPlan)[i]);
                cb = _wsprintf(szWork, "%d\t%d\t%d\t%s\r\n", i + 1, ((POINT *)rgptPlan + i)->x, *(undefined2 *)((int)&rgptPlan[0].y + i * 4), pcVar5, 0x1120);
                RgToStream(szWork, cb);
            }
            StreamClose();
        } else {
            bVar1 = false;
            penvMem = pasVar2;
            fFileErrSilent = sVar3;
        }
    }
    if (bVar1) {
        ids_00 = idsUniverseDefinitionHasSuccessfullyWrittenSMap;
    } else {
        ids_00 = idsUnableWriteUniverseDefinitionSMapOperation;
    }
    uVar7 = 0x1120;
    pcVar6 = (char *)szBase;
    pcVar5 = PszGetCompressedString(ids_00);
    _wsprintf(szWork, pcVar5, pcVar6, uVar7);
    if (bVar1) {
        AlertSz((char *)szWork, 0x40);
    } else {
        AlertSz((char *)szWork, 0x10);
    }
    fFileErrSilent = sVar3;
    penvMem = penvMemSav;
    return;
}

// ======================================================================
// Function: DumpPlanets
// Address: 1108:86e4
// Segment: MEMORY_REPORT
// ======================================================================

void DumpPlanets(void)

{
    short      sVar1;
    char      *pcVar2;
    ushort     uVar3;
    undefined2 uVar4;
    StringId   ids_00;
    char      *pcVar5;
    PLANET    *pPVar6;
    int        iVar7;
    undefined2 unaff_SI;
    ushort     unaff_DI;
    undefined2 uVar8;
    undefined2 unaff_SS;
    long       lVar9;
    ulong      uVar10;
    short     *psVar11;
    undefined2 in_stack_0000fdac;
    undefined2 in_stack_0000fdae;
    undefined4 local_240;
    undefined2 local_23c;
    undefined2 uStack_23a;
    undefined8 local_238;
    short      cch;
    char      *psz;
    short (*penvMemSav)[9];
    short   fSilentSav;
    short   fSuccess;
    short   fOpen;
    short   env[9];
    short   i;
    short   j;
    char    szForm[256];
    char    szFile[256];
    PLANET *lppl;
    short   ids;
    PLANET *lpplMac;

    fSilentSav = fFileErrSilent;
    fSuccess = 1;
    fOpen = 0;
    if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
        fSuccess = 0;
    } else {
        penvMemSav = penvMem;
        penvMem = &env;
        sVar1 = __setjmp(env);
        if (sVar1 == 0) {
            fFileErrSilent = 1;
            if ((gd.grBits2._2_2_ >> 5 & 1) == 0) {
                _wsprintf(szFile, "%s.pla", (char *)szBase, 0x1120);
            } else {
                _wsprintf(szFile, "%s.p%d", (char *)szBase, 0x1120, idPlayer + 1);
            }
            StreamOpen(szFile, mdCreate);
            fOpen = 1;
            j = (gd.grBits2._2_2_ >> 5 & 1) + 2;
            for (i = 0; i < j; i = i + 1) {
                cch = CchGetString(i + idsPlanetNameOwnerStarbaseTypeReportAge, szForm);
                for (psz = szForm; *psz != '\0'; psz = psz + 1) {
                    if (*psz == '*') {
                        *psz = '\t';
                    }
                }
                RgToStream(szForm, cch);
                if (i == j + -1) {
                    RgToStream(szCRLF, 2);
                }
            }
            local_238._6_2_ = lpPlanets._2_2_;
            local_238._4_2_ = (PLANET *)lpPlanets;
            pPVar6 = (PLANET *)lpPlanets + cPlanet;
            lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, (PLANET *)lpPlanets);
            while ((PLANET *)lppl < pPVar6) {
                pcVar2 = PszGetCompressedPlanet(((short *)rgidPlan)[lppl->id]);
                _strcpy(szForm, pcVar2);
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                szForm[0] = '\t';
                uVar8 = (undefined2)((ulong)lppl >> 0x10);
                if (((PLANET *)lppl)->iPlayer == -1) {
                    RgToStream(szForm, 1);
                } else {
                    pcVar2 = PszPlayerName(((PLANET *)lppl)->iPlayer, 1, 0, 0, 0, 0);
                    _strcpy(szForm + 1, pcVar2);
                    uVar3 = _strlen(szForm);
                    RgToStream(szForm, uVar3);
                }
                if ((((PLANET *)lppl)->iPlayer == -1) || ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) == 0)) {
                    cch = 1;
                } else {
                    iVar7 = ((PLANET *)lppl)->iPlayer * 4;
                    __fstrcpy(szForm + 1, (char *)CONCAT22(*(undefined2 *)(iVar7 + rglpshdefSB_0x2),
                                                           (char *)(*(int *)(iVar7 + rglpshdefSB) + (*(uint *)&((PLANET *)lppl)->lStarbase & 0xf) * 0x93 + 8)));
                    cch = _strlen(szForm);
                }
                RgToStream(szForm, cch);
                __itoa(game.turn - ((PLANET *)lppl)->turn, szForm + 1, 10);
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                szForm[1] = '\0';
                if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) == 7) {
                    psVar11 = 0;
                    uVar10 = __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe), (int)((PLANET *)lppl)->rgwtMin[3]), 100);
                    pcVar2 = PszFromLong(uVar10, psVar11);
                    _strcpy(szForm + 1, pcVar2);
                } else if ((((PLANET *)lppl)->iPlayer != -1) && (2 < (((PLANET *)lppl)->wFlags_0x4 & 0xff))) {
                    local_238._4_4_ = (u_PART_0x0004)__aFulmul((ulong)(((PLANET *)lppl)->uGuesses & 0xfff), 400);
                    pcVar2 = PszFromLong((long)local_238._4_4_, 0);
                    _strcpy(szForm + 1, pcVar2);
                }
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) < 3) {
                    szForm[1] = '\0';
                } else {
                    i = PctPlanetDesirability(lppl, idPlayer);
                    _wsprintf(szForm + 1, PCTDPCTPCT, i);
                }
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                szForm[1] = '\0';
                if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) == 7) {
                    FillPlanetProdLB(0, 0, lppl);
                    _strcpy(szForm + 1, (char *)szWork);
                }
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) == 7) {
                    CalcPctSurvive(lppl, (float *)((int)&local_238 + 4), 0);
                    local_238._4_4_ = (ARMOR *)(FLOAT_1_0_1120_1e0a - local_238._4_4_);
                    local_23c = 100;
                    uStack_23a = 0;
                    __ftol((double)CONCAT26(in_stack_0000fdae, CONCAT24(in_stack_0000fdac, CONCAT22(unaff_SI, unaff_DI))));
                    lVar9 = __ftol((double)CONCAT26(in_stack_0000fdae, CONCAT24(in_stack_0000fdac, CONCAT22(unaff_SI, unaff_DI))));
                    uVar4 = (undefined2)lVar9;
                    in_stack_0000fdac = 100;
                    in_stack_0000fdae = 0;
                    lVar9 = __ftol((double)CONCAT26(100, CONCAT24(unaff_SI, CONCAT22(unaff_DI, uVar4))));
                    uVar3 = (ushort)lVar9;
                    uVar10 = __aFulshr(CONCAT22(uVar4, uVar3), unaff_DI);
                    uVar10 = __aFulshr((ulong)((uint)uVar10 & 0xfff), uVar3);
                    _wsprintf(szForm + 1, "%ld\t%ld\t%d.%d%%", (uint)uVar10 & 0xfff, 0);
                } else {
                    szForm[2] = '\t';
                    szForm[1] = '\t';
                    szForm[3] = '\0';
                    if (((gd.grBits2._2_2_ >> 5 & 1) != 0) && (((PLANET *)lppl)->uGuesses >> 0xc != 0)) {
                        cch = _wsprintf(szForm + 3, "%d%%", (((PLANET *)lppl)->uGuesses >> 0xc) * 6 + 3);
                        szForm[cch + 3] = '\0';
                    }
                }
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                szForm[1] = '\0';
                for (i = 0; i < 3; i = i + 1) {
                    if (2 < (((PLANET *)lppl)->wFlags_0x4 & 0xff)) {
                        pcVar2 = PszFromLong(CONCAT22(*(undefined2 *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2), (int)((PLANET *)lppl)->rgwtMin[i]), 0);
                        _strcpy(szForm + 1, pcVar2);
                    }
                    uVar3 = _strlen(szForm);
                    RgToStream(szForm, uVar3);
                }
                szForm[1] = '\0';
                for (i = 0; i < 3; i = i + 1) {
                    if (3 < (((PLANET *)lppl)->wFlags_0x4 & 0xff)) {
                        EstMineralsMined(lppl, &local_240, -1, 0);
                        pcVar2 = PszFromLong(CONCAT22(*(undefined2 *)((int)&local_240 + i * 4 + 2), *(undefined2 *)(&local_240 + i)), 0);
                        _strcpy(szForm + 1, pcVar2);
                    }
                    uVar3 = _strlen(szForm);
                    RgToStream(szForm, uVar3);
                }
                szForm[1] = '\0';
                for (i = 0; i < 3; i = i + 1) {
                    if (2 < (((PLANET *)lppl)->wFlags_0x4 & 0xff)) {
                        pcVar2 = PszFromInt((uint)((PLANET *)lppl)->rgMinConc[i], 0);
                        _strcpy(szForm + 1, pcVar2);
                    }
                    uVar3 = _strlen(szForm);
                    RgToStream(szForm, uVar3);
                }
                if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) == 7) {
                    psVar11 = 0;
                    sVar1 = CResourcesAtPlanet(lppl, idPlayer);
                    pcVar2 = PszFromInt(sVar1, psVar11);
                    _strcpy(szForm + 1, pcVar2);
                } else {
                    szForm[1] = '\0';
                }
                uVar3 = _strlen(szForm);
                RgToStream(szForm, uVar3);
                if ((gd.grBits2._2_2_ >> 5 & 1) != 0) {
                    if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) < 3) {
                        szForm[1] = '\0';
                        for (i = 0; i < 7; i = i + 1) {
                            RgToStream(szForm, 1);
                        }
                    } else {
                        for (i = 0; i < 3; i = i + 1) {
                            pcVar2 = PszCalcEnvVar(i, (int)((PLANET *)lppl)->rgEnvVar[i]);
                            _strcpy(szForm + 1, pcVar2);
                            uVar3 = _strlen(szForm);
                            RgToStream(szForm, uVar3);
                        }
                        for (i = 0; i < 3; i = i + 1) {
                            pcVar2 = PszCalcEnvVar(i, (int)((PLANET *)lppl)->rgEnvVarOrig[i]);
                            _strcpy(szForm + 1, pcVar2);
                            uVar3 = _strlen(szForm);
                            RgToStream(szForm, uVar3);
                        }
                        psVar11 = 0;
                        sVar1 = PctPlanetOptValue(lppl, idPlayer);
                        pcVar2 = PszFromInt(sVar1, psVar11);
                        _strcpy(szForm + 1, pcVar2);
                        _strcat(szForm + 1, (char *)s___1120_1678);
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                    }
                    if ((((PLANET *)lppl)->wFlags_0x4 & 0xff) == 7) {
                        psVar11 = 0;
                        sVar1 = PctPlanetCapacity(lppl);
                        pcVar2 = PszFromInt(sVar1, psVar11);
                        _strcpy(szForm + 1, pcVar2);
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                        psVar11 = 0;
                        sVar1 = GetPlanetScannerRange(lppl, &i);
                        pcVar2 = PszFromInt(sVar1, psVar11);
                        _strcpy(szForm + 1, pcVar2);
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                        pcVar2 = PszFromInt(i, 0);
                        _strcpy(szForm + 1, pcVar2);
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                        if ((*(uint *)((int)&((PLANET *)lppl)->lStarbase + 2) & 0x3ff) == 0) {
                            i = 0;
                            szForm[1] = '\0';
                        } else {
                            i = (*(uint *)((int)&((PLANET *)lppl)->lStarbase + 2) >> 10 & 0xf) + 4;
                            pcVar2 = PszGetPlanetName((*(uint *)((int)&((PLANET *)lppl)->lStarbase + 2) & 0x3ff) - 1);
                            _strcpy(szForm + 1, pcVar2);
                        }
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                        pcVar2 = PszFromInt(i, 0);
                        _strcpy(szForm + 1, pcVar2);
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                        if ((((PLANET *)lppl)->wRouting & 0x3ff) == 0) {
                            szForm[1] = '\0';
                        } else {
                            pcVar2 = PszGetPlanetName((((PLANET *)lppl)->wRouting & 0x3ff) - 1);
                            _strcpy(szForm + 1, pcVar2);
                        }
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                        if ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) == 0) {
                            i = -1;
                        } else {
                            i = IStargateFromLppl(lppl);
                            if (i != 0xffff) {
                                local_238._0_2_ = hstSpecialSB;
                                local_238._2_2_ = local_238._2_2_ & 0xff00 | i & 0xffU;
                                FLookupPart(&local_238);
                                pcVar2 = PszFromInt(((BEAM *)local_238._4_4_)->dp, 0);
                                _strcpy(szForm + 1, pcVar2);
                                uVar3 = _strlen(szForm);
                                RgToStream(szForm, uVar3);
                                pcVar2 = PszFromInt(*(short *)&((PLANET *)local_238._4_4_)->lpplprod, 0);
                                _strcpy(szForm + 1, pcVar2);
                                uVar3 = _strlen(szForm);
                                RgToStream(szForm, uVar3);
                            }
                        }
                        if (i == -1) {
                            RgToStream("\t0\t0", 4);
                        }
                        if ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) == 0) {
                            i = 0;
                        } else {
                            i = *(uint *)&((PLANET *)lppl)->lStarbase >> 4;
                        }
                        pcVar2 = PszFromInt(i, 0);
                        _strcpy(szForm + 1, pcVar2);
                        uVar3 = _strlen(szForm);
                        RgToStream(szForm, uVar3);
                    }
                }
                RgToStream(szCRLF, 2);
                lppl = (PLANET *)CONCAT22(uVar8, (PLANET *)lppl + 1);
            }
            StreamClose();
        } else {
            if (fOpen != 0) {
                StreamClose();
            }
            fFileErrSilent = fSilentSav;
            fSuccess = 0;
            penvMem = penvMemSav;
        }
    }
    if (fSuccess == 0) {
        ids_00 = idsUnableWritePlanetInformationSOperationTerminated;
    } else {
        ids_00 = idsKnownPlanetInformationHasSuccessfullyWrittenS;
    }
    pcVar2 = szFile;
    pcVar5 = PszGetCompressedString(ids_00);
    _wsprintf(szWork, pcVar5, pcVar2);
    if (fSuccess == 0) {
        AlertSz((char *)szWork, 0x10);
    } else {
        AlertSz((char *)szWork, 0x40);
    }
    fFileErrSilent = fSilentSav;
    penvMem = penvMemSav;
    return;
}

// ======================================================================
// Function: DumpFleets
// Address: 1108:9530
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x110895a6) */

void DumpFleets(void)

{
    bool bVar1;
    short (*pasVar2)[9];
    short      sVar3;
    short      sVar4;
    ushort     uVar5;
    char      *pcVar6;
    short      i_00;
    StringId   ids_00;
    char      *pcVar7;
    FLEET     *pFVar8;
    uint       uVar9;
    int        iVar10;
    undefined2 uVar11;
    undefined2 unaff_SS;
    bool       bVar12;
    long       lVar13;
    HULDEF    *pHVar14;
    short     *psVar15;
    long       l;
    short      cch;
    char      *psz;
    short (*penvMemSav)[9];
    short  fSilentSav;
    short  fSuccess;
    short  fOpen;
    short  env[9];
    short  i;
    short  j;
    FLEET *lpfl;
    short  ifl;
    char   szForm[256];
    char   szFile[256];
    short  ids;
    short  iplr;

    sVar3 = fFileErrSilent;
    pasVar2 = penvMem;
    bVar1 = true;
    if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
        bVar1 = false;
        penvMem = pasVar2;
        fFileErrSilent = sVar3;
    } else {
        penvMemSav = penvMem;
        penvMem = &env;
        sVar4 = __setjmp(env);
        if (sVar4 == 0) {
            fFileErrSilent = 1;
            if ((gd.grBits2._2_2_ >> 5 & 1) == 0) {
                _wsprintf(szFile, "%s.fle", (char *)szBase, 0x1120);
            } else {
                _wsprintf(szFile, "%s.f%d", (char *)szBase, 0x1120, idPlayer + 1);
            }
            StreamOpen(szFile, mdCreate);
            j = (gd.grBits2._2_2_ >> 5 & 1) + 2;
            for (i = 0; sVar4 = idPlayer, i < j; i = i + 1) {
                uVar5 = CchGetString(i + idsFleetNameXYPlanetDestinationBattle, szForm);
                for (psz = szForm; *psz != '\0'; psz = psz + 1) {
                    if (*psz == '*') {
                        *psz = '\t';
                    }
                }
                RgToStream(szForm, uVar5);
                if (i == j + -1) {
                    RgToStream(szCRLF, 2);
                }
            }
            for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                /* WARNING: Load size is inaccurate */
                pFVar8 = ((FLEET **)rglpfl)[ifl];
                iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                lpfl = (FLEET *)CONCAT22(iVar10, pFVar8);
                if ((pFVar8 == 0) && (iVar10 == 0))
                    break;
                idPlayer = -1;
                pcVar6 = PszGetFleetName(lpfl->id);
                idPlayer = sVar4;
                uVar5 = _strlen(pcVar6);
                RgToStream(pcVar6, uVar5);
                szForm[0] = '\t';
                pcVar6 = PszFromInt((&((FLEET *)lpfl)->pt)->x, 0);
                _strcpy(szForm + 1, pcVar6);
                uVar5 = _strlen(szForm);
                RgToStream(szForm, uVar5);
                pcVar6 = PszFromInt((((FLEET *)lpfl)->pt).y, 0);
                _strcpy(szForm + 1, pcVar6);
                uVar5 = _strlen(szForm);
                RgToStream(szForm, uVar5);
                uVar11 = (undefined2)((ulong)lpfl >> 0x10);
                if (((FLEET *)lpfl)->idPlanet == -1) {
                    cch = 1;
                } else {
                    pcVar6 = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(pcVar6);
                    cch = uVar5 + 1;
                }
                RgToStream(szForm, cch);
                uVar11 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar8 = (FLEET *)lpfl;
                if ((pFVar8->wFlags_0x4 & 0xff) == 7) {
                    pcVar6 = PszGetDestName(lpfl, 0);
                    _strcpy(szForm + 1, pcVar6);
                } else if ((((gd.grBits2._2_2_ >> 5 & 1) == 0) || (6 < (pFVar8->wFlags_0x4 & 0xff))) ||
                           ((*(uint *)((int)&pFVar8->dirLong + 2) >> 4 & 1) == 0)) {
                    szForm[1] = '\0';
                } else {
                    pcVar6 = PszFromInt(*(uint *)&pFVar8->dirLong & 0xff, 0);
                    _strcpy(szForm + 1, pcVar6);
                    _strcat(szForm, (char *)s___1120_168d);
                    pcVar6 = PszFromInt(*(uint *)&((FLEET *)lpfl)->dirLong >> 8, 0);
                    _strcat(szForm, pcVar6);
                }
                uVar5 = _strlen(szForm);
                RgToStream(szForm, uVar5);
                uVar9 = (uint)lpfl->id >> 9 & 0xf;
                if ((*(int *)((BTLPLAN **)rglpbtlplan + uVar9) == 0) && (*(int *)((int)(BTLPLAN **)rglpbtlplan + uVar9 * 4 + 2) == 0)) {
                    szForm[1] = '\0';
                } else {
                    uVar9 = (uint)lpfl->id >> 9 & 0xf;
                    __fstrcpy(szForm + 1, (char *)CONCAT22(*(undefined2 *)((int)(BTLPLAN **)rglpbtlplan + uVar9 * 4 + 2),
                                                           (char *)(*(int *)((BTLPLAN **)rglpbtlplan + uVar9) + (uint)((FLEET *)lpfl)->iplan * 0x24 + 4)));
                }
                uVar5 = _strlen(szForm);
                RgToStream(szForm, uVar5);
                l._0_2_ = 0;
                l._2_2_ = 0;
                for (i = 0; i < 0x10; i = i + 1) {
                    uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                    bVar12 = CARRY2((uint)l, uVar9);
                    l._0_2_ = (uint)l + uVar9;
                    l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar12;
                }
                pcVar6 = PszFromLong(CONCAT22(l._2_2_, (uint)l), 0);
                _strcpy(szForm + 1, pcVar6);
                uVar5 = _strlen(szForm);
                RgToStream(szForm, uVar5);
                i = 0;
                while (true) {
                    if (4 < i)
                        break;
                    pcVar6 = PszFromLong(CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2), (int)((FLEET *)lpfl)->rgwtMin[i]), 0);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    i = i + 1;
                }
                if ((gd.grBits2._2_2_ >> 5 & 1) != 0) {
                    pcVar6 = PszFromInt(((FLEET *)lpfl)->iPlayer + 1, 0);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    if (((FLEET *)lpfl)->cord < 2) {
                        szForm[1] = '0';
                        szForm[2] = '\0';
                    } else {
                        pcVar6 = PszGetETA(0, lpfl, 0);
                        _strcpy(szForm + 1, pcVar6);
                    }
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    uVar11 = (undefined2)((ulong)lpfl >> 0x10);
                    pFVar8 = (FLEET *)lpfl;
                    if (pFVar8->cord < 2) {
                        if (((pFVar8->wFlags_0x4 & 0xff) < 7) && ((*(uint *)((int)&pFVar8->dirLong + 2) >> 4 & 1) != 0)) {
                            i = *(uint *)((int)&pFVar8->dirLong + 2) & 0xf;
                        } else {
                            i = 0;
                        }
                    } else {
                        i = ((PLORD *)pFVar8->lpplord + 7)->wFlags >> 4 & 0xf;
                    }
                    pcVar6 = PszFromInt(i, 0);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    psVar15 = 0;
                    lVar13 = WtFromLpfl(lpfl);
                    pcVar6 = PszFromLong(lVar13, psVar15);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    psVar15 = 0;
                    i_00 = PctCloakFromLpfl(lpfl);
                    pcVar6 = PszFromInt(i_00, psVar15);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    j = GetFleetScannerRange(lpfl, &i, 0, 0);
                    if (j == -1) {
                        j = 0;
                    }
                    pcVar6 = PszFromInt(j, 0);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    pcVar6 = PszFromInt(i, 0);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    if ((((FLEET *)lpfl)->wFlags_0x4 & 0xff) == 7) {
                        pcVar6 = PszGetTaskName(lpfl, &i);
                        _strcpy(szForm + 1, pcVar6);
                    } else {
                        szForm[1] = '\0';
                    }
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    psVar15 = 0;
                    lVar13 = CMineFromLpfl(lpfl);
                    pcVar6 = PszFromLong(lVar13, psVar15);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    psVar15 = 0;
                    lVar13 = CMineSweepFromLpfl(lpfl);
                    pcVar6 = PszFromLong(lVar13, psVar15);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    psVar15 = 0;
                    lVar13 = CLayMinesFromLpfl(lpfl, -1, -1);
                    pcVar6 = PszFromLong(lVar13, psVar15);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    psVar15 = 0;
                    lVar13 = PctTerraFromLpfl(lpfl);
                    pcVar6 = PszFromLong(lVar13, psVar15);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    l._0_2_ = 0;
                    l._2_2_ = 0;
                    for (i = 0; i < 0x10; i = i + 1) {
                        if (((FLEET *)lpfl)->rgcsh[i] != 0) {
                            iVar10 = ((FLEET *)lpfl)->iPlayer * 4;
                            pHVar14 = LphuldefFromId(*(HullDef *)(*(int *)(iVar10 + rglpshdef) + i * 0x93));
                            j = ((HULDEF *)pHVar14)->wFlags_0x7b >> 10 & 0xf;
                            if (((uint)j < 2) || (5 < (uint)j)) {
                                uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                                bVar12 = CARRY2((uint)l, uVar9);
                                l._0_2_ = (uint)l + uVar9;
                                l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar12;
                            }
                        }
                    }
                    pcVar6 = PszFromLong(CONCAT22(l._2_2_, (uint)l), 0);
                    _strcpy(szForm + 1, pcVar6);
                    uVar5 = _strlen(szForm);
                    RgToStream(szForm, uVar5);
                    for (j = 2; j < 6; j = j + 1) {
                        l._0_2_ = 0;
                        l._2_2_ = 0;
                        for (i = 0; i < 0x10; i = i + 1) {
                            if ((((FLEET *)lpfl)->rgcsh[i] != 0) &&
                                (iVar10 = ((FLEET *)lpfl)->iPlayer * 4, pHVar14 = LphuldefFromId(*(HullDef *)(*(int *)(iVar10 + rglpshdef) + i * 0x93)),
                                 (((HULDEF *)pHVar14)->wFlags_0x7b >> 10 & 0xf) == j)) {
                                uVar9 = ((FLEET *)lpfl)->rgcsh[i];
                                bVar12 = CARRY2((uint)l, uVar9);
                                l._0_2_ = (uint)l + uVar9;
                                l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar12;
                            }
                        }
                        pcVar6 = PszFromLong(CONCAT22(l._2_2_, (uint)l), 0);
                        _strcpy(szForm + 1, pcVar6);
                        uVar5 = _strlen(szForm);
                        RgToStream(szForm, uVar5);
                    }
                }
                RgToStream(szCRLF, 2);
            }
            StreamClose();
        } else {
            bVar1 = false;
            penvMem = pasVar2;
            fFileErrSilent = sVar3;
        }
    }
    if (bVar1) {
        ids_00 = idsKnownFleetInformationHasSuccessfullyWrittenS;
    } else {
        ids_00 = idsUnableWriteFleetInformationSOperationTerminated;
    }
    pcVar6 = szFile;
    pcVar7 = PszGetCompressedString(ids_00);
    _wsprintf(szWork, pcVar7, pcVar6);
    if (bVar1) {
        AlertSz((char *)szWork, 0x40);
    } else {
        AlertSz((char *)szWork, 0x10);
    }
    fFileErrSilent = sVar3;
    penvMem = penvMemSav;
    return;
}

// ======================================================================
// Function: PrintMapDlg
// Address: 1108:a1c2
// Segment: MEMORY_REPORT
// ======================================================================

/* WARNING: Enum "WParamMessageId": Some values do not have unique names */

short PrintMapDlg(HWND hwnd, WMType msg, ushort wParam, long lParam)

{
    HWND        HVar1;
    char       *pcVar2;
    undefined1 *puVar3;
    undefined1 *puVar4;
    undefined2  unaff_SI;
    undefined2  unaff_DI;
    undefined2  uVar5;
    undefined2  unaff_SS;
    ulong       uVar6;
    ushort      in_stack_0000fff0;
    RECT        rc;
    short       i;

    uVar5 = 0x1108;
    puVar4 = &stack0xffec;
    puVar3 = &stack0xffec;
    if (msg == WM_ERASEBKGND) {
        GetClientRect(hwnd, &rc);
        FillRect(wParam, &rc, hbrButtonFace);
        return 1;
    }
    if (msg == WM_CTLCOLOR) {
        uVar6 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000fff0);
        if ((int)uVar6 == 6) {
            SetBkColor(wParam, CONCAT22(crButtonFace._2_2_, (undefined2)crButtonFace));
            return hbrButtonFace;
        }
    } else {
        if (msg == WM_INITDIALOG) {
            for (i = 0; i < 2; i = i + 1) {
                *(HWND *)(puVar3 + -2) = hwnd;
                *(short *)(puVar3 + -4) = i + 0x10c;
                *(undefined2 *)(puVar3 + -6) = uVar5;
                *(undefined2 *)(puVar3 + -8) = 0xa1e8;
                HVar1 = GetDlgItem(*(HWND *)(puVar3 + -2), *(ControlId *)(puVar3 + -4));
                *(HWND *)(puVar3 + -2) = HVar1;
                *(undefined2 *)(puVar3 + -4) = 0x415;
                *(undefined2 *)(puVar3 + -6) = 1;
                *(undefined2 *)(puVar3 + -8) = 0;
                *(undefined2 *)(puVar3 + -10) = 0;
                *(undefined2 *)(puVar3 + -0xc) = 0x14f8;
                *(undefined2 *)(puVar3 + -0xe) = 0xa203;
                SendMessage(*(HWND *)(puVar3 + -2), *(WMType *)(puVar3 + -4), *(WParamMessageId *)(puVar3 + -6), *(LPARAM *)(puVar3 + -10));
                *(HWND *)(puVar3 + -2) = HVar1;
                *(undefined2 *)(puVar3 + -4) = 0x30;
                *(ushort *)(puVar3 + -6) = rghfontArial8[1];
                *(undefined2 *)(puVar3 + -8) = 0;
                *(undefined2 *)(puVar3 + -10) = 0;
                *(undefined2 *)(puVar3 + -0xc) = 0x14f8;
                *(undefined2 *)(puVar3 + -0xe) = 0xa21b;
                SendMessage(*(HWND *)(puVar3 + -2), *(WMType *)(puVar3 + -4), *(WParamMessageId *)(puVar3 + -6), *(LPARAM *)(puVar3 + -10));
                szWork[0] = (char)((short *)vrgcPrintMapPage)[i] + '0';
                szWork[1] = '\0';
                *(HWND *)(puVar3 + -2) = HVar1;
                *(undefined2 *)(puVar3 + -4) = 0x1120;
                *(char **)(puVar3 + -6) = (char *)szWork;
                *(undefined2 *)(puVar3 + -8) = 0x14f8;
                uVar5 = 0x14f8;
                *(undefined2 *)(puVar3 + -10) = 0xa23e;
                SetWindowText(*(HWND *)(puVar3 + -2), *(LPCSTR *)(puVar3 + -6));
                puVar3 = puVar3 + -6;
            }
            *(undefined2 *)(puVar3 + -2) = 1;
            *(POINT **)(puVar3 + -4) = (POINT *)&ptStickyPrintMapDlg;
            *(HWND *)(puVar3 + -6) = hwnd;
            *(undefined2 *)(puVar3 + -8) = uVar5;
            *(undefined2 *)(puVar3 + -10) = 0xa25b;
            StickyDlgPos(*(HWND *)(puVar3 + -6), *(POINT **)(puVar3 + -4), *(short *)(puVar3 + -2));
            return 1;
        }
        if (msg == WM_COMMAND) {
            if ((wParam == 1) || (wParam == 2)) {
                if (wParam == 1) {
                    puVar4 = &stack0xffec;
                    for (i = 0; i < 2; i = i + 1) {
                        *(HWND *)(puVar4 + -2) = hwnd;
                        *(short *)(puVar4 + -4) = i + 0x10c;
                        *(undefined2 *)(puVar4 + -6) = uVar5;
                        *(undefined2 *)(puVar4 + -8) = 0xa2f3;
                        HVar1 = GetDlgItem(*(HWND *)(puVar4 + -2), *(ControlId *)(puVar4 + -4));
                        *(HWND *)(puVar4 + -2) = HVar1;
                        *(undefined2 *)(puVar4 + -4) = 0x1120;
                        *(char **)(puVar4 + -6) = (char *)szWork;
                        *(undefined2 *)(puVar4 + -8) = 10;
                        *(undefined2 *)(puVar4 + -10) = 0x14f8;
                        uVar5 = 0x14f8;
                        *(undefined2 *)(puVar4 + -0xc) = 0xa309;
                        GetWindowText(*(HWND *)(puVar4 + -2), *(LPSTR *)(puVar4 + -6), *(short *)(puVar4 + -8));
                        if ((((szWork[0] == '\0') || (szWork[1] != '\0')) || (szWork[0] < '1')) || ('9' < szWork[0])) {
                            *(undefined2 *)(puVar4 + -10) = 0x10;
                            *(undefined2 *)(puVar4 + -0xc) = 0;
                            *(undefined2 *)(puVar4 + -0xe) = 0;
                            *(undefined2 *)(puVar4 + -0x10) = 0x527;
                            *(undefined2 *)(puVar4 + -0x12) = 0x14f8;
                            *(undefined2 *)(puVar4 + -0x14) = 0xa34e;
                            pcVar2 = PszFormatIds(*(StringId *)(puVar4 + -0x10), *(short **)(puVar4 + -0xe));
                            *(char **)(puVar4 + -0xc) = pcVar2;
                            *(undefined2 *)(puVar4 + -0xe) = 0x1030;
                            *(undefined2 *)(puVar4 + -0x10) = 0xa357;
                            AlertSz(*(char **)(puVar4 + -0xc), *(short *)(puVar4 + -10));
                            *(HWND *)(puVar4 + -10) = HVar1;
                            *(undefined2 *)(puVar4 + -0xc) = 0x1040;
                            uVar5 = 0x14f8;
                            *(undefined2 *)(puVar4 + -0xe) = 0xa362;
                            SetFocus(*(HWND *)(puVar4 + -10));
                            puVar4 = puVar4 + -8;
                            break;
                        }
                        ((short *)vrgcPrintMapPage)[i] = szWork[0] + -0x30;
                        puVar4 = puVar4 + -8;
                    }
                }
                *(undefined2 *)(puVar4 + -2) = 0;
                *(POINT **)(puVar4 + -4) = (POINT *)&ptStickyPrintMapDlg;
                *(HWND *)(puVar4 + -6) = hwnd;
                *(undefined2 *)(puVar4 + -8) = uVar5;
                *(undefined2 *)(puVar4 + -10) = 0xa392;
                StickyDlgPos(*(HWND *)(puVar4 + -6), *(POINT **)(puVar4 + -4), *(short *)(puVar4 + -2));
                *(HWND *)(puVar4 + -2) = hwnd;
                *(uint *)(puVar4 + -4) = (uint)(wParam == 1);
                *(undefined2 *)(puVar4 + -6) = 0x1040;
                *(undefined2 *)(puVar4 + -8) = 0xa3b0;
                EndDialog(*(HWND *)(puVar4 + -2), *(short *)(puVar4 + -4));
                return 1;
            }
            if (wParam == 0x76) {
                WinHelp(hwnd, szHelpFile, 1, 0xc3c);
                return 1;
            }
            if (((wParam == 0x10c) || (wParam == 0x10d)) && (uVar6 = __aFulshr(CONCAT22(unaff_SI, unaff_DI), in_stack_0000fff0), (int)uVar6 == 0x400)) {
                GetWindowText((HWND)lParam, szWork, 10);
                if ((szWork[0] != '\0') && ((szWork[0] < '1' || ('9' < szWork[0])))) {
                    MessageBeep(0);
                    SetWindowText((HWND)lParam, szWork + 1);
                }
            }
        }
    }
    return 0;
}
