// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: ReportDlg
// Address: 1108:0018
// Segment: MEMORY_REPORT
// ======================================================================


long ReportDlg(HWND hwnd,ushort msg,ushort wParam,long lParam)

{
  int iVar1;
  bool bVar2;
  POINT pt_00;
  POINT pt_01;
  HWND HVar3;
  short sVar4;
  ushort unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar5;
  LRESULT LVar6;
  undefined2 uVar7;
  ushort in_stack_0000ffd0;
  RECT local_2c;
  int local_20;
  short xCur;
  short iRow;
  short iCol;
  short ibit;
  short dx;
  int pt;
  short i;
  RECT rc;
  HMENU hmenu;
  HDC hdc;
  
  if (msg == 1) {
    hwndReportDlg = hwnd;
    hdc = GetDC(hwnd);
    SelectObject(hdc,rghfontArial8[1]);
    for (i = 0; i < vprptCur->cFields; i = i + 1) {
      pt = DxReportColHdr(vprptCur->irpt,i,(char *)szWork,hdc);
      vprptCur->rgbdx[i] = (byte)(pt / 2);
    }
    ReleaseDC(hwnd,hdc);
    SortReportCache(vprptCur->irpt,vprptCur->icolSort);
    SetWindowPos(hwnd,0,0,0,(&vprptCur->ptSize)->x,(vprptCur->ptSize).y,0xe);
    StickyDlgPos(hwnd,&vprptCur->ptDlg,1);
    HVar3 = CreateWindow(s_SCROLLBAR_1120_15cc,(LPCSTR)0x0,0x40000001,0,0,0x32,0x32,hwnd,0,
                         hInst,(void *)0x0);
    vprptCur->hwndVScroll = HVar3;
    HVar3 = CreateWindow(s_SCROLLBAR_1120_15d6,(LPCSTR)0x0,0x40000000,0,0,0x32,0x32,hwnd,0,
                         hInst,(void *)0x0);
    vprptCur->hwndHScroll = HVar3;
    if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
      AdvanceTutor();
    }
LAB_1108_019b:
    GetClientRect(hwnd,(RECT *)&rc);
    pt = (rc.bottom + -0x24) / (dyArial8 + 4);
    sVar4 = pt;
    if (vprptCur->cRows <= pt) {
      sVar4 = vprptCur->cRows;
    }
    vprptCur->cRowsVis = sVar4;
    if (vprptCur->cRowsVis < vprptCur->cRows) {
      i = 0x44;
      if (((vprptCur->cRows < vprptCur->irowFirst + vprptCur->cRowsVis) &&
          (0 < vprptCur->irowFirst)) &&
         (vprptCur->irowFirst = vprptCur->cRows - vprptCur->cRowsVis,
         vprptCur->irowFirst < 0)) {
        vprptCur->irowFirst = 0;
      }
      SetScrollPos(vprptCur->hwndVScroll,2,vprptCur->irowFirst,0);
      SetScrollRange(vprptCur->hwndVScroll,2,0,
                     vprptCur->cRows - vprptCur->cRowsVis,1);
    }
    else {
      i = 0x84;
      vprptCur->irowFirst = 0;
      SetScrollPos(vprptCur->hwndVScroll,2,0,0);
    }
    dx = GetSystemMetrics(2);
    SetWindowPos(vprptCur->hwndVScroll,0,rc.right - dx,dyArial8 + 6,dx,
                 (dyArial8 + 4) * vprptCur->cRowsVis + 1,i);
    SetHScrollBar();
    return (ulong)(msg == 1);
  }
  if (msg == 2) {
    StickyDlgPos(hwnd,&vprptCur->ptDlg,0);
    GetWindowRect(hwnd,(RECT *)&rc);
    (&vprptCur->ptSize)->x = rc.right - rc.left;
    (vprptCur->ptSize).y = rc.bottom - rc.top;
    hwndReportDlg = 0;
    fBrowserValid = 0;
    hmenu = GetASubMenu(hwndFrame,4);
    iVar1 = vprptCur->irpt;
    if (iVar1 == 0) {
      i = 0x8fd;
    }
    else if (iVar1 == 1) {
      i = 0x8ff;
    }
    else if (iVar1 == 2) {
      i = 0x900;
    }
    else if (iVar1 == 3) {
      i = 0x901;
    }
    CheckMenuItem(hmenu,i,0);
    vprptCur = (RPT *)0x0;
    if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
      AdvanceTutor();
    }
  }
  else {
    if (msg == 5) goto LAB_1108_019b;
    if (msg == 0xf) {
      hdc = BeginPaint(hwnd,(PAINTSTRUCT *)(PAINTSTRUCT *)&stack0xffd0);
      DrawReport(hwnd,hdc,&local_2c);
      EndPaint(hwnd,(PAINTSTRUCT *)(PAINTSTRUCT *)&stack0xffd0);
      gd.wFlags = gd.wFlags & 0xfdff;
      return 1;
    }
    if (msg == 0x14) {
      GetClientRect(hwnd,(RECT *)&rc);
      FillRect(wParam,(RECT *)&rc,hbrButtonFace);
      return 1;
    }
    if (msg == 0x24) {
      *(undefined2 *)((int)lParam + 0xc) = 300;
      *(undefined2 *)((int)lParam + 0xe) = 0xdc;
      return 0;
    }
    if (msg == 0x111) {
      if (wParam == 2) {
        DestroyWindow(hwnd);
        return 1;
      }
    }
    else {
      if (msg == 0x114) {
        uVar5 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffd0);
        i = GetScrollPos((HWND)uVar5,2);
        pt = i;
        switch(wParam) {
        case 0:
          pt = i + -1;
          break;
        case 1:
          pt = i + 1;
          break;
        case 2:
          pt = i + -3;
          break;
        case 3:
          pt = i + 3;
          break;
        case 4:
        case 5:
          pt = (int)lParam;
          break;
        case 6:
          pt = 0;
          break;
        case 7:
          pt = 2000;
        }
        if (vprptCur->cColScroll < pt) {
          pt = vprptCur->cColScroll;
        }
        if (pt < 0) {
          pt = 0;
        }
        if (pt != i) {
          uVar5 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffd0);
          SetScrollPos((HWND)uVar5,2,pt,1);
          uVar5 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffd0);
          pt = GetScrollPos((HWND)uVar5,2);
          if (pt != i) {
            dx = 1;
            ibit = 2;
            while ((dx < vprptCur->cFields &&
                   ((((ibit & (uint)vprptCur->grbitVisible) == 0 &&
                     ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) == 0)) ||
                    (iVar1 = pt + -1, bVar2 = 0 < pt, pt = iVar1, bVar2))))) {
              dx = dx + 1;
              ibit = ibit << 1;
            }
            vprptCur->cFieldFirst = dx;
            InvalidateRect(hwnd,(RECT *)0x0,1);
            UpdateWindow(hwnd);
          }
        }
        return 0;
      }
      if (msg == 0x115) {
        uVar5 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffd0);
        i = GetScrollPos((HWND)uVar5,2);
        pt = i;
        switch(wParam) {
        case 0:
          pt = i + -1;
          break;
        case 1:
          pt = i + 1;
          break;
        case 2:
          pt = i - (vprptCur->cRowsVis + -1);
          break;
        case 3:
          pt = i + vprptCur->cRowsVis + -1;
          break;
        case 4:
        case 5:
          pt = (int)lParam;
          break;
        case 6:
          pt = 0;
          break;
        case 7:
          pt = 2000;
        }
        if (vprptCur->cRows - vprptCur->cRowsVis < pt) {
          pt = vprptCur->cRows - vprptCur->cRowsVis;
        }
        if (pt < 0) {
          pt = 0;
        }
        if (pt != i) {
          vprptCur->irowFirst = pt;
          GetClientRect(hwnd,(RECT *)&rc);
          rc.left = 2;
          uVar7 = 2;
          sVar4 = GetSystemMetrics(2);
          rc.right = rc.right - sVar4;
          rc.top = dyArial8 + 6;
          rc.bottom = (dyArial8 + 4) * vprptCur->cRowsVis + rc.top;
          ScrollWindow(hwnd,0,(dyArial8 + 4) * (i - pt),(RECT *)&rc,(RECT *)&rc);
          uVar5 = __aFulshr(CONCAT22(unaff_DI,uVar7),unaff_SI);
          SetScrollPos((HWND)uVar5,2,pt,1);
          UpdateWindow(hwnd);
        }
        return 0;
      }
      if (((msg == 0x201) || (msg == 0x203)) || (msg == 0x204)) {
        xCur = 2;
        pt = (int)lParam;
        uVar5 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffd0);
        i = (short)uVar5;
        if ((1 < i) && (1 < pt)) {
          if (i < dyArial8 + 6) {
            iRow = -1;
          }
          else {
            local_20 = dyArial8 + 4;
            iRow = ((i + -2) - local_20) / (dyArial8 + 4);
            if (vprptCur->cRowsVis <= iRow) goto LAB_1108_09c8;
            iRow = iRow + vprptCur->irowFirst;
          }
          iCol = -1;
          ibit = 1;
          for (dx = 0; dx < vprptCur->cFields; dx = dx + 1) {
            if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
                ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
               (((dx == 0 || (vprptCur->cFieldFirst <= dx)) &&
                (xCur = xCur + (uint)vprptCur->rgbdx[dx] * 2, pt < xCur)))) {
              iCol = dx;
              break;
            }
            ibit = ibit << 1;
          }
          if (iCol != -1) {
            if (iRow == -1) {
              pt_01.y = i;
              pt_01.x = pt;
              ReportColumnPopup(pt_01,iCol,(uint)(msg == 0x204));
            }
            else {
              pt_00.y = i;
              pt_00.x = pt;
              ExecuteReportClick(pt_00,vprptCur->irpt,iCol,iRow);
            }
            if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
              AdvanceTutor();
            }
          }
        }
      }
    }
  }
LAB_1108_09c8:
  LVar6 = DefWindowProc(hwnd,msg,wParam,lParam);
  return LVar6;
}



// ======================================================================
// Function: SetHScrollBar
// Address: 1108:09e8
// Segment: MEMORY_REPORT
// ======================================================================


void SetHScrollBar(void)

{
  int iVar1;
  undefined2 unaff_SS;
  RECT rc;
  short xTitle;
  short dx;
  short xRight;
  short ibit;
  short i;
  short ccolHidden;
  short ccolSkipped;
  short dy;
  ushort swp;
  
  GetClientRect(hwndReportDlg,(RECT *)&rc);
  dx = GetSystemMetrics(2);
  xTitle = (uint)vprptCur->rgbdx[0] * 2 + 2;
  xRight = ((rc.right - xTitle) + -2) - dx;
  ccolSkipped = 0;
  ccolHidden = 0;
  ibit = 1 << ((byte)vprptCur->cFields & 0x1f);
  iVar1 = vprptCur->cFields;
  while (i = iVar1 + -1, 0 < i) {
    if (((ibit & (uint)vprptCur->grbitVisible) != 0) ||
       ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) {
      if (i < vprptCur->cFieldFirst) {
        ccolSkipped = ccolSkipped + 1;
      }
      xRight = xRight + (uint)vprptCur->rgbdx[iVar1 + -1] * -2;
      if (xRight < 0) {
        ccolHidden = ccolHidden + 1;
      }
    }
    ibit = ibit >> 1;
    iVar1 = i;
  }
  vprptCur->cColScroll = 0;
  if (ccolHidden == 0) {
    swp = 0x84;
    vprptCur->cFieldFirst = 1;
    SetScrollPos(vprptCur->hwndHScroll,2,0,0);
  }
  else {
    swp = 0x44;
    if (ccolHidden < ccolSkipped) {
      ccolSkipped = 0;
      vprptCur->cFieldFirst = 1;
    }
    SetScrollPos(vprptCur->hwndHScroll,2,ccolSkipped,0);
    SetScrollRange(vprptCur->hwndHScroll,2,0,ccolHidden,1);
    vprptCur->cColScroll = ccolHidden;
  }
  dy = GetSystemMetrics(3);
  SetWindowPos(vprptCur->hwndHScroll,0,xTitle,
               dyArial8 + (dyArial8 + 4) * vprptCur->cRowsVis + 7,
               (rc.right - dx) - xTitle,dy,swp);
  return;
}



// ======================================================================
// Function: DrawReport
// Address: 1108:0bae
// Segment: MEMORY_REPORT
// ======================================================================


void DrawReport(HWND hwnd,HDC hdc,RECT *prc)

{
  int iVar1;
  int iVar2;
  ushort uVar3;
  undefined2 unaff_SS;
  LPCSTR pcVar4;
  HDC HVar5;
  RECT rc;
  short xCol;
  short dx;
  short ibit;
  short yRow;
  short i;
  short j;
  short irowLast;
  char szTit [42];
  
  ibit = 1;
  xCol = 2;
  yRow = 2;
  SelectObject(hdc,rghfontArial8[1]);
  SetBkMode(hdc,1);
  if (prc->top <= dyArial8 + 4 + yRow) {
    for (i = 0; i < vprptCur->cFields; i = i + 1) {
      if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
          ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
         ((i == 0 || (vprptCur->cFieldFirst <= i)))) {
        dx = DxReportColHdr(vprptCur->irpt,i,szTit,hdc);
        vprptCur->rgbdx[i] = (byte)(dx / 2);
        SetRect((RECT *)&rc,xCol,yRow,xCol + dx + -1,dyArial8 + 4 + yRow);
        if (((uint)gd.wFlags >> 9 & 1) != 0) {
          FillRect(hdc,(RECT *)&rc,hbrButtonFace);
        }
        if (i == 0) {
          iVar1 = rc.left + 3;
          iVar2 = rc.top + 2;
          pcVar4 = (LPCSTR)szTit;
          HVar5 = hdc;
          uVar3 = _strlen(szTit);
          TextOut(HVar5,iVar1,iVar2,pcVar4,uVar3);
        }
        else {
          CtrTextOut(hdc,(rc.right - rc.left) / 2 + rc.left,rc.top + 2,szTit,0);
        }
        _Draw3dFrame();
        xCol = xCol + dx;
      }
      ibit = ibit << 1;
    }
  }
  irowLast = vprptCur->irowFirst + vprptCur->cRowsVis;
  if (vprptCur->cRows < irowLast) {
    irowLast = vprptCur->cRows;
  }
  for (i = vprptCur->irowFirst; i < irowLast; i = i + 1) {
    yRow = yRow + dyArial8 + 4;
    xCol = 2;
    if ((prc->top <= yRow) && (yRow <= prc->bottom)) {
      SelectObject(hdc,hbrButtonShadow);
      PatBlt(hdc,xCol,yRow,1,dyArial8 + 4,0xf00021);
    }
    ibit = 1;
    for (j = 0; j < vprptCur->cFields; j = j + 1) {
      if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
          ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
         ((j == 0 || (vprptCur->cFieldFirst <= j)))) {
        dx = (uint)vprptCur->rgbdx[j] << 1;
        if ((prc->top - (dyArial8 + 4) <= yRow) && (yRow <= prc->bottom)) {
          SelectObject(hdc,hbrButtonShadow);
          PatBlt(hdc,xCol + dx + -1,yRow,1,dyArial8 + 4,0xf00021);
          PatBlt(hdc,xCol,dyArial8 + 4 + yRow,dx,1,0xf00021);
          SetRect((RECT *)&rc,xCol + 2,yRow + 2,xCol + dx + -3,dyArial8 + yRow + 3);
          if (((uint)gd.wFlags >> 9 & 1) != 0) {
            FillRect(hdc,(RECT *)&rc,hbrButtonFace);
          }
          DrawReportItem(hdc,&rc,vprptCur->irpt,i,j);
        }
        xCol = xCol + dx;
      }
      ibit = ibit << 1;
    }
  }
  return;
}



// ======================================================================
// Function: ScoreXDlg
// Address: 1108:0f66
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cch */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short ScoreXDlg(HWND hwnd,WMType message,ushort wParam,long lParam)

{
  int iVar1;
  short sVar2;
  short sVar3;
  uint uVar4;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar5;
  ulong uVar6;
  uint *rgids;
  char **rgsz;
  short fRightBtn;
  short cch;
  short iSel;
  uint rgid [24];
  short i;
  short c;
  char *rgszScan [20];
  short cchHistory;
  char szT [6];
  undefined1 ps [32];
  HDC hdc;
  RECT rc;
  short i__6;
  
  uVar6 = CONCAT22(unaff_SI,unaff_DI);
  if (message == WM_PAINT) {
    hdc = BeginPaint(hwnd,(PAINTSTRUCT *)(PAINTSTRUCT *)ps);
    if (((uint)gd._4_2_ >> 0xb & 3) == 2) {
      DrawHistoryReport(hdc);
    }
    else if (((uint)gd._4_2_ >> 0xb & 3) == 0) {
      DrawScoreReport(hdc);
    }
    else {
      DrawVCReport(hdc);
    }
    EndPaint(hwnd,(PAINTSTRUCT *)(PAINTSTRUCT *)ps);
    sVar2 = 1;
  }
  else if (message == WM_ERASEBKGND) {
    GetClientRect(hwnd,(RECT *)&rc);
    FillRect(wParam,(RECT *)&rc,hbrButtonFace);
    sVar2 = 1;
  }
  else {
    if (message == WM_SETCURSOR) {
      if (((uint)gd._4_2_ >> 0xb & 3) == 2) {
        GetCursorPos((POINT *)(POINT *)(ps + 0x1e));
        ScreenToClient(hwnd,(POINT *)(POINT *)(ps + 0x1e));
        if (((int)hdc < dyArial10 + dyArial8 + -2) && (2 < (int)hdc)) {
          setcursor(hcurHand);
          return 1;
        }
      }
    }
    else {
      if (message == WM_INITDIALOG) {
        InitScoreDlg(hwnd,(uint)gd._4_2_ >> 0xb & 3);
        fInScoreDialog = 1;
        StickyDlgPos(hwnd,(POINT *)&ptStickyScoreXDlg,1);
        hwndScoreXDlg = hwnd;
        if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
          AdvanceTutor();
        }
        return 1;
      }
      if (message == WM_COMMAND) {
        if (wParam == 2) {
          StickyDlgPos(hwnd,(POINT *)&ptStickyScoreXDlg,0);
          EndDialog(hwnd,i__6);
          fInScoreDialog = 0;
          hwndScoreXDlg = 0;
          if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
          return 1;
        }
        if (wParam == 0x76) {
          WinHelp(hwnd,(LPCSTR)_szHelpFile,1,0x455);
          return 1;
        }
        if (wParam == 0xc6) {
          hdc = (((uint)gd._4_2_ >> 0xb & 3) + 1) % 3;
          gd._4_2_ = gd._4_2_ & 0xe7ff | hdc << 0xb;
          InvalidateRect(hwnd,(RECT *)0x0,1);
          InitScoreDlg(hwnd,(uint)gd._4_2_ >> 0xb & 3);
          if (((uint)gd._0_2_ >> 0xb & 1) != 0) {
            AdvanceTutor();
          }
        }
      }
      else if ((((message == WM_LBUTTONDOWN) || (message == WM_RBUTTONDOWN)) &&
               (c = 0, ((uint)gd._4_2_ >> 0xb & 3) == 2)) &&
              ((uVar5 = __aFulshr(uVar6,cch), 2 < (uint)uVar5 &&
               (uVar6 = __aFulshr(uVar6,cch),
               (uint)uVar6 < (dyArial10 + dyArial8) - 2U)))) {
        cchHistory = CchGetString(idsHistory,szT);
        for (i = 0; i < 8; i = i + 1) {
          _strcpy((char *)szWork + i * 0x28,szT);
          iVar1 = cchHistory + i * 0x28;
          sVar3 = CchGetString(i + idsPlanets,(char *)szWork + iVar1);
          sVar2 = c;
          ((char *)szWork + iVar1)[sVar3 + -1] = '\0';
          rgid[c * 2] = (uint)((gd.wFlags & 0xfU) == i);
          rgid[sVar2 * 2 + 1] = 0;
          rgszScan[c] = (char *)szWork + i * 0x28;
          c = c + 1;
        }
        fRightBtn = 0;
        sVar3 = -2;
        rgsz = rgszScan;
        rgids = rgid;
        sVar2 = c;
        uVar6 = __aFulshr(CONCAT22(rgids,c),(ushort)rgsz);
        uVar4 = PopupMenu(hwnd,(short)lParam,(short)uVar6,sVar2,(long *)rgids,rgsz,sVar3,
                                 fRightBtn);
        if (uVar4 != 0xffff) {
          gd.wFlags = gd.wFlags & 0xfff0U | uVar4 & 0xf;
          gd._4_2_ = gd._4_2_ & 0xff7f | 0x80;
          InvalidateRect(hwnd,(RECT *)0x0,1);
        }
      }
    }
    sVar2 = 0;
  }
  return sVar2;
}



// ======================================================================
// Function: InitScoreDlg
// Address: 1108:13b6
// Segment: MEMORY_REPORT
// ======================================================================


void InitScoreDlg(HWND hwnd,short fVictory)

{
  int iVar1;
  char *pcVar2;
  ushort uVar3;
  HWND HVar4;
  undefined2 unaff_SS;
  DWORD DVar5;
  undefined2 uVar6;
  HDC HVar7;
  RECT rc;
  short dx;
  char *psz;
  RECT rcWindow;
  short dxFrame;
  short dyFrame;
  short dy;
  short dxDig;
  HDC hdc;
  
  hdc = GetDC(hwnd);
  SelectObject(hdc,rghfontArial8[1]);
  DVar5 = GetTextExtent(hdc,&DAT_1120_15e8,1);
  dxDig = (short)DVar5;
  if (fVictory == 2) {
    dx = 600;
    dy = 400;
  }
  else if (fVictory == 0) {
    pcVar2 = PszGetCompressedString(idsUnarmedShips2);
    uVar6 = 0x1120;
    HVar7 = hdc;
    psz = pcVar2;
    uVar3 = _strlen(pcVar2);
    DVar5 = GetTextExtent(HVar7,(LPCSTR)CONCAT22(uVar6,pcVar2),uVar3);
    vdxScoreX = (int)DVar5 + 8;
    iVar1 = game.cPlayer;
    if (game.cPlayer < 4) {
      iVar1 = 4;
    }
    dx = iVar1 * dxDig * 5 + vdxScoreX + 8;
    dy = (dyArial8 * 0x21) / 2 + 0x58;
  }
  else {
    pcVar2 = PszGetCompressedString(idsExceedsSecondPlaceScore);
    iVar1 = dxDig * 6;
    uVar6 = 0x1120;
    HVar7 = hdc;
    psz = pcVar2;
    uVar3 = _strlen(pcVar2);
    DVar5 = GetTextExtent(HVar7,(LPCSTR)CONCAT22(uVar6,pcVar2),uVar3);
    vdxScoreX = (int)(((long)(int)DVar5 * 3 & 0xffffU) / 2) + iVar1;
    iVar1 = game.cPlayer;
    if (game.cPlayer < 4) {
      iVar1 = 4;
    }
    dx = (iVar1 * dyArial8 * 3) / 2 + vdxScoreX + 8;
    dy = (dyArial8 * 0x21) / 2 + 0x58;
  }
  ReleaseDC(hwnd,hdc);
  GetWindowRect(hwnd,(RECT *)&rcWindow);
  GetClientRect(hwnd,(RECT *)&rc);
  dxFrame = (rcWindow.right - rcWindow.left) - rc.right;
  dyFrame = (rcWindow.bottom - rcWindow.top) - rc.bottom;
  SetWindowPos(hwnd,0,0,0,dxFrame + dx,dyFrame + dy,6);
  HVar4 = GetDlgItem(hwnd,2);
  GetWindowRect(HVar4,(RECT *)&rc);
  MapWindowPoints(0,hwnd,(POINT *)&rc,2);
  OffsetRect((RECT *)&rc,0,(dy + -4) - rc.bottom);
  dx = (dx + (rc.right - rc.left) * -3) / 4;
  HVar4 = GetDlgItem(hwnd,0xc6);
  SetWindowPos(HVar4,0,dx,rc.top,0,0,5);
  HVar4 = GetDlgItem(hwnd,2);
  SetWindowPos(HVar4,0,dx * 2 + (rc.right - rc.left),rc.top,0,0,5);
  HVar4 = GetDlgItem(hwnd,0x76);
  SetWindowPos(HVar4,0,dx * 3 + (rc.right - rc.left) * 2,rc.top,0,0,5);
  pcVar2 = PszGetCompressedString(fVictory + idsPlayerScores);
  SetWindowText(hwnd,(LPCSTR)pcVar2);
  return;
}



// ======================================================================
// Function: DrawVCReport
// Address: 1108:168e
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: vcVal */
/* WARNING: Variable defined which should be unmapped: idsT */

void DrawVCReport(HDC hdc)

{
  char *pcVar1;
  ushort uVar2;
  HDC HVar3;
  HGDIOBJ HVar4;
  int iVar5;
  int iVar6;
  short sVar7;
  short sVar8;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  DWORD DVar9;
  ulong uVar10;
  long lVar11;
  undefined2 uVar12;
  undefined2 uVar13;
  short vcVal;
  short idsT;
  short xLeft;
  short cch;
  HBITMAP hbmpSav;
  short iPass;
  short i;
  short j;
  HDC hdcMem;
  short cCur;
  undefined2 cr;
  undefined2 local_16;
  short ids;
  short cCurSav;
  short yTop;
  short dxDig;
  short xStart;
  short grbitVC;
  
  yTop = 0x58;
  SetBkMode(hdc,1);
  SelectObject(hdc,rghfontArial8[4]);
  xLeft = vdxScoreX;
  for (i = 0; i < game.cPlayer; i = i + 1) {
    pcVar1 = PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
    uVar2 = _strlen(pcVar1);
    DVar9 = GetTextExtent(hdc,(LPCSTR)pcVar1,uVar2);
    lVar11 = __ftol((double)(qword)CONCAT24((int)DVar9,CONCAT22(unaff_SI,unaff_DI)));
    if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) ||
       ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) {
      if (((uint)((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) {
        cr = 0;
        local_16 = 0;
      }
      else {
        cr = 0;
        local_16 = 0xff;
      }
    }
    else {
      cr = 0x7f7f;
      local_16 = 0x7f;
    }
    SetTextColor(hdc,CONCAT22(local_16,cr));
    TextOut(hdc,(xLeft - (int)lVar11) + (dyArial8 * 3) / 2,
            (-(dyArial8 / 2) - (int)lVar11) + 0x54,(LPCSTR)pcVar1,uVar2);
    xLeft = xLeft + (dyArial8 * 3) / 2;
  }
  SelectObject(hdc,rghfontArial8[1]);
  SelectObject(hdc,hbrButtonShadow);
  GetTextExtent(hdc,&DAT_1120_15ea,1);
  ids = 0x3aa;
  cCur = 0;
  HVar3 = CreateCompatibleDC(hdc);
  HVar4 = SelectObject(HVar3,hbmpMono);
  SetTextColor(hdc,0);
  SetBkColor(hdc,0xffffff);
  xLeft = vdxScoreX + 4;
  iVar5 = ((dyArial8 * 3) / 2 + -0xc) / 2;
  iVar6 = ((dyArial8 * 3) / 2 + -0xb) / 2 - dyArial8 / 4;
  i = 0;
  do {
    if (game.cPlayer <= i) {
      PatBlt(hdc,xLeft,0x58 - dyArial8 / 4,1,(dyArial8 * 0x15) / 2 + 1,0xf00021)
      ;
      SelectObject(HVar3,HVar4);
      DeleteDC(HVar3);
      i = 0;
      do {
        if (8 < i) {
          return;
        }
        for (iPass = 0; iPass < 2; iPass = iPass + 1) {
          if (iPass == 0) {
            cCurSav = cCur;
            xStart = 0;
          }
          else {
            ids = ids + -3;
            if (i < 7) {
              xStart = vdxScoreX - xLeft;
            }
            else {
              xStart = 8;
            }
          }
          if (((i < 8) && (iPass == 1)) &&
             (PatBlt(hdc,vdxScoreX + 4,yTop - dyArial8 / 4,
                     (dyArial8 * game.cPlayer * 3) / 2,1,0xf00021), i == 7)) {
            yTop = yTop + dyArial8 / 2;
          }
          sVar7 = CchGetString(ids,(char *)szWork);
          if (iPass == 1) {
            HVar3 = hdc;
            if ((i < 7) && (sVar8 = GetVCCheck((GAME *)&game,cCurSav), sVar8 == 0)) {
              uVar12 = 0x7f7f;
              uVar13 = 0x7f;
            }
            else {
              uVar12 = 0;
              uVar13 = 0;
            }
            SetTextColor(HVar3,CONCAT22(uVar13,uVar12));
            TextOut(hdc,xStart,yTop,szWork,sVar7);
          }
          DVar9 = GetTextExtent(hdc,szWork,sVar7);
          xLeft = xStart + (int)DVar9;
          cCur = cCurSav;
          iVar5 = ids;
          for (j = 0; ids = iVar5 + 1, j < 2; j = j + 1) {
            if ((j == 1) && (i != 1)) {
              ids = iVar5 + 2;
              break;
            }
            vcVal = GetVCVal((GAME *)&game,cCur,0);
            if (i == 0) {
              uVar13 = 0;
              uVar12 = 100;
              uVar10 = __aFulmul((long)vcVal,(long)game.cPlanMax);
              lVar11 = __aFldiv(uVar10,CONCAT22(uVar13,uVar12));
              vcVal = (short)lVar11;
            }
            cch = wsprintf(szWork,(char *)PCTD,vcVal);
            if (i == 3) {
              _strcat((char *)szWork,(char *)&DAT_1120_15ec);
              cch = cch + 1;
            }
            if (iPass == 1) {
              TextOut(hdc,xLeft,yTop,szWork,cch);
            }
            DVar9 = GetTextExtent(hdc,szWork,cch);
            xLeft = xLeft + (int)DVar9;
            if ((i != 2) && (i != 3)) {
              xLeft = xLeft + 4;
            }
            sVar7 = CchGetString(0x57a4,(char *)szWork);
            if (iPass == 1) {
              TextOut(hdc,xLeft,yTop,szWork,sVar7);
            }
            DVar9 = GetTextExtent(hdc,szWork,sVar7);
            xLeft = xLeft + (int)DVar9;
            cCur = cCur + 1;
            iVar5 = ids;
          }
          if (iPass == 1) {
            yTop = yTop + (dyArial8 * 3) / 2;
          }
        }
        i = i + 1;
      } while( true );
    }
    grbitVC = (uint)((SCOREX *)vlprgScoreX + i)->wWord >> 6 & 0xff;
    for (j = 0; j < 7; j = j + 1) {
      if ((grbitVC & 1U) != 0) {
        BitBlt(hdc,xLeft + iVar5,iVar6 + 0x58 + (j * dyArial8 * 3) / 2,0xe,0xc,HVar3,0,0,
               0x8800c6);
        if ((((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) ||
            ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) &&
           (sVar7 = GetVCCheck((GAME *)&game,(uint)(1 < j) + j), sVar7 != 0)) {
          if (((uint)((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) goto LAB_1108_1917;
          SetTextColor(hdc,0xff0000);
        }
        else {
          SetTextColor(hdc,CONCAT22(crButtonShadow._2_2_,
                                    (undefined2)crButtonShadow));
        }
        SetBkColor(hdc,0);
        BitBlt(hdc,xLeft + iVar5,iVar6 + 0x58 + (j * dyArial8 * 3) / 2,0xe,0xc,HVar3,0,0,
               0xee0086);
        SetTextColor(hdc,0);
        SetBkColor(hdc,0xffffff);
      }
LAB_1108_1917:
      grbitVC = grbitVC >> 1;
    }
    PatBlt(hdc,xLeft,0x58 - dyArial8 / 4,1,(dyArial8 * 0x15) / 2 + 1,0xf00021);
    xLeft = xLeft + (dyArial8 * 3) / 2;
    i = i + 1;
  } while( true );
}



// ======================================================================
// Function: DrawScoreReport
// Address: 1108:1e0c
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11082349) */
/* WARNING: Removing unreachable block (ram,0x1108231e) */

void DrawScoreReport(HDC hdc)

{
  short ids_00;
  uint uVar1;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  DWORD DVar2;
  long lVar3;
  ushort in_stack_0000ffcc;
  short xLeft;
  short cch;
  undefined4 lVal;
  char *psz;
  short iPass;
  short i;
  short j;
  undefined4 lMax;
  undefined2 cr;
  undefined2 local_12;
  short ids;
  short dx45;
  int pt;
  int local_a;
  short yTop;
  short dxDig;
  
  yTop = 0x58;
  SetBkMode(hdc,1);
  SelectObject(hdc,rghfontArial8[1]);
  DVar2 = GetTextExtent(hdc,&DAT_1120_15ee,1);
  dxDig = (short)DVar2;
  SelectObject(hdc,rghfontArial8[4]);
  xLeft = (dxDig * 5 - (dyArial8 * 3) / 2) / 2 + vdxScoreX;
  for (i = 0; i < game.cPlayer; i = i + 1) {
    psz = PszPlayerName(i,1,1,1,0,(PLAYER *)0x0);
    cch = _strlen(psz);
    DVar2 = GetTextExtent(hdc,(LPCSTR)psz,cch);
    in_stack_0000ffcc = (ushort)DVar2;
    lVar3 = __ftol((double)(qword)CONCAT24(in_stack_0000ffcc,CONCAT22(unaff_SI,unaff_DI)));
    dx45 = (short)lVar3;
    if (((*(uint *)((int)&rgplr[0].wMdPlr + i * 0xc0) >> 8 & 1) == 0) ||
       ((*(uint *)((int)&rgplr[0].wFlags + i * 0xc0) & 1) == 0)) {
      if (((uint)((SCOREX *)vlprgScoreX + i)->wWord >> 0xe & 1) == 0) {
        cr = 0;
        local_12 = 0;
      }
      else {
        cr = 0;
        local_12 = 0xff;
      }
    }
    else {
      cr = 0x7f7f;
      local_12 = 0x7f;
    }
    SetTextColor(hdc,CONCAT22(local_12,cr));
    TextOut(hdc,(xLeft - dx45) + (dyArial8 * 3) / 2,
            ((yTop - dx45) - dyArial8 / 2) + -4,(LPCSTR)psz,cch);
    xLeft = xLeft + dxDig * 5;
  }
  SelectObject(hdc,rghfontArial8[1]);
  SelectObject(hdc,hbrButtonShadow);
  ids = 0x1b3;
  xLeft = vdxScoreX + 4;
  pt = ((dyArial8 * 3) / 2 + -0xc) / 2;
  local_a = ((dyArial8 * 3) / 2 + -0xb) / 2 - dyArial8 / 4;
  for (i = 0; i <= game.cPlayer; i = i + 1) {
    PatBlt(hdc,xLeft,yTop - dyArial8 / 4,1,(dyArial8 * 0x1b) / 2 + 1,0xf00021);
    xLeft = xLeft + dxDig * 5;
  }
  SetTextColor(hdc,0);
  lVar3 = CONCAT22(lVal._2_2_,(undefined2)lVal);
  for (i = 0; lVal = lVar3, i < 9; i = i + 1) {
    PatBlt(hdc,vdxScoreX + 4,yTop - dyArial8 / 4,game.cPlayer * dxDig * 5
           ,1,0xf00021);
    ids_00 = ids;
    ids = ids + 1;
    cch = CchGetString(ids_00,(char *)szWork);
    SetTextColor(hdc,0);
    RightTextOut(hdc,vdxScoreX,yTop,(char *)szWork,cch,0);
    xLeft = dxDig * 5 + vdxScoreX + 2;
    lMax = 0;
    lVar3 = lVal;
    for (iPass = 0; iPass < 2; iPass = iPass + 1) {
      for (j = 0; j < game.cPlayer; j = j + 1) {
        if (((uint)((SCOREX *)vlprgScoreX + j)->wWord >> 5 & 1) == 0) {
          lVar3 = -1;
        }
        else {
          switch(i) {
          case 0:
            lVar3 = (long)((SCOREX *)vlprgScoreX)[j].score.cPlanet;
            break;
          case 1:
            lVar3 = (long)((SCOREX *)vlprgScoreX)[j].score.cStarbase;
            break;
          case 2:
          case 3:
          case 4:
            lVal = lVar3;
            lVar3 = __aFlshl(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ffcc);
            break;
          case 5:
            lVar3 = (long)((SCOREX *)vlprgScoreX)[j].score.cTechLevels;
            break;
          case 6:
            lVar3 = CONCAT22(*(undefined2 *)
                              ((int)&((SCOREX *)vlprgScoreX)[j].score.cResources + 2),
                             (int)((SCOREX *)vlprgScoreX)[j].score.cResources);
            break;
          case 7:
            lVar3 = CONCAT22(*(undefined2 *)
                              ((int)&((SCOREX *)vlprgScoreX)[j].score.lScore + 2),
                             (int)(&((SCOREX *)vlprgScoreX)[j].score)->lScore);
            break;
          case 8:
            lVar3 = (long)((SCOREX *)vlprgScoreX)[j].iRank;
          }
        }
        if (iPass == 0) {
          if (lMax < lVar3) {
            lMax = lVar3;
          }
        }
        else if ((-1 < lVar3) &&
                (((*(uint *)((int)&rgplr[0].wMdPlr + j * 0xc0) >> 8 & 1) == 0 ||
                 ((*(uint *)((int)&rgplr[0].wFlags + j * 0xc0) & 1) == 0)))) {
          lVal = lVar3;
          if (i == 8) {
            if (lVar3 == 1) {
              uVar1 = 0xff;
            }
            else {
              uVar1 = 0;
            }
            SetTextColor(hdc,(ulong)uVar1 << 0x10);
          }
          else {
            if (lMax == lVar3) {
              uVar1 = 0xff;
            }
            else {
              uVar1 = 0;
            }
            SetTextColor(hdc,(ulong)uVar1 << 0x10);
          }
          psz = PszFromLongK(lVal,&cch);
          RightTextOut(hdc,xLeft,yTop,psz,cch,0);
          lVar3 = lVal;
        }
        if (iPass == 1) {
          xLeft = xLeft + dxDig * 5;
        }
      }
    }
    yTop = yTop + (dyArial8 * 3) / 2;
  }
  PatBlt(hdc,vdxScoreX + 4,yTop - dyArial8 / 4,game.cPlayer * dxDig * 5,1
         ,0xf00021);
  return;
}



// ======================================================================
// Function: DrawHistoryReport
// Address: 1108:2494
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: lpsx */
/* WARNING: Variable defined which should be unmapped: hpen */
/* WARNING: Variable defined which should be unmapped: hpenSav */
/* WARNING: Removing unreachable block (ram,0x11082b7f) */
/* WARNING: Removing unreachable block (ram,0x11082b2d) */
/* WARNING: Removing unreachable block (ram,0x11082adb) */
/* WARNING: Removing unreachable block (ram,0x11082a8b) */
/* WARNING: Removing unreachable block (ram,0x11082a3b) */
/* WARNING: Removing unreachable block (ram,0x110829cf) */
/* WARNING: Removing unreachable block (ram,0x110827e6) */
/* WARNING: Removing unreachable block (ram,0x110827c2) */
/* WARNING: Removing unreachable block (ram,0x11082840) */
/* WARNING: Removing unreachable block (ram,0x11082a16) */
/* WARNING: Removing unreachable block (ram,0x11082a63) */
/* WARNING: Removing unreachable block (ram,0x11082ab3) */
/* WARNING: Removing unreachable block (ram,0x11082b04) */
/* WARNING: Removing unreachable block (ram,0x11082b56) */
/* WARNING: Removing unreachable block (ram,0x11082cc5) */

void DrawHistoryReport(HDC hdc)

{
  ushort uVar1;
  HPEN HVar2;
  HGDIOBJ HVar3;
  SCOREX *pSVar4;
  undefined2 unaff_SS;
  ulong uVar5;
  long lVar6;
  ulong uVar7;
  char *pcVar8;
  short sVar9;
  undefined2 uVar10;
  undefined2 uVar11;
  short sVar12;
  undefined2 uVar13;
  undefined2 uVar14;
  HDC HVar15;
  SCOREX *lpsx;
  HPEN hpen;
  HPEN hpenSav;
  RECT rc;
  RECT rcDiamond;
  short cch;
  ulong cInc;
  short xCur;
  long cScaleMax;
  short dx;
  char *psz;
  short cDrawn;
  short yCur;
  short i;
  short j;
  ushort iYearBase;
  undefined4 cCur;
  ulong cYears;
  short dy;
  short pt;
  short local_74;
  ushort dYear;
  RECT rcChart;
  char szT [102];
  
  SetBkMode(hdc,1);
  GetClientRect(hwndScoreXDlg,(RECT *)&rcChart);
  ExpandRc(&rcChart,-0x30,0);
  rcChart.top = dyArial10 + dyArial8;
  rcChart.bottom = rcChart.bottom + dyArial8 * -4;
  rc.left = rcChart.left;
  rc.right = rcChart.right;
  rc.top = dyArial8 / 2;
  rc.bottom = rc.top + dyArial10;
  cch = CchGetString(idsHistory,szT);
  psz = szT + cch;
  cch = CchGetString((gd.wFlags & 0xfU) + idsPlanets,psz);
  psz[cch + -1] = '\0';
  SelectObject(hdc,rghfontArial10[1]);
  SetTextColor(hdc,CONCAT22(crButtonText._2_2_,(undefined2)crButtonText));
  RcCtrTextOut(hdc,&rc,szT,0);
  SetRect((RECT *)&rcDiamond,0xf,rc.top,dyArial10 + 0xf,rc.top + dyArial10);
  DrawDiamond(hdc,&rcDiamond,hbrBBlue);
  dx = rcChart.right - rcChart.left;
  dy = rcChart.bottom - rcChart.top;
  PatBlt(hdc,rcChart.left,rcChart.top,dx,dy,0x42);
  SelectObject(hdc,hbrButtonHilite);
  PatBlt(hdc,rcChart.left + -1,rcChart.bottom,dx + 3,1,0xf00021);
  PatBlt(hdc,rcChart.left + -2,rcChart.bottom + 1,dx + 4,1,0xf00021);
  PatBlt(hdc,rcChart.right,rcChart.top + -1,1,dy + 3,0xf00021);
  PatBlt(hdc,rcChart.right + 1,rcChart.top + -2,1,dy + 4,0xf00021);
  SelectObject(hdc,hbrButtonShadow);
  PatBlt(hdc,rcChart.left + -2,rcChart.top + -2,dx + 3,1,0xf00021);
  PatBlt(hdc,rcChart.left + -2,rcChart.top + -1,dx + 2,1,0xf00021);
  PatBlt(hdc,rcChart.left + -2,rcChart.top + -2,1,dy + 3,0xf00021);
  PatBlt(hdc,rcChart.left + -1,rcChart.top + -2,1,dy + 2,0xf00021);
  dx = dx + -4;
  dy = dy + -4;
  ExpandRc(&rcChart,-2,-2);
  if ((uint)game.turn < 0x65) {
    iYearBase = 0;
  }
  else {
    iYearBase = game.turn - 100;
  }
  uVar13 = 0;
  uVar10 = 5;
  uVar5 = __aFldiv((ulong)(game.turn + 4),5);
  uVar5 = __aFulmul(uVar5,CONCAT22(uVar13,uVar10));
  if ((long)uVar5 < 0x65) {
    if (0x32 < (long)uVar5) {
      uVar13 = 0;
      uVar10 = 10;
      cYears = uVar5;
      uVar5 = __aFldiv(uVar5 + 5,10);
      uVar5 = __aFulmul(uVar5,CONCAT22(uVar13,uVar10));
    }
  }
  else {
    uVar5 = 100;
  }
  xCur = rcChart.left;
  cYears = uVar5;
  SelectObject(hdc,rghfontArial8[1]);
  if ((long)cYears < 0x33) {
    j = 5;
  }
  else {
    j = 10;
  }
  cDrawn = (int)cYears / j;
  if (0 < cDrawn) {
    for (i = 0; i <= cDrawn; i = i + 1) {
      xCur = (dx * i) / cDrawn + rcChart.left;
      cch = wsprintf((char *)szT,(char *)PCTD,iYearBase + 0x960 + i * j);
      CtrTextOut(hdc,xCur,rcChart.bottom + 6,szT,cch);
      if ((0 < i) && (i < cDrawn)) {
        PatBlt(hdc,xCur,rcChart.top + -2,1,dy + 4,0xf00021);
      }
    }
  }
  lVar6 = CONCAT22(cCur._2_2_,(undefined2)cCur);
  cScaleMax = -1;
  for (i = 0; i < game.cPlayer; i = i + 1) {
    if ((((SCOREX **)rgsxPlr)[i * 2] != (SCOREX *)0x0) ||
       (*(int *)((undefined *)&DAT_1120_156e + i * 4) != 0)) {
      for (j = 0; j < ((short *)rgcsxPlr)[i]; j = j + 1) {
        cCur = lVar6;
        lVar6 = LFetchScoreXVal((SCOREX *)
                                CONCAT22(*(undefined2 *)((undefined *)&DAT_1120_156e + i * 4),
                                         ((SCOREX **)rgsxPlr)[i * 2] + j),
                                gd.wFlags & 0xf);
        if (cScaleMax < lVar6) {
          cScaleMax = lVar6;
        }
      }
    }
  }
  if ((0xffff < cScaleMax) || (-1 < cScaleMax)) {
    if (cScaleMax < 5) {
      cScaleMax = 5;
    }
    if (cScaleMax < 0xd) {
      cInc = 1;
    }
    else if (cScaleMax < 0x1a) {
      cInc = 2;
    }
    else if (cScaleMax < 0x3d) {
      cInc = 5;
    }
    else if (cScaleMax < 0x79) {
      cInc = 10;
    }
    else if (cScaleMax < 0x12d) {
      cInc = 0x19;
    }
    else if (cScaleMax < 0x259) {
      cInc = 0x32;
    }
    else if (cScaleMax < 0x4b1) {
      cInc = 100;
    }
    else if (cScaleMax < 0x1771) {
      cInc = 500;
    }
    else if (cScaleMax < 0x2ee1) {
      cInc = 1000;
    }
    else {
      uVar14 = 0;
      uVar11 = 500;
      uVar13 = 0;
      uVar10 = 500;
      cCur = lVar6;
      lVar6 = __aFldiv(cScaleMax,0xc);
      uVar5 = __aFldiv(lVar6,CONCAT22(uVar13,uVar10));
      cInc = __aFulmul(uVar5,CONCAT22(uVar14,uVar11));
    }
    xCur = rcChart.left + -6;
    for (cCur = cInc; (long)cCur < cScaleMax; cCur = cInc + cCur) {
      lVar6 = cScaleMax;
      uVar5 = __aFulmul((long)dy,cCur);
      lVar6 = __aFldiv(uVar5,lVar6);
      yCur = rcChart.bottom - (int)lVar6;
      if (yCur < dyArial8 / 2 + rcChart.top) break;
      cch = wsprintf(szWork,(char *)PCTLD,(undefined2)cCur,cCur._2_2_);
      RightTextOut(hdc,xCur,yCur - dyArial8 / 2,(char *)szWork,cch,0);
      PatBlt(hdc,rcChart.left + -2,yCur,dx + 4,1,0xf00021);
    }
    xCur = rcChart.left + 6;
    yCur = rcChart.top + 6;
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if ((((SCOREX **)rgsxPlr)[i * 2] != (SCOREX *)0x0) ||
         (*(int *)((undefined *)&DAT_1120_156e + i * 4) != 0)) {
        psz = PszPlayerName(i,1,1,0,0,(PLAYER *)0x0);
        if (i == idPlayer) {
          uVar10 = 0xffff;
          uVar13 = 0xff;
        }
        else {
          uVar10 = *(undefined2 *)(i * 4 + 0x2e);
          uVar13 = *(undefined2 *)(i * 4 + 0x30);
        }
        SetTextColor(hdc,CONCAT22(uVar13,uVar10));
        uVar10 = 0x1120;
        pcVar8 = psz;
        sVar9 = yCur;
        sVar12 = xCur;
        HVar15 = hdc;
        uVar1 = _strlen(psz);
        TextOut(HVar15,sVar12,sVar9,(LPCSTR)CONCAT22(uVar10,pcVar8),uVar1);
        yCur = yCur + dyArial8;
      }
    }
    for (i = 0; i < game.cPlayer; i = i + 1) {
      if ((((SCOREX **)rgsxPlr)[i * 2] != (SCOREX *)0x0) ||
         (*(int *)((undefined *)&DAT_1120_156e + i * 4) != 0)) {
        cDrawn = 0;
        if (i == idPlayer) {
          uVar10 = 0xffff;
          uVar13 = 0xff;
        }
        else {
          uVar10 = *(undefined2 *)(i * 4 + 0x2e);
          uVar13 = *(undefined2 *)(i * 4 + 0x30);
        }
        HVar2 = CreatePen(0,1,CONCAT22(uVar13,uVar10));
        HVar3 = SelectObject(hdc,HVar2);
        for (j = 0; j < ((short *)rgcsxPlr)[i]; j = j + 1) {
          uVar10 = *(undefined2 *)((undefined *)&DAT_1120_156e + i * 4);
          pSVar4 = ((SCOREX **)rgsxPlr)[i * 2] + j;
          if ((iYearBase <= (uint)pSVar4->iRank) && ((uint)pSVar4->iRank <= (int)cYears + iYearBase)
             ) {
            dYear = pSVar4->iRank - iYearBase;
            uVar5 = LFetchScoreXVal((SCOREX *)CONCAT22(uVar10,pSVar4),gd.wFlags & 0xf);
            cCur = uVar5;
            uVar5 = cYears;
            uVar7 = __aFulmul((ulong)dYear,(long)dx);
            lVar6 = __aFldiv(uVar7,uVar5);
            pt = (int)lVar6 + rcChart.left;
            lVar6 = cScaleMax;
            uVar5 = __aFulmul(cCur,(long)dy);
            lVar6 = __aFldiv(uVar5,lVar6);
            local_74 = rcChart.bottom - (int)lVar6;
            if (cDrawn == 0) {
              MoveTo(hdc,pt,local_74);
            }
            else {
              LineTo(hdc,pt,local_74);
            }
            cDrawn = cDrawn + 1;
          }
        }
        if (cDrawn == 1) {
          if (i == idPlayer) {
            uVar10 = 0xffff;
            uVar13 = 0xff;
          }
          else {
            uVar10 = *(undefined2 *)(i * 4 + 0x2e);
            uVar13 = *(undefined2 *)(i * 4 + 0x30);
          }
          SetPixel(hdc,pt,local_74,CONCAT22(uVar13,uVar10));
        }
        SelectObject(hdc,HVar3);
        DeleteObject(HVar2);
      }
    }
  }
  return;
}



// ======================================================================
// Function: LFetchScoreXVal
// Address: 1108:2f94
// Segment: MEMORY_REPORT
// ======================================================================


long LFetchScoreXVal(SCOREX *lpsx,short iVal)

{
  SCOREX *pSVar1;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar2;
  long lVar3;
  ushort in_stack_0000fffc;
  
  pSVar1 = (SCOREX *)lpsx;
  uVar2 = (undefined2)((ulong)lpsx >> 0x10);
  switch(iVal) {
  case 0:
    lVar3 = (long)(pSVar1->score).cPlanet;
    break;
  case 1:
    lVar3 = (long)(pSVar1->score).cStarbase;
    break;
  case 2:
  case 3:
  case 4:
    lVar3 = __aFlshl(CONCAT22(unaff_SI,unaff_DI),in_stack_0000fffc);
    break;
  case 5:
    lVar3 = (long)(pSVar1->score).cTechLevels;
    break;
  case 6:
    lVar3 = CONCAT22(*(undefined2 *)((int)&(pSVar1->score).cResources + 2),
                     (int)(pSVar1->score).cResources);
    break;
  case 7:
    lVar3 = CONCAT22(*(undefined2 *)((int)&(pSVar1->score).lScore + 2),(int)(&pSVar1->score)->lScore
                    );
    break;
  default:
    lVar3 = 0;
  }
  return lVar3;
}



// ======================================================================
// Function: DxReportColHdr
// Address: 1108:305e
// Segment: MEMORY_REPORT
// ======================================================================


short DxReportColHdr(short irpt,short iCol,char *psz,HDC hdc)

{
  int iVar1;
  short sVar2;
  int iVar3;
  undefined2 unaff_SS;
  DWORD DVar4;
  short dx2;
  short cch;
  short dx;
  short dxDigit;
  short ids;
  char szT [42];
  
  szT[0] = '8';
  DVar4 = GetTextExtent(hdc,(LPCSTR)szT,1);
  iVar1 = (int)DVar4;
  if (irpt != 0) {
    if (irpt == 1) {
      sVar2 = CchGetString(iCol + idsFleetName,psz);
      DVar4 = GetTextExtent(hdc,(LPCSTR)psz,sVar2);
      iVar3 = (int)DVar4;
      dx = iVar3;
      switch(iCol) {
      case 0:
      case 1:
      case 3:
      case 8:
      case 10:
      case 0xb:
        dx = iVar3 << 1;
        break;
      case 2:
        dx = iVar3 * 2 + iVar3 / 2;
        break;
      case 4:
        dx = iVar3 * 2 - iVar1;
        break;
      case 5:
        dx = iVar3 * 4 + iVar3 / 2;
        break;
      case 6:
        dx = iVar1 * 5;
        if (dx <= iVar3) {
          dx = iVar3;
        }
        break;
      case 7:
        dx = iVar1 * 0x13;
        if (iVar1 * 0x13 <= iVar3) {
          dx = iVar3;
        }
      }
    }
    else if (irpt == 2) {
      sVar2 = CchGetString(iCol + idsFleetName2,psz);
      DVar4 = GetTextExtent(hdc,(LPCSTR)psz,sVar2);
      dx = (short)DVar4;
      if (iCol == 0) {
        dx = dx * 3;
      }
      else {
        if (iCol != 1) {
          if (iCol == 2) {
            dx = dx * 2 + dx / 2;
            goto LAB_1108_337d;
          }
          if (iCol != 5) goto LAB_1108_337d;
        }
        dx = dx << 1;
      }
    }
    else {
      if (irpt != 3) {
        *psz = '\0';
        return 0;
      }
      sVar2 = CchGetString(iCol + idsLocation4,psz);
      DVar4 = GetTextExtent(hdc,(LPCSTR)psz,sVar2);
      dx = (short)DVar4;
      if (iCol == 0) {
        dx = dx * 2 + dx / 2;
      }
    }
    goto LAB_1108_337d;
  }
  sVar2 = CchGetString(iCol + idsPlanetName,psz);
  DVar4 = GetTextExtent(hdc,(LPCSTR)psz,sVar2);
  dx = (short)DVar4;
  switch(iCol) {
  case 0:
    dx = dx << 1;
    goto switchD_1108_3174_caseD_2;
  case 1:
  case 0xd:
  case 0xe:
    dx2 = iVar1 * 0xf;
    break;
  default:
    goto switchD_1108_3174_caseD_2;
  case 3:
    dx2 = iVar1 * 4 + 2;
    break;
  case 4:
    ids = 0x468;
    goto REPORT_ChkAltString;
  case 5:
    dx = dx * 3 + 0x14;
    goto switchD_1108_3174_caseD_2;
  case 6:
  case 7:
    dx2 = iVar1 * 5;
    break;
  case 9:
    dx2 = iVar1 * 0xe;
    break;
  case 10:
  case 0xb:
    dx2 = iVar1 * 0xb;
    break;
  case 0xc:
    ids = 0x46a;
REPORT_ChkAltString:
    sVar2 = CchGetString(ids,szT);
    DVar4 = GetTextExtent(hdc,(LPCSTR)szT,sVar2);
    dx2 = (short)DVar4;
  }
  if (dx < dx2) {
    dx = dx2;
  }
switchD_1108_3174_caseD_2:
LAB_1108_337d:
  return (dx + 6) / 2 << 1;
}



// ======================================================================
// Function: DrawReportItem
// Address: 1108:3398
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11083d76) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void DrawReportItem(HDC hdc,RECT *prc,short irpt,short irow,short icol)

{
  undefined2 *puVar1;
  PLANET *pPVar2;
  undefined2 *puVar3;
  short *psVar4;
  HBRUSH HVar5;
  float fVar6;
  ushort uVar7;
  char *pcVar8;
  uint uVar9;
  short sVar10;
  short sVar11;
  int iVar12;
  int iVar13;
  undefined2 unaff_SI;
  undefined2 *puVar14;
  PLANET *pPVar15;
  undefined2 *puVar16;
  undefined2 unaff_DI;
  short *psVar17;
  undefined2 unaff_SS;
  bool bVar18;
  DWORD DVar19;
  HULDEF *pHVar20;
  long lVar21;
  ulong uVar22;
  undefined2 uVar23;
  RECT *pRVar24;
  undefined2 uVar25;
  UINT UVar26;
  HDC HVar27;
  ushort in_stack_0000ff3e;
  undefined2 in_stack_0000ff40;
  short sVar28;
  undefined4 rgl;
  undefined2 local_96;
  undefined1 auStack_94 [6];
  float pct;
  undefined4 l;
  short cch;
  short xCur;
  char *psz;
  short dx;
  FLEET *lpfl;
  short i;
  short j;
  PLANET *lppl;
  char *lpsz;
  undefined2 local_70;
  char chT;
  char szT [100];
  BTLDATA *lpbd;
  
  szT[0] = '8';
  DVar19 = GetTextExtent(hdc,(LPCSTR)szT,1);
  dx = (short)DVar19;
  if (irpt == 0) {
    lppl = (PLANET *)
           CONCAT22(lpPlanets._2_2_,
                    (PLANET *)lpPlanets + ((ushort *)vlprgidPlanet)[irow]);
    SelectObject(hdc,rghfontArial8[1]);
    SetTextColor(hdc,0);
    SetBkMode(hdc,1);
    switch(icol) {
    case 0:
      if ((sel.grobj == grobjPlanet) && (sel.pl.id == lppl->id)) {
        SetTextColor(hdc,0x7f);
      }
      pcVar8 = PszGetPlanetName(lppl->id);
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pRVar24 = prc;
      HVar27 = hdc;
      psz = pcVar8;
      uVar7 = _strlen(pcVar8);
      ExtTextOut(HVar27,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,pRVar24),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      uVar23 = (undefined2)((ulong)lppl >> 0x10);
      if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
        return;
      }
      auStack_94._2_2_ = prc->top;
      auStack_94._4_2_ = prc->right;
      pct = (float)CONCAT22(pct._2_2_,prc->bottom);
      dx = (prc->bottom - auStack_94._2_2_) / 3 + -1;
      auStack_94._0_2_ = auStack_94._4_2_ - dx;
      pHVar20 = LphuldefFromId
                          (*(HullDef *)
                            (*(int *)(idPlayer * 4 + 0x14c) +
                            (*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) * 0x93));
      HVar5 = hbrYellow;
      if ((((HULDEF *)pHVar20)->hul).wtCargoMax == 0) {
        HVar5 = hbrBlue;
      }
      auStack_94._2_2_ = prc->top;
      pct = (float)CONCAT22(HVar5,auStack_94._2_2_ + dx);
      FillRect(hdc,(RECT *)(RECT *)auStack_94,HVar5);
      sVar10 = IWarpMAFromLppl(lppl,(short *)0x0);
      if (0 < sVar10) {
        auStack_94._2_2_ = prc->top + dx + 1;
        pct = (float)CONCAT22(pct._2_2_,auStack_94._2_2_ + dx);
        FillRect(hdc,(RECT *)(RECT *)auStack_94,hbrPurple);
      }
      sVar10 = IStargateFromLppl(lppl);
      if (sVar10 == -1) {
        return;
      }
      auStack_94._2_2_ = (dx + 1) * 2 + prc->top;
      pct = (float)CONCAT22(pct._2_2_,auStack_94._2_2_ + dx);
      FillRect(hdc,(RECT *)(RECT *)auStack_94,hbrGreen);
      return;
    case 1:
      if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
        lpsz = _szDblDash;
        local_70 = 0x1120;
      }
      else {
        local_70 = *(undefined2 *)(idPlayer * 4 + 0x14e);
        lpsz = (char *)(*(int *)(idPlayer * 4 + 0x14c) +
                        (*(uint *)&((PLANET *)lppl)->field11_0x2c & 0xf) * 0x93 + 8);
      }
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      pcVar8 = lpsz;
      uVar23 = local_70;
      uVar7 = __fstrlen((char *)CONCAT22(local_70,lpsz));
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 2:
      lVar21 = CalcPlanetMaxPop(lppl->id,((PLANET *)lppl)->iPlayer);
      iVar13 = (int)((ulong)lVar21 >> 0x10);
      uVar23 = (undefined2)((ulong)lppl >> 0x10);
      iVar12 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 0xe);
      if ((iVar13 <= iVar12) &&
         ((iVar13 < iVar12 || ((uint)lVar21 < *(uint *)(((PLANET *)lppl)->rgwtMin + 3))))) {
        SetTextColor(hdc,0xff);
      }
      uVar23 = (undefined2)((ulong)lppl >> 0x10);
      uVar22 = __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe),
                                          (int)((PLANET *)lppl)->rgwtMin[3]),100);
      cch = CommaFormatLong(szT,uVar22);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 3:
      sVar10 = PctPlanetCapacity(lppl);
      cch = wsprintf((char *)szT,(char *)PCTDPCTPCT,sVar10);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 4:
      cch = CchGetString(idsN100,szT);
      DVar19 = GetTextExtent(hdc,(LPCSTR)szT,cch);
      dx = (short)DVar19;
      i = PctPlanetDesirability(lppl,idPlayer);
      cch = wsprintf((char *)szT,(char *)PCTDPCTPCT,i);
      if (i < 0xb) {
        if (i < 0) {
          uVar9 = 0xff;
        }
        else {
          uVar9 = 0x7f7f;
        }
        SetTextColor(hdc,(ulong)uVar9);
      }
      RightTextOut(hdc,prc->left + dx,prc->top,szT,cch,0);
      j = PctPlanetOptValue(lppl,idPlayer);
      if (j <= i) {
        return;
      }
      if (0 < j) {
        if (j < 0xb) {
          uVar9 = 0x7f7f;
        }
        else {
          uVar9 = 0;
        }
        SetTextColor(hdc,(ulong)uVar9);
      }
      cch = wsprintf((char *)szT,s___d____1120_15f0);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 5:
      puVar14 = (undefined2 *)&sel.pl;
      puVar16 = (undefined2 *)&stack0xff3e;
      for (iVar12 = 0x1c; iVar12 != 0; iVar12 = iVar12 + -1) {
        puVar3 = puVar16;
        puVar16 = puVar16 + 1;
        puVar1 = puVar14;
        puVar14 = puVar14 + 1;
        *puVar3 = *puVar1;
      }
      psVar17 = (short *)&sel.pl;
      pPVar15 = (PLANET *)lppl;
      for (iVar12 = 0x1c; iVar12 != 0; iVar12 = iVar12 + -1) {
        psVar4 = psVar17;
        psVar17 = psVar17 + 1;
        pPVar2 = pPVar15;
        pPVar15 = (PLANET *)&pPVar15->iPlayer;
        *psVar4 = pPVar2->id;
      }
      FillPlanetProdLB(0,(PLPROD *)0x0,lppl);
      puVar16 = (undefined2 *)&stack0xff3e;
      puVar14 = (undefined2 *)&sel.pl;
      for (iVar12 = 0x1c; iVar12 != 0; iVar12 = iVar12 + -1) {
        puVar3 = puVar14;
        puVar14 = puVar14 + 1;
        puVar1 = puVar16;
        puVar16 = puVar16 + 1;
        *puVar3 = *puVar1;
      }
      DrawProductionItem(hdc,prc,(char *)szWork,0,0,2);
      return;
    case 6:
      uVar22 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ff3e);
      i = (uint)uVar22 & 0xfff;
      j = CMaxOperableMines(lppl,idPlayer,0);
      break;
    case 7:
      uVar22 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ff3e);
      i = (uint)uVar22 & 0xfff;
      j = CMaxOperableFactories(lppl,idPlayer,0);
      break;
    case 8:
      i = *(uint *)&((PLANET *)lppl)->dwFlags & 0xfff;
      j = CMaxOperableDefenses(lppl,idPlayer,0);
      if (i < 1) {
        szT[2] = 0x2d;
        szT[1] = 0x2d;
        szT[0] = '-';
        cch = 3;
      }
      else {
        CalcPctSurvive(lppl,&pct,(float *)0x0);
        pct = DAT_1120_1e0a - pct;
        local_96 = 100;
        auStack_94._0_2_ = 0;
        __ftol((double)CONCAT26(in_stack_0000ff40,
                                        CONCAT24(in_stack_0000ff3e,CONCAT22(unaff_SI,unaff_DI))));
        lVar21 = __ftol((double)CONCAT26(in_stack_0000ff40,
                                                 CONCAT24(in_stack_0000ff3e,
                                                          CONCAT22(unaff_SI,unaff_DI))));
        lVar21 = __ftol((double)CONCAT26(in_stack_0000ff3e,
                                                 CONCAT24(unaff_SI,CONCAT22(unaff_DI,(int)lVar21))))
        ;
        cch = wsprintf((char *)szT,(char *)PCTDXPCTDPCTPCT,(int)lVar21);
      }
      goto REPORT_DrawPlusDef;
    case 9:
    case 10:
      xCur = dx * 4 + prc->left;
      if (icol == 10) {
        xCur = xCur - dx;
        EstMineralsMined(lppl,&rgl,-1,0);
      }
      for (i = 0; i < 3; i = i + 1) {
        if (icol == 9) {
          l._0_2_ = (uint)((PLANET *)lppl)->rgwtMin[i];
          l._2_2_ = *(undefined2 *)((int)(((PLANET *)lppl)->rgwtMin + i) + 2);
        }
        else {
          l._0_2_ = *(uint *)(&rgl + i);
          l._2_2_ = *(undefined2 *)((int)&rgl + i * 4 + 2);
        }
        DrawMineralItem(hdc,xCur,prc->top,i,CONCAT22(l._2_2_,(uint)l));
        if (icol == 10) {
          xCur = xCur + dx * 4;
        }
        else {
          xCur = xCur + dx * 5;
        }
      }
      return;
    case 0xb:
      xCur = dx * 3 + prc->left;
      for (i = 0; i < 3; i = i + 1) {
        pct = (float)(ulong)CONCAT12(((PLANET *)lppl)->rgMinConc[i],pct._0_2_);
        fVar6 = pct;
        pct._2_2_ = (uint)((PLANET *)lppl)->rgMinConc[i];
        lVar21 = (long)(int)pct._2_2_;
        pct = fVar6;
        DrawMineralItem(hdc,xCur,prc->top,i,lVar21);
        xCur = xCur + dx * 4;
      }
      return;
    case 0xc:
      cch = CchGetString(idsN1000,szT);
      DVar19 = GetTextExtent(hdc,(LPCSTR)szT,cch);
      dx = (short)DVar19;
      i = CResourcesAtPlanet(lppl,idPlayer);
      j = i;
      uVar22 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),in_stack_0000ff3e);
      if ((uVar22 & 1) == 0) {
        sVar10 = MulDiv(i,(int)*(char *)((int)&rgplr[0].pctResearch +
                                        idPlayer * 0xc0),100);
        i = i - sVar10;
      }
      CchGetString(idsD4,szT);
      cch = wsprintf(szWork,(char *)szT,i);
      RightTextOut(hdc,prc->left + dx,prc->top,(char *)szWork,cch,0);
      cch = wsprintf((char *)szT,(char *)PCTD);
      RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
      return;
    case 0xd:
      if ((((PLANET *)lppl)->wFlags & 0x3ffU) == 0) {
        psz = _szDblDash;
      }
      else {
        psz = PszGetPlanetName((((PLANET *)lppl)->wFlags & 0x3ffU) - 1);
      }
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pcVar8 = psz;
      uVar7 = _strlen(psz);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 0xe:
      if ((((PLANET *)lppl)->wRouting & 0x3ffU) == 0) {
        psz = _szDblDash;
      }
      else {
        psz = PszGetPlanetName((((PLANET *)lppl)->wRouting & 0x3ffU) - 1);
      }
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pcVar8 = psz;
      uVar7 = _strlen(psz);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    default:
      return;
    }
    cch = CommaFormatLong(szT,(long)i);
REPORT_DrawPlusDef:
    if (j <= i) {
      if (i == j) {
        uVar9 = 0x7f00;
      }
      else {
        uVar9 = 0xff;
      }
      SetTextColor(hdc,(ulong)uVar9);
    }
    RightTextOut(hdc,prc->right,prc->top,szT,cch,0);
    return;
  }
  if (irpt == 1) {
                    /* WARNING: Load size is inaccurate */
    lpfl = (FLEET *)CONCAT22(*(undefined2 *)
                              ((int)((FLEET **)rglpfl + ((ushort *)vlprgidFleet)[irow]
                                    ) + 2),
                             ((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[irow]]);
    SelectObject(hdc,rghfontArial8[1]);
    SetTextColor(hdc,0);
    SetBkMode(hdc,1);
    switch(icol) {
    case 0:
      if ((sel.grobj == grobjFleet) && (sel.fl.id == lpfl->id)) {
        SetTextColor(hdc,0x7f);
      }
      pcVar8 = PszGetFleetName(lpfl->id);
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      psz = pcVar8;
      uVar7 = _strlen(pcVar8);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 1:
      psz = szT;
      cch = wsprintf((char *)psz,&DAT_1120_15f7,(lpfl->id & 0x1ffU) + 1);
      RightTextOut(hdc,prc->right + -2,prc->top,psz,cch,0);
      return;
    case 2:
      if (((FLEET *)lpfl)->idPlanet == -1) {
        psz = szT;
        sVar10 = (((FLEET *)lpfl)->pt).y;
        sVar11 = (&((FLEET *)lpfl)->pt)->x;
        pcVar8 = PszGetCompressedString(idsSpaceDD);
        wsprintf((char *)psz,(char *)pcVar8,sVar11,sVar10);
      }
      else {
        psz = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
      }
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pcVar8 = psz;
      uVar7 = _strlen(psz);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 3:
      pcVar8 = PszGetDestName(lpfl,hdc);
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      psz = pcVar8;
      uVar7 = _strlen(pcVar8);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 4:
      psz = PszGetETA(hdc,lpfl,(short *)0x0);
      sVar10 = 0;
      uVar7 = _strlen(psz);
      RightTextOut(hdc,prc->right,prc->top,psz,uVar7,sVar10);
      return;
    case 5:
      psz = PszGetTaskName(lpfl,&i);
      if (i != -1) {
        SetTextColor(hdc,CONCAT22(*(undefined2 *)(i * 4 + 0x44a),*(undefined2 *)(i * 4 + 0x448)));
      }
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pcVar8 = psz;
      uVar7 = _strlen(psz);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 6:
      goto switchD_1108_44e3_caseD_6;
    case 7:
      xCur = dx * 4 + prc->left;
      for (i = 0; i < 4; i = i + 1) {
        DrawMineralItem(hdc,xCur,prc->top,i,
                        CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2),
                                 (int)((FLEET *)lpfl)->rgwtMin[i]));
        xCur = xCur + dx * 5;
      }
      return;
    case 8:
      i = IshdefPrimaryFromLpfl(lpfl,&j);
      if ((((FLEET *)lpfl)->rgdv + i)->dp != 0) {
        SetTextColor(hdc,0xff);
      }
      prc->right = prc->right + dx * -6;
      pcVar8 = (char *)((int)&rgshdef[0].hul + 8 + i * 0x93);
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pRVar24 = prc;
      HVar27 = hdc;
      psz = pcVar8;
      uVar7 = _strlen(pcVar8);
      ExtTextOut(HVar27,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,pRVar24),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      psz = szT;
      sVar11 = wsprintf((char *)psz,(char *)PCTD,((FLEET *)lpfl)->rgcsh[i]);
      chT = '+';
      sVar28 = 0;
      sVar10 = prc->top;
      pcVar8 = psz;
      cch = sVar11;
      DVar19 = GetTextExtent(hdc,(LPCSTR)&chT,1);
      pct = (float)CONCAT22((int)DVar19,pct._0_2_);
      RightTextOut(hdc,(dx * 6 + prc->right) - (int)DVar19,sVar10,pcVar8,sVar11,sVar28);
      if (j < 2) {
        return;
      }
      DVar19 = GetTextExtent(hdc,(LPCSTR)&chT,1);
      pct = (float)CONCAT22((int)DVar19,pct._0_2_);
      TextOut(hdc,(dx * 6 + prc->right) - (int)DVar19,prc->top,(LPCSTR)&chT,1);
      return;
    case 9:
      i = PctCloakFromLpfl(lpfl);
      if (i == 0) {
        cch = _strlen(_szDblDash);
        psz = _szDblDash;
      }
      else {
        psz = szT;
        cch = wsprintf((char *)psz,(char *)PCTDPCTPCT,i);
      }
      RightTextOut(hdc,prc->right + -5,prc->top,psz,cch,0);
      return;
    case 10:
      i = (short)((FLEET *)lpfl)->iplan;
      uVar9 = (uint)lpfl->id >> 9 & 0xf;
      __fstrcpy((char *)szT,
                        (char *)CONCAT22(((undefined2 *)&DAT_1120_593a)[uVar9 * 2],
                                         ((BTLPLAN **)rglpbtlplan)[uVar9 * 2]
                                         [((FLEET *)lpfl)->iplan].szName));
      pcVar8 = szT;
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      psz = pcVar8;
      uVar7 = _strlen(pcVar8);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 0xb:
      lVar21 = WtFromLpfl(lpfl);
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,lVar21);
      return;
    default:
      return;
    }
  }
  if (irpt == 2) {
                    /* WARNING: Load size is inaccurate */
    lpfl = (FLEET *)CONCAT22(*(undefined2 *)
                              ((int)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow])
                              + 2),((FLEET **)rglpfl)[((ushort *)vlprgidMisc)[irow]]);
    SelectObject(hdc,rghfontArial8[1]);
    SetTextColor(hdc,0);
    SetBkMode(hdc,1);
    switch(icol) {
    case 0:
      if ((sel.scan.grobj == grobjFleet) &&
         (((FLEET **)rglpfl)[sel.scan.ifl]->id == lpfl->id)) {
        SetTextColor(hdc,0x7f);
      }
      pcVar8 = PszGetFleetName(lpfl->id);
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      psz = pcVar8;
      uVar7 = _strlen(pcVar8);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 1:
      psz = szT;
      cch = wsprintf((char *)psz,&DAT_1120_15fa,(lpfl->id & 0x1ffU) + 1);
      RightTextOut(hdc,prc->right + -2,prc->top,psz,cch,0);
      return;
    case 2:
      if (((FLEET *)lpfl)->idPlanet == -1) {
        psz = szT;
        sVar10 = (((FLEET *)lpfl)->pt).y;
        sVar11 = (&((FLEET *)lpfl)->pt)->x;
        pcVar8 = PszGetCompressedString(idsSpaceDD);
        wsprintf((char *)psz,(char *)pcVar8,sVar11,sVar10);
      }
      else {
        psz = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
      }
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      uVar23 = 0x1120;
      pcVar8 = psz;
      uVar7 = _strlen(psz);
      ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      return;
    case 3:
      if ((((uint)((FLEET *)lpfl)->wFlags >> 4 & 1) == 0) || ((((FLEET *)lpfl)->wFlags & 0xfU) == 0)
         ) {
        psz = (char *)&DAT_1120_15fd;
        cch = 2;
      }
      else {
        psz = szT;
        cch = wsprintf((char *)psz,&DAT_1120_1600,((FLEET *)lpfl)->wFlags & 0xf);
      }
      RightTextOut(hdc,prc->right + -2,prc->top,psz,cch,0);
      return;
    case 4:
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,
                      CONCAT22((((FLEET *)lpfl)->rgdv + 1)->dp,((FLEET *)lpfl)->rgdv->dp));
      return;
    case 5:
      i = IshdefPrimaryFromLpfl(lpfl,&j);
      prc->right = prc->right + dx * -6;
      iVar12 = ((FLEET *)lpfl)->iPlayer * 4;
      uVar23 = *(undefined2 *)(iVar12 + 0x100);
      pcVar8 = (char *)(*(int *)(iVar12 + 0xfe) + i * 0x93 + 8);
      sVar10 = prc->left;
      sVar11 = prc->top;
      UVar26 = 4;
      uVar25 = 0x1120;
      pRVar24 = prc;
      HVar27 = hdc;
      lpsz = pcVar8;
      local_70 = uVar23;
      uVar7 = __fstrlen((char *)CONCAT22(uVar23,pcVar8));
      ExtTextOut(HVar27,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,pRVar24),
                 (LPCSTR)CONCAT22(uVar23,pcVar8),uVar7,(short *)0x0);
      psz = szT;
      sVar11 = wsprintf((char *)psz,(char *)PCTD,((FLEET *)lpfl)->rgcsh[i]);
      chT = '+';
      sVar28 = 0;
      sVar10 = prc->top;
      pcVar8 = psz;
      cch = sVar11;
      DVar19 = GetTextExtent(hdc,(LPCSTR)&chT,1);
      pct = (float)CONCAT22((int)DVar19,pct._0_2_);
      RightTextOut(hdc,(dx * 6 + prc->right) - (int)DVar19,sVar10,pcVar8,sVar11,sVar28);
      if (j < 2) {
        return;
      }
      DVar19 = GetTextExtent(hdc,(LPCSTR)&chT,1);
      pct = (float)CONCAT22((int)DVar19,pct._0_2_);
      TextOut(hdc,(dx * 6 + prc->right) - (int)DVar19,prc->top,(LPCSTR)&chT,1);
      return;
    case 6:
      l._0_2_ = 0;
      l._2_2_ = 0;
      for (i = 0; i < 0x10; i = i + 1) {
        uVar9 = ((FLEET *)lpfl)->rgcsh[i];
        bVar18 = CARRY2((uint)l,uVar9);
        l._0_2_ = (uint)l + uVar9;
        l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar18;
      }
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,CONCAT22(l._2_2_,(uint)l));
      return;
    case 7:
      l._0_2_ = 0;
      l._2_2_ = 0;
      for (i = 0; i < 0x10; i = i + 1) {
        if (((FLEET *)lpfl)->rgcsh[i] != 0) {
          iVar12 = ((FLEET *)lpfl)->iPlayer * 4;
          pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar12 + 0xfe) + i * 0x93));
          j = (uint)((HULDEF *)pHVar20)->wFlags >> 10 & 0xf;
          if (((uint)j < 2) || (5 < (uint)j)) {
            uVar9 = ((FLEET *)lpfl)->rgcsh[i];
            bVar18 = CARRY2((uint)l,uVar9);
            l._0_2_ = (uint)l + uVar9;
            l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar18;
          }
        }
      }
      DrawMineralItem(hdc,prc->right + -2,prc->top,-1,CONCAT22(l._2_2_,(uint)l));
      return;
    case 8:
      j = 2;
      break;
    case 9:
      j = 3;
      break;
    case 10:
      j = 5;
      break;
    case 0xb:
      j = 4;
      break;
    default:
      return;
    }
    l._0_2_ = 0;
    l._2_2_ = 0;
    for (i = 0; i < 0x10; i = i + 1) {
      if ((((FLEET *)lpfl)->rgcsh[i] != 0) &&
         (iVar12 = ((FLEET *)lpfl)->iPlayer * 4,
         pHVar20 = LphuldefFromId(*(HullDef *)(*(int *)(iVar12 + 0xfe) + i * 0x93)),
         ((uint)((HULDEF *)pHVar20)->wFlags >> 10 & 0xf) == j)) {
        uVar9 = ((FLEET *)lpfl)->rgcsh[i];
        bVar18 = CARRY2((uint)l,uVar9);
        l._0_2_ = (uint)l + uVar9;
        l._2_2_ = l._2_2_ + ((int)uVar9 >> 0xf) + (uint)bVar18;
      }
    }
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,CONCAT22(l._2_2_,(uint)l));
    return;
  }
  if (irpt != 3) {
    return;
  }
  lpbd = BtlDataGet(((ushort *)vlprgidMisc)[irow]);
  if (((BTLDATA *)lpbd == (BTLDATA *)0x0) && ((int)((ulong)lpbd >> 0x10) == 0)) {
    return;
  }
  SelectObject(hdc,rghfontArial8[1]);
  SetTextColor(hdc,0);
  SetBkMode(hdc,1);
  switch(icol) {
  case 0:
    if (((BTLDATA *)lpbd)->idPlanet == -1) {
      psz = szT;
      sVar10 = (((BTLDATA *)lpbd)->pt).y;
      sVar11 = (&((BTLDATA *)lpbd)->pt)->x;
      pcVar8 = PszGetCompressedString(idsSpaceDD);
      wsprintf((char *)psz,(char *)pcVar8,sVar11,sVar10);
    }
    else {
      psz = PszGetPlanetName(((BTLDATA *)lpbd)->idPlanet);
    }
    uVar23 = (undefined2)((ulong)lpbd >> 0x10);
    if (((&((BTLDATA *)lpbd)->pt)->x == sel.scan.pt.x) &&
       ((((BTLDATA *)lpbd)->pt).y == sel.scan.pt.y)) {
      SetTextColor(hdc,0x7f);
    }
    sVar10 = prc->left;
    sVar11 = prc->top;
    UVar26 = 4;
    uVar25 = 0x1120;
    uVar23 = 0x1120;
    pcVar8 = psz;
    uVar7 = _strlen(psz);
    ExtTextOut(hdc,sVar10,sVar11,UVar26,(RECT *)CONCAT22(uVar25,prc),(LPCSTR)CONCAT22(uVar23,pcVar8)
               ,uVar7,(short *)0x0);
    return;
  case 1:
    lVar21 = CBattleUnits(lpbd,5);
    if (lVar21 == 0) {
      lVar21 = CBattleUnits(lpbd,6);
      if (lVar21 == 0) {
        chT = ' ';
      }
      else {
        chT = 'T';
      }
    }
    else {
      chT = 'O';
    }
    CtrTextOut(hdc,(prc->right - prc->left) / 2 + prc->left,prc->top,&chT,1);
    return;
  case 2:
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,(ulong)((BTLDATA *)lpbd)->cplr);
    return;
  case 3:
    i = 0xff;
    break;
  case 4:
    i = 0xfd;
    break;
  case 5:
    i = 0xfe;
    break;
  case 6:
    i = 0xb;
    break;
  case 7:
    i = 0x13;
    break;
  case 8:
    i = 0x23;
    break;
  case 9:
    i = 0x43;
    break;
  case 10:
    i = 0x83;
    break;
  case 0xb:
  case 0xc:
    l = CBattleKills(lpbd,(uint)(icol == 0xb));
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,l);
    return;
  case 0xd:
    i = 0xfd;
    goto REPORT_LUnitsLeft_2;
  case 0xe:
    i = 0xfe;
REPORT_LUnitsLeft_2:
    l = CBattleUnits(lpbd,i);
    lVar21 = CBattleKills(lpbd,(uint)(icol == 0xd));
    l = l - lVar21;
    DrawMineralItem(hdc,prc->right + -2,prc->top,-1,l);
  default:
    goto switchD_1108_3e3e_default;
  }
  lVar21 = CBattleUnits(lpbd,i);
  DrawMineralItem(hdc,prc->right + -2,prc->top,-1,lVar21);
switchD_1108_3e3e_default:
  return;
switchD_1108_44e3_caseD_6:
  if (1 < ((FLEET *)lpfl)->cord) {
    lVar21 = EstFuelUse(lpfl,0,(uint)((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 4 &
                                     0xf,-1,0);
    iVar13 = (int)((ulong)lVar21 >> 0x10);
    uVar23 = (undefined2)((ulong)lpfl >> 0x10);
    iVar12 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0x12);
    if ((iVar12 < iVar13) ||
       ((iVar12 <= iVar13 && (*(uint *)(((FLEET *)lpfl)->rgwtMin + 4) < (uint)lVar21)))) {
      iVar12 = 0;
      goto LAB_1108_422c;
    }
  }
  iVar12 = 1;
LAB_1108_422c:
  pct = (float)CONCAT22(iVar12,pct._0_2_);
  uVar23 = (undefined2)((ulong)lpfl >> 0x10);
  DrawMineralItem(hdc,dx * 4 + prc->left,prc->top,-iVar12,
                  CONCAT22(*(undefined2 *)((int)((FLEET *)lpfl)->rgwtMin + 0x12),
                           (int)((FLEET *)lpfl)->rgwtMin[4]));
  return;
}



// ======================================================================
// Function: DrawMineralItem
// Address: 1108:4ebe
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11084f0e) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void DrawMineralItem(HDC hdc,short x,short y,short iMineral,long l)

{
  short cch;
  char *psz;
  
  if (iMineral < 0) {
    SetTextColor(hdc,0);
  }
  else {
    SetTextColor(hdc,CONCAT22(*(undefined2 *)(iMineral * 4 + 0x44a),
                              *(undefined2 *)(iMineral * 4 + 0x448)));
  }
  if (l < 0) {
    cch = _strlen(_szDblDash);
    psz = _szDblDash;
  }
  else {
    psz = PszFromLongK(l,&cch);
  }
  RightTextOut(hdc,x,y,psz,cch,0);
  return;
}



// ======================================================================
// Function: PszGetDestName
// Address: 1108:4f60
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

char * PszGetDestName(FLEET *lpfl,HDC hdc)

{
  short *psVar1;
  short *psVar2;
  undefined2 uVar3;
  uint uVar4;
  char *pcVar5;
  int iVar6;
  FLEET *pFVar7;
  short *psVar8;
  short *psVar9;
  undefined2 uVar10;
  undefined2 unaff_SS;
  short ord;
  short local_16;
  short local_14;
  uint local_12;
  uint local_10 [5];
  short i;
  
  uVar10 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar7 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  psVar8 = (short *)(*(int *)&pFVar7->lpplord + 4);
  psVar9 = &ord;
  for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
    psVar2 = psVar9;
    psVar9 = psVar9 + 1;
    psVar1 = psVar8;
    psVar8 = psVar8 + 1;
    *psVar2 = *psVar1;
  }
  if (pFVar7->cord < 2) {
    return _szDblDash;
  }
  if ((local_12 >> 0xc & 1) != 0) {
    uVar4 = local_12 & 0xf;
    if (uVar4 == 1) {
      for (i = 0; i < 5; i = i + 1) {
        if (local_10[i] >> 0xc == 6) goto REPORT_LDelayed;
      }
    }
    else if (uVar4 == 2) {
      if ((local_12 >> 8 & 0xf) == 1) {
        return _szDblDash;
      }
    }
    else {
      if (uVar4 == 4) {
        return _szDblDash;
      }
      if (uVar4 == 5) {
        return _szDblDash;
      }
      if (uVar4 == 6) {
REPORT_LDelayed:
        if (hdc != 0) {
          SetTextColor(hdc,0x7f);
        }
        pcVar5 = PszGetCompressedString(idsDelayed);
        return pcVar5;
      }
    }
  }
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  psVar8 = (short *)(*(int *)&pFVar7->lpplord + 0x16);
  psVar9 = &ord;
  for (iVar6 = 9; iVar6 != 0; iVar6 = iVar6 + -1) {
    psVar2 = psVar9;
    psVar9 = psVar9 + 1;
    psVar1 = psVar8;
    psVar8 = psVar8 + 1;
    *psVar2 = *psVar1;
  }
  pcVar5 = PszGetLocName(local_12 >> 8 & (grobjThing|grobjOther|grobjFleet|grobjPlanet),
                               local_14,ord,local_16);
  return pcVar5;
}



// ======================================================================
// Function: FDestIsWP0
// Address: 1108:50b4
// Segment: MEMORY_REPORT
// ======================================================================


short FDestIsWP0(FLEET *lpfl)

{
  undefined2 *puVar1;
  undefined2 *puVar2;
  undefined2 uVar3;
  uint uVar4;
  int iVar5;
  FLEET *pFVar6;
  undefined2 *puVar7;
  undefined2 *puVar8;
  undefined2 uVar9;
  undefined2 unaff_SS;
  undefined2 ord [3];
  uint local_12;
  uint local_10 [5];
  short i;
  
  uVar9 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar6 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar6->lpplord + 2);
  puVar7 = (undefined2 *)(*(int *)&pFVar6->lpplord + 4);
  puVar8 = ord;
  for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
    puVar2 = puVar8;
    puVar8 = puVar8 + 1;
    puVar1 = puVar7;
    puVar7 = puVar7 + 1;
    *puVar2 = *puVar1;
  }
  if (pFVar6->cord < 2) {
    return 1;
  }
  if ((local_12 >> 0xc & 1) != 0) {
    uVar4 = local_12 & 0xf;
    if (uVar4 == 1) {
      for (i = 0; i < 5; i = i + 1) {
        if (local_10[i] >> 0xc == 6) {
          return 1;
        }
      }
    }
    else if (uVar4 == 2) {
      if ((local_12 >> 8 & 0xf) == 1) {
        return 1;
      }
    }
    else {
      if (uVar4 == 4) {
        return 1;
      }
      if (uVar4 == 5) {
        return 1;
      }
      if (uVar4 == 6) {
        return 1;
      }
    }
  }
  return 0;
}



// ======================================================================
// Function: PszGetETA
// Address: 1108:51a8
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

char * PszGetETA(HDC hdc,FLEET *lpfl,short *pcYears)

{
  undefined2 *puVar1;
  undefined2 *puVar2;
  undefined2 uVar3;
  uint uVar4;
  int iVar5;
  int iVar6;
  FLEET *pFVar7;
  undefined2 *puVar8;
  undefined2 *puVar9;
  undefined2 uVar10;
  undefined2 unaff_SS;
  long lVar11;
  char *psz;
  undefined2 ord;
  undefined2 local_1c;
  uint local_18;
  uint local_16 [5];
  short i;
  short c;
  undefined2 pt;
  undefined2 local_6;
  
  uVar10 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar7 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  puVar8 = (undefined2 *)(*(int *)&pFVar7->lpplord + 4);
  puVar9 = &ord;
  for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
    puVar2 = puVar9;
    puVar9 = puVar9 + 1;
    puVar1 = puVar8;
    puVar8 = puVar8 + 1;
    *puVar2 = *puVar1;
  }
  pt = ord;
  local_6 = local_1c;
  if (pFVar7->cord < 2) goto REPORT_LNoETA;
  if ((local_18 >> 0xc & 1) != 0) {
    uVar4 = local_18 & 0xf;
    if (uVar4 == 1) {
      for (i = 0; i < 5; i = i + 1) {
        if (local_16[i] >> 0xc == 6) goto REPORT_LNoETA;
      }
    }
    else if (uVar4 == 2) {
      if ((local_18 >> 8 & 0xf) == 1) {
REPORT_LNoETA:
        if (pcYears == (short *)0x0) {
          return _szDblDash;
        }
        *pcYears = 0;
        return _szDblDash;
      }
    }
    else if (((uVar4 == 4) || (uVar4 == 5)) || (uVar4 == 6)) goto REPORT_LNoETA;
  }
  uVar3 = *(undefined2 *)((int)&pFVar7->lpplord + 2);
  puVar8 = (undefined2 *)(*(int *)&pFVar7->lpplord + 0x16);
  puVar9 = &ord;
  for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
    puVar2 = puVar9;
    puVar9 = puVar9 + 1;
    puVar1 = puVar8;
    puVar8 = puVar8 + 1;
    *puVar2 = *puVar1;
  }
  CchGetETA(hdc,lpfl,(char *)szWork,1,1);
  if (hdc != 0) {
    lVar11 = EstFuelUse(lpfl,0,local_18 >> 4 & 0xf,-1,0);
    iVar6 = (int)((ulong)lVar11 >> 0x10);
    iVar5 = *(int *)((int)pFVar7->rgwtMin + 0x12);
    if ((iVar5 <= iVar6) && ((iVar5 < iVar6 || (*(uint *)(pFVar7->rgwtMin + 4) < (uint)lVar11)))) {
      SetTextColor(hdc,0xff);
    }
  }
  if (pcYears != (short *)0x0) {
    c = 0;
    for (psz = (char *)szWork; ('/' < *psz && (*psz < ':')); psz = psz + 1) {
      c = c * 10 + *psz + -0x30;
    }
    if (c == 0) {
      c = 32000;
    }
    *pcYears = c;
  }
  return (char *)szWork;
}



// ======================================================================
// Function: PszGetTaskName
// Address: 1108:53b8
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

char * PszGetTaskName(FLEET *lpfl,short *picr)

{
  undefined2 *puVar1;
  undefined2 *puVar2;
  undefined2 uVar3;
  bool bVar4;
  uint uVar5;
  short sVar6;
  char *pcVar7;
  ushort uVar8;
  char *pcVar9;
  int iVar10;
  FLEET *pFVar11;
  undefined2 *puVar12;
  undefined2 *puVar13;
  undefined2 uVar14;
  undefined2 unaff_SS;
  short fPercent;
  undefined2 ord [3];
  uint local_1a;
  uint local_18 [4];
  uint local_10;
  short i;
  short iZip;
  short opOrd;
  short ids;
  short icr;
  
  icr = -1;
  uVar14 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar11 = (FLEET *)lpfl;
  uVar3 = *(undefined2 *)((int)&pFVar11->lpplord + 2);
  puVar12 = (undefined2 *)(*(int *)&pFVar11->lpplord + 4);
  puVar13 = ord;
  for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
    puVar2 = puVar13;
    puVar13 = puVar13 + 1;
    puVar1 = puVar12;
    puVar12 = puVar12 + 1;
    *puVar2 = *puVar1;
  }
  *picr = -1;
  if ((local_1a >> 0xc & 1) != 0) {
    switch(local_1a & 0xf) {
    case 1:
      for (i = 0; i < 4; i = i + 1) {
        if (local_18[i] >> 0xc == 6) goto REPORT_LShowTask;
      }
      break;
    case 2:
    case 4:
    case 5:
    case 6:
    case 8:
      goto REPORT_LShowTask;
    }
  }
  if (1 < pFVar11->cord) {
    uVar3 = *(undefined2 *)((int)&pFVar11->lpplord + 2);
    puVar12 = (undefined2 *)(*(int *)&pFVar11->lpplord + 0x16);
    puVar13 = ord;
    for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
      puVar2 = puVar13;
      puVar13 = puVar13 + 1;
      puVar1 = puVar12;
      puVar12 = puVar12 + 1;
      *puVar2 = *puVar1;
    }
  }
REPORT_LShowTask:
  pcVar7 = _szDblDash;
  if ((local_1a >> 0xc & 1) != 0) {
    ids = (local_1a & 0xf) + idsTaskHere;
    uVar5 = local_1a & 0xf;
    if (uVar5 == 1) {
      for (i = 0; i < 4; i = i + 1) {
        if ((*(char *)((int)&vrgZip[0].fValid + i * 0x18) != '\0') &&
           (sVar6 = _memcmp((ZIPORDER *)vrgZip + i,local_18,10), sVar6 == 0)) {
          return (char *)((int)vrgZip[0].szName + i * 0x18);
        }
      }
      ids = 0x6d;
      iZip = -1;
      if ((local_10 >> 0xc == 7) &&
         ((local_18[3] >> 0xc == 0 || ((local_18[3] >> 0xc == 2 && (local_18[0] >> 0xc == 2)))))) {
        opOrd = local_18[0] >> 0xc;
        if ((opOrd == 1) || ((opOrd == 2 || (opOrd == 6)))) {
          i = 1;
          while ((i < 3 && (local_18[i] >> 0xc == opOrd))) {
            i = i + 1;
          }
          if (i == 3) {
            if (opOrd == 1) {
              iZip = 0;
            }
            else if (opOrd == 2) {
              iZip = 1;
            }
            else if (opOrd == 6) {
              iZip = 2;
            }
            return (char *)*(undefined2 *)(iZip * 2 + 0x906);
          }
        }
      }
      for (i = 4; -1 < i; i = i + -1) {
        opOrd = local_18[i] >> 0xc;
        if ((uint)ids < opOrd + 0x6dU) {
          ids = opOrd + 0x6d;
          icr = i;
        }
      }
      if (ids == 0x6d) {
        pcVar7 = PszGetCompressedString(idsTransport);
      }
      else {
        opOrd = local_18[icr] >> 0xc;
        *picr = icr;
        bVar4 = false;
        switch(opOrd) {
        default:
          pcVar7 = _szDblDash;
          break;
        case 5:
        case 6:
          bVar4 = true;
        case 4:
        case 8:
        case 9:
          pcVar7 = PszGetCompressedString(ids);
          uVar8 = _strlen(pcVar7);
          pcVar7[uVar8 - 3] = '\0';
          if (bVar4) {
            wsprintf(szWork,s__s__d___1120_1603,pcVar7,0x1120,local_18[icr] & 0xfff);
          }
          else {
            if (icr == 4) {
              pcVar9 = (char *)s__s__dmg_1120_160b;
            }
            else {
              pcVar9 = (char *)s__s__dkT_1120_1613;
            }
            wsprintf(szWork,(char *)pcVar9,pcVar7,0x1120,local_18[icr] & 0xfff);
          }
          pcVar7 = (char *)szWork;
          break;
        case 7:
          if (icr == 4) {
            ids = 0x77;
          }
        case 1:
        case 2:
          pcVar7 = PszGetCompressedString(ids);
        }
      }
    }
    else if (uVar5 == 6) {
      if (local_18[0] < 5) {
        iVar10 = local_18[0] + 1;
        pcVar7 = PszGetCompressedString(ids);
        wsprintf(szWork,s__s__dy_1120_161b,pcVar7,0x1120,iVar10);
      }
      else {
        CchGetString(ids,(char *)szWork);
      }
      pcVar7 = (char *)szWork;
    }
    else if (uVar5 == 7) {
      if (local_18[1] < 0xb) {
        iVar10 = (local_18[1] + 1) * 0x32;
        pcVar7 = PszGetCompressedString(ids);
        wsprintf(szWork,s__s__dly_1120_1623,pcVar7,0x1120,iVar10);
      }
      else {
        CchGetString(ids,(char *)szWork);
      }
      pcVar7 = (char *)szWork;
    }
    else {
      pcVar7 = PszGetCompressedString(ids);
    }
  }
  return pcVar7;
}



// ======================================================================
// Function: SortReportCache
// Address: 1108:589c
// Segment: MEMORY_REPORT
// ======================================================================


void SortReportCache(short irpt,short icol)

{
  FLEET *pFVar1;
  int iVar2;
  undefined2 uVar3;
  undefined2 unaff_SS;
  short i;
  FLEET *lpfl;
  PLANET *lppl;
  ushort iItem;
  short cRows;
  ushort rgidRep [1025];
  
  cRows = 0;
  iItem = 0;
  if (vprptCur->icolSort != icol) {
    vicolSortPrev = vprptCur->icolSort;
    viSubsortPrev = vprptCur->iSubsort;
    vfAscendingPrev = vprptCur->fAscending;
    vprptCur->icolSort = icol;
    gd._4_2_ = gd._4_2_ & 0xff7f | 0x80;
  }
  if ((hwndReportDlg != 0) || (vprptCur->fCached == 0)) {
    if (irpt == 0) {
      vlprgidRep._0_2_ = (ushort *)vlprgidPlanet;
      vlprgidRep._2_2_ = vlprgidPlanet._2_2_;
      lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
      while ((PLANET *)lppl < (PLANET *)lpPlanets + cPlanet) {
        uVar3 = (undefined2)((ulong)lppl >> 0x10);
        if ((((PLANET *)lppl)->iPlayer == idPlayer) &&
           ((((PLANET *)lppl)->wFlags & 0xffU) == 7)) {
          rgidRep[cRows] = iItem;
          cRows = cRows + 1;
        }
        iItem = iItem + 1;
        lppl = (PLANET *)CONCAT22(uVar3,(PLANET *)lppl + 1);
      }
    }
    else if (irpt == 1) {
      vlprgidRep._0_2_ = (ushort *)vlprgidFleet;
      vlprgidRep._2_2_ = vlprgidFleet._2_2_;
      for (iItem = 0; (int)iItem < cFleet; iItem = iItem + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar1 = ((FLEET **)rglpfl)[iItem];
        iVar2 = *(int *)((int)((FLEET **)rglpfl + iItem) + 2);
        lpfl = (FLEET *)CONCAT22(iVar2,pFVar1);
        if ((pFVar1 == (FLEET *)0x0) && (iVar2 == 0)) break;
        if (((uint)lpfl->id >> 9 & 0xf) == idPlayer) {
          rgidRep[cRows] = iItem;
          cRows = cRows + 1;
        }
      }
    }
    else if (irpt == 2) {
      vlprgidRep._0_2_ = (ushort *)vlprgidMisc;
      vlprgidRep._2_2_ = vlprgidMisc._2_2_;
      vrptBattle.fCached = 0;
      for (iItem = 0; (int)iItem < cFleet; iItem = iItem + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar1 = ((FLEET **)rglpfl)[iItem];
        iVar2 = *(int *)((int)((FLEET **)rglpfl + iItem) + 2);
        lpfl = (FLEET *)CONCAT22(iVar2,pFVar1);
        if ((pFVar1 == (FLEET *)0x0) && (iVar2 == 0)) break;
        if (((uint)lpfl->id >> 9 & 0xf) != idPlayer) {
          rgidRep[cRows] = iItem;
          cRows = cRows + 1;
        }
        if (0x3fb < cRows) break;
      }
    }
    else {
      if (irpt != 3) {
        return;
      }
      vlprgidRep._0_2_ = (ushort *)vlprgidMisc;
      vlprgidRep._2_2_ = vlprgidMisc._2_2_;
      vrptEFleet.fCached = 0;
      cRows = CBattles();
      for (i = 0; i < cRows; i = i + 1) {
        rgidRep[i] = i;
      }
    }
    vprptCur->cRows = cRows;
    _qsort(rgidRep,cRows,2,(code *)ICompReport);
    __fmemcpy((ushort *)CONCAT22(vlprgidRep._2_2_,(ushort *)vlprgidRep),
                      (ushort *)rgidRep,cRows << 1);
    vprptCur->fCached = 1;
  }
  return;
}



// ======================================================================
// Function: ICompReport
// Address: 1108:5bb8
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: iLast */
/* WARNING: Removing unreachable block (ram,0x11086012) */
/* WARNING: Removing unreachable block (ram,0x11086072) */
/* WARNING: Removing unreachable block (ram,0x1108695b) */

short ICompReport(void *arg1,void *arg2)

{
  uint uVar1;
  FLEET *pFVar2;
  BTLDATA *pBVar3;
  int iVar4;
  short sVar5;
  PLANET *pPVar6;
  PLANET *pPVar7;
  char *pcVar8;
  int iVar9;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar10;
  undefined2 unaff_SS;
  bool bVar11;
  undefined1 uVar12;
  ulong uVar13;
  long lVar14;
  HULDEF *pHVar15;
  ulong uVar16;
  short iLast;
  uint rgl [4];
  char *local_84;
  float pct1;
  float pct2;
  undefined4 ibtl1;
  PLANET *lppl2;
  short irpt;
  short fTier2;
  short i2;
  short iRet;
  char *psz;
  short iSubsort;
  undefined4 l1;
  short i;
  short j;
  short i1;
  short icolSort;
  short fAscending;
  undefined4 l2;
  char szT [6];
  char local_4e [76];
  
  uVar13 = CONCAT22(l2._2_2_,(uint)l2);
  uVar16 = CONCAT22(unaff_SI,unaff_DI);
  iRet = 0;
  iSubsort = vprptCur->iSubsort;
  irpt = vprptCur->irpt;
  icolSort = vprptCur->icolSort;
  fAscending = vprptCur->fAscending;
  fTier2 = 0;
  do {
    pBVar3 = (BTLDATA *)pct2;
    l2 = uVar13;
    if (irpt == 0) {
      pPVar6 = (PLANET *)lpPlanets + *(int *)arg1;
      ibtl1 = (FLEET *)CONCAT22(lpPlanets._2_2_,pPVar6);
      pPVar7 = (PLANET *)lpPlanets + *(int *)arg2;
      lppl2 = (PLANET *)CONCAT22(lpPlanets._2_2_,pPVar7);
      switch(icolSort) {
      case 0:
        psz = PszGetPlanetName(((PLANET *)ibtl1)->id);
        _strcpy(szT,psz);
        psz = PszGetPlanetName(lppl2->id);
        iRet = _strcmp(szT,psz);
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 1:
        if (((uint)pPVar6->wFlags >> 9 & 1) == 0) {
          iRet = (short)(((uint)pPVar7->wFlags >> 9 & 1) != 0);
        }
        else if (((uint)pPVar7->wFlags >> 9 & 1) == 0) {
          iRet = -1;
        }
        else {
          iRet = __fstrcmp((char *)CONCAT22(*(undefined2 *)(idPlayer * 4 + 0x14e),
                                                    (char *)(*(int *)(idPlayer * 4 + 0x14c) +
                                                             (*(uint *)&pPVar6->field11_0x2c & 0xf)
                                                             * 0x93 + 8)),
                                   (char *)CONCAT22(*(undefined2 *)(idPlayer * 4 + 0x14e),
                                                    (char *)(*(int *)(idPlayer * 4 + 0x14c) +
                                                             (*(uint *)&pPVar7->field11_0x2c & 0xf)
                                                             * 0x93 + 8)));
          pBVar3 = (BTLDATA *)pct2;
          uVar13 = l2;
        }
        break;
      case 2:
        iRet = (int)pPVar6->rgwtMin[3] - (int)pPVar7->rgwtMin[3];
        break;
      case 3:
        sVar5 = PctPlanetCapacity((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar7));
        pct2 = (float)CONCAT22(sVar5,pct2._0_2_);
        sVar5 = PctPlanetCapacity((PLANET *)ibtl1);
        iRet = sVar5 - pct2._2_2_;
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 4:
        sVar5 = PctPlanetDesirability
                          ((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar7),idPlayer);
        pct2 = (float)CONCAT22(sVar5,pct2._0_2_);
        sVar5 = PctPlanetDesirability((PLANET *)ibtl1,idPlayer);
        iRet = sVar5 - pct2._2_2_;
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 5:
        FillPlanetProdLB(0,(PLPROD *)0x0,(PLANET *)CONCAT22(lpPlanets._2_2_,pPVar6));
        _strcpy(szT,(char *)szWork);
        FillPlanetProdLB(0,(PLPROD *)0x0,lppl2);
        iRet = _strcmp(local_4e,(char *)(uint *)&UINT_1108_57aa);
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 6:
        uVar13 = __aFulshr(uVar16,iLast);
        uVar10 = (undefined2)((ulong)ibtl1 >> 0x10);
        pct2 = (float)CONCAT22(*(undefined2 *)((int)&((PLANET *)ibtl1)->dwFlags + 2),
                               (int)((PLANET *)ibtl1)->dwFlags);
        pct1 = (float)(ulong)((uint)uVar13 & 0xfff);
        uVar13 = __aFulshr(uVar16,iLast);
        iRet = ((uint)uVar13 & 0xfff) - pct1._0_2_;
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 7:
        uVar13 = __aFulshr(uVar16,iLast);
        uVar10 = (undefined2)((ulong)ibtl1 >> 0x10);
        pct2 = (float)CONCAT22(*(undefined2 *)((int)&((PLANET *)ibtl1)->dwFlags + 2),
                               (int)((PLANET *)ibtl1)->dwFlags);
        pct1 = (float)(ulong)((uint)uVar13 & 0xfff);
        uVar13 = __aFulshr(uVar16,iLast);
        iRet = ((uint)uVar13 & 0xfff) - pct1._0_2_;
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 8:
        if ((*(uint *)&pPVar6->dwFlags & 0xfff) == 0) {
          rgl[1] = 0;
          rgl[2] = 0;
          pct1 = 0.0;
        }
        else {
          CalcPctSurvive((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar6),&pct1,(float *)0x0)
          ;
          pct1 = DAT_1120_1e0a - pct1;
          uVar13 = l2;
        }
        bVar11 = (*(uint *)&((PLANET *)lppl2)->dwFlags & 0xfff) == 0;
        if (bVar11) {
          rgl[1] = 0;
          rgl[2] = 0;
          pct2 = 0.0;
        }
        else {
          l2 = uVar13;
          CalcPctSurvive(lppl2,&pct2,(float *)0x0);
          pct2 = DAT_1120_1e0a - pct2;
          uVar13 = l2;
        }
        uVar12 = bVar11 || &stack0x0000 == (undefined1 *)((int)game.szName + 2);
        bVar11 = !bVar11 && (undefined1 *)0xfff7 < &stack0xff66;
        l2 = uVar13;
        __aFfcompp();
        if (bVar11) {
          iRet = -1;
          pBVar3 = (BTLDATA *)pct2;
          uVar13 = l2;
        }
        else {
          __aFfcompp();
          pBVar3 = (BTLDATA *)pct2;
          uVar13 = l2;
          if (bVar11 || (bool)uVar12) {
            iRet = 0;
          }
          else {
            iRet = 1;
          }
        }
        break;
      case 9:
        if (iSubsort == 3) {
          pct2 = 2.8026e-45;
        }
        else {
          pct2 = (float)CONCAT22(iSubsort,iSubsort);
        }
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = pct2._2_2_;
        while( true ) {
          uVar13 = CONCAT22(l2._2_2_,(uint)l2);
          if (pct2._0_2_ < i) break;
          uVar1 = *(uint *)(pPVar6->rgwtMin + i);
          bVar11 = CARRY2((uint)l1,uVar1);
          l1._0_2_ = (uint)l1 + uVar1;
          l1._2_2_ = l1._2_2_ + *(uint *)((int)(pPVar6->rgwtMin + i) + 2) + (uint)bVar11;
          uVar1 = *(uint *)(pPVar7->rgwtMin + i);
          bVar11 = CARRY2((uint)l2,uVar1);
          l2._0_2_ = (uint)l2 + uVar1;
          l2._2_2_ = l2._2_2_ + *(uint *)((int)(pPVar7->rgwtMin + i) + 2) + (uint)bVar11;
          i = i + 1;
        }
        iVar4 = (uint)l1 - (uint)l2;
        iVar9 = (l1._2_2_ - l2._2_2_) - (uint)((uint)l1 < (uint)l2);
        l1 = CONCAT22(iVar9,iVar4);
        pBVar3 = (BTLDATA *)pct2;
        if ((iVar9 < 1) && (iVar9 < 0)) {
          iRet = -1;
        }
        else if ((iVar9 < 0) || ((iVar9 < 1 && (iVar4 == 0)))) {
          iRet = 0;
        }
        else {
          iRet = 1;
        }
        break;
      case 10:
        if (iSubsort == 3) {
          pct2 = (float)((ulong)pct2 & 0xffff);
          iLast = 2;
        }
        else {
          iLast = iSubsort;
          pct2 = (float)CONCAT22(iSubsort,pct2._0_2_);
        }
        EstMineralsMined((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar6),(long *)rgl,-1,0);
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        for (i = pct2._2_2_; i <= iLast; i = i + 1) {
          bVar11 = CARRY2((uint)l1,rgl[i * 2]);
          l1._0_2_ = (uint)l1 + rgl[i * 2];
          l1._2_2_ = l1._2_2_ + rgl[i * 2 + 1] + (uint)bVar11;
        }
        EstMineralsMined(lppl2,(long *)rgl,-1,0);
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        for (i = pct2._2_2_; i <= iLast; i = i + 1) {
          bVar11 = CARRY2((uint)l2,rgl[i * 2]);
          l2._0_2_ = (uint)l2 + rgl[i * 2];
          l2._2_2_ = l2._2_2_ + rgl[i * 2 + 1] + (uint)bVar11;
        }
        iRet = (uint)l1 - (uint)l2;
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = CONCAT22(l2._2_2_,(uint)l2);
        break;
      case 0xb:
        if (iSubsort == 3) {
          i2 = 0;
          i1 = 0;
          for (i = 0; i < 3; i = i + 1) {
            i1 = i1 + (uint)pPVar6->rgMinConc[i];
            i2 = i2 + (uint)pPVar7->rgMinConc[i];
          }
        }
        else {
          i1 = (short)pPVar6->rgMinConc[iSubsort];
          i2 = (short)pPVar7->rgMinConc[iSubsort];
        }
        iRet = i1 - i2;
        break;
      case 0xc:
        sVar5 = CResourcesAtPlanet
                          ((PLANET *)CONCAT22(lpPlanets._2_2_,pPVar7),idPlayer);
        pct2 = (float)CONCAT22(sVar5,pct2._0_2_);
        sVar5 = CResourcesAtPlanet((PLANET *)ibtl1,idPlayer);
        iRet = sVar5 - pct2._2_2_;
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        break;
      case 0xd:
        if ((pPVar6->wFlags & 0x3ffU) == 0) {
          iRet = (short)((pPVar7->wFlags & 0x3ffU) != 0);
        }
        else if ((pPVar7->wFlags & 0x3ffU) == 0) {
          iRet = -1;
        }
        else {
          psz = PszGetPlanetName((pPVar6->wFlags & 0x3ffU) - 1);
          _strcpy(szT,psz);
          psz = PszGetPlanetName((((PLANET *)lppl2)->wFlags & 0x3ffU) - 1);
          iRet = _strcmp(szT,psz);
          pBVar3 = (BTLDATA *)pct2;
          uVar13 = l2;
        }
        break;
      case 0xe:
        if ((pPVar6->wRouting & 0x3ffU) == 0) {
          iRet = (short)((pPVar7->wRouting & 0x3ffU) != 0);
        }
        else if ((pPVar7->wRouting & 0x3ffU) == 0) {
          iRet = -1;
        }
        else {
          psz = PszGetPlanetName((pPVar6->wRouting & 0x3ffU) - 1);
          _strcpy(szT,psz);
          psz = PszGetPlanetName((((PLANET *)lppl2)->wRouting & 0x3ffU) - 1);
          iRet = _strcmp(szT,psz);
          pBVar3 = (BTLDATA *)pct2;
          uVar13 = l2;
        }
      }
      goto switchD_1108_63af_default;
    }
    if (irpt != 1) {
      if (irpt != 2) {
        if (irpt != 3) goto switchD_1108_63af_default;
        ibtl1._0_2_ = *(FLEET **)arg1;
        ibtl1._2_2_ = *(short *)arg2;
        lppl2 = (PLANET *)BtlDataGet((short)(FLEET *)ibtl1);
        pct2 = (float)BtlDataGet(ibtl1._2_2_);
        iVar4 = (int)((ulong)pct2 >> 0x10);
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        if ((((PLANET *)lppl2 == (PLANET *)0x0) && (lppl2._2_2_ == 0)) ||
           ((SUB42(pct2,0) == (BTLDATA *)0x0 && (iVar4 == 0)))) {
          iRet = 0;
          goto switchD_1108_63af_default;
        }
        switch(icolSort) {
        case 0:
          if (*(int *)(((PLANET *)lppl2)->rgpctMinLevel + 2) == -1) {
            pcVar8 = PszGetCompressedString(idsSpaceDD);
            wsprintf((char *)szT,(char *)pcVar8);
          }
          else {
            psz = PszGetPlanetName(*(short *)(((PLANET *)lppl2)->rgpctMinLevel + 2));
            _strcpy(szT,psz);
          }
          uVar10 = (undefined2)((ulong)pct2 >> 0x10);
          if (*(int *)(SUB42(pct2,0) + 8) == -1) {
            pcVar8 = PszGetCompressedString(idsSpaceDD);
            wsprintf(szWork,(char *)pcVar8);
            psz = (char *)szWork;
          }
          else {
            psz = PszGetPlanetName(*(short *)(SUB42(pct2,0) + 8));
          }
          iRet = _strcmp(szT,psz);
          pBVar3 = (BTLDATA *)pct2;
          uVar13 = l2;
          goto switchD_1108_63af_default;
        case 1:
          uVar13 = CBattleUnits((BTLDATA *)lppl2,5);
          if (uVar13 == 0) {
            l1 = uVar13;
            CBattleUnits((BTLDATA *)lppl2,6);
            uVar13 = __aFlshl(uVar16,iLast);
          }
          l1 = uVar13;
          uVar13 = CBattleUnits((BTLDATA *)pct2,5);
          if (uVar13 == 0) {
            l2 = uVar13;
            CBattleUnits((BTLDATA *)pct2,6);
            uVar13 = __aFlshl(uVar16,iLast);
          }
          goto REPORT_LRetDiff;
        case 2:
          l1 = (ulong)*(byte *)&((PLANET *)lppl2)->iPlayer;
          uVar13 = (ulong)SUB42(pct2,0)->cplr;
          goto REPORT_LRetDiff;
        case 3:
          i = 0xff;
          break;
        case 4:
          i = 0xfd;
          break;
        case 5:
          i = 0xfe;
          break;
        case 6:
          i = 0xb;
          break;
        case 7:
          i = 0x13;
          break;
        case 8:
          i = 0x23;
          break;
        case 9:
          i = 0x43;
          break;
        case 10:
          i = 0x83;
          break;
        case 0xb:
        case 0xc:
          uVar13 = CBattleKills((BTLDATA *)lppl2,(uint)(icolSort == 0xb));
          l1 = uVar13;
          uVar13 = CBattleKills((BTLDATA *)pct2,(uint)(icolSort == 0xb));
          goto REPORT_LRetDiff;
        case 0xd:
          i = 0xfd;
          goto REPORT_LUnitsLeft;
        case 0xe:
          i = 0xfe;
REPORT_LUnitsLeft:
          lVar14 = CBattleUnits((BTLDATA *)lppl2,i);
          l1 = lVar14;
          lVar14 = CBattleUnits((BTLDATA *)pct2,i);
          l2 = lVar14;
          lVar14 = CBattleKills((BTLDATA *)lppl2,(uint)(icolSort == 0xd));
          l1 = l1 - lVar14;
          lVar14 = CBattleKills((BTLDATA *)pct2,(uint)(icolSort == 0xd));
          uVar13 = l2 - lVar14;
          goto REPORT_LRetDiff;
        default:
          goto switchD_1108_63af_default;
        }
        uVar13 = CBattleUnits((BTLDATA *)lppl2,i);
        l1 = uVar13;
        uVar13 = CBattleUnits((BTLDATA *)pct2,i);
        goto REPORT_LRetDiff;
      }
                    /* WARNING: Load size is inaccurate */
      pFVar2 = ((FLEET **)rglpfl)[*(int *)arg1];
      iVar4 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg1) + 2);
      ibtl1 = (FLEET *)CONCAT22(iVar4,pFVar2);
      pPVar6 = *(PLANET **)((FLEET **)rglpfl + *(int *)arg2);
      iVar9 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg2) + 2);
      lppl2 = (PLANET *)CONCAT22(iVar9,pPVar6);
      switch(icolSort) {
      case 0:
        psz = PszGetFleetName(ibtl1->id);
        _strcpy(szT,psz);
        psz = PszGetFleetName(lppl2->id);
        iRet = _strcmp(szT,psz);
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        goto switchD_1108_63af_default;
      case 1:
        l1 = (ulong)(ibtl1->id & 0x1ff);
        uVar13 = (ulong)(lppl2->id & 0x1ff);
        break;
      case 2:
        if (pFVar2->idPlanet == -1) {
          pcVar8 = PszGetCompressedString(idsSpaceDD);
          wsprintf((char *)szT,(char *)pcVar8);
        }
        else {
          psz = PszGetPlanetName(pFVar2->idPlanet);
          _strcpy(szT,psz);
        }
        uVar10 = (undefined2)((ulong)lppl2 >> 0x10);
        if (*(int *)((PLANET *)lppl2)->rgpctMinLevel == -1) {
          pcVar8 = PszGetCompressedString(idsSpaceDD);
          wsprintf(szWork,(char *)pcVar8);
          psz = (char *)szWork;
        }
        else {
          psz = PszGetPlanetName(*(short *)((PLANET *)lppl2)->rgpctMinLevel);
        }
        iRet = _strcmp(szT,psz);
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = l2;
        goto switchD_1108_63af_default;
      case 3:
        if (((uint)pFVar2->wFlags >> 4 & 1) == 0) {
          l1._0_2_ = 0xffff;
          l1._2_2_ = 0xffff;
        }
        else {
          l1._0_2_ = pFVar2->wFlags & 0xf;
          l1._2_2_ = 0;
        }
        if ((*(uint *)pPVar6[2].rgpctMinLevel >> 4 & 1) == 0) {
          l2._0_2_ = 0xffff;
          l2._2_2_ = 0xffff;
        }
        else {
          l2._0_2_ = *(uint *)pPVar6[2].rgpctMinLevel & 0xf;
          l2._2_2_ = 0;
        }
        uVar13 = CONCAT22(l2._2_2_,(uint)l2);
        break;
      case 4:
        l1 = CONCAT22((pFVar2->rgdv + 1)->dp,pFVar2->rgdv->dp);
        uVar13 = CONCAT22(pPVar6->wFlags,*(undefined2 *)&pPVar6->field11_0x2c);
        break;
      case 5:
        sVar5 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar4,pFVar2),&i1);
        l1._2_2_ = sVar5 >> 0xf;
        l1._0_2_ = sVar5;
        sVar5 = IshdefPrimaryFromLpfl((FLEET *)lppl2,&i2);
        l2._2_2_ = sVar5 >> 0xf;
        l2._0_2_ = sVar5;
        if (((uint)l1 == sVar5) && (l1._2_2_ == l2._2_2_)) {
          pct2 = (float)CONCAT22(ibtl1._2_2_,((FLEET *)ibtl1)->rgcsh);
          lVar14 = __aFlshl(uVar16,iLast);
          local_84 = ((PLANET *)lppl2)->rgEnvVar;
          pct1 = (float)CONCAT22(*(undefined2 *)(pct2._0_2_ + (int)lVar14),lppl2._2_2_);
          lVar14 = __aFlshl(uVar16,iLast);
          iRet = pct1._2_2_ - *(int *)(local_84 + (int)lVar14);
        }
        else {
          uVar13 = __aFulmul((long)sVar5,0x93);
          iVar4 = ((PLANET *)lppl2)->iPlayer * 4;
          uVar10 = *(undefined2 *)(iVar4 + 0x100);
          pcVar8 = (char *)(*(int *)(iVar4 + 0xfe) + (int)uVar13 + 8);
          uVar13 = __aFulmul(CONCAT22(l1._2_2_,(uint)l1),0x93);
          iVar4 = ((FLEET *)ibtl1)->iPlayer * 4;
          iRet = __fstrcmp((char *)CONCAT22(*(undefined2 *)(iVar4 + 0x100),
                                                    (char *)(*(int *)(iVar4 + 0xfe) + (int)uVar13 +
                                                            8)),(char *)CONCAT22(uVar10,pcVar8));
          if (iRet == 0) {
            pct2 = (float)CONCAT22(ibtl1._2_2_,((FLEET *)ibtl1)->rgcsh);
            lVar14 = __aFlshl(uVar16,iLast);
            local_84 = ((PLANET *)lppl2)->rgEnvVar;
            pct1 = (float)CONCAT22(*(undefined2 *)(pct2._0_2_ + (int)lVar14),lppl2._2_2_);
            lVar14 = __aFlshl(uVar16,iLast);
            iRet = pct1._2_2_ - *(int *)(local_84 + (int)lVar14);
          }
          if (iRet == 0) {
            iRet = (uint)l1 - (uint)l2;
          }
        }
        pBVar3 = (BTLDATA *)pct2;
        uVar13 = CONCAT22(l2._2_2_,(uint)l2);
        if (iRet == 0) {
          iRet = i1 - i2;
        }
        goto switchD_1108_63af_default;
      case 6:
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar13 = CONCAT22(l2._2_2_,(uint)l2);
          if (0xf < i) break;
          uVar1 = pFVar2->rgcsh[i];
          bVar11 = CARRY2((uint)l1,uVar1);
          l1._0_2_ = (uint)l1 + uVar1;
          l1._2_2_ = l1._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
          uVar1 = *(uint *)(pPVar6->rgEnvVar + i * 2);
          bVar11 = CARRY2((uint)l2,uVar1);
          l2._0_2_ = (uint)l2 + uVar1;
          l2._2_2_ = l2._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
          i = i + 1;
        }
        break;
      case 7:
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar13 = CONCAT22(l2._2_2_,(uint)l2);
          if (0xf < i) break;
          if (((FLEET *)ibtl1)->rgcsh[i] != 0) {
            iVar4 = ((FLEET *)ibtl1)->iPlayer * 4;
            pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + 0xfe) + i * 0x93));
            j = (uint)((HULDEF *)pHVar15)->wFlags >> 10 & 0xf;
            if (((uint)j < 2) || (5 < (uint)j)) {
              uVar1 = ((FLEET *)ibtl1)->rgcsh[i];
              bVar11 = CARRY2((uint)l1,uVar1);
              l1._0_2_ = (uint)l1 + uVar1;
              l1._2_2_ = l1._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
            }
          }
          if (*(int *)(((PLANET *)lppl2)->rgEnvVar + i * 2) != 0) {
            iVar4 = ((PLANET *)lppl2)->iPlayer * 4;
            pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + 0xfe) + i * 0x93));
            j = (uint)((HULDEF *)pHVar15)->wFlags >> 10 & 0xf;
            if (((uint)j < 2) || (5 < (uint)j)) {
              uVar1 = *(uint *)(((PLANET *)lppl2)->rgEnvVar + i * 2);
              bVar11 = CARRY2((uint)l2,uVar1);
              l2._0_2_ = (uint)l2 + uVar1;
              l2._2_2_ = l2._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
            }
          }
          i = i + 1;
        }
        break;
      case 8:
        j = 2;
        goto REPORT_LEFleetCount;
      case 9:
        j = 3;
        goto REPORT_LEFleetCount;
      case 10:
        j = 5;
        goto REPORT_LEFleetCount;
      case 0xb:
        j = 4;
REPORT_LEFleetCount:
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar13 = CONCAT22(l2._2_2_,(uint)l2);
          if (0xf < i) break;
          if ((((FLEET *)ibtl1)->rgcsh[i] != 0) &&
             (iVar4 = ((FLEET *)ibtl1)->iPlayer * 4,
             pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + 0xfe) + i * 0x93)),
             ((uint)((HULDEF *)pHVar15)->wFlags >> 10 & 0xf) == j)) {
            uVar1 = ((FLEET *)ibtl1)->rgcsh[i];
            bVar11 = CARRY2((uint)l1,uVar1);
            l1._0_2_ = (uint)l1 + uVar1;
            l1._2_2_ = l1._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
          }
          if ((*(int *)(((PLANET *)lppl2)->rgEnvVar + i * 2) != 0) &&
             (iVar4 = ((PLANET *)lppl2)->iPlayer * 4,
             pHVar15 = LphuldefFromId(*(HullDef *)(*(int *)(iVar4 + 0xfe) + i * 0x93)),
             ((uint)((HULDEF *)pHVar15)->wFlags >> 10 & 0xf) == j)) {
            uVar1 = *(uint *)(((PLANET *)lppl2)->rgEnvVar + i * 2);
            bVar11 = CARRY2((uint)l2,uVar1);
            l2._0_2_ = (uint)l2 + uVar1;
            l2._2_2_ = l2._2_2_ + ((int)uVar1 >> 0xf) + (uint)bVar11;
          }
          i = i + 1;
        }
        break;
      default:
        goto switchD_1108_63af_default;
      }
      goto REPORT_LRetDiff;
    }
                    /* WARNING: Load size is inaccurate */
    pFVar2 = ((FLEET **)rglpfl)[*(int *)arg1];
    iVar4 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg1) + 2);
    ibtl1 = (FLEET *)CONCAT22(iVar4,pFVar2);
    pPVar6 = *(PLANET **)((FLEET **)rglpfl + *(int *)arg2);
    iVar9 = *(int *)((int)((FLEET **)rglpfl + *(int *)arg2) + 2);
    lppl2 = (PLANET *)CONCAT22(iVar9,pPVar6);
    switch(icolSort) {
    case 0:
      psz = PszGetFleetName(ibtl1->id);
      _strcpy(szT,psz);
      psz = PszGetFleetName(lppl2->id);
      iRet = _strcmp(szT,psz);
      pBVar3 = (BTLDATA *)pct2;
      uVar13 = l2;
      break;
    case 1:
      l1 = (ulong)ibtl1->id;
      uVar13 = (ulong)lppl2->id;
      goto REPORT_LRetDiff;
    case 2:
      if (pFVar2->idPlanet == -1) {
        pcVar8 = PszGetCompressedString(idsSpaceDD);
        wsprintf((char *)szT,(char *)pcVar8);
      }
      else {
        psz = PszGetPlanetName(pFVar2->idPlanet);
        _strcpy(szT,psz);
      }
      uVar10 = (undefined2)((ulong)lppl2 >> 0x10);
      if (*(int *)((PLANET *)lppl2)->rgpctMinLevel == -1) {
        pcVar8 = PszGetCompressedString(idsSpaceDD);
        wsprintf(szWork,(char *)pcVar8);
        psz = (char *)szWork;
      }
      else {
        psz = PszGetPlanetName(*(short *)((PLANET *)lppl2)->rgpctMinLevel);
      }
      iRet = _strcmp(szT,psz);
      pBVar3 = (BTLDATA *)pct2;
      uVar13 = l2;
      break;
    case 3:
      psz = PszGetDestName((FLEET *)CONCAT22(iVar4,pFVar2),0);
      _strcpy(szT,psz);
      psz = PszGetDestName((FLEET *)lppl2,0);
      iRet = _strcmp(szT,psz);
      pBVar3 = (BTLDATA *)pct2;
      uVar13 = l2;
      if (iRet < 0) {
        iRet = -1;
      }
      else if (0 < iRet) {
        iRet = 1;
      }
      break;
    case 4:
      PszGetETA(0,(FLEET *)CONCAT22(iVar4,pFVar2),&i1);
      PszGetETA(0,(FLEET *)lppl2,&i2);
      iRet = i1 - i2;
      pBVar3 = (BTLDATA *)pct2;
      uVar13 = l2;
      break;
    case 5:
      psz = PszGetTaskName((FLEET *)CONCAT22(iVar4,pFVar2),&i1);
      _strcpy(szT,psz);
      psz = PszGetTaskName((FLEET *)lppl2,&i2);
      iRet = _strcmp(szT,psz);
      pBVar3 = (BTLDATA *)pct2;
      uVar13 = l2;
      if (iRet < 0) {
        iRet = -1;
      }
      else if (iRet < 1) {
        if (i2 < i1) {
          iRet = 1;
        }
        else if (i1 < i2) {
          iRet = -1;
        }
      }
      else {
        iRet = 1;
      }
      break;
    case 6:
      iSubsort = -1;
    case 7:
      if (iSubsort == 4) {
        l2._0_2_ = 0;
        l2._2_2_ = 0;
        l1._0_2_ = 0;
        l1._2_2_ = 0;
        i = 0;
        while( true ) {
          uVar13 = CONCAT22(l2._2_2_,(uint)l2);
          if (3 < i) break;
          uVar1 = *(uint *)(pFVar2->rgwtMin + i);
          bVar11 = CARRY2((uint)l1,uVar1);
          l1._0_2_ = (uint)l1 + uVar1;
          l1._2_2_ = l1._2_2_ + *(uint *)((int)(pFVar2->rgwtMin + i) + 2) + (uint)bVar11;
          uVar1 = *(uint *)(pPVar6[1].rgwtMin + i + -2);
          bVar11 = CARRY2((uint)l2,uVar1);
          l2._0_2_ = (uint)l2 + uVar1;
          l2._2_2_ = l2._2_2_ + *(uint *)((int)(pPVar6[1].rgwtMin + i + -2) + 2) + (uint)bVar11;
          i = i + 1;
        }
      }
      else {
        if (iSubsort == -1) {
          iSubsort = 4;
        }
        l1 = CONCAT22(*(undefined2 *)((int)(pFVar2->rgwtMin + iSubsort) + 2),
                      (int)pFVar2->rgwtMin[iSubsort]);
        uVar13 = CONCAT22(*(undefined2 *)((int)(pPVar6[1].rgwtMin + iSubsort + -2) + 2),
                          (int)pPVar6[1].rgwtMin[iSubsort + -2]);
      }
      goto REPORT_LRetDiff;
    case 8:
      sVar5 = IshdefPrimaryFromLpfl((FLEET *)CONCAT22(iVar4,pFVar2),&i1);
      l1._2_2_ = sVar5 >> 0xf;
      l1._0_2_ = sVar5;
      sVar5 = IshdefPrimaryFromLpfl((FLEET *)lppl2,&i2);
      l2._2_2_ = sVar5 >> 0xf;
      l2._0_2_ = sVar5;
      if (((uint)l1 == sVar5) && (l1._2_2_ == l2._2_2_)) {
        pct2 = (float)CONCAT22(ibtl1._2_2_,((FLEET *)ibtl1)->rgcsh);
        lVar14 = __aFlshl(uVar16,iLast);
        local_84 = ((PLANET *)lppl2)->rgEnvVar;
        pct1 = (float)CONCAT22(*(undefined2 *)(pct2._0_2_ + (int)lVar14),lppl2._2_2_);
        lVar14 = __aFlshl(uVar16,iLast);
        iRet = pct1._2_2_ - *(int *)(local_84 + (int)lVar14);
      }
      else {
        uVar13 = __aFulmul((long)sVar5,0x93);
        pcVar8 = (char *)((int)&rgshdef[0].hul + 8 + (int)uVar13);
        uVar13 = __aFulmul(CONCAT22(l1._2_2_,(uint)l1),0x93);
        iRet = _strcmp((char *)((int)&rgshdef[0].hul + 8 + (int)uVar13),pcVar8);
        if (iRet == 0) {
          pct2 = (float)CONCAT22(ibtl1._2_2_,((FLEET *)ibtl1)->rgcsh);
          lVar14 = __aFlshl(uVar16,iLast);
          local_84 = ((PLANET *)lppl2)->rgEnvVar;
          pct1 = (float)CONCAT22(*(undefined2 *)(pct2._0_2_ + (int)lVar14),lppl2._2_2_);
          lVar14 = __aFlshl(uVar16,iLast);
          iRet = pct1._2_2_ - *(int *)(local_84 + (int)lVar14);
        }
        if (iRet == 0) {
          iRet = (uint)l1 - (uint)l2;
        }
      }
      pBVar3 = (BTLDATA *)pct2;
      uVar13 = CONCAT22(l2._2_2_,(uint)l2);
      if (iRet == 0) {
        iRet = i1 - i2;
      }
      break;
    case 9:
      sVar5 = PctCloakFromLpfl((FLEET *)CONCAT22(iVar4,pFVar2));
      l1._2_2_ = sVar5 >> 0xf;
      l1._0_2_ = sVar5;
      sVar5 = PctCloakFromLpfl((FLEET *)lppl2);
      uVar13 = (ulong)sVar5;
      goto REPORT_LRetDiff;
    case 10:
      pct2 = (float)(ulong)CONCAT12(*(byte *)(pPVar6[1].rgwtMin + 3),pct2._0_2_);
      pBVar3 = (BTLDATA *)pct2;
      pct2._2_2_ = (uint)*(byte *)(pPVar6[1].rgwtMin + 3);
      iRet = pFVar2->iplan - pct2._2_2_;
      break;
    case 0xb:
      uVar13 = WtFromLpfl((FLEET *)CONCAT22(iVar4,pFVar2));
      l1 = uVar13;
      uVar13 = WtFromLpfl((FLEET *)lppl2);
REPORT_LRetDiff:
      l1 = l1 - uVar13;
      pBVar3 = (BTLDATA *)pct2;
      if (((long)l1 < 0x10000) && ((long)l1 < 0)) {
        iRet = -1;
      }
      else if ((long)l1 < 1) {
        iRet = 0;
      }
      else {
        iRet = 1;
      }
    }
switchD_1108_63af_default:
    pct2 = (float)pBVar3;
    if (fAscending == 0) {
      iRet = -iRet;
    }
    if ((((iRet != 0) || (fTier2 != 0)) ||
        ((icolSort == vicolSortPrev && (iSubsort == viSubsortPrev)))) ||
       (vicolSortPrev < 0)) {
      return iRet;
    }
    icolSort = vicolSortPrev;
    iSubsort = viSubsortPrev;
    fAscending = vfAscendingPrev;
    fTier2 = 1;
  } while( true );
}



// ======================================================================
// Function: ReportColumnPopup
// Address: 1108:74d4
// Segment: MEMORY_REPORT
// ======================================================================


void ReportColumnPopup(POINT pt,short icol,short fRightBtn)

{
  uint *puVar1;
  int iVar2;
  RPT *pRVar3;
  StringId ids;
  short sVar4;
  int iVar5;
  char *pcVar6;
  short sVar7;
  uint uVar8;
  short iSortLast;
  short iHide;
  short iRet;
  short cch;
  char *psz [32];
  short cItems;
  char szColTitle [50];
  short rgcol [32];
  short fccolChange;
  short ibit;
  short i;
  short j;
  short cSubsort;
  short iBase;
  char rgsz [1600];
  char szT [50];
  HDC hdc;
  
  cSubsort = 0;
  fccolChange = 0;
  hdc = GetDC(hwndReportDlg);
  DxReportColHdr(vprptCur->irpt,icol,szColTitle,hdc);
  cItems = 0;
  for (i = 0; i < 2; i = i + 1) {
    if (i == 0) {
      ids = idsSort;
    }
    else {
      ids = idsReverseSort;
    }
    sVar4 = CchGetString(ids,rgsz + cItems * 0x32);
    _strcpy(rgsz + sVar4 + cItems * 0x32,szColTitle);
    iVar2 = cItems + 1;
    if (((vprptCur->irpt == 0) && (((icol == 0xb || (icol == 9)) || (icol == 10)))) ||
       ((vprptCur->irpt == 1 && (icol == 7)))) {
      iVar5 = cItems * 0x32;
      cItems = iVar2;
      _strcpy(rgsz + iVar2 * 0x32,rgsz + iVar5);
      rgsz[(cItems + -1) * 0x32] = '\0';
      iVar2 = cItems;
      for (j = 0; cItems = iVar2 + 1, j < (int)((vprptCur->irpt == 1) + 3); j = j + 1) {
        _strcpy(rgsz + cItems * 0x32,(char *)*(undefined2 *)(j * 2 + 0x4cc));
        iVar2 = cItems;
      }
      rgsz[cItems * 0x32] = -1;
      rgsz[cItems * 0x32 + 1] = '\0';
      cItems = iVar2 + 2;
      pcVar6 = PszGetCompressedString(idsWeightedAverage);
      _strcpy(rgsz + cItems * 0x32,pcVar6);
      rgsz[(cItems + 1) * 0x32] = '\0';
      cSubsort = 5;
      iVar2 = cItems + 2;
    }
    cItems = iVar2;
  }
  rgsz[cItems * 0x32] = -1;
  rgsz[cItems * 0x32 + 1] = '\0';
  cItems = cItems + 1;
  sVar4 = CchGetString(idsHide,rgsz + cItems * 0x32);
  _strcpy(rgsz + sVar4 + cItems * 0x32,szColTitle);
  CchGetString(idsColumn,szT);
  _strcat(rgsz + cItems * 0x32,szT);
  sVar4 = cItems;
  iHide = cItems;
  rgsz[(cItems + 1) * 0x32] = -1;
  rgsz[(cItems + 1) * 0x32 + 1] = '\0';
  sVar7 = cItems + 2;
  if (icol == 0) {
    iHide = -1;
    sVar7 = cItems;
  }
  cItems = sVar7;
  iBase = cItems;
  ibit = 1;
  for (i = 0; i < vprptCur->cFields; i = i + 1) {
    if (((ibit & (uint)vprptCur->grbitVisible) == 0) &&
       ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) == 0)) {
      DxReportColHdr(vprptCur->irpt,i,szColTitle,hdc);
      sVar7 = CchGetString(idsShow,rgsz + cItems * 0x32);
      _strcpy(rgsz + sVar7 + cItems * 0x32,szColTitle);
      CchGetString(idsColumn,szT);
      _strcat(rgsz + cItems * 0x32,szT);
      rgcol[cItems] = i;
      cItems = cItems + 1;
    }
    ibit = ibit << 1;
  }
  if (cItems == iBase) {
    cItems = cItems + -1;
  }
  ReleaseDC(hwndReportDlg,hdc);
  for (i = 0; i < cItems; i = i + 1) {
    if (rgsz[i * 0x32] == '\0') {
      psz[i] = (char *)0x0;
    }
    else {
      psz[i] = rgsz + i * 0x32;
    }
  }
  sVar7 = PopupMenu(hwndReportDlg,pt.x,pt.y,cItems,(long *)0x0,psz,-1,fRightBtn);
  pRVar3 = vprptCur;
  if (-1 < sVar7) {
    gd._4_2_ = gd._4_2_ & 0xff7f | 0x80;
    if (sVar7 < sVar4) {
      vicolSortPrev = vprptCur->icolSort;
      viSubsortPrev = vprptCur->iSubsort;
      vfAscendingPrev = vprptCur->fAscending;
      vprptCur->icolSort = icol;
      if (cSubsort == 0) {
        vprptCur->fAscending = (uint)(sVar7 == 0);
      }
      else {
        vprptCur->iSubsort =
             (sVar7 + -2) % (int)(cSubsort + 3 + (uint)(vprptCur->irpt == 1));
        if ((int)((vprptCur->irpt == 1) + 3) < vprptCur->iSubsort) {
          vprptCur->iSubsort = (vprptCur->irpt == 1) + 3;
        }
        vprptCur->fAscending = (uint)(sVar7 < cSubsort + 2);
      }
      SortReportCache(vprptCur->irpt,icol);
    }
    else if (sVar7 == iHide) {
      fccolChange = 1;
      uVar8 = ~(1 << ((byte)icol & 0x1f));
      *(uint *)&vprptCur->grbitVisible = (uint)vprptCur->grbitVisible & uVar8;
      puVar1 = (uint *)((int)&pRVar3->grbitVisible + 2);
      *puVar1 = *puVar1 & (int)uVar8 >> 0xf;
    }
    else if (iBase <= sVar7) {
      fccolChange = 1;
      uVar8 = 1 << ((byte)rgcol[sVar7] & 0x1f);
      *(uint *)&vprptCur->grbitVisible = (uint)vprptCur->grbitVisible | uVar8;
      puVar1 = (uint *)((int)&pRVar3->grbitVisible + 2);
      *puVar1 = *puVar1 | (int)uVar8 >> 0xf;
    }
    if (fccolChange != 0) {
      SetHScrollBar();
    }
    InvalidateRect(hwndReportDlg,(RECT *)0x0,1);
  }
  return;
}



// ======================================================================
// Function: InvalidateReport
// Address: 1108:7af6
// Segment: MEMORY_REPORT
// ======================================================================


void InvalidateReport(short irpt,short fReload)

{
  undefined2 unaff_SS;
  RECT rc;
  ushort *lprgidSav;
  undefined2 local_c;
  RPT *prptSav;
  short fClearRpt;
  short fResetRpt;
  
  fClearRpt = 0;
  fResetRpt = 0;
  if ((((uint)gd._0_2_ >> 1 & 1) == 0) && (fAi == 0)) {
    if ((hwndReportDlg == 0) || (irpt != vprptCur->irpt)) {
      if (vprptCur == (RPT *)0x0) {
        fClearRpt = fReload;
        if (irpt == 0) {
          vprptCur = (RPT *)&vrptPlanet;
        }
        else {
          vprptCur = (RPT *)&vrptFleet;
        }
      }
      else if ((fReload != 0) && (vprptCur->irpt != irpt)) {
        lprgidSav = (ushort *)vlprgidRep;
        local_c = vlprgidRep._2_2_;
        prptSav = vprptCur;
        fResetRpt = 1;
        if (irpt == 0) {
          vprptCur = (RPT *)&vrptPlanet;
        }
        else {
          vprptCur = (RPT *)&vrptFleet;
        }
      }
    }
    else {
      GetClientRect(hwndReportDlg,(RECT *)&rc);
      if (fReload != 2) {
        rc.top = dyArial8 + 6;
        rc.bottom = (dyArial8 + 4) * vprptCur->cRowsVis + rc.top;
      }
      InvalidateRect(hwndReportDlg,(RECT *)&rc,(uint)(fReload == 2));
      gd.wFlags = gd.wFlags & 0xfdffU | 0x200;
    }
    vprptCur->fCached = 0;
    if (fReload != 0) {
      SortReportCache(vprptCur->irpt,vprptCur->icolSort);
    }
    if (fClearRpt == 0) {
      if (fResetRpt == 0) {
        if (((fReload != 0) && (hwndReportDlg != 0)) && (irpt == vprptCur->irpt)) {
          SetScrollRange(vprptCur->hwndVScroll,2,0,
                         vprptCur->cRows - vprptCur->cRowsVis,0);
          InvalidateRect(hwndReportDlg,(RECT *)0x0,1);
        }
      }
      else {
        vprptCur = prptSav;
        vlprgidRep._0_2_ = lprgidSav;
        vlprgidRep._2_2_ = local_c;
      }
    }
    else {
      vprptCur = (RPT *)0x0;
    }
  }
  return;
}



// ======================================================================
// Function: ExecuteReportClick
// Address: 1108:7cd6
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x11087ea5) */

void ExecuteReportClick(POINT pt,short irpt,short icol,short irow)

{
  short sVar1;
  FLEET *pFVar2;
  POINT pt_00;
  POINT pt_01;
  POINT pt_02;
  BTLDATA *pBVar3;
  short sVar4;
  int iVar5;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 uVar6;
  ulong uVar7;
  ushort in_stack_0000ffb6;
  SCAN scan__58;
  short dxOffset;
  short xCur;
  undefined4 rglQuan;
  short ibit;
  FLEET *lpfl;
  short i;
  PLANET *lppl;
  BTLDATA *lpbd;
  HDC hdc;
  
  uVar7 = CONCAT22(unaff_SI,unaff_DI);
  hdc = GetDC(hwndReportDlg);
  if (irpt != 0) {
    if (irpt == 1) {
                    /* WARNING: Load size is inaccurate */
      lpfl = (FLEET *)CONCAT22(*(undefined2 *)
                                ((int)((FLEET **)rglpfl +
                                      ((ushort *)vlprgidFleet)[irow]) + 2),
                               ((FLEET **)rglpfl)[((ushort *)vlprgidFleet)[irow]]);
      if (mdXferDlg == -1) {
        SelectAdjFleet(0,lpfl->id);
        InvalidateReport(1,0);
        switch(icol) {
        case 3:
        case 4:
        case 5:
          sVar4 = FDestIsWP0(lpfl);
          if (sVar4 == 0) {
            SendMessage(hwndShipLB,0x407,1,0);
            SetScanWp(1);
          }
          break;
        case 6:
        case 7:
          if (mdXferDlg == -1) {
            if (sel.fl.idPlanet == -1) {
              TransferStuff(sel.fl.id,2,-1,4,0);
            }
            else {
              TransferStuff(sel.fl.id,2,sel.fl.idPlanet,1,0);
            }
          }
          break;
        case 8:
          GlobalPD.grPopup = 3;
          GlobalPD.iPlanVal = 1;
          GlobalPD.iPlanMax = 0xff;
          GlobalPD._2_2_ = (FLEET *)lpfl;
          GlobalPD.psz = lpfl._2_2_;
          Popup(hwndReportDlg,pt.x,pt.y);
        }
      }
      else {
        MessageBeep(0);
      }
    }
    else if (irpt == 2) {
      if ((vprptCur == (RPT *)&vrptEFleet) && (-3 < irow)) {
        if (irow < 0) {
          if (irow == -1) {
            irowEFleetCur = irowEFleetCur + 1;
          }
          else {
            irowEFleetCur = irowEFleetCur + -1;
          }
          if (irowEFleetCur < vrptEFleet.cRows) {
            if (irowEFleetCur < 0) {
              irowEFleetCur = vrptEFleet.cRows + -1;
            }
          }
          else {
            irowEFleetCur = 0;
          }
          irow = irowEFleetCur;
        }
                    /* WARNING: Load size is inaccurate */
        pFVar2 = ((FLEET **)rglpfl)[((ushort *)vlprgidMisc)[irow]];
        iVar5 = *(int *)((int)((FLEET **)rglpfl + ((ushort *)vlprgidMisc)[irow]) + 2);
        lpfl = (FLEET *)CONCAT22(iVar5,pFVar2);
        if (mdXferDlg == -1) {
          pt_00.y = (pFVar2->pt).y;
          pt_00.x = (&pFVar2->pt)->x;
          FFindNearestObject(pt_00,grobjFleet,&scan__58);
          scan__58.ifl = ((ushort *)vlprgidMisc)[irow];
          ChangeScanSel(&scan__58,2);
          uVar6 = (undefined2)((ulong)lpfl >> 0x10);
          pt_02.y = (((FLEET *)lpfl)->pt).y;
          pt_02.x = (&((FLEET *)lpfl)->pt)->x;
          FEnsurePointOnScreen(pt_02,1);
          irowEFleetCur = irow;
          InvalidateReport(2,0);
        }
        else {
          MessageBeep(0);
        }
      }
    }
    else if (irpt == 3) {
      lpbd = BtlDataGet(((ushort *)vlprgidMisc)[irow]);
      iVar5 = (int)((ulong)lpbd >> 0x10);
      pBVar3 = (BTLDATA *)lpbd;
      if ((pBVar3 != (BTLDATA *)0x0) || (iVar5 != 0)) {
        if (((&pBVar3->pt)->x != sel.scan.pt.x) ||
           ((pBVar3->pt).y != sel.scan.pt.y)) {
          sVar4 = (&pBVar3->pt)->x;
          sVar1 = (pBVar3->pt).y;
          ChangeScanSel((SCAN *)&stack0xffb6,0);
          pt_01.y = sVar1;
          pt_01.x = sVar4;
          CtrPointScan(pt_01,1);
          InvalidateReport(0,0);
          uVar6 = (undefined2)((ulong)lpbd >> 0x10);
          if (((&((BTLDATA *)lpbd)->pt)->x == sel.scan.pt.x) &&
             ((((BTLDATA *)lpbd)->pt).y == sel.scan.pt.y)) goto switchD_1108_82b9_default;
        }
        if (hwndVCRDlg == 0) {
          BattleVCR(lpbd->id);
        }
      }
    }
    goto switchD_1108_82b9_default;
  }
  lppl = (PLANET *)
         CONCAT22(lpPlanets._2_2_,
                  (PLANET *)lpPlanets + ((ushort *)vlprgidPlanet)[irow]);
  if (hwndProdDlg != 0) {
    MessageBeep(0);
    goto switchD_1108_82b9_default;
  }
  SelectAdjPlanet(0,lppl->id);
  InvalidateReport(0,0);
  uVar6 = (undefined2)((ulong)lppl >> 0x10);
  switch(icol) {
  case 0:
    if ((((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0) &&
       ((int)((uint)vprptCur->rgbdx[0] * 2 + -8) < pt.x)) {
REPORT_LShowStarbase:
      GlobalPD.grPopup = 0xb;
      GlobalPD.psz = (char *)*(undefined2 *)(idPlayer * 4 + 0x14e);
      GlobalPD._2_2_ =
           *(int *)(idPlayer * 4 + 0x14c) + (sel.pl._44_2_ & 0xf) * 0x93;
      GlobalPD.iPlanMin = 0;
      GlobalPD.iPlanVal = 1;
      GlobalPD.iPlanMax = 0;
      GlobalPD.iPlrVal = 0;
      Popup(hwndReportDlg,pt.x,pt.y);
    }
    break;
  case 1:
    if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0) goto REPORT_LShowStarbase;
    break;
  case 2:
  case 4:
    GlobalPD.grPopup = 7;
    GlobalPD.field1_0x2 = (undefined1)sel.pl.id;
    GlobalPD.field2_0x3 = sel.pl.id._1_1_;
    Popup(hwndReportDlg,pt.x,pt.y);
    break;
  case 5:
    if (hwndProdDlg == 0) {
      ChangeProduction(0);
    }
    break;
  case 6:
  case 7:
    GlobalPD.grPopup = 8;
    GlobalPD.field1_0x2 = (undefined1)sel.pl.id;
    GlobalPD.field2_0x3 = sel.pl.id._1_1_;
    GlobalPD.iPlanMax = (short)(icol == 7);
    if (GlobalPD.iPlanMax == 0) {
      GlobalPD.psz = (char *)CMaxMines(&sel.pl,idPlayer);
      uVar7 = __aFulshr(uVar7,in_stack_0000ffb6);
      GlobalPD.iPlanVal = (uint)uVar7 & 0xfff;
      GlobalPD.iPlanMin = CMaxOperableMines(&sel.pl,idPlayer,0);
    }
    else {
      GlobalPD.psz = (char *)CMaxFactories(&sel.pl,idPlayer);
      uVar7 = __aFulshr(uVar7,in_stack_0000ffb6);
      GlobalPD.iPlanVal = (uint)uVar7 & 0xfff;
      GlobalPD.iPlanMin = CMaxOperableFactories(&sel.pl,idPlayer,0);
    }
    Popup(hwndReportDlg,pt.x,pt.y);
    break;
  case 8:
    if (((uint)sel.pl.dwFlags & 0xfff) != 0) {
      FGetBestDefensePart((PART *)&GlobalPD.field1_0x2);
      GlobalPD.grPopup = 9;
      Popup(hwndReportDlg,pt.x,pt.y);
    }
    break;
  case 9:
  case 10:
  case 0xb:
    xCur = 2;
    ibit = 1;
    for (i = 0; i < icol; i = i + 1) {
      if ((((ibit & (uint)vprptCur->grbitVisible) != 0) ||
          ((ibit >> 0xf & *(uint *)((int)&vprptCur->grbitVisible + 2)) != 0)) &&
         ((i == 0 || (vprptCur->cFieldFirst <= i)))) {
        xCur = xCur + (uint)vprptCur->rgbdx[i] * 2;
      }
      ibit = ibit << 1;
    }
    dxOffset = pt.x - xCur;
    for (i = 1; (i < 4 && ((int)(i * 2 * (uint)vprptCur->rgbdx[icol]) / 3 <= dxOffset));
        i = i + 1) {
    }
    GlobalPD._2_2_ = i + -1;
    GlobalPD.grPopup = 1;
    GlobalPD.psz = (char *)((int)GlobalPD._2_2_ >> 0xf);
    GlobalPD.iPlanMax = *(short *)((int)&sel.pl + 0x1c + GlobalPD._2_2_ * 4)
    ;
    GlobalPD.iPlrVal = *(short *)((int)&sel.pl + 0x1e + GlobalPD._2_2_ * 4);
    GlobalPD.iPlrMin = (short)*(byte *)((int)&sel.pl + 8 + i);
    GlobalPD.iPlrMax = 0;
    i = GlobalPD._2_2_;
    EstMineralsMined(&sel.pl,&rglQuan,-1,0);
    GlobalPD._18_2_ = *(undefined2 *)(&rglQuan + i);
    GlobalPD._20_2_ = *(undefined2 *)((int)&rglQuan + i * 4 + 2);
    GlobalPD.iPlanVal = (uint)sel.pl.wFlags >> 10 & 1;
    GlobalPD.iPlanMin = 0;
    Popup(hwndReportDlg,pt.x,pt.y);
    break;
  case 0xc:
    GlobalPD.grPopup = 0xc;
    GlobalPD.field1_0x2 = (undefined1)sel.pl.id;
    GlobalPD.field2_0x3 = sel.pl.id._1_1_;
    GlobalPD.psz = (char *)CResourcesAtPlanet(&sel.pl,idPlayer);
    GlobalPD.iPlanVal = (short)GlobalPD.psz;
    uVar7 = __aFulshr(uVar7,in_stack_0000ffb6);
    if ((uVar7 & 1) == 0) {
      sVar4 = MulDiv((short)GlobalPD.psz,
                     (int)*(char *)((int)&rgplr[0].pctResearch + idPlayer * 0xc0),
                     100);
      GlobalPD.iPlanVal = GlobalPD.iPlanVal - sVar4;
    }
    Popup(hwndReportDlg,pt.x,pt.y);
  }
switchD_1108_82b9_default:
  ReleaseDC(hwndReportDlg,hdc);
  return;
}



// ======================================================================
// Function: DumpUniverse
// Address: 1108:851e
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cch */
/* WARNING: Variable defined which should be unmapped: fSilentSav */
/* WARNING: Variable defined which should be unmapped: fSuccess */
/* WARNING: Variable defined which should be unmapped: fOpen */
/* WARNING: Removing unreachable block (ram,0x11088586) */
/* WARNING: Removing unreachable block (ram,0x110886ab) */

void DumpUniverse(void)

{
  short sVar1;
  short sVar2;
  ushort cb;
  StringId ids_00;
  char *pcVar3;
  short cch;
  undefined2 *puVar4;
  undefined2 uVar5;
  short fSilentSav;
  short fSuccess;
  short fOpen;
  undefined2 env;
  undefined2 uStack_18;
  short i;
  short ids;
  
  sVar1 = fFileErrSilent;
  if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
    fSuccess = 0;
    fFileErrSilent = sVar1;
  }
  else {
    puVar4 = penvMem;
    penvMem = &env;
    sVar2 = __setjmp(&env);
    if (sVar2 == 0) {
      fFileErrSilent = 1;
      wsprintf(szWork,s__s_map_1120_1633,(char *)szBase,0x1120);
      StreamOpen((char *)szWork,0x1012);
      RgToStream(s___X_Y_Name_1120_163a,0xc);
      for (i = 0; i < game.cPlanMax; i = i + 1) {
        pcVar3 = PszGetCompressedPlanet(((short *)rgidPlan)[i]);
        cb = wsprintf(szWork,s__d__d__d__s_1120_1647,i + 1,
                      ((POINT *)rgptPlan + i)->x,
                      *(undefined2 *)((int)&rgptPlan[0].y + i * 4),pcVar3,0x1120,1);
        uStack_18 = 0x14f8;
        env = 0x8660;
        RgToStream(szWork,cb);
      }
      fSuccess = (short)&DAT_1120_1070;
      StreamClose();
    }
    else {
      fSuccess = 0;
      penvMem = puVar4;
      fFileErrSilent = sVar1;
    }
  }
  if (fSuccess == 0) {
    ids_00 = idsUnableWriteUniverseDefinitionSMapOperation;
  }
  else {
    ids_00 = idsUniverseDefinitionHasSuccessfullyWrittenSMap;
  }
  pcVar3 = PszGetCompressedString(ids_00);
  uVar5 = 0x1120;
  wsprintf(szWork,(char *)pcVar3);
  uStack_18 = 0x86bb;
  AlertSz((char *)szWork,0x40);
  fFileErrSilent = (short)szBase;
  penvMem = (undefined2 *)uVar5;
  return;
}



// ======================================================================
// Function: DumpPlanets
// Address: 1108:86e4
// Segment: MEMORY_REPORT
// ======================================================================


void DumpPlanets(void)

{
  short sVar1;
  char *pcVar2;
  ushort uVar3;
  char *pcVar4;
  PLANET *pPVar5;
  int iVar6;
  long *plVar7;
  undefined2 uVar8;
  undefined2 unaff_SS;
  long lVar9;
  ulong uVar10;
  short *psVar11;
  ushort in_stack_0000fdb4;
  undefined2 in_stack_0000fdb6;
  undefined2 in_stack_0000fdb8;
  undefined2 in_stack_0000fdba;
  undefined4 rgl;
  undefined2 local_23c;
  undefined2 uStack_23a;
  HullSlotType part;
  uint local_236;
  long l;
  short cch;
  char *psz;
  undefined1 *penvMemSav;
  short fSilentSav;
  short fSuccess;
  short fOpen;
  undefined1 env [18];
  short i;
  short j;
  char szForm [256];
  char szFile [256];
  PLANET *lppl;
  short ids;
  PLANET *lpplMac;
  undefined2 local_6;
  
  fSilentSav = fFileErrSilent;
  fSuccess = 1;
  fOpen = 0;
  if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
    fSuccess = 0;
  }
  else {
    penvMemSav = penvMem;
    penvMem = env;
    sVar1 = __setjmp(env);
    if (sVar1 == 0) {
      fFileErrSilent = 1;
      if (((uint)gd.wFlags >> 5 & 1) == 0) {
        wsprintf((char *)szFile,s__s_pla_1120_165c,(char *)szBase);
      }
      else {
        wsprintf((char *)szFile,s__s_p_d_1120_1655,(char *)szBase,0x1120);
      }
      StreamOpen(szFile,0x1012);
      fOpen = 1;
      j = ((uint)gd.wFlags >> 5 & 1) + 2;
      for (i = 0; i < j; i = i + 1) {
        cch = CchGetString(i + idsPlanetNameOwnerStarbaseTypeReportAge,szForm);
        for (psz = szForm; *psz != '\0'; psz = psz + 1) {
          if (*psz == '*') {
            *psz = '\t';
          }
        }
        RgToStream((char *)szForm,cch);
        if (i == j + -1) {
          RgToStream(szCRLF,2);
        }
      }
      l = CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
      lpplMac = (PLANET *)lpPlanets + cPlanet;
      local_6 = lpPlanets._2_2_;
      lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
      while ((PLANET *)lppl < lpplMac) {
        pcVar2 = PszGetCompressedPlanet(((short *)rgidPlan)[lppl->id]);
        _strcpy(szForm,pcVar2);
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        szForm[0] = '\t';
        uVar8 = (undefined2)((ulong)lppl >> 0x10);
        if (((PLANET *)lppl)->iPlayer == -1) {
          RgToStream((char *)szForm,1);
        }
        else {
          pcVar2 = PszPlayerName(((PLANET *)lppl)->iPlayer,1,0,0,0,(PLAYER *)0x0);
          _strcpy(szForm + 1,pcVar2);
          uVar3 = _strlen(szForm);
          RgToStream((char *)szForm,uVar3);
        }
        uVar8 = (undefined2)((ulong)lppl >> 0x10);
        pPVar5 = (PLANET *)lppl;
        if ((pPVar5->iPlayer == -1) || (((uint)pPVar5->wFlags >> 9 & 1) == 0)) {
          cch = 1;
        }
        else {
          iVar6 = pPVar5->iPlayer * 4;
          __fstrcpy((char *)(szForm + 1),
                            (char *)CONCAT22(*(undefined2 *)(iVar6 + 0x14e),
                                             (char *)(*(int *)(iVar6 + 0x14c) +
                                                      (*(uint *)&pPVar5->field11_0x2c & 0xf) * 0x93
                                                     + 8)));
          cch = _strlen(szForm);
        }
        RgToStream((char *)szForm,cch);
        __itoa(game.turn - ((PLANET *)lppl)->turn,szForm + 1,10);
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        szForm[1] = 0;
        uVar8 = (undefined2)((ulong)lppl >> 0x10);
        pPVar5 = (PLANET *)lppl;
        if ((pPVar5->wFlags & 0xffU) == 7) {
          psVar11 = (short *)0x0;
          uVar10 = __aFulmul(CONCAT22(*(undefined2 *)((int)pPVar5->rgwtMin + 0xe),
                                              (int)pPVar5->rgwtMin[3]),100);
          pcVar2 = PszFromLong(uVar10,psVar11);
          _strcpy(szForm + 1,pcVar2);
        }
        else if ((pPVar5->iPlayer != -1) && (2 < (pPVar5->wFlags & 0xffU))) {
          l = __aFulmul((ulong)(pPVar5->uGuesses & 0xfff),400);
          pcVar2 = PszFromLong(l,(short *)0x0);
          _strcpy(szForm + 1,pcVar2);
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        if ((((PLANET *)lppl)->wFlags & 0xffU) < 3) {
          szForm[1] = 0;
        }
        else {
          i = PctPlanetDesirability(lppl,idPlayer);
          wsprintf((char *)(szForm + 1),(char *)PCTDPCTPCT,i);
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        szForm[1] = 0;
        if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
          FillPlanetProdLB(0,(PLPROD *)0x0,lppl);
          _strcpy(szForm + 1,(char *)szWork);
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        uVar8 = (undefined2)((ulong)lppl >> 0x10);
        pPVar5 = (PLANET *)lppl;
        if ((pPVar5->wFlags & 0xffU) == 7) {
          CalcPctSurvive(lppl,(float *)&l,(float *)0x0);
          l = (long)(DAT_1120_1e0a - (float)l);
          local_23c = 100;
          uStack_23a = 0;
          __ftol((double)CONCAT26(in_stack_0000fdba,
                                          CONCAT24(in_stack_0000fdb8,
                                                   CONCAT22(in_stack_0000fdb6,in_stack_0000fdb4))));
          in_stack_0000fdb4 = 10000;
          in_stack_0000fdb6 = 0;
          lVar9 = __ftol((double)CONCAT26(in_stack_0000fdba,
                                                  CONCAT24(in_stack_0000fdb8,&DAT_0000_2710)));
          uVar8 = (undefined2)lVar9;
          lVar9 = __ftol((double)CONCAT26(in_stack_0000fdb8,
                                                  CONCAT24(in_stack_0000fdb6,
                                                           CONCAT22(in_stack_0000fdb4,uVar8))));
          uVar3 = (ushort)lVar9;
          uVar10 = __aFulshr(CONCAT22(uVar8,uVar3),in_stack_0000fdb4);
          uVar10 = __aFulshr((ulong)((uint)uVar10 & 0xfff),uVar3);
          wsprintf((char *)(szForm + 1),s__ld__ld__d__d___1120_1663,(uint)uVar10 & 0xfff,0);
        }
        else {
          szForm[2] = 9;
          szForm[1] = 9;
          szForm[3] = 0;
          if ((((uint)gd.wFlags >> 5 & 1) != 0) && ((uint)pPVar5->uGuesses >> 0xc != 0)) {
            cch = wsprintf((char *)(szForm + 3),&DAT_1120_1673,
                           ((uint)pPVar5->uGuesses >> 0xc) * 6 + 3);
            szForm[cch + 3] = '\0';
          }
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        szForm[1] = 0;
        for (i = 0; i < 3; i = i + 1) {
          uVar8 = (undefined2)((ulong)lppl >> 0x10);
          if (2 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            plVar7 = ((PLANET *)lppl)->rgwtMin + i;
            pcVar2 = PszFromLong
                               (CONCAT22(*(undefined2 *)((int)plVar7 + 2),(int)*plVar7),(short *)0x0
                               );
            _strcpy(szForm + 1,pcVar2);
          }
          uVar3 = _strlen(szForm);
          RgToStream((char *)szForm,uVar3);
        }
        szForm[1] = 0;
        for (i = 0; i < 3; i = i + 1) {
          if (3 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            EstMineralsMined(lppl,&rgl,-1,0);
            pcVar2 = PszFromLong
                               (CONCAT22(*(undefined2 *)((int)&rgl + i * 4 + 2),
                                         *(undefined2 *)(&rgl + i)),(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
          }
          uVar3 = _strlen(szForm);
          RgToStream((char *)szForm,uVar3);
        }
        szForm[1] = 0;
        i = 0;
        while( true ) {
          if (2 < i) break;
          if (2 < (((PLANET *)lppl)->wFlags & 0xffU)) {
            pcVar2 = PszFromInt((uint)((PLANET *)lppl)->rgMinConc[i],(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
          }
          uVar3 = _strlen(szForm);
          RgToStream((char *)szForm,uVar3);
          i = i + 1;
        }
        if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
          psVar11 = (short *)0x0;
          sVar1 = CResourcesAtPlanet(lppl,idPlayer);
          pcVar2 = PszFromInt(sVar1,psVar11);
          _strcpy(szForm + 1,pcVar2);
        }
        else {
          szForm[1] = 0;
        }
        uVar3 = _strlen(szForm);
        RgToStream((char *)szForm,uVar3);
        if (((uint)gd.wFlags >> 5 & 1) != 0) {
          if ((((PLANET *)lppl)->wFlags & 0xffU) < 3) {
            szForm[1] = 0;
            for (i = 0; i < 7; i = i + 1) {
              RgToStream((char *)szForm,1);
            }
          }
          else {
            for (i = 0; i < 3; i = i + 1) {
              pcVar2 = PszCalcEnvVar(i,(int)((PLANET *)lppl)->rgEnvVar[i]);
              _strcpy(szForm + 1,pcVar2);
              uVar3 = _strlen(szForm);
              RgToStream((char *)szForm,uVar3);
            }
            i = 0;
            while( true ) {
              if (2 < i) break;
              pcVar2 = PszCalcEnvVar(i,(int)((PLANET *)lppl)->rgEnvVarOrig[i]);
              _strcpy(szForm + 1,pcVar2);
              uVar3 = _strlen(szForm);
              RgToStream((char *)szForm,uVar3);
              i = i + 1;
            }
            psVar11 = (short *)0x0;
            sVar1 = PctPlanetOptValue(lppl,idPlayer);
            pcVar2 = PszFromInt(sVar1,psVar11);
            _strcpy(szForm + 1,pcVar2);
            _strcat(szForm + 1,(char *)&DAT_1120_1678);
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
          }
          if ((((PLANET *)lppl)->wFlags & 0xffU) == 7) {
            psVar11 = (short *)0x0;
            sVar1 = PctPlanetCapacity(lppl);
            pcVar2 = PszFromInt(sVar1,psVar11);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
            psVar11 = (short *)0x0;
            sVar1 = GetPlanetScannerRange(lppl,&i);
            pcVar2 = PszFromInt(sVar1,psVar11);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
            pcVar2 = PszFromInt(i,(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
            uVar8 = (undefined2)((ulong)lppl >> 0x10);
            pPVar5 = (PLANET *)lppl;
            if ((pPVar5->wFlags & 0x3ffU) == 0) {
              i = 0;
              szForm[1] = 0;
            }
            else {
              i = ((uint)pPVar5->wFlags >> 10 & 0xf) + 4;
              pcVar2 = PszGetPlanetName((pPVar5->wFlags & 0x3ffU) - 1);
              _strcpy(szForm + 1,pcVar2);
            }
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
            pcVar2 = PszFromInt(i,(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
            uVar8 = (undefined2)((ulong)lppl >> 0x10);
            if ((((PLANET *)lppl)->wRouting & 0x3ffU) == 0) {
              szForm[1] = 0;
            }
            else {
              pcVar2 = PszGetPlanetName((((PLANET *)lppl)->wRouting & 0x3ffU) - 1);
              _strcpy(szForm + 1,pcVar2);
            }
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
            if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
              i = -1;
            }
            else {
              i = IStargateFromLppl(lppl);
              if (i != 0xffff) {
                part = hstSpecialSB;
                local_236 = local_236 & 0xff00 | i & 0xffU;
                FLookupPart((PART *)&stack0xfdc8);
                pcVar2 = PszFromInt(*(short *)((int)l + 0x36),(short *)0x0);
                _strcpy(szForm + 1,pcVar2);
                uVar3 = _strlen(szForm);
                RgToStream((char *)szForm,uVar3);
                pcVar2 = PszFromInt(*(short *)((int)l + 0x34),(short *)0x0);
                _strcpy(szForm + 1,pcVar2);
                uVar3 = _strlen(szForm);
                RgToStream((char *)szForm,uVar3);
              }
            }
            if (i == -1) {
              RgToStream(&DAT_1120_167a,4);
            }
            uVar8 = (undefined2)((ulong)lppl >> 0x10);
            if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0) {
              i = 0;
            }
            else {
              i = *(uint *)&((PLANET *)lppl)->field11_0x2c >> 4;
            }
            pcVar2 = PszFromInt(i,(short *)0x0);
            _strcpy(szForm + 1,pcVar2);
            uVar3 = _strlen(szForm);
            RgToStream((char *)szForm,uVar3);
          }
        }
        RgToStream(szCRLF,2);
        lppl = (PLANET *)CONCAT22(lppl._2_2_,(PLANET *)lppl + 1);
      }
      StreamClose();
    }
    else {
      if (fOpen != 0) {
        StreamClose();
      }
      fFileErrSilent = fSilentSav;
      fSuccess = 0;
      penvMem = penvMemSav;
    }
  }
  if (fSuccess == 0) {
    ids = idsUnableWritePlanetInformationSOperationTerminated;
  }
  else {
    ids = idsKnownPlanetInformationHasSuccessfullyWrittenS;
  }
  pcVar2 = szFile;
  pcVar4 = PszGetCompressedString(ids);
  wsprintf(szWork,(char *)pcVar4,pcVar2);
  if (fSuccess == 0) {
    AlertSz((char *)szWork,0x10);
  }
  else {
    AlertSz((char *)szWork,0x40);
  }
  fFileErrSilent = fSilentSav;
  penvMem = penvMemSav;
  return;
}



// ======================================================================
// Function: DumpFleets
// Address: 1108:9530
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cch */
/* WARNING: Removing unreachable block (ram,0x110895a6) */

void DumpFleets(void)

{
  uint uVar1;
  bool bVar2;
  undefined1 *puVar3;
  short sVar4;
  short sVar5;
  ushort uVar6;
  void *cb;
  char *pcVar7;
  FLEET *pFVar8;
  uint uVar9;
  int iVar10;
  undefined2 uVar11;
  undefined2 unaff_SS;
  bool bVar12;
  long lVar13;
  HULDEF *pHVar14;
  int iVar15;
  short cch;
  short *psVar16;
  undefined1 *penvMemSav;
  short fSilentSav;
  short fSuccess;
  short fOpen;
  short i;
  short j;
  FLEET *lpfl;
  short ifl;
  char szForm [256];
  char szFile [256];
  short ids;
  short iplr;
  
  sVar4 = fFileErrSilent;
  puVar3 = penvMem;
  bVar2 = true;
  iplr = idPlayer;
  if ((((int)game.lid == 0) && (game.lid._2_2_ == 0)) || (idPlayer == -1)) {
    bVar2 = false;
    penvMem = puVar3;
    fFileErrSilent = sVar4;
  }
  else {
    penvMemSav = penvMem;
    penvMem = &stack0xfddc;
    sVar5 = __setjmp(&stack0xfddc);
    if (sVar5 == 0) {
      fFileErrSilent = 1;
      if (((uint)gd.wFlags >> 5 & 1) == 0) {
        wsprintf((char *)szFile,s__s_fle_1120_1686,(char *)szBase,0x1120);
      }
      else {
        wsprintf((char *)szFile,s__s_f_d_1120_167f,(char *)szBase,0x1120,
                 idPlayer + 1);
      }
      StreamOpen(szFile,0x1012);
      j = ((uint)gd.wFlags >> 5 & 1) + 2;
      for (i = 0; i < j; i = i + 1) {
        uVar6 = CchGetString(i + idsFleetNameXYPlanetDestinationBattle,szForm);
        for (pcVar7 = szForm; *pcVar7 != '\0'; pcVar7 = pcVar7 + 1) {
          if (*pcVar7 == '*') {
            *pcVar7 = '\t';
          }
        }
        RgToStream((char *)szForm,uVar6);
        if (i == j + -1) {
          RgToStream(szCRLF,2);
        }
      }
      iplr = idPlayer;
      for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
        pFVar8 = ((FLEET **)rglpfl)[ifl];
        iVar15 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar15,pFVar8);
        if ((pFVar8 == (FLEET *)0x0) && (iVar15 == 0)) break;
        idPlayer = -1;
        pcVar7 = PszGetFleetName(lpfl->id);
        idPlayer = iplr;
        cb = (void *)_strlen(pcVar7);
        RgToStream((void *)cb,(ushort)cb);
        szForm[0] = '\t';
        pcVar7 = PszFromInt((&((FLEET *)lpfl)->pt)->x,(short *)0x0);
        _strcpy(szForm + 1,pcVar7);
        uVar6 = _strlen(szForm);
        RgToStream((char *)szForm,uVar6);
        pcVar7 = PszFromInt((((FLEET *)lpfl)->pt).y,(short *)0x0);
        _strcpy(szForm + 1,pcVar7);
        uVar6 = _strlen(szForm);
        RgToStream((char *)szForm,uVar6);
        uVar11 = (undefined2)((ulong)lpfl >> 0x10);
        if (((FLEET *)lpfl)->idPlanet == -1) {
          cch = 1;
        }
        else {
          pcVar7 = PszGetPlanetName(((FLEET *)lpfl)->idPlanet);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(pcVar7);
          cch = uVar6 + 1;
        }
        RgToStream((char *)szForm,cch);
        uVar11 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar8 = (FLEET *)lpfl;
        if ((pFVar8->wFlags & 0xffU) == 7) {
          pcVar7 = PszGetDestName(lpfl,0);
          _strcpy(szForm + 1,pcVar7);
        }
        else if (((((uint)gd.wFlags >> 5 & 1) == 0) || (6 < (pFVar8->wFlags & 0xffU))) ||
                (((uint)pFVar8->wFlags >> 4 & 1) == 0)) {
          szForm[1] = 0;
        }
        else {
          pcVar7 = PszFromInt(*(uint *)&pFVar8->field17_0x74 & 0xff,(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          _strcat(szForm,(char *)&DAT_1120_168d);
          pcVar7 = PszFromInt(*(uint *)&((FLEET *)lpfl)->field17_0x74 >> 8,(short *)0x0);
          _strcat(szForm,pcVar7);
        }
        uVar6 = _strlen(szForm);
        RgToStream((char *)szForm,uVar6);
        uVar9 = (uint)lpfl->id >> 9 & 0xf;
        if ((((BTLPLAN **)rglpbtlplan)[uVar9 * 2] == (BTLPLAN *)0x0) &&
           (((undefined2 *)&DAT_1120_593a)[uVar9 * 2] == 0)) {
          szForm[1] = 0;
        }
        else {
          uVar9 = (uint)lpfl->id >> 9 & 0xf;
          __fstrcpy((char *)(szForm + 1),
                            (char *)CONCAT22(((undefined2 *)&DAT_1120_593a)[uVar9 * 2],
                                             ((BTLPLAN **)rglpbtlplan)[uVar9 * 2]
                                             [((FLEET *)lpfl)->iplan].szName));
        }
        uVar6 = _strlen(szForm);
        RgToStream((char *)szForm,uVar6);
        uVar9 = 0;
        iVar15 = 0;
        for (i = 0; i < 0x10; i = i + 1) {
          uVar1 = ((FLEET *)lpfl)->rgcsh[i];
          bVar12 = CARRY2(uVar9,uVar1);
          uVar9 = uVar9 + uVar1;
          iVar15 = iVar15 + ((int)uVar1 >> 0xf) + (uint)bVar12;
        }
        pcVar7 = PszFromLong(CONCAT22(iVar15,uVar9),(short *)0x0);
        _strcpy(szForm + 1,pcVar7);
        uVar6 = _strlen(szForm);
        RgToStream((char *)szForm,uVar6);
        i = 0;
        while( true ) {
          if (4 < i) break;
          pcVar7 = PszFromLong
                             (CONCAT22(*(undefined2 *)((int)(((FLEET *)lpfl)->rgwtMin + i) + 2),
                                       (int)((FLEET *)lpfl)->rgwtMin[i]),(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          i = i + 1;
        }
        if (((uint)gd.wFlags >> 5 & 1) != 0) {
          pcVar7 = PszFromInt(((FLEET *)lpfl)->iPlayer + 1,(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          if (((FLEET *)lpfl)->cord < 2) {
            szForm[1] = 0x30;
            szForm[2] = 0;
          }
          else {
            pcVar7 = PszGetETA(0,lpfl,(short *)0x0);
            _strcpy(szForm + 1,pcVar7);
          }
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          uVar11 = (undefined2)((ulong)lpfl >> 0x10);
          pFVar8 = (FLEET *)lpfl;
          if (pFVar8->cord < 2) {
            if (((pFVar8->wFlags & 0xffU) < 7) && (((uint)pFVar8->wFlags >> 4 & 1) != 0)) {
              i = pFVar8->wFlags & 0xf;
            }
            else {
              i = 0;
            }
          }
          else {
            i = (uint)((PLORD *)pFVar8->lpplord + 7)->wFlags >> 4 & 0xf;
          }
          pcVar7 = PszFromInt(i,(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          psVar16 = (short *)0x0;
          lVar13 = WtFromLpfl(lpfl);
          pcVar7 = PszFromLong(lVar13,psVar16);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          psVar16 = (short *)0x0;
          sVar5 = PctCloakFromLpfl(lpfl);
          pcVar7 = PszFromInt(sVar5,psVar16);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          j = GetFleetScannerRange(lpfl,&i,(short *)0x0,(short *)0x0);
          if (j == -1) {
            j = 0;
          }
          pcVar7 = PszFromInt(j,(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          pcVar7 = PszFromInt(i,(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          if ((((FLEET *)lpfl)->wFlags & 0xffU) == 7) {
            pcVar7 = PszGetTaskName(lpfl,&i);
            _strcpy(szForm + 1,pcVar7);
          }
          else {
            szForm[1] = 0;
          }
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          psVar16 = (short *)0x0;
          lVar13 = CMineFromLpfl(lpfl);
          pcVar7 = PszFromLong(lVar13,psVar16);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          psVar16 = (short *)0x0;
          lVar13 = CMineSweepFromLpfl(lpfl);
          pcVar7 = PszFromLong(lVar13,psVar16);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          psVar16 = (short *)0x0;
          lVar13 = CLayMinesFromLpfl(lpfl,-1,-1);
          pcVar7 = PszFromLong(lVar13,psVar16);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          psVar16 = (short *)0x0;
          lVar13 = PctTerraFromLpfl(lpfl);
          pcVar7 = PszFromLong(lVar13,psVar16);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          uVar9 = 0;
          iVar15 = 0;
          for (i = 0; i < 0x10; i = i + 1) {
            if (((FLEET *)lpfl)->rgcsh[i] != 0) {
              iVar10 = ((FLEET *)lpfl)->iPlayer * 4;
              iVar15 = -0x6078;
              pHVar14 = LphuldefFromId(*(HullDef *)(*(int *)(iVar10 + 0xfe) + i * 0x93));
              j = (uint)((HULDEF *)pHVar14)->wFlags >> 10 & 0xf;
              if (((uint)j < 2) || (5 < (uint)j)) {
                uVar1 = ((FLEET *)lpfl)->rgcsh[i];
                bVar12 = CARRY2(uVar9,uVar1);
                uVar9 = uVar9 + uVar1;
                iVar15 = iVar15 + ((int)uVar1 >> 0xf) + (uint)bVar12;
              }
            }
          }
          pcVar7 = PszFromLong(CONCAT22(iVar15,uVar9),(short *)0x0);
          _strcpy(szForm + 1,pcVar7);
          uVar6 = _strlen(szForm);
          RgToStream((char *)szForm,uVar6);
          for (j = 2; j < 6; j = j + 1) {
            uVar9 = 0;
            iVar15 = 0;
            for (i = 0; i < 0x10; i = i + 1) {
              if (((FLEET *)lpfl)->rgcsh[i] != 0) {
                iVar10 = ((FLEET *)lpfl)->iPlayer * 4;
                iVar15 = -0x5f76;
                pHVar14 = LphuldefFromId(*(HullDef *)(*(int *)(iVar10 + 0xfe) + i * 0x93));
                if (((uint)((HULDEF *)pHVar14)->wFlags >> 10 & 0xf) == j) {
                  uVar1 = ((FLEET *)lpfl)->rgcsh[i];
                  bVar12 = CARRY2(uVar9,uVar1);
                  uVar9 = uVar9 + uVar1;
                  iVar15 = iVar15 + ((int)uVar1 >> 0xf) + (uint)bVar12;
                }
              }
            }
            pcVar7 = PszFromLong(CONCAT22(iVar15,uVar9),(short *)0x0);
            _strcpy(szForm + 1,pcVar7);
            uVar6 = _strlen(szForm);
            RgToStream((char *)szForm,uVar6);
          }
        }
        RgToStream(szCRLF,2);
      }
      StreamClose();
    }
    else {
      bVar2 = false;
      penvMem = puVar3;
      fFileErrSilent = sVar4;
    }
  }
  if (bVar2) {
    ids = idsKnownFleetInformationHasSuccessfullyWrittenS;
  }
  else {
    ids = idsUnableWriteFleetInformationSOperationTerminated;
  }
  pcVar7 = PszGetCompressedString(ids);
  wsprintf(szWork,(char *)pcVar7,szFile);
  if (bVar2) {
    AlertSz((char *)szWork,0x40);
  }
  else {
    AlertSz((char *)szWork,0x10);
  }
  fFileErrSilent = sVar4;
  penvMem = penvMemSav;
  return;
}



// ======================================================================
// Function: PrintMapDlg
// Address: 1108:a1c2
// Segment: MEMORY_REPORT
// ======================================================================


/* WARNING: Variable defined which should be unmapped: hwndEdit */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

short PrintMapDlg(HWND hwnd,ushort msg,ushort wParam,long lParam)

{
  HWND HVar1;
  char *sz;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  ulong uVar2;
  short mbType;
  HWND hwndEdit;
  RECT rc;
  short i;
  
  if (msg == 0x14) {
    GetClientRect(hwnd,(RECT *)&rc);
    FillRect(wParam,(RECT *)&rc,hbrButtonFace);
    return 1;
  }
  if (msg == 0x19) {
    uVar2 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),hwndEdit);
    if ((int)uVar2 == 6) {
      SetBkColor(wParam,CONCAT22(crButtonFace._2_2_,(undefined2)crButtonFace));
      return hbrButtonFace;
    }
  }
  else {
    if (msg == 0x110) {
      for (i = 0; i < 2; i = i + 1) {
        HVar1 = GetDlgItem(hwnd,i + 0x10c);
        SendMessage(HVar1,0x415,1,0);
        SendMessage(HVar1,0x30,rghfontArial8[1],0);
        szWork[0] = (char)((short *)vrgcPrintMapPage)[i] + '0';
        szWork[1] = '\0';
        SetWindowText(HVar1,szWork);
      }
      StickyDlgPos(hwnd,(POINT *)&ptStickyPrintMapDlg,1);
      return 1;
    }
    if (msg == 0x111) {
      if ((wParam == 1) || (wParam == 2)) {
        if (wParam == 1) {
          for (i = 0; i < 2; i = i + 1) {
            HVar1 = GetDlgItem(hwnd,i + 0x10c);
            GetWindowText(HVar1,szWork,10);
            if ((((szWork[0] == '\0') || (szWork[1] != '\0')) ||
                (szWork[0] < '1')) || ('9' < szWork[0])) {
              mbType = 0x10;
              sz = PszFormatIds(idsMustSpecifyNumberBetween19,(short *)0x0);
              AlertSz(sz,mbType);
              SetFocus(HVar1);
              break;
            }
            ((short *)vrgcPrintMapPage)[i] = szWork[0] + -0x30;
          }
        }
        StickyDlgPos(hwnd,(POINT *)&ptStickyPrintMapDlg,0);
        EndDialog(hwnd,(uint)(wParam == 1));
        return 1;
      }
      if (wParam == 0x76) {
        WinHelp(hwnd,(LPCSTR)_szHelpFile,1,0xc3c);
        return 1;
      }
      if (((wParam == 0x10c) || (wParam == 0x10d)) &&
         (uVar2 = __aFulshr(CONCAT22(unaff_SI,unaff_DI),hwndEdit), (int)uVar2 == 0x400)) {
        GetWindowText((HWND)lParam,szWork,10);
        if ((szWork[0] != '\0') &&
           ((szWork[0] < '1' || ('9' < szWork[0])))) {
          MessageBeep(0);
          SetWindowText((HWND)lParam,szWork + 1);
        }
      }
    }
  }
  return 0;
}



