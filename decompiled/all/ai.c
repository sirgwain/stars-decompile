// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
//

// ======================================================================
// Function: DoAiTurn
// Address: 1088:0000
// Segment: MEMORY_AI
// ======================================================================

void DoAiTurn(short iPlayer, ushort wMdPlr)

{
    PLANET   **ppPVar1;
    byte      *pbVar2;
    short      sVar3;
    short      sVar4;
    undefined2 unaff_SS;
    short      idSav;
    PROD       rgprod[64];
    char       szExt[4];

    /* Segment:    18
       Offset:     00081340
       Length:     60bc
       Min Alloc:  60bc
       Flags:      1d10
           Code
           Discardable
           Moveable
           LoadOnCall
           Impure (Non-shareable)
        */
    sVar3 = idPlayer;
    fAi = 1;
    _wsprintf(szExt, MPCTD, iPlayer + 1);
    DestroyCurGame();
    sVar4 = FLoadGame((char *)szBase, szExt);
    pbVar2 = vlpbAiPlanet;
    ppPVar1 = vrglpplAi;
    if (sVar4 != 0) {
        if ((*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) & 1) == 0) {
            vlpbAiPlanet = LpAlloc(game.cPlanMax << 4, htMisc);
            vrglpplAi = LpAlloc(game.cPlanMax << 2, htMisc);
            if (((byte *)vlpbAiData == 0) && (vlpbAiData._2_2_ == 0)) {
                vlpbAiData = LpAlloc(0x2000, htMisc);
                if (((byte *)vlpbAiData != 0) || ((int)((ulong)vlpbAiData >> 0x10) != 0)) {
                    pbVar2 = vlpbAiData + 1;
                    vlpbAiData[0] = 2;
                    *pbVar2 = 0;
                }
            }
            if ((vlpbAiPlanet != 0) && ((((byte *)vlpbAiData != 0 || (vlpbAiData._2_2_ != 0)) && (vrglpplAi != 0)))) {
                __fmemset(vlpbAiPlanet, 0, game.cPlanMax << 4);
                ComputeShdefPowers();
                MarkPlanetsUnderAttack();
                IncreaseAIMinefieldSizes();
                InitRandomPlanetList();
                if (wMdPlr != 0xffff) {
                    *(ushort *)((int)&rgplr[0].wMdPlr + iPlayer * 0xc0) = wMdPlr;
                }
                switch (*(uint *)((int)&rgplr[0].wMdPlr + iPlayer * 0xc0) >> 0xd) {
                case 0:
                    DoRobotoidAiTurn(rgprod);
                    break;
                case 1:
                    DoTurinDroneAiTurn(rgprod);
                    break;
                case 2:
                    DoAutomitronAiTurn(rgprod);
                    break;
                case 3:
                    DoRototillAiTurn(rgprod);
                    break;
                case 4:
                    DoCyberAiTurn(rgprod);
                    break;
                case 5:
                    DoMacintiAiTurn(rgprod);
                    break;
                default:
                    break;
                case 7:
                    DoMaidAiTurn(rgprod);
                }
            }
        }
        FWriteLogFile((char *)szBase, iPlayer);
        FWriteHistFile(iPlayer);
        if (vrglpplAi != 0) {
            FreeLp(vrglpplAi, htMisc);
        }
        ppPVar1 = 0;
        if (((byte *)vlpbAiData != 0) || (pbVar2 = vlpbAiPlanet, vlpbAiData._2_2_ != 0)) {
            vrglpplAi = ppPVar1;
            FreeLp(vlpbAiPlanet, htMisc);
            FreeLp(vlpbAiData, htMisc);
            vlpbAiData = 0;
            pbVar2 = 0;
            ppPVar1 = vrglpplAi;
        }
    }
    fAi = 0;
    vrglpplAi._2_2_ = (undefined2)((ulong)ppPVar1 >> 0x10);
    vrglpplAi._0_2_ = (PLANET **)ppPVar1;
    vlpbAiPlanet._2_2_ = (undefined2)((ulong)pbVar2 >> 0x10);
    vlpbAiPlanet._0_2_ = (byte *)pbVar2;
    idPlayer = sVar3;
    return;
}

// ======================================================================
// Function: DoRobotoidAiTurn
// Address: 1088:0312
// Segment: MEMORY_AI
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x108808ca) */
/* WARNING: Removing unreachable block (ram,0x108808a9) */
/* WARNING: Removing unreachable block (ram,0x108808cf) */
/* WARNING: Removing unreachable block (ram,0x10880d8d) */
/* WARNING: Removing unreachable block (ram,0x10880f50) */
/* WARNING: Removing unreachable block (ram,0x10880a7a) */
/* WARNING: Removing unreachable block (ram,0x10880abe) */

void DoRobotoidAiTurn(PROD *rgprod)

{
    uint          *puVar1;
    int           *piVar2;
    byte          *pbVar3;
    ushort        *puVar4;
    int            iVar5;
    PLORD         *pPVar6;
    POINT          pt;
    PLANET        *pPVar7;
    short          sVar8;
    uint           uVar9;
    short          sVar10;
    uint           uVar11;
    ITEMACTION     IVar12;
    ushort         uVar13;
    int            iVar14;
    PLANET        *pPVar15;
    byte          *pbVar16;
    FLEET         *pFVar17;
    ushort        *puVar18;
    PLORD         *pPVar19;
    undefined2     uVar20;
    ulong          uVar21;
    PLANET        *pPVar22;
    undefined1     local_a4[6];
    undefined2     local_9e;
    u_ORDER_0x0008 local_9c;
    undefined2     uStack_92;
    ushort         uStack_90;
    PROD          *lpprod;
    short          fWrite;
    long           l;
    short          iLatestBomber;
    short          iPlanet;
    short          iLatestBattle;
    short          cFr;
    ushort         cRecyclePeriod;
    short          iLatestMeta;
    PLANET        *lpplMac;
    short          ishdefSBLatest;
    short          fTonsOfMinerals;
    short          ipl;
    short          iLatestCargo;
    short          iAiLvl;
    short          iroCur;
    short          cRes;
    PLANET        *lpplHome;
    FLEET         *lpfl;
    FLEET         *lpflAttack;
    ushort         rgCosts[4];
    short          i;
    short          ifl;
    PLANET        *lppl;
    short          fShouldColonize;
    byte           rgRecycleShdef[16];
    short          j;
    short          idPlanDst;
    THING         *lpthWorm;
    short          cColFleet;
    short          iLatestDestroyer;
    short          cFlDestroyers;
    short          cExistCargo;
    long           rgResAvail[4];
    FLEET         *lpflEnemy;
    long           rgResCost[4];

    iAiLvl = *(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7;
    iPlanet = *(short *)((int)&rgplr[0].idPlanetHome + idPlayer * 0xc0);
    if (game.turn < 10) {
        sVar8 = 0;
    } else {
        sVar8 = 0xf;
    }
    iroCur = IroEnsureAi(vrgAiRobotoidResOrder, 0x24, &ishdefSBLatest, sVar8);
    if (0x32 < game.turn) {
        MergeAllShdefs(0x6fc);
        MergeAllShdefs(1);
        MergeAllShdefs(-0x4000);
    }
    j = 4;
    if (0x82 < game.turn) {
        j = (game.turn - 0x78) / 0x14 + 4;
    }
    if (0x32 < (uint)j) {
        j = 0x32;
    }
    vrgAiArmadaPotency[0] = (byte)j;
    vrgAiArmadaPotency[1] = (byte)((ulong)(j & 0xff) / 2);
    j = 6;
    if (0x73 < game.turn) {
        j = (game.turn - 100) / 0x16 + 6;
    }
    if (0xc < (uint)j) {
        j = 0xc;
    }
    vrgAiArmadaPotency[2] = (byte)j;
    if ((int)((uint)j / 2 - 1) < 4) {
        vrgAiArmadaPotency[3] = (char)((uint)j / 2) - 1;
    } else {
        vrgAiArmadaPotency[3] = 3;
    }
    _memset(rgRecycleShdef, 0, 0x10);
    if (game.turn < 0x78) {
        cRecyclePeriod = 0x32;
    } else if (game.turn < 200) {
        cRecyclePeriod = 0x46;
    } else {
        cRecyclePeriod = 100;
    }
    CheckAiShdefStatus(0xe, 0xf, cRecyclePeriod, &iLatestDestroyer, rgRecycleShdef);
    for (i = 0xe; i < 0x10; i = i + 1) {
        if (((rgRecycleShdef[i] != 0) && ((*(uint *)((int)&rgshdef[0].wFlags + i * 0x93) >> 9 & 1) == 0)) && (*(int *)(i * 0x93 + rgshdef) == 0x1d)) {
            rgRecycleShdef[i] = 0;
        }
    }
    cExistCargo = CheckAiShdefStatus(0xb, 0xd, cRecyclePeriod, &iLatestCargo, rgRecycleShdef);
    CheckAiShdefStatus(9, 10, cRecyclePeriod, &iLatestBomber, rgRecycleShdef);
    CheckAiShdefStatus(2, 5, cRecyclePeriod, &iLatestMeta, rgRecycleShdef);
    CheckAiShdefStatus(6, 7, (ushort)(((long)(int)cRecyclePeriod * 3 & 0xffffU) / 2), &iLatestBattle, rgRecycleShdef);
    if (0x50 < game.turn) {
        SplitOutShdefs(rgRecycleShdef);
        _memset(&local_9e, 0, 0x10);
        local_9e = CONCAT11(local_9e._1_1_, 2);
        SplitOutShdefs(&local_9e);
        _memset(&local_9e, 0, 0x10);
        local_9e = CONCAT11(2, (byte)local_9e);
        SplitOutShdefs(&local_9e);
        _memset(&local_9e, 0, 0x10);
        uStack_92._1_1_ = 2;
        uStack_92._0_1_ = 2;
        local_9c.txp.rgia[4].wFlags._1_1_ = 2;
        SplitOutShdefs(&local_9e);
    }
    EnsureRobotoidShdefs();
    cFlDestroyers = 0;
    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
        /* WARNING: Load size is inaccurate */
        pFVar17 = ((FLEET **)rglpfl)[ifl];
        iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar14, pFVar17);
        if ((pFVar17 == 0) && (iVar14 == 0))
            break;
        if (((pFVar17->iPlayer == idPlayer) && (iLatestDestroyer != -1)) && ((pFVar17->rgcsh[0xe] != 0 || (pFVar17->rgcsh[0xf] != 0)))) {
            cFlDestroyers = cFlDestroyers + 1;
        }
    }
    sVar8 = FShouldWeBuildColonizers(&cColFleet);
    UpdateProgressGauge(-0x39e);
    uStack_92 = (PLANET *)lpPlanets;
    uStack_90 = lpPlanets._2_2_;
    lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
    lpplMac._2_2_ = lpPlanets._2_2_;
    lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, (PLANET *)lpPlanets);
    while ((PLANET *)lppl < (PLANET *)lpplMac) {
        uVar20 = (undefined2)((ulong)lppl >> 0x10);
        if ((((PLANET *)lppl)->iPlayer != idPlayer) && (((PLANET *)lppl)->iPlayer != -1)) {
            uVar9 = (((PLANET *)lppl)->uGuesses & 0xfff) / 0xfa + 1;
            i._0_1_ = (byte)uVar9;
            if (6 < uVar9) {
                i._0_1_ = 6;
            }
            if ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) != 0) {
                i._0_1_ = (byte)i + 1;
            }
            ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 10] = (byte)i;
            ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 9] = 1;
        }
        lppl = (PLANET *)CONCAT22(uVar20, (PLANET *)lppl + 1);
    }
    for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
        /* WARNING: Load size is inaccurate */
        pPVar15 = ((PLANET **)vrglpplAi)[ipl];
        iVar14 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
        lppl = (PLANET *)CONCAT22(iVar14, pPVar15);
        if ((pPVar15 == 0) && (iVar14 == 0))
            break;
        if (((pPVar15->wFlags_0x4 >> 9 & 1) != 0) &&
            ((iVar5 = *(int *)((int)pPVar15->rgwtMin + 0xe), 0 < iVar5 || ((-1 < iVar5 && (199 < *(uint *)(pPVar15->rgwtMin + 3))))))) {
            ChangeMainObjSel(1, lppl->id);
            InitProduction(rgprod);
            fWrite = 0;
            lpprod = (PROD *)((PLPROD *)lpplProdGlob + 1);
            for (i = 0; i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac; i = i + 1) {
                uVar21 = __aFulshr(CONCAT22(*(undefined2 *)((int)&((PROD *)lpprod)->dwFlags + 2), (int)lpprod->dwFlags), 0x11);
                if (((uint)uVar21 & 7) == 2) {
                    uVar21 = __aFulshr(CONCAT22(*(undefined2 *)((int)&((PROD *)lpprod)->dwFlags + 2), (int)lpprod->dwFlags), 10);
                    if (((uint)uVar21 & 0x7f) < 0x10)
                        break;
                }
                lpprod = (PROD *)lpprod + 1;
            }
            if (i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac) {
                FinishProduction(0);
            } else {
                uVar20 = (undefined2)((ulong)vlpbAiData >> 0x10);
                if (*(int *)((byte *)vlpbAiData + 2) * 4 < *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 8) {
                    cFr = *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 8;
                } else {
                    cFr = *(int *)((byte *)vlpbAiData + 2) << 2;
                }
                if (iLatestCargo != -1) {
                    if (cExistCargo < (cFr << 3) / 10) {
                    LAB_1088_0990:
                        AddItemToQueue(iLatestCargo, 1, grobjFleet, 1);
                        fWrite = 1;
                    } else if (cExistCargo < cFr) {
                        sVar10 = Random(3);
                        if (sVar10 == 0)
                            goto LAB_1088_0990;
                    }
                }
                if (sVar8 == 0) {
                    if (cColFleet < 0x1a) {
                        sVar10 = Random(*(int *)((byte *)vlpbAiData + 2) << 3);
                        if (sVar10 == 0)
                            goto LAB_1088_09e2;
                    }
                } else {
                LAB_1088_09e2:
                    if (4 < game.turn) {
                        if (game.turn < 0x15) {
                            AddItemToQueue(1, 1, grobjFleet, 1);
                        }
                        AddItemToQueue(1, 1, grobjFleet, 1);
                        fWrite = 1;
                        sVar10 = PctTrueMaxGrowth(idPlayer);
                        uVar21 = __aFulmul(CONCAT22(*(undefined2 *)((int)pPVar15->rgwtMin + 0xe), (int)pPVar15->rgwtMin[3]), (long)sVar10);
                        l = uVar21;
                        cRes = CResourcesAtPlanet((PLANET *)CONCAT22(iVar14, pPVar15), idPlayer);
                        if (((0x8fc < l) && (0x23 < cRes)) && (0 < iAiLvl)) {
                            AddItemToQueue(1, 1, grobjFleet, 1);
                            if (((0xe10 < l) && (0x32 < cRes)) && (1 < iAiLvl)) {
                                AddItemToQueue(1, 1, grobjFleet, 1);
                            }
                        }
                    }
                }
                if (rgshdef[0].hul.ihuldef == ihuldefFrigate) {
                    sVar10 = Random(4);
                    if (sVar10 == 0) {
                        uStack_90 = lppl->id;
                        cFr = 0;
                        for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                            /* WARNING: Load size is inaccurate */
                            pFVar17 = ((FLEET **)rglpfl)[ifl];
                            iVar5 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                            lpfl = (FLEET *)CONCAT22(iVar5, pFVar17);
                            if ((pFVar17 == 0) && (iVar5 == 0))
                                break;
                            if ((pFVar17->idPlanet == uStack_90) && ((0 < pFVar17->rgcsh[0] && (pFVar17->iPlayer == idPlayer)))) {
                                cFr = pFVar17->rgcsh[0];
                                break;
                            }
                        }
                        if (cFr < 10) {
                        LAB_1088_0bc9:
                            sVar10 = Random(cFr * 2 + 1);
                            if (sVar10 == 0) {
                                AddItemToQueue(0, 4, grobjFleet, 1);
                                fWrite = 1;
                            }
                        } else if (cFr < 0x11) {
                            sVar10 = Random(10);
                            if (sVar10 == 0)
                                goto LAB_1088_0bc9;
                        }
                    }
                }
                for (i = 0; i < 3; i = i + 1) {
                    uVar9 = *(uint *)((int)(pPVar15->rgwtMin + i) + 2);
                    if (((int)uVar9 < 1) && (((int)uVar9 < 0 || (*(char **)(pPVar15->rgwtMin + i) <= (char *)"Stars!" + 2))))
                        break;
                }
                fTonsOfMinerals = (short)(i == 2);
                if (iLatestBomber != -1) {
                    uStack_90 = lppl->id;
                    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                        /* WARNING: Load size is inaccurate */
                        pFVar17 = ((FLEET **)rglpfl)[ifl];
                        iVar5 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                        lpfl = (FLEET *)CONCAT22(iVar5, pFVar17);
                        if ((pFVar17 == 0) && (iVar5 == 0))
                            break;
                        if ((pFVar17->idPlanet == uStack_90) && (pFVar17->iPlayer == idPlayer)) {
                            sVar10 = FPotentRobWarFleet((FLEET *)CONCAT22(iVar5, pFVar17), 2);
                            if (sVar10 != 0) {
                                if ((iLatestBomber != -1) &&
                                    (uVar20 = (undefined2)((ulong)lpfl >> 0x10), uStack_92 = (PLANET *)(((FLEET *)lpfl)->rgcsh[9] + ((FLEET *)lpfl)->rgcsh[10]),
                                     (int)uStack_92 < (int)(uint)vrgAiArmadaPotency[2])) {
                                    if (fTonsOfMinerals == 0) {
                                        uVar13 = 4;
                                    } else {
                                        uVar13 = 6;
                                    }
                                    AddItemToQueue(iLatestBomber, uVar13, grobjFleet, 1);
                                    fWrite = 1;
                                    goto AI_FinishProd_4;
                                }
                                break;
                            }
                        }
                    }
                }
                if (iLatestMeta != -1) {
                    uStack_92 = (PLANET *)(game.cPlanMax / 7 + 6);
                    uStack_90 = 0;
                    if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestMeta * 0x93) != 0) ||
                        (uStack_92 <= (PLANET *)*(uint *)((int)&rgshdef[0].cExist + iLatestMeta * 0x93))) {
                        sVar10 = Random(2);
                        if (sVar10 == 0)
                            goto AI_TryShip3_2;
                    }
                    if (iLatestBattle == -1) {
                    LAB_1088_0dd9:
                        uStack_90 = iLatestMeta;
                    } else {
                        sVar10 = Random(2);
                        if (sVar10 != 0)
                            goto LAB_1088_0dd9;
                        uStack_90 = iLatestBattle;
                    }
                    GetResourcesAvailable((PLANET *)CONCAT22(iVar14, pPVar15), rgResAvail);
                    GetProdQCost((PLANET *)CONCAT22(iVar14, pPVar15), rgResCost);
                    for (i = 0; i < 4; i = i + 1) {
                        uVar11 = *(uint *)(rgResCost + i);
                        iVar5 = *(int *)((int)rgResCost + i * 4 + 2);
                        puVar1 = (uint *)(rgResAvail + i);
                        uVar9 = *puVar1;
                        *puVar1 = *puVar1 - uVar11;
                        piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                        *piVar2 = (*piVar2 - iVar5) - (uint)(uVar9 < uVar11);
                        iVar5 = *(int *)((int)rgResAvail + i * 4 + 2);
                        if ((iVar5 < 1) && (iVar5 < 0))
                            goto AI_FinishProd_4;
                    }
                    GetTrueHullCost(idPlayer, (HUL *)(uStack_90 * 0x93 + rgshdef), rgCosts);
                    for (j = 0; j < 4; j = j + 1) {
                        uVar11 = (uint)(((long)(int)rgCosts[j] * 3 & 0xffffU) / 5);
                        puVar1 = (uint *)(rgResAvail + j);
                        uVar9 = *puVar1;
                        *puVar1 = *puVar1 - uVar11;
                        piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                        *piVar2 = *piVar2 - (uint)(uVar9 < uVar11);
                        iVar5 = *(int *)((int)rgResAvail + j * 4 + 2);
                        if ((iVar5 < 1) && (iVar5 < 0))
                            goto AI_TryShip3_2;
                    }
                    if (fTonsOfMinerals == 0) {
                        uVar13 = 1;
                    } else {
                        uVar13 = 5;
                    }
                    AddItemToQueue(uStack_90, uVar13, grobjFleet, 1);
                    fWrite = 1;
                }
            AI_TryShip3_2:
                if (iLatestDestroyer != -1) {
                    uStack_92 = (PLANET *)(game.cPlanMax / 0xc + 8);
                    uStack_90 = 0;
                    if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestDestroyer * 0x93) == 0) &&
                        ((PLANET *)*(uint *)((int)&rgshdef[0].cExist + iLatestDestroyer * 0x93) < uStack_92)) {
                        GetResourcesAvailable((PLANET *)CONCAT22(iVar14, pPVar15), rgResAvail);
                        GetProdQCost((PLANET *)CONCAT22(iVar14, pPVar15), rgResCost);
                        for (i = 0; i < 4; i = i + 1) {
                            uVar11 = *(uint *)(rgResCost + i);
                            iVar14 = *(int *)((int)rgResCost + i * 4 + 2);
                            puVar1 = (uint *)(rgResAvail + i);
                            uVar9 = *puVar1;
                            *puVar1 = *puVar1 - uVar11;
                            piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                            *piVar2 = (*piVar2 - iVar14) - (uint)(uVar9 < uVar11);
                            iVar14 = *(int *)((int)rgResAvail + i * 4 + 2);
                            if ((iVar14 < 1) && (iVar14 < 0))
                                goto AI_FinishProd_4;
                        }
                        for (i = 0; i < 5; i = i + 1) {
                            GetTrueHullCost(idPlayer, (HUL *)(iLatestDestroyer * 0x93 + rgshdef), rgCosts);
                            for (j = 0; j < 4; j = j + 1) {
                                uVar11 = rgCosts[j];
                                puVar1 = (uint *)(rgResAvail + j);
                                uVar9 = *puVar1;
                                *puVar1 = *puVar1 - uVar11;
                                piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                                *piVar2 = *piVar2 - (uint)(uVar9 < uVar11);
                                iVar14 = *(int *)((int)rgResAvail + j * 4 + 2);
                                if ((iVar14 < 1) && (iVar14 < 0))
                                    goto AI_FinishProd_4;
                            }
                            fWrite = 1;
                            AddItemToQueue(iLatestDestroyer, 1, grobjFleet, 1);
                        }
                    }
                }
            AI_FinishProd_4:
                FinishProduction(fWrite);
            }
        }
    }
    UpdateProgressGauge(-0x39e);
    lpflAttack._0_2_ = 0;
    lpflAttack._2_2_ = 0;
    lpflEnemy._0_2_ = 0;
    lpflEnemy._2_2_ = 0;
    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
        /* WARNING: Load size is inaccurate */
        pFVar17 = ((FLEET **)rglpfl)[ifl];
        iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar14, pFVar17);
        if ((pFVar17 == 0) && (iVar14 == 0))
            break;
        IVar12.wFlags = (ushort)local_9c.txp.rgia[4].wFlags;
        pPVar15 = uStack_92;
        if ((1 < pFVar17->cord) && ((((PLORD *)pFVar17->lpplord + 7)->wFlags >> 8 & 0xf) == 8)) {
            local_9c.txp.rgia[3].wFlags = (ITEMACTION)((&pFVar17->pt)->x - *(int *)&((PLORD *)pFVar17->lpplord)[5].iordMax);
            uStack_90 = (pFVar17->pt).y - ((PLORD *)pFVar17->lpplord + 6)->wFlags;
            uVar21 = __aFulmul((long)(int)uStack_90, (long)(int)uStack_90);
            local_9c._2_4_ = uVar21;
            uVar21 = __aFulmul((long)(int)local_9c._6_2_, (long)(int)local_9c._6_2_);
            pbVar3 = (byte *)(uVar21 + local_9c._2_4_);
            IVar12.wFlags = (ushort)pbVar3;
            pPVar15 = (PLANET *)((ulong)pbVar3 >> 0x10);
            local_9c.txp.rgia[4].wFlags._0_1_ = SUB41(pbVar3, 0);
            local_9c.txp.rgia[4].wFlags._1_1_ = (undefined1)((ulong)pbVar3 >> 8);
            uStack_92._0_1_ = (undefined1)((ulong)pbVar3 >> 0x10);
            uStack_92._1_1_ = (undefined1)((ulong)pbVar3 >> 0x18);
            if ((-1 < (long)pbVar3) && ((0 < (int)pPVar15 || ((byte *)0x9c40 < IVar12.wFlags)))) {
                ChangeMainObjSel(2, lpfl->id);
                sel.fl.cord = 1;
                ((PLORD *)sel.fl.lpplord)->iordMac = 1;
                FLookupFleet(-1, (FLEET *)&sel.fl);
                IVar12.wFlags = (ushort)CONCAT11(local_9c.txp.rgia[4].wFlags._1_1_, local_9c.txp.rgia[4].wFlags._0_1_);
                pPVar15 = (PLANET *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92);
            }
        }
        local_9c.txp.rgia[4].wFlags = (ITEMACTION)IVar12.wFlags;
        uVar20 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar17 = (FLEET *)lpfl;
        uStack_92 = pPVar15;
        if (pFVar17->iPlayer == idPlayer) {
            if (((pFVar17->rgcsh[0] < 1) || (game.turn < 0x29)) || (pFVar17->cord != 1)) {
                sVar8 = FIsAiAttack(lpfl);
                if (sVar8 == 0) {
                    sVar8 = FIsAiTransport(lpfl);
                    pPVar15 = uStack_92;
                    if (sVar8 != 0) {
                        idPlanDst = -1;
                        uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                        pFVar17 = (FLEET *)lpfl;
                        if ((pFVar17->cord < 2) || ((*(uint *)&((PLORD *)pFVar17->lpplord)[2].iordMax & 0xf) != 0)) {
                            idPlanDst = pFVar17->idPlanet;
                        } else if ((((PLORD *)pFVar17->lpplord + 7)->wFlags >> 8 & 0xf) == 1) {
                            idPlanDst = *(short *)&((PLORD *)pFVar17->lpplord)[6].iordMax;
                        }
                        if (idPlanDst != -1) {
                            lppl = LpplFromId(idPlanDst);
                            iVar14 = (int)((ulong)lppl >> 0x10);
                            pPVar15 = uStack_92;
                            if ((((PLANET *)lppl == 0) && (iVar14 == 0)) || (((PLANET *)lppl)->iPlayer != idPlayer)) {
                                uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                                if (((int)((FLEET *)lpfl)->rgwtMin[3] == 0) && (*(int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe) == 0)) {
                                    ChangeMainObjSel(2, lpfl->id);
                                    sel.fl.cord = 1;
                                    ((PLORD *)sel.fl.lpplord)->iordMac = 1;
                                    FLookupFleet(-1, (FLEET *)&sel.fl);
                                    ClearAiCurrentTask(lpfl, 0);
                                    pPVar15 = uStack_92;
                                }
                            }
                        }
                    }
                } else {
                    *(FLEET **)&((FLEET *)lpfl)->lpflNext = (FLEET *)lpflAttack;
                    *(undefined2 *)((int)&((FLEET *)lpfl)->lpflNext + 2) = lpflAttack._2_2_;
                    lpflAttack._0_2_ = (FLEET *)lpfl;
                    lpflAttack._2_2_ = lpfl._2_2_;
                    if ((*(uint *)&((PLORD *)((FLEET *)lpfl)->lpplord)[2].iordMax & 0xf) == 6) {
                        ClearAiCurrentTask(lpfl, 1);
                    }
                    pPVar7 = vlpbAiPlanet._2_2_;
                    j = 2;
                    while (true) {
                        if ((7 < j) || (0 < ((FLEET *)lpfl)->rgcsh[j]))
                            break;
                        j = j + 1;
                    }
                    pPVar15 = uStack_92;
                    if ((j < 8) && (((1 < ((FLEET *)lpfl)->cord && ((((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 8 & 0xf) == 1)) ||
                                     (((FLEET *)lpfl)->idPlanet != -1)))) {
                        if ((((FLEET *)lpfl)->cord < 2) || ((((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 8 & 0xf) != 1)) {
                            uStack_90 = ((FLEET *)lpfl)->idPlanet;
                        } else {
                            uStack_90 = *(ushort *)&((PLORD *)((FLEET *)lpfl)->lpplord)[6].iordMax;
                        }
                        pbVar16 = (byte *)vlpbAiPlanet + uStack_90 * 0x10 + 10;
                        local_9c.txp.rgia[4].wFlags._0_1_ = SUB21(pbVar16, 0);
                        local_9c.txp.rgia[4].wFlags._1_1_ = (undefined1)((uint)pbVar16 >> 8);
                        uStack_92._0_1_ = SUB21(vlpbAiPlanet._2_2_, 0);
                        uStack_92._1_1_ = (undefined1)((uint)vlpbAiPlanet._2_2_ >> 8);
                        local_9c.txp.rgia[4].wFlags = (ITEMACTION)pbVar16;
                        pPVar15 = pPVar7;
                        if (*(char *)CONCAT13(uStack_92._1_1_, CONCAT12((undefined1)uStack_92, pbVar16)) != '\0') {
                            pbVar3 = (byte *)CONCAT13(uStack_92._1_1_, CONCAT12((undefined1)uStack_92, pbVar16));
                            *pbVar3 = *pbVar3 | 0x80;
                        }
                    }
                }
            } else {
                if (6 < pFVar17->rgcsh[0]) {
                    sVar8 = Random(5);
                    pPVar15 = uStack_92;
                    if (sVar8 == 0) {
                        uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                        pt.y = (((FLEET *)lpfl)->pt).y;
                        pt.x = (&((FLEET *)lpfl)->pt)->x;
                        uVar13 = IdRandomPlanetNearby(pt, 0x69, 1);
                        pPVar15 = uStack_92;
                        if ((uVar13 != 0xffff) && (uVar13 != ((FLEET *)lpfl)->idPlanet)) {
                            ClearAiCurrentTask(lpfl, 1);
                            local_a4._4_2_ = ((POINT *)rgptPlan + uVar13)->x;
                            local_9e = *(uint *)((int)&rgptPlan[0].y + uVar13 * 4);
                            local_9c.tlm.cTimeOld = local_9c.tlm.cTimeOld & 0xe000 | 0x1140;
                            local_9c.tlm.cTime = uVar13;
                            FMoveAiFleet(lpfl, local_a4 + 4, 0);
                            pPVar15 = uStack_92;
                            goto LAB_1088_15d1;
                        }
                    }
                }
                pPVar6 = ((FLEET *)lpfl)->lpplord;
                if ((*(uint *)&((PLORD *)pPVar6)[2].iordMax & 0xf) == 0) {
                    uStack_92 = pPVar15;
                    ChangeMainObjSel(2, lpfl->id);
                    uVar20 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                    *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax = *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 6;
                    ((PLORD *)sel.fl.lpplord + 3)->wFlags = 5;
                    pbVar3 = &((PLORD *)sel.fl.lpplord)[3].iordMax;
                    pbVar3[0] = 5;
                    pbVar3[1] = 0;
                    FLookupFleet(-1, (FLEET *)&sel.fl);
                    goto LAB_1088_10bf;
                }
            }
        LAB_1088_15d1:
            uStack_92 = pPVar15;
            pFVar17 = (FLEET *)lpfl;
            uVar20 = (undefined2)((ulong)lpfl >> 0x10);
            if ((game.turn < 0x15) && (0 < pFVar17->rgcsh[0])) {
                ChangeMainObjSel(2, lpfl->id);
                uVar20 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax = *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
                FLookupFleet(-1, (FLEET *)&sel.fl);
            } else if (((pFVar17->cord < 2) && (pFVar17->rgcsh[1] != 0)) && ((4 < game.turn || (game.mdStartDist == 0)))) {
                pPVar15 = uStack_92;
                if ((1 < iAiLvl) && (pFVar17->idPlanet != -1)) {
                    pPVar22 = LpplFromId(pFVar17->idPlanet);
                    uStack_90 = (ushort)((ulong)pPVar22 >> 0x10);
                    pPVar15 = (PLANET *)pPVar22;
                    uStack_92._0_1_ = SUB41(pPVar22, 0);
                    uStack_92._1_1_ = (undefined1)((ulong)pPVar22 >> 8);
                    if ((((pPVar15 != 0) || (uStack_90 != 0)) && (pPVar15->iPlayer != -1)) && (pPVar15->iPlayer != idPlayer)) {
                        uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                        iVar14 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
                        if ((-1 < iVar14) && ((0 < iVar14 || ((int)((FLEET *)lpfl)->rgwtMin[3] != 0)))) {
                            sVar8 = GetRaceStat((PLAYER *)rgplr + pPVar15->iPlayer, rsMajorAdv);
                            pPVar15 = (PLANET *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92);
                            if (sVar8 != raMacintosh) {
                                _memset(local_a4, 0, 0x12);
                                iVar14 = *(int *)CONCAT22(uStack_90, (int *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92));
                                local_a4._0_2_ = ((POINT *)rgptPlan + iVar14)->x;
                                local_a4._2_2_ = *(short *)((int)&rgptPlan[0].y + iVar14 * 4);
                                local_a4._4_2_ = *(short *)CONCAT22(uStack_90, (short *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92));
                                local_9e = local_9e & 0xe0f0 | 0x1101;
                                local_9c.txp.rgia[3].wFlags = (ITEMACTION)(local_9c._6_2_ & 0xfff | 0x2000);
                                ChangeMainObjSel(2, lpfl->id);
                                uVar20 = sel.fl.lpplord._2_2_;
                                pPVar19 = (PLORD *)sel.fl.lpplord + 1;
                                puVar18 = local_a4;
                                for (iVar14 = 9; iVar14 != 0; iVar14 = iVar14 + -1) {
                                    pPVar6 = pPVar19;
                                    pPVar19 = &pPVar19->iordMax;
                                    puVar4 = puVar18;
                                    puVar18 = puVar18 + 1;
                                    pPVar6->wFlags = *puVar4;
                                }
                                FLookupFleet(-1, (FLEET *)&sel.fl);
                                pPVar22 = LpplFindClosestEnum((PLANET *)CONCAT22(uStack_90, (PLANET *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92)),
                                                              FEnumOurStarbase);
                                uStack_92._0_1_ = SUB41(pPVar22, 0);
                                uStack_92._1_1_ = (undefined1)((ulong)pPVar22 >> 8);
                                uStack_90 = (ushort)((ulong)pPVar22 >> 0x10);
                                if (pPVar22 != 0) {
                                    _memset(local_a4, 0, 0x12);
                                    local_a4._4_2_ = *(short *)CONCAT22(uStack_90, (short *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92));
                                    iVar14 = *(int *)CONCAT22(uStack_90, (int *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92));
                                    local_a4._0_2_ = ((POINT *)rgptPlan + iVar14)->x;
                                    local_a4._2_2_ = *(short *)((int)&rgptPlan[0].y + iVar14 * 4);
                                    local_9e = local_9e & 0xe000 | 0x1140;
                                    FMoveAiFleet(lpfl, local_a4, 0);
                                }
                                uStack_92 = (PLANET *)CONCAT11(uStack_92._1_1_, (undefined1)uStack_92);
                                goto LAB_1088_10bf;
                            }
                        }
                    }
                }
                uStack_92 = pPVar15;
                sVar8 = IdNearestColonizablePlanet(lpfl, &lpthWorm);
                if (((sVar8 == -1) && ((THING *)lpthWorm == 0)) && (lpthWorm._2_2_ == 0)) {
                    if (((FLEET *)lpfl)->idPlanet != -1) {
                        ChangeMainObjSel(2, lpfl->id);
                        uVar20 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                        *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax = *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
                        FLookupFleet(-1, (FLEET *)&sel.fl);
                    }
                } else {
                    ChangeMainObjSel(2, lpfl->id);
                    uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                    if (((FLEET *)lpfl)->idPlanet != -1) {
                        XferAiSupply(1, ((FLEET *)lpfl)->idPlanet, 2, lpfl->id, 3, 10);
                        FLookupFleet(lpfl->id, (FLEET *)&sel.fl);
                    }
                    if (sVar8 == -1) {
                        FGotoWormholeAiFleet(lpfl, (THING *)CONCAT22(lpthWorm._2_2_, (THING *)lpthWorm));
                    } else {
                        FColonizeAiFleet(lpfl, sVar8);
                    }
                }
            }
        } else {
            *(FLEET **)&pFVar17->lpflNext = (FLEET *)lpflEnemy;
            *(undefined2 *)((int)&pFVar17->lpflNext + 2) = lpflEnemy._2_2_;
            lpflEnemy._0_2_ = pFVar17;
            lpflEnemy._2_2_ = uVar20;
        }
    LAB_1088_10bf:
    }
    for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
        /* WARNING: Load size is inaccurate */
        pPVar15 = ((PLANET **)vrglpplAi)[ipl];
        iVar14 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
        lppl = (PLANET *)CONCAT22(iVar14, pPVar15);
        if (((pPVar15 == 0) && (iVar14 == 0)) || ((pPVar15->wFlags_0x4 >> 9 & 1) != 0))
            break;
    }
    if (ipl == vclpplAi) {
        lppl._0_2_ = 0;
        lppl._2_2_ = 0;
    } else {
    }
    lpplHome._0_2_ = (PLANET *)lppl;
    lpplHome._2_2_ = lppl._2_2_;
    if (((PLANET *)lppl != 0) || (lppl._2_2_ != 0)) {
        for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
            /* WARNING: Load size is inaccurate */
            pFVar17 = ((FLEET **)rglpfl)[ifl];
            iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
            lpfl = (FLEET *)CONCAT22(iVar14, pFVar17);
            if ((pFVar17 == 0) && (iVar14 == 0))
                break;
            if ((pFVar17->iPlayer == idPlayer) && (pFVar17->cord < 2)) {
                sVar8 = FIsAiTransport((FLEET *)CONCAT22(iVar14, pFVar17));
                if (sVar8 != 0) {
                    if (((FLEET *)lpfl)->iplan != 4) {
                        ChangeMainObjSel(2, lpfl->id);
                        sel.fl.iplan = 4;
                        FLookupFleet(-1, (FLEET *)&sel.fl);
                    }
                    lppl = 0;
                    i = 0;
                    while (true) {
                        uVar20 = (undefined2)((ulong)vlpbAiData >> 0x10);
                        pbVar16 = (byte *)vlpbAiData;
                        if (*(int *)(pbVar16 + 2) <= i)
                            break;
                        j = 0;
                        while ((j < *(int *)(pbVar16 + i * 0x14 + 6) && (uStack_90 = lpfl->id, *(ushort *)(pbVar16 + j * 2 + i * 0x14 + 8) != uStack_90))) {
                            j = j + 1;
                        }
                        if (j < *(int *)(pbVar16 + i * 0x14 + 6))
                            break;
                        i = i + 1;
                    }
                    if (i < *(int *)(pbVar16 + 2)) {
                        lppl = LpplFromId(*(short *)(pbVar16 + i * 0x14 + 4));
                    }
                    if (((PLANET *)lppl != 0) || (pPVar15 = (PLANET *)lpplHome, iVar14 = lpplHome._2_2_, lppl._2_2_ != 0)) {
                        pPVar15 = (PLANET *)lppl;
                        iVar14 = lppl._2_2_;
                    }
                    IdTargetFreighter(lpfl, (PLANET *)CONCAT22(iVar14, pPVar15));
                }
            }
        }
        UpdateProgressGauge(-0x39e);
    }
    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
        /* WARNING: Load size is inaccurate */
        pFVar17 = ((FLEET **)rglpfl)[ifl];
        iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar14, pFVar17);
        if ((pFVar17 == 0) && (iVar14 == 0))
            break;
        if (pFVar17->iPlayer == idPlayer) {
            for (i = 0; (i < 0x10 && ((pFVar17->rgcsh[i] < 1 || (rgRecycleShdef[i] != 0)))); i = i + 1) {
            }
            if (i == 0x10) {
                if (pFVar17->idPlanet != -1) {
                    pPVar22 = LpplFromId(pFVar17->idPlanet);
                    uVar20 = (undefined2)((ulong)pPVar22 >> 0x10);
                    if ((pPVar22 != 0) && (((PLANET *)pPVar22)->iPlayer == idPlayer)) {
                        if ((((PLANET *)pPVar22)->wFlags_0x4 >> 9 & 1) == 0) {
                            sVar8 = Random(5);
                            if (sVar8 != 0)
                                goto LAB_1088_1d52;
                        }
                        ChangeMainObjSel(2, lpfl->id);
                        uVar20 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                        *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax = *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
                        FLookupFleet(-1, (FLEET *)&sel.fl);
                        goto LAB_1088_1c04;
                    }
                }
            LAB_1088_1d52:
                uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                pFVar17 = (FLEET *)lpfl;
                if (((pFVar17->cord < 2) || (pFVar17->idPlanet != -1)) || ((((PLORD *)pFVar17->lpplord + 7)->wFlags >> 8 & 0xf) != 1)) {
                    sVar8 = FMoveToNearestStarbase(lpfl, 0);
                    if (sVar8 == 0)
                        goto LAB_1088_1da4;
                }
            } else {
            LAB_1088_1da4:
                for (i = 2; i < 0xb; i = i + 1) {
                    if (0 < ((FLEET *)lpfl)->rgcsh[i]) {
                        IdTargetArmada(lpfl);
                        break;
                    }
                }
                if (10 < i) {
                    sVar8 = FIsAiAttack(lpfl);
                    if (sVar8 != 0) {
                        uVar20 = (undefined2)((ulong)lpfl >> 0x10);
                        if ((((FLEET *)lpfl)->cord < 2) || (pPVar6 = ((FLEET *)lpfl)->lpplord, (((PLORD *)pPVar6 + 7)->wFlags >> 8 & 0xf) != 2)) {
                            if (game.turn < 0x79) {
                                iVar14 = 0x46;
                            } else {
                                iVar14 = 0x32;
                            }
                            if (iVar14 < cFlDestroyers) {
                            LAB_1088_1e81:
                                if (0x13 < ((FLEET *)lpfl)->rgcsh[iLatestDestroyer]) {
                                    sVar8 = Random(0x14);
                                    if (sVar8 != 0)
                                        goto LAB_1088_1ee3;
                                }
                                sVar8 = FFindBuddyAndJoinUp(lpfl, 0xe, 0xf, 0x24, 0x48);
                                if (sVar8 != 0)
                                    goto LAB_1088_1c04;
                            } else {
                                if (game.turn < 0x79) {
                                    iVar14 = 0x3c;
                                } else {
                                    iVar14 = 0x28;
                                }
                                if (iVar14 < cFlDestroyers) {
                                    sVar8 = Random(3);
                                    if (sVar8 == 0)
                                        goto LAB_1088_1e81;
                                }
                            }
                        LAB_1088_1ee3:
                            IdTargetAttack(lpfl, (FLEET *)CONCAT22(lpflAttack._2_2_, (FLEET *)lpflAttack),
                                           (FLEET *)CONCAT22(lpflEnemy._2_2_, (FLEET *)lpflEnemy), game.wCrap >> 4 & 1);
                        }
                    }
                }
            }
        }
    LAB_1088_1c04:
    }
    HandleBasicAiTasks(iroCur, rgprod, ishdefSBLatest, rgResAvail, rgResCost);
    FillProductionQueue();
    return;
}

// ======================================================================
// Function: EnsureRobotoidShdefs
// Address: 1088:20ae
// Segment: MEMORY_AI
// ======================================================================

void EnsureRobotoidShdefs(void)

{
    SHDEF     *pSVar1;
    HullDef   *pHVar2;
    int        iVar3;
    short      sVar4;
    SHDEF     *pSVar5;
    HullDef   *pHVar6;
    undefined2 unaff_SS;
    undefined1 local_9c[148];
    short      i;
    short      ish;

    for (ish = 0xb; ish < 0xe; ish = ish + 1) {
        if (((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) && ('\x01' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
             (local_9c._146_2_ = SEXT12(*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0)), (ish + -0xb) * 3 + 4 <= (int)local_9c._146_2_)) &&
            ((ish == 0xb || (0xe < game.turn - *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93))))) {
            if (*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) < '\n') {
                if (ish == 0xb) {
                    iVar3 = 0xe;
                } else {
                    iVar3 = 0xf;
                }
                FCreateAiShdef(ish, 0xb, (byte *)(((ushort *)vrgRobIshAip)[iVar3] + 0x1f80));
            } else {
                for (i = 0; i < 5; i = i + 1) {
                    sVar4 = Random(6);
                    sVar4 = FCreateAiShdef(ish, 0x1f, (byte *)(((ushort *)vrgRobIshAip)[sVar4 + 8] + 0x1f80));
                    if (sVar4 != 0)
                        break;
                }
            }
        }
    }
    if ((((rgshdef[0xe].wFlags >> 9 & 1) != 0) && ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
        (('\x05' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
          ((('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\x05' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
            ('\x01' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))))))) {
        for (i = 0; i < 5; i = i + 1) {
            sVar4 = FCreateAiShdef(0xe, 0x1d, (byte *)(vrgRobIshAip[0x25] + vrgRobAip));
            if (sVar4 == 0) {
                sVar4 = Random(4);
                sVar4 = FCreateAiShdef(0xe, 6, (byte *)(((ushort *)vrgRobIshAip)[sVar4 + 0x10] + 0x1f80));
                if (sVar4 != 0)
                    break;
            }
        }
    }
    if ((((rgshdef[0xf].wFlags >> 9 & 1) != 0) && ('\t' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
        ((('\a' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
           (('\b' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0) && ('\r' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))))) &&
          (sVar4 = FCreateAiShdef(0xf, 0x1d, (byte *)(vrgRobIshAip[0x25] + vrgRobAip)), sVar4 == 0)))) {
        for (i = 0; i < 5; i = i + 1) {
            sVar4 = Random(4);
            sVar4 = FCreateAiShdef(0xf, 6, (byte *)(((ushort *)vrgRobIshAip)[sVar4 + 0x14] + 0x1f80));
            if (sVar4 != 0)
                break;
        }
    }
    for (ish = 2; ish < 6; ish = ish + 1) {
        if (((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) && ('\t' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
             ('\t' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) &&
            ((('\b' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0) && ('\x05' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))) &&
              ((ish == 2 || (((*(uint *)((int)&rgshdef[0].wFlags + (ish + -1) * 0x93) >> 9 & 1) == 0 &&
                              (0xc < game.turn - *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93))))))))) {
            if ((ish - 2U & 1) == 0) {
                local_9c._146_2_ = 0;
            } else {
                local_9c._146_2_ = 4;
            }
            for (i = 0; i < 5; i = i + 1) {
                sVar4 = Random(4);
                sVar4 = FCreateAiShdef(ish, 0x1f, (byte *)(((ushort *)vrgRobIshAip)[sVar4 + local_9c._146_2_] + 0x1f80));
                if (sVar4 != 0)
                    break;
            }
        }
    }
    ish = 6;
    do {
        if (7 < ish) {
            for (ish = 9; ish < 0xb; ish = ish + 1) {
                if (((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) && ('\r' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
                     ((ish == 9 || (((*(uint *)((int)&rgshdef[0].wFlags + (ish + -1) * 0x93) >> 9 & 1) == 0 &&
                                     (0xf < game.turn - *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93))))))) &&
                    (sVar4 = FCreateAiShdef(ish, 9, (byte *)(vrgRobIshAip[0x24] + vrgRobAip)), sVar4 == 0)) {
                    if (ish == 9) {
                        iVar3 = 0x18;
                    } else {
                        iVar3 = 0x19;
                    }
                    FCreateAiShdef(ish, 0x13, (byte *)(((ushort *)vrgRobIshAip)[iVar3] + 0x1f80));
                }
            }
            if ((((((rgshdef[0].hul.ihuldef != ihuldefFrigate) && (1 < (*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7))) &&
                   ((int)rgshdef[0].cExist == 0)) &&
                  ((rgshdef[0].cExist._2_2_ == 0 && ('\x03' < *(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0))))) &&
                 (('\x04' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
                   (('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\x05' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) &&
                ('\x05' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))) {
                pSVar5 = (SHDEF *)rgshdef;
                pHVar6 = local_9c;
                for (iVar3 = 0x49; iVar3 != 0; iVar3 = iVar3 + -1) {
                    pHVar2 = pHVar6;
                    pHVar6 = pHVar6 + 1;
                    pSVar1 = pSVar5;
                    pSVar5 = (pSVar5->hul).rgTech;
                    *pHVar2 = (pSVar1->hul).ihuldef;
                }
                *(char *)pHVar6 = (char)(pSVar5->hul).ihuldef;
                local_9c._123_2_ = local_9c._123_2_ & 0xfdff | 0x200;
                FChangeAiShdef(local_9c, 0);
                FCreateAiShdef(0, 5, (byte *)(vrgRobIshAip[0x1a] + vrgRobAip));
            }
            return;
        }
        if (((((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) && ('\x03' < *(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0))) &&
               ('\t' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
              (('\v' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\v' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))) &&
             ('\x05' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))) &&
            (('\x0e' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0) &&
              ((ish == 6 || (((*(uint *)((int)&rgshdef[0].wFlags + (ish + -1) * 0x93) >> 9 & 1) == 0 &&
                              (0x14 < game.turn - *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93))))))))) {
            if (ish == 6) {
                local_9c._146_2_ = 0x1b;
            } else {
                local_9c._146_2_ = 0x1f;
            }
            for (i = 0; i < 5; i = i + 1) {
                sVar4 = Random(4);
                sVar4 = FCreateAiShdef(ish, 9, (byte *)(((ushort *)vrgRobIshAip)[sVar4 + local_9c._146_2_] + 0x1f80));
                if (sVar4 != 0)
                    break;
            }
        }
        ish = ish + 1;
    } while (true);
}

// ======================================================================
// Function: IdTargetArmada
// Address: 1088:288e
// Segment: MEMORY_AI
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10883131) */
/* WARNING: Removing unreachable block (ram,0x1088304d) */
/* WARNING: Removing unreachable block (ram,0x10883007) */
/* WARNING: Removing unreachable block (ram,0x108828ed) */
/* WARNING: Removing unreachable block (ram,0x10882b7b) */
/* WARNING: Removing unreachable block (ram,0x1088301d) */
/* WARNING: Removing unreachable block (ram,0x108830bb) */
/* WARNING: Removing unreachable block (ram,0x1088316e) */

short IdTargetArmada(FLEET *lpfl)

{
    short     *psVar1;
    ORDER     *pOVar2;
    uint       uVar3;
    POINT      pt1;
    POINT      pt2;
    PLANET    *pPVar4;
    int        iVar5;
    short      sVar6;
    int        iVar7;
    int        iVar8;
    FLEET     *pFVar9;
    short     *psVar10;
    ORDER     *pOVar11;
    undefined2 uVar12;
    undefined2 unaff_SS;
    PLANET    *pPVar13;
    FLEET     *pFVar14;
    ulong      uVar15;
    ulong      uVar16;
    long       lVar17;
    long       lVar18;
    long       lVar19;
    undefined2 uVar20;
    undefined2 uVar21;
    long       cXfer;
    long       lPopEnemy;
    long       lPopUs;
    long       pctDef;
    short      cshBomb;
    long       cCol;
    PLANET    *lppl;
    short      ish;
    ORDER      ord;
    PLANET    *lpplTarget;
    FLEET     *lpflTarget;
    short      cshWar;

    uVar12 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar9 = (FLEET *)lpfl;
    if (1 < pFVar9->cord) {
        uVar20 = *(undefined2 *)((int)&pFVar9->lpplord + 2);
        psVar10 = (short *)(*(int *)&pFVar9->lpplord + 0x16);
        pOVar11 = &ord;
        for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
            pOVar2 = pOVar11;
            pOVar11 = &(pOVar11->pt).y;
            psVar1 = psVar10;
            psVar10 = psVar10 + 1;
            (pOVar2->pt).x = *psVar1;
        }
        pt1.y = (pFVar9->pt).y;
        pt1.x = (&pFVar9->pt)->x;
        pt2.y = ord.pt.y;
        pt2.x = ord.pt.x;
        lVar17 = LDistance2(pt1, pt2);
        if ((lVar17 < 0xf425) || ((ord.wFlags_0x6 >> 8 & 0xf) != 2)) {
            if ((ord.wFlags_0x6 >> 8 & 0xf) == 2) {
                return 0;
            }
            if ((ord.wFlags_0x6 >> 8 & 0xf) == 1) {
                pPVar13 = LpplFromId(ord.id);
                iVar5 = (int)((ulong)pPVar13 >> 0x10);
                pPVar4 = (PLANET *)pPVar13;
                if ((((pPVar4 == 0) && (iVar5 == 0)) || ((pPVar4->iPlayer != -1 && ((pPVar4->iPlayer != idPlayer || ((pPVar4->wFlags_0x4 >> 9 & 1) != 0)))))) ||
                    (pPVar4->turn != game.turn)) {
                    return 0;
                }
            }
        }
    }
    cshWar = 0;
    for (ish = 2; ish < 6; ish = ish + 1) {
        cshWar = cshWar + pFVar9->rgcsh[ish];
    }
    for (ish = 6; ish < 8; ish = ish + 1) {
        cshWar = cshWar + pFVar9->rgcsh[ish] * 2;
    }
    iVar5 = pFVar9->rgcsh[9] + pFVar9->rgcsh[10];
    pFVar9->wFlags_0x4 = pFVar9->wFlags_0x4 & 0x7fff | 0x8000;
    ChangeMainObjSel(2, lpfl->id);
    if (pFVar9->idPlanet == -1) {
        MoveToNearestPlanetOrEnemy(lpfl, 0x96);
        return 0;
    }
    pPVar13 = LpplFromId(pFVar9->idPlanet);
    uVar20 = (undefined2)((ulong)pPVar13 >> 0x10);
    pPVar4 = (PLANET *)pPVar13;
    if ((pPVar4->iPlayer == idPlayer) && ((pPVar4->wFlags_0x4 >> 9 & 1) != 0)) {
        if ((cshWar < (int)(uint)vrgAiArmadaPotency[0]) || (iVar5 < (int)(uint)vrgAiArmadaPotency[2])) {
            if ((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) < 2) {
                return 0;
            }
            if ((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 2)) && (cshWar < 0x3c)) {
                return 0;
            }
            sVar6 = Random(10);
            if ((4 < sVar6) && ((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 3) || (sVar6 = Random(10), 6 < sVar6)))) {
                if (cshWar < 0x79) {
                    return 0;
                }
                sVar6 = Random(10);
                if (6 < sVar6) {
                    return 0;
                }
            }
        } else {
            if ((sel.pl.rgwtMin[3]._2_2_ < 0) || ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((uint)sel.pl.rgwtMin[3] < 0xbb9)))) {
                if ((sel.pl.rgwtMin[3]._2_2_ < 0) || ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((uint)sel.pl.rgwtMin[3] < 0x7d1)))) {
                    if ((sel.pl.rgwtMin[3]._2_2_ < 0) || ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((uint)sel.pl.rgwtMin[3] < 0x3e9)))) {
                        lVar17 = 0;
                    } else {
                        lVar17 = __aFldiv(CONCAT22(sel.pl.rgwtMin[3]._2_2_, (uint)sel.pl.rgwtMin[3]), 0x14);
                    }
                } else {
                    lVar17 = __aFldiv(CONCAT22(sel.pl.rgwtMin[3]._2_2_, (uint)sel.pl.rgwtMin[3]), 0xf);
                }
            } else {
                lVar17 = __aFldiv(CONCAT22(sel.pl.rgwtMin[3]._2_2_, (uint)sel.pl.rgwtMin[3]), 10);
            }
            cCol._0_2_ = (short)lVar17;
            if (0 < lVar17) {
                XferAiSupply(1, pFVar9->idPlanet, 2, lpfl->id, 3, (short)cCol);
                FLookupFleet(lpfl->id, (FLEET *)&sel.fl);
            }
        }
    } else if ((cshWar < (int)(uint)vrgAiArmadaPotency[1]) || (iVar5 < (int)(uint)vrgAiArmadaPotency[3])) {
        ClearAiCurrentTask(lpfl, 0);
        if (((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) < 2) ||
            ((((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 2) || (sVar6 = Random(10), 4 < sVar6)) &&
               ((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 4) || (sVar6 = Random(10), 6 < sVar6)))) &&
              ((cshWar < 0x79 || (sVar6 = Random(10), 6 < sVar6)))))) {
            lpplTarget = LpplFindClosestEnum(pPVar13, FEnumOurStarbase);
            goto AI_TargetEveryArmada_3;
        }
    } else if (pPVar4->iPlayer != -1) {
        if (pPVar4->iPlayer != idPlayer) {
            if (pPVar4->iPlayer == idPlayer) {
                return 0;
            }
            uVar3 = *(uint *)(pFVar9->rgwtMin + 3);
            iVar5 = *(int *)((int)pFVar9->rgwtMin + 0xe);
            uVar15 = __aFlshl((ulong)(pPVar4->uGuesses & 0xfff), 2);
            uVar16 = __aFulmul((ulong)(pPVar4->uGuesses >> 0xc), 6);
            uVar21 = 0;
            uVar20 = 4;
            uVar16 = __aFulmul(uVar16 + 6, 3);
            lVar17 = __aFldiv(uVar16, CONCAT22(uVar21, uVar20));
            iVar7 = 100 - (uint)lVar17;
            iVar8 = -(uint)(100 < (uint)lVar17) - (int)((ulong)lVar17 >> 0x10);
            uVar15 = __aFulmul(uVar15, 100);
            uVar15 = __aFldiv(uVar15, CONCAT22(iVar8, iVar7));
            lVar17 = __aFldiv(CONCAT22(iVar5, uVar3), 5);
            if ((lVar17 <= (long)uVar15) && ((199 < (long)uVar15 || ((iVar5 < 1 && ((iVar5 < 0 || (uVar3 < 0x15f)))))))) {
                if (9 < (long)uVar15) {
                    return 0;
                }
                if (iVar5 < 0) {
                    return 0;
                }
                if ((iVar5 < 1) && (uVar3 < 0x97)) {
                    return 0;
                }
            }
            uVar21 = 0;
            uVar20 = 4;
            uVar15 = __aFulmul(uVar15, 5);
            lVar18 = __aFldiv(uVar15, CONCAT22(uVar21, uVar20));
            lVar19 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe), (int)pFVar9->rgwtMin[3]), 2);
            lVar17 = lVar18;
            if (lVar18 <= lVar19) {
                lVar17 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe), (int)pFVar9->rgwtMin[3]), 2);
            }
            iVar7 = (int)((ulong)lVar17 >> 0x10);
            iVar5 = *(int *)((int)pFVar9->rgwtMin + 0xe);
            if ((iVar7 < iVar5) || ((iVar7 <= iVar5 && ((uint)lVar17 <= *(uint *)(pFVar9->rgwtMin + 3))))) {
                lVar17 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe), (int)pFVar9->rgwtMin[3]), 2);
                if (lVar18 <= lVar17) {
                    lVar18 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe), (int)pFVar9->rgwtMin[3]), 2);
                }
            } else {
                lVar18 = CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe), (int)pFVar9->rgwtMin[3]);
            }
            if (30000 < lVar18) {
                lVar18 = 30000;
            }
            cXfer._0_2_ = (short)lVar18;
            XferAiTroopers(lpfl->id, pPVar13->id, (short)cXfer);
            FLookupFleet(lpfl->id, (FLEET *)&sel.fl);
            return 0;
        }
        iVar5 = *(int *)((int)pPVar4->rgwtMin + 0xe);
        if ((-1 < iVar5) && ((0 < iVar5 || (1000 < *(uint *)(pPVar4->rgwtMin + 3))))) {
            XferAiSupply(1, pFVar9->idPlanet, 2, lpfl->id, 3, (int)pPVar4->rgwtMin[3] / 5);
            FLookupFleet(lpfl->id, (FLEET *)&sel.fl);
        }
    }
    if ((game.wCrap >> 4 & 1) == 0) {
        lpplTarget = 0;
    } else {
        lpplTarget = LpplFindBestEnum(pPVar13, FEnumCalcArmadaHumanDest);
    }
    if (((PLANET *)lpplTarget == 0) && (lpplTarget._2_2_ == 0)) {
        lpplTarget = LpplFindBestEnum(pPVar13, FEnumCalcArmadaDest);
    }
AI_TargetEveryArmada_3:
    if (((PLANET *)lpplTarget == 0) && (lpplTarget._2_2_ == 0)) {
        pFVar14 = LpflFindClosestEnum(lpfl, FEnumCalcEnemyFleets);
        iVar5 = (int)((ulong)pFVar14 >> 0x10);
        pFVar9 = (FLEET *)pFVar14;
        if ((pFVar9 == 0) && (iVar5 == 0)) {
            return 0;
        }
        ord.id = pFVar14->id;
        ord.wFlags_0x6 = ord.wFlags_0x6 & 0xf0ff | 0x200;
        ord.pt.x = (&pFVar9->pt)->x;
        ord.pt.y = (pFVar9->pt).y;
    } else {
        ((byte *)vlpbAiPlanet)[lpplTarget->id * 0x10 + 10] = ((byte *)vlpbAiPlanet)[lpplTarget->id * 0x10 + 10] | 0x80;
        ord.id = lpplTarget->id;
        ord.wFlags_0x6 = ord.wFlags_0x6 & 0xf0ff | 0x100;
        ord.pt.x = ((POINT *)rgptPlan + lpplTarget->id)->x;
        ord.pt.y = *(short *)((int)&rgptPlan[0].y + lpplTarget->id * 4);
    }
    ord.wFlags_0x6 = ord.wFlags_0x6 & 0xef00 | 0x1040;
    sVar6 = FMoveAiFleet(lpfl, &ord, 0);
    if (sVar6 != 0) {
        return 0;
    }
    return -1;
}

// ======================================================================
// Function: FPotentRobWarFleet
// Address: 1088:31bc
// Segment: MEMORY_AI
// ======================================================================

short FPotentRobWarFleet(FLEET *lpfl, short iPotency)

{
    uint  uVar1;
    short cEquiv;
    short ish;

    cEquiv = 0;
    ish = 2;
    while (true) {
        if (5 < ish)
            break;
        cEquiv = cEquiv + ((FLEET *)lpfl)->rgcsh[ish];
        ish = ish + 1;
    }
    for (ish = 6; ish < 8; ish = ish + 1) {
        cEquiv = cEquiv + ((FLEET *)lpfl)->rgcsh[ish] * 2;
    }
    if (iPotency < 2) {
        uVar1 = 1;
    } else {
        uVar1 = (uint)((int)(uint)vrgAiArmadaPotency[0] <= cEquiv);
    }
    return uVar1;
}

// ======================================================================
// Function: FEnumCalcEnemyFleets
// Address: 1088:325c
// Segment: MEMORY_AI
// ======================================================================

short FEnumCalcEnemyFleets(FLEET *lpflSrc, FLEET *lpflTest)

{
    return (uint)(((FLEET *)lpflTest)->iPlayer != idPlayer);
}

// ======================================================================
// Function: FEnumCalcArmadaDest
// Address: 1088:3286
// Segment: MEMORY_AI
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x1088339e) */
/* WARNING: Removing unreachable block (ram,0x10883360) */
/* WARNING: Removing unreachable block (ram,0x10883322) */
/* WARNING: Removing unreachable block (ram,0x10883341) */
/* WARNING: Removing unreachable block (ram,0x1088337f) */
/* WARNING: Removing unreachable block (ram,0x108833bd) */

short FEnumCalcArmadaDest(PLANET *lpplSrc, PLANET *lpplTest)

{
    short sVar1;
    long  lVar2;
    POINT pt1;
    POINT pt2;
    long  l2;
    byte  b;
    short id;

    if ((((PLANET *)lpplSrc != (PLANET *)lpplTest) || (lpplSrc._2_2_ != lpplTest._2_2_)) && (b = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 10], b != 0)) {
        pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
        pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
        pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
        pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
        lVar2 = LDistance2(pt1, pt2);
        if (lVar2 < 0x9c4) {
            b = b + 7;
        } else if (lVar2 < 10000) {
            b = b + 5;
        } else if (lVar2 < 0x57e4) {
            b = b + 4;
        } else if (lVar2 < 40000) {
            b = b + 3;
        } else if (lVar2 < 90000) {
            b = b + 2;
        } else if (lVar2 < 250000) {
            b = b + 1;
        }
        if (((b & 0x80) == 0) || (sVar1 = Random(4), sVar1 == 0)) {
            return (uint)b;
        }
    }
    return 0;
}

// ======================================================================
// Function: FEnumCalcArmadaHumanDest
// Address: 1088:3406
// Segment: MEMORY_AI
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10883546) */
/* WARNING: Removing unreachable block (ram,0x10883508) */
/* WARNING: Removing unreachable block (ram,0x108834ca) */
/* WARNING: Removing unreachable block (ram,0x108834e9) */
/* WARNING: Removing unreachable block (ram,0x10883527) */
/* WARNING: Removing unreachable block (ram,0x10883565) */

short FEnumCalcArmadaHumanDest(PLANET *lpplSrc, PLANET *lpplTest)

{
    short sVar1;
    long  lVar2;
    POINT pt1;
    POINT pt2;
    long  l2;
    byte  b;
    short id;

    if (((((PLANET *)lpplSrc != (PLANET *)lpplTest) || (lpplSrc._2_2_ != lpplTest._2_2_)) &&
         ((*(uint *)((int)&rgplr[0].wMdPlr + ((PLANET *)lpplTest)->iPlayer * 0xc0) >> 9 & 1) == 0)) &&
        (b = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 10], b != 0)) {
        pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
        pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
        pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
        pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
        lVar2 = LDistance2(pt1, pt2);
        if (lVar2 < 0x9c4) {
            b = b + 7;
        } else if (lVar2 < 10000) {
            b = b + 5;
        } else if (lVar2 < 0x57e4) {
            b = b + 4;
        } else if (lVar2 < 40000) {
            b = b + 3;
        } else if (lVar2 < 90000) {
            b = b + 2;
        } else if (lVar2 < 250000) {
            b = b + 1;
        }
        if (((b & 0x80) == 0) || (sVar1 = Random(4), sVar1 == 0)) {
            return (uint)b;
        }
    }
    return 0;
}

// ======================================================================
// Function: DoTurinDroneAiTurn
// Address: 1088:3670
// Segment: MEMORY_AI
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10883d92) */
/* WARNING: Removing unreachable block (ram,0x10883db8) */
/* WARNING: Removing unreachable block (ram,0x10883fc0) */
/* WARNING: Removing unreachable block (ram,0x10883db3) */
/* WARNING: Removing unreachable block (ram,0x1088442c) */
/* WARNING: Removing unreachable block (ram,0x108845a2) */
/* WARNING: Removing unreachable block (ram,0x108842b4) */
/* WARNING: Removing unreachable block (ram,0x10883e88) */
/* WARNING: Removing unreachable block (ram,0x1088472b) */
/* WARNING: Removing unreachable block (ram,0x10883eb7) */

void DoTurinDroneAiTurn(PROD *rgprod)

{
    uint      *puVar1;
    int       *piVar2;
    byte      *pbVar3;
    ORDER     *pOVar4;
    PLORD     *pPVar5;
    int        iVar6;
    uint       uVar7;
    byte       bVar8;
    short      sVar9;
    uint       uVar10;
    int        iVar11;
    PLANET    *pPVar12;
    PROD      *pPVar13;
    PLORD     *pPVar14;
    FLEET     *pFVar15;
    byte      *pbVar16;
    ORDER     *pOVar17;
    undefined2 uVar18;
    long       lVar19;
    ulong      uVar20;
    ulong      uVar21;
    PLANET    *pPVar22;
    short      iPlanet;
    short      fWrite;
    PROD      *lpprod;
    long       l;
    short      iLatestBomber;
    short      iLatestBattle;
    short      cplBadGuy;
    short      cFr;
    ushort     cplanCol;
    ushort     cRecyclePeriod;
    short      ipl;
    short      cplNegative;
    short      ishdefSBLatest;
    PLANET    *lpplMac;
    short      cplMiners;
    short      iLatestCargo;
    short      iLatestMiner;
    short      iroCur;
    short      cRes;
    byte       b;
    FLEET     *lpflT;
    short      i;
    short      ifl;
    FLEET     *lpfl;
    FLEET     *lpflAttack;
    PLANET    *lpplHome;
    ushort     rgCosts[4];
    short      iLatestTroop;
    PLANET    *lppl;
    ORDER      ord;
    short      iLatestLayer;
    short      j;
    short      idPlanDst;
    byte       rgRecycleShdef[16];
    PLANET    *lpplDest;
    THING     *lpthWorm;
    short      iLatestDestroyer;
    short      cExistCargo;
    FLEET     *lpflEnemy;
    long       rgResAvail[4];
    short      iLatestCruiser;
    long       rgResCost[4];

    cplBadGuy = 0;
    cplNegative = 0;
    cplanCol = 0;
    cplMiners = 0;
    iroCur = IroEnsureAi(vrgAiTurinDroneResOrder, 0x1f, &ishdefSBLatest, 0xf);
    if ((rgshdef[0xd].wFlags >> 9 & 1) == 0) {
        MergeAllShdefs(-0x1f10);
    }
    if ((rgshdef[0xc].wFlags >> 9 & 1) == 0) {
        MergeAllShdefs(0x1000);
    }
    if ((rgshdef[10].wFlags >> 9 & 1) == 0) {
        MergeAllShdefs(0xc00);
    }
    if ((rgshdef[2].wFlags >> 9 & 1) == 0) {
        MergeAllShdefs(0xc);
    }
    j = 3;
    if (0x82 < game.turn) {
        j = (game.turn - 0x78) / 0x14 + 3;
    }
    if (0x32 < (uint)j) {
        j = 0x32;
    }
    vrgAiArmadaPotency[0] = (byte)j;
    vrgAiArmadaPotency[1] = (byte)((ulong)(j & 0xff) / 2);
    j = 6;
    if (0x73 < game.turn) {
        j = (game.turn - 100) / 0x16 + 6;
    }
    if (0xc < (uint)j) {
        j = 0xc;
    }
    vrgAiArmadaPotency[2] = (byte)j;
    if ((int)((uint)j / 2 - 1) < 4) {
        vrgAiArmadaPotency[3] = (char)((uint)j / 2) - 1;
    } else {
        vrgAiArmadaPotency[3] = 3;
    }
    _memset(rgRecycleShdef, 0, 0x10);
    if (game.turn < 0x78) {
        cRecyclePeriod = 0x32;
    } else if (game.turn < 200) {
        cRecyclePeriod = 0x46;
    } else {
        cRecyclePeriod = 100;
    }
    CheckAiShdefStatus(6, 7, cRecyclePeriod, &iLatestCruiser, rgRecycleShdef);
    cExistCargo = CheckAiShdefStatus(8, 9, cRecyclePeriod, &iLatestCargo, rgRecycleShdef);
    CheckAiShdefStatus(0xd, 0xe, cRecyclePeriod, &iLatestBomber, rgRecycleShdef);
    CheckAiShdefStatus(4, 5, cRecyclePeriod, &iLatestBattle, rgRecycleShdef);
    CheckAiShdefStatus(0xc, 0xc, cRecyclePeriod, &iLatestLayer, rgRecycleShdef);
    CheckAiShdefStatus(0xf, 0xf, cRecyclePeriod, &iLatestTroop, rgRecycleShdef);
    if (*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) < '\a') {
        iLatestMiner = -1;
    } else {
        CheckAiShdefStatus(2, 3, cRecyclePeriod, &iLatestMiner, rgRecycleShdef);
    }
    CheckAiShdefStatus(10, 0xb, cRecyclePeriod, &iLatestDestroyer, rgRecycleShdef);
    if (0x3c < game.turn) {
        SplitOutShdefs(rgRecycleShdef);
    }
    EnsureTurinDroneShdefs(iroCur);
    lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
    lpplMac._2_2_ = lpPlanets._2_2_;
    lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, (PLANET *)lpPlanets);
    while ((PLANET *)lppl < (PLANET *)lpplMac) {
        uVar18 = (undefined2)((ulong)lppl >> 0x10);
        if (((((PLANET *)lppl)->iPlayer == -1) && (2 < (((PLANET *)lppl)->wFlags_0x4 & 0xff))) && (sVar9 = PctPlanetOptValue(lppl, idPlayer), 0 < sVar9)) {
            cplanCol = cplanCol + 1;
        }
        lppl = (PLANET *)lppl + 1;
    }
    lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
    lpplMac._2_2_ = lpPlanets._2_2_;
    lppl = (PLANET *)CONCAT22(lpPlanets._2_2_, (PLANET *)lpPlanets);
    while ((PLANET *)lppl < (PLANET *)lpplMac) {
        ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 9] = 1;
        uVar18 = (undefined2)((ulong)lppl >> 0x10);
        if ((((PLANET *)lppl)->iPlayer == -1) && (2 < (((PLANET *)lppl)->wFlags_0x4 & 0xff))) {
            b = 0;
            for (i = 0; i < 3; i = i + 1) {
                if (((PLANET *)lppl)->rgMinConc[i] < 0x43) {
                    bVar8 = ((PLANET *)lppl)->rgMinConc[i] / 2;
                } else {
                    bVar8 = 0x4b;
                }
                b = b + bVar8;
            }
            if ((b & 0x80) != 0) {
                b = 0x7f;
            }
            ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 1] = b;
            cplMiners = cplMiners + 1;
        }
        if ((((PLANET *)lppl)->iPlayer == idPlayer) || (((PLANET *)lppl)->iPlayer == -1)) {
            if (((PLANET *)lppl)->iPlayer == idPlayer) {
                sVar9 = PctPlanetDesirability(lppl, idPlayer);
                if (sVar9 < 0) {
                    cplNegative = cplNegative + 1;
                    ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 2] = 1;
                } else {
                    uVar18 = (undefined2)((ulong)lppl >> 0x10);
                    pPVar12 = (PLANET *)lppl;
                    if (((pPVar12->wFlags_0x4 >> 9 & 1) == 0) ||
                        ((iVar11 = *(int *)((int)pPVar12->rgwtMin + 0xe), iVar11 < 1 && ((iVar11 < 0 || (*(uint *)(pPVar12->rgwtMin + 3) < 200)))))) {
                        ChangeMainObjSel(1, lppl->id);
                        uVar18 = (undefined2)((ulong)lppl >> 0x10);
                        iVar11 = *(int *)((int)((PLANET *)lppl)->rgwtMin + 0xe);
                        if ((iVar11 < 1) && ((iVar11 < 0 || (*(uint *)(((PLANET *)lppl)->rgwtMin + 3) < 200)))) {
                            uVar10 = 1;
                        } else {
                            uVar10 = 0;
                        }
                        lVar19 = __aFlshl((ulong)uVar10, 0x17);
                        sel.pl.rgbImp._4_2_ = sel.pl.rgbImp._4_2_ | (uint)lVar19;
                        sel.pl.rgbImp._6_2_ = sel.pl.rgbImp._6_2_ & 0xff7f | (uint)((ulong)lVar19 >> 0x10);
                        uVar20 = __aFulshr(CONCAT22(sel.pl.rgbImp._6_2_, sel.pl.rgbImp._4_2_), 0x17);
                        uVar18 = (undefined2)((ulong)lppl >> 0x10);
                        uVar21 = __aFulshr(CONCAT22(*(undefined2 *)(((PLANET *)lppl)->rgbImp + 6), *(undefined2 *)(((PLANET *)lppl)->rgbImp + 4)), 0x17);
                        if (((uint)uVar20 & 1) != ((uint)uVar21 & 1)) {
                            FLookupPlanet(-1, (PLANET *)&sel.pl);
                        }
                    } else {
                        ChangeMainObjSel(1, lppl->id);
                        InitProduction(rgprod);
                        fWrite = 0;
                        b = 0;
                        lpprod = (PROD *)((PLPROD *)lpplProdGlob + 1);
                        for (i = 0; i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac; i = i + 1) {
                            uVar18 = (undefined2)((ulong)lpprod >> 0x10);
                            pPVar13 = (PROD *)lpprod;
                            uVar20 = __aFulshr(CONCAT22(*(undefined2 *)((int)&pPVar13->dwFlags + 2), (int)lpprod->dwFlags), 0x11);
                            if ((((uint)uVar20 & 7) == 2) &&
                                (uVar20 = __aFulshr(CONCAT22(*(undefined2 *)((int)&pPVar13->dwFlags + 2), (int)lpprod->dwFlags), 10),
                                 ((uint)uVar20 & 0x7f) < 0x10))
                                break;
                            lpprod = (PROD *)CONCAT22(uVar18, pPVar13 + 1);
                        }
                        if (i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac) {
                            FinishProduction(0);
                        } else {
                            if (game.turn == 0) {
                                i = game.cPlanMax;
                                while (0 < i) {
                                    AddItemToQueue(0, 1, grobjFleet, 1);
                                    if (i < 0xbf) {
                                        i = i + -0x1e;
                                    } else {
                                        i = i + -100;
                                    }
                                    fWrite = 1;
                                }
                            } else if (((rgshdef[0].wFlags >> 9 & 1) == 0) && (rgshdef[0].hul.ihuldef == ihuldefFrigate)) {
                                if (game.cPlanMax / 4 < 0x20) {
                                    uVar10 = game.cPlanMax / 4;
                                } else {
                                    uVar10 = 0x20;
                                }
                                if (((rgshdef[0].cExist._2_2_ == 0) && ((uint)rgshdef[0].cExist < uVar10)) &&
                                    (uVar20 = __aFuldiv(CONCAT22(rgshdef[0].cBuilt._2_2_, (undefined2)rgshdef[0].cBuilt), 10),
                                     uVar20 < CONCAT22(rgshdef[0].cExist._2_2_, (uint)rgshdef[0].cExist))) {
                                    AddItemToQueue(0, 1, grobjFleet, 1);
                                    fWrite = 1;
                                }
                            }
                            uVar18 = (undefined2)((ulong)vlpbAiData >> 0x10);
                            if (*(int *)((byte *)vlpbAiData + 2) * 2 < *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 10) {
                                cFr = *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 10;
                            } else {
                                cFr = *(int *)((byte *)vlpbAiData + 2) << 1;
                            }
                            if ((('\x04' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0)) && (iLatestCargo != -1)) &&
                                ((cExistCargo < cFr || ((cExistCargo < (cFr * 10) / 7 && (sVar9 = Random(4), sVar9 == 0)))))) {
                                AddItemToQueue(iLatestCargo, 1, grobjFleet, 1);
                                fWrite = 1;
                            }
                            if ((((cplanCol != 0) || (cplBadGuy != 0)) && (rgshdef[1].cExist._2_2_ == 0)) && ((uint)rgshdef[1].cExist < 2)) {
                                AddItemToQueue(1, 1, grobjFleet, 1);
                                AddItemToQueue(1, 1, grobjFleet, 1);
                                AddItemToQueue(1, 1, grobjFleet, 1);
                                AddItemToQueue(1, 1, grobjFleet, 1);
                                fWrite = 1;
                            }
                            sVar9 = PctTrueMaxGrowth(idPlayer);
                            uVar18 = (undefined2)((ulong)lppl >> 0x10);
                            __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe), (int)((PLANET *)lppl)->rgwtMin[3]), (long)sVar9);
                            cRes = CResourcesAtPlanet(lppl, idPlayer);
                            if (((rgshdef[0xc].wFlags >> 9 & 1) == 0) && (sVar9 = Random(3), sVar9 == 0)) {
                                cFr = 0;
                                for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                                    /* WARNING: Load size is inaccurate */
                                    pFVar15 = ((FLEET **)rglpfl)[ifl];
                                    iVar11 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                                    lpfl = (FLEET *)CONCAT22(iVar11, pFVar15);
                                    if ((pFVar15 == 0) && (iVar11 == 0))
                                        break;
                                    if ((pFVar15->idPlanet == lppl->id) && ((0 < pFVar15->rgcsh[0xc] && (pFVar15->iPlayer == idPlayer)))) {
                                        cFr = pFVar15->rgcsh[0xc];
                                        break;
                                    }
                                }
                                if (((cFr < 10) || ((cFr < 0x11 && (sVar9 = Random(8), sVar9 == 0)))) && (sVar9 = Random(cFr * 2 + 1), sVar9 == 0)) {
                                    AddItemToQueue(0xc, 3, grobjFleet, 1);
                                    fWrite = 1;
                                }
                            }
                            if (iLatestBomber != -1) {
                                iVar11 = lppl->id;
                                for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                                    /* WARNING: Load size is inaccurate */
                                    pFVar15 = ((FLEET **)rglpfl)[ifl];
                                    iVar6 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                                    lpfl = (FLEET *)CONCAT22(iVar6, pFVar15);
                                    if ((pFVar15 == 0) && (iVar6 == 0))
                                        break;
                                    if ((pFVar15->idPlanet == iVar11) &&
                                        ((pFVar15->iPlayer == idPlayer && (sVar9 = FPotentRobWarFleet((FLEET *)CONCAT22(iVar6, pFVar15), 2), sVar9 != 0)))) {
                                        if ((iLatestBomber != -1) &&
                                            (uVar18 = (undefined2)((ulong)lpfl >> 0x10),
                                             (int)(uint)vrgAiArmadaPotency[2] <= ((FLEET *)lpfl)->rgcsh[0xd] + ((FLEET *)lpfl)->rgcsh[0xe])) {
                                            AddItemToQueue(iLatestBomber, 4, grobjFleet, 1);
                                            fWrite = 1;
                                            goto AI_FinishProd_2;
                                        }
                                        break;
                                    }
                                }
                            }
                            if (iLatestBattle != -1) {
                                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestBattle * 0x93) == 0) &&
                                    (*(uint *)((int)&rgshdef[0].cExist + iLatestBattle * 0x93) < game.cPlanMax / 0x18 + 4U)) {
                                    GetResourcesAvailable(lppl, rgResAvail);
                                    GetProdQCost(lppl, rgResCost);
                                    for (i = 0; i < 4; i = i + 1) {
                                        uVar7 = *(uint *)(rgResCost + i);
                                        iVar11 = *(int *)((int)rgResCost + i * 4 + 2);
                                        puVar1 = (uint *)(rgResAvail + i);
                                        uVar10 = *puVar1;
                                        *puVar1 = *puVar1 - uVar7;
                                        piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                                        *piVar2 = (*piVar2 - iVar11) - (uint)(uVar10 < uVar7);
                                        iVar11 = *(int *)((int)rgResAvail + i * 4 + 2);
                                        if ((iVar11 < 1) && (iVar11 < 0))
                                            goto AI_FinishProd_2;
                                    }
                                    for (i = 0; i < 5; i = i + 1) {
                                        GetTrueHullCost(idPlayer, (HUL *)(iLatestBattle * 0x93 + rgshdef), rgCosts);
                                        for (j = 0; j < 4; j = j + 1) {
                                            uVar7 = rgCosts[j];
                                            puVar1 = (uint *)(rgResAvail + j);
                                            uVar10 = *puVar1;
                                            *puVar1 = *puVar1 - uVar7;
                                            piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                                            *piVar2 = *piVar2 - (uint)(uVar10 < uVar7);
                                            iVar11 = *(int *)((int)rgResAvail + j * 4 + 2);
                                            if ((iVar11 < 1) && (iVar11 < 0))
                                                goto AI_FinishProd_2;
                                        }
                                        fWrite = 1;
                                        AddItemToQueue(iLatestBattle, 1, grobjFleet, 1);
                                    }
                                }
                            }
                            if (iLatestCruiser != -1) {
                                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestCruiser * 0x93) == 0) &&
                                    (*(uint *)((int)&rgshdef[0].cExist + iLatestCruiser * 0x93) < game.cPlanMax / 0xc + 8U)) {
                                    GetResourcesAvailable(lppl, rgResAvail);
                                    GetProdQCost(lppl, rgResCost);
                                    for (i = 0; i < 4; i = i + 1) {
                                        uVar7 = *(uint *)(rgResCost + i);
                                        iVar11 = *(int *)((int)rgResCost + i * 4 + 2);
                                        puVar1 = (uint *)(rgResAvail + i);
                                        uVar10 = *puVar1;
                                        *puVar1 = *puVar1 - uVar7;
                                        piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                                        *piVar2 = (*piVar2 - iVar11) - (uint)(uVar10 < uVar7);
                                        iVar11 = *(int *)((int)rgResAvail + i * 4 + 2);
                                        if ((iVar11 < 1) && (iVar11 < 0))
                                            goto AI_FinishProd_2;
                                    }
                                    for (i = 0; i < 5; i = i + 1) {
                                        GetTrueHullCost(idPlayer, (HUL *)(iLatestCruiser * 0x93 + rgshdef), rgCosts);
                                        for (j = 0; j < 4; j = j + 1) {
                                            uVar7 = rgCosts[j];
                                            puVar1 = (uint *)(rgResAvail + j);
                                            uVar10 = *puVar1;
                                            *puVar1 = *puVar1 - uVar7;
                                            piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                                            *piVar2 = *piVar2 - (uint)(uVar10 < uVar7);
                                            iVar11 = *(int *)((int)rgResAvail + j * 4 + 2);
                                            if ((iVar11 < 1) && (iVar11 < 0))
                                                goto AI_FinishProd_2;
                                        }
                                        fWrite = 1;
                                        AddItemToQueue(iLatestCruiser, 1, grobjFleet, 1);
                                    }
                                }
                            }
                            if (iLatestDestroyer != -1) {
                                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestDestroyer * 0x93) == 0) &&
                                    (*(uint *)((int)&rgshdef[0].cExist + iLatestDestroyer * 0x93) < game.cPlanMax / 4 + 0xcU)) {
                                    GetResourcesAvailable(lppl, rgResAvail);
                                    GetProdQCost(lppl, rgResCost);
                                    for (i = 0; i < 4; i = i + 1) {
                                        uVar7 = *(uint *)(rgResCost + i);
                                        iVar11 = *(int *)((int)rgResCost + i * 4 + 2);
                                        puVar1 = (uint *)(rgResAvail + i);
                                        uVar10 = *puVar1;
                                        *puVar1 = *puVar1 - uVar7;
                                        piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                                        *piVar2 = (*piVar2 - iVar11) - (uint)(uVar10 < uVar7);
                                        iVar11 = *(int *)((int)rgResAvail + i * 4 + 2);
                                        if ((iVar11 < 1) && (iVar11 < 0))
                                            goto AI_FinishProd_2;
                                    }
                                    for (i = 0; i < 5; i = i + 1) {
                                        GetTrueHullCost(idPlayer, (HUL *)(iLatestDestroyer * 0x93 + rgshdef), rgCosts);
                                        for (j = 0; j < 4; j = j + 1) {
                                            uVar7 = rgCosts[j];
                                            puVar1 = (uint *)(rgResAvail + j);
                                            uVar10 = *puVar1;
                                            *puVar1 = *puVar1 - uVar7;
                                            piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                                            *piVar2 = *piVar2 - (uint)(uVar10 < uVar7);
                                            iVar11 = *(int *)((int)rgResAvail + j * 4 + 2);
                                            if ((iVar11 < 1) && (iVar11 < 0))
                                                goto AI_FinishProd_2;
                                        }
                                        fWrite = 1;
                                        AddItemToQueue(iLatestDestroyer, 1, grobjFleet, 1);
                                    }
                                }
                            }
                            if ((iLatestTroop != -1) && ((rgshdef[0xf].wFlags >> 9 & 1) == 0)) {
                                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestTroop * 0x93) == 0) &&
                                    (*(uint *)((int)&rgshdef[0].cExist + iLatestTroop * 0x93) < game.cPlanMax / 0xc + 8U)) {
                                    GetResourcesAvailable(lppl, rgResAvail);
                                    GetProdQCost(lppl, rgResCost);
                                    for (i = 0; i < 4; i = i + 1) {
                                        uVar7 = *(uint *)(rgResCost + i);
                                        iVar11 = *(int *)((int)rgResCost + i * 4 + 2);
                                        puVar1 = (uint *)(rgResAvail + i);
                                        uVar10 = *puVar1;
                                        *puVar1 = *puVar1 - uVar7;
                                        piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                                        *piVar2 = (*piVar2 - iVar11) - (uint)(uVar10 < uVar7);
                                        iVar11 = *(int *)((int)rgResAvail + i * 4 + 2);
                                        if ((iVar11 < 1) && (iVar11 < 0))
                                            goto AI_FinishProd_2;
                                    }
                                    for (i = 0; i < 5; i = i + 1) {
                                        GetTrueHullCost(idPlayer, (HUL *)(iLatestTroop * 0x93 + rgshdef), rgCosts);
                                        for (j = 0; j < 4; j = j + 1) {
                                            uVar7 = rgCosts[j];
                                            puVar1 = (uint *)(rgResAvail + j);
                                            uVar10 = *puVar1;
                                            *puVar1 = *puVar1 - uVar7;
                                            piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                                            *piVar2 = *piVar2 - (uint)(uVar10 < uVar7);
                                            iVar11 = *(int *)((int)rgResAvail + j * 4 + 2);
                                            if ((iVar11 < 1) && (iVar11 < 0))
                                                goto AI_FinishProd_2;
                                        }
                                        fWrite = 1;
                                        AddItemToQueue(iLatestTroop, 1, grobjFleet, 1);
                                    }
                                }
                            }
                        AI_FinishProd_2:
                            FinishProduction(fWrite);
                        }
                    }
                }
            }
        } else {
            ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 10] = ((byte)(((PLANET *)lppl)->wFlags_0x4 >> 9) & 1) + 1;
            sVar9 = PctPlanetOptValue(lppl, idPlayer);
            if (0 < sVar9) {
                ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 3] = (byte)sVar9;
                cplBadGuy = cplBadGuy + 1;
            }
        }
        lppl = (PLANET *)lppl + 1;
    }
    for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
        /* WARNING: Load size is inaccurate */
        pPVar12 = ((PLANET **)vrglpplAi)[ipl];
        iVar11 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
        lppl = (PLANET *)CONCAT22(iVar11, pPVar12);
        if (((pPVar12 == 0) && (iVar11 == 0)) || ((pPVar12->wFlags_0x4 >> 9 & 1) != 0))
            break;
    }
    lpplHome._0_2_ = (PLANET *)lppl;
    lpplHome._2_2_ = lppl._2_2_;
    if (((PLANET *)lppl == (PLANET *)lpplMac) && (lppl._2_2_ == lpplMac._2_2_)) {
        lpplHome._0_2_ = 0;
        lpplHome._2_2_ = 0;
    }
    lpflAttack._0_2_ = 0;
    lpflAttack._2_2_ = 0;
    lpflEnemy._0_2_ = 0;
    lpflEnemy._2_2_ = 0;
    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
        /* WARNING: Load size is inaccurate */
        pFVar15 = ((FLEET **)rglpfl)[ifl];
        iVar11 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar11, pFVar15);
        if ((pFVar15 == 0) && (iVar11 == 0))
            break;
        if (pFVar15->iPlayer == idPlayer) {
            sVar9 = FIsTurinDroneAiAttack((FLEET *)CONCAT22(iVar11, pFVar15));
            pFVar15 = (FLEET *)lpfl;
            uVar18 = (undefined2)((ulong)lpfl >> 0x10);
            if (sVar9 != 0) {
                *(FLEET **)&pFVar15->lpflNext = (FLEET *)lpflAttack;
                *(undefined2 *)((int)&pFVar15->lpflNext + 2) = lpflAttack._2_2_;
                lpflAttack._0_2_ = pFVar15;
                lpflAttack._2_2_ = uVar18;
            }
            pFVar15->wFlags_0x4 = pFVar15->wFlags_0x4 & 0x7fff;
            if (((pFVar15->rgcsh[2] == 0) && (pFVar15->rgcsh[3] == 0)) ||
                ((*(uint *)(*(int *)&pFVar15->lpplord + (pFVar15->cord + -1) * 0x12 + 10) & 0xf) == 0)) {
                if ((pFVar15->rgcsh[8] == 0) && (pFVar15->rgcsh[9] == 0)) {
                    if (pFVar15->rgcsh[1] != 0) {
                        idPlanDst = -1;
                        if (pFVar15->cord < 2) {
                            idPlanDst = pFVar15->idPlanet;
                        } else if ((((PLORD *)pFVar15->lpplord + 7)->wFlags >> 8 & 0xf) == 1) {
                            idPlanDst = *(short *)&((PLORD *)pFVar15->lpplord)[6].iordMax;
                        }
                        if (idPlanDst != -1) {
                            if (((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] != 0)
                                goto AI_LCheckForColDrop_3;
                            lppl = LpplFromId(idPlanDst);
                            iVar11 = (int)((ulong)lppl >> 0x10);
                            pPVar12 = (PLANET *)lppl;
                            if (((pPVar12 != 0) || (iVar11 != 0)) && ((pPVar12->iPlayer != -1 && (pPVar12->iPlayer != idPlayer))))
                                goto AI_LBlowAwayOrders_3;
                        }
                    }
                } else {
                    idPlanDst = -1;
                    if (pFVar15->cord < 2) {
                        idPlanDst = pFVar15->idPlanet;
                    } else if ((((PLORD *)pFVar15->lpplord + 7)->wFlags >> 8 & 0xf) == 1) {
                        idPlanDst = *(short *)&((PLORD *)pFVar15->lpplord)[6].iordMax;
                    }
                AI_LCheckForColDrop_3:
                    if (idPlanDst == -1) {
                        if ((1 < pFVar15->cord) && ((((PLORD *)pFVar15->lpplord + 7)->wFlags >> 8 & 0xf) == 4))
                            goto AI_LBlowAwayOrders_3;
                    } else {
                        lppl = LpplFromId(idPlanDst);
                        iVar11 = (int)((ulong)lppl >> 0x10);
                        pPVar12 = (PLANET *)lppl;
                        if (((pPVar12 == 0) && (iVar11 == 0)) || ((pPVar12->iPlayer != -1 && (pPVar12->iPlayer != idPlayer)))) {
                            if (((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] != 0) {
                                uVar18 = (undefined2)((ulong)lpfl >> 0x10);
                                iVar6 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
                                if ((-1 < iVar6) && ((((0 < iVar6 || ((int)((FLEET *)lpfl)->rgwtMin[3] != 0)) &&
                                                       (sVar9 = GetRaceStat((PLAYER *)rgplr + pPVar12->iPlayer, rsMajorAdv), sVar9 != raMacintosh)) &&
                                                      ((((PLANET *)lppl)->wFlags_0x4 >> 9 & 1) == 0)))) {
                                    _memset(&ord, 0, 0x12);
                                    ord.pt.x = ((POINT *)rgptPlan + idPlanDst)->x;
                                    ord.pt.y = *(short *)((int)&rgptPlan[0].y + idPlanDst * 4);
                                    ord.id = idPlanDst;
                                    ord.wFlags_0x6 = ord.wFlags_0x6 & 0xe0f0 | 0x1101;
                                    ord.u_ORDER_0x0008.txp.rgia[3].wFlags = (ITEMACTION)((uint)ord.u_ORDER_0x0008.txp.rgia[3].wFlags & 0xfff | 0x2000);
                                    ChangeMainObjSel(2, lpfl->id);
                                    uVar18 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                                    pPVar14 = (PLORD *)sel.fl.lpplord;
                                    if (((pPVar14 + 2)->wFlags == idPlanDst) && ((*(uint *)&pPVar14[2].iordMax >> 8 & 0xf) == 1)) {
                                        pPVar14 = pPVar14 + 1;
                                        pOVar17 = &ord;
                                        for (iVar11 = 9; iVar11 != 0; iVar11 = iVar11 + -1) {
                                            pPVar5 = pPVar14;
                                            pPVar14 = &pPVar14->iordMax;
                                            pOVar4 = pOVar17;
                                            pOVar17 = &(pOVar17->pt).y;
                                            pPVar5->wFlags = (pOVar4->pt).x;
                                        }
                                    } else {
                                        pbVar16 = &pPVar14[5].iordMax;
                                        pOVar17 = &ord;
                                        for (iVar11 = 9; iVar11 != 0; iVar11 = iVar11 + -1) {
                                            pbVar3 = pbVar16;
                                            pbVar16 = pbVar16 + 2;
                                            pOVar4 = pOVar17;
                                            pOVar17 = &(pOVar17->pt).y;
                                            *pbVar3 = (pOVar4->pt).x;
                                        }
                                    }
                                    FLookupFleet(-1, (FLEET *)&sel.fl);
                                    ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] = ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] | 0x80;
                                    FMoveToNearestStarbase(lpfl, 0);
                                    goto LAB_1088_4932;
                                }
                            }
                        AI_LBlowAwayOrders_3:
                            ChangeMainObjSel(2, lpfl->id);
                            sel.fl.cord = 1;
                            ((PLORD *)sel.fl.lpplord)->iordMac = 1;
                            FLookupFleet(-1, (FLEET *)&sel.fl);
                            ClearAiCurrentTask(lpfl, 0);
                        }
                    }
                }
            } else {
                if (pFVar15->idPlanet == -1) {
                    if (pFVar15->cord < 2)
                        goto LAB_1088_4932;
                    ((PLORD *)pFVar15->lpplord + 7)->wFlags = ((PLORD *)pFVar15->lpplord + 7)->wFlags & 0xfff0 | 3;
                    idPlanDst = *(short *)&((PLORD *)pFVar15->lpplord)[6].iordMax;
                } else {
                    pPVar22 = LpplFromId(pFVar15->idPlanet);
                    if (((PLANET *)pPVar22)->iPlayer != -1)
                        goto AI_LBlowAwayOrders_3;
                    idPlanDst = ((FLEET *)lpfl)->idPlanet;
                }
                ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 1] = ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 1] | 0x80;
            }
        } else {
            *(FLEET **)&pFVar15->lpflNext = (FLEET *)lpflEnemy;
            *(int *)((int)&pFVar15->lpflNext + 2) = lpflEnemy._2_2_;
            lpflEnemy._0_2_ = pFVar15;
            lpflEnemy._2_2_ = iVar11;
        }
    LAB_1088_4932:
    }
    fMarkedPlanets = 0;
    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
        /* WARNING: Load size is inaccurate */
        pFVar15 = ((FLEET **)rglpfl)[ifl];
        iVar11 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
        lpfl = (FLEET *)CONCAT22(iVar11, pFVar15);
        if ((pFVar15 == 0) && (iVar11 == 0))
            break;
        if (pFVar15->iPlayer == idPlayer) {
            if ((pFVar15->rgcsh[2] == 0) && (pFVar15->rgcsh[3] == 0)) {
                if (pFVar15->cord < 2) {
                    if (pFVar15->rgcsh[1] == 0) {
                        if ((pFVar15->rgcsh[8] == 0) && (pFVar15->rgcsh[9] == 0)) {
                            if ((pFVar15->rgcsh[0xd] == 0) && (pFVar15->rgcsh[0xe] == 0)) {
                                if (((pFVar15->rgcsh[0] == 0) && (pFVar15->rgcsh[10] == 0)) && (pFVar15->rgcsh[0xb] == 0)) {
                                    if (((pFVar15->rgcsh[0xc] != 0) && (pFVar15->cord == 1)) &&
                                        ((*(uint *)&((PLORD *)pFVar15->lpplord)[2].iordMax & 0xf) == 0)) {
                                        ChangeMainObjSel(2, lpfl->id);
                                        uVar18 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                                        *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax = *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 6;
                                        ((PLORD *)sel.fl.lpplord + 3)->wFlags = 5;
                                        pbVar3 = &((PLORD *)sel.fl.lpplord)[3].iordMax;
                                        pbVar3[0] = 5;
                                        pbVar3[1] = 0;
                                        FLookupFleet(-1, (FLEET *)&sel.fl);
                                    }
                                } else {
                                    if (((pFVar15->rgcsh[0] != 0) && ('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) &&
                                        (rgshdef[0].hul.ihuldef == ihuldefScout))
                                        goto AI_LScrapFleet_3;
                                    ChangeMainObjSel(2, lpfl->id);
                                    IdTargetScout(lpfl, (FLEET *)CONCAT22(lpflAttack._2_2_, (FLEET *)lpflAttack),
                                                  (FLEET *)CONCAT22(lpflEnemy._2_2_, (FLEET *)lpflEnemy), game.wCrap >> 4 & 1, &lpthWorm);
                                }
                            } else {
                                ChangeMainObjSel(2, lpfl->id);
                                uVar18 = (undefined2)((ulong)lpfl >> 0x10);
                                if (((FLEET *)lpfl)->idPlanet == -1) {
                                    lppl = (PLANET *)CONCAT22(lpplHome._2_2_, (PLANET *)lpplHome);
                                } else {
                                    lppl = LpplFromId(((FLEET *)lpfl)->idPlanet);
                                    uVar18 = (undefined2)((ulong)lppl >> 0x10);
                                    pPVar12 = (PLANET *)lppl;
                                    if (pPVar12->iPlayer == idPlayer) {
                                        if ((pPVar12->wFlags_0x4 >> 9 & 1) != 0) {
                                            uVar18 = (undefined2)((ulong)lpfl >> 0x10);
                                            pFVar15 = (FLEET *)lpfl;
                                            if ((pFVar15->rgcsh[0xd] + pFVar15->rgcsh[0xe] < (int)(uint)vrgAiArmadaPotency[2]) ||
                                                (pFVar15->rgcsh[4] + pFVar15->rgcsh[5] < (int)(uint)vrgAiArmadaPotency[1]))
                                                goto LAB_1088_4eb0;
                                        }
                                        FLookupFleet(lpfl->id, (FLEET *)&sel.fl);
                                    } else if (pPVar12->iPlayer != -1) {
                                        lpflT = (FLEET *)CONCAT22(lpflEnemy._2_2_, (FLEET *)lpflEnemy);
                                        while (true) {
                                            if (((FLEET *)lpflT == 0) && (lpflT._2_2_ == 0))
                                                goto LAB_1088_4eb0;
                                            uVar18 = (undefined2)((ulong)lpfl >> 0x10);
                                            if (((&((FLEET *)lpfl)->pt)->x == (&((FLEET *)lpflT)->pt)->x) &&
                                                (((((FLEET *)lpfl)->pt).y == (((FLEET *)lpflT)->pt).y && (sVar9 = FIsAiAttack(lpflT), sVar9 != 0))))
                                                break;
                                            uVar18 = (undefined2)((ulong)lpflT >> 0x10);
                                            /* WARNING: Load size is inaccurate */
                                            lpflT = (FLEET *)CONCAT22(*(undefined2 *)((int)&((FLEET *)lpflT)->lpflNext + 2), ((FLEET *)lpflT)->lpflNext);
                                        }
                                    }
                                }
                                if ((game.wCrap >> 4 & 1) == 0) {
                                    lpplDest = 0;
                                } else {
                                    lpplDest = LpplFindBestEnum(lppl, FEnumCalcArmadaHumanDest);
                                }
                                if (((PLANET *)lpplDest == 0) && (lpplDest._2_2_ == 0)) {
                                    lpplDest = LpplFindBestEnum(lppl, FEnumCalcArmadaDest);
                                }
                                lppl = lpplDest;
                                if (((PLANET *)lpplDest != 0) || (lpplDest._2_2_ != 0)) {
                                    ((byte *)vlpbAiPlanet)[lpplDest->id * 0x10 + 10] = ((byte *)vlpbAiPlanet)[lpplDest->id * 0x10 + 10] | 0x80;
                                    ord.id = lpplDest->id;
                                    ord.pt.x = ((POINT *)rgptPlan + lpplDest->id)->x;
                                    ord.pt.y = *(short *)((int)&rgptPlan[0].y + lpplDest->id * 4);
                                    ord.wFlags_0x6 = ord.wFlags_0x6 & 0xe000 | 0x1140;
                                    FMoveAiFleet(lpfl, &ord, 0);
                                }
                            }
                        } else if (game.turn == 0) {
                            ChangeMainObjSel(2, lpfl->id);
                        AI_LScrapFleet_3:
                            ChangeMainObjSel(2, lpfl->id);
                            uVar18 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                            *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax = *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
                            FLookupFleet(-1, (FLEET *)&sel.fl);
                        } else {
                            if (((PLANET *)lpplHome == 0) && (lpplHome._2_2_ == 0))
                                break;
                            lppl = 0;
                            i = 0;
                            while (true) {
                                uVar18 = (undefined2)((ulong)vlpbAiData >> 0x10);
                                pbVar16 = (byte *)vlpbAiData;
                                if (*(int *)(pbVar16 + 2) <= i)
                                    break;
                                j = 0;
                                while ((j < *(int *)(pbVar16 + i * 0x14 + 6) && (*(int *)(pbVar16 + j * 2 + i * 0x14 + 8) != lpfl->id))) {
                                    j = j + 1;
                                }
                                if (j < *(int *)(pbVar16 + i * 0x14 + 6))
                                    break;
                                i = i + 1;
                            }
                            if (i < *(int *)(pbVar16 + 2)) {
                                lppl = LpplFromId(*(short *)(pbVar16 + i * 0x14 + 4));
                            }
                            if (((PLANET *)lppl != 0) || (pPVar12 = (PLANET *)lpplHome, iVar11 = lpplHome._2_2_, lppl._2_2_ != 0)) {
                                pPVar12 = (PLANET *)lppl;
                                iVar11 = lppl._2_2_;
                            }
                            IdTargetFreighter(lpfl, (PLANET *)CONCAT22(iVar11, pPVar12));
                        }
                    } else {
                        ChangeMainObjSel(2, lpfl->id);
                        uVar18 = (undefined2)((ulong)lpfl >> 0x10);
                        pFVar15 = (FLEET *)lpfl;
                        if (((((pFVar15->idPlanet == -1) || (sel.pl.iPlayer != idPlayer)) ||
                              ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((sel.pl.rgwtMin[3]._2_2_ < 0 || ((uint)sel.pl.rgwtMin[3] < 0x32)))))) &&
                             ((int)pFVar15->rgwtMin[3] == 0)) &&
                            (*(int *)((int)pFVar15->rgwtMin + 0xe) == 0)) {
                            if ((((sel.fl.idPlanet == -1) || (sel.pl.iPlayer != idPlayer)) || ((sel.pl.wFlags_0x4 >> 9 & 1) == 0)) &&
                                (((rgshdef[1].hul.rghs[0].wFlags_0x2 & 0xff) < 3 || (sVar9 = FMoveToNearestStarbase(lpfl, 0), sVar9 == 0))))
                                goto AI_LScrapFleet_3;
                        } else {
                            lpthWorm._0_2_ = 0;
                            lpthWorm._2_2_ = 0;
                            idPlanDst = IdNearestColonizablePlanet(lpfl, 0);
                            if ((((FLEET *)lpfl)->idPlanet == -1) || (sel.pl.iPlayer != idPlayer)) {
                                lppl = (PLANET *)CONCAT22(lpplHome._2_2_, (PLANET *)lpplHome);
                            } else {
                                ChangeMainObjSel(2, lpfl->id);
                                XferAiSupply(1, ((FLEET *)lpfl)->idPlanet, 2, lpfl->id, 3, 0x19);
                                FLookupFleet(lpfl->id, (FLEET *)&sel.fl);
                                lppl = LpplFromId(((FLEET *)lpfl)->idPlanet);
                            }
                            if (idPlanDst == -1) {
                                if (((PLANET *)lppl != 0) || (lppl._2_2_ != 0)) {
                                    pPVar22 = LpplFindClosestEnum(lppl, FEnumCalcColonistDrop);
                                    if (((PLANET *)pPVar22 != 0) || ((int)((ulong)pPVar22 >> 0x10) != 0)) {
                                        ((byte *)vlpbAiPlanet)[pPVar22->id * 0x10 + 10] = ((byte *)vlpbAiPlanet)[pPVar22->id * 0x10 + 10] | 0x80;
                                        _memset(&ord, 0, 0x12);
                                        ord.id = pPVar22->id;
                                        ord.pt.x = ((POINT *)rgptPlan + pPVar22->id)->x;
                                        ord.pt.y = *(short *)((int)&rgptPlan[0].y + pPVar22->id * 4);
                                        ord.wFlags_0x6 = ord.wFlags_0x6 & 0xe000 | 0x1161;
                                        ord.u_ORDER_0x0008.txp.rgia[3].wFlags = (ITEMACTION)((uint)ord.u_ORDER_0x0008.txp.rgia[3].wFlags & 0xfff | 0x2000);
                                        FMoveAiFleet(lpfl, &ord, 0);
                                        goto LAB_1088_4eb0;
                                    }
                                }
                                if ((((THING *)lpthWorm != 0) || (lpthWorm._2_2_ != 0)) && (sVar9 = Random(100), sVar9 < 10)) {
                                    FGotoWormholeAiFleet(lpfl, (THING *)CONCAT22(lpthWorm._2_2_, (THING *)lpthWorm));
                                }
                            } else {
                                FColonizeAiFleet(lpfl, idPlanDst);
                                ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 0xf] = 4;
                            }
                        }
                    }
                }
            } else {
                if (game.turn == 0)
                    goto AI_LScrapFleet_3;
                if (pFVar15->idPlanet != -1) {
                    ChangeMainObjSel(2, lpfl->id);
                    b = ((byte *)vlpbAiPlanet)[((FLEET *)lpfl)->idPlanet * 0x10 + 1];
                    if (b < 4) {
                        lppl = LpplFindBestEnum(&sel.pl, FEnumCalcMinerDest);
                        if (((PLANET *)lppl != 0) || ((int)((ulong)lppl >> 0x10) != 0)) {
                            _memset(&ord, 0, 0x12);
                            ord.id = lppl->id;
                            ord.pt.x = ((POINT *)rgptPlan + lppl->id)->x;
                            ord.pt.y = *(short *)((int)&rgptPlan[0].y + lppl->id * 4);
                            ord.wFlags_0x6 = ord.wFlags_0x6 & 0xe000 | 0x1163;
                            FMoveAiFleet(lpfl, &ord, 1);
                            ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 1] = ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 1] | 0x80;
                            ((byte *)vlpbAiPlanet)[((FLEET *)lpfl)->idPlanet * 0x10 + 1] = ((byte *)vlpbAiPlanet)[((FLEET *)lpfl)->idPlanet * 0x10 + 1] & 0x80;
                        }
                    }
                }
            }
        }
    LAB_1088_4eb0:
    }
    HandleBasicAiTasks(iroCur, rgprod, ishdefSBLatest, rgResAvail, rgResCost);
    FillProductionQueue();
    return;
}

// ======================================================================
// Function: EnsureTurinDroneShdefs
// Address: 1088:58ba
// Segment: MEMORY_AI
// ======================================================================

void EnsureTurinDroneShdefs(short iroCur)

{
    SHDEF     *pSVar1;
    SHDEF     *pSVar2;
    short      sVar3;
    int        iVar4;
    SHDEF     *pSVar5;
    SHDEF     *pSVar6;
    undefined2 unaff_SS;
    short      i;
    SHDEF      shdef;

    if ((((rgshdef[8].wFlags >> 9 & 1) != 0) && ('\x04' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
        ('\a' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) {
        FCreateAiShdef(8, 0xc, (byte *)vrgTDAip + vrgTDIshAip[0xc]);
    }
    if ((((rgshdef[9].wFlags >> 9 & 1) != 0) && ('\x06' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
        ('\n' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) {
        FCreateAiShdef(9, 0xd, (byte *)vrgTDAip + vrgTDIshAip[0xf]);
    }
    if ((((rgshdef[10].wFlags >> 9 & 1) != 0) && ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
        (('\x04' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
          (('\x03' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\x04' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) {
        for (i = 0; i < 4; i = i + 1) {
            sVar3 = Random(1);
            sVar3 = FCreateAiShdef(10, 6, (byte *)vrgTDAip + ((byte *)vrgTDIshAip + 2)[sVar3]);
            if (sVar3 != 0)
                break;
        }
    }
    if (((rgshdef[1].wFlags >> 9 & 1) != 0) || (((int)rgshdef[1].cExist == 0 && (rgshdef[1].cExist._2_2_ == 0)))) {
        if (((rgshdef[1].wFlags >> 9 & 1) == 0) && (rgshdef[1].hul.ihuldef != ihuldefPrivateer)) {
            pSVar5 = (SHDEF *)(rgshdef + 1);
            pSVar6 = &shdef;
            for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
                pSVar2 = pSVar6;
                pSVar6 = (pSVar6->hul).rgTech;
                pSVar1 = pSVar5;
                pSVar5 = (pSVar5->hul).rgTech;
                (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
            }
            *&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
            shdef.wFlags = shdef.wFlags & 0xfdff | 0x200;
            FChangeAiShdef(&shdef, 1);
        }
        FCreateAiShdef(1, 0xf, (byte *)vrgTDAip + vrgTDIshAip[0]);
    }
    if (((rgshdef[0].wFlags >> 9 & 1) != 0) || (((int)rgshdef[0].cExist == 0 && (rgshdef[0].cExist._2_2_ == 0)))) {
        if ((rgshdef[0].wFlags >> 9 & 1) == 0) {
            pSVar5 = (SHDEF *)rgshdef;
            pSVar6 = &shdef;
            for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
                pSVar2 = pSVar6;
                pSVar6 = (pSVar6->hul).rgTech;
                pSVar1 = pSVar5;
                pSVar5 = (pSVar5->hul).rgTech;
                (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
            }
            *&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
            shdef.wFlags = shdef.wFlags & 0xfdff | 0x200;
            FChangeAiShdef(&shdef, 0);
        }
        FCreateAiShdef(0, 5, (byte *)vrgTDAip + vrgTDIshAip[1]);
    }
    if (((((rgshdef[2].wFlags >> 9 & 1) != 0) || (((int)rgshdef[2].cExist == 0 && (rgshdef[2].cExist._2_2_ == 0)))) &&
         ('\x06' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) &&
        ('\x03' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) {
        if ((rgshdef[2].wFlags >> 9 & 1) == 0) {
            pSVar5 = (SHDEF *)(rgshdef + 2);
            pSVar6 = &shdef;
            for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
                pSVar2 = pSVar6;
                pSVar6 = (pSVar6->hul).rgTech;
                pSVar1 = pSVar5;
                pSVar5 = (pSVar5->hul).rgTech;
                (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
            }
            *&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
            shdef.wFlags = shdef.wFlags & 0xfdff | 0x200;
            FChangeAiShdef(&shdef, 2);
        }
        FCreateAiShdef(2, 0x16, (byte *)vrgTDAip + vrgTDIshAip[0x11]);
    }
    if ((((rgshdef[0xc].wFlags >> 9 & 1) != 0) || (((int)rgshdef[0xc].cExist == 0 && (rgshdef[0xc].cExist._2_2_ == 0)))) &&
        (('\x03' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\x03' < *(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0))))) {
        FCreateAiShdef(0xc, 0xb, (byte *)vrgTDAip + vrgTDIshAip[0xe]);
    }
    if (((((rgshdef[0xd].wFlags >> 9 & 1) != 0) && ('\a' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
         ('\x06' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
        ('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) {
        FCreateAiShdef(0xd, 0x12, (byte *)vrgTDAip + vrgTDIshAip[0xd]);
    }
    if ((((rgshdef[0xe].wFlags >> 9 & 1) != 0) && ('\n' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
        (('\v' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
          (('\x0e' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\b' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) {
        FCreateAiShdef(0xe, 0x12, (byte *)vrgTDAip + vrgTDIshAip[0xd]);
    }
    if (((((rgshdef[4].wFlags >> 9 & 1) != 0) && ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
         ('\x05' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
        (('\f' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\x06' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))) {
        for (i = 0; i < 5; i = i + 1) {
            sVar3 = Random(4);
            sVar3 = FCreateAiShdef(4, 9, (byte *)vrgTDAip + *(byte *)((int)&rgptPlan[0x19d].y + sVar3));
            if (sVar3 != 0)
                break;
        }
    }
    if ((((rgshdef[0xf].wFlags >> 9 & 1) != 0) && ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
        (('\x05' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
          (('\f' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) && ('\x06' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) {
        i = 0;
        while ((i < 5 && (sVar3 = FCreateAiShdef(0xf, 0xc, (byte *)vrgTDAip + vrgTDIshAip[0xc]), sVar3 == 0))) {
            i = i + 1;
        }
    }
    return;
}

// ======================================================================
// Function: FEnumCalcMinerDest
// Address: 1088:5f32
// Segment: MEMORY_AI
// ======================================================================

short FEnumCalcMinerDest(PLANET *lpplSrc, PLANET *lpplTest)

{
    byte  bVar1;
    short sVar2;
    uint  uVar3;
    byte  b;
    short id;

    if (((PLANET *)lpplSrc == (PLANET *)lpplTest) && (lpplSrc._2_2_ == lpplTest._2_2_)) {
        uVar3 = 0;
    } else {
        bVar1 = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 1];
        if ((bVar1 == 0) || ((sVar2 = Random(100), 0x18 < sVar2 && ((bVar1 & 0x80) != 0)))) {
            uVar3 = 0;
        } else {
            uVar3 = (uint)bVar1;
        }
    }
    return uVar3;
}

// ======================================================================
// Function: FEnumCalcColonistDrop
// Address: 1088:5fc8
// Segment: MEMORY_AI
// ======================================================================

/* WARNING: Removing unreachable block (ram,0x10886069) */
/* WARNING: Removing unreachable block (ram,0x1088607a) */

short FEnumCalcColonistDrop(PLANET *lpplSrc, PLANET *lpplTest)

{
    byte  bVar1;
    short sVar2;
    uint  uVar3;
    byte  bEnemy;
    byte  bWant;
    short id;

    if (((PLANET *)lpplSrc == (PLANET *)lpplTest) && (lpplSrc._2_2_ == lpplTest._2_2_)) {
        uVar3 = 0;
    } else {
        bVar1 = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 3];
        if ((((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 10] == 1) && (bVar1 != 0)) {
            sVar2 = GetRaceStat((PLAYER *)rgplr + ((PLANET *)lpplTest)->iPlayer, rsMajorAdv);
            if (sVar2 == raMacintosh) {
                uVar3 = 0;
            } else {
                uVar3 = (uint)bVar1;
            }
        } else {
            uVar3 = 0;
        }
    }
    return uVar3;
}
