// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: DoAiTurn
// Address: 1088:0000
// Segment: MEMORY_AI
// ======================================================================


void DoAiTurn(short iPlayer,ushort wMdPlr)

{
  PLANET **ppPVar1;
  byte *pbVar2;
  short sVar3;
  short sVar4;
  char *unaff_SS;
  short idSav;
  PROD rgprod [64];
  char szExt [4];
  
                    /* Segment:    18
                       Offset:     00081340
                       Length:     60bc
                       Min Alloc:  60bc
                       Flags:      1d10
                           Code
                           Discardable
                           Moveable
                           LoadOnCall
                           Impure (Non-shareable)
                        */
  sVar3 = idPlayer;
  fAi = 1;
  _WSPRINTF((LPSTR)CONCAT22(iPlayer + 1,(char *)&DAT_1120_1120),
            (LPCSTR)CONCAT22(MPCTD,unaff_SS),szExt);
  DestroyCurGame();
  sVar4 = FLoadGame((char *)szBase,szExt);
  pbVar2 = vlpbAiPlanet;
  ppPVar1 = vrglpplAi;
  if (sVar4 != 0) {
    if ((*(uint *)((int)&rgplr[0].wFlags + idPlayer * 0xc0) & 1) == 0) {
      vlpbAiPlanet = LpAlloc(game.cPlanMax << 4,htMisc);
      vrglpplAi = LpAlloc(game.cPlanMax << 2,htMisc);
      if (((byte *)vlpbAiData == (byte *)0x0) && (vlpbAiData._2_2_ == 0)) {
        vlpbAiData = LpAlloc(0x2000,htMisc);
        if (((byte *)vlpbAiData != (byte *)0x0) ||
           ((int)((ulong)vlpbAiData >> 0x10) != 0)) {
          pbVar2 = vlpbAiData + 1;
          vlpbAiData[0] = 2;
          *pbVar2 = 0;
        }
      }
      if ((vlpbAiPlanet != (byte *)0x0) &&
         ((((byte *)vlpbAiData != (byte *)0x0 || (vlpbAiData._2_2_ != 0)) &&
          (vrglpplAi != (PLANET **)0x0)))) {
        __fmemset(vlpbAiPlanet,0,game.cPlanMax << 4);
        ComputeShdefPowers();
        MarkPlanetsUnderAttack();
        IncreaseAIMinefieldSizes();
        InitRandomPlanetList();
        if (wMdPlr != 0xffff) {
          *(ushort *)((int)&rgplr[0].wMdPlr + iPlayer * 0xc0) = wMdPlr;
        }
        switch(*(uint *)((int)&rgplr[0].wMdPlr + iPlayer * 0xc0) >> 0xd) {
        case 0:
          DoRobotoidAiTurn(rgprod);
          break;
        case 1:
          DoTurinDroneAiTurn(rgprod);
          break;
        case 2:
          DoAutomitronAiTurn(rgprod);
          break;
        case 3:
          DoRototillAiTurn(rgprod);
          break;
        case 4:
          DoCyberAiTurn(rgprod);
          break;
        case 5:
          DoMacintiAiTurn(rgprod);
          break;
        default:
          break;
        case 7:
          DoMaidAiTurn(rgprod);
        }
      }
    }
    FWriteLogFile((char *)szBase,iPlayer);
    FWriteHistFile(iPlayer);
    if (vrglpplAi != (PLANET **)0x0) {
      FreeLp(vrglpplAi,htMisc);
    }
    ppPVar1 = (PLANET **)0x0;
    if (((byte *)vlpbAiData != (byte *)0x0) ||
       (pbVar2 = vlpbAiPlanet, vlpbAiData._2_2_ != 0)) {
      vrglpplAi = ppPVar1;
      FreeLp(vlpbAiPlanet,htMisc);
      FreeLp(vlpbAiData,htMisc);
      vlpbAiData = (byte *)0x0;
      pbVar2 = (byte *)0x0;
      ppPVar1 = vrglpplAi;
    }
  }
  fAi = 0;
  vrglpplAi._2_2_ = (undefined2)((ulong)ppPVar1 >> 0x10);
  vrglpplAi._0_2_ = (PLANET **)ppPVar1;
  vlpbAiPlanet._2_2_ = (undefined2)((ulong)pbVar2 >> 0x10);
  vlpbAiPlanet._0_2_ = (byte *)pbVar2;
  idPlayer = sVar3;
  return;
}



// ======================================================================
// Function: DoRobotoidAiTurn
// Address: 1088:0312
// Segment: MEMORY_AI
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x108808ca) */
/* WARNING: Removing unreachable block (ram,0x108808a9) */
/* WARNING: Removing unreachable block (ram,0x108808cf) */
/* WARNING: Variable defined which should be unmapped: ord_2 */
/* WARNING: Removing unreachable block (ram,0x10880d8d) */
/* WARNING: Removing unreachable block (ram,0x10880f50) */
/* WARNING: Removing unreachable block (ram,0x10880a7a) */
/* WARNING: Removing unreachable block (ram,0x10880abe) */

void DoRobotoidAiTurn(PROD *rgprod)

{
  uint *puVar1;
  int *piVar2;
  byte *pbVar3;
  ORDER *pOVar4;
  int iVar5;
  int iVar6;
  PLORD *pPVar7;
  POINT pt;
  short sVar8;
  uint uVar9;
  short sVar10;
  uint uVar11;
  ushort uVar12;
  PLANET *pPVar13;
  int iVar14;
  byte *pbVar15;
  FLEET *pFVar16;
  undefined2 unaff_SI;
  ORDER *pOVar17;
  undefined2 unaff_DI;
  PLORD *pPVar18;
  undefined2 uVar19;
  undefined2 uVar20;
  ulong uVar21;
  ulong uVar22;
  PLANET *pPVar23;
  ORDER ord_2;
  PLANET *lpplDrop;
  PROD *lpprod;
  short fWrite;
  long l;
  short iLatestBomber;
  short iPlanet;
  short iLatestBattle;
  short cFr;
  ushort cRecyclePeriod;
  short iLatestMeta;
  PLANET *lpplMac;
  short ishdefSBLatest;
  short fTonsOfMinerals;
  short ipl;
  short iLatestCargo;
  short iAiLvl;
  short iroCur;
  short cRes;
  PLANET *lpplHome;
  FLEET *lpfl;
  FLEET *lpflAttack;
  ushort rgCosts [4];
  short i;
  short ifl;
  PLANET *lppl;
  short fShouldColonize;
  byte rgRecycleShdef [16];
  short j;
  short idPlanDst;
  THING *lpthWorm;
  short cColFleet;
  short iLatestDestroyer;
  short cFlDestroyers;
  short cExistCargo;
  long rgResAvail [4];
  FLEET *lpflEnemy;
  long rgResCost [4];
  
  uVar22 = CONCAT22(unaff_SI,unaff_DI);
  iAiLvl = *(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7;
  iPlanet = *(short *)((int)&rgplr[0].idPlanetHome + idPlayer * 0xc0);
  if ((uint)game.turn < 10) {
    sVar8 = 0;
  }
  else {
    sVar8 = 0xf;
  }
  iroCur = IroEnsureAi(vrgAiRobotoidResOrder,0x24,&ishdefSBLatest,sVar8);
  if (0x32 < (uint)game.turn) {
    MergeAllShdefs(0x6fc);
    MergeAllShdefs(1);
    MergeAllShdefs(-0x4000);
  }
  j = 4;
  if (0x82 < (uint)game.turn) {
    j = (game.turn - 0x78U) / 0x14 + 4;
  }
  if (0x32 < (uint)j) {
    j = 0x32;
  }
  vrgAiArmadaPotency[0] = (byte)j;
  vrgAiArmadaPotency[1] = (byte)((ulong)(j & 0xff) / 2);
  j = 6;
  if (0x73 < (uint)game.turn) {
    j = (game.turn - 100U) / 0x16 + 6;
  }
  if (0xc < (uint)j) {
    j = 0xc;
  }
  vrgAiArmadaPotency[2] = (byte)j;
  if ((int)((uint)j / 2 - 1) < 4) {
    vrgAiArmadaPotency[3] = (char)((uint)j / 2) - 1;
  }
  else {
    vrgAiArmadaPotency[3] = 3;
  }
  _memset(rgRecycleShdef,0,0x10);
  if ((uint)game.turn < 0x78) {
    cRecyclePeriod = 0x32;
  }
  else if ((uint)game.turn < 200) {
    cRecyclePeriod = 0x46;
  }
  else {
    cRecyclePeriod = 100;
  }
  CheckAiShdefStatus(0xe,0xf,cRecyclePeriod,&iLatestDestroyer,rgRecycleShdef);
  for (i = 0xe; i < 0x10; i = i + 1) {
    if (((rgRecycleShdef[i] != 0) &&
        ((*(uint *)((int)&rgshdef[0].wFlags + i * 0x93) >> 9 & 1) == 0)) &&
       (*(int *)(i * 0x93 + 0x3f00) == 0x1d)) {
      rgRecycleShdef[i] = 0;
    }
  }
  cExistCargo = CheckAiShdefStatus(0xb,0xd,cRecyclePeriod,&iLatestCargo,rgRecycleShdef);
  CheckAiShdefStatus(9,10,cRecyclePeriod,&iLatestBomber,rgRecycleShdef);
  CheckAiShdefStatus(2,5,cRecyclePeriod,&iLatestMeta,rgRecycleShdef);
  CheckAiShdefStatus
            (6,7,(ushort)(((long)(int)cRecyclePeriod * 3 & 0xffffU) / 2),&iLatestBattle,
             rgRecycleShdef);
  if (0x50 < (uint)game.turn) {
    SplitOutShdefs(rgRecycleShdef);
    _memset(&ord_2.wFlags,0,0x10);
    ord_2.wFlags = CONCAT11(ord_2.wFlags._1_1_,2);
    SplitOutShdefs((byte *)&ord_2.wFlags);
    _memset(&ord_2.wFlags,0,0x10);
    ord_2.wFlags = CONCAT11(2,(undefined1)ord_2.wFlags);
    SplitOutShdefs((byte *)&ord_2.wFlags);
    _memset(&ord_2.wFlags,0,0x10);
    ord_2.txp.rgia[4].wFlags._1_1_ = 2;
    SplitOutShdefs((byte *)&ord_2.wFlags);
  }
  EnsureRobotoidShdefs();
  cFlDestroyers = 0;
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar16 = ((FLEET **)rglpfl)[ifl];
    iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar14,pFVar16);
    if ((pFVar16 == (FLEET *)0x0) && (iVar14 == 0)) break;
    if (((pFVar16->iPlayer == idPlayer) && (iLatestDestroyer != -1)) &&
       ((pFVar16->rgcsh[0xe] != 0 || (pFVar16->rgcsh[0xf] != 0)))) {
      cFlDestroyers = cFlDestroyers + 1;
    }
  }
  sVar8 = FShouldWeBuildColonizers(&cColFleet);
  UpdateProgressGauge(-0x39e);
  lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
  lpplMac._2_2_ = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < (PLANET *)lpplMac) {
    uVar19 = (undefined2)((ulong)lppl >> 0x10);
    if ((((PLANET *)lppl)->iPlayer != idPlayer) && (((PLANET *)lppl)->iPlayer != -1)) {
      uVar9 = (((PLANET *)lppl)->uGuesses & 0xfffU) / 0xfa + 1;
      i._0_1_ = (byte)uVar9;
      if (6 < uVar9) {
        i._0_1_ = 6;
      }
      if (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) != 0) {
        i._0_1_ = (byte)i + 1;
      }
      ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 10] = (byte)i;
      ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 9] = 1;
    }
    lppl = (PLANET *)CONCAT22(uVar19,(PLANET *)lppl + 1);
  }
  for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
                    /* WARNING: Load size is inaccurate */
    pPVar13 = ((PLANET **)vrglpplAi)[ipl];
    iVar14 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
    lppl = (PLANET *)CONCAT22(iVar14,pPVar13);
    if ((pPVar13 == (PLANET *)0x0) && (iVar14 == 0)) break;
    if ((((uint)pPVar13->wFlags >> 9 & 1) != 0) &&
       ((iVar5 = *(int *)((int)pPVar13->rgwtMin + 0xe), 0 < iVar5 ||
        ((-1 < iVar5 && (199 < *(uint *)(pPVar13->rgwtMin + 3))))))) {
      ChangeMainObjSel(1,lppl->id);
      InitProduction(rgprod);
      fWrite = 0;
      i = 0;
      while ((i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac &&
             ((uVar21 = __aFulshr(uVar22,ord_2.pt.x), ((uint)uVar21 & 7) != 2 ||
              (uVar21 = __aFulshr(uVar22,ord_2.pt.x), 0xf < ((uint)uVar21 & 0x7f)))))) {
        i = i + 1;
      }
      if (i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac) {
        FinishProduction(0);
      }
      else {
        uVar19 = (undefined2)((ulong)vlpbAiData >> 0x10);
        if (*(int *)((byte *)vlpbAiData + 2) * 4 <
            *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 8) {
          cFr = *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 8;
        }
        else {
          cFr = *(int *)((byte *)vlpbAiData + 2) << 2;
        }
        if ((iLatestCargo != -1) &&
           ((cExistCargo < (cFr << 3) / 10 ||
            ((cExistCargo < cFr && (sVar10 = Random(3), sVar10 == 0)))))) {
          AddItemToQueue(iLatestCargo,1,grobjFleet,1);
          fWrite = 1;
        }
        if (((sVar8 != 0) ||
            ((cColFleet < 0x1a &&
             (sVar10 = Random(*(int *)((byte *)vlpbAiData + 2) << 3), sVar10 == 0)))
            ) && (4 < (uint)game.turn)) {
          if ((uint)game.turn < 0x15) {
            AddItemToQueue(1,1,grobjFleet,1);
          }
          AddItemToQueue(1,1,grobjFleet,1);
          fWrite = 1;
          sVar10 = PctTrueMaxGrowth(idPlayer);
          uVar21 = __aFulmul(CONCAT22(*(undefined2 *)((int)pPVar13->rgwtMin + 0xe),
                                              (int)pPVar13->rgwtMin[3]),(long)sVar10);
          cRes = CResourcesAtPlanet((PLANET *)CONCAT22(iVar14,pPVar13),idPlayer);
          if (((((0x8fc < (long)uVar21) && (0x23 < cRes)) && (0 < iAiLvl)) &&
              ((AddItemToQueue(1,1,grobjFleet,1), 0xe10 < (long)uVar21 && (0x32 < cRes)))) &&
             (1 < iAiLvl)) {
            AddItemToQueue(1,1,grobjFleet,1);
          }
        }
        if ((rgshdef[0].hul.ihuldef == ihuldefFrigate) &&
           (sVar10 = Random(4), sVar10 == 0)) {
          cFr = 0;
          for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
            pFVar16 = ((FLEET **)rglpfl)[ifl];
            iVar5 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
            lpfl = (FLEET *)CONCAT22(iVar5,pFVar16);
            if ((pFVar16 == (FLEET *)0x0) && (iVar5 == 0)) break;
            if ((pFVar16->idPlanet == lppl->id) &&
               ((0 < pFVar16->rgcsh[0] && (pFVar16->iPlayer == idPlayer)))) {
              cFr = pFVar16->rgcsh[0];
              break;
            }
          }
          if (((cFr < 10) || ((cFr < 0x11 && (sVar10 = Random(10), sVar10 == 0)))) &&
             (sVar10 = Random(cFr * 2 + 1), sVar10 == 0)) {
            AddItemToQueue(0,4,grobjFleet,1);
            fWrite = 1;
          }
        }
        for (i = 0; i < 3; i = i + 1) {
          iVar5 = *(int *)((int)(pPVar13->rgwtMin + i) + 2);
          if ((iVar5 < 1) &&
             ((iVar5 < 0 || (*(undefined **)(pPVar13->rgwtMin + i) < (undefined *)&DAT_1120_1388))))
          break;
        }
        fTonsOfMinerals = (short)(i == 2);
        if (iLatestBomber != -1) {
          iVar5 = lppl->id;
          for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
            pFVar16 = ((FLEET **)rglpfl)[ifl];
            iVar6 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
            lpfl = (FLEET *)CONCAT22(iVar6,pFVar16);
            if ((pFVar16 == (FLEET *)0x0) && (iVar6 == 0)) break;
            if ((pFVar16->idPlanet == iVar5) &&
               ((pFVar16->iPlayer == idPlayer &&
                (sVar10 = FPotentRobWarFleet((FLEET *)CONCAT22(iVar6,pFVar16),2), sVar10 != 0)))) {
              if ((iLatestBomber != -1) &&
                 (uVar19 = (undefined2)((ulong)lpfl >> 0x10),
                 ((FLEET *)lpfl)->rgcsh[9] + ((FLEET *)lpfl)->rgcsh[10] <
                 (int)(uint)vrgAiArmadaPotency[2])) {
                if (fTonsOfMinerals == 0) {
                  uVar12 = 4;
                }
                else {
                  uVar12 = 6;
                }
                AddItemToQueue(iLatestBomber,uVar12,grobjFleet,1);
                fWrite = 1;
                goto AI_FinishProd_4;
              }
              break;
            }
          }
        }
        if (iLatestMeta != -1) {
          if (((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestMeta * 0x93) == 0) &&
              (*(uint *)((int)&rgshdef[0].cExist + iLatestMeta * 0x93) <
               game.cPlanMax / 7 + 6U)) || (sVar10 = Random(2), sVar10 != 0)) {
            if ((iLatestBattle == -1) || (sVar10 = Random(2), sVar10 != 0)) {
              lpplDrop._2_2_ = iLatestMeta;
            }
            else {
              lpplDrop._2_2_ = iLatestBattle;
            }
            GetResourcesAvailable((PLANET *)CONCAT22(iVar14,pPVar13),rgResAvail);
            GetProdQCost((PLANET *)CONCAT22(iVar14,pPVar13),rgResCost);
            for (i = 0; i < 4; i = i + 1) {
              uVar11 = *(uint *)(rgResCost + i);
              iVar5 = *(int *)((int)rgResCost + i * 4 + 2);
              puVar1 = (uint *)(rgResAvail + i);
              uVar9 = *puVar1;
              *puVar1 = *puVar1 - uVar11;
              piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
              *piVar2 = (*piVar2 - iVar5) - (uint)(uVar9 < uVar11);
              iVar5 = *(int *)((int)rgResAvail + i * 4 + 2);
              if ((iVar5 < 1) && (iVar5 < 0)) goto AI_FinishProd_4;
            }
            GetTrueHullCost
                      (idPlayer,
                       (HUL *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                       (HUL *)(lpplDrop._2_2_ * 0x93 + 0x3f00)),rgCosts);
            for (j = 0; j < 4; j = j + 1) {
              uVar11 = (uint)(((long)(int)rgCosts[j] * 3 & 0xffffU) / 5);
              puVar1 = (uint *)(rgResAvail + j);
              uVar9 = *puVar1;
              *puVar1 = *puVar1 - uVar11;
              piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
              *piVar2 = *piVar2 - (uint)(uVar9 < uVar11);
              iVar5 = *(int *)((int)rgResAvail + j * 4 + 2);
              if ((iVar5 < 1) && (iVar5 < 0)) goto AI_TryShip3_2;
            }
            if (fTonsOfMinerals == 0) {
              uVar12 = 1;
            }
            else {
              uVar12 = 5;
            }
            AddItemToQueue(lpplDrop._2_2_,uVar12,grobjFleet,1);
            fWrite = 1;
          }
        }
AI_TryShip3_2:
        if (iLatestDestroyer != -1) {
          if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestDestroyer * 0x93) == 0) &&
             (*(uint *)((int)&rgshdef[0].cExist + iLatestDestroyer * 0x93) <
              game.cPlanMax / 0xc + 8U)) {
            GetResourcesAvailable((PLANET *)CONCAT22(iVar14,pPVar13),rgResAvail);
            GetProdQCost((PLANET *)CONCAT22(iVar14,pPVar13),rgResCost);
            for (i = 0; i < 4; i = i + 1) {
              uVar11 = *(uint *)(rgResCost + i);
              iVar14 = *(int *)((int)rgResCost + i * 4 + 2);
              puVar1 = (uint *)(rgResAvail + i);
              uVar9 = *puVar1;
              *puVar1 = *puVar1 - uVar11;
              piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
              *piVar2 = (*piVar2 - iVar14) - (uint)(uVar9 < uVar11);
              iVar14 = *(int *)((int)rgResAvail + i * 4 + 2);
              if ((iVar14 < 1) && (iVar14 < 0)) goto AI_FinishProd_4;
            }
            for (i = 0; i < 5; i = i + 1) {
              GetTrueHullCost
                        (idPlayer,
                         (HUL *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                         (HUL *)(iLatestDestroyer * 0x93 + 0x3f00)),rgCosts);
              for (j = 0; j < 4; j = j + 1) {
                uVar11 = rgCosts[j];
                puVar1 = (uint *)(rgResAvail + j);
                uVar9 = *puVar1;
                *puVar1 = *puVar1 - uVar11;
                piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                *piVar2 = *piVar2 - (uint)(uVar9 < uVar11);
                iVar14 = *(int *)((int)rgResAvail + j * 4 + 2);
                if ((iVar14 < 1) && (iVar14 < 0)) goto AI_FinishProd_4;
              }
              fWrite = 1;
              AddItemToQueue(iLatestDestroyer,1,grobjFleet,1);
            }
          }
        }
AI_FinishProd_4:
        FinishProduction(fWrite);
      }
    }
  }
  UpdateProgressGauge(-0x39e);
  lpflAttack._0_2_ = (FLEET *)0x0;
  lpflAttack._2_2_ = 0;
  lpflEnemy._0_2_ = (FLEET *)0x0;
  lpflEnemy._2_2_ = 0;
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar16 = ((FLEET **)rglpfl)[ifl];
    iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar14,pFVar16);
    if ((pFVar16 == (FLEET *)0x0) && (iVar14 == 0)) break;
    pbVar15 = (byte *)ord_2.txp.rgia[4].wFlags;
    if ((1 < pFVar16->cord) && (((uint)((PLORD *)pFVar16->lpplord + 7)->wFlags >> 8 & 0xf) == 8)) {
      ord_2.txp.rgia[3].wFlags = (&pFVar16->pt)->x - *(int *)&((PLORD *)pFVar16->lpplord)[5].iordMax
      ;
      iVar14 = (pFVar16->pt).y - ((PLORD *)pFVar16->lpplord + 6)->wFlags;
      uVar22 = __aFulmul((long)iVar14,(long)iVar14);
      ord_2.txp.rgia._2_4_ = uVar22;
      uVar22 = __aFulmul((long)ord_2.txp.rgia[3].wFlags,(long)ord_2.txp.rgia[3].wFlags);
      pbVar3 = (byte *)(uVar22 + ord_2.txp.rgia._2_4_);
      pbVar15 = (byte *)pbVar3;
      ord_2.txp.rgia[4].wFlags._0_1_ = SUB41(pbVar3,0);
      ord_2.txp.rgia[4].wFlags._1_1_ = (undefined1)((ulong)pbVar3 >> 8);
      if ((-1 < (long)pbVar3) && ((0 < (int)((ulong)pbVar3 >> 0x10) || ((byte *)0x9c40 < pbVar15))))
      {
        ChangeMainObjSel(2,lpfl->id);
        sel.fl.cord = 1;
        ((PLORD *)sel.fl.lpplord)->iordMac = 1;
        FLookupFleet(-1,(FLEET *)&sel.fl);
        pbVar15 = (byte *)CONCAT11(ord_2.txp.rgia[4].wFlags._1_1_,
                                   (undefined1)ord_2.txp.rgia[4].wFlags);
      }
    }
    ord_2.txp.rgia[4].wFlags = (short)pbVar15;
    uVar19 = (undefined2)((ulong)lpfl >> 0x10);
    pFVar16 = (FLEET *)lpfl;
    if (pFVar16->iPlayer == idPlayer) {
      if (((pFVar16->rgcsh[0] < 1) || ((uint)game.turn < 0x29)) || (pFVar16->cord != 1)) {
        sVar8 = FIsAiAttack(lpfl);
        if (sVar8 == 0) {
          sVar8 = FIsAiTransport(lpfl);
          if (sVar8 != 0) {
            idPlanDst = -1;
            uVar19 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar16 = (FLEET *)lpfl;
            if ((pFVar16->cord < 2) ||
               ((*(uint *)&((PLORD *)pFVar16->lpplord)[2].iordMax & 0xf) != 0)) {
              idPlanDst = pFVar16->idPlanet;
            }
            else if (((uint)((PLORD *)pFVar16->lpplord + 7)->wFlags >> 8 & 0xf) == 1) {
              idPlanDst = *(short *)&((PLORD *)pFVar16->lpplord)[6].iordMax;
            }
            if (idPlanDst != -1) {
              lppl = LpplFromId(idPlanDst);
              iVar14 = (int)((ulong)lppl >> 0x10);
              if ((((PLANET *)lppl == (PLANET *)0x0) && (iVar14 == 0)) ||
                 (((PLANET *)lppl)->iPlayer != idPlayer)) {
                uVar19 = (undefined2)((ulong)lpfl >> 0x10);
                if (((int)((FLEET *)lpfl)->rgwtMin[3] == 0) &&
                   (*(int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe) == 0)) {
                  ChangeMainObjSel(2,lpfl->id);
                  sel.fl.cord = 1;
                  ((PLORD *)sel.fl.lpplord)->iordMac = 1;
                  FLookupFleet(-1,(FLEET *)&sel.fl);
                  ClearAiCurrentTask(lpfl,0);
                }
              }
            }
          }
        }
        else {
          *(FLEET **)&((FLEET *)lpfl)->lpflNext = (FLEET *)lpflAttack;
          *(undefined2 *)((int)&((FLEET *)lpfl)->lpflNext + 2) = lpflAttack._2_2_;
          lpflAttack._0_2_ = (FLEET *)lpfl;
          lpflAttack._2_2_ = lpfl._2_2_;
          if ((*(uint *)&((PLORD *)((FLEET *)lpfl)->lpplord)[2].iordMax & 0xf) == 6) {
            ClearAiCurrentTask(lpfl,1);
          }
          j = 2;
          while( true ) {
            if ((7 < j) || (0 < ((FLEET *)lpfl)->rgcsh[j])) break;
            j = j + 1;
          }
          if ((j < 8) &&
             (((1 < ((FLEET *)lpfl)->cord &&
               (((uint)((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 8 & 0xf) == 1)) ||
              (((FLEET *)lpfl)->idPlanet != -1)))) {
            if ((((FLEET *)lpfl)->cord < 2) ||
               (((uint)((PLORD *)((FLEET *)lpfl)->lpplord + 7)->wFlags >> 8 & 0xf) != 1)) {
              lpplDrop._2_2_ = ((FLEET *)lpfl)->idPlanet;
            }
            else {
              lpplDrop._2_2_ = *(ushort *)&((PLORD *)((FLEET *)lpfl)->lpplord)[6].iordMax;
            }
            pbVar15 = (byte *)vlpbAiPlanet + lpplDrop._2_2_ * 0x10 + 10;
            ord_2.txp.rgia[4].wFlags._0_1_ = SUB21(pbVar15,0);
            ord_2.txp.rgia[4].wFlags._1_1_ = (undefined1)((uint)pbVar15 >> 8);
            lpplDrop._0_1_ = (undefined1)vlpbAiPlanet._2_2_;
            lpplDrop._1_1_ = (undefined1)((uint)vlpbAiPlanet._2_2_ >> 8);
            ord_2.txp.rgia[4].wFlags = (short)pbVar15;
            if (*(char *)CONCAT13(lpplDrop._1_1_,CONCAT12(lpplDrop._0_1_,pbVar15)) != '\0') {
              pbVar3 = (byte *)CONCAT13(lpplDrop._1_1_,CONCAT12(lpplDrop._0_1_,pbVar15));
              *pbVar3 = *pbVar3 | 0x80;
            }
          }
        }
      }
      else {
        if (6 < pFVar16->rgcsh[0]) {
          sVar8 = Random(5);
          if (sVar8 == 0) {
            uVar19 = (undefined2)((ulong)lpfl >> 0x10);
            pt.y = (((FLEET *)lpfl)->pt).y;
            pt.x = (&((FLEET *)lpfl)->pt)->x;
            sVar8 = IdRandomPlanetNearby(pt,0x69,1);
            if ((sVar8 != -1) && (sVar8 != ((FLEET *)lpfl)->idPlanet)) {
              ClearAiCurrentTask(lpfl,1);
              ord_2.id = ((POINT *)rgptPlan + sVar8)->x;
              ord_2.wFlags = *(short *)((int)&rgptPlan[0].y + sVar8 * 4);
              ord_2.txp.rgia[1].wFlags = ord_2.txp.rgia[1].wFlags & 0xe000U | 0x1140;
              ord_2.txp.rgia[0].wFlags = sVar8;
              FMoveAiFleet(lpfl,(ORDER *)&ord_2.id,0);
              goto LAB_1088_15d1;
            }
          }
        }
        pPVar7 = ((FLEET *)lpfl)->lpplord;
        if ((*(uint *)&((PLORD *)pPVar7)[2].iordMax & 0xf) == 0) {
          ChangeMainObjSel(2,lpfl->id);
          uVar19 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
          *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
               *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 6;
          ((PLORD *)sel.fl.lpplord + 3)->wFlags = 5;
          pbVar3 = &((PLORD *)sel.fl.lpplord)[3].iordMax;
          pbVar3[0] = 5;
          pbVar3[1] = 0;
          FLookupFleet(-1,(FLEET *)&sel.fl);
          goto LAB_1088_10bf;
        }
      }
LAB_1088_15d1:
      pFVar16 = (FLEET *)lpfl;
      uVar19 = (undefined2)((ulong)lpfl >> 0x10);
      if (((uint)game.turn < 0x15) && (0 < pFVar16->rgcsh[0])) {
        ChangeMainObjSel(2,lpfl->id);
        uVar19 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
        *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
             *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
        FLookupFleet(-1,(FLEET *)&sel.fl);
      }
      else if (((pFVar16->cord < 2) && (pFVar16->rgcsh[1] != 0)) &&
              ((4 < (uint)game.turn || (game.mdStartDist == 0)))) {
        if ((1 < iAiLvl) && (pFVar16->idPlanet != -1)) {
          pPVar23 = LpplFromId(pFVar16->idPlanet);
          uVar19 = (undefined2)((ulong)pPVar23 >> 0x10);
          pPVar13 = (PLANET *)pPVar23;
          if (((pPVar23 != (PLANET *)0x0) && (pPVar13->iPlayer != -1)) &&
             (pPVar13->iPlayer != idPlayer)) {
            uVar20 = (undefined2)((ulong)lpfl >> 0x10);
            iVar14 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
            if ((-1 < iVar14) && ((0 < iVar14 || ((int)((FLEET *)lpfl)->rgwtMin[3] != 0)))) {
              sVar8 = GetRaceStat((PLAYER *)rgplr + pPVar13->iPlayer,rsMajorAdv);
              if (sVar8 != raMacintosh) {
                _memset(&ord_2,0,0x12);
                ord_2.pt.x = ((POINT *)rgptPlan + pPVar23->id)->x;
                ord_2.pt.y = *(short *)((int)&rgptPlan[0].y + pPVar23->id * 4);
                ord_2.id = pPVar23->id;
                ord_2.wFlags = ord_2.wFlags & 0xe0f0U | 0x1101;
                ord_2.txp.rgia[3].wFlags = ord_2.txp.rgia[3].wFlags & 0xfffU | 0x2000;
                ChangeMainObjSel(2,lpfl->id);
                uVar19 = sel.fl.lpplord._2_2_;
                pPVar18 = (PLORD *)sel.fl.lpplord + 1;
                pOVar17 = &ord_2;
                for (iVar14 = 9; iVar14 != 0; iVar14 = iVar14 + -1) {
                  pPVar7 = pPVar18;
                  pPVar18 = (PLORD *)&pPVar18->iordMax;
                  pOVar4 = pOVar17;
                  pOVar17 = (ORDER *)&(pOVar17->pt).y;
                  pPVar7->wFlags = (pOVar4->pt).x;
                }
                FLookupFleet(-1,(FLEET *)&sel.fl);
                pPVar23 = LpplFindClosestEnum(pPVar23,FEnumOurStarbase);
                if (pPVar23 != (PLANET *)0x0) {
                  _memset(&ord_2,0,0x12);
                  ord_2.id = pPVar23->id;
                  ord_2.pt.x = ((POINT *)rgptPlan + pPVar23->id)->x;
                  ord_2.pt.y = *(short *)((int)&rgptPlan[0].y + pPVar23->id * 4);
                  ord_2.wFlags = ord_2.wFlags & 0xe000U | 0x1140;
                  FMoveAiFleet(lpfl,&ord_2,0);
                }
                goto LAB_1088_10bf;
              }
            }
          }
        }
        sVar8 = IdNearestColonizablePlanet(lpfl,&lpthWorm);
        if (((sVar8 == -1) && ((THING *)lpthWorm == (THING *)0x0)) && (lpthWorm._2_2_ == 0)) {
          if (((FLEET *)lpfl)->idPlanet != -1) {
            ChangeMainObjSel(2,lpfl->id);
            uVar19 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
            *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                 *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
            FLookupFleet(-1,(FLEET *)&sel.fl);
          }
        }
        else {
          ChangeMainObjSel(2,lpfl->id);
          uVar19 = (undefined2)((ulong)lpfl >> 0x10);
          if (((FLEET *)lpfl)->idPlanet != -1) {
            XferAiSupply(1,((FLEET *)lpfl)->idPlanet,2,lpfl->id,3,10);
            FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
          }
          if (sVar8 == -1) {
            FGotoWormholeAiFleet(lpfl,(THING *)CONCAT22(lpthWorm._2_2_,(THING *)lpthWorm));
          }
          else {
            FColonizeAiFleet(lpfl,sVar8);
          }
        }
      }
    }
    else {
      *(FLEET **)&pFVar16->lpflNext = (FLEET *)lpflEnemy;
      *(undefined2 *)((int)&pFVar16->lpflNext + 2) = lpflEnemy._2_2_;
      lpflEnemy._0_2_ = pFVar16;
      lpflEnemy._2_2_ = uVar19;
    }
LAB_1088_10bf:
  }
  for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
                    /* WARNING: Load size is inaccurate */
    pPVar13 = ((PLANET **)vrglpplAi)[ipl];
    iVar14 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
    lppl = (PLANET *)CONCAT22(iVar14,pPVar13);
    if (((pPVar13 == (PLANET *)0x0) && (iVar14 == 0)) || (((uint)pPVar13->wFlags >> 9 & 1) != 0))
    break;
  }
  if (ipl == vclpplAi) {
    lppl._0_2_ = (PLANET *)0x0;
    lppl._2_2_ = 0;
  }
  else {
  }
  lpplHome._0_2_ = (PLANET *)lppl;
  lpplHome._2_2_ = lppl._2_2_;
  if (((PLANET *)lppl != (PLANET *)0x0) || (lppl._2_2_ != 0)) {
    for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
      pFVar16 = ((FLEET **)rglpfl)[ifl];
      iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
      lpfl = (FLEET *)CONCAT22(iVar14,pFVar16);
      if ((pFVar16 == (FLEET *)0x0) && (iVar14 == 0)) break;
      if ((pFVar16->iPlayer == idPlayer) && (pFVar16->cord < 2)) {
        sVar8 = FIsAiTransport((FLEET *)CONCAT22(iVar14,pFVar16));
        if (sVar8 != 0) {
          if (((FLEET *)lpfl)->iplan != 4) {
            ChangeMainObjSel(2,lpfl->id);
            sel.fl.iplan = 4;
            FLookupFleet(-1,(FLEET *)&sel.fl);
          }
          lppl = (PLANET *)0x0;
          i = 0;
          while( true ) {
            uVar19 = (undefined2)((ulong)vlpbAiData >> 0x10);
            pbVar15 = (byte *)vlpbAiData;
            if (*(int *)(pbVar15 + 2) <= i) break;
            j = 0;
            while ((j < *(int *)(pbVar15 + i * 0x14 + 6) &&
                   (*(int *)(pbVar15 + j * 2 + i * 0x14 + 8) != lpfl->id))) {
              j = j + 1;
            }
            if (j < *(int *)(pbVar15 + i * 0x14 + 6)) break;
            i = i + 1;
          }
          if (i < *(int *)(pbVar15 + 2)) {
            lppl = LpplFromId(*(short *)(pbVar15 + i * 0x14 + 4));
          }
          if (((PLANET *)lppl != (PLANET *)0x0) ||
             (pPVar13 = (PLANET *)lpplHome, iVar14 = lpplHome._2_2_, lppl._2_2_ != 0)) {
            pPVar13 = (PLANET *)lppl;
            iVar14 = lppl._2_2_;
          }
          IdTargetFreighter(lpfl,(PLANET *)CONCAT22(iVar14,pPVar13));
        }
      }
    }
    UpdateProgressGauge(-0x39e);
  }
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar16 = ((FLEET **)rglpfl)[ifl];
    iVar14 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar14,pFVar16);
    if ((pFVar16 == (FLEET *)0x0) && (iVar14 == 0)) break;
    if (pFVar16->iPlayer == idPlayer) {
      for (i = 0; (i < 0x10 && ((pFVar16->rgcsh[i] < 1 || (rgRecycleShdef[i] != 0)))); i = i + 1) {
      }
      if (i == 0x10) {
        if (pFVar16->idPlanet != -1) {
          pPVar23 = LpplFromId(pFVar16->idPlanet);
          uVar19 = (undefined2)((ulong)pPVar23 >> 0x10);
          if ((pPVar23 != (PLANET *)0x0) && (((PLANET *)pPVar23)->iPlayer == idPlayer)) {
            if (((uint)((PLANET *)pPVar23)->wFlags >> 9 & 1) == 0) {
              sVar8 = Random(5);
              if (sVar8 != 0) goto LAB_1088_1d52;
            }
            ChangeMainObjSel(2,lpfl->id);
            uVar19 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
            *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                 *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
            FLookupFleet(-1,(FLEET *)&sel.fl);
            goto LAB_1088_1c04;
          }
        }
LAB_1088_1d52:
        uVar19 = (undefined2)((ulong)lpfl >> 0x10);
        pFVar16 = (FLEET *)lpfl;
        if (((pFVar16->cord < 2) || (pFVar16->idPlanet != -1)) ||
           (((uint)((PLORD *)pFVar16->lpplord + 7)->wFlags >> 8 & 0xf) != 1)) {
          sVar8 = FMoveToNearestStarbase(lpfl,0);
          if (sVar8 == 0) goto LAB_1088_1da4;
        }
      }
      else {
LAB_1088_1da4:
        for (i = 2; i < 0xb; i = i + 1) {
          if (0 < ((FLEET *)lpfl)->rgcsh[i]) {
            IdTargetArmada(lpfl);
            break;
          }
        }
        if (10 < i) {
          sVar8 = FIsAiAttack(lpfl);
          if (sVar8 != 0) {
            uVar19 = (undefined2)((ulong)lpfl >> 0x10);
            if ((((FLEET *)lpfl)->cord < 2) ||
               (pPVar7 = ((FLEET *)lpfl)->lpplord,
               ((uint)((PLORD *)pPVar7 + 7)->wFlags >> 8 & 0xf) != 2)) {
              if ((uint)game.turn < 0x79) {
                iVar14 = 0x46;
              }
              else {
                iVar14 = 0x32;
              }
              if (iVar14 < cFlDestroyers) {
LAB_1088_1e81:
                if (0x13 < ((FLEET *)lpfl)->rgcsh[iLatestDestroyer]) {
                  sVar8 = Random(0x14);
                  if (sVar8 != 0) goto LAB_1088_1ee3;
                }
                sVar8 = FFindBuddyAndJoinUp(lpfl,0xe,0xf,0x24,0x48);
                if (sVar8 != 0) goto LAB_1088_1c04;
              }
              else {
                if ((uint)game.turn < 0x79) {
                  iVar14 = 0x3c;
                }
                else {
                  iVar14 = 0x28;
                }
                if (iVar14 < cFlDestroyers) {
                  sVar8 = Random(3);
                  if (sVar8 == 0) goto LAB_1088_1e81;
                }
              }
LAB_1088_1ee3:
              IdTargetAttack(lpfl,(FLEET *)CONCAT22(lpflAttack._2_2_,(FLEET *)lpflAttack),
                                  (FLEET *)CONCAT22(lpflEnemy._2_2_,(FLEET *)lpflEnemy),
                                  (uint)game.wCrap >> 4 & 1);
            }
          }
        }
      }
    }
LAB_1088_1c04:
  }
  HandleBasicAiTasks(iroCur,rgprod,ishdefSBLatest,rgResAvail,rgResCost);
  FillProductionQueue();
  return;
}



// ======================================================================
// Function: EnsureRobotoidShdefs
// Address: 1088:20ae
// Segment: MEMORY_AI
// ======================================================================


void EnsureRobotoidShdefs(void)

{
  SHDEF *pSVar1;
  HullDef *pHVar2;
  int iVar3;
  short sVar4;
  SHDEF *pSVar5;
  HullDef *pHVar6;
  undefined2 unaff_SS;
  undefined1 auStack_9c [148];
  short i;
  short ish;
  
  for (ish = 0xb; ish < 0xe; ish = ish + 1) {
    if (((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) &&
         ('\x01' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
        (auStack_9c._146_2_ =
              SEXT12(*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0)),
        (ish + -0xb) * 3 + 4 <= (int)auStack_9c._146_2_)) &&
       ((ish == 0xb ||
        (0xe < (uint)(game.turn -
                     *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93)))))) {
      if (*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) < '\n') {
        if (ish == 0xb) {
          iVar3 = 0xe;
        }
        else {
          iVar3 = 0xf;
        }
        FCreateAiShdef(ish,0xb,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                     (byte *)(((ushort *)vrgRobIshAip)[iVar3] +
                                                             0x1f80)));
      }
      else {
        for (i = 0; i < 5; i = i + 1) {
          sVar4 = Random(6);
          sVar4 = FCreateAiShdef(ish,0x1f,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                                (byte *)(((ushort *)vrgRobIshAip)
                                                                         [sVar4 + 8] + 0x1f80)));
          if (sVar4 != 0) break;
        }
      }
    }
  }
  if (((((uint)rgshdef[0xe].wFlags >> 9 & 1) != 0) &&
      ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
     (('\x05' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
      ((('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
        ('\x05' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
       ('\x01' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))))))) {
    for (i = 0; i < 5; i = i + 1) {
      sVar4 = FCreateAiShdef(0xe,0x1d,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                            (byte *)(vrgRobIshAip[0x25] + 0x1f80)));
      if (sVar4 == 0) {
        sVar4 = Random(4);
        sVar4 = FCreateAiShdef(0xe,6,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                           (byte *)(((ushort *)vrgRobIshAip)
                                                                    [sVar4 + 0x10] + 0x1f80)));
        if (sVar4 != 0) break;
      }
    }
  }
  if (((((uint)rgshdef[0xf].wFlags >> 9 & 1) != 0) &&
      ('\t' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
     ((('\a' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
       (('\b' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0) &&
        ('\r' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))))) &&
      (sVar4 = FCreateAiShdef(0xf,0x1d,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                             (byte *)(vrgRobIshAip[0x25] + 0x1f80)))
      , sVar4 == 0)))) {
    for (i = 0; i < 5; i = i + 1) {
      sVar4 = Random(4);
      sVar4 = FCreateAiShdef(0xf,6,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                         (byte *)(((ushort *)vrgRobIshAip)
                                                                  [sVar4 + 0x14] + 0x1f80)));
      if (sVar4 != 0) break;
    }
  }
  for (ish = 2; ish < 6; ish = ish + 1) {
    if (((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) &&
         ('\t' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
        ('\t' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) &&
       ((('\b' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0) &&
         ('\x05' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))) &&
        ((ish == 2 ||
         (((*(uint *)((int)&rgshdef[0].wFlags + (ish + -1) * 0x93) >> 9 & 1) == 0 &&
          (0xc < (uint)(game.turn -
                       *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93)))))))))) {
      if ((ish - 2U & 1) == 0) {
        auStack_9c._146_2_ = 0;
      }
      else {
        auStack_9c._146_2_ = 4;
      }
      for (i = 0; i < 5; i = i + 1) {
        sVar4 = Random(4);
        sVar4 = FCreateAiShdef(ish,0x1f,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                              (byte *)(((ushort *)vrgRobIshAip)
                                                                       [sVar4 + auStack_9c._146_2_]
                                                                      + 0x1f80)));
        if (sVar4 != 0) break;
      }
    }
  }
  ish = 6;
  do {
    if (7 < ish) {
      for (ish = 9; ish < 0xb; ish = ish + 1) {
        if (((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) &&
             ('\r' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
            ((ish == 9 ||
             (((*(uint *)((int)&rgshdef[0].wFlags + (ish + -1) * 0x93) >> 9 & 1) == 0 &&
              (0xf < (uint)(game.turn -
                           *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93)))))))) &&
           (sVar4 = FCreateAiShdef(ish,9,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                               (byte *)(vrgRobIshAip[0x24] + 0x1f80)
                                                              )), sVar4 == 0)) {
          if (ish == 9) {
            iVar3 = 0x18;
          }
          else {
            iVar3 = 0x19;
          }
          FCreateAiShdef(ish,0x13,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                        (byte *)(((ushort *)vrgRobIshAip)[iVar3] +
                                                                0x1f80)));
        }
      }
      if ((((((rgshdef[0].hul.ihuldef != ihuldefFrigate) &&
             (1 < (*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7)))
            && ((int)rgshdef[0].cExist == 0)) &&
           ((rgshdef[0].cExist._2_2_ == 0 &&
            ('\x03' < *(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0))))) &&
          (('\x04' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
           (('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
            ('\x05' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0)))))))
         && ('\x05' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))) {
        pSVar5 = (SHDEF *)rgshdef;
        pHVar6 = (HullDef *)auStack_9c;
        for (iVar3 = 0x49; iVar3 != 0; iVar3 = iVar3 + -1) {
          pHVar2 = pHVar6;
          pHVar6 = pHVar6 + 1;
          pSVar1 = pSVar5;
          pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
          *pHVar2 = (pSVar1->hul).ihuldef;
        }
        *(char *)pHVar6 = (char)(pSVar5->hul).ihuldef;
        auStack_9c._123_2_ = auStack_9c._123_2_ & 0xfdff | 0x200;
        FChangeAiShdef((SHDEF *)auStack_9c,0);
        FCreateAiShdef(0,5,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                 (byte *)(vrgRobIshAip[0x1a] + 0x1f80)));
      }
      return;
    }
    if (((((((*(uint *)((int)&rgshdef[0].wFlags + ish * 0x93) >> 9 & 1) != 0) &&
           ('\x03' < *(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0))) &&
          ('\t' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
         (('\v' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
          ('\v' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))) &&
        ('\x05' < *(char *)((int)rgplr[0].rgTech + idPlayer * 0xc0))) &&
       (('\x0e' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0) &&
        ((ish == 6 ||
         (((*(uint *)((int)&rgshdef[0].wFlags + (ish + -1) * 0x93) >> 9 & 1) == 0 &&
          (0x14 < (uint)(game.turn -
                        *(int *)((int)&rgshdef[0].turn + (ish + -1) * 0x93)))))))))) {
      if (ish == 6) {
        auStack_9c._146_2_ = 0x1b;
      }
      else {
        auStack_9c._146_2_ = 0x1f;
      }
      for (i = 0; i < 5; i = i + 1) {
        sVar4 = Random(4);
        sVar4 = FCreateAiShdef(ish,9,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                           (byte *)(((ushort *)vrgRobIshAip)
                                                                    [sVar4 + auStack_9c._146_2_] +
                                                                   0x1f80)));
        if (sVar4 != 0) break;
      }
    }
    ish = ish + 1;
  } while( true );
}



// ======================================================================
// Function: IdTargetArmada
// Address: 1088:288e
// Segment: MEMORY_AI
// ======================================================================


/* WARNING: Variable defined which should be unmapped: cXfer */
/* WARNING: Removing unreachable block (ram,0x10883131) */
/* WARNING: Removing unreachable block (ram,0x1088304d) */
/* WARNING: Removing unreachable block (ram,0x10883007) */
/* WARNING: Removing unreachable block (ram,0x108828ed) */
/* WARNING: Removing unreachable block (ram,0x10882b7b) */
/* WARNING: Removing unreachable block (ram,0x1088301d) */
/* WARNING: Removing unreachable block (ram,0x108830bb) */
/* WARNING: Removing unreachable block (ram,0x1088316e) */

short IdTargetArmada(FLEET *lpfl)

{
  short *psVar1;
  ORDER *pOVar2;
  uint uVar3;
  POINT pt1;
  POINT pt2;
  PLANET *pPVar4;
  int iVar5;
  short sVar6;
  int iVar7;
  int iVar8;
  FLEET *pFVar9;
  undefined2 unaff_SI;
  short *psVar10;
  undefined2 unaff_DI;
  ORDER *pOVar11;
  undefined2 uVar12;
  undefined2 unaff_SS;
  PLANET *pPVar13;
  FLEET *pFVar14;
  ulong uVar15;
  ulong uVar16;
  long lVar17;
  long lVar18;
  long lVar19;
  undefined2 uVar20;
  undefined2 uVar21;
  long cXfer;
  long lPopEnemy;
  long lPopUs;
  long pctDef;
  short cshBomb;
  long cCol;
  PLANET *lppl;
  short ish;
  ORDER ord;
  PLANET *lpplTarget;
  FLEET *lpflTarget;
  short cshWar;
  
  lVar17 = CONCAT22(unaff_SI,unaff_DI);
  uVar12 = (undefined2)((ulong)lpfl >> 0x10);
  pFVar9 = (FLEET *)lpfl;
  if (1 < pFVar9->cord) {
    uVar20 = *(undefined2 *)((int)&pFVar9->lpplord + 2);
    psVar10 = (short *)(*(int *)&pFVar9->lpplord + 0x16);
    pOVar11 = &ord;
    for (iVar5 = 9; iVar5 != 0; iVar5 = iVar5 + -1) {
      pOVar2 = pOVar11;
      pOVar11 = (ORDER *)&(pOVar11->pt).y;
      psVar1 = psVar10;
      psVar10 = psVar10 + 1;
      (pOVar2->pt).x = *psVar1;
    }
    pt1.y = (pFVar9->pt).y;
    pt1.x = (&pFVar9->pt)->x;
    pt2.y = ord.pt.y;
    pt2.x = ord.pt.x;
    lVar18 = LDistance2(pt1,pt2);
    if ((lVar18 < 0xf425) || (((uint)ord.wFlags >> 8 & 0xf) != 2)) {
      if (((uint)ord.wFlags >> 8 & 0xf) == 2) {
        return 0;
      }
      if (((uint)ord.wFlags >> 8 & 0xf) == 1) {
        pPVar13 = LpplFromId(ord.id);
        iVar5 = (int)((ulong)pPVar13 >> 0x10);
        pPVar4 = (PLANET *)pPVar13;
        if ((((pPVar4 == (PLANET *)0x0) && (iVar5 == 0)) ||
            ((pPVar4->iPlayer != -1 &&
             ((pPVar4->iPlayer != idPlayer || (((uint)pPVar4->wFlags >> 9 & 1) != 0)))))) ||
           (pPVar4->turn != game.turn)) {
          return 0;
        }
      }
    }
  }
  cshWar = 0;
  for (ish = 2; ish < 6; ish = ish + 1) {
    cshWar = cshWar + pFVar9->rgcsh[ish];
  }
  for (ish = 6; ish < 8; ish = ish + 1) {
    cshWar = cshWar + pFVar9->rgcsh[ish] * 2;
  }
  iVar5 = pFVar9->rgcsh[9] + pFVar9->rgcsh[10];
  pFVar9->wFlags = pFVar9->wFlags & 0x7fffU | 0x8000;
  ChangeMainObjSel(2,lpfl->id);
  if (pFVar9->idPlanet == -1) {
    MoveToNearestPlanetOrEnemy(lpfl,0x96);
    return 0;
  }
  pPVar13 = LpplFromId(pFVar9->idPlanet);
  uVar20 = (undefined2)((ulong)pPVar13 >> 0x10);
  pPVar4 = (PLANET *)pPVar13;
  if ((pPVar4->iPlayer == idPlayer) && (((uint)pPVar4->wFlags >> 9 & 1) != 0)) {
    if ((cshWar < (int)(uint)vrgAiArmadaPotency[0]) ||
       (iVar5 < (int)(uint)vrgAiArmadaPotency[2])) {
      if ((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) < 2) {
        return 0;
      }
      if ((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 2)) && (cshWar < 0x3c)) {
        return 0;
      }
      sVar6 = Random(10);
      if ((4 < sVar6) &&
         ((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 3) ||
          (sVar6 = Random(10), 6 < sVar6)))) {
        if (cshWar < 0x79) {
          return 0;
        }
        sVar6 = Random(10);
        if (6 < sVar6) {
          return 0;
        }
      }
    }
    else {
      if ((sel.pl.rgwtMin[3]._2_2_ < 0) ||
         ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((uint)sel.pl.rgwtMin[3] < 0xbb9)))) {
        if ((sel.pl.rgwtMin[3]._2_2_ < 0) ||
           ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((uint)sel.pl.rgwtMin[3] < 0x7d1))))
        {
          if ((sel.pl.rgwtMin[3]._2_2_ < 0) ||
             ((sel.pl.rgwtMin[3]._2_2_ < 1 && ((uint)sel.pl.rgwtMin[3] < 0x3e9))
             )) {
            lVar17 = 0;
          }
          else {
            lVar17 = __aFldiv(CONCAT22(sel.pl.rgwtMin[3]._2_2_,
                                               (uint)sel.pl.rgwtMin[3]),0x14);
          }
        }
        else {
          lVar17 = __aFldiv(CONCAT22(sel.pl.rgwtMin[3]._2_2_,
                                             (uint)sel.pl.rgwtMin[3]),0xf);
        }
      }
      else {
        lVar17 = __aFldiv(CONCAT22(sel.pl.rgwtMin[3]._2_2_,
                                           (uint)sel.pl.rgwtMin[3]),10);
      }
      cCol._0_2_ = (short)lVar17;
      if (0 < lVar17) {
        XferAiSupply(1,pFVar9->idPlanet,2,lpfl->id,3,(short)cCol);
        FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
      }
    }
  }
  else if ((cshWar < (int)(uint)vrgAiArmadaPotency[1]) ||
          (iVar5 < (int)(uint)vrgAiArmadaPotency[3])) {
    ClearAiCurrentTask(lpfl,0);
    if (((*(uint *)((int)&rgplr[0].wMdPlr + idPlayer * 0xc0) >> 10 & 7) < 2) ||
       ((((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 2) ||
          (sVar6 = Random(10), 4 < sVar6)) &&
         ((cshWar <= (int)((uint)vrgAiArmadaPotency[0] * 4) ||
          (sVar6 = Random(10), 6 < sVar6)))) &&
        ((cshWar < 0x79 || (sVar6 = Random(10), 6 < sVar6)))))) {
      lpplTarget = LpplFindClosestEnum(pPVar13,FEnumOurStarbase);
      goto AI_TargetEveryArmada_3;
    }
  }
  else if (pPVar4->iPlayer != -1) {
    if (pPVar4->iPlayer != idPlayer) {
      if (pPVar4->iPlayer == idPlayer) {
        return 0;
      }
      uVar3 = *(uint *)(pFVar9->rgwtMin + 3);
      iVar5 = *(int *)((int)pFVar9->rgwtMin + 0xe);
      uVar15 = __aFlshl(lVar17,(ushort)cXfer);
      uVar16 = __aFulmul((ulong)((uint)pPVar4->uGuesses >> 0xc),6);
      uVar21 = 0;
      uVar20 = 4;
      uVar16 = __aFulmul(uVar16 + 6,3);
      lVar17 = __aFldiv(uVar16,CONCAT22(uVar21,uVar20));
      iVar7 = 100 - (uint)lVar17;
      iVar8 = -(uint)(100 < (uint)lVar17) - (int)((ulong)lVar17 >> 0x10);
      uVar15 = __aFulmul(uVar15,100);
      uVar15 = __aFldiv(uVar15,CONCAT22(iVar8,iVar7));
      lVar17 = __aFldiv(CONCAT22(iVar5,uVar3),5);
      if ((lVar17 <= (long)uVar15) &&
         ((199 < (long)uVar15 || ((iVar5 < 1 && ((iVar5 < 0 || (uVar3 < 0x15f)))))))) {
        if (9 < (long)uVar15) {
          return 0;
        }
        if (iVar5 < 0) {
          return 0;
        }
        if ((iVar5 < 1) && (uVar3 < 0x97)) {
          return 0;
        }
      }
      uVar21 = 0;
      uVar20 = 4;
      uVar15 = __aFulmul(uVar15,5);
      lVar18 = __aFldiv(uVar15,CONCAT22(uVar21,uVar20));
      lVar19 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe),
                                         (int)pFVar9->rgwtMin[3]),2);
      lVar17 = lVar18;
      if (lVar18 <= lVar19) {
        lVar17 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe),
                                           (int)pFVar9->rgwtMin[3]),2);
      }
      iVar7 = (int)((ulong)lVar17 >> 0x10);
      iVar5 = *(int *)((int)pFVar9->rgwtMin + 0xe);
      if ((iVar7 < iVar5) || ((iVar7 <= iVar5 && ((uint)lVar17 <= *(uint *)(pFVar9->rgwtMin + 3)))))
      {
        lVar17 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe),
                                           (int)pFVar9->rgwtMin[3]),2);
        if (lVar18 <= lVar17) {
          lVar18 = __aFldiv(CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe),
                                             (int)pFVar9->rgwtMin[3]),2);
        }
      }
      else {
        lVar18 = CONCAT22(*(undefined2 *)((int)pFVar9->rgwtMin + 0xe),(int)pFVar9->rgwtMin[3]);
      }
      if (30000 < lVar18) {
        lVar18 = 30000;
      }
      cXfer._0_2_ = (ushort)lVar18;
      XferAiTroopers(lpfl->id,pPVar13->id,(ushort)cXfer);
      FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
      return 0;
    }
    iVar5 = *(int *)((int)pPVar4->rgwtMin + 0xe);
    if ((-1 < iVar5) && ((0 < iVar5 || (1000 < *(uint *)(pPVar4->rgwtMin + 3))))) {
      XferAiSupply(1,pFVar9->idPlanet,2,lpfl->id,3,(int)pPVar4->rgwtMin[3] / 5);
      FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
    }
  }
  if (((uint)game.wCrap >> 4 & 1) == 0) {
    lpplTarget = (PLANET *)0x0;
  }
  else {
    lpplTarget = LpplFindBestEnum(pPVar13,FEnumCalcArmadaHumanDest);
  }
  if (((PLANET *)lpplTarget == (PLANET *)0x0) && (lpplTarget._2_2_ == 0)) {
    lpplTarget = LpplFindBestEnum(pPVar13,FEnumCalcArmadaDest);
  }
AI_TargetEveryArmada_3:
  if (((PLANET *)lpplTarget == (PLANET *)0x0) && (lpplTarget._2_2_ == 0)) {
    pFVar14 = LpflFindClosestEnum(lpfl,FEnumCalcEnemyFleets);
    iVar5 = (int)((ulong)pFVar14 >> 0x10);
    pFVar9 = (FLEET *)pFVar14;
    if ((pFVar9 == (FLEET *)0x0) && (iVar5 == 0)) {
      return 0;
    }
    ord.id = pFVar14->id;
    ord.wFlags = ord.wFlags & 0xf0ffU | 0x200;
    ord.pt.x = (&pFVar9->pt)->x;
    ord.pt.y = (pFVar9->pt).y;
  }
  else {
    ((byte *)vlpbAiPlanet)[lpplTarget->id * 0x10 + 10] =
         ((byte *)vlpbAiPlanet)[lpplTarget->id * 0x10 + 10] | 0x80;
    ord.id = lpplTarget->id;
    ord.wFlags = ord.wFlags & 0xf0ffU | 0x100;
    ord.pt.x = ((POINT *)rgptPlan + lpplTarget->id)->x;
    ord.pt.y = *(short *)((int)&rgptPlan[0].y + lpplTarget->id * 4);
  }
  ord.wFlags = ord.wFlags & 0xef00U | 0x1040;
  sVar6 = FMoveAiFleet(lpfl,&ord,0);
  if (sVar6 != 0) {
    return 0;
  }
  return -1;
}



// ======================================================================
// Function: FPotentRobWarFleet
// Address: 1088:31bc
// Segment: MEMORY_AI
// ======================================================================


short FPotentRobWarFleet(FLEET *lpfl,short iPotency)

{
  uint uVar1;
  short cEquiv;
  short ish;
  
  cEquiv = 0;
  ish = 2;
  while( true ) {
    if (5 < ish) break;
    cEquiv = cEquiv + ((FLEET *)lpfl)->rgcsh[ish];
    ish = ish + 1;
  }
  for (ish = 6; ish < 8; ish = ish + 1) {
    cEquiv = cEquiv + ((FLEET *)lpfl)->rgcsh[ish] * 2;
  }
  if (iPotency < 2) {
    uVar1 = 1;
  }
  else {
    uVar1 = (uint)((int)(uint)vrgAiArmadaPotency[0] <= cEquiv);
  }
  return uVar1;
}



// ======================================================================
// Function: FEnumCalcEnemyFleets
// Address: 1088:325c
// Segment: MEMORY_AI
// ======================================================================


short FEnumCalcEnemyFleets(FLEET *lpflSrc,FLEET *lpflTest)

{
  return (uint)(((FLEET *)lpflTest)->iPlayer != idPlayer);
}



// ======================================================================
// Function: FEnumCalcArmadaDest
// Address: 1088:3286
// Segment: MEMORY_AI
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x1088339e) */
/* WARNING: Removing unreachable block (ram,0x10883360) */
/* WARNING: Removing unreachable block (ram,0x10883322) */
/* WARNING: Removing unreachable block (ram,0x10883341) */
/* WARNING: Removing unreachable block (ram,0x1088337f) */
/* WARNING: Removing unreachable block (ram,0x108833bd) */

short FEnumCalcArmadaDest(PLANET *lpplSrc,PLANET *lpplTest)

{
  short sVar1;
  long lVar2;
  POINT pt1;
  POINT pt2;
  long l2;
  byte b;
  short id;
  
  if ((((PLANET *)lpplSrc != (PLANET *)lpplTest) || (lpplSrc._2_2_ != lpplTest._2_2_)) &&
     (b = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 10], b != 0)) {
    pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
    pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
    pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
    pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
    lVar2 = LDistance2(pt1,pt2);
    if (lVar2 < 0x9c4) {
      b = b + 7;
    }
    else if (lVar2 < 10000) {
      b = b + 5;
    }
    else if (lVar2 < 0x57e4) {
      b = b + 4;
    }
    else if (lVar2 < 40000) {
      b = b + 3;
    }
    else if (lVar2 < 90000) {
      b = b + 2;
    }
    else if (lVar2 < 250000) {
      b = b + 1;
    }
    if (((b & 0x80) == 0) || (sVar1 = Random(4), sVar1 == 0)) {
      return (uint)b;
    }
  }
  return 0;
}



// ======================================================================
// Function: FEnumCalcArmadaHumanDest
// Address: 1088:3406
// Segment: MEMORY_AI
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10883546) */
/* WARNING: Removing unreachable block (ram,0x10883508) */
/* WARNING: Removing unreachable block (ram,0x108834ca) */
/* WARNING: Removing unreachable block (ram,0x108834e9) */
/* WARNING: Removing unreachable block (ram,0x10883527) */
/* WARNING: Removing unreachable block (ram,0x10883565) */

short FEnumCalcArmadaHumanDest(PLANET *lpplSrc,PLANET *lpplTest)

{
  short sVar1;
  long lVar2;
  POINT pt1;
  POINT pt2;
  long l2;
  byte b;
  short id;
  
  if (((((PLANET *)lpplSrc != (PLANET *)lpplTest) || (lpplSrc._2_2_ != lpplTest._2_2_)) &&
      ((*(uint *)((int)&rgplr[0].wMdPlr + ((PLANET *)lpplTest)->iPlayer * 0xc0) >> 9 & 1)
       == 0)) && (b = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 10], b != 0)) {
    pt2.y = *(short *)((int)&rgptPlan[0].y + lpplTest->id * 4);
    pt2.x = ((POINT *)rgptPlan + lpplTest->id)->x;
    pt1.y = *(short *)((int)&rgptPlan[0].y + lpplSrc->id * 4);
    pt1.x = ((POINT *)rgptPlan + lpplSrc->id)->x;
    lVar2 = LDistance2(pt1,pt2);
    if (lVar2 < 0x9c4) {
      b = b + 7;
    }
    else if (lVar2 < 10000) {
      b = b + 5;
    }
    else if (lVar2 < 0x57e4) {
      b = b + 4;
    }
    else if (lVar2 < 40000) {
      b = b + 3;
    }
    else if (lVar2 < 90000) {
      b = b + 2;
    }
    else if (lVar2 < 250000) {
      b = b + 1;
    }
    if (((b & 0x80) == 0) || (sVar1 = Random(4), sVar1 == 0)) {
      return (uint)b;
    }
  }
  return 0;
}



// ======================================================================
// Function: DoTurinDroneAiTurn
// Address: 1088:3670
// Segment: MEMORY_AI
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10883d92) */
/* WARNING: Removing unreachable block (ram,0x10883db8) */
/* WARNING: Removing unreachable block (ram,0x10883fc0) */
/* WARNING: Removing unreachable block (ram,0x10883db3) */
/* WARNING: Removing unreachable block (ram,0x1088442c) */
/* WARNING: Removing unreachable block (ram,0x108845a2) */
/* WARNING: Removing unreachable block (ram,0x108842b4) */
/* WARNING: Removing unreachable block (ram,0x10883e88) */
/* WARNING: Removing unreachable block (ram,0x1088472b) */
/* WARNING: Removing unreachable block (ram,0x10883eb7) */

void DoTurinDroneAiTurn(PROD *rgprod)

{
  uint *puVar1;
  int *piVar2;
  byte *pbVar3;
  ORDER *pOVar4;
  PLORD *pPVar5;
  int iVar6;
  uint uVar7;
  short sVar8;
  uint uVar9;
  int iVar10;
  PLANET *pPVar11;
  PLORD *pPVar12;
  FLEET *pFVar13;
  byte *pbVar14;
  undefined2 unaff_SI;
  ORDER *pOVar15;
  undefined2 unaff_DI;
  undefined2 uVar16;
  long lVar17;
  ulong uVar18;
  PLANET *pPVar19;
  ulong uVar20;
  uint in_stack_0000ff4a;
  short id_2;
  short iPlanet;
  short fWrite;
  PROD *lpprod;
  long l;
  short iLatestBomber;
  short iLatestBattle;
  short cplBadGuy;
  short cFr;
  ushort cplanCol;
  ushort cRecyclePeriod;
  short ipl;
  short cplNegative;
  short ishdefSBLatest;
  PLANET *lpplMac;
  short cplMiners;
  short iLatestCargo;
  short iLatestMiner;
  short iroCur;
  short cRes;
  byte b;
  FLEET *lpflT;
  short i;
  short ifl;
  FLEET *lpfl;
  FLEET *lpflAttack;
  PLANET *lpplHome;
  ushort rgCosts [4];
  short iLatestTroop;
  PLANET *lppl;
  ORDER ord;
  short iLatestLayer;
  short j;
  short idPlanDst;
  byte rgRecycleShdef [16];
  PLANET *lpplDest;
  THING *lpthWorm;
  short iLatestDestroyer;
  short cExistCargo;
  FLEET *lpflEnemy;
  long rgResAvail [4];
  short iLatestCruiser;
  long rgResCost [4];
  
  uVar20 = CONCAT22(unaff_SI,unaff_DI);
  cplBadGuy = 0;
  cplNegative = 0;
  cplanCol = 0;
  cplMiners = 0;
  iroCur = IroEnsureAi(vrgAiTurinDroneResOrder,0x1f,&ishdefSBLatest,0xf);
  if (((uint)rgshdef[0xd].wFlags >> 9 & 1) == 0) {
    MergeAllShdefs(-0x1f10);
  }
  if (((uint)rgshdef[0xc].wFlags >> 9 & 1) == 0) {
    MergeAllShdefs(0x1000);
  }
  if (((uint)rgshdef[10].wFlags >> 9 & 1) == 0) {
    MergeAllShdefs(0xc00);
  }
  if (((uint)rgshdef[2].wFlags >> 9 & 1) == 0) {
    MergeAllShdefs(0xc);
  }
  j = 3;
  if (0x82 < (uint)game.turn) {
    j = (game.turn - 0x78U) / 0x14 + 3;
  }
  if (0x32 < (uint)j) {
    j = 0x32;
  }
  vrgAiArmadaPotency[0] = (byte)j;
  vrgAiArmadaPotency[1] = (byte)((ulong)(j & 0xff) / 2);
  j = 6;
  if (0x73 < (uint)game.turn) {
    j = (game.turn - 100U) / 0x16 + 6;
  }
  if (0xc < (uint)j) {
    j = 0xc;
  }
  vrgAiArmadaPotency[2] = (byte)j;
  if ((int)((uint)j / 2 - 1) < 4) {
    vrgAiArmadaPotency[3] = (char)((uint)j / 2) - 1;
  }
  else {
    vrgAiArmadaPotency[3] = 3;
  }
  _memset(rgRecycleShdef,0,0x10);
  if ((uint)game.turn < 0x78) {
    cRecyclePeriod = 0x32;
  }
  else if ((uint)game.turn < 200) {
    cRecyclePeriod = 0x46;
  }
  else {
    cRecyclePeriod = 100;
  }
  CheckAiShdefStatus(6,7,cRecyclePeriod,&iLatestCruiser,rgRecycleShdef);
  cExistCargo = CheckAiShdefStatus(8,9,cRecyclePeriod,&iLatestCargo,rgRecycleShdef);
  CheckAiShdefStatus(0xd,0xe,cRecyclePeriod,&iLatestBomber,rgRecycleShdef);
  CheckAiShdefStatus(4,5,cRecyclePeriod,&iLatestBattle,rgRecycleShdef);
  CheckAiShdefStatus(0xc,0xc,cRecyclePeriod,&iLatestLayer,rgRecycleShdef);
  CheckAiShdefStatus(0xf,0xf,cRecyclePeriod,&iLatestTroop,rgRecycleShdef);
  if (*(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) < '\a') {
    iLatestMiner = -1;
  }
  else {
    CheckAiShdefStatus(2,3,cRecyclePeriod,&iLatestMiner,rgRecycleShdef);
  }
  CheckAiShdefStatus(10,0xb,cRecyclePeriod,&iLatestDestroyer,rgRecycleShdef);
  if (0x3c < (uint)game.turn) {
    SplitOutShdefs(rgRecycleShdef);
  }
  EnsureTurinDroneShdefs(iroCur);
  lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
  lpplMac._2_2_ = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < (PLANET *)lpplMac) {
    uVar16 = (undefined2)((ulong)lppl >> 0x10);
    if (((((PLANET *)lppl)->iPlayer == -1) && (2 < (((PLANET *)lppl)->wFlags & 0xffU))) &&
       (sVar8 = PctPlanetOptValue(lppl,idPlayer), 0 < sVar8)) {
      cplanCol = cplanCol + 1;
    }
    lppl = (PLANET *)CONCAT22(lppl._2_2_,(PLANET *)lppl + 1);
  }
  lpplMac._0_2_ = (PLANET *)lpPlanets + cPlanet;
  lpplMac._2_2_ = lpPlanets._2_2_;
  lppl = (PLANET *)CONCAT22(lpPlanets._2_2_,(PLANET *)lpPlanets);
  while ((PLANET *)lppl < (PLANET *)lpplMac) {
    ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 9] = 1;
    uVar16 = (undefined2)((ulong)lppl >> 0x10);
    if ((((PLANET *)lppl)->iPlayer == -1) && (2 < (((PLANET *)lppl)->wFlags & 0xffU))) {
      b = 0;
      for (i = 0; i < 3; i = i + 1) {
        if (((PLANET *)lppl)->rgMinConc[i] < 0x43) {
          id_2._0_1_ = ((PLANET *)lppl)->rgMinConc[i] / 2;
        }
        else {
          id_2._0_1_ = 0x4b;
        }
        b = b + (byte)id_2;
      }
      if ((b & 0x80) != 0) {
        b = 0x7f;
      }
      ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 1] = b;
      cplMiners = cplMiners + 1;
    }
    if ((((PLANET *)lppl)->iPlayer == idPlayer) || (((PLANET *)lppl)->iPlayer == -1)) {
      if (((PLANET *)lppl)->iPlayer == idPlayer) {
        sVar8 = PctPlanetDesirability(lppl,idPlayer);
        if (sVar8 < 0) {
          cplNegative = cplNegative + 1;
          ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 2] = 1;
        }
        else {
          uVar16 = (undefined2)((ulong)lppl >> 0x10);
          pPVar11 = (PLANET *)lppl;
          if ((((uint)pPVar11->wFlags >> 9 & 1) == 0) ||
             ((iVar10 = *(int *)((int)pPVar11->rgwtMin + 0xe), iVar10 < 1 &&
              ((iVar10 < 0 || (*(uint *)(pPVar11->rgwtMin + 3) < 200)))))) {
            ChangeMainObjSel(1,lppl->id);
            lVar17 = __aFlshl(uVar20,in_stack_0000ff4a);
            sel.pl.dwFlags._0_2_ = (uint)sel.pl.dwFlags | (uint)lVar17;
            sel.pl.dwFlags._2_2_ =
                 sel.pl.dwFlags._2_2_ & 0xff7f | (uint)((ulong)lVar17 >> 0x10);
            uVar18 = __aFulshr(uVar20,in_stack_0000ff4a);
            in_stack_0000ff4a = (uint)uVar18 & 1;
            uVar18 = __aFulshr(uVar20,in_stack_0000ff4a);
            if (in_stack_0000ff4a != ((uint)uVar18 & 1)) {
              FLookupPlanet(-1,(PLANET *)&sel.pl);
            }
          }
          else {
            ChangeMainObjSel(1,lppl->id);
            InitProduction(rgprod);
            fWrite = 0;
            b = 0;
            i = 0;
            while ((i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac &&
                   ((uVar18 = __aFulshr(uVar20,in_stack_0000ff4a), ((uint)uVar18 & 7) != 2
                    || (uVar18 = __aFulshr(uVar20,in_stack_0000ff4a),
                       0xf < ((uint)uVar18 & 0x7f)))))) {
              i = i + 1;
            }
            if (i < (int)(uint)((PLPROD *)lpplProdGlob)->iprodMac) {
              FinishProduction(0);
            }
            else {
              if (game.turn == 0) {
                i = game.cPlanMax;
                while (0 < i) {
                  AddItemToQueue(0,1,grobjFleet,1);
                  if (i < 0xbf) {
                    i = i + -0x1e;
                  }
                  else {
                    i = i + -100;
                  }
                  fWrite = 1;
                }
              }
              else if ((((uint)rgshdef[0].wFlags >> 9 & 1) == 0) &&
                      (rgshdef[0].hul.ihuldef == ihuldefFrigate)) {
                if (game.cPlanMax / 4 < 0x20) {
                  uVar9 = game.cPlanMax / 4;
                }
                else {
                  uVar9 = 0x20;
                }
                if (((rgshdef[0].cExist._2_2_ == 0) &&
                    ((uint)rgshdef[0].cExist < uVar9)) &&
                   (uVar18 = __aFuldiv(CONCAT22(rgshdef[0].cBuilt._2_2_,
                                                        (undefined2)rgshdef[0].cBuilt),10)
                   , uVar18 < CONCAT22(rgshdef[0].cExist._2_2_,
                                       (uint)rgshdef[0].cExist))) {
                  AddItemToQueue(0,1,grobjFleet,1);
                  fWrite = 1;
                }
              }
              uVar16 = (undefined2)((ulong)vlpbAiData >> 0x10);
              if (*(int *)((byte *)vlpbAiData + 2) * 2 <
                  *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 10) {
                cFr = *(int *)((int)&rgplr[0].cPlanet + idPlayer * 0xc0) / 10;
              }
              else {
                cFr = *(int *)((byte *)vlpbAiData + 2) << 1;
              }
              if ((('\x04' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))
                  && (iLatestCargo != -1)) &&
                 ((cExistCargo < cFr ||
                  ((cExistCargo < (cFr * 10) / 7 && (sVar8 = Random(4), sVar8 == 0)))))) {
                AddItemToQueue(iLatestCargo,1,grobjFleet,1);
                fWrite = 1;
              }
              if ((((cplanCol != 0) || (cplBadGuy != 0)) && (rgshdef[1].cExist._2_2_ == 0)
                  ) && ((uint)rgshdef[1].cExist < 2)) {
                AddItemToQueue(1,1,grobjFleet,1);
                AddItemToQueue(1,1,grobjFleet,1);
                AddItemToQueue(1,1,grobjFleet,1);
                AddItemToQueue(1,1,grobjFleet,1);
                fWrite = 1;
              }
              sVar8 = PctTrueMaxGrowth(idPlayer);
              uVar16 = (undefined2)((ulong)lppl >> 0x10);
              __aFulmul(CONCAT22(*(undefined2 *)((int)((PLANET *)lppl)->rgwtMin + 0xe),
                                         (int)((PLANET *)lppl)->rgwtMin[3]),(long)sVar8);
              cRes = CResourcesAtPlanet(lppl,idPlayer);
              if ((((uint)rgshdef[0xc].wFlags >> 9 & 1) == 0) &&
                 (sVar8 = Random(3), sVar8 == 0)) {
                cFr = 0;
                for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
                  pFVar13 = ((FLEET **)rglpfl)[ifl];
                  iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                  lpfl = (FLEET *)CONCAT22(iVar10,pFVar13);
                  if ((pFVar13 == (FLEET *)0x0) && (iVar10 == 0)) break;
                  if ((pFVar13->idPlanet == lppl->id) &&
                     ((0 < pFVar13->rgcsh[0xc] && (pFVar13->iPlayer == idPlayer)))) {
                    cFr = pFVar13->rgcsh[0xc];
                    break;
                  }
                }
                if (((cFr < 10) || ((cFr < 0x11 && (sVar8 = Random(8), sVar8 == 0)))) &&
                   (sVar8 = Random(cFr * 2 + 1), sVar8 == 0)) {
                  AddItemToQueue(0xc,3,grobjFleet,1);
                  fWrite = 1;
                }
              }
              if (iLatestBomber != -1) {
                iVar10 = lppl->id;
                for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
                  pFVar13 = ((FLEET **)rglpfl)[ifl];
                  iVar6 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
                  lpfl = (FLEET *)CONCAT22(iVar6,pFVar13);
                  if ((pFVar13 == (FLEET *)0x0) && (iVar6 == 0)) break;
                  if ((pFVar13->idPlanet == iVar10) &&
                     ((pFVar13->iPlayer == idPlayer &&
                      (sVar8 = FPotentRobWarFleet((FLEET *)CONCAT22(iVar6,pFVar13),2), sVar8 != 0)))
                     ) {
                    if ((iLatestBomber != -1) &&
                       (uVar16 = (undefined2)((ulong)lpfl >> 0x10),
                       (int)(uint)vrgAiArmadaPotency[2] <=
                       ((FLEET *)lpfl)->rgcsh[0xd] + ((FLEET *)lpfl)->rgcsh[0xe])) {
                      AddItemToQueue(iLatestBomber,4,grobjFleet,1);
                      fWrite = 1;
                      goto AI_FinishProd_2;
                    }
                    break;
                  }
                }
              }
              if (iLatestBattle != -1) {
                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestBattle * 0x93) == 0) &&
                   (*(uint *)((int)&rgshdef[0].cExist + iLatestBattle * 0x93) <
                    game.cPlanMax / 0x18 + 4U)) {
                  GetResourcesAvailable(lppl,rgResAvail);
                  GetProdQCost(lppl,rgResCost);
                  for (i = 0; i < 4; i = i + 1) {
                    uVar7 = *(uint *)(rgResCost + i);
                    iVar10 = *(int *)((int)rgResCost + i * 4 + 2);
                    puVar1 = (uint *)(rgResAvail + i);
                    uVar9 = *puVar1;
                    *puVar1 = *puVar1 - uVar7;
                    piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                    *piVar2 = (*piVar2 - iVar10) - (uint)(uVar9 < uVar7);
                    iVar10 = *(int *)((int)rgResAvail + i * 4 + 2);
                    if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                  }
                  for (i = 0; i < 5; i = i + 1) {
                    GetTrueHullCost
                              (idPlayer,
                               (HUL *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                               (HUL *)(iLatestBattle * 0x93 + 0x3f00)),rgCosts);
                    for (j = 0; j < 4; j = j + 1) {
                      uVar7 = rgCosts[j];
                      puVar1 = (uint *)(rgResAvail + j);
                      uVar9 = *puVar1;
                      *puVar1 = *puVar1 - uVar7;
                      piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                      *piVar2 = *piVar2 - (uint)(uVar9 < uVar7);
                      iVar10 = *(int *)((int)rgResAvail + j * 4 + 2);
                      if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                    }
                    fWrite = 1;
                    AddItemToQueue(iLatestBattle,1,grobjFleet,1);
                  }
                }
              }
              if (iLatestCruiser != -1) {
                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestCruiser * 0x93) == 0)
                   && (*(uint *)((int)&rgshdef[0].cExist + iLatestCruiser * 0x93) <
                       game.cPlanMax / 0xc + 8U)) {
                  GetResourcesAvailable(lppl,rgResAvail);
                  GetProdQCost(lppl,rgResCost);
                  for (i = 0; i < 4; i = i + 1) {
                    uVar7 = *(uint *)(rgResCost + i);
                    iVar10 = *(int *)((int)rgResCost + i * 4 + 2);
                    puVar1 = (uint *)(rgResAvail + i);
                    uVar9 = *puVar1;
                    *puVar1 = *puVar1 - uVar7;
                    piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                    *piVar2 = (*piVar2 - iVar10) - (uint)(uVar9 < uVar7);
                    iVar10 = *(int *)((int)rgResAvail + i * 4 + 2);
                    if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                  }
                  for (i = 0; i < 5; i = i + 1) {
                    GetTrueHullCost
                              (idPlayer,
                               (HUL *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                               (HUL *)(iLatestCruiser * 0x93 + 0x3f00)),rgCosts);
                    for (j = 0; j < 4; j = j + 1) {
                      uVar7 = rgCosts[j];
                      puVar1 = (uint *)(rgResAvail + j);
                      uVar9 = *puVar1;
                      *puVar1 = *puVar1 - uVar7;
                      piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                      *piVar2 = *piVar2 - (uint)(uVar9 < uVar7);
                      iVar10 = *(int *)((int)rgResAvail + j * 4 + 2);
                      if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                    }
                    fWrite = 1;
                    AddItemToQueue(iLatestCruiser,1,grobjFleet,1);
                  }
                }
              }
              if (iLatestDestroyer != -1) {
                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestDestroyer * 0x93) == 0)
                   && (*(uint *)((int)&rgshdef[0].cExist + iLatestDestroyer * 0x93) <
                       game.cPlanMax / 4 + 0xcU)) {
                  GetResourcesAvailable(lppl,rgResAvail);
                  GetProdQCost(lppl,rgResCost);
                  for (i = 0; i < 4; i = i + 1) {
                    uVar7 = *(uint *)(rgResCost + i);
                    iVar10 = *(int *)((int)rgResCost + i * 4 + 2);
                    puVar1 = (uint *)(rgResAvail + i);
                    uVar9 = *puVar1;
                    *puVar1 = *puVar1 - uVar7;
                    piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                    *piVar2 = (*piVar2 - iVar10) - (uint)(uVar9 < uVar7);
                    iVar10 = *(int *)((int)rgResAvail + i * 4 + 2);
                    if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                  }
                  for (i = 0; i < 5; i = i + 1) {
                    GetTrueHullCost
                              (idPlayer,
                               (HUL *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                               (HUL *)(iLatestDestroyer * 0x93 + 0x3f00)),rgCosts);
                    for (j = 0; j < 4; j = j + 1) {
                      uVar7 = rgCosts[j];
                      puVar1 = (uint *)(rgResAvail + j);
                      uVar9 = *puVar1;
                      *puVar1 = *puVar1 - uVar7;
                      piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                      *piVar2 = *piVar2 - (uint)(uVar9 < uVar7);
                      iVar10 = *(int *)((int)rgResAvail + j * 4 + 2);
                      if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                    }
                    fWrite = 1;
                    AddItemToQueue(iLatestDestroyer,1,grobjFleet,1);
                  }
                }
              }
              if ((iLatestTroop != -1) && (((uint)rgshdef[0xf].wFlags >> 9 & 1) == 0)) {
                if ((*(int *)((int)&rgshdef[0].cExist + 2 + iLatestTroop * 0x93) == 0) &&
                   (*(uint *)((int)&rgshdef[0].cExist + iLatestTroop * 0x93) <
                    game.cPlanMax / 0xc + 8U)) {
                  GetResourcesAvailable(lppl,rgResAvail);
                  GetProdQCost(lppl,rgResCost);
                  for (i = 0; i < 4; i = i + 1) {
                    uVar7 = *(uint *)(rgResCost + i);
                    iVar10 = *(int *)((int)rgResCost + i * 4 + 2);
                    puVar1 = (uint *)(rgResAvail + i);
                    uVar9 = *puVar1;
                    *puVar1 = *puVar1 - uVar7;
                    piVar2 = (int *)((int)rgResAvail + i * 4 + 2);
                    *piVar2 = (*piVar2 - iVar10) - (uint)(uVar9 < uVar7);
                    iVar10 = *(int *)((int)rgResAvail + i * 4 + 2);
                    if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                  }
                  for (i = 0; i < 5; i = i + 1) {
                    GetTrueHullCost
                              (idPlayer,
                               (HUL *)CONCAT22((undefined1 *)&DAT_1120_1120,
                                               (HUL *)(iLatestTroop * 0x93 + 0x3f00)),rgCosts);
                    for (j = 0; j < 4; j = j + 1) {
                      uVar7 = rgCosts[j];
                      puVar1 = (uint *)(rgResAvail + j);
                      uVar9 = *puVar1;
                      *puVar1 = *puVar1 - uVar7;
                      piVar2 = (int *)((int)rgResAvail + j * 4 + 2);
                      *piVar2 = *piVar2 - (uint)(uVar9 < uVar7);
                      iVar10 = *(int *)((int)rgResAvail + j * 4 + 2);
                      if ((iVar10 < 1) && (iVar10 < 0)) goto AI_FinishProd_2;
                    }
                    fWrite = 1;
                    AddItemToQueue(iLatestTroop,1,grobjFleet,1);
                  }
                }
              }
AI_FinishProd_2:
              FinishProduction(fWrite);
            }
          }
        }
      }
    }
    else {
      ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 10] =
           ((byte)((uint)((PLANET *)lppl)->wFlags >> 9) & 1) + 1;
      sVar8 = PctPlanetOptValue(lppl,idPlayer);
      if (0 < sVar8) {
        ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 3] = (byte)sVar8;
        cplBadGuy = cplBadGuy + 1;
      }
    }
    lppl = (PLANET *)CONCAT22(lppl._2_2_,(PLANET *)lppl + 1);
  }
  for (ipl = 0; ipl < vclpplAi; ipl = ipl + 1) {
                    /* WARNING: Load size is inaccurate */
    pPVar11 = ((PLANET **)vrglpplAi)[ipl];
    iVar10 = *(int *)((int)((PLANET **)vrglpplAi + ipl) + 2);
    lppl = (PLANET *)CONCAT22(iVar10,pPVar11);
    if (((pPVar11 == (PLANET *)0x0) && (iVar10 == 0)) || (((uint)pPVar11->wFlags >> 9 & 1) != 0))
    break;
  }
  lpplHome._0_2_ = (PLANET *)lppl;
  lpplHome._2_2_ = lppl._2_2_;
  if (((PLANET *)lppl == (PLANET *)lpplMac) && (lppl._2_2_ == lpplMac._2_2_)) {
    lpplHome._0_2_ = (PLANET *)0x0;
    lpplHome._2_2_ = 0;
  }
  lpflAttack._0_2_ = (FLEET *)0x0;
  lpflAttack._2_2_ = 0;
  lpflEnemy._0_2_ = (FLEET *)0x0;
  lpflEnemy._2_2_ = 0;
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar13 = ((FLEET **)rglpfl)[ifl];
    iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar10,pFVar13);
    if ((pFVar13 == (FLEET *)0x0) && (iVar10 == 0)) break;
    if (pFVar13->iPlayer == idPlayer) {
      sVar8 = FIsTurinDroneAiAttack((FLEET *)CONCAT22(iVar10,pFVar13));
      pFVar13 = (FLEET *)lpfl;
      uVar16 = (undefined2)((ulong)lpfl >> 0x10);
      if (sVar8 != 0) {
        *(FLEET **)&pFVar13->lpflNext = (FLEET *)lpflAttack;
        *(undefined2 *)((int)&pFVar13->lpflNext + 2) = lpflAttack._2_2_;
        lpflAttack._0_2_ = pFVar13;
        lpflAttack._2_2_ = uVar16;
      }
      pFVar13->wFlags = pFVar13->wFlags & 0x7fff;
      if (((pFVar13->rgcsh[2] == 0) && (pFVar13->rgcsh[3] == 0)) ||
         ((*(uint *)(*(int *)&pFVar13->lpplord + (pFVar13->cord + -1) * 0x12 + 10) & 0xf) == 0)) {
        if ((pFVar13->rgcsh[8] == 0) && (pFVar13->rgcsh[9] == 0)) {
          if (pFVar13->rgcsh[1] != 0) {
            idPlanDst = -1;
            if (pFVar13->cord < 2) {
              idPlanDst = pFVar13->idPlanet;
            }
            else if (((uint)((PLORD *)pFVar13->lpplord + 7)->wFlags >> 8 & 0xf) == 1) {
              idPlanDst = *(short *)&((PLORD *)pFVar13->lpplord)[6].iordMax;
            }
            if (idPlanDst != -1) {
              if (((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] != 0)
              goto AI_LCheckForColDrop_3;
              lppl = LpplFromId(idPlanDst);
              iVar10 = (int)((ulong)lppl >> 0x10);
              pPVar11 = (PLANET *)lppl;
              if (((pPVar11 != (PLANET *)0x0) || (iVar10 != 0)) &&
                 ((pPVar11->iPlayer != -1 && (pPVar11->iPlayer != idPlayer))))
              goto AI_LBlowAwayOrders_3;
            }
          }
        }
        else {
          idPlanDst = -1;
          if (pFVar13->cord < 2) {
            idPlanDst = pFVar13->idPlanet;
          }
          else if (((uint)((PLORD *)pFVar13->lpplord + 7)->wFlags >> 8 & 0xf) == 1) {
            idPlanDst = *(short *)&((PLORD *)pFVar13->lpplord)[6].iordMax;
          }
AI_LCheckForColDrop_3:
          if (idPlanDst == -1) {
            if ((1 < pFVar13->cord) &&
               (((uint)((PLORD *)pFVar13->lpplord + 7)->wFlags >> 8 & 0xf) == 4))
            goto AI_LBlowAwayOrders_3;
          }
          else {
            lppl = LpplFromId(idPlanDst);
            iVar10 = (int)((ulong)lppl >> 0x10);
            pPVar11 = (PLANET *)lppl;
            if (((pPVar11 == (PLANET *)0x0) && (iVar10 == 0)) ||
               ((pPVar11->iPlayer != -1 && (pPVar11->iPlayer != idPlayer)))) {
              if (((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] != 0) {
                uVar16 = (undefined2)((ulong)lpfl >> 0x10);
                iVar6 = *(int *)((int)((FLEET *)lpfl)->rgwtMin + 0xe);
                if ((-1 < iVar6) &&
                   ((((0 < iVar6 || ((int)((FLEET *)lpfl)->rgwtMin[3] != 0)) &&
                     (sVar8 = GetRaceStat((PLAYER *)rgplr + pPVar11->iPlayer,
                                                rsMajorAdv), sVar8 != raMacintosh)) &&
                    (((uint)((PLANET *)lppl)->wFlags >> 9 & 1) == 0)))) {
                  _memset(&ord,0,0x12);
                  ord.pt.x = ((POINT *)rgptPlan + idPlanDst)->x;
                  ord.pt.y = *(short *)((int)&rgptPlan[0].y + idPlanDst * 4);
                  ord.id = idPlanDst;
                  ord.wFlags = ord.wFlags & 0xe0f0U | 0x1101;
                  ord.txp.rgia[3].wFlags = ord.txp.rgia[3].wFlags & 0xfffU | 0x2000;
                  ChangeMainObjSel(2,lpfl->id);
                  uVar16 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                  pPVar12 = (PLORD *)sel.fl.lpplord;
                  if (((pPVar12 + 2)->wFlags == idPlanDst) &&
                     ((*(uint *)&pPVar12[2].iordMax >> 8 & 0xf) == 1)) {
                    pPVar12 = pPVar12 + 1;
                    pOVar15 = &ord;
                    for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
                      pPVar5 = pPVar12;
                      pPVar12 = (PLORD *)&pPVar12->iordMax;
                      pOVar4 = pOVar15;
                      pOVar15 = (ORDER *)&(pOVar15->pt).y;
                      pPVar5->wFlags = (pOVar4->pt).x;
                    }
                  }
                  else {
                    pbVar14 = &pPVar12[5].iordMax;
                    pOVar15 = &ord;
                    for (iVar10 = 9; iVar10 != 0; iVar10 = iVar10 + -1) {
                      pbVar3 = pbVar14;
                      pbVar14 = pbVar14 + 2;
                      pOVar4 = pOVar15;
                      pOVar15 = (ORDER *)&(pOVar15->pt).y;
                      *(short *)pbVar3 = (pOVar4->pt).x;
                    }
                  }
                  FLookupFleet(-1,(FLEET *)&sel.fl);
                  ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] =
                       ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 3] | 0x80;
                  FMoveToNearestStarbase(lpfl,0);
                  goto LAB_1088_4932;
                }
              }
AI_LBlowAwayOrders_3:
              ChangeMainObjSel(2,lpfl->id);
              sel.fl.cord = 1;
              ((PLORD *)sel.fl.lpplord)->iordMac = 1;
              FLookupFleet(-1,(FLEET *)&sel.fl);
              ClearAiCurrentTask(lpfl,0);
            }
          }
        }
      }
      else {
        if (pFVar13->idPlanet == -1) {
          if (pFVar13->cord < 2) goto LAB_1088_4932;
          ((PLORD *)pFVar13->lpplord + 7)->wFlags =
               ((PLORD *)pFVar13->lpplord + 7)->wFlags & 0xfff0U | 3;
          idPlanDst = *(short *)&((PLORD *)pFVar13->lpplord)[6].iordMax;
        }
        else {
          pPVar19 = LpplFromId(pFVar13->idPlanet);
          if (((PLANET *)pPVar19)->iPlayer != -1) goto AI_LBlowAwayOrders_3;
          idPlanDst = ((FLEET *)lpfl)->idPlanet;
        }
        ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 1] =
             ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 1] | 0x80;
      }
    }
    else {
      *(FLEET **)&pFVar13->lpflNext = (FLEET *)lpflEnemy;
      *(int *)((int)&pFVar13->lpflNext + 2) = lpflEnemy._2_2_;
      lpflEnemy._0_2_ = pFVar13;
      lpflEnemy._2_2_ = iVar10;
    }
LAB_1088_4932:
  }
  fMarkedPlanets = 0;
  for (ifl = 0; ifl < cFleet; ifl = ifl + 1) {
                    /* WARNING: Load size is inaccurate */
    pFVar13 = ((FLEET **)rglpfl)[ifl];
    iVar10 = *(int *)((int)((FLEET **)rglpfl + ifl) + 2);
    lpfl = (FLEET *)CONCAT22(iVar10,pFVar13);
    if ((pFVar13 == (FLEET *)0x0) && (iVar10 == 0)) break;
    if (pFVar13->iPlayer == idPlayer) {
      if ((pFVar13->rgcsh[2] == 0) && (pFVar13->rgcsh[3] == 0)) {
        if (pFVar13->cord < 2) {
          if (pFVar13->rgcsh[1] == 0) {
            if ((pFVar13->rgcsh[8] == 0) && (pFVar13->rgcsh[9] == 0)) {
              if ((pFVar13->rgcsh[0xd] == 0) && (pFVar13->rgcsh[0xe] == 0)) {
                if (((pFVar13->rgcsh[0] == 0) && (pFVar13->rgcsh[10] == 0)) &&
                   (pFVar13->rgcsh[0xb] == 0)) {
                  if (((pFVar13->rgcsh[0xc] != 0) && (pFVar13->cord == 1)) &&
                     ((*(uint *)&((PLORD *)pFVar13->lpplord)[2].iordMax & 0xf) == 0)) {
                    ChangeMainObjSel(2,lpfl->id);
                    uVar16 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
                    *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                         *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 6;
                    ((PLORD *)sel.fl.lpplord + 3)->wFlags = 5;
                    pbVar3 = &((PLORD *)sel.fl.lpplord)[3].iordMax;
                    pbVar3[0] = 5;
                    pbVar3[1] = 0;
                    FLookupFleet(-1,(FLEET *)&sel.fl);
                  }
                }
                else {
                  if (((pFVar13->rgcsh[0] != 0) &&
                      ('\x05' < *(char *)((int)rgplr[0].rgTech + 3 +
                                         idPlayer * 0xc0))) &&
                     (rgshdef[0].hul.ihuldef == ihuldefScout)) goto AI_LScrapFleet_3;
                  ChangeMainObjSel(2,lpfl->id);
                  IdTargetScout(lpfl,(FLEET *)CONCAT22(lpflAttack._2_2_,(FLEET *)lpflAttack),
                                     (FLEET *)CONCAT22(lpflEnemy._2_2_,(FLEET *)lpflEnemy),
                                     (uint)game.wCrap >> 4 & 1,&lpthWorm);
                }
              }
              else {
                ChangeMainObjSel(2,lpfl->id);
                uVar16 = (undefined2)((ulong)lpfl >> 0x10);
                if (((FLEET *)lpfl)->idPlanet == -1) {
                  lppl = (PLANET *)CONCAT22(lpplHome._2_2_,(PLANET *)lpplHome);
                }
                else {
                  lppl = LpplFromId(((FLEET *)lpfl)->idPlanet);
                  uVar16 = (undefined2)((ulong)lppl >> 0x10);
                  pPVar11 = (PLANET *)lppl;
                  if (pPVar11->iPlayer == idPlayer) {
                    if (((uint)pPVar11->wFlags >> 9 & 1) != 0) {
                      uVar16 = (undefined2)((ulong)lpfl >> 0x10);
                      pFVar13 = (FLEET *)lpfl;
                      if ((pFVar13->rgcsh[0xd] + pFVar13->rgcsh[0xe] <
                           (int)(uint)vrgAiArmadaPotency[2]) ||
                         (pFVar13->rgcsh[4] + pFVar13->rgcsh[5] <
                          (int)(uint)vrgAiArmadaPotency[1])) goto LAB_1088_4eb0;
                    }
                    FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
                  }
                  else if (pPVar11->iPlayer != -1) {
                    lpflT = (FLEET *)CONCAT22(lpflEnemy._2_2_,(FLEET *)lpflEnemy);
                    while( true ) {
                      if (((FLEET *)lpflT == (FLEET *)0x0) && (lpflT._2_2_ == 0))
                      goto LAB_1088_4eb0;
                      uVar16 = (undefined2)((ulong)lpfl >> 0x10);
                      if (((&((FLEET *)lpfl)->pt)->x == (&((FLEET *)lpflT)->pt)->x) &&
                         (((((FLEET *)lpfl)->pt).y == (((FLEET *)lpflT)->pt).y &&
                          (sVar8 = FIsAiAttack(lpflT), sVar8 != 0)))) break;
                      uVar16 = (undefined2)((ulong)lpflT >> 0x10);
                    /* WARNING: Load size is inaccurate */
                      lpflT = (FLEET *)CONCAT22(*(undefined2 *)
                                                 ((int)&((FLEET *)lpflT)->lpflNext + 2),
                                                ((FLEET *)lpflT)->lpflNext);
                    }
                  }
                }
                if (((uint)game.wCrap >> 4 & 1) == 0) {
                  lpplDest = (PLANET *)0x0;
                }
                else {
                  lpplDest = LpplFindBestEnum(lppl,FEnumCalcArmadaHumanDest);
                }
                if (((PLANET *)lpplDest == (PLANET *)0x0) && (lpplDest._2_2_ == 0)) {
                  lpplDest = LpplFindBestEnum(lppl,FEnumCalcArmadaDest);
                }
                lppl = lpplDest;
                if (((PLANET *)lpplDest != (PLANET *)0x0) || (lpplDest._2_2_ != 0)) {
                  ((byte *)vlpbAiPlanet)[lpplDest->id * 0x10 + 10] =
                       ((byte *)vlpbAiPlanet)[lpplDest->id * 0x10 + 10] | 0x80;
                  ord.id = lpplDest->id;
                  ord.pt.x = ((POINT *)rgptPlan + lpplDest->id)->x;
                  ord.pt.y = *(short *)((int)&rgptPlan[0].y + lpplDest->id * 4);
                  ord.wFlags = ord.wFlags & 0xe000U | 0x1140;
                  FMoveAiFleet(lpfl,&ord,0);
                }
              }
            }
            else if (game.turn == 0) {
              ChangeMainObjSel(2,lpfl->id);
AI_LScrapFleet_3:
              ChangeMainObjSel(2,lpfl->id);
              uVar16 = (undefined2)((ulong)sel.fl.lpplord >> 0x10);
              *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax =
                   *(uint *)&((PLORD *)sel.fl.lpplord)[2].iordMax & 0xfff0 | 5;
              FLookupFleet(-1,(FLEET *)&sel.fl);
            }
            else {
              if (((PLANET *)lpplHome == (PLANET *)0x0) && (lpplHome._2_2_ == 0)) break;
              lppl = (PLANET *)0x0;
              i = 0;
              while( true ) {
                uVar16 = (undefined2)((ulong)vlpbAiData >> 0x10);
                pbVar14 = (byte *)vlpbAiData;
                if (*(int *)(pbVar14 + 2) <= i) break;
                j = 0;
                while ((j < *(int *)(pbVar14 + i * 0x14 + 6) &&
                       (*(int *)(pbVar14 + j * 2 + i * 0x14 + 8) != lpfl->id))) {
                  j = j + 1;
                }
                if (j < *(int *)(pbVar14 + i * 0x14 + 6)) break;
                i = i + 1;
              }
              if (i < *(int *)(pbVar14 + 2)) {
                lppl = LpplFromId(*(short *)(pbVar14 + i * 0x14 + 4));
              }
              if (((PLANET *)lppl != (PLANET *)0x0) ||
                 (pPVar11 = (PLANET *)lpplHome, iVar10 = lpplHome._2_2_, lppl._2_2_ != 0)) {
                pPVar11 = (PLANET *)lppl;
                iVar10 = lppl._2_2_;
              }
              IdTargetFreighter(lpfl,(PLANET *)CONCAT22(iVar10,pPVar11));
            }
          }
          else {
            ChangeMainObjSel(2,lpfl->id);
            uVar16 = (undefined2)((ulong)lpfl >> 0x10);
            pFVar13 = (FLEET *)lpfl;
            if (((((pFVar13->idPlanet == -1) || (sel.pl.iPlayer != idPlayer)) ||
                 ((sel.pl.rgwtMin[3]._2_2_ < 1 &&
                  ((sel.pl.rgwtMin[3]._2_2_ < 0 ||
                   ((uint)sel.pl.rgwtMin[3] < 0x32)))))) &&
                ((int)pFVar13->rgwtMin[3] == 0)) && (*(int *)((int)pFVar13->rgwtMin + 0xe) == 0)) {
              if ((((sel.fl.idPlanet == -1) ||
                   (sel.pl.iPlayer != idPlayer)) ||
                  (((uint)sel.pl.wFlags >> 9 & 1) == 0)) &&
                 (((rgshdef[1].hul.rghs[0].wFlags & 0xffU) < 3 ||
                  (sVar8 = FMoveToNearestStarbase(lpfl,0), sVar8 == 0))))
              goto AI_LScrapFleet_3;
            }
            else {
              lpthWorm._0_2_ = (THING *)0x0;
              lpthWorm._2_2_ = 0;
              idPlanDst = IdNearestColonizablePlanet(lpfl,(THING **)0x0);
              if ((((FLEET *)lpfl)->idPlanet == -1) || (sel.pl.iPlayer != idPlayer)
                 ) {
                lppl = (PLANET *)CONCAT22(lpplHome._2_2_,(PLANET *)lpplHome);
              }
              else {
                ChangeMainObjSel(2,lpfl->id);
                XferAiSupply(1,((FLEET *)lpfl)->idPlanet,2,lpfl->id,3,0x19);
                FLookupFleet(lpfl->id,(FLEET *)&sel.fl);
                lppl = LpplFromId(((FLEET *)lpfl)->idPlanet);
              }
              if (idPlanDst == -1) {
                if (((PLANET *)lppl != (PLANET *)0x0) || (lppl._2_2_ != 0)) {
                  pPVar19 = LpplFindClosestEnum(lppl,FEnumCalcColonistDrop);
                  if (((PLANET *)pPVar19 != (PLANET *)0x0) || ((int)((ulong)pPVar19 >> 0x10) != 0))
                  {
                    ((byte *)vlpbAiPlanet)[pPVar19->id * 0x10 + 10] =
                         ((byte *)vlpbAiPlanet)[pPVar19->id * 0x10 + 10] | 0x80;
                    _memset(&ord,0,0x12);
                    ord.id = pPVar19->id;
                    ord.pt.x = ((POINT *)rgptPlan + pPVar19->id)->x;
                    ord.pt.y = *(short *)((int)&rgptPlan[0].y + pPVar19->id * 4);
                    ord.wFlags = ord.wFlags & 0xe000U | 0x1161;
                    ord.txp.rgia[3].wFlags = ord.txp.rgia[3].wFlags & 0xfffU | 0x2000;
                    FMoveAiFleet(lpfl,&ord,0);
                    goto LAB_1088_4eb0;
                  }
                }
                if ((((THING *)lpthWorm != (THING *)0x0) || (lpthWorm._2_2_ != 0)) &&
                   (sVar8 = Random(100), sVar8 < 10)) {
                  FGotoWormholeAiFleet
                            (lpfl,(THING *)CONCAT22(lpthWorm._2_2_,(THING *)lpthWorm));
                }
              }
              else {
                FColonizeAiFleet(lpfl,idPlanDst);
                ((byte *)vlpbAiPlanet)[idPlanDst * 0x10 + 0xf] = 4;
              }
            }
          }
        }
      }
      else {
        if (game.turn == 0) goto AI_LScrapFleet_3;
        if (pFVar13->idPlanet != -1) {
          ChangeMainObjSel(2,lpfl->id);
          b = ((byte *)vlpbAiPlanet)[((FLEET *)lpfl)->idPlanet * 0x10 + 1];
          if (b < 4) {
            lppl = LpplFindBestEnum(&sel.pl,FEnumCalcMinerDest);
            if (((PLANET *)lppl != (PLANET *)0x0) || ((int)((ulong)lppl >> 0x10) != 0)) {
              _memset(&ord,0,0x12);
              ord.id = lppl->id;
              ord.pt.x = ((POINT *)rgptPlan + lppl->id)->x;
              ord.pt.y = *(short *)((int)&rgptPlan[0].y + lppl->id * 4);
              ord.wFlags = ord.wFlags & 0xe000U | 0x1163;
              FMoveAiFleet(lpfl,&ord,1);
              ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 1] =
                   ((byte *)vlpbAiPlanet)[lppl->id * 0x10 + 1] | 0x80;
              ((byte *)vlpbAiPlanet)[((FLEET *)lpfl)->idPlanet * 0x10 + 1] =
                   ((byte *)vlpbAiPlanet)[((FLEET *)lpfl)->idPlanet * 0x10 + 1] & 0x80;
            }
          }
        }
      }
    }
LAB_1088_4eb0:
  }
  HandleBasicAiTasks(iroCur,rgprod,ishdefSBLatest,rgResAvail,rgResCost);
  FillProductionQueue();
  return;
}



// ======================================================================
// Function: EnsureTurinDroneShdefs
// Address: 1088:58ba
// Segment: MEMORY_AI
// ======================================================================


void EnsureTurinDroneShdefs(short iroCur)

{
  SHDEF *pSVar1;
  SHDEF *pSVar2;
  short sVar3;
  int iVar4;
  SHDEF *pSVar5;
  SHDEF *pSVar6;
  undefined2 unaff_SS;
  short i;
  SHDEF shdef;
  
  if (((((uint)rgshdef[8].wFlags >> 9 & 1) != 0) &&
      ('\x04' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
     ('\a' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) {
    FCreateAiShdef(8,0xc,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                               (byte *)vrgTDAip + vrgTDIshAip[0xc]));
  }
  if (((((uint)rgshdef[9].wFlags >> 9 & 1) != 0) &&
      ('\x06' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))) &&
     ('\n' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) {
    FCreateAiShdef(9,0xd,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                               (byte *)vrgTDAip + vrgTDIshAip[0xf]));
  }
  if (((((uint)rgshdef[10].wFlags >> 9 & 1) != 0) &&
      ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
     (('\x04' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
      (('\x03' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
       ('\x04' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) {
    for (i = 0; i < 4; i = i + 1) {
      sVar3 = Random(1);
      sVar3 = FCreateAiShdef(10,6,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                        (byte *)vrgTDAip +
                                                        ((byte *)vrgTDIshAip + 2)[sVar3]));
      if (sVar3 != 0) break;
    }
  }
  if ((((uint)rgshdef[1].wFlags >> 9 & 1) != 0) ||
     (((int)rgshdef[1].cExist == 0 && (rgshdef[1].cExist._2_2_ == 0)))) {
    if ((((uint)rgshdef[1].wFlags >> 9 & 1) == 0) &&
       (rgshdef[1].hul.ihuldef != ihuldefPrivateer)) {
      pSVar5 = (SHDEF *)(rgshdef + 1);
      pSVar6 = &shdef;
      for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
        pSVar2 = pSVar6;
        pSVar6 = (SHDEF *)(pSVar6->hul).rgTech;
        pSVar1 = pSVar5;
        pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
        (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
      }
      *(char *)&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
      shdef.wFlags = shdef.wFlags & 0xfdffU | 0x200;
      FChangeAiShdef(&shdef,1);
    }
    FCreateAiShdef(1,0xf,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                               (byte *)vrgTDAip + vrgTDIshAip[0]));
  }
  if ((((uint)rgshdef[0].wFlags >> 9 & 1) != 0) ||
     (((int)rgshdef[0].cExist == 0 && (rgshdef[0].cExist._2_2_ == 0)))) {
    if (((uint)rgshdef[0].wFlags >> 9 & 1) == 0) {
      pSVar5 = (SHDEF *)rgshdef;
      pSVar6 = &shdef;
      for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
        pSVar2 = pSVar6;
        pSVar6 = (SHDEF *)(pSVar6->hul).rgTech;
        pSVar1 = pSVar5;
        pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
        (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
      }
      *(char *)&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
      shdef.wFlags = shdef.wFlags & 0xfdffU | 0x200;
      FChangeAiShdef(&shdef,0);
    }
    FCreateAiShdef(0,5,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                             (byte *)vrgTDAip + vrgTDIshAip[1]));
  }
  if ((((((uint)rgshdef[2].wFlags >> 9 & 1) != 0) ||
       (((int)rgshdef[2].cExist == 0 && (rgshdef[2].cExist._2_2_ == 0)))) &&
      ('\x06' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) &&
     ('\x03' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) {
    if (((uint)rgshdef[2].wFlags >> 9 & 1) == 0) {
      pSVar5 = (SHDEF *)(rgshdef + 2);
      pSVar6 = &shdef;
      for (iVar4 = 0x49; iVar4 != 0; iVar4 = iVar4 + -1) {
        pSVar2 = pSVar6;
        pSVar6 = (SHDEF *)(pSVar6->hul).rgTech;
        pSVar1 = pSVar5;
        pSVar5 = (SHDEF *)(pSVar5->hul).rgTech;
        (pSVar2->hul).ihuldef = (pSVar1->hul).ihuldef;
      }
      *(char *)&(pSVar6->hul).ihuldef = (char)(pSVar5->hul).ihuldef;
      shdef.wFlags = shdef.wFlags & 0xfdffU | 0x200;
      FChangeAiShdef(&shdef,2);
    }
    FCreateAiShdef(2,0x16,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                (byte *)vrgTDAip + vrgTDIshAip[0x11]));
  }
  if (((((uint)rgshdef[0xc].wFlags >> 9 & 1) != 0) ||
      (((int)rgshdef[0xc].cExist == 0 && (rgshdef[0xc].cExist._2_2_ == 0)))) &&
     (('\x03' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
      ('\x03' < *(char *)((int)rgplr[0].rgTech + 5 + idPlayer * 0xc0))))) {
    FCreateAiShdef(0xc,0xb,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                 (byte *)vrgTDAip + vrgTDIshAip[0xe]));
  }
  if ((((((uint)rgshdef[0xd].wFlags >> 9 & 1) != 0) &&
       ('\a' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
      ('\x06' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
     ('\x05' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0))) {
    FCreateAiShdef(0xd,0x12,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                  (byte *)vrgTDAip + vrgTDIshAip[0xd]));
  }
  if (((((uint)rgshdef[0xe].wFlags >> 9 & 1) != 0) &&
      ('\n' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
     (('\v' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
      (('\x0e' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
       ('\b' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) {
    FCreateAiShdef(0xe,0x12,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                  (byte *)vrgTDAip + vrgTDIshAip[0xd]));
  }
  if ((((((uint)rgshdef[4].wFlags >> 9 & 1) != 0) &&
       ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
      ('\x05' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0))) &&
     (('\f' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
      ('\x06' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))) {
    for (i = 0; i < 5; i = i + 1) {
      sVar3 = Random(4);
      sVar3 = FCreateAiShdef(4,9,(byte *)CONCAT22((undefined *)&DAT_1120_1088,
                                                       (byte *)vrgTDAip +
                                                       *(byte *)((int)&rgptPlan[0x19d].y +
                                                                sVar3)));
      if (sVar3 != 0) break;
    }
  }
  if (((((uint)rgshdef[0xf].wFlags >> 9 & 1) != 0) &&
      ('\x04' < *(char *)((int)rgplr[0].rgTech + 1 + idPlayer * 0xc0))) &&
     (('\x05' < *(char *)((int)rgplr[0].rgTech + 4 + idPlayer * 0xc0) &&
      (('\f' < *(char *)((int)rgplr[0].rgTech + 3 + idPlayer * 0xc0) &&
       ('\x06' < *(char *)((int)rgplr[0].rgTech + 2 + idPlayer * 0xc0))))))) {
    i = 0;
    while ((i < 5 && (sVar3 = FCreateAiShdef(0xf,0xc,(byte *)CONCAT22((undefined *)
                                                                           &DAT_1120_1088,
                                                                           (byte *)vrgTDAip +
                                                                           vrgTDIshAip[0xc])),
                     sVar3 == 0))) {
      i = i + 1;
    }
  }
  return;
}



// ======================================================================
// Function: FEnumCalcMinerDest
// Address: 1088:5f32
// Segment: MEMORY_AI
// ======================================================================


short FEnumCalcMinerDest(PLANET *lpplSrc,PLANET *lpplTest)

{
  byte bVar1;
  short sVar2;
  uint uVar3;
  byte b;
  short id;
  
  if (((PLANET *)lpplSrc == (PLANET *)lpplTest) && (lpplSrc._2_2_ == lpplTest._2_2_)) {
    uVar3 = 0;
  }
  else {
    bVar1 = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 1];
    if ((bVar1 == 0) || ((sVar2 = Random(100), 0x18 < sVar2 && ((bVar1 & 0x80) != 0)))) {
      uVar3 = 0;
    }
    else {
      uVar3 = (uint)bVar1;
    }
  }
  return uVar3;
}



// ======================================================================
// Function: FEnumCalcColonistDrop
// Address: 1088:5fc8
// Segment: MEMORY_AI
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10886069) */
/* WARNING: Removing unreachable block (ram,0x1088607a) */

short FEnumCalcColonistDrop(PLANET *lpplSrc,PLANET *lpplTest)

{
  byte bVar1;
  short sVar2;
  uint uVar3;
  byte bEnemy;
  byte bWant;
  short id;
  
  if (((PLANET *)lpplSrc == (PLANET *)lpplTest) && (lpplSrc._2_2_ == lpplTest._2_2_)) {
    uVar3 = 0;
  }
  else {
    bVar1 = ((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 3];
    if ((((byte *)vlpbAiPlanet)[lpplTest->id * 0x10 + 10] == 1) && (bVar1 != 0)) {
      sVar2 = GetRaceStat((PLAYER *)rgplr + ((PLANET *)lpplTest)->iPlayer,rsMajorAdv
                               );
      if (sVar2 == raMacintosh) {
        uVar3 = 0;
      }
      else {
        uVar3 = (uint)bVar1;
      }
    }
    else {
      uVar3 = 0;
    }
  }
  return uVar3;
}



