// Decompiled code from stars.exe
// Generated by Ghidra - ExportAllDecompiled.py
// Grouped by nb09_ghidra_globals.json segmap.segname
// 

// ======================================================================
// Function: FCreateStuff
// Address: 1000:0014
// Segment: MEMORY_INIT
// ======================================================================


short FCreateStuff(void)

{
  undefined2 *puVar1;
  undefined2 uVar2;
  PLAYER *pPVar3;
  byte *pbVar4;
  short *psVar5;
  ushort *puVar6;
  ushort *puVar7;
  fn_lpfnFakeListProc *pfVar8;
  fn_lpfnGaugeDlgProc *pfVar9;
  fn_lpfnFakeEditProc *pfVar10;
  fn_lpfnFakeComboProc *pfVar11;
  fn_lpfnFakeCEProc *pfVar12;
  fn_lpfnReportDlgProc *pfVar13;
  fn_lpfnBrowserDlgProc *pfVar14;
  fn_lpfnHostTimerProc *pfVar15;
  byte *pbVar16;
  bool bVar17;
  short sVar18;
  short sVar19;
  HBITMAP HVar20;
  HBRUSH HVar21;
  ushort uVar22;
  char *sz;
  int iVar23;
  undefined2 *puVar24;
  PLAYER *pPVar25;
  ushort *puVar26;
  short dx;
  HBITMAP hbmp;
  short i;
  short dy;
  short fFailed;
  
  bVar17 = false;
  sVar18 = GetSystemMetrics(0);
  sVar19 = GetSystemMetrics(1);
  if ((sVar18 < 800) || (sVar19 < 600)) {
    gd._0_2_ = gd._0_2_ & 0x3fff;
  }
  else if ((sVar18 < 0x400) || (sVar19 < 0x300)) {
    gd._0_2_ = gd._0_2_ & 0x3fff | 0x4000;
  }
  else if ((sVar18 < 0x457) || (sVar19 < 0x378)) {
    gd._0_2_ = gd._0_2_ & 0x3fff | 0x8000;
  }
  else {
    gd._0_2_ = gd._0_2_ & 0x3fff | 0xc000;
  }
  gd._0_2_ = gd._0_2_ & 0xfb7f;
  puVar24 = (undefined2 *)&vrgplrDef;
  pPVar25 = (PLAYER *)&vplr;
  for (iVar23 = 0x60; iVar23 != 0; iVar23 = iVar23 + -1) {
    pPVar3 = pPVar25;
    pPVar25 = (PLAYER *)&pPVar25->cPlanet;
    puVar1 = puVar24;
    puVar24 = puVar24 + 1;
    uVar2 = *puVar1;
    pPVar3->iPlayer = (char)uVar2;
    pPVar3->cShDef = (char)((uint)uVar2 >> 8);
  }
  hrgnHuge = CreateRectRgn(-10,-10,2000,2000);
  hrgnScratch = CreateRectRgn(0,0,10,10);
  hbrShip = HbrGet(0xff00);
  hbrStarbase = HbrGet(0xffff);
  hbrBBlue = HbrGet(0xff0000);
  hbrEnemy = HbrGet(0xff);
  hbrSelect = HbrGet(0xffff);
  hbrRed = HbrGet(0xff);
  hbrBlue = HbrGet(0x7f0000);
  hbrGreen = HbrGet(0x7f00);
  hbrRadar = HbrGet(0x7f);
  hbrPurple = HbrGet(0x7f007f);
  hbrTooltip = HbrGet(0x9fffff);
  hbrRadarNear = 0;
  rghbrMineral[0] = HbrGet(0xff0000);
  rghbrMineral[1] = HbrGet(0x7f00);
  rghbrMineral[2] = HbrGet(0xffff);
  rghbrMineral[3] = HbrGet(0xffffff);
  rghbrMineral[4] = HbrGet(0xff);
  rghbrPlanetAttr[0][0] = HbrGet(0x7f0000);
  rghbrPlanetAttr[0][1] = HbrGet(0xff0000);
  rghbrPlanetAttr[1][0] = HbrGet(0x7f);
  rghbrPlanetAttr[1][1] = HbrGet(0xff);
  rghbrPlanetAttr[2][0] = HbrGet(0x7f00);
  rghbrPlanetAttr[2][1] = HbrGet(0xff00);
  rghbrMinSum[0][0] = HbrGet(0xff0000);
  rghbrMinSum[0][1] = HbrGet(0x7f0000);
  rghbrMinSum[1][0] = HbrGet(0xff00);
  rghbrMinSum[1][1] = HbrGet(0x7f00);
  rghbrMinSum[2][0] = HbrGet(0xffff);
  rghbrMinSum[2][1] = HbrGet(0x7f7f);
  rghbrMinSum[3][0] = HbrGet(0xff);
  rghbrMinSum[3][1] = HbrGet(0x7f);
  hbrYellow = HbrGet(0xffff);
  hbrDkYellow = HbrGet(0x7f7f);
  hbrLightGray = HbrGet(0xc0c0c0);
  hbrGray = HbrGet(0x808080);
  hpenShip = CreatePen(0,1,0xff00);
  hpenDkGreen = CreatePen(0,1,0x7f00);
  hpenStarbase = CreatePen(0,1,0xff0000);
  hpenEnemy = CreatePen(0,1,0xff);
  hpenMassPath = CreatePen(2,1,0x7f7f7f);
  hpenRadar = CreatePen(0,1,0x7f);
  hpenRadarNear = 0;
  hpenDkBlue = CreatePen(0,1,0x7f0000);
  hpenYellow = CreatePen(0,1,0xffff);
  hpenDkYellow = CreatePen(0,1,0x7f7f);
  hpenDkPurple = CreatePen(0,1,0x7f007f);
  HVar20 = LoadBitmap(hInst,s_Screen50Bmp_1120_05e6);
  hbr50Screen = CreatePatternBrush(HVar20);
  DeleteObject(HVar20);
  for (i = 0; i < 3; i = i + 1) {
    HVar20 = LoadBitmap(hInst,(LPCSTR)(ulong)(i + 0x1cc));
    HVar21 = CreatePatternBrush(HVar20);
    ((ushort *)rghbrPat)[i] = HVar21;
    DeleteObject(HVar20);
  }
  HVar20 = LoadBitmap(hInst,s_CargoBmp_1120_05f2);
  hbrCargo = CreatePatternBrush(HVar20);
  DeleteObject(HVar20);
  HVar20 = LoadBitmap(hInst,(LPCSTR)0x112005fb);
  hbrDock = CreatePatternBrush(HVar20);
  DeleteObject(HVar20);
  hcurScanner = LoadCursor(hInst,s_ScannerCur_1120_0603);
  hcurScanAdd = LoadCursor(hInst,s_ScannerAdd_1120_060e);
  hcurOpenGrab = LoadCursor(hInst,s_OpenGrabCur_1120_0619);
  hcurCloseGrab = LoadCursor(hInst,s_CloseGrabCur_1120_0625);
  hcurTrashCan = LoadCursor(hInst,&DAT_0000_007a);
  hcurNoWay = LoadCursor(hInst,&DAT_0000_0079);
  hcurResizeWE = LoadCursor(hInst,&DAT_0000_0102);
  hcurResizeNS = LoadCursor(hInst,&DAT_0000_0104);
  hcurResize4Way = LoadCursor(hInst,&DAT_0000_0107);
  hcurArrowHelp = LoadCursor(hInst,&DAT_0000_0108);
  hcurHand = LoadCursor(hInst,&DAT_0000_0109);
  hbmpScanner = LoadBitmap(hInst,s_ScannerBmp_1120_0632);
  hbmpScanShip = LoadBitmap(hInst,&DAT_0000_0058);
  hbmpUnknownPlanet = LoadBitmap(hInst,s_UnknownPlanetBmp_1120_063d);
  hbmpNumbers = LoadBitmap(hInst,&DAT_0000_00f9);
  hdibPlanets = HdibLoadBigResource(0x70);
  hdibThings = HdibLoadBigResource(0x57);
  hdibToolbar = HdibLoadBigResource(0xb2);
  if (((hdibPlanets == 0) || (hdibThings == 0)) || (hdibToolbar == 0))
  {
    bVar17 = true;
  }
  for (i = 0; i < 5; i = i + 1) {
    uVar22 = HdibLoadBigResource(i + 0x228);
    ((ushort *)rghdibShips)[i] = uVar22;
    if (((ushort *)rghdibShips)[i] == 0) {
      bVar17 = true;
    }
    uVar22 = HdibLoadBigResource(i + 0x22d);
    ((ushort *)rghdibShipsT)[i] = uVar22;
    if (((ushort *)rghdibShipsT)[i] == 0) {
      bVar17 = true;
    }
  }
  for (i = 0; i < 7; i = i + 1) {
    uVar22 = HdibLoadBigResource(i + 500);
    ((ushort *)rghdibInventory)[i] = uVar22;
    if (((ushort *)rghdibInventory)[i] == 0) {
      bVar17 = true;
    }
  }
  vhpal = HpalFromDib(rghdibShips[3]);
  hdibRaces = HdibLoadBigResource(0x85);
  hdibRacesT = HdibLoadBigResource(0x50);
  hdibRacesX = HdibLoadBigResource(0x4f);
  hbmpBackBld = LoadBitmap(hInst,&DAT_0000_0077);
  hbmpMsg = LoadBitmap(hInst,&DAT_0000_0086);
  hbmpMono = LoadBitmap(hInst,&DAT_0000_00c7);
  hdibPlaque = HdibLoadBigResource(0x437);
  hiconStars = LoadIcon(hInst,s_StarsIco_1120_064e);
  hiconHost = LoadIcon(hInst,s_HostIco_1120_0657);
  hiconWait = LoadIcon(hInst,s_WaitIco_1120_065f);
  rghiconVCR[0] = LoadIcon(hInst,(LPCSTR)0x11200667);
  rghiconVCR[1] = LoadIcon(hInst,(LPCSTR)0x11200670);
  rghiconVCR[2] = LoadIcon(hInst,(LPCSTR)0x11200679);
  rghiconVCR[3] = LoadIcon(hInst,(LPCSTR)0x11200682);
  rghiconVCR[4] = LoadIcon(hInst,(LPCSTR)0x1120068b);
  rghiconVCR[5] = LoadIcon(hInst,(LPCSTR)0x11200694);
  rghiconVCR[6] = LoadIcon(hInst,(LPCSTR)0x1120069d);
  lpLog = LpAlloc(32000,htLog);
  lpMsg = LpAlloc(0xffc8,htMsg);
  lpfnFakeComboProc = MakeProcInstance(FakeComboProc,hInst);
  lpfnFakeCEProc = MakeProcInstance(FakeCEProc,hInst);
  lpfnFakeEditProc = MakeProcInstance(FakeEditProc,hInst);
  lpfnFakeListProc = MakeProcInstance(FakeListProc,hInst);
  lpfnHostTimerProc = MakeProcInstance(HostTimerProc,hInst);
  lpfnBrowserDlgProc = MakeProcInstance(BrowserDlg,hInst);
  lpfnReportDlgProc = MakeProcInstance(ReportDlg,hInst);
  lpfnGaugeDlgProc = MakeProcInstance(ProgressGaugeDlg,hInst);
  GetDiskSerialNumber();
  lpb2k = LpAlloc(0x800,htPerm);
  vlprgidMisc = LpAlloc(0x800,htPerm);
  vlprgidPlanet = LpAlloc(0x800,htPerm);
  puVar26 = LpAlloc(0x800,htPerm);
  if (((((bVar17) || (hbmpScanner == 0)) ||
       ((hbmpUnknownPlanet == 0 ||
        ((hbmpBackBld == 0 || (hdibRaces == 0)))))) ||
      (hdibRacesT == 0)) ||
     (((((hdibRacesX == 0 || (hbmpMono == 0)) || (hbmpScanShip == 0))
       || ((hbmpMsg == 0 || (hiconHost == 0)))) ||
      ((hiconStars == 0 || (hiconWait == 0)))))) {
    sVar18 = 0x10;
    vlprgidFleet = puVar26;
    sz = PszFormatIds(idsUnableLoadBitmaps,(short *)0x0);
    AlertSz(sz,sVar18);
    sVar18 = 0;
    puVar26 = vlprgidFleet;
    pbVar4 = lpLog;
    psVar5 = lpMsg;
    puVar6 = vlprgidMisc;
    puVar7 = vlprgidPlanet;
    pfVar8 = lpfnFakeListProc;
    pfVar9 = lpfnGaugeDlgProc;
    pfVar10 = lpfnFakeEditProc;
    pfVar11 = lpfnFakeComboProc;
    pfVar12 = lpfnFakeCEProc;
    pfVar13 = lpfnReportDlgProc;
    pfVar14 = lpfnBrowserDlgProc;
    pfVar15 = lpfnHostTimerProc;
    pbVar16 = lpb2k;
  }
  else {
    sVar18 = 1;
    pbVar4 = lpLog;
    psVar5 = lpMsg;
    puVar6 = vlprgidMisc;
    puVar7 = vlprgidPlanet;
    pfVar8 = lpfnFakeListProc;
    pfVar9 = lpfnGaugeDlgProc;
    pfVar10 = lpfnFakeEditProc;
    pfVar11 = lpfnFakeComboProc;
    pfVar12 = lpfnFakeCEProc;
    pfVar13 = lpfnReportDlgProc;
    pfVar14 = lpfnBrowserDlgProc;
    pfVar15 = lpfnHostTimerProc;
    pbVar16 = lpb2k;
  }
  lpb2k._2_2_ = (undefined2)((ulong)pbVar16 >> 0x10);
  lpb2k._0_2_ = (byte *)pbVar16;
  lpfnHostTimerProc._2_2_ = (undefined2)((ulong)pfVar15 >> 0x10);
  lpfnHostTimerProc._0_2_ = (fn_lpfnHostTimerProc *)pfVar15;
  lpfnBrowserDlgProc._2_2_ = (undefined2)((ulong)pfVar14 >> 0x10);
  lpfnBrowserDlgProc._0_2_ = (fn_lpfnBrowserDlgProc *)pfVar14;
  lpfnReportDlgProc._2_2_ = (undefined2)((ulong)pfVar13 >> 0x10);
  lpfnReportDlgProc._0_2_ = (fn_lpfnReportDlgProc *)pfVar13;
  lpfnFakeCEProc._2_2_ = (undefined2)((ulong)pfVar12 >> 0x10);
  lpfnFakeCEProc._0_2_ = (fn_lpfnFakeCEProc *)pfVar12;
  lpfnFakeComboProc._2_2_ = (undefined2)((ulong)pfVar11 >> 0x10);
  lpfnFakeComboProc._0_2_ = (fn_lpfnFakeComboProc *)pfVar11;
  lpfnFakeEditProc._2_2_ = (undefined2)((ulong)pfVar10 >> 0x10);
  lpfnFakeEditProc._0_2_ = (fn_lpfnFakeEditProc *)pfVar10;
  lpfnGaugeDlgProc._2_2_ = (undefined2)((ulong)pfVar9 >> 0x10);
  lpfnGaugeDlgProc._0_2_ = (fn_lpfnGaugeDlgProc *)pfVar9;
  lpfnFakeListProc._2_2_ = (undefined2)((ulong)pfVar8 >> 0x10);
  lpfnFakeListProc._0_2_ = (fn_lpfnFakeListProc *)pfVar8;
  vlprgidPlanet._2_2_ = (undefined2)((ulong)puVar7 >> 0x10);
  vlprgidPlanet._0_2_ = (ushort *)puVar7;
  vlprgidMisc._2_2_ = (undefined2)((ulong)puVar6 >> 0x10);
  vlprgidMisc._0_2_ = (ushort *)puVar6;
  lpMsg._2_2_ = (undefined2)((ulong)psVar5 >> 0x10);
  lpMsg._0_2_ = (short *)psVar5;
  lpLog._2_2_ = (undefined2)((ulong)pbVar4 >> 0x10);
  lpLog._0_2_ = (byte *)pbVar4;
  vlprgidFleet._2_2_ = (undefined2)((ulong)puVar26 >> 0x10);
  vlprgidFleet._0_2_ = (ushort *)puVar26;
  return sVar18;
}



// ======================================================================
// Function: FCreateFonts
// Address: 1000:0ab2
// Segment: MEMORY_INIT
// ======================================================================


short FCreateFonts(HDC hdc)

{
  int *piVar1;
  short sVar2;
  HFONT HVar3;
  HGDIOBJ HVar4;
  undefined2 unaff_SS;
  DWORD DVar5;
  short sVar6;
  long l;
  TEXTMETRIC tm;
  HFONT hfontSav;
  LOGFONT *plf;
  short i;
  
  piVar1 = (int *)LocalAlloc(0x40,0x32);
  for (i = 0; i < 4; i = i + 1) {
    if (*(char *)(i * 0x20 + 0x6a6) == '\0') {
      CchGetString(i + idsArial2,(char *)(i * 0x20 + 0x6a6));
    }
  }
  sVar6 = 10;
  sVar2 = GetDeviceCaps(hdc,0x5a);
  sVar2 = MulDiv(sVar6,sVar2,0x48);
  *piVar1 = -sVar2;
  for (i = 0; i < 2; i = i + 1) {
    _strcpy((char *)(piVar1 + 9),(char *)(i * 0x20 + 0x6a6));
    HVar3 = CreateFontIndirect((int *)CONCAT22((undefined1 *)&DAT_1120_1120,piVar1));
    ((ushort *)rghfontArial10)[i] = HVar3;
  }
  _strcpy((char *)(piVar1 + 9),*(char (*) [32])rgszArial);
  sVar6 = 6;
  sVar2 = GetDeviceCaps(hdc,0x5a);
  sVar2 = MulDiv(sVar6,sVar2,0x48);
  *piVar1 = -sVar2;
  rghfontArial6[0] =
       CreateFontIndirect((int *)CONCAT22((undefined1 *)&DAT_1120_1120,piVar1));
  sVar6 = 7;
  sVar2 = GetDeviceCaps(hdc,0x5a);
  sVar2 = MulDiv(sVar6,sVar2,0x48);
  *piVar1 = -sVar2;
  rghfontArial7[0] =
       CreateFontIndirect((int *)CONCAT22((undefined1 *)&DAT_1120_1120,piVar1));
  sVar6 = 8;
  sVar2 = GetDeviceCaps(hdc,0x5a);
  sVar2 = MulDiv(sVar6,sVar2,0x48);
  *piVar1 = -sVar2;
  for (i = 0; i < 4; i = i + 1) {
    _strcpy((char *)(piVar1 + 9),(char *)(i * 0x20 + 0x6a6));
    HVar3 = CreateFontIndirect((int *)CONCAT22((undefined1 *)&DAT_1120_1120,piVar1));
    ((ushort *)rghfontArial8)[i] = HVar3;
  }
  _strcpy((char *)(piVar1 + 9),*(char (*) [32])(rgszArial + 1));
  piVar1[2] = 0xc4e;
  rghfontArial8[4] =
       CreateFontIndirect((int *)CONCAT22((undefined1 *)&DAT_1120_1120,piVar1));
  HVar4 = SelectObject(hdc,rghfontArial8[0]);
  GetTextMetrics(hdc,(undefined2 *)CONCAT22(unaff_SS,&tm));
  dyArial8 = tm.tmHeight + tm.tmExternalLeading;
  DVar5 = GetTextExtent(hdc,(LPCSTR)0x11200726,10);
  dxMaxMineralQuan = (short)DVar5;
  SelectObject(hdc,rghfontArial7[0]);
  GetTextMetrics(hdc,(undefined2 *)CONCAT22(unaff_SS,&tm));
  dyArial7 = tm.tmHeight + tm.tmExternalLeading;
  SelectObject(hdc,rghfontArial6[0]);
  GetTextMetrics(hdc,(undefined2 *)CONCAT22(unaff_SS,&tm));
  dyArial6 = tm.tmHeight + tm.tmExternalLeading;
  SelectObject(hdc,rghfontArial10[0]);
  GetTextMetrics(hdc,(undefined2 *)CONCAT22(unaff_SS,&tm));
  dyArial10 = tm.tmHeight + tm.tmExternalLeading;
  SelectObject(hdc,HVar4);
  LocalFree((HLOCAL)piVar1);
  return 1;
}



// ======================================================================
// Function: InitInstance
// Address: 1000:0d70
// Segment: MEMORY_INIT
// ======================================================================


short InitInstance(short nCmdShow)

{
  short sVar1;
  RECT rc;
  short sw;
  
  ini.wFlags = ini.wFlags & 0xfe1a;
  ini.idPlayer = -1;
  ReadIniSettings();
  hwndFrame =
       CreateWindow(szFrame,(LPCSTR)0x11200731,0xcf0000,ini.wnFrame.rc.left,
                    ini.wnFrame.rc.top,ini.wnFrame.rc.right,
                    ini.wnFrame.rc.bottom,0,0,hInst,(void *)0x0);
  if (hwndFrame == 0) {
    sVar1 = 0;
  }
  else {
    hAccel = LoadAccelerators(hInst,&DAT_0000_0074);
    if (hAccel == 0) {
      sVar1 = 0;
    }
    else {
      hAccelTitle = LoadAccelerators(hInst,&DAT_0000_0438);
      if (hAccelTitle == 0) {
        sVar1 = 0;
      }
      else {
        if (nCmdShow == 1) {
          if (((ini.wnFrame.wFlags & 1U) == 0) &&
             (((uint)ini.wnFrame.wFlags >> 1 & 1) == 0)) {
            sw = 1;
          }
          else {
            sw = 3;
          }
        }
        else {
          sw = nCmdShow;
        }
        ShowWindow(hwndFrame,sw);
        ShowWindow(hwndFrame,0);
        sVar1 = 1;
      }
    }
  }
  return sVar1;
}



// ======================================================================
// Function: InitTiles
// Address: 1000:0eaa
// Segment: MEMORY_INIT
// ======================================================================


void InitTiles(void)

{
  int iVar1;
  ushort iCol;
  short iPass;
  short i;
  TILE *rgtile;
  short ctile;
  short yTop;
  
  iPass = 2;
  rgtile = (TILE *)(TILE *)&rgtilePlanet;
  ctile = 6;
  while (iPass != 0) {
    iCol = 0;
    yTop = 4;
    for (i = 0; i < ctile; i = i + 1) {
      if ((rgtile[i].wFlags & 7U) != iCol) {
        yTop = 4;
        iCol = rgtile[i].wFlags & 7;
      }
      rgtile[i].dyFull = rgtile[i].dyFull + (rgtile + i)->yTop * dyArial8;
      (rgtile + i)->yTop = yTop;
      rgtile[i].wFlags = rgtile[i].wFlags & 0xf7ff;
      rgtile[i].wFlags = rgtile[i].wFlags & 0xefff;
      if (((uint)rgtile[i].wFlags >> 7 & 1) == 0) {
        iVar1 = dyArial8 + 7;
      }
      else {
        iVar1 = rgtile[i].dyFull + 4;
      }
      yTop = yTop + iVar1;
    }
    rgtile = (TILE *)(TILE *)&rgtileShip;
    ctile = 7;
    iPass = iPass + -1;
  }
  return;
}



// ======================================================================
// Function: GetIniWinRc
// Address: 1000:1020
// Segment: MEMORY_INIT
// ======================================================================


void GetIniWinRc(char *szSection,char *szIniFile,StringId ids,WN *pwn)

{
  short sVar1;
  undefined2 unaff_SS;
  bool bVar2;
  short rg [4];
  short fNeg;
  short i;
  char *pch;
  short j;
  RECT rc;
  short cch;
  char szEntry [16];
  short fMaximized;
  short fMinimized;
  short fInitalized;
  
  CchGetString(ids,szEntry);
  sVar1 = GetPrivateProfileString
                    ((LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,szSection),
                     (LPCSTR)CONCAT22(unaff_SS,szEntry),(LPCSTR)0x11200738,szWork,0x14,
                     (LPCSTR)CONCAT22((undefined1 *)&DAT_1120_1120,szIniFile));
  if ((sVar1 == 0x11) &&
     (((szWork[0] == 'M' || (szWork[0] == 'R')) || (szWork[0] == 'I'))
     )) {
    pch = (char *)szWork + 1;
    for (i = 0; i < 4; i = i + 1) {
      rg[i] = 0;
      bVar2 = false;
      for (j = 0; j < 4; j = j + 1) {
        if (*pch == '-') {
          bVar2 = true;
        }
        else {
          if ((*pch < '0') || ('9' < *pch)) goto INIT_NoRc;
          rg[i] = rg[i] * 10 + *pch + -0x30;
        }
        pch = pch + 1;
      }
      if (bVar2) {
        rg[i] = -rg[i];
      }
    }
    rc.left = rg[0];
    rc.top = rg[1];
    rc.right = rg[2];
    rc.bottom = rg[3];
    bVar2 = szWork[0] == 'M';
    fMinimized = (short)(szWork[0] == 'I');
    fInitalized = 1;
  }
  else {
INIT_NoRc:
    rc.left = -0x8000;
    rc.right = -0x8000;
    rc.bottom = 0;
    rc.top = 0;
    bVar2 = ids == idsMain;
    fMinimized = 0;
    fInitalized = 0;
  }
  fMaximized = (short)bVar2;
  (pwn->rc).left = rc.left;
  (pwn->rc).top = rc.top;
  (pwn->rc).right = rc.right;
  (pwn->rc).bottom = rc.bottom;
  pwn->wFlags = pwn->wFlags & 0xfffeU | fMaximized;
  pwn->wFlags = pwn->wFlags & 0xfffdU | fMinimized << 1;
  pwn->wFlags = pwn->wFlags & 0xfffbU | fInitalized << 2;
  return;
}



// ======================================================================
// Function: ReadIniSettings
// Address: 1000:124c
// Segment: MEMORY_INIT
// ======================================================================


/* WARNING: Removing unreachable block (ram,0x10001bda) */
/* WARNING: Restarted to delay deadcode elimination for space: ram */

void ReadIniSettings(void)

{
  ITEMACTION *pIVar1;
  uint *puVar2;
  char cVar3;
  char *pcVar4;
  char *pcVar5;
  UINT UVar6;
  char *sz;
  short sVar7;
  ushort uVar8;
  short sVar9;
  short sVar10;
  uint uVar11;
  int iVar12;
  undefined2 unaff_SI;
  undefined2 unaff_DI;
  undefined2 unaff_SS;
  long lVar13;
  long lVar14;
  ushort in_stack_0000ffb0;
  short cpq;
  short cch;
  char szSection [16];
  char *psz;
  ushort w;
  char szIniFile [16];
  WN wnT;
  char szEntry [16];
  short iPass;
  short i;
  ushort uDateCur;
  
  lVar14 = CONCAT22(unaff_SI,unaff_DI);
  ini.wFlags = ini.wFlags & 0xffe3;
  CchGetString(idsWindows,szSection);
  CchGetString(idsStarsIni,szIniFile);
  GetIniWinRc(szSection,szIniFile,idsMain,&((INI *)&ini)->wnFrame);
  GetIniWinRc(szSection,szIniFile,idsReportfleetwin,&wnT);
  if (wnT.rc.left != -0x8000) {
    vrptFleet.ptDlg.x = wnT.rc.left;
    vrptFleet.ptDlg.y = wnT.rc.top;
    vrptFleet.ptSize.x = wnT.rc.right - wnT.rc.left;
    vrptFleet.ptSize.y = wnT.rc.bottom - wnT.rc.top;
  }
  GetIniWinRc(szSection,szIniFile,idsReportefleetwin,&wnT);
  if (wnT.rc.left != -0x8000) {
    vrptEFleet.ptDlg.x = wnT.rc.left;
    vrptEFleet.ptDlg.y = wnT.rc.top;
    vrptEFleet.ptSize.x = wnT.rc.right - wnT.rc.left;
    vrptEFleet.ptSize.y = wnT.rc.bottom - wnT.rc.top;
  }
  GetIniWinRc(szSection,szIniFile,idsReportbtlwin,&wnT);
  if (wnT.rc.left != -0x8000) {
    vrptBattle.ptDlg.x = wnT.rc.left;
    vrptBattle.ptDlg.y = wnT.rc.top;
    vrptBattle.ptSize.x = wnT.rc.right - wnT.rc.left;
    vrptBattle.ptSize.y = wnT.rc.bottom - wnT.rc.top;
  }
  GetIniWinRc(szSection,szIniFile,idsReportplanwin,&wnT);
  if (wnT.rc.left != -0x8000) {
    vrptPlanet.ptDlg.x = wnT.rc.left;
    vrptPlanet.ptDlg.y = wnT.rc.top;
    vrptPlanet.ptSize.x = wnT.rc.right - wnT.rc.left;
    vrptPlanet.ptSize.y = wnT.rc.bottom - wnT.rc.top;
  }
  CchGetString(idsResolution,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if ((UVar6 == 0) && ((vcScreenColors < 5 || ((uint)gd._0_2_ >> 0xe == 0)))) {
    sVar7 = 0x10;
    sz = PszFormatIds(idsNoteStarsPrefersScreenResolutionLeast800x600,(short *)0x0);
    AlertSz(sz,sVar7);
  }
  CchGetString(idsLayout,szEntry);
  iWindowLayout =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = iWindowLayout;
  if (0x7fff < (uint)iWindowLayout) {
    UVar6 = 0;
  }
  if ((int)UVar6 < 3) {
    if (0x7fff < (uint)iWindowLayout) {
      iWindowLayout = 0;
    }
  }
  else {
    iWindowLayout = 2;
  }
  CchGetString(idsStyle1width,szEntry);
  vfs.dxPlanWant =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0x18c,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = vfs.dxPlanWant;
  if (vfs.dxPlanWant < 0xb) {
    UVar6 = 10;
  }
  if ((int)UVar6 < 2000) {
    if (vfs.dxPlanWant < 0xb) {
      vfs.dxPlanWant = 10;
    }
  }
  else {
    vfs.dxPlanWant = 2000;
  }
  CchGetString(idsStyle1height,szEntry);
  vfs.dyMsgWant =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0x6e,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = vfs.dyMsgWant;
  if (vfs.dyMsgWant < 0xb) {
    UVar6 = 10;
  }
  if ((int)UVar6 < 2000) {
    if (vfs.dyMsgWant < 0xb) {
      vfs.dyMsgWant = 10;
    }
  }
  else {
    vfs.dyMsgWant = 2000;
  }
  CchGetString(idsStyle1height2,szEntry);
  vfs.dyMinWant =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0xc0,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = vfs.dyMinWant;
  if (vfs.dyMinWant < 0xb) {
    UVar6 = 10;
  }
  if ((int)UVar6 < 2000) {
    if (vfs.dyMinWant < 0xb) {
      vfs.dyMinWant = 10;
    }
  }
  else {
    vfs.dyMinWant = 2000;
  }
  CchGetString(idsStyle2width,szEntry);
  vfs.dx2PlanWant =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0x18c,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = vfs.dx2PlanWant;
  if (vfs.dx2PlanWant < 0xb) {
    UVar6 = 10;
  }
  if ((int)UVar6 < 2000) {
    if (vfs.dx2PlanWant < 0xb) {
      vfs.dx2PlanWant = 10;
    }
  }
  else {
    vfs.dx2PlanWant = 2000;
  }
  CchGetString(idsStyle2height,szEntry);
  vfs.dy2MsgWant =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0x6e,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = vfs.dy2MsgWant;
  if (vfs.dy2MsgWant < 0xb) {
    UVar6 = 10;
  }
  if ((int)UVar6 < 2000) {
    if (vfs.dy2MsgWant < 0xb) {
      vfs.dy2MsgWant = 10;
    }
  }
  else {
    vfs.dy2MsgWant = 2000;
  }
  CchGetString(idsStyle2height2,szEntry);
  vfs.dy2MinWant =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0xc0,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  UVar6 = vfs.dy2MinWant;
  if (vfs.dy2MinWant < 0xb) {
    UVar6 = 10;
  }
  if ((int)UVar6 < 2000) {
    if (vfs.dy2MinWant < 0xb) {
      vfs.dy2MinWant = 10;
    }
  }
  else {
    vfs.dy2MinWant = 2000;
  }
  CchGetString(idsToolbar,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),1,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  gd.wFlags = gd.wFlags & 0x7fffU | (uint)(UVar6 != 0) << 0xf;
  CchGetString(idsGlobalsettings,szEntry);
  sVar7 = GetPrivateProfileString
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                     (LPCSTR)0x1120073a,szWork,0x28,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if (sVar7 == 0x1c) {
    FSerialAndEnvFromSz
              ((long *)&vSerialNumber,(byte *)vrgbMachineConfig,
               (char *)szWork);
  }
  else {
    vSerialNumber._0_2_ = 0;
    vSerialNumber._2_2_ = 0;
  }
  CchGetString(idsPlanettiles,szEntry);
  GetPrivateProfileString
            ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
             (LPCSTR)0x1120073c,szWork,0x14,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  ReadIniTileSettings((char *)szWork,(TILE *)(TILE *)&rgtilePlanet,6);
  CchGetString(idsShiptiles,szEntry);
  GetPrivateProfileString
            ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
             (LPCSTR)0x1120073e,szWork,0x14,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  ReadIniTileSettings((char *)szWork,(TILE *)(TILE *)&rgtileShip,7);
  CchGetString(idsSelection,szEntry);
  sVar7 = GetPrivateProfileString
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                     (LPCSTR)0x11200740,szWork,0x14,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if (sVar7 < 3) {
    ini.wFlags = ini.wFlags & 0xfe1f;
    goto LAB_1000_1995;
  }
  if (szWork[0] == 'E') {
    ini.wFlags = ini.wFlags & 0xfe1fU | 0x80;
  }
  else if (szWork[0] == 'N') {
LAB_1000_18db:
    ini.wFlags = ini.wFlags & 0xfe1f;
  }
  else if (szWork[0] == 'P') {
    ini.wFlags = ini.wFlags & 0xfe1fU | 0x20;
  }
  else {
    if (szWork[0] != 'S') goto LAB_1000_18db;
    ini.wFlags = ini.wFlags & 0xfe1fU | 0x40;
  }
  if ((szWork[1] < 'B') || ('Q' < szWork[1])) {
    ini.wFlags = ini.wFlags & 0xfe1f;
  }
  else {
    ini.idPlayer = szWork[1] + -0x42;
  }
  if (((uint)ini.wFlags >> 5 & 0xf) != 0) {
    ini.iObjSel = _atoi((char *)szWork + 2);
  }
LAB_1000_1995:
  CchGetString(idsMessage,szEntry);
  ini.iMsg =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  CchGetString(idsGameid,szEntry);
  sVar7 = GetPrivateProfileString
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                     (LPCSTR)0x11200742,szWork,10,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  lVar13 = 0;
  for (i = 0; ini.lid = lVar13, i < sVar7; i = i + 1) {
    lVar13 = __aFlshl(lVar14,in_stack_0000ffb0);
    if ((((char *)szWork)[i] < '0') || ('9' < ((char *)szWork)[i])) {
      if (('`' < ((char *)szWork)[i]) && (((char *)szWork)[i] < 'g')) {
        lVar13 = lVar13 + (((char *)szWork)[i] + -0x57);
      }
    }
    else {
      lVar13 = lVar13 + (((char *)szWork)[i] + -0x30);
    }
  }
  CchGetString(idsScanzoom,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),4,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if ((UVar6 != 0) && (UVar6 < 10)) {
    iScanZoom = UVar6 - 5;
  }
  CchGetString(idsScanfilterv25,szEntry);
  grbitScanShip =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  CchGetString(idsScanefilterv25,szEntry);
  grbitScanEShip =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  CchGetString(idsScanmines,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0xf,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  grbitScanMines = UVar6 & 0xf;
  CchGetString(idsScanradar,szEntry);
  w = GetPrivateProfileInt
                ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),100,
                 (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if (100 < w) {
    w = 100;
  }
  vpctRadarView = w;
  CchGetString(idsScanmodev25,szEntry);
  grbitScan =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0xe0,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if (5 < (grbitScan & 0xc00f)) {
    grbitScan = 0;
    grbitScanShip = 0;
  }
  CchGetString(idsMineralscale,szEntry);
  cMinGrafMax =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                  cMinGrafMax,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if ((cMinGrafMax < 100) || (30000 < cMinGrafMax)) {
    cMinGrafMax = (short)&DAT_1120_1388;
  }
  CchGetString(idsFiles,szSection);
  CchGetString(idsLogging,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  ini.wFlags = ini.wFlags & 0x7fffU | UVar6 << 0xf;
  CchGetString(idsWait2,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  ini.wFlags = ini.wFlags & 0xfffbU | (UVar6 & 1) << 2;
  CchGetString(idsFile1,szEntry);
  sVar7 = GetPrivateProfileString
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                     (LPCSTR)0x11200744,szWork,0x100,(LPCSTR)CONCAT22(unaff_SS,szIniFile))
  ;
  if (sVar7 < 4) {
    ini.wFlags = ini.wFlags & 0xfffe;
  }
  else {
    ini.wFlags = ini.wFlags & 0xfffeU | 1;
    _strcpy((char *)szBase,(char *)szWork);
  }
  if (((char *)vrgszMRU == (char *)0x0) &&
     (vrgszMRU = (char *)CONCAT22(vrgszMRU._2_2_,(char *)vrgszMRU),
     vrgszMRU._2_2_ == 0)) {
    vrgszMRU = LpAlloc(0x900,htPerm);
  }
  uVar8 = _strlen(szEntry);
  for (i = 0; i < 9; i = i + 1) {
    szEntry[uVar8 - 1] = (char)i + '1';
    sVar7 = GetPrivateProfileString
                      ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                       (LPCSTR)0x11200746,
                       (LPSTR)CONCAT22(vrgszMRU._2_2_,(char *)vrgszMRU + i * 0x100),
                       0x100,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
    if (sVar7 < 4) {
      ((char *)vrgszMRU)[i * 0x100] = '\0';
    }
  }
  iPass = 0;
  i = 0;
  pcVar4 = vrgszMRU;
  while( true ) {
    vrgszMRU._2_2_ = (int)((ulong)pcVar4 >> 0x10);
    vrgszMRU._0_2_ = (char *)pcVar4;
    vrgszMRU = pcVar4;
    if (8 < i) break;
    if (((char *)vrgszMRU)[i * 0x100] != '\0') {
      if (i != iPass) {
        pcVar4 = (char *)CONCAT22(vrgszMRU._2_2_,(char *)vrgszMRU + iPass * 0x100);
        pcVar5 = (char *)CONCAT22(vrgszMRU._2_2_,(char *)vrgszMRU + i * 0x100);
        __fstrcpy(pcVar4,pcVar5);
        ((char *)vrgszMRU)[i * 0x100] = '\0';
        pcVar4 = vrgszMRU;
      }
      iPass = iPass + 1;
    }
    i = i + 1;
  }
  CchGetString(idsTurn,szEntry);
  ini.turn =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
                  game.turn,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  CchGetString(idsMisc,szSection);
  CchGetString(idsDefaultpassword,szEntry);
  GetPrivateProfileString
            ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
             (LPCSTR)0x11200748,vszDefPass,0x10,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
  CchGetString(idsProgress,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  gd.wFlags = gd.wFlags & 0xfbffU | (uint)(UVar6 != 0) << 10;
  CchGetString(idsNewreports,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  gd.wFlags = gd.wFlags & 0xffdfU | (uint)(UVar6 != 0) << 5;
  CchGetString(idsNohostnames,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  gd.wFlags = gd.wFlags & 0xffbfU | (uint)(UVar6 != 0) << 6;
  CchGetString(idsBackups,szEntry);
  vcBackupDirs =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  if ((vcBackupDirs < 1) || (999 < vcBackupDirs)) {
    vcBackupDirs = 1;
  }
  CchGetString(idsReportplanfld,szEntry);
  vrptPlanet.grbitVisible._0_2_ =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),-1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptPlanet.grbitVisible._2_2_ = 0;
  CchGetString(idsReportplansort,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptPlanet.fAscending = (short)((UVar6 & 0x100) != 0);
  vrptPlanet.icolSort = UVar6 & 0xff;
  CchGetString(idsReportfleetfld,szEntry);
  vrptFleet.grbitVisible._0_2_ =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),-1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptFleet.grbitVisible._2_2_ = 0;
  CchGetString(idsReportfleetsort,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptFleet.fAscending = (short)((UVar6 & 0x100) != 0);
  vrptFleet.icolSort = UVar6 & 0xff;
  CchGetString(idsReportefleetfld,szEntry);
  vrptEFleet.grbitVisible._0_2_ =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),-1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptEFleet.grbitVisible._2_2_ = 0;
  CchGetString(idsReportefltsort,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptEFleet.fAscending = (short)((UVar6 & 0x100) != 0);
  vrptEFleet.icolSort = UVar6 & 0xff;
  CchGetString(idsReportbtlfld,szEntry);
  vrptBattle.grbitVisible._0_2_ =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),-1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptBattle.grbitVisible._2_2_ = 0;
  CchGetString(idsReportbtlsort,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),0,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  vrptBattle.fAscending = (short)((UVar6 & 0x100) != 0);
  vrptBattle.icolSort = UVar6 & 0xff;
  CchGetString(idsReportdefgraph,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),7,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  gd.wFlags = gd.wFlags & 0xfff0U | UVar6 & 0xf;
  CchGetString(idsReportefltsort,szEntry);
  if (7 < (gd.wFlags & 0xfU)) {
    gd.wFlags = gd.wFlags & 0xfff0U | 7;
  }
  CchGetString(idsVcrspeed,szEntry);
  viSpeedVCR =
       GetPrivateProfileInt
                 ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),1,
                  (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  __strdate((char *)szWork);
  szWork[5] = '\0';
  szWork[2] = '\0';
  sVar7 = _atoi((char *)szWork + 6);
  sVar9 = _atoi((char *)szWork);
  sVar10 = _atoi((char *)szWork + 3);
  uVar11 = sVar10 + sVar9 * 0x1f + sVar7 * 0x174;
  CchGetString(idsHistoryinfo,szEntry);
  UVar6 = GetPrivateProfileInt
                    ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),-1,
                     (LPCSTR)CONCAT22(unaff_SS,szIniFile));
  uDateInstalled = uVar11;
  if (UVar6 <= uVar11) {
    uDateInstalled = UVar6;
  }
  gd._4_2_ =
       gd._4_2_ & 0xfffd | (uint)(uDateInstalled + 0x15 <= uVar11) << 1;
  CchGetString(idsFonts,szSection);
  for (i = 0; i < 4; i = i + 1) {
    CchGetString(i + idsArial,szEntry);
    GetPrivateProfileString
              ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
               (LPCSTR)0x11200749,szWork,0x50,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
    uVar8 = _strlen((char *)szWork);
    if ((4 < (int)uVar8) && ((int)uVar8 < 0x20)) {
      _strcpy((char *)(i * 0x20 + 0x6a6),(char *)szWork);
    }
  }
  CchGetString(idsZiporders,szSection);
  _memset((ZIPORDER *)vrgZip,0,0x60);
  for (i = 0; i < 4; i = i + 1) {
    _strcpy(szEntry,szSection);
    uVar8 = _strlen(szEntry);
    szEntry[uVar8] = (char)i + '1';
    szEntry[uVar8 + 1] = '\0';
    GetPrivateProfileString
              ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
               (LPCSTR)0x1120074a,szWork,0x50,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
    uVar8 = _strlen((char *)szWork);
    if ((0x13 < (int)uVar8) && ((int)uVar8 < 0x21)) {
      iPass = 0;
      for (psz = (char *)szWork; ((iPass < 0x14 && ('`' < *psz)) && (*psz < 'q'));
          psz = psz + 1) {
        iPass = iPass + 1;
      }
      if (0x13 < iPass) {
        psz = (char *)szWork;
        for (iPass = 0; iPass < 5; iPass = iPass + 1) {
          (((ZIPORDER *)vrgZip)[i].txp.rgia + iPass)->wFlags =
               (((ZIPORDER *)vrgZip)[i].txp.rgia + iPass)->wFlags & 0xfffU |
               (*psz + -0x61) * 0x1000;
          (((ZIPORDER *)vrgZip)[i].txp.rgia + iPass)->wFlags =
               (((ZIPORDER *)vrgZip)[i].txp.rgia + iPass)->wFlags & 0xf000U |
               (int)psz[1] - 0x61U & 0xfff;
          cVar3 = psz[2];
          uVar11 = (((ZIPORDER *)vrgZip)[i].txp.rgia + iPass)->wFlags;
          pIVar1 = ((ZIPORDER *)vrgZip)[i].txp.rgia + iPass;
          pIVar1->wFlags = pIVar1->wFlags & 0xf000;
          pIVar1 = ((ZIPORDER *)vrgZip)[i].txp.rgia + iPass;
          pIVar1->wFlags = pIVar1->wFlags | ((cVar3 + -0x61) * 0x10 | uVar11) & 0xfff;
          cVar3 = psz[3];
          uVar11 = (((ZIPORDER *)vrgZip)[i].txp.rgia + iPass)->wFlags;
          pIVar1 = ((ZIPORDER *)vrgZip)[i].txp.rgia + iPass;
          pIVar1->wFlags = pIVar1->wFlags & 0xf000;
          pIVar1 = ((ZIPORDER *)vrgZip)[i].txp.rgia + iPass;
          pIVar1->wFlags = pIVar1->wFlags | ((cVar3 + -0x61) * 0x100 | uVar11) & 0xfff;
          psz = psz + 4;
        }
        _strcpy((char *)((int)vrgZip[0].szName + i * 0x18),psz);
        *(undefined1 *)((int)&vrgZip[0].fValid + i * 0x18) = 1;
      }
    }
  }
  _memset((ZIPPRODQ *)vrgZipProd,0,200);
  for (i = 0; i < 5; i = i + 1) {
    _strcpy(szEntry,szSection);
    uVar8 = _strlen(szEntry);
    szEntry[uVar8] = 'P';
    szEntry[uVar8 + 1] = (char)i + '1';
    szEntry[uVar8 + 2] = '\0';
    GetPrivateProfileString
              ((LPCSTR)CONCAT22(unaff_SS,szSection),(LPCSTR)CONCAT22(unaff_SS,szEntry),
               (LPCSTR)0x1120074b,szWork,0x50,(LPCSTR)CONCAT22(unaff_SS,szIniFile));
    uVar8 = _strlen((char *)szWork);
    if ((2 < (int)uVar8) && ((int)uVar8 < 0x41)) {
      psz = (char *)szWork;
      iVar12 = szWork[1] + -0x61;
      if ((-1 < iVar12) && (iVar12 < 0xd)) {
        iPass = 0;
        for (; ((iPass < iVar12 * 4 + 2 && ('`' < *psz)) && (*psz < 'q')); psz = psz + 1) {
          iPass = iPass + 1;
        }
        if (iVar12 * 4 + 2 <= iPass) {
          uVar8 = _strlen(psz);
          if (uVar8 < 0xd) {
            _strcpy(((ZIPPRODQ *)vrgZipProd)[i].szName,psz);
            *(bool *)(i * 0x28 + 0x2304) = szWork[0] != 'a';
            *(undefined1 *)((int)&vrgZipProd[0].fValid + i * 0x28) = 1;
            *(undefined1 *)((int)&vrgZipProd[0].cpq + i * 0x28) = (char)iVar12;
            psz = (char *)szWork + 2;
            for (iPass = 0; iPass < iVar12; iPass = iPass + 1) {
              *(int *)(i * 0x28 + 0x2306 + iPass * 2) = *psz + -0x61;
              puVar2 = (uint *)(i * 0x28 + 0x2306 + iPass * 2);
              *puVar2 = *puVar2 | (psz[1] + -0x61) * 0x10;
              puVar2 = (uint *)(i * 0x28 + 0x2306 + iPass * 2);
              *puVar2 = *puVar2 | (psz[2] + -0x61) * 0x100;
              puVar2 = (uint *)(i * 0x28 + 0x2306 + iPass * 2);
              *puVar2 = *puVar2 | (psz[3] + -0x61) * 0x1000;
              psz = psz + 4;
              if (0x3fc < *(uint *)(i * 0x28 + 0x2306 + iPass * 2) >> 6) {
                *(uint *)(i * 0x28 + 0x2306 + iPass * 2) =
                     *(uint *)(i * 0x28 + 0x2306 + iPass * 2) & 0x3f | 0x40;
              }
              if (6 < (*(uint *)(i * 0x28 + 0x2306 + iPass * 2) & 0x3f)) {
                *(uint *)(i * 0x28 + 0x2306 + iPass * 2) =
                     *(uint *)(i * 0x28 + 0x2306 + iPass * 2) & 0xffc0;
              }
            }
          }
        }
      }
    }
  }
  CchGetString(idsDefault,((ZIPPRODQ *)vrgZipProd)->szName);
  vrgZipProd[0].fValid = 1;
  return;
}



// ======================================================================
// Function: ReadIniTileSettings
// Address: 1000:2b8a
// Segment: MEMORY_INIT
// ======================================================================


void ReadIniTileSettings(char *pszFormat,TILE *rgtile,short ctile)

{
  TILE *pTVar1;
  TILE *pTVar2;
  byte bVar3;
  uint uVar4;
  int iVar5;
  TILE *pTVar6;
  TILE *pTVar7;
  undefined2 unaff_SS;
  ushort iBit;
  ushort iCol;
  short iTile;
  short i;
  short fPopped;
  TILE tile;
  
  iCol = 0;
  iTile = 0;
  for (; *pszFormat != '\0'; pszFormat = pszFormat + 1) {
    if (*pszFormat == '*') {
      if (iCol == 0) {
        iCol = 1;
      }
    }
    else if ((((undefined *)&DAT_1120_175f)[*pszFormat] & 3) != 0) {
      bVar3 = ((undefined *)&DAT_1120_175f)[*pszFormat];
      if ((bVar3 & 1) == 0) {
        uVar4 = (int)*pszFormat - 0x61;
      }
      else {
        uVar4 = (int)*pszFormat - 0x41;
      }
      if (-1 < (int)uVar4) {
        i = iTile;
        while ((i < ctile && (((uint)rgtile[i].wFlags >> 3 & 0xf) != uVar4))) {
          i = i + 1;
        }
        if (i != ctile) {
          rgtile[i].wFlags = rgtile[i].wFlags & 0xfff8U | iCol;
          rgtile[i].wFlags = rgtile[i].wFlags & 0xff7fU | (bVar3 & 1) << 7;
          if (i != iTile) {
            pTVar6 = rgtile + i;
            pTVar7 = &tile;
            for (iVar5 = 8; iVar5 != 0; iVar5 = iVar5 + -1) {
              pTVar2 = pTVar7;
              pTVar7 = (TILE *)&pTVar7->dyFull;
              pTVar1 = pTVar6;
              pTVar6 = (TILE *)&pTVar6->dyFull;
              pTVar2->yTop = pTVar1->yTop;
            }
            pTVar7 = rgtile + iTile;
            pTVar6 = rgtile + i;
            for (iVar5 = 8; iVar5 != 0; iVar5 = iVar5 + -1) {
              pTVar2 = pTVar6;
              pTVar6 = (TILE *)&pTVar6->dyFull;
              pTVar1 = pTVar7;
              pTVar7 = (TILE *)&pTVar7->dyFull;
              pTVar2->yTop = pTVar1->yTop;
            }
            pTVar6 = rgtile + iTile;
            pTVar7 = &tile;
            for (iVar5 = 8; iVar5 != 0; iVar5 = iVar5 + -1) {
              pTVar2 = pTVar6;
              pTVar6 = (TILE *)&pTVar6->dyFull;
              pTVar1 = pTVar7;
              pTVar7 = (TILE *)&pTVar7->dyFull;
              pTVar2->yTop = pTVar1->yTop;
            }
          }
          iTile = iTile + 1;
        }
      }
    }
  }
  for (i = iTile; i < ctile; i = i + 1) {
    if ((rgtile[i].wFlags & 7U) < iCol) {
      rgtile[i].wFlags = rgtile[i].wFlags & 0xfff8U | iCol;
    }
  }
  return;
}



